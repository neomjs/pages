import e from"../../../../src/list/Base.mjs";import t from"../../../../src/collection/Base.mjs";class s extends e{static config={className:"Docs.view.classdetails.MembersList",ntype:"classdetails-memberslist",baseCls:["docs-classhierarchy-memberslist"],filterMembersQuery_:"",showPrivateMembers_:!0,showProtectedMembers_:!0,showStaticMembers_:!0,store:null,targetClassName:null,_vdom:{cn:[]}};onConstructed(){super.onConstructed();let e=this,s=e.up("classdetails-maincontainer").down("classhierarchy-treelist"),r=e.up("main-container").store;s.on({refreshClassMembers:e.onRefreshClassMembers,scope:e}),e.store=Neo.create(t,{filterMode:"advanced",sourceId:r.id}),e.onRefreshClassMembers()}afterSetFilterMembersQuery(e,t){void 0!==t&&this.onRefreshClassMembers()}afterSetShowProtectedMembers(e,t){void 0!==t&&this.onRefreshClassMembers()}afterSetShowPrivateMembers(e,t){void 0!==t&&this.onRefreshClassMembers()}afterSetShowStaticMembers(e,t){void 0!==t&&this.onRefreshClassMembers()}applyConfigsHeader(e,t){return"member"===e.items[0]?.kind&&t.cn.push({},{cls:["neo-docs-memberlist-group-header"],html:"Configs","data-list-header":"Configs"}),t}applyEventsHeader(e,t,s,r){return"event"===e.kind&&"event"!==s.items[t-1]?.kind&&r.cn.push({},{cls:["neo-docs-memberlist-group-header"],html:"Events",style:{zIndex:3},"data-list-header":"Events"}),r}applyMethodsHeader(e,t,s,r){return"function"!==e.kind||s.items[t-1]&&"function"===s.items[t-1]?.kind||r.cn.push({},{cls:["neo-docs-memberlist-group-header"],html:"Methods",style:{zIndex:2},"data-list-header":"Methods"}),r}createItems(){let e,t,r,a,n=this,o=new RegExp(n.filterMembersQuery||"","gi"),l=!1,i=n.targetClassName,m=n.vdom;m.cn=[],m=n.applyConfigsHeader(n.store,m),n.store.items.forEach((c,p)=>{m=n.applyEventsHeader(c,p,n.store,m),m=n.applyMethodsHeader(c,p,n.store,m),t=[],"_"===c.name.substr(-1)&&(c.name=c.name.slice(0,-1),t.push("GS")),c.neoClassName!==i&&t.push("inherited"),"private"!==c.access&&"protected"!==c.access||t.push(c.access),"static"===c.scope&&t.push("static"),e=c.name,""!==n.filterMembersQuery&&null!==n.filterMembersQuery&&(e=e.replace(o,e=>`<span class="neo-highlight-search">${e}</span>`)),c.type?.names&&(e+=": {"+s.escapeHtml(c.type.names.join("|"))+"}"),c.hasOwnProperty("defaultvalue")&&(e+=" = "+c.defaultvalue),c.params&&"event"!==c.kind&&("property"===c.$kind&&(e="get "+e),e+="("+c.params.reduce((e,t)=>(t.name.indexOf(".")<0&&(t.optional?e.push("["+t.name+"]"):e.push(t.name)),e),[]).join(", ")+")"),c.returns?.[0].type&&(e+=" â†’ {"+s.escapeHtml(c.returns[0].type.names.join("|")+"}")),a=c.meta.path,a.includes("/neo.mjs/")?a=a.substr(a.indexOf("/neo.mjs/")+9):a.includes("/neomjs/")?a=a.substr(a.indexOf("/neomjs/")+8):a.includes("/neo/")&&(a=a.substr(a.indexOf("/neo/")+5)),r={cls:["neo-list-item"],cn:[{cls:["neo-list-item-header-container"],cn:[{cls:["neo-list-item-header"],html:e},{style:{flex:1}},{cls:["neo-list-item-header"],html:t.join(", ")}]},{cls:"neo-docs-view-source-link-container",cn:[{tag:"a",cls:["neo-docs-view-source-link"],href:`#/viewSource/${c.neoClassName}/line/${c.meta.lineno}`,html:`Source: ${a}/${c.meta.filename} (Line ${c.meta.lineno})`}]},{html:c.description}]},c.examples?.length>0&&(l=!0,c.examples.forEach(e=>{r.cn.push({tag:"pre",cls:["hljs"],cn:[{tag:"code",html:e}]})})),c.params?.length>0&&r.cn.push(s.createParametersTable(c.params)),c.returns?.[0].type&&"event"!==c.kind&&r.cn.push({html:"Returns {"+s.escapeHtml(c.returns[0].type.names.join("|")+"} ")+(c.returns[0].description||"")}),m.cn.push(r)}),n.update(),n.timeout(100).then(()=>{Neo.main.addon.HighlightJS.syntaxHighlightInit()})}static createParametersTable(e){let t,r,a,n=!1,o=!1;return e.forEach(e=>{e.hasOwnProperty("defaultvalue")&&(n=!0),e.hasOwnProperty("optional")&&(o=!0)}),a={tag:"table",cls:"docs-param-table",cn:[{tag:"thead",cn:[{tag:"th",html:"Name"},{tag:"th",html:"Type"},{tag:"th",html:"Description"}]}]},n&&a.cn[0].cn.splice(2,0,{tag:"th",html:"Default"}),o&&a.cn[0].cn.splice(2,0,{tag:"th",html:"Optional"}),e.forEach(l=>{l.name.indexOf(".")<0&&(t={tag:"td",html:l.description},r=[],e.forEach(e=>{0===e.name.indexOf(l.name+".")&&((e=Neo.clone(e,!0)).name=e.name.split("."),e.name.shift(),e.name=e.name.join("."),r.push(e))}),r.length>0&&(t={tag:"td",cn:[{html:t.html},s.createParametersTable(r)]}),a.cn.push({tag:"tr",cn:[{tag:"td",html:l.name},{tag:"td",html:l.type?s.escapeHtml(l.type.names.join(" | ")):""},t]}),n&&a.cn[a.cn.length-1].cn.splice(2,0,{tag:"td",html:void 0===l.defaultvalue?"":l.defaultvalue+""}),o&&a.cn[a.cn.length-1].cn.splice(2,0,{tag:"td",html:l.optional}))}),a}static escapeHtml(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}filterAndSortItems(){let e,t,s=this,r={},a=s.up("classdetails-maincontainer").down("classhierarchy-treelist").store.items,n=0,o=[];for(a.forEach(e=>{!0===e.checked&&o.push(e.name)}),t=o.length;n<t;n++)r[o[n]]=n;s.targetClassName=a[a.length-1].name,e=[{operator:"included",property:"neoClassName",value:o},{operator:"!==",property:"kind",value:"class"},{operator:"!==",property:"kind",value:"constant"},{operator:"!==",property:"kind",value:"module"},{operator:"isUndefined",property:"inherited"}],s.showPrivateMembers||e.push({operator:"!==",property:"access",value:"private"}),s.showProtectedMembers||e.push({operator:"!==",property:"access",value:"protected"}),s.showStaticMembers||e.push({operator:"!==",property:"scope",value:"static"}),""!==s.filterMembersQuery&&null!==s.filterMembersQuery&&e.push({operator:"like",property:"name",value:s.filterMembersQuery}),e.push({scope:s,filterBy:function(e){let t,s,a,n=e.filteredItems,o=e.item,l=this.targetClassName;if("ntype"===o.name&&o.neoClassName!==l)return!0;if(o.neoClassName!==l)for(s=0,a=n.length;s<a;s++)if(t=n[s],o.id!==t.id&&o.name===t.name&&o.scope===t.scope&&r[o.neoClassName]<r[t.neoClassName])return!0;return!1}}),s.store.filters=e,s.store.sorters=[{sortBy:function(e,t){return(e="member"===e.kind?0:"function"===e.kind?1:2)>(t="member"===t.kind?0:"function"===t.kind?1:2)?1:e<t?-1:0}},{direction:"ASC",property:"name"}],s.fire("mutateItems",s.store)}onStoreFilter(){}onRefreshClassMembers(){this.filterAndSortItems(),this.createItems()}}export default Neo.setupClass(s);