import e from"../api/Article.mjs";import t from"./article/DetailsContainer.mjs";import r from"../../../src/controller/Component.mjs";import o from"../api/Favorite.mjs";import s from"./article/FormContainer.mjs";import n from"./article/GalleryContainer.mjs";import i from"./article/HelixContainer.mjs";import a from"./HomeContainer.mjs";import l from"./user/LoginFormContainer.mjs";import{LOCAL_STORAGE_KEY as m}from"../api/config.mjs";import g from"../api/Profile.mjs";import u from"./user/ProfileContainer.mjs";import h from"./user/SettingsFormContainer.mjs";import c from"../api/Tag.mjs";import p from"../api/User.mjs";export default Neo.setupClass(class extends r{static config={className:"RealWorld2.view.MainContainerController",currentUser_:null,hashString:null};onConstructed(){super.onConstructed();const e=this;p.on("ready",e.getCurrentUser,e),Neo.config.hash||e.onHashChange({appNames:["RealWorld2"],hash:{"/":""},hashString:"/"},null)}afterSetArticlesOffset(e,t){Neo.isNumber(t)&&this.getArticles()}afterSetCurrentUser(e,t){}deleteArticle(t){e.delete({slug:t}).then((e=>{Neo.Main.setRoute({value:"/"})}))}deleteComment(t){let r=this,o=r.hashString.split("/").pop();return e.deleteComment(o,t).then((e=>{r.getComments(o)}))}favoriteArticle(e,t){return o[t?"add":"remove"](e)}followUser(e,t){return g[t?"follow":"unfollow"](e)}getArticle(t){return e.get({slug:t})}getArticles(t={},r={}){return e.get({params:{limit:20,...t},...r})}getComments(t){e.getComments(t).then((e=>{}))}getCurrentUser(e){e&&p.get({resource:"/user"}).then((e=>{this.currentUser=e.json.user,console.log(this.currentUser)}))}getProfile(e){g.get({slug:e}).then((e=>{}))}getTags(){c.get().then((e=>{this.getReference("home").getTagList().tags=e.json.tags}))}getView(e,t){let r=this,o=r.getReference(e);return o||(o=r.getReference("cards").add({module:t,reference:e})),o}login(e){this.currentUser=e,Neo.main.addon.LocalStorage.createLocalStorageItem({key:m,value:e.token}).then((()=>{this.timeout(50).then((()=>{Neo.Main.setRoute({value:"/"})}))}))}logout(){this.currentUser=null,Neo.main.addon.LocalStorage.destroyLocalStorageItem({key:m}).then((()=>{this.timeout(50).then((()=>{Neo.Main.setRoute({value:"/"})}))}))}onHashChange(e,r){let o,m,g=this,c=g.component,p=(e.hash,e.hashString);if(c.mounted)switch(console.log("onHashChange",e,p),o=g.getReference("cards"),g.hashString=p,"/"===p?m=g.getView("home",a):p.includes("/article/")?m=g.getView("article",t):"/editor"===p?m=g.getView("editor",s):"/helix"===p?m=g.getView("helix",i):"/gallery"===p?m=g.getView("gallery",n):"/login"===p?(m=g.getView("login",l),m.mode="login"):p.includes("/profile/")?m=g.getView("profile",u):"/settings"===p&&(m=g.getView("settings",h)),g.timeout(100).then((()=>{o.layout.activeIndex=o.indexOf(m)})),m.reference){case"gallery":case"helix":m.getArticles();break;case"home":m.getArticles(),g.getTags()}else c.on("mounted",(()=>{g.onHashChange(e,r,p)}))}onProfileButtonClick(){Neo.Main.setRoute({value:"/profile/"+this.currentUser.username})}postComment(t={}){let r=this,o=r.hashString.split("/").pop();return e.postComment(o,t).then((e=>{r.getComments(o)}))}saveUser(e){return p.post(e)}updateSettings(e={}){return p.put({...e,resource:"/user"}).then((e=>(e.json.errors||(this.currentUser=e.json.user),e)))}});