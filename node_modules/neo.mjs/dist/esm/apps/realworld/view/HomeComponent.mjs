import e from"../../../src/component/Base.mjs";import t from"../../../src/util/Array.mjs";import a from"./article/PreviewComponent.mjs";import n from"./article/TagListComponent.mjs";import i from"../../../src/util/VDom.mjs";export default Neo.setupClass(class extends e{static config={className:"RealWorld.view.HomeComponent",activeTag:null,articlePreviews_:null,baseCls:["home-page"],countArticles_:10,currentPage_:1,feeds_:[{name:"Your Feed",disabled:!0},{name:"Global Feed",active:!0}],loggedIn_:!1,pageSize_:10,previewComponents:[],tagList_:null,_vdom:{cn:[{cls:["banner"],cn:[{cls:["container"],cn:[{tag:"h1",cls:["logo-font"],html:"conduit"},{tag:"p",html:"A place to share your knowledge."}]}]},{cls:["container","page"],cn:[{cls:["row"],cn:[{cls:["col-md-9"],cn:[{cls:["feed-toggle"],cn:[{tag:"ul",cls:["nav","nav-pills","outline-active"],flag:"feed-header",cn:[]}]},{tag:"nav",cn:[{tag:"ul",cls:["pagination"],flag:"pagination"}]}]}]}]}]}};construct(e){super.construct(e),Neo.main.DomEvents.registerPreventDefaultTargets({name:"click",cls:"prevent-click"});let t=this;t.addDomListeners([{click:{fn:t.onNavLinkClick,delegate:".nav-link",scope:t}},{click:{fn:t.onPageNavLinkClick,delegate:".page-link",scope:t}}]),t.getController().on({afterSetCurrentUser:t.onCurrentUserChange,scope:t})}onConstructed(){super.onConstructed();let e=this;e.tagList=Neo.create({module:n,parentId:e.id,listeners:{tagChange:e.onTagChange,scope:e}}),e.vdom.cn[1].cn[0].cn.push(e.tagList.vdom),e.update()}afterSetArticlePreviews(e,t){let n,i=this,r=i.getContainer(),o=r.cn.pop();r.cn=[r.cn.shift()],Array.isArray(e)&&e.forEach(((e,t)=>{n={author:e.author.username,createdAt:e.createdAt,description:e.description,favorited:e.favorited,favoritesCount:e.favoritesCount,slug:e.slug,tagList:e.tagList,title:e.title,userImage:e.author.image},i.previewComponents[t]?i.previewComponents[t].set(n,!0):i.previewComponents[t]=Neo.create({module:a,parentId:i.id,...n}),r.cn.push(i.previewComponents[t].vdom)})),r.cn.push(o),i.update()}afterSetCountArticles(e,t){let a,n=this,r=i.getByFlag(n.vdom,"pagination"),o=n.pageSize,s=Math.ceil(e/o),l=n.currentPage,c=1;if(s<2);else for(r.cn=[];c<=s;c++)a=["page-item"],c===l&&a.push("active"),r.cn.push({tag:"li",cls:a,cn:[{tag:"a",cls:["page-link","prevent-click"],id:n.getNavLinkVdomId(c),href:"",html:c}]});n.update()}afterSetCurrentPage(e,a){let n,r,o=this;o.mounted&&(n=i.find(o.vdom,o.getNavLinkVdomId(e)).parentNode,r=i.find(o.vdom,o.getNavLinkVdomId(a)).parentNode,t.add(n.cls,"active"),t.remove(r.cls,"active"),o.update(),o.getController()._articlesOffset=(e-1)*o.pageSize,o.getArticles(),Neo.main.DomAccess.windowScrollTo({}))}afterSetFeeds(e,t){let a,n=this,r=n.vdom,o=i.getByFlag(r,"feed-header");o.cn=[],e.forEach(((e,t)=>{a=["prevent-click","nav-link"],e.active&&a.push("active"),e.disabled&&a.push("disabled"),o.cn.push({tag:"li",cls:["nav-item"],id:n.id+"__nav-item_"+t,cn:[{tag:"a",cls:a,href:"",html:e.name,id:n.id+"__nav-item-link_"+t}]})}))}afterSetLoggedIn(e,a){let n=this,r=i.find(n.vdom,n.id+"__nav-item-link_0").vdom;t[e?"remove":"add"](r.cls,"disabled"),n.update()}afterSetPageSize(e,t){let a=0;for(console.log("afterSetPageSize",e);a<e;a++);}getArticleId(e){return this.id+"__"+e}getArticles(e={},t={}){let a=this;a.activeTag&&(e={tag:a.activeTag,...e}),a.getController().getArticles(e,t).then((e=>{a.set({articlePreviews:e.json.articles,countArticles:e.json.articlesCount})}))}getContainer(){return i.find(this.vdom,{cls:"col-md-9"})?.vdom}getNavLinkId(e){return parseInt(e.split("__")[1])}getNavLinkVdomId(e){return this.id+"__"+e}onNavLinkClick(e){let a=this,n=i.find(a.vdom,e.path[0].id),r=i.getByFlag(a.vdom,"feed-header"),o={};if(!n.vdom.cls.includes("disabled")){switch(n.vdom.html){case"Global Feed":a.activeTag=null;break;case"Your Feed":a.activeTag=null,o={slug:"feed"};break;default:a.activeTag=n.vdom.html.substring(2)}r.cn.forEach((e=>{t[e.id===n.parentNode.id?"add":"remove"](e.cn[0].cls,"active")})),a._currentPage=1,a.update(),a.getController()._articlesOffset=0,a.getArticles({},o)}}onCurrentUserChange(e){this.loggedIn=!!e}onPageNavLinkClick(e){this.currentPage=this.getNavLinkId(e.path[0].id)}onTagChange(e){let t=this,a=t.feeds,n="# "+e.value;a.forEach((e=>{e.active=!1})),a.length<3?a.push({active:!0,name:n}):Object.assign(a[2],{active:!0,name:n}),t.activeTag=e.value,t._currentPage=1,t.feeds=a,t.getController()._articlesOffset=0,t.getArticles({tag:e.value})}});