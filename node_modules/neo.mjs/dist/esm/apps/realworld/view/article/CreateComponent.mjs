import t from"../../../../src/component/Base.mjs";import e from"../../../../src/util/VDom.mjs";import l from"../../../../src/util/VNode.mjs";import s from"../../api/Article.mjs";export default Neo.setupClass(class extends t{static config={className:"RealWorld.view.article.CreateComponent",baseCls:["editor-page"],body_:"",errors_:[],description_:"",slug:null,tagList_:[],title_:"",_vdom:{cn:[{cls:["container","page"],cn:[{cls:["row"],cn:[{cls:["col-md-10","offset-md-1","col-xs-12"],cn:[{tag:"ul",cls:["error-messages"],flag:"errors"},{tag:"form",cn:[{tag:"fieldset",cn:[{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control","form-control-lg"],flag:"title",name:"title",placeholder:"Article Title",type:"text"}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control"],name:"description",flag:"description",placeholder:"What's this article about?",type:"text"}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"textarea",cls:["form-control"],flag:"body",name:"body",placeholder:"Write your article (in markdown)",rows:8}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control","field-tags"],flag:"tags",name:"tags",placeholder:"Enter tags",type:"text"},{cls:["tag-list"],flag:"tag-list"}]},{tag:"button",cls:["btn","btn-lg","btn-primary","pull-xs-right"],html:"Publish Article",type:"button"}]}]}]}]}]}]}};construct(t){super.construct(t);let e=this;e.addDomListeners([{click:{fn:e.onSubmitButtonClick,delegate:".btn-primary",scope:e}},{click:{fn:e.onTagClose,delegate:".ion-close-round",scope:e}},{keydown:{fn:e.onFieldTagsKeyDown,delegate:".field-tags",scope:e}}])}afterSetBody(t,l){e.getByFlag(this.vdom,"body").value=t,this.update()}afterSetDescription(t,l){e.getByFlag(this.vdom,"description").value=t,this.update()}afterSetErrors(t,l){let s=e.getByFlag(this.vdom,"errors");s.cn=[],Object.entries(t||{}).forEach((([t,e])=>{s.cn.push({tag:"li",html:t+" "+e.join(" and ")})})),this.update()}afterSetTagList(t,l){let s=this,a=e.getByFlag(s.vdom,"tag-list"),o=e.getByFlag(s.vdom,"tags");a.cn=[],o.value=null,Object.entries(t||{}).forEach((([t,e])=>{a.cn.push({tag:"span",cls:["tag-default tag-pill"],cn:[{tag:"i",cls:["ion-close-round"],"data-value":e},{vtype:"text",html:e}]})})),s.update()}afterSetTitle(t,l){e.getByFlag(this.vdom,"title").value=t,this.update()}onFieldTagsKeyDown(t){let e=this;"Enter"===t.key&&Neo.main.DomAccess.getAttributes({id:t.target.id,attributes:"value"}).then((t=>{l.find(e.vnode,{className:"field-tags"}).vnode.attributes.value=t.value,e.tagList=[...e._tagList,t.value]}))}onSubmitButtonClick(){let t=this,l=t.vdom,a=e.getByFlag(l,"body"),o=e.getByFlag(l,"description"),i=[e.getByFlag(l,"title").id,o.id,a.id];Neo.main.DomAccess.getAttributes({id:i,attributes:"value"}).then((e=>{s[t.slug?"put":"post"]({data:JSON.stringify({article:{title:e[0].value,description:e[1].value,body:e[2].value,tagList:t.tagList}}),slug:t.slug}).then((e=>{const l=e.json.errors;l?t.errors=l:Neo.Main.setRoute({value:"/article/"+e.json.article.slug})}))}))}onTagClose(t){this.tagList=this.tagList.filter((e=>e!==t.target.data.value))}resetForm(){this.set({body:"",description:"",slug:null,tagList:[],title:""})}});