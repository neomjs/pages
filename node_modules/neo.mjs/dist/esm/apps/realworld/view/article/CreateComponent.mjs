import t from"../../../../src/component/Base.mjs";import e from"../../../../src/util/VDom.mjs";import s from"../../../../src/util/VNode.mjs";import a from"../../api/Article.mjs";export default Neo.setupClass(class extends t{static config={className:"RealWorld.view.article.CreateComponent",baseCls:["editor-page"],body_:"",errors_:[],description_:"",slug:null,tagList_:[],title_:"",_vdom:{cn:[{cls:["container","page"],cn:[{cls:["row"],cn:[{cls:["col-md-10","offset-md-1","col-xs-12"],cn:[{tag:"ul",cls:["error-messages"],flag:"errors"},{tag:"form",cn:[{tag:"fieldset",cn:[{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control","form-control-lg"],flag:"title",name:"title",placeholder:"Article Title",type:"text"}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control"],name:"description",flag:"description",placeholder:"What's this article about?",type:"text"}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"textarea",cls:["form-control"],flag:"body",name:"body",placeholder:"Write your article (in markdown)",rows:8}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control","field-tags"],flag:"tags",name:"tags",placeholder:"Enter tags",type:"text"},{cls:["tag-list"],flag:"tag-list"}]},{tag:"button",cls:["btn","btn-lg","btn-primary","pull-xs-right"],text:"Publish Article",type:"button"}]}]}]}]}]}]}};construct(t){super.construct(t);let e=this;e.addDomListeners([{click:{fn:e.onSubmitButtonClick,delegate:".btn-primary",scope:e}},{click:{fn:e.onTagClose,delegate:".ion-close-round",scope:e}},{keydown:{fn:e.onFieldTagsKeyDown,delegate:".field-tags",scope:e}}])}afterSetBody(t,s){e.getByFlag(this.vdom,"body").value=t,this.update()}afterSetDescription(t,s){e.getByFlag(this.vdom,"description").value=t,this.update()}afterSetErrors(t,s){let a=e.getByFlag(this.vdom,"errors");a.cn=[],Object.entries(t||{}).forEach(([t,e])=>{a.cn.push({tag:"li",text:t+" "+e.join(" and ")})}),this.update()}afterSetTagList(t,s){let a=this,l=e.getByFlag(a.vdom,"tag-list"),o=e.getByFlag(a.vdom,"tags");l.cn=[],o.value=null,Object.entries(t||{}).forEach(([t,e])=>{l.cn.push({tag:"span",cls:["tag-default tag-pill"],cn:[{tag:"i",cls:["ion-close-round"],"data-value":e},{vtype:"text",text:e}]})}),a.update()}afterSetTitle(t,s){e.getByFlag(this.vdom,"title").value=t,this.update()}onFieldTagsKeyDown(t){let e=this;"Enter"===t.key&&Neo.main.DomAccess.getAttributes({id:t.target.id,attributes:"value",windowId:e.windowId}).then(t=>{s.find(e.vnode,{className:"field-tags"}).vnode.attributes.value=t.value,e.tagList=[...e._tagList,t.value]})}onSubmitButtonClick(){let t=this,s=t.vdom,l=e.getByFlag(s,"body"),o=e.getByFlag(s,"description"),i=[e.getByFlag(s,"title").id,o.id,l.id];Neo.main.DomAccess.getAttributes({id:i,attributes:"value",windowId:t.windowId}).then(e=>{a[t.slug?"put":"post"]({data:JSON.stringify({article:{title:e[0].value,description:e[1].value,body:e[2].value,tagList:t.tagList}}),slug:t.slug}).then(e=>{const s=e.json.errors;s?t.errors=s:Neo.Main.setRoute({value:"/article/"+e.json.article.slug})})})}onTagClose(t){this.tagList=this.tagList.filter(e=>e!==t.target.data.value)}resetForm(){this.set({body:"",description:"",slug:null,tagList:[],title:""})}});