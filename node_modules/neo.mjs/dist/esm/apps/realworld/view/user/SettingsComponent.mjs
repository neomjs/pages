import e from"../../../../src/component/Base.mjs";import t from"../../../../src/util/VDom.mjs";export default Neo.setupClass(class extends e{static config={className:"RealWorld.view.user.SettingsComponent",baseCls:["settings-page"],bio_:null,email_:null,errors_:[],image_:null,userName_:null,_vdom:{cn:[{cls:["container","page"],cn:[{cls:["row"],cn:[{cls:["col-md-6","offset-md-3","col-xs-12"],cn:[{tag:"h1",cls:["text-xs-center"],html:"Your Settings"},{tag:"ul",cls:["error-messages"],flag:"errors",removeDom:!0},{tag:"form",cn:[{tag:"fieldset",cn:[{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control"],flag:"image",placeholder:"URL of profile picture",type:"text"}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control","form-control-lg"],flag:"userName",placeholder:"Your Name",type:"text"}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"textarea",cls:["form-control","form-control-lg"],flag:"bio",placeholder:"Short bio about you",rows:8}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control","form-control-lg"],flag:"email",placeholder:"Email",type:"text"}]},{tag:"fieldset",cls:["form-group"],cn:[{tag:"input",cls:["form-control","form-control-lg"],flag:"password",placeholder:"Password",type:"password"}]},{tag:"button",cls:["btn","btn-lg","btn-primary","pull-xs-right"],html:"Update Settings"}]}]},{tag:"hr"},{tag:"button",cls:["btn","btn-outline-danger"],html:"Or click here to logout."}]}]}]}]}};construct(e){super.construct(e);let t=this;t.addDomListeners([{click:{fn:t.onLogoutButtonClick,delegate:".btn-outline-danger",scope:t}},{click:{fn:t.onSubmitButtonClick,delegate:".btn-primary",scope:t}}]),t.getController().on({afterSetCurrentUser:t.onCurrentUserChange,scope:t})}afterSetBio(e,o){let r=this.vdom;t.getByFlag(r,"bio").value=e,this.update()}afterSetEmail(e,o){t.getByFlag(this.vdom,"email").value=e,this.update()}afterSetErrors(e=[],o){let r=t.getByFlag(this.vdom,"errors");r.cn=[],r.removeDom=0===e.length,Object.entries(e).forEach((([e,t])=>{r.cn.push({tag:"li",html:e+" "+t.join(" and ")})})),this.update()}afterSetImage(e,o){t.getByFlag(this.vdom,"image").value=e,this.update()}afterSetUserName(e,o){t.getByFlag(this.vdom,"userName").value=e,this.update()}onCurrentUserChange(e){e&&this.set({bio:e.bio,email:e.email,errors:[],image:e.image,userName:e.username})}onLogoutButtonClick(e){this.getController().logout()}onSubmitButtonClick(e){let o=this,r=o.vdom,l=t.getByFlag(r,"bio"),a=t.getByFlag(r,"email"),s=t.getByFlag(r,"image"),n=t.getByFlag(r,"password"),i=t.getByFlag(r,"userName");Neo.main.DomAccess.getAttributes({id:[l.id,a.id,s.id,n.id,i.id],attributes:"value"}).then((e=>{o.getController().updateSettings({data:JSON.stringify({user:{bio:e[0].value,email:e[1].value,image:e[2].value,password:e[3].value,username:e[4].value}})}).then((e=>{const t=e.json.errors;t?o.errors=t:Neo.Main.setRoute({value:"/profile/"+e.json.user.username})}))}))}});