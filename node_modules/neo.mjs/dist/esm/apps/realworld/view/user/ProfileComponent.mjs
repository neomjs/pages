import e from"../../../../src/component/Base.mjs";import t from"../../../../src/util/Array.mjs";import o from"../article/PreviewComponent.mjs";import l from"../../../../src/util/VDom.mjs";export default Neo.setupClass(class extends e{static config={className:"RealWorld.view.user.ProfileComponent",articlePreviews_:null,baseCls:["profile-page"],bio_:null,countArticles_:5,following_:null,image_:null,myProfile_:!1,previewComponents:[],username_:null,_vdom:{cn:[{cls:["user-info"],cn:[{cls:["container"],cn:[{cls:["row"],cn:[{cls:["col-xs-12","col-md-10","offset-md-1"],cn:[{tag:"img",cls:["user-img"],flag:"image"},{tag:"h4",flag:"username"},{tag:"p",flag:"bio"},{tag:"button",cls:["btn","btn-sm","btn-outline-secondary","action-btn","follow-button"],flag:"following",cn:[{tag:"i",cls:["ion-plus-round"]},{vtype:"text"},{vtype:"text"}]},{tag:"a",cls:["btn","btn-sm","btn-outline-secondary","action-btn"],flag:"edit-profile",href:"#/settings",removeDom:!0,cn:[{tag:"i",cls:["ion-gear-a"]},{vtype:"text",html:" Edit Profile Settings"}]}]}]}]}]},{cls:["container"],cn:[{cls:["row"],cn:[{cls:["col-xs-12","col-md-10","offset-md-1"],flag:"feed-container",cn:[{cls:["articles-toggle"],cn:[{tag:"ul",cls:["nav","nav-pills","outline-active"],flag:"feed-header",cn:[{tag:"li",cls:["nav-item"],cn:[{tag:"a",cls:["nav-link","prevent-click","active"],href:"",html:"My Articles"}]},{tag:"li",cls:["nav-item"],cn:[{tag:"a",cls:["nav-link","prevent-click"],href:"",html:"Favorited Articles"}]}]}]}]}]}]}]}};construct(e){super.construct(e),Neo.main.DomEvents.registerPreventDefaultTargets({name:"click",cls:"prevent-click"});let t=this;t.addDomListeners([{click:{fn:t.onFollowButtonClick,delegate:".follow-button",scope:t}},{click:{fn:t.onNavLinkClick,delegate:".nav-link",scope:t}}]),t.getController().on({afterSetCurrentUser:t.onCurrentUserChange,scope:t})}afterSetArticlePreviews(e,t){let n,i=this,s=l.getByFlag(i.vdom,"feed-container");s.cn=[s.cn.shift()],Array.isArray(e)&&e.forEach(((e,t)=>{n={author:e.author.username,createdAt:e.createdAt,description:e.description,favorited:e.favorited,favoritesCount:e.favoritesCount,slug:e.slug,tagList:e.tagList,title:e.title,userImage:e.author.image},i.previewComponents[t]?i.previewComponents[t].set(n,!0):i.previewComponents[t]=Neo.create({module:o,parentId:i.id,...n}),s.cn.push(i.previewComponents[t].vdom)})),i.update()}afterSetBio(e,t){e&&(l.getByFlag(this.vdom,"bio").html=e,this.update())}afterSetFollowing(e,o){if(Neo.isBoolean(e)){let o=l.getByFlag(this.vdom,"following");t.remove(o.cls,e?"btn-outline-secondary":"btn-secondary"),t.add(o.cls,e?"btn-secondary":"btn-outline-secondary"),o.cn[0].cls=[e?"ion-minus-round":"ion-plus-round"],o.cn[1].html=e?" Unfollow ":" Follow ",this.update()}}afterSetImage(e,t){l.getByFlag(this.vdom,"image").src=e,this.update()}afterSetMyProfile(e,t){if(console.log("afterSetMyProfile",e),Neo.isBoolean(t)){let t=this.vdom;l.getByFlag(t,"edit-profile").removeDom=!e,l.getByFlag(t,"following").removeDom=e,this.update()}}afterSetUsername(e,t){let o=this.vdom;l.getByFlag(o,"following").cn[2].html=e,l.getByFlag(o,"username").html=e,this.update()}getArticles(e){this.getController().getArticles(e).then((e=>{this.articlePreviews=e.json.articles}))}onCurrentUserChange(e){console.log("onCurrentUserChange",e),this.myProfile=this.username===e?.username}onFollowButtonClick(e){let t=this;t.getController().followUser(t.username,!t.following).then((e=>{t.following=e.json.profile.following}))}onNavLinkClick(e){let o=this,n=l.find(o.vdom,e.path[0].id),i=l.getByFlag(o.vdom,"feed-header"),s={};if(!n.vdom.cls.includes("disabled")){switch(n.vdom.html){case"Favorited Articles":s={favorited:o.username};break;case"My Articles":s={author:o.username}}i.cn.forEach((e=>{t[e.id===n.parentNode.id?"add":"remove"](e.cn[0].cls,"active")})),o.update(),o.getArticles({...s,limit:o.countArticles,offset:0})}}updateContent(e){let t=this,o=e.username;t.set({bio:e.bio,following:e.following,image:e.image,myProfile:e.myProfile,username:o}).then((()=>{t.getArticles({author:o,limit:t.countArticles,offset:0})}))}});