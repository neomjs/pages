import{API_URL as e,LOCAL_STORAGE_KEY as t}from"./config.mjs";import a from"../../../src/core/Base.mjs";class s extends a{static observable=!0;static token=null;static config={className:"RealWorld.api.Base",defaultHeaders:null,isReady:!1,resource:"/"};onConstructed(){super.onConstructed(),this.afterConstructed()}afterConstructed(){let e=this;Neo.apps&&Neo.apps.RealWorld?Neo.apps.RealWorld.rendered?e.onAppRendered():Neo.apps.RealWorld.on("render",e.onAppRendered,e):e.timeout(100).then(()=>{e.afterConstructed()})}onAppRendered(){const e=this;s.token?e.onReady(s.token):s.initialTokenRequestSent?s.on({ready:e.onReady,scope:e}):(s.initialTokenRequestSent=!0,Neo.main.addon.LocalStorage.readLocalStorageItem({key:t}).then(t=>{const a=t.value;a&&(s.token=a),e.onReady(a),s.isReady=!0,s.fire("ready",a)}))}createUrl(t){return t.url?e+t.url:e+(t.resource||this.resource)+(t.slug?"/"+t.slug:"")}delete(e={}){return Neo.Xhr.promiseJson({data:e.data,method:"DELETE",params:e.params,url:this.createUrl(e),headers:{...this.defaultHeaders,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}).catch(e=>{console.log("RealWorld.api.Base:get()",e)})}get(e={}){return Neo.Xhr.promiseJson({data:e.data,method:"GET",params:e.params,url:this.createUrl(e),headers:{...this.defaultHeaders,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}).catch(e=>{console.log("RealWorld.api.Base:get()",e)})}onReady(e){let t=this;e&&(t.defaultHeaders=t.defaultHeaders||{},t.defaultHeaders.Authorization="Token "+e),t.isReady=!0,t.fire("ready",e)}post(e={}){const t=e.params;return delete e.params,Neo.Xhr.promiseJson({data:e.data,method:"POST",params:t,url:this.createUrl(e),headers:{...this.defaultHeaders,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}).catch(e=>{console.log("RealWorld.api.Base:post()",e)})}put(e={}){const t=e.params;return delete e.params,Neo.Xhr.promiseJson({data:e.data,method:"PUT",params:t,url:this.createUrl(e),headers:{...this.defaultHeaders,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}).catch(e=>{console.log("RealWorld.api.Base:put()",e)})}}s.initialTokenRequestSent=!1,s.token=null;export default Neo.setupClass(s);