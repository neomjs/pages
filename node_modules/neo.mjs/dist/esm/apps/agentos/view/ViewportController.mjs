import e from"../../../src/controller/Component.mjs";export default Neo.setupClass(class extends e{static config={className:"AgentOS.view.ViewportController"};connectedWidgets=[];#e=!1;#n=!1;widgetIndexMap={strategy:0,swarm:1,intervention:2};construct(e){super.construct(e);let n=this;Neo.currentWorker.on({connect:n.onWindowConnect,disconnect:n.onWindowDisconnect,scope:n})}async onDragBoundaryEntry(e){let n=this,{windowId:t}=n,{sortZone:i}=e,o=e.draggedItem.reference,a=n.getReference(o);n.#e=!0,i.dragProxy.add(a,!0),await Neo.Main.windowClose({names:o,windowId:t}),n.#e=!1,n.#n=!1,i.isWindowDragging=!1,i.dragProxy.style={opacity:1},Neo.main.addon.DragDrop.setConfigs({isWindowDragging:!1,windowId:t})}async onDragBoundaryExit(e){let n,{draggedItem:t,proxyRect:i,sortZone:o}=e,a=t.reference;this.draggedItem=t,this.#n=!0,n=await this.#t(a,i),o.startWindowDrag({dragData:e,...n})}onDragEnd(e){let n=this;n.#n&&n.draggedItem&&(n.getReference("dashboard").remove(n.draggedItem,!1,!1),n.draggedItem=null),n.#n=!1}async onOpenSwarmClick(e){let n,t="swarm",{config:i,windowConfigs:o}=Neo,{environment:a}=i,d=Object.keys(o)[0],{basePath:g}=o[d];"development"!==a&&(g=`${g+a}/`),n=`${g}apps/agentos/childapps/swarm/index.html?name=${t}`,await Neo.Main.windowOpen({url:n,windowId:this.windowId,windowName:t,windowFeatures:"height=600,width=800,left=50,top=50"})}async onWindowConnect(e){if("AgentOSWidget"===e.appName||"AgentSwarm"===e.appName){let n=this,t=Neo.apps[e.windowId].mainView,{windowId:i}=e,o=await Neo.Main.getByPath({path:"document.URL",windowId:i}),a=new URL(o).searchParams.get("name"),d=n.getReference(a);d.wrapperStyle={},n.connectedWidgets.push(a),t.add(d,!1,!n.#n)}}async onWindowDisconnect(e){let n=this;if(n.#n||n.#e)return void(n.#n=!1);let{appName:t,windowId:i}=e;if("AgentOSWidget"===t||"AgentSwarm"===t){let e=await Neo.Main.getByPath({path:"document.URL",windowId:i}),t=new URL(e).searchParams.get("name"),o=n.getReference("dashboard"),a=n.getReference(t);o.insert(n.widgetIndexMap[t],a);let d=n.connectedWidgets.indexOf(t);d>-1&&n.connectedWidgets.splice(d,1)}else"AgentOS"===t&&Neo.Main.windowClose({names:n.connectedWidgets,windowId:i})}async#t(e,n){let t,{windowId:i}=this,{config:o,windowConfigs:a}=Neo,{environment:d}=o,g=Object.keys(a)[0],{basePath:s}=a[g];"development"!==d&&(s=`${s+d}/`),t="swarm"===e?`${s}apps/agentos/childapps/swarm/index.html?name=${e}`:`${s}apps/agentos/childapps/widget/index.html?name=${e}`;let r=await Neo.Main.getWindowData({windowId:i}),{height:w,width:p,x:c,y:m}=n,l=w-50,h=c+r.screenLeft,W=m+(r.outerHeight-r.innerHeight+r.screenTop);return await Neo.Main.windowOpen({url:t,windowId:i,windowFeatures:`height=${l},left=${h},top=${W},width=${p}`,windowName:e}),{popupHeight:l,popupLeft:h,popupTop:W,popupWidth:p,windowName:e}}});