import e from"../../../src/controller/Component.mjs";export default Neo.setupClass(class extends e{static config={className:"AgentOS.view.StrategyPanelController"};connectedWidgets=[];#e=!1;#n=!1;widgetIndexMap={"kpi-velocity":0,"kpi-active-epics":1,"kpi-uptime":2};construct(e){super.construct(e);let n=this;Neo.currentWorker.on({connect:n.onWindowConnect,disconnect:n.onWindowDisconnect,scope:n})}async onDragBoundaryEntry(e){let n=this,{windowId:t}=n,{sortZone:i}=e,o=e.draggedItem.reference,a=n.getReference(o);n.#n=!0,i.dragProxy.add(a,!0),await Neo.Main.windowClose({names:o,windowId:t}),n.#n=!1,n.#e=!1,i.isWindowDragging=!1,i.dragProxy.style={opacity:1},Neo.main.addon.DragDrop.setConfigs({isWindowDragging:!1,windowId:t})}async onDragBoundaryExit(e){let n,{draggedItem:t,proxyRect:i,sortZone:o}=e,a=t.reference;this.draggedItem=t,this.#e=!0,n=await this.#t(a,i),o.startWindowDrag({dragData:e,...n})}onDragEnd(e){let n=this;n.#e&&n.draggedItem&&(n.getReference("strategy").remove(n.draggedItem,!1,!1),n.draggedItem=null),n.#e=!1}async onWindowConnect(e){if("AgentOSStrategy"===e.appName){let n=this,t=Neo.apps[e.windowId].mainView,{windowId:i}=e,o=await Neo.Main.getByPath({path:"document.URL",windowId:i}),a=new URL(o).searchParams.get("name"),d=n.getReference(a);d.wrapperStyle={},n.connectedWidgets.push(a),t.add(d,!1,!n.#e)}}async onWindowDisconnect(e){let n=this;if(n.#e||n.#n)return void(n.#e=!1);let{appName:t,windowId:i}=e;if("AgentOSStrategy"===t){let e=await Neo.Main.getByPath({path:"document.URL",windowId:i}),t=new URL(e).searchParams.get("name"),o=n.getReference("strategy"),a=n.getReference(t);o.insert(n.widgetIndexMap[t],a);let d=n.connectedWidgets.indexOf(t);d>-1&&n.connectedWidgets.splice(d,1)}else"AgentOS"===t&&Neo.Main.windowClose({names:n.connectedWidgets,windowId:i})}async#t(e,n){let t,{windowId:i}=this,{config:o,windowConfigs:a}=Neo,{environment:d}=o,g=Object.keys(a)[0],{basePath:r}=a[g];"development"!==d&&(r=`${r+d}/`),t=`${r}apps/agentos/childapps/strategy/index.html?name=${e}`;let s=await Neo.Main.getWindowData({windowId:i}),{height:w,width:c,x:p,y:l}=n,h=Math.round(w),m=Math.round(p+s.screenLeft),u=Math.round(l+(s.outerHeight-s.innerHeight+s.screenTop)),y=Math.round(c);return await Neo.Main.windowOpen({url:t,windowId:i,windowFeatures:`height=${h},left=${m},top=${u},width=${y}`,windowName:e}),{popupHeight:h,popupLeft:m,popupTop:u,popupWidth:c,windowName:e}}});