import e from"../../../src/controller/Component.mjs";import t from"../../../src/layout/Cube.mjs";import n from"../../../src/util/Array.mjs";import{getSearchParams as o}from"../Util.mjs";export default Neo.setupClass(class extends e{static mainContentLayouts=["card","cube","mixed"];static config={className:"Portal.view.ViewportController",ntype:"viewport-controller",activeIndex_:null,defaultHash:"/home",mainContentLayout_:"card",routes:{"/about-us":"onAboutUsRoute","/blog":"onBlogRoute","/docs":"onDocsRoute","/examples":"onExamplesRoute","/examples/{itemId}":"onExamplesRoute","/home":"onHomeRoute","/learn":"onLearnRoute","/learn/{*itemId}":"onLearnRoute","/services":"onServicesRoute"},size_:null};connectedApps=[];#e=0;afterSetActiveIndex(e,t){null!==e&&this.updateHeaderToolbar()}afterSetMainContentLayout(e,t){let n=this,{activeIndex:o,windowId:a}=n,i=n.component.getItem("main-content");void 0===t&&Neo.main.addon.LocalStorage.readLocalStorageItem({key:"mainContentLayout",windowId:a}).then(({value:e})=>{e&&"card"!==e&&(n.mainContentLayout=e)}),i.layout="cube"===e?{ntype:"cube",activeIndex:o,fitContainer:!0,hideInactiveCardsOnDestroy:!0}:{ntype:"card",activeIndex:o},Neo.main.addon.LocalStorage.updateLocalStorageItem({key:"mainContentLayout",value:e,windowId:a})}afterSetSize(e,t){e&&this.updateHeaderToolbar()}beforeSetMainContentLayout(e,t){return this.beforeSetEnumValue(e,t,"mainContentLayout")}onAboutUsRoute(e,t,n){this.setMainContentIndex(5)}async onAppConnect(e){let{appName:t,windowId:n}=e,a=Neo.apps[t].mainView;if("PortalPreview"===t){let e=await Neo.Main.getByPath({path:"location.search",windowId:n}),t=o(e).id,i=Neo.getComponent(t),r=i.getReference("preview"),{tabContainer:s}=i,d=r.removeAt(0,!1);i.previewContainer=a,a.add(d),s.activeIndex=0,s.getTabAtIndex(1).disabled=!0}}async onAppDisconnect(e){let{appName:t,windowId:n}=e,a=Neo.apps[t].mainView;if("PortalPreview"===t){let e=await Neo.Main.getByPath({path:"location.search",windowId:n}),t=o(e).id,i=Neo.getComponent(t),r=i.getReference("preview"),{tabContainer:s}=i,d=a.removeAt(0,!1);i.previewContainer=null,r.add(d),i.disableRunSource=!0,s.activeIndex=1,i.getReference("popout-window-button").disabled=!1,s.getTabAtIndex(1).disabled=!1}else"Portal"===t&&Neo.Main.windowCloseAll({windowId:n})}onBlogPostStoreLoad(e){this.getReference("blog-header-button").badgeText=e.length+""}onBlogRoute(e,t,n){this.setMainContentIndex(2)}onBlogSearchFieldChange(e){this.getReference("blog-list").filterItems(e)}onConstructed(){super.onConstructed();let e=this;Neo.currentWorker.on({connect:e.onAppConnect,disconnect:e.onAppDisconnect,scope:e})}onDocsRoute(e,t,n){this.setMainContentIndex(6)}onExamplesRoute(e,t,n){this.setMainContentIndex(4)}onHomeRoute(e,t,n){this.setMainContentIndex(0)}onLearnRoute(e,t,n){this.setMainContentIndex(1)}onServicesRoute(e,t,n){this.setMainContentIndex(3)}async setMainContentIndex(e){let t,n=this,{activeIndex:o,mainContentLayout:a}=n,i=n.getReference("main-content"),r=!0;e!==o&&(n.activeIndex=e,"mixed"===a&&Neo.isNumber(o)&&e<6&&o<6&&(n.#e++,t=n.#e,r=!1,"layout-cube"!==i.layout.ntype&&(await i.set({layout:{ntype:"cube",activeIndex:o,fitContainer:!0,hideInactiveCardsOnDestroy:!0}}),await n.timeout(20)),i.layout.activeIndex=e,await n.timeout(1100),t===n.#e&&(await i.set({layout:{ntype:"card",activeIndex:e}}),await n.timeout(20))),r&&(i.layout.activeIndex=e))}async updateHeaderToolbar(){let e=this,{activeIndex:t,size:o}=e;if(Neo.isNumber(t)&&o){let a=e.getReference("header-social-icons"),{cls:i}=a,r="x-small"===o,s=0!==t&&r;n.toggle(i,"hide-sidebar",s),s||n.toggle(i,"separate-bar",r),a.cls=i,s&&r&&await e.timeout(200),a.hidden=s}}});