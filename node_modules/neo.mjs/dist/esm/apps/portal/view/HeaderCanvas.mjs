import a from"../../../src/component/Canvas.mjs";import e from"../../../src/manager/Component.mjs";export default Neo.setupClass(class extends a{static config={className:"Portal.view.HeaderCanvas",activeId_:null,cls:["portal-header-canvas"],listeners:{resize:"onResize"},_vdom:{tag:"canvas"}};canvasId=null;isCanvasReady=!1;navRects=null;async afterSetOffscreenRegistered(a,e){let t=this;a?(await Portal.canvas.Helper.importHeaderCanvas(),await Portal.canvas.HeaderCanvas.initGraph({canvasId:t.getCanvasId(),windowId:t.windowId}),t.isCanvasReady=!0,Neo.main.addon.ResizeObserver.register({id:t.id,windowId:t.windowId}),await t.updateSize(),await t.updateNavRects(),t.activeId&&await Portal.canvas.HeaderCanvas.updateActiveId({id:t.activeId})):e&&(t.isCanvasReady=!1,await Portal.canvas.HeaderCanvas.clearGraph())}async afterSetActiveId(a,e){this.isCanvasReady&&await Portal.canvas.HeaderCanvas.updateActiveId({id:a})}getCanvasId(){let a=this;return a.canvasId||(a.canvasId=a.id),a.canvasId}onClick(a){let e=this;e.isCanvasReady&&e.canvasRect&&Portal.canvas.HeaderCanvas.updateMouseState({click:!0,x:a.clientX-e.canvasRect.left,y:a.clientY-e.canvasRect.top})}onMouseLeave(a){this.isCanvasReady&&Portal.canvas.HeaderCanvas.updateMouseState({leave:!0})}onMouseMove(a){let e=this;e.isCanvasReady&&e.canvasRect&&Portal.canvas.HeaderCanvas.updateMouseState({x:a.clientX-e.canvasRect.left,y:a.clientY-e.canvasRect.top})}async onResize(a){await this.updateSize(a.contentRect),await this.updateNavRects()}async updateNavRects(){let a=this;if(!a.isCanvasReady)return;let t=Neo.get(a.parentId),s=e.down(t,"button",!1).map(a=>a.id);if(s.length>0){let e=await a.getDomRect(s),t=await a.getDomRect(a.id);a.canvasRect=t,e&&t&&(a.navRects=e.map((a,e)=>a?{id:s[e],x:a.x-t.x,y:a.y-t.y,width:a.width,height:a.height}:null).filter(Boolean),Portal.canvas.HeaderCanvas.updateNavRects({rects:a.navRects}))}}async updateSize(a){let e=this;a&&0!==a.width&&0!==a.height||(a=await e.getDomRect(e.id)),a&&(e.canvasRect=a,await Portal.canvas.HeaderCanvas.updateSize({width:a.width,height:a.height}))}});