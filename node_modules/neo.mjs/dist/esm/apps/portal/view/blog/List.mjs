import e from"../../../../src/list/Base.mjs";import t from"../../store/BlogPosts.mjs";import o from"../../../../src/util/VDom.mjs";class s extends e{static nameRegEx=/^(.{65}[^\s]*).*/;static config={className:"Portal.view.blog.List",baseCls:["portal-blog-list","neo-list"],intersectionObserverReconnects:10,preloadImages:5,store:t,useWrapperNode:!0,_vdom:{cn:[{tag:"ul",cn:[]}]}};get imageBasePath(){let e;return Neo.config.isGitHubPages?(e="../../../../resources_pub/website","development"!==Neo.config.environment&&(e="../../"+e)):e="https://raw.githubusercontent.com/neomjs/pages/main/resources_pub/website",e}construct(e){super.construct(e);let t=this;t.addDomListeners({intersect:t.onIntersect,scope:t})}afterSetMounted(e,t){super.afterSetMounted(e,t),e&&this.registerIntersectionObserver()}afterSetStore(e,t){super.afterSetStore(e,t),e.on({load:"onBlogPostStoreLoad",scope:this.getController()})}createItemContent(e){let{imageBasePath:t}=this;const n=[{cls:["content"],data:{recordId:e.id},cn:[{cls:["neo-relative"],cn:[{cls:["neo-full-size","preview-image"],flag:`image-${e.id}`},{cls:["neo-absolute","neo-item-bottom-position"],cn:[{tag:"a",cls:["neo-title"],href:e.url,target:"_blank",cn:[{flag:"name",html:e.name.replace(s.nameRegEx,"$1")}]},{cls:["neo-top-20"],cn:[{tag:"img",cls:["neo-user-image"],src:`${t}/blogAuthor/${e.authorImage}`},{cls:["neo-inner-content"],cn:[{cls:["neo-inner-details"],flag:"author",cn:[{tag:"span",cls:["neo-bold"],text:e.author}]},{cls:["neo-inner-details"],text:e.date}]}]}]}]}]}];return e.publisher.length>0&&o.getByFlag(n[0],"author").cn.push({vtype:"text",text:" in "},{tag:"span",cls:["neo-bold"],text:e.publisher}),e.selectedInto.length>0&&n[0].cn[0].cn.splice(1,0,{cls:["neo-absolute","neo-item-top-position"],cn:[{text:`Officially selected by ${e.provider} into`},{cls:["neo-bold"],text:e.selectedInto.join("</br>")}]}),n}filterItems(e){let t,n,a,r,i=this,l=!e.value||""===e.value,c=i.store,g=new RegExp(e.value,"gi");i.getVdomRoot().cn.forEach((e,i)=>{t=!1,n=o.getByFlag(e,"name"),r=c.getAt(i),a=r.name.replace(s.nameRegEx,"$1"),e.style??={},l?(n.html=a,delete e.style.display):(n.html=a.replace(g,e=>(t=!0,`<span class="neo-highlight-search">${e}</span>`)),t?delete e.style.display:e.style.display="none")}),i.update()}getVdomRoot(){return this.vdom.cn[0]}getVnodeRoot(){return this.vnode.childNodes[0]}onIntersect(e){let t,s=this,{imageBasePath:n,store:a}=s,r=a.get(parseInt(e.data.recordId)),i=a.indexOf(r),l=Math.min(i+s.preloadImages,a.getCount()),c=!1;for(;i<l;i++)t=o.getByFlag(s.vdom,`image-${r.id}`),t.style||(c=!0,t.style={backgroundImage:[`url('${n}/blog/${r.image}'),`,"linear-gradient(","var(--portal-blog-list-gradient-start),","var(--portal-blog-list-gradient-end)",")"].join("")});c&&s.update()}async registerIntersectionObserver(){let e,t=this,o={id:t.id,observe:[".content"],windowId:t.windowId},s=0,n=t.intersectionObserverReconnects;if(await t.timeout(150),e=await Neo.main.addon.IntersectionObserver.register({...o,callback:"isVisible",root:`#${t.parentId}`}),e.countTargets<1)for(;s<n&&(await t.timeout(100),e=await Neo.main.addon.IntersectionObserver.observe(o),!(e.countTargets>0));s++);}}export default Neo.setupClass(s);