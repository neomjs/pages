import e from"../../../src/core/Base.mjs";const a="#3E63DD",t="#8BA6FF",r="#40C4FF";export default Neo.setupClass(class extends e{static config={className:"Portal.canvas.HeaderCanvas",remote:{app:["clearGraph","initGraph","updateActiveId","updateGraphData","updateMouseState","updateNavRects","updateSize"]},singleton:!0};activeId=null;animationId=null;canvasId=null;canvasSize=null;context=null;gradients={};mouse={x:-1e3,y:-1e3};navRects=[];particles=[];shockwaves=[];time=0;waveBuffers={bgA:null,bgB:null,fgA:null,fgB:null};clearGraph(){let e=this;e.context=null,e.canvasId=null,e.canvasSize=null,e.navRects=[],e.particles=[],e.shockwaves=[],e.waveBuffers={bgA:null,bgB:null,fgA:null,fgB:null},e.gradients={}}initGraph({canvasId:e,windowId:a}){let t=this,r=t.canvasId!==e;t.canvasId=e;const o=()=>{const i=Neo.currentWorker.canvasWindowMap[e]?.[a];i?(t.context=i.getContext("2d"),t.initParticles(i.width,i.height),t.updateResources(i.width,i.height),r&&t.renderLoop()):setTimeout(o,50)};o()}initParticles(e,a){let t=this;t.particles=[];for(let r=0;r<60;r++){let r=Math.random()>.8;t.particles.push({isNebula:r,x:Math.random()*e,y:Math.random()*a,vx:r?.2*Math.random()+.05:.5*Math.random()+.1,vy:.2*(Math.random()-.5),size:r?30*Math.random()+20:2*Math.random()+.5,alpha:r?.15*Math.random()+.2:.4*Math.random()+.2,baseAlpha:r?.15*Math.random()+.2:.4*Math.random()+.2})}}renderLoop=this.render.bind(this);render(){let e=this;if(!e.context)return;const a=e.context,t=e.canvasSize?.width||100,r=e.canvasSize?.height||50;e.time+=.05,60!==e.particles.length&&e.initParticles(t,r),a.clearRect(0,0,t,r),e.drawAmbientBackground(a,t,r),e.drawParticles(a,t,r),e.drawAuras(a,t,r),e.drawActiveOverlay(a,t),e.drawShockwaves(a,t),setTimeout(e.renderLoop,1e3/60)}calculateStrandGeometry(e,a){let t=this;if(!Array.isArray(t.navRects)||!t.waveBuffers.fgA)return null;const r=t.waveBuffers.fgA,o=t.waveBuffers.fgB,i=Math.ceil(e/2),s=a/2,l=(a-20)/2,n=2*Math.sin(.5*t.time),h=Math.min(6+n,l);let d=.75+.25*Math.sin(.5*t.time+Math.PI/2),c=.75+.25*Math.sin(.5*t.time+Math.PI/2+Math.PI/3);for(let e=0;e<i;e++){let i=2*e,{offsetY:l,intensity:n,isIconZone:d}=t.getStreamOffset(i,a),c=Math.sin(.002*i+.1*t.time)*(20+10*n),u=2*t.time,g=h*(1-.6*d),f=4*(Math.random()-.5)*n,p=4*(Math.random()-.5)*n,v=Math.sin(.04*(i+c)-u)*g,m=Math.sin(.04*(i+c)-u+Math.PI)*g,w=0;t.shockwaves.length>0&&t.shockwaves.forEach(e=>{let a=e.age*e.speed,t=i-e.x;if(Math.abs(t)<a&&Math.abs(t)>a-60){let r=Math.sin(t/a*Math.PI*10)*(1-e.age/e.life)*20;w+=r}}),r[e]=s+v-l+f+w,o[e]=s+m+l+p+w}return{shimmerA:d,shimmerB:c,count:i}}drawParticles(e,a,t){let o=this;o.particles.forEach(i=>{i.x+=i.vx,i.y+=i.vy,i.x>a+i.size&&(i.x=-i.size),i.x<-i.size&&(i.x=a+i.size),i.y>t+i.size&&(i.y=-i.size),i.y<-i.size&&(i.y=t+i.size);let s=i.x-o.mouse.x,l=i.y-o.mouse.y,n=Math.sqrt(s*s+l*l),h=i.isNebula?150:100;if(n<h&&n>0){let e=(h-n)/h,a=i.isNebula?5:1;i.x+=s/n*e*(2/a),i.y+=l/n*e*(2/a),i.alpha=Math.min(i.baseAlpha+e*(i.isNebula?.05:.5),.8)}if(o.shockwaves.length>0&&o.shockwaves.forEach(e=>{let a=i.x-e.x,t=i.y-e.y,r=Math.sqrt(a*a+t*t),o=e.age*e.speed;if(r<o&&r>o-40){let o=2*(1-e.age/e.life);i.x+=a/r*o*5,i.y+=t/r*o*5,i.alpha=Math.min(i.alpha+.3,1)}}),i.alpha>i.baseAlpha&&(i.alpha-=.005),e.globalAlpha=i.alpha,e.beginPath(),i.isNebula){let a=e.createRadialGradient(i.x,i.y,0,i.x,i.y,i.size);a.addColorStop(0,r),a.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=a,e.arc(i.x,i.y,i.size,0,2*Math.PI),e.fill()}else e.fillStyle=r,e.arc(i.x,i.y,i.size,0,2*Math.PI),e.fill()}),e.globalAlpha=1}drawActiveOverlay(e,a){let t=this;if(!t.activeId||!t.waveBuffers.fgA)return;const r=t.navRects.find(e=>e.id===t.activeId);if(!r)return;const o=Math.max(0,r.x-10),i=Math.min(a,r.x+r.width+10),s=Math.floor(o/2),l=Math.ceil(i/2),n=t.waveBuffers.fgA,h=t.waveBuffers.fgB;e.save(),e.lineCap="round",e.lineJoin="round",e.shadowBlur=20,e.shadowColor="#FFFFFF",e.strokeStyle="#FFFFFF",e.lineWidth=2,e.globalAlpha=.6+.2*Math.sin(3*t.time);const d=a=>{e.beginPath(),e.moveTo(2*s,a[s]);for(let t=s+1;t<=l;t++)e.lineTo(2*t,a[t]);e.stroke()};d(n),d(h),e.restore()}drawAmbientBackground(e,a,t){let r=this;if(!r.waveBuffers.bgA)return;let o=.5*r.time,i=t/2,s=.4*t,l=Math.ceil(a/10),n=r.waveBuffers.bgA,h=r.waveBuffers.bgB;for(let e=0;e<l;e++){let a=10*e;n[e]=i+Math.sin(.01*a+o)*s,h[e]=i+Math.sin(.01*a+o+Math.PI)*s}e.fillStyle=r.gradients.bgRibbon,e.beginPath(),e.moveTo(0,n[0]);for(let a=1;a<l;a++)e.lineTo(10*a,n[a]);for(let a=l-1;a>=0;a--)e.lineTo(10*a,h[a]);e.closePath(),e.fill(),e.lineWidth=15,e.lineCap="round",e.lineJoin="round";const d=(a,t)=>{e.strokeStyle=t,e.beginPath(),e.moveTo(0,a[0]);for(let t=1;t<l;t++)e.lineTo(10*t,a[t]);e.stroke()};d(n,r.gradients.bgGrad1),d(h,r.gradients.bgGrad2)}drawAuras(e,r,o){let i=this;if(!Array.isArray(i.navRects))return;const s=i.calculateStrandGeometry(r,o);if(!s)return;const{shimmerA:l,shimmerB:n,count:h}=s,d=i.waveBuffers.fgA,c=i.waveBuffers.fgB;e.fillStyle=i.gradients.fgRibbon,e.beginPath(),e.moveTo(0,d[0]);for(let a=1;a<h;a++)e.lineTo(2*a,d[a]);for(let a=h-1;a>=0;a--)e.lineTo(2*a,c[a]);e.closePath(),e.fill(),e.lineCap="round",e.lineJoin="round";const u=(a,t,r,o,i)=>{e.beginPath(),e.strokeStyle=i?"#FFFFFF":t,e.lineWidth=i?1:3,e.globalAlpha=i?r+.2:r,i?e.shadowBlur=0:(e.shadowBlur=10,e.shadowColor=o),e.moveTo(0,a[0]);for(let t=1;t<h;t++)e.lineTo(2*t,a[t]);e.stroke()};u(d,i.gradients.grad1,l,a,!1),u(c,i.gradients.grad2,n,t,!1),u(d,null,l,null,!0),u(c,null,n,null,!0),e.shadowBlur=0,e.globalAlpha=1}getStreamOffset(e,a){let t=this,r=0,o=0,i=0;const s=a/2-10;for(const a of t.navRects){const l=40;if(e>=a.x-l&&e<=a.x+a.width+l){const n=a.width/a.height<1.5,h=a.x+a.width/2,d=a.width/2+l,c=Math.abs(e-h);if(c<d){let e;if(n){let a=c/d;e=Math.pow((1+Math.cos(Math.PI*a))/2,3),i=Math.max(i,e)}else e=(1+Math.cos(Math.PI*c/d))/2;let l=n?a.height/2:a.height/2+4,u=Math.min(l,s);r=Math.max(r,u*e);let g=t.mouse.x-h,f=t.mouse.y-(a.y+a.height/2),p=Math.sqrt(g*g+f*f);p<Math.max(a.width,a.height)&&(o=Math.max(o,1-p/150))}}}return{offsetY:r,intensity:o,isIconZone:i}}drawShockwaves(e,a){let t=this;for(let o=t.shockwaves.length-1;o>=0;o--){let i=t.shockwaves[o];i.age+=1;let s=i.age/i.life;if(s>=1){t.shockwaves.splice(o,1);continue}let l=i.x-i.speed*i.age,n=i.x+i.speed*i.age,h=1-s,{height:d}=t.canvasSize;e.beginPath(),e.strokeStyle=r,e.globalAlpha=h,e.lineWidth=4*(1-s),l>0&&(e.moveTo(l,0),e.quadraticCurveTo(l-20,d/2,l,d)),n<a&&(e.moveTo(n,0),e.quadraticCurveTo(n+20,d/2,n,d)),e.stroke(),e.globalAlpha=1}}updateActiveId(e){this.activeId=e?.id||null}updateGraphData(e){}updateMouseState(e){let a=this;e.leave?(a.mouse.x=-1e3,a.mouse.y=-1e3):(void 0!==e.x&&(a.mouse.x=e.x),void 0!==e.y&&(a.mouse.y=e.y),e.click&&a.shockwaves.push({x:e.x,y:e.y,age:0,life:60,speed:15}))}updateNavRects(e){let a=e?.rects;Array.isArray(a)?this.navRects=a:this.navRects=[]}updateResources(e,o){let i=this,s=i.context;const l=Math.ceil(e/10)+1;i.waveBuffers.bgA=new Float32Array(l),i.waveBuffers.bgB=new Float32Array(l);const n=Math.ceil(e/2)+1;if(i.waveBuffers.fgA=new Float32Array(n),i.waveBuffers.fgB=new Float32Array(n),!s)return;const h=s.createLinearGradient(0,0,e,0);h.addColorStop(0,a),h.addColorStop(.5,r),h.addColorStop(1,a),i.gradients.grad1=h;const d=s.createLinearGradient(0,0,e,0);d.addColorStop(0,t),d.addColorStop(.5,r),d.addColorStop(1,t),i.gradients.grad2=d;const c=s.createLinearGradient(0,0,e,0);c.addColorStop(0,"rgba(62, 99, 221, 0.05)"),c.addColorStop(.5,"rgba(64, 196, 255, 0.1)"),c.addColorStop(1,"rgba(62, 99, 221, 0.05)"),i.gradients.fgRibbon=c;const u=s.createLinearGradient(0,0,e,0);u.addColorStop(0,"rgba(62, 99, 221, 0.1)"),u.addColorStop(.5,"rgba(64, 196, 255, 0.2)"),u.addColorStop(1,"rgba(62, 99, 221, 0.1)"),i.gradients.bgGrad1=u;const g=s.createLinearGradient(0,0,e,0);g.addColorStop(0,"rgba(139, 166, 255, 0.1)"),g.addColorStop(.5,"rgba(64, 196, 255, 0.2)"),g.addColorStop(1,"rgba(139, 166, 255, 0.1)"),i.gradients.bgGrad2=g;const f=s.createLinearGradient(0,0,e,0);f.addColorStop(0,"rgba(62, 99, 221, 0.02)"),f.addColorStop(.5,"rgba(64, 196, 255, 0.05)"),f.addColorStop(1,"rgba(62, 99, 221, 0.02)"),i.gradients.bgRibbon=f}updateSize(e){let a=this;a.canvasSize=e,a.context&&(a.context.canvas.width=e.width,a.context.canvas.height=e.height,a.updateResources(e.width,e.height))}});