import e from"./Base.mjs";const a="function"==typeof requestAnimationFrame,t="#3E63DD",r="#536DFE",o="#00BFFF";export default Neo.setupClass(class extends e{static colors={dark:{background:["rgba(62, 99, 221, 0.1)","rgba(64, 196, 255, 0.2)","rgba(62, 99, 221, 0.1)"],background2:["rgba(139, 166, 255, 0.1)","rgba(64, 196, 255, 0.2)","rgba(139, 166, 255, 0.1)"],bgRibbon:["rgba(62, 99, 221, 0.02)","rgba(64, 196, 255, 0.05)","rgba(62, 99, 221, 0.02)"],fgRibbon:["rgba(62, 99, 221, 0.025)","rgba(64, 196, 255, 0.05)","rgba(62, 99, 221, 0.025)"],grad1:[t,o,t],grad2:[r,o,r],hover:o,particle:o,particleAlpha:{nebula:.2,dust:.2},shockwave:o},light:{background:["rgba(62, 99, 221, 0.1)","rgba(64, 196, 255, 0.2)","rgba(62, 99, 221, 0.1)"],background2:["rgba(139, 166, 255, 0.1)","rgba(64, 196, 255, 0.2)","rgba(139, 166, 255, 0.1)"],bgRibbon:["rgba(62, 99, 221, 0.02)","rgba(64, 196, 255, 0.05)","rgba(62, 99, 221, 0.02)"],fgRibbon:["rgba(62, 99, 221, 0.05)","rgba(64, 196, 255, 0.1)","rgba(62, 99, 221, 0.05)"],grad1:[t,o,t],grad2:[r,o,r],hover:t,particle:o,particleAlpha:{nebula:.2,dust:.2},shockwave:o}};static config={className:"Portal.canvas.HeaderCanvas",remote:{app:["updateActiveId","updateGraphData","updateHoverId","updateNavRects"]},singleton:!0};activeId=null;hoverId=null;navRects=[];particles=[];shockwaves=[];waveBuffers={bgA:null,bgB:null,fgA:null,fgB:null};clearGraph(){let e=this;super.clearGraph(),e.navRects=[],e.particles=[],e.shockwaves=[],e.waveBuffers={bgA:null,bgB:null,fgA:null,fgB:null}}onGraphMounted(e,a){this.initParticles(e,a)}initParticles(e,a){let t=this;t.particles=[];const r=t.constructor.colors[t.theme].particleAlpha;for(let o=0;o<60;o++){let o=Math.random()>.8;t.particles.push({isNebula:o,x:Math.random()*e,y:Math.random()*a,vx:o?.2*Math.random()+.05:.5*Math.random()+.1,vy:.2*(Math.random()-.5),size:o?30*Math.random()+20:2*Math.random()+.5,alpha:o?.15*Math.random()+r.nebula:.4*Math.random()+r.dust,baseAlpha:o?.15*Math.random()+r.nebula:.4*Math.random()+r.dust})}}render(){let e=this;if(!e.canRender)return;const t=e.context,r=e.canvasSize?.width||100,o=e.canvasSize?.height||50;e.time+=.05,60!==e.particles.length&&e.initParticles(r,o),t.clearRect(0,0,r,o),e.drawAmbientBackground(t,r,o),e.drawParticles(t,r,o),e.drawAuras(t,r,o),e.drawActiveOverlay(t,r),e.drawHoverOverlay(t,r),e.drawShockwaves(t,r),e.animationId=a?requestAnimationFrame(e.renderLoop):setTimeout(e.renderLoop,1e3/60)}calculateStrandGeometry(e,a){let t=this;if(!Array.isArray(t.navRects)||!t.waveBuffers.fgA)return null;const r=t.waveBuffers.fgA,o=t.waveBuffers.fgB,l=Math.ceil(e/2),i=a/2,s=(a-20)/2,n=2*Math.sin(.5*t.time),h=Math.min(6+n,s);let d=.75+.25*Math.sin(.5*t.time+Math.PI/2),c=.75+.25*Math.sin(.5*t.time+Math.PI/2+Math.PI/3);for(let s=0;s<l;s++){let l=2*s,{offsetY:n,intensity:d,isIconZone:c}=t.getStreamOffset(l,a,e),g=Math.sin(.002*l+.1*t.time)*(20+10*d),f=2*t.time,u=h*(1-.6*c),b=4*(Math.random()-.5)*d,v=4*(Math.random()-.5)*d,p=Math.sin(.04*(l+g)-f)*u,m=Math.sin(.04*(l+g)-f+Math.PI)*u,w=0;t.shockwaves.length>0&&t.shockwaves.forEach(e=>{let a=e.age*e.speed,t=l-e.x;if(Math.abs(t)<a&&Math.abs(t)>a-60){let r=Math.sin(t/a*Math.PI*10)*(1-e.age/e.life)*20;w+=r}}),r[s]=i+p-n+b+w,o[s]=i+m+n+v+w}return{shimmerA:d,shimmerB:c,count:l}}drawParticles(e,a,t){let r=this;const o=r.constructor.colors[r.theme].particle;r.particles.forEach(l=>{l.x+=l.vx,l.y+=l.vy,l.x>a+l.size&&(l.x=-l.size),l.x<-l.size&&(l.x=a+l.size),l.y>t+l.size&&(l.y=-l.size),l.y<-l.size&&(l.y=t+l.size);let i=l.x-r.mouse.x,s=l.y-r.mouse.y,n=Math.sqrt(i*i+s*s),h=l.isNebula?150:100;if(n<h&&n>0){let e=(h-n)/h,a=l.isNebula?5:1;l.x+=i/n*e*(2/a),l.y+=s/n*e*(2/a),l.alpha=Math.min(l.baseAlpha+e*(l.isNebula?.05:.5),.8)}if(r.shockwaves.length>0&&r.shockwaves.forEach(e=>{let a=l.x-e.x,t=l.y-e.y,r=Math.sqrt(a*a+t*t),o=e.age*e.speed;if(r<o&&r>o-40){let o=2*(1-e.age/e.life);l.x+=a/r*o*5,l.y+=t/r*o*5,l.alpha=Math.min(l.alpha+.3,1)}}),l.alpha>l.baseAlpha&&(l.alpha-=.005),e.globalAlpha=l.alpha,e.beginPath(),l.isNebula){let a=e.createRadialGradient(l.x,l.y,0,l.x,l.y,l.size);a.addColorStop(0,o),a.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=a,e.arc(l.x,l.y,l.size,0,2*Math.PI),e.fill()}else e.fillStyle=o,e.arc(l.x,l.y,l.size,0,2*Math.PI),e.fill()}),e.globalAlpha=1}drawActiveOverlay(e,a){let t,r=this;if(!r.activeId||!r.waveBuffers.fgA)return;for(const e of r.navRects)if(e.id===r.activeId){t=e;break}if(!t)return;const o=Math.max(0,t.x-10),l=Math.min(a,t.x+t.width+10),i=Math.floor(o/2),s=Math.ceil(l/2),n=r.waveBuffers.fgA,h=r.waveBuffers.fgB;e.save(),e.lineCap="round",e.lineJoin="round",e.shadowBlur=20,e.shadowColor="#FFFFFF",e.strokeStyle="#FFFFFF",e.lineWidth=2,e.globalAlpha=.6+.2*Math.sin(3*r.time),e.beginPath(),e.moveTo(2*i,n[i]);for(let a=i+1;a<=s;a++)e.lineTo(2*a,n[a]);e.stroke(),e.beginPath(),e.moveTo(2*i,h[i]);for(let a=i+1;a<=s;a++)e.lineTo(2*a,h[a]);e.stroke(),e.restore()}drawHoverOverlay(e,a){let t,r=this;if(!r.hoverId||!r.waveBuffers.fgA)return;for(const e of r.navRects)if(e.id===r.hoverId){t=e;break}if(!t)return;const o=Math.max(0,t.x-10),l=Math.min(a-3,t.x+t.width+10),i=Math.floor(o/2),s=Math.ceil(l/2),n=r.waveBuffers.fgA,h=r.waveBuffers.fgB,d=r.constructor.colors[r.theme];e.save(),e.lineCap="round",e.lineJoin="round",e.shadowBlur=15,e.shadowColor=d.hover,e.strokeStyle=d.hover,e.lineWidth=2,e.globalAlpha=1,e.beginPath(),e.moveTo(2*i,n[i]);for(let a=i+1;a<=s;a++)e.lineTo(2*a,n[a]);e.stroke(),e.beginPath(),e.moveTo(2*i,h[i]);for(let a=i+1;a<=s;a++)e.lineTo(2*a,h[a]);e.stroke(),e.restore()}drawAmbientBackground(e,a,t){let r=this;if(!r.waveBuffers.bgA)return;let o=.5*r.time,l=t/2,i=.4*t,s=Math.ceil(a/10),n=r.waveBuffers.bgA,h=r.waveBuffers.bgB;for(let e=0;e<s;e++){let a=10*e;n[e]=l+Math.sin(.01*a+o)*i,h[e]=l+Math.sin(.01*a+o+Math.PI)*i}e.fillStyle=r.gradients.bgRibbon,e.beginPath(),e.moveTo(0,n[0]);for(let a=1;a<s;a++)e.lineTo(10*a,n[a]);for(let a=s-1;a>=0;a--)e.lineTo(10*a,h[a]);e.closePath(),e.fill(),e.lineWidth=15,e.lineCap="round",e.lineJoin="round";const d=(a,t)=>{e.strokeStyle=t,e.beginPath(),e.moveTo(0,a[0]);for(let t=1;t<s;t++)e.lineTo(10*t,a[t]);e.stroke()};d(n,r.gradients.bgGrad1),d(h,r.gradients.bgGrad2)}drawAuras(e,a,t){let r=this;if(!Array.isArray(r.navRects))return;const o=r.calculateStrandGeometry(a,t);if(!o)return;const{shimmerA:l,shimmerB:i,count:s}=o,n=r.waveBuffers.fgA,h=r.waveBuffers.fgB,d=r.constructor.colors[r.theme];e.fillStyle=r.gradients.fgRibbon,e.beginPath(),e.moveTo(0,n[0]);for(let a=1;a<s;a++)e.lineTo(2*a,n[a]);for(let a=s-1;a>=0;a--)e.lineTo(2*a,h[a]);e.closePath(),e.fill(),e.lineCap="round",e.lineJoin="round";const c=(a,t,r,o,l)=>{e.beginPath(),e.strokeStyle=l?"#FFFFFF":t,e.lineWidth=l?1:3,e.globalAlpha=l?r+.2:r,l?e.shadowBlur=0:(e.shadowBlur=10,e.shadowColor=o),e.moveTo(0,a[0]);for(let t=1;t<s;t++)e.lineTo(2*t,a[t]);e.stroke()},g=d.grad1[0],f=d.grad2[0];c(n,r.gradients.grad1,l,g,!1),c(h,r.gradients.grad2,i,f,!1),c(n,null,l,null,!0),c(h,null,i,null,!0),e.shadowBlur=0,e.globalAlpha=1}getStreamOffset(e,a,t){let r=this,o=0,l=0,i=0;const s=a/2-10;for(const a of r.navRects){const t=40;if(e>=a.x-t&&e<=a.x+a.width+t){const n=a.width/a.height<1.5,h=a.x+a.width/2,d=a.width/2+t,c=Math.abs(e-h);if(c<d){let e;if(n){let a=c/d;e=Math.pow((1+Math.cos(Math.PI*a))/2,3),i=Math.max(i,e)}else e=(1+Math.cos(Math.PI*c/d))/2;let t=n?a.height/2:a.height/2+4,g=Math.min(t,s);o=Math.max(o,g*e);let f=r.mouse.x-h,u=r.mouse.y-(a.y+a.height/2),b=Math.sqrt(f*f+u*u);b<Math.max(a.width,a.height)&&(l=Math.max(l,1-b/150))}}}return{offsetY:o,intensity:l,isIconZone:i}}drawShockwaves(e,a){let t=this;if(0===t.shockwaves.length)return;const r=t.constructor.colors[t.theme];for(let o=t.shockwaves.length-1;o>=0;o--){let l=t.shockwaves[o];l.age+=1;let i=l.age/l.life;if(i>=1){t.shockwaves.splice(o,1);continue}let s=l.x-l.speed*l.age,n=l.x+l.speed*l.age,h=1-i,{height:d}=t.canvasSize;e.beginPath(),e.strokeStyle=r.shockwave,e.globalAlpha=h,e.lineWidth=4*(1-i),s>0&&(e.moveTo(s,0),e.quadraticCurveTo(s-20,d/2,s,d)),n<a&&(e.moveTo(n,0),e.quadraticCurveTo(n+20,d/2,n,d)),e.stroke(),e.globalAlpha=1}}updateActiveId(e){this.activeId=e?.id||null}updateGraphData(e){}updateHoverId(e){this.hoverId=e?.id||null}onMouseClick(e){this.shockwaves.push({x:e.x,y:e.y,age:0,life:60,speed:15})}updateNavRects(e){let a=e?.rects;Array.isArray(a)?this.navRects=a:this.navRects=[]}updateResources(e,a){let t=this,r=t.context;const o=Math.ceil(e/10)+1;t.waveBuffers.bgA=new Float32Array(o),t.waveBuffers.bgB=new Float32Array(o);const l=Math.ceil(e/2)+1;if(t.waveBuffers.fgA=new Float32Array(l),t.waveBuffers.fgB=new Float32Array(l),!r)return;const i=t.constructor.colors[t.theme],s=r.createLinearGradient(0,0,e,0);s.addColorStop(0,i.grad1[0]),s.addColorStop(.5,i.grad1[1]),s.addColorStop(1,i.grad1[2]),t.gradients.grad1=s;const n=r.createLinearGradient(0,0,e,0);n.addColorStop(0,i.grad2[0]),n.addColorStop(.5,i.grad2[1]),n.addColorStop(1,i.grad2[2]),t.gradients.grad2=n;const h=r.createLinearGradient(0,0,e,0);h.addColorStop(0,i.fgRibbon[0]),h.addColorStop(.5,i.fgRibbon[1]),h.addColorStop(1,i.fgRibbon[2]),t.gradients.fgRibbon=h;const d=r.createLinearGradient(0,0,e,0);d.addColorStop(0,i.background[0]),d.addColorStop(.5,i.background[1]),d.addColorStop(1,i.background[2]),t.gradients.bgGrad1=d;const c=r.createLinearGradient(0,0,e,0);c.addColorStop(0,i.background2[0]),c.addColorStop(.5,i.background2[1]),c.addColorStop(1,i.background2[2]),t.gradients.bgGrad2=c;const g=r.createLinearGradient(0,0,e,0);g.addColorStop(0,i.bgRibbon[0]),g.addColorStop(.5,i.bgRibbon[1]),g.addColorStop(1,i.bgRibbon[2]),t.gradients.bgRibbon=g}});