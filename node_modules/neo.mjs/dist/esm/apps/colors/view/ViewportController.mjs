import t from"../../../src/controller/Component.mjs";export default Neo.setupClass(class extends t{static config={className:"Colors.view.ViewportController"};intervalId=null;async createBrowserWindow(t){if(this.getStateProvider().getData("openWidgetsAsPopups")){let e=this.getReference("dashboard"),a=this.getReference(t),o=await this.component.getDomRect(a.vdom.id);await e.openWidgetInPopup(a,o)}else{let e,{config:a,windowConfigs:o}=Neo,{environment:n}=a,s=Object.keys(o)[0],{basePath:i}=o[s];"development"!==n&&(i=`${i+n}/`),e=`${i}apps/colors/childapps/widget/index.html?name=${t}`,await Neo.Main.windowOpen({url:e,windowName:"_blank"})}}destroy(...t){this.intervalId&&clearInterval(this.intervalId),super.destroy(...t)}onChangeAmountColors(t){this.updateDataProperty(t,"amountColors",t.value)}onChangeAmountColumns(t){this.updateDataProperty(t,"amountColumns",parseInt(t.value.name))}onChangeAmountRows(t){this.updateDataProperty(t,"amountRows",parseInt(t.value.name))}onChangeOpenWidgetsAsPopups(t){this.setState("openWidgetsAsPopups",t.value)}onComponentConstructed(){super.onComponentConstructed(),this.updateWidgets()}async onDetachBarChartButtonClick(t){await this.createBrowserWindow("bar-chart")}async onDetachGridButtonClick(t){await this.createBrowserWindow("grid")}async onDetachPieChartButtonClick(t){await this.createBrowserWindow("pie-chart")}async onEnableWindowManagementClick(t){let e=await Neo.main.addon.DragDrop.requestWindowManagementPermission({windowId:this.windowId}),a=this.getReference("window-management-button");e.success?(a.text="W-M enabled",a.iconCls="fa fa-check-square",a.disabled=!0):(a.text="W-M disabled",a.iconCls="fa fa-exclamation-triangle")}onStartButtonClick(t){let e=this,a=1e3/60;e.setState({isUpdating:!0}),e.intervalId||(e.intervalId=setInterval(()=>{e.updateWidgets()},a))}onStopButtonClick(t){let e=this;e.setState({isUpdating:!1}),e.intervalId&&(clearInterval(e.intervalId),e.intervalId=null)}updateCharts(t){this.getReference("bar-chart").chartData=t,this.getReference("pie-chart").chartData=t}updateDataProperty(t,e,a){let o=this.getStateProvider();o.setData(e,a),null===t.oldValue||o.getData("isUpdating")||this.updateWidgets()}updateGrid(t){let e=this.getReference("grid"),{store:a}=e;a.getCount()?e.bulkUpdateRecords(t):this.getStateProvider().getData("amountRows")===t.length&&(a.data=t)}async updateWidgets(){let t,e=this,a=e.getStateProvider();if(Colors.backend){if(t=await Colors.backend.ColorService.read({amountColors:a.getData("amountColors"),amountColumns:a.getData("amountColumns"),amountRows:a.getData("amountRows")}),!e.isDestroyed){let{data:a}=t;e.updateGrid(a.tableData),e.updateCharts(a.summaryData)}}else await e.timeout(50),e.updateWidgets()}});