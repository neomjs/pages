import t from"../../../../src/grid/Container.mjs";import e from"./component/Heuristics.mjs";const i=/^(c|p|pu)?y\d{4}$/;export default Neo.setupClass(class extends t{static config={className:"DevIndex.view.home.GridContainer",animateVisuals_:!0,cls:["devindex-grid-container"],dataMode_:"total",body:{bufferColumnRange:1,bufferRowRange:1,listeners:{isScrollingChange:"onGridIsScrollingChange"}},columnDefaults:{cellAlign:"left",defaultSortDirection:"DESC",width:150},rowHeight:50};construct(t){super.construct(t),this.buildDynamicColumns()}afterSetDataMode(t,e){if(void 0===e)return;let l=this,{footerToolbar:o}=l,{store:r}=l,a=r.sorters?.[0];if(o&&(o.dataMode=t),l.columns.items.forEach(e=>{let l,{dataField:o}=e;if(i.test(o)){let e=o.slice(-4),i="";"commits"===t?i="c":"private"===t?i="p":"public"===t&&(i="pu"),l=i+"y"+e}else if(["totalContributions","totalCommits","totalPrivateContributions","totalPublicContributions"].includes(o))switch(t){case"commits":l="totalCommits";break;case"private":l="totalPrivateContributions";break;case"public":l="totalPublicContributions";break;default:l="totalContributions"}else"activity"===o&&(e.component=({record:e})=>{const i=[],l=(new Date).getFullYear();for(let o=2010;o<=l;o++){let l=0;l="commits"===t?e[`cy${o}`]||0:"private"===t?e[`py${o}`]||0:"public"===t?e[`puy${o}`]||0:e[`y${o}`]||0,i.push(l)}return{values:i}});l&&l!==o&&(e.dataField=l)}),a){let{property:e}=a;if(i.test(e)){let i=e.slice(-4),l="";"commits"===t?l="c":"private"===t?l="p":"public"===t&&(l="pu"),a.property=l+"y"+i}else if(["totalContributions","totalCommits","totalPrivateContributions","totalPublicContributions"].includes(e))switch(t){case"commits":a.property="totalCommits";break;case"private":a.property="totalPrivateContributions";break;case"public":a.property="totalPublicContributions";break;default:a.property="totalContributions"}}l.body.createViewData(!1,!0)}buildDynamicColumns(){const t=(new Date).getFullYear(),i=[{type:"index",dataField:"id",text:"#",width:60,cellAlign:"right"},{type:"githubUser",dataField:"login",text:"User",width:250},{dataField:"totalContributions",text:"Total",width:100,cellAlign:"right",defaultSortDirection:"DESC",renderer:({value:t})=>(new Intl.NumberFormat).format(t)},{dataField:"commitRatio",text:"Commits %",width:90,cellAlign:"right",defaultSortDirection:"DESC",renderer:({value:t})=>(t||0).toFixed(2)},{dataField:"privateContributionsRatio",text:"Private %",width:90,cellAlign:"right",defaultSortDirection:"DESC",renderer:({value:t})=>t?t.toFixed(2):""},{type:"component",dataField:"heuristics",text:"Impact",width:100,component:({record:t})=>({module:e,heuristics:t.heuristics||t.hm})},{dataField:"activity",text:`Activity (${t-2010+1}y)`,width:160,type:"sparkline",useBindings:!0,component:({record:e})=>{const i=[];for(let l=2010;l<=t;l++)i.push(e[`y${l}`]||0);return{bind:{usePulse:t=>t.animateGridVisuals},values:i}}},{type:"iconLink",dataField:"topRepo",cellIconCls:"fa-brands fa-github",labelFormatter:t=>t?.[1]?(new Intl.NumberFormat).format(t[1]):null,text:"Top Repo",urlFormatter:t=>t?`https://github.com/${t[0]}`:null,width:100},{dataField:"company",text:"Company",width:200,renderer:({value:t})=>t?t.replace(/^@/,""):""},{type:"countryFlag",dataField:"countryCode",sortable:!1,text:"Location",width:200},{type:"iconLink",cellAlign:"center",dataField:"website",cellCls:"devindex-column-website",cellIconCls:"fa fa-home",text:"Website",width:65},{type:"linkedin",cellAlign:"center",dataField:"linkedinUrl",cellCls:"devindex-column-linkedin",text:"LI",width:40},{type:"icon",cellAlign:"center",dataField:"isHireable",cellCls:"devindex-column-hireable",cellIconCls:"fas fa-circle-check",text:"Hireable",width:65},{type:"iconLink",cellAlign:"center",dataField:"twitter",cellCls:"devindex-column-twitter",cellIconCls:"fa-brands fa-x-twitter",text:"X",urlFormatter:t=>t?String(t).startsWith("http")?t:`https://x.com/${t}`:null,width:40},{type:"githubOrgs",dataField:"organizations",text:"Orgs",width:150},{dataField:"followers",text:"Followers",width:100,cellAlign:"right",renderer:({value:t})=>t?(new Intl.NumberFormat).format(t):"-"},{type:"iconLink",cellAlign:"center",cellCls:"devindex-column-sponsors",dataField:"hasSponsors",cellIconCls:"fa-regular fa-heart",labelFormatter:t=>null!=t?String(t):null,text:"Sponsors",urlFormatter:(t,e)=>null!=t?`https://github.com/sponsors/${e.login}`:null,width:80},{dataField:"firstYear",text:"Since",width:80,cellAlign:"center"}];for(let e=t;e>=2010;e--)i.push({dataField:`y${e}`,text:String(e),width:80,cellAlign:"center",renderer:({value:t})=>t||"",cellCls:({value:t})=>{let e=["neo-heatmap"];return t?t<100?e.push("heatmap-cell-1"):t<1e3?e.push("heatmap-cell-2"):e.push("heatmap-cell-3"):e.push("heatmap-cell-0"),e}});i.push({dataField:"lastUpdated",text:"Updated",width:120,cellAlign:"right",renderer:({value:t})=>new Date(t).toISOString().split("T")[0]}),this.columns=i}onSortColumn(t){let e=this,{dataMode:l}=e,o={...t};if("topRepo"===o.property&&(o.property="topRepoCount"),"total"!==l)if(i.test(o.property)){let t=o.property.slice(-4),e="";"commits"===l?e="c":"private"===l?e="p":"public"===l&&(e="pu"),e&&(o.property=e+"y"+t)}else if("totalContributions"===o.property)switch(l){case"commits":o.property="totalCommits";break;case"private":o.property="totalPrivateContributions";break;case"public":o.property="totalPublicContributions"}e.store.sort(o),e.removeSortingCss(t.property)}});