import e from"../util/Array.mjs";import t from"../container/Panel.mjs";import a from"./header/Toolbar.mjs";import i from"../util/VDom.mjs";let o;export default Neo.setupClass(class extends t{static closeActions=["close","hide"];static config={className:"Neo.dialog.Base",ntype:"dialog",animateOnDragEnd:!1,animateTargetId_:null,autoMount:!0,autoRender:!0,autoShow:!0,baseCls:["neo-dialog","neo-panel","neo-container"],boundaryContainerId:"document.body",closeAction:"close",draggable_:!0,dragListenersAdded:!1,dragZone:null,dragZoneConfig:null,floating:!0,headerConfig:null,headerToolbar:null,isDragging:!1,keys:{Escape:"onKeyDownEscape"},maximizeCls:"far fa-window-maximize",maximized_:!1,minimizeCls:"far fa-window-minimize",modal_:!1,resizable_:!0,resizablePluginConfig:null,title_:null,trapFocus_:!1};get animateTarget(){return Neo.getComponent(this.animateTargetId)}construct(e){super.construct(e),this.createHeader()}afterSetAnimateTargetId(e,t){this.autoMount=!e,this.autoRender=!e}afterSetAppName(e,t){let a=this,i=a.getPlugin("resizable");a.dragZone&&(a.dragZone.appName=e),i&&(i.appName=e),super.afterSetAppName(e,t)}afterSetDraggable(t,a){let i,d=this;void 0!==a&&d.headerToolbar&&(i=d.headerToolbar.cls,e[t?"add":"remove"](i,"neo-draggable"),d.headerToolbar.cls=i),t&&import("../draggable/DragZone.mjs").then((e=>{if(o=e.default,!d.dragListenersAdded){const e=[{"drag:end":d.onDragEnd,scope:d,delegate:".neo-header-toolbar"},{"drag:start":d.onDragStart,scope:d,delegate:".neo-header-toolbar"}];d.dragZoneConfig?.alwaysFireDragMove&&e.push({"drag:move":d.onDragMove,scope:d,delegate:".neo-header-toolbar"}),d.domListeners=[...d.domListeners,...e],d.dragListenersAdded=!0}}))}async afterSetMaximized(t,a){let i=this,o=void 0===a,{cls:d}=i.vdom;!o&&e.add(d,"animated-hiding-showing"),e.toggle(d,"neo-maximized",t),i.update(),o||(await i.timeout(250),e.remove(d,"animated-hiding-showing"),i.update())}afterSetModal(t,a){let i=this;e.toggle(i.vdom.cls,"neo-modal",t),i.update(),i.rendered&&i.syncModalMask()}afterSetMounted(e,t){super.afterSetMounted(e,t),void 0!==t&&this.syncTrapFocus()}afterSetResizable(e,t){e&&!this.getPlugin("resizable")&&import("../plugin/Resizable.mjs").then((e=>{let t=this,{appName:a}=t,i=t.plugins||[];i.push({module:e.default,appName:a,delegationCls:"neo-dialog",...t.resizablePluginConfig}),t.plugins=i}))}afterSetTitle(e,t){let{headerToolbar:a}=this;a&&(a.title=e)}afterSetTrapFocus(e,t){this.syncTrapFocus()}afterSetWindowId(e,t){let a=this,i=a.getPlugin("resizable");a.dragZone&&(a.dragZone.windowId=e),i&&(i.windowId=e),super.afterSetWindowId(e,t)}async animateHide(){let e,t,a=this,{animateTarget:i,id:o}=a;a.windowId=i.windowId,a.appName=e=i.appName,t=await a.getDomRect([o,a.animateTargetId]),await Neo.applyDeltas(e,{id:o,style:{height:`${t[0].height}px`,left:`${t[0].left}px`,top:`${t[0].top}px`,transform:"none",width:`${t[0].width}px`}}),await a.timeout(30),await Neo.applyDeltas(e,{id:o,cls:{add:["animated-hiding-showing"]},style:{height:`${t[1].height}px`,left:`${t[1].left}px`,top:`${t[1].top}px`,width:`${t[1].width}px`}}),await a.timeout(250),a.closeOrHide(!1),"hide"===a.closeAction&&await Neo.applyDeltas(e,{id:o,action:"removeNode"})}async animateShow(){let e,t,a=this,{animateTarget:i,id:o,style:d}=a;if(a.windowId=i.windowId,a.appName=e=i.appName,t=await a.getDomRect(a.animateTargetId),d.left||d.top){let e={...d};delete d.left,delete d.top,a.style=d,a._style=d=e}await a.render(!0);let[n,r]=await a.waitForDomRect({id:[a.id,"document.body"]});await Neo.applyDeltas(e,{id:o,style:{height:`${t.height}px`,left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`}}),await a.timeout(50),await Neo.applyDeltas(e,{id:o,cls:{add:["animated-hiding-showing"]},style:{height:d?.height||`${n.height}px`,left:d?.left||`${Math.round(r.width/2-n.width/2)}px`,top:d?.top||`${Math.round(r.height/2-n.height/2)}px`,width:d?.width||`${n.width}px`}}),await a.timeout(200),await Neo.applyDeltas(e,{id:o,cls:{remove:["animated-hiding-showing"]}}),a.show(!1)}beforeSetCloseAction(e,t){return this.beforeSetEnumValue(e,t,"closeAction")}close(e=!!this.animateTargetId){let t=this;t.revertFocus(),e?t.animateHide():(t.fire("close"),t.destroy(!0))}async closeOrHide(e=!!this.animateTargetId){let t=this;t[t.closeAction](e),await t.timeout(30),t.syncModalMask(t.id)}closeOrHideAction(e){this.closeOrHide()}createHeader(){let e=this,{appName:t,windowId:i}=e,o=["neo-header-toolbar","neo-toolbar"],d=e.headers||[];e.draggable&&o.push("neo-draggable"),e.headerToolbar=Neo.create({module:a,appName:t,cls:o,dock:"top",flex:"none",id:e.getHeaderToolbarId(),listeners:{headerAction:e.executeHeaderAction,scope:e},title:e.title,windowId:i,...e.headerConfig}),d.unshift(e.headerToolbar),e.headers=d}executeHeaderAction(e){let t=this,a={close:t.closeOrHideAction,maximize:t.maximize};a[e.action]?.call(t,e),t.fire("headerAction",{dialog:t,...e})}getAnimateTargetId(){return this.id+"-animate"}getHeaderToolbarId(){return this.id+"-header-toolbar"}getProxyVdom(){return i.clone(this.vdom)}async hide(e=!!this.animateTargetId){let t=this;e?t.animateHide():(t.unmount(),t.fire("hide")),await t.timeout(30),t.syncModalMask()}init(){super.init();let e=this;e.animateTargetId?e.autoShow&&e.show():e.timeout(100).then((()=>{e.syncModalMask()}))}maximize(e){let t=this;e.component.iconCls=t.maximized?t.maximizeCls:t.minimizeCls,t.maximized=!t.maximized}onConstructed(){super.onConstructed();let e=this;e.headerToolbar=e.down({id:e.getHeaderToolbarId()})}onDragEnd(e){let t,a,i=this;i.maximized||i.getDomRect(i.dragZone.dragProxy.id).then((o=>{a=i.style,Object.assign(a,{height:`${o.height}px`,left:`${o.left}px`,opacity:1,top:`${o.top}px`,transform:"none",width:`${o.width}px`}),i.animateOnDragEnd||(t=a.transitionProperty||null,a.transitionProperty="none",i.timeout(50).then((()=>{a=i.style,a.transitionProperty=t,i.style=a}))),i.style=a,i.dragZone.dragEnd(e),i.dragZone.boundaryContainerId=null,i.isDragging=!1,i.focus(i.id,!0)}))}onDragMove(e){this.dragZone.dragMove(e)}onDragStart(e){let t=this,{appName:a,id:i,windowId:d}=t,n=t.style||{};t.maximized||(t.isDragging=!0,t.getPlugin("resizable")?.removeAllNodes(),t.dragZone?t.dragZone.boundaryContainerId=t.boundaryContainerId:(t.dragZone=Neo.create({module:o,appName:a,bodyCursorStyle:"move !important",boundaryContainerId:t.boundaryContainerId,dragElement:t.vdom,dragProxyConfig:{vdom:t.getProxyVdom()},owner:t,useProxyWrapper:!1,windowId:d,...t.dragZoneConfig}),t.fire("dragZoneCreated",{dragZone:t.dragZone,id:i})),t.dragZone.dragStart(e),n.opacity=.7,t.style=n)}onKeyDownEscape(){this.hidden=!0}async render(e){let t=this,{wrapperStyle:a}=t;t.animateTargetId||(a.left||(a.left="initial"),a.top||(a.top="initial"),t.wrapperStyle=a),await super.render(e)}show(e=!!this.animateTargetId){let t=this;e?t.animateShow():(t.mounted||t.render(!0),t.fire("show")),t.syncModalMask()}syncModalMask(e=this.id){let{modal:t,windowId:a}=this;Neo.main.DomAccess.syncModalMask({id:e,modal:t,windowId:a})}syncTrapFocus(){let e=this,{id:t,windowId:a}=e;e.mounted&&Neo.main.DomAccess.trapFocus({id:t,trap:e.trapFocus,windowId:a})}});