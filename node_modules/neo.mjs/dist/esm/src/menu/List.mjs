import e from"../list/Base.mjs";import t from"../selection/menu/ListModel.mjs";import n from"./Store.mjs";class u extends e{static config={className:"Neo.menu.List",ntype:"menu-list",activeSubMenu:null,baseCls:["neo-menu-list","neo-list"],focusTimeoutId:null,hideOnLeafItemClick:!0,items_:null,menuFocus_:!1,isRoot:!0,parentIndex:0,parentMenu:null,selectionModel:t,store:n,subMenuGap:0,subMenuMap:null,zIndex_:100,_vdom:{tag:"ul",cn:[]}};parentComponent=null;afterSetItems(e,t){let{store:n}=this;t&&n.clear(),e&&n.add(e)}afterSetMenuFocus(e,t){if(void 0!==t){let t=this;t.isRoot?e?(clearTimeout(t.focusTimeoutId),t.focusTimeoutId=null):t.focusTimeoutId=setTimeout((()=>{t[t.floating?"unmount":"hideSubMenu"]()}),20):t.parentMenu.menuFocus=e}}afterSetTheme(e,t){super.afterSetTheme(e,t),Object.values(this.subMenuMap||{}).forEach((t=>{t.theme=e}))}afterSetZIndex(e,t){this.style={...this.style,zIndex:e}}createItemContent(e,t){let n=this,{iconCls:u}=e,o=e[n.store.keyProperty],s=[{tag:"span",cls:["neo-content"],html:e[n.displayField]}];return u&&""!==u&&s.unshift({tag:"i",cls:["neo-menu-icon","neo-icon",u],id:n.getIconId(o)}),n.hasChildren(e)&&s.push({tag:"i",cls:["neo-arrow-icon","neo-icon","fas fa-chevron-right"],id:n.getArrowIconId(o)}),s}destroy(...e){let{activeSubMenu:t}=this,n=this.subMenuMap||{};t?.unmount(),Object.entries(n).forEach((([e,t])=>{t.destroy(),n[e]=null})),super.destroy(...e)}getArrowIconId(e){return`${this.id}__arrow_icon__${e}`}getIconId(e){return`${this.id}__icon__${e}`}getMenuMapId(e){return`menu__${e}`}hasChildren(e){return Array.isArray(e.items)&&e.items.length>0}hideSubMenu(){let{activeSubMenu:e}=this;e&&(e.unmount(),this.activeSubMenu=null)}onFocusEnter(e){super.onFocusEnter(e),this.menuFocus=!0}onFocusLeave(e){super.onFocusLeave(e);let t,n=!1,u=this.parentComponent?.id;if(u)for(t of e.oldPath)if(t.id===u){n=!0;break}n||(this.menuFocus=!1)}onItemClick(e,t){super.onItemClick(e,t),this.onKeyDownEnter(e.id)}onKeyDownEnter(e){if(e){let t,n=this,u=n.getItemRecordId(e),o=n.store.get(u);n.callback(o.handler,n,[o]),o.route&&Neo.Main.setRoute({appName:n.appName,value:o.route}),n.hideOnLeafItemClick&&!o.items&&n.unmount(),o.items&&(t=n.subMenuMap?.[n.getMenuMapId(u)],t&&n.toggleSubMenu(e,o))}}onKeyDownEscape(e){this.floating&&this.unmount()}onSelect(e){let t=this,n=e[0],u=t.getItemRecordId(n),o=t.store.get(u);t.activeSubMenu!==t.subMenuMap?.[t.getMenuMapId(u)]&&(t.hideSubMenu(),t.hasChildren(o)&&t.showSubMenu(n,o))}showSubMenu(e,t){const n=this,{store:o}=n,s=t[o.keyProperty],i=n.subMenuMap||(n.subMenuMap={}),a=n.getMenuMapId(s),r=i[a]||(i[a]=Neo.create({module:u,align:{target:e,edgeAlign:"l0-r0",axisLock:!0,targetMargin:n.subMenuGap},appName:n.appName,displayField:n.displayField,floating:!0,items:t.items,isRoot:!1,parentComponent:n.parentComponent,parentId:Neo.apps[n.appName].mainView.id,parentIndex:o.indexOf(t),parentMenu:n,theme:n.theme,zIndex:n.zIndex+1}));n.activeSubMenu!==r&&(n.activeSubMenu=r,r.render(!0))}toggleSubMenu(e,t){let n=this,u=t[n.getKeyProperty()],o=n.subMenuMap?.[n.getMenuMapId(u)];o?.mounted?n.hideSubMenu():n.showSubMenu(e,t)}unmount(){this.selectionModel?.deselectAll(!0),this.hideSubMenu(),super.unmount()}}export default Neo.setupClass(u);