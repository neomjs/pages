import e from"./Model.mjs";import t from"../util/Array.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.selection.HelixModel",ntype:"selection-helixmodel",cls:"neo-selection-helixmodel",stayInColumn:!1};addDomListener(){}onContainerClick(){let e=this,{view:t}=e,o=[...e.items],n=[];e.items.forEach((e=>{n.push({id:t.getItemVnodeId(e),cls:{add:[],remove:["neo-selected"]}})})),e.items.splice(0,e.items.length),Neo.applyDeltas(t.appName,n).then((()=>{e.fire("selectionChange",e.items,o)}))}onItemClick(e){let t,o=0,n=e.path.length,{view:s}=this;for(;o<n;o++)if(e.path[o].cls.includes("neo-helix-item")){t=s.getItemId(e.path[o].id),this.select(t),s.fire("select",{record:s.store.get(t)});break}}onKeyDownDown(e){this.onNavKeyColumn(1)}onKeyDownLeft(e){this.onNavKeyRow(-1)}onKeyDownRight(e){this.onNavKeyRow(1)}onKeyDownUp(e){this.onNavKeyColumn(-1)}onNavKeyColumn(e=1){let t,o,n=this,{stayInColumn:s,view:i}=n,{store:l}=i,c=n.items[0],r=l.getCount(),m=parseInt(360/i.itemAngle);if(e*=m,t=c?l.indexOf(c)+e:0,t<0)for(s||t++;t<r-m;)t+=m;else if(t>=r)for(s||t--;t>=m;)t-=m;o=l.getAt(t),n.select(o[l.keyProperty]),i.fire("select",{record:o})}onNavKeyRow(e=1){let t,o,n=this,{view:s}=n,{store:i}=s,l=n.items[0],c=i.getCount();t=l?i.indexOf(l)+e:0,t<0?t=c-1:t>=c&&(t=0),o=i.getAt(t),n.select(o[i.keyProperty]),s.fire("select",{record:o})}register(e){super.register(e);let t=this,{id:o,view:n}=t;n.on({containerClick:t.onContainerClick,itemClick:t.onItemClick,scope:t}),n.keys?._keys.push({fn:"onKeyDownDown",key:"Down",scope:o},{fn:"onKeyDownLeft",key:"Left",scope:o},{fn:"onKeyDownRight",key:"Right",scope:o},{fn:"onKeyDownUp",key:"Up",scope:o})}select(e,o=!0){let n=this,s=n.view,i=!1!==o&&n.items.includes(e),l=n.items,c=[...l],r=[];s&&(s.mounted||s.on("mounted",(()=>{n.timeout(300).then((()=>{n.select(e,o)}))}),n,{once:!0}),n.singleSelect&&(l.forEach((t=>{t.id!==e&&r.push({id:s.getItemVnodeId(t),cls:{add:[],remove:["neo-selected"]}})})),l.splice(0,l.length)),r.push({id:s.getItemVnodeId(e),cls:{add:i?[]:["neo-selected"],remove:i?["neo-selected"]:[]}}),t[i?"remove":"add"](l,e),s.mounted&&Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:s.appName,deltas:r}).then((()=>{s.onSelect?.(l),n.fire("selectionChange",l,c)})))}unregister(){let e=this.id,t=this.view;t.keys?.removeKeys([{fn:"onKeyDownDown",key:"Down",scope:e},{fn:"onKeyDownLeft",key:"Left",scope:e},{fn:"onKeyDownRight",key:"Right",scope:e},{fn:"onKeyDownUp",key:"Up",scope:e}]),super.unregister()}});