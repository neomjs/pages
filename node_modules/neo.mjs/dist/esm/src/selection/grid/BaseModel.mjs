import e from"../Model.mjs";import t from"../../util/Array.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.selection.grid.BaseModel",selectedColumns:[],selectedRows:[]};get dataFields(){return this.view.parent.columns.items.map(e=>e.dataField)}updateRows(e,s=!1){if(!e||0===e.length)return;Array.isArray(e)||(e=[e]);let l=this,{view:i}=l,{store:o}=i,d=new Set;e.forEach(e=>{let r,c,n=!1;if(e.toString().includes("__")){let o=i.getRecordFromLogicalId(e);if(o&&(c=i.getRow(o),c&&!d.has(e))){d.add(e);let o=i.getDataField(e),r=c.vdom.cn.find(e=>e.data?.field===o),a=l.isSelected(e),w=r?.cls?.includes(l.selectedCls);r&&a!==w&&(t[a?"add":"remove"](r.cls,l.selectedCls),a?r["aria-selected"]=!0:delete r["aria-selected"],n=!0),n&&!s&&c.update()}}else if(r=e,!d.has(r)){d.add(r);let e=o.get(r);if(e&&(c=i.getRow(e),c)){let e=l.isSelectedRow(r),i=c.vdom.cls?.includes(l.selectedCls);e!==i&&(t[e?"add":"remove"](c.vdom.cls,l.selectedCls),e?c.vdom["aria-selected"]=!0:delete c.vdom["aria-selected"],n=!0),n&&!s&&c.update()}}})}deselect(e,t,s,l){let i=this;i.view.silentSelect=!0,super.deselect(e,t,s,l),i.view.silentSelect=!1,t||i.updateRows(e)}deselectAll(e,t){let s=this,l=[...t||s.items];s.view.silentSelect=!0,super.deselectAll(e,t),s.view.silentSelect=!1,s.updateRows(l)}select(e,t,s){let l=this;l.view.silentSelect=!0,super.select(e,t,s),l.view.silentSelect=!1,l.updateRows(e)}deselectAllRows(e=!1){let t=this,s=[...t.selectedRows];s.length?(s.forEach(e=>{t.deselectRow(e,!0)}),e||t.updateRows(s),t.fire("selectionChange",{records:t.selectedRows.map(e=>t.view.store.get(e)),selection:t.selectedRows})):e||t.fire("noChange")}deselectRow(e,s=!1){t.remove(this.selectedRows,e),this.updateRows(e,s)}getRecord(e){let t,s;for(t of e)if(t.aria?.rowindex)return s=parseInt(t.aria.rowindex),s-=2,this.view.store.getAt(s);return null}getRowRecord(e){if(!e)return null;let{view:t}=this,{store:s}=t,l=s.get(e);if(l)return l;if(t.items){let s=t.items.find(s=>s.record&&t.getRecordId(s.record)===e);if(s)return s.record}return null}getRowComponent(e){return this.view.items.find(t=>t.record&&this.view.store.getKey(t.record)===e)||null}hasAnnotations(e){return!!Object.getOwnPropertyDescriptor(e.__proto__,this.view.selectedRecordField)}hasEditorFocus({path:e}){for(const t of e)if(t.cls?.includes("neo-grid-editor"))return!0;return!1}isSelectedColumn(e){return this.selectedColumns.includes(e)}isSelectedRow(e){return this.selectedRows.includes(e)}selectRow(e,s=!1){let l=this;l.singleSelect&&[...l.selectedRows].forEach(e=>l.deselectRow(e)),t.add(l.selectedRows,e),l.updateRows(e,s)}toggleRowSelection(e,t=!1){this[this.isSelectedRow(e)?"deselectRow":"selectRow"](e,t)}toJSON(){return{...super.toJSON(),selectedColumns:this.selectedColumns,selectedRows:this.selectedRows}}unregister(){let e=this,t=e.selectedRows.length;e.selectedRows=[],t>0&&e.view.createViewData(),super.unregister()}});