import e from"./TreeModel.mjs";import t from"../util/Array.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.selection.TreeAccordionModel",ntype:"selection-treeaccordionmodel"};checkForChild(e){let{view:t}=this,o=e[t.getKeyProperty()],l=null;for(let e=0;e<t.store.count;e++){const r=t.store.getAt(e);if(r.parentId===o){l=r;break}}return l}checkForParent({parentId:e}){return e?this.view.store.get(e):null}checkForSibling(e,t){let o,{view:l}=this,{store:r}=l,i=e.parentId,s=e[l.getKeyProperty()],c=!1,n=null;for(let e=0;e<r.count;e++){const d=r.getAt(e);if(c&&d.parentId===i){n=d;break}if(!c&&d.parentId===i)if(c||d[l.getKeyProperty()]!==s)o=d;else{if(-1===t)break;c=!0}}return 1===t?n:o||r.get(i)}checkNextParentSibling(e){let t=this,o=t.view.store.get(e.parentId),l=t.checkForSibling(o,1);return!l&&o.parentId&&t.checkNextParentSibling(o),l}onKeyDownEnter(e){let t=this,{view:o}=t,l=t.getSelection()[0],r=o.store.get(o.getItemRecordId(l));r.isLeaf||r.collapsed?t.onKeyDownRight(e):t.onKeyDownLeft(e)}onKeyDownEscape(e){this.deselectAll()}onKeyDownLeft(e){let t,o=this,{view:l}=o,r=o.getSelection()[0];r?(t=l.store.get(l.getItemRecordId(r)),t.isLeaf||t.collapsed||!l.rootParentsAreCollapsible?o.onNavKey(e,-1):o.toggleCollapsed(t,r,!0)):o.selectRoot()}onKeyDownRight(e){let t,o=this,{view:l}=o,r=o.getSelection()[0];r?(t=l.store.get(l.getItemRecordId(r)),t.isLeaf||!t.collapsed?o.onNavKey(e,1):o.toggleCollapsed(t,r,!1)):o.selectRoot()}onNavKey(e,t){let o,l,r,i=this,{view:s}=i,c=i.getSelection()[0];if(c?(r=s.getItemRecordId(c),l=s.store.get(r),1===t?(l.isLeaf||l.collapsed?(o=i.checkForSibling(l,t),o||(o=i.checkNextParentSibling(l))):o=i.checkForChild(l),o||(i.deselectAll(),s.fire("selectPostLastItem"))):-1===t&&(o=i.checkForSibling(l,t),o||(o=i.checkForParent(l)),o||(i.deselectAll(),s.fire("selectPreFirstItem")))):i.selectRoot(),o){const e=s.getItemId(o[i.view.getKeyProperty()]);i.selectAndScrollIntoView(e)}}selectAndScrollIntoView(e){this.select(e),Neo.main.DomAccess.scrollIntoView({id:e,block:"center",windowId:this.view.windowId})}selectRoot(){let e,{view:t}=this,{store:o}=t;for(let l=0;l<o.count;l++){const r=o.getAt(l);if(!r.parentId){e=t.getItemId(r[t.getKeyProperty()]);break}}this.selectAndScrollIntoView(e)}toggleCollapsed(e,o,l){let r=this.view.getVdomChild(o);t[l?"remove":"add"](r.cls,"neo-folder-open"),this.view.update(),e.collapsed=l}});