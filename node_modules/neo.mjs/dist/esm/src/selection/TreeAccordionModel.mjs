import e from"./TreeModel.mjs";import t from"../util/Array.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.selection.TreeAccordionModel",ntype:"selection-treeaccordionmodel"};checkForChild(e){let{view:t}=this,o=e[t.getKeyProperty()],l=null;for(const e of t.store.items)if(e.parentId===o){l=e;break}return l}checkForParent({parentId:e}){return e?this.view.store.get(e):null}checkForSibling(e,t){let o,{view:l}=this,{store:i}=l,r=e.parentId,s=e[l.getKeyProperty()],c=!1,n=null;for(let e of i.items){if(c&&e.parentId===r){n=e;break}if(!c&&e.parentId===r)if(c||e[l.getKeyProperty()]!==s)o=e;else{if(-1===t)break;c=!0}}return 1===t?n:o||i.get(r)}checkNextParentSibling(e){let t=this,o=t.view.store.get(e.parentId),l=t.checkForSibling(o,1);return!l&&o.parentId&&t.checkNextParentSibling(o),l}onKeyDownEnter(e){let t=this,{view:o}=t,l=t.getSelection()[0],i=o.store.get(o.getItemRecordId(l));i.isLeaf||i.collapsed?t.onKeyDownRight(e):t.onKeyDownLeft(e)}onKeyDownEscape(e){this.deselectAll()}onKeyDownLeft(e){let t,o=this,{view:l}=o,i=o.getSelection()[0];i?(t=l.store.get(l.getItemRecordId(i)),t.isLeaf||t.collapsed||!l.rootParentsAreCollapsible?o.onNavKey(e,-1):o.toggleCollapsed(t,i,!0)):o.selectRoot()}onKeyDownRight(e){let t,o=this,{view:l}=o,i=o.getSelection()[0];i?(t=l.store.get(l.getItemRecordId(i)),t.isLeaf||!t.collapsed?o.onNavKey(e,1):o.toggleCollapsed(t,i,!1)):o.selectRoot()}onNavKey(e,t){let o,l,i,r=this,{view:s}=r,c=r.getSelection()[0];if(c?(i=s.getItemRecordId(c),l=s.store.get(i),1===t?(l.isLeaf||l.collapsed?(o=r.checkForSibling(l,t),o||(o=r.checkNextParentSibling(l))):o=r.checkForChild(l),o||(r.deselectAll(),s.fire("selectPostLastItem"))):-1===t&&(o=r.checkForSibling(l,t),o||(o=r.checkForParent(l)),o||(r.deselectAll(),s.fire("selectPreFirstItem")))):r.selectRoot(),o){const e=s.getItemId(o[r.view.getKeyProperty()]);r.selectAndScrollIntoView(e)}}selectAndScrollIntoView(e){this.select(e),Neo.main.DomAccess.scrollIntoView({id:e,block:"center",windowId:this.view.windowId})}selectRoot(){let e,t,{view:o}=this,{store:l}=o;for(e of l.items)if(!e.parentId){t=o.getItemId(e[o.getKeyProperty()]);break}this.selectAndScrollIntoView(t)}toggleCollapsed(e,o,l){let i=this.view.getVdomChild(o);t[l?"remove":"add"](i.cls,"neo-folder-open"),this.view.update(),e.collapsed=l}});