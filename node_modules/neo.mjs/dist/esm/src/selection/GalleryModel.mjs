import e from"./Model.mjs";import t from"../util/Array.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.selection.GalleryModel",ntype:"selection-gallerymodel",cls:"neo-selection-gallerymodel",stayInRow:!1};addDomListener(){}onContainerClick(){let e=this,{view:t}=e,o=[...e.items],n=[];e.items.forEach(e=>{n.push({id:t.getItemVnodeId(e),cls:{add:[],remove:["neo-selected"]}})}),e.items.splice(0,e.items.length),Neo.applyDeltas(t.windowId,n).then(()=>{e.fire("selectionChange",e.items,o)})}onItemClick(e){let t,o=0,n=e.path.length,{view:s}=this;for(;o<n;o++)if(e.path[o].cls.includes("neo-gallery-item")){t=s.getItemId(e.path[o].id),this.select(t),s.fire("select",{record:s.store.get(t)});break}}onKeyDownDown(e){this[this.view.orderByRow?"onNavKeyRow":"onNavKeyColumn"](1)}onKeyDownLeft(e){this[this.view.orderByRow?"onNavKeyColumn":"onNavKeyRow"](-1)}onKeyDownRight(e){this[this.view.orderByRow?"onNavKeyColumn":"onNavKeyRow"](1)}onKeyDownUp(e){this[this.view.orderByRow?"onNavKeyRow":"onNavKeyColumn"](-1)}onNavKeyColumn(e=1){let t,o,n=this,{view:s}=n,{store:i}=s,l=n.items[0],r=s.maxItems?Math.min(s.maxItems,i.getCount()):i.getCount();l?(o=i.get(l),t=i.indexOf(o)+e):t=0,t<0?t=r-1:t>=r&&(t=0),o=i.getAt(t),n.select(s.getRecordId(o)),s.fire("select",{record:o})}onNavKeyRow(e=1){let t,o,n=this,{stayInRow:s,view:i}=n,{amountRows:l,store:r}=i,a=n.items[0],c=i.maxItems?Math.min(i.maxItems,r.getCount()):r.getCount();if(i.orderByRow&&(l=Math.ceil(i.store.getCount()/l)),e*=l,a?(o=r.get(a),t=r.indexOf(o)+e):t=0,t<0)for(s||t++;t<c-l;)t+=l;else if(t>=c)for(s||t--;t>=l;)t-=l;o=r.getAt(t),n.select(i.getRecordId(o)),i.fire("select",{record:o})}register(e){super.register(e);let t=this,{id:o,view:n}=t;n.on({containerClick:t.onContainerClick,itemClick:t.onItemClick,scope:t}),n.keys?._keys.push({fn:"onKeyDownDown",key:"Down",scope:o},{fn:"onKeyDownLeft",key:"Left",scope:o},{fn:"onKeyDownRight",key:"Right",scope:o},{fn:"onKeyDownUp",key:"Up",scope:o})}select(e){let o=this,{items:n,view:s}=o,i=[...n],l=[],r=s?.getItemVnodeId(e);s?(o.singleSelect&&(o.items.forEach(t=>{t!==e&&l.push({id:s.getItemVnodeId(t),cls:{add:[],remove:["neo-selected"]}})}),n.splice(0,n.length)),l.push({id:r,cls:{add:["neo-selected"]}}),t.add(n,e),l.length>0&&s.mounted?Neo.applyDeltas(s.windowId,l).then(()=>{s.onSelect?.(n),o.fire("selectionChange",n,i)}):s.mounted&&(s.onSelect?.(n),o.fire("selectionChange",n,i))):t.add(n,e)}toJSON(){return{...super.toJSON(),stayInRow:this.stayInRow}}unregister(){let{id:e,view:t}=this;t.keys?.removeKeys([{fn:"onKeyDownDown",key:"Down",scope:e},{fn:"onKeyDownLeft",key:"Left",scope:e},{fn:"onKeyDownRight",key:"Right",scope:e},{fn:"onKeyDownUp",key:"Up",scope:e}]),super.unregister()}});