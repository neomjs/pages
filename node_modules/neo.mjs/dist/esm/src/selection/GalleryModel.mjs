import e from"./Model.mjs";import o from"../util/Array.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.selection.GalleryModel",ntype:"selection-gallerymodel",cls:"neo-selection-gallerymodel",stayInRow:!1};addDomListener(){}onContainerClick(){let e=this,{view:o}=e,t=[...e.items],n=[];e.items.forEach((e=>{n.push({id:o.getItemVnodeId(e),cls:{add:[],remove:["neo-selected"]}})})),e.items.splice(0,e.items.length),Neo.applyDeltas(o.appName,n).then((()=>{e.fire("selectionChange",e.items,t)}))}onItemClick(e){let o,t=0,n=e.path.length,{view:s}=this;for(;t<n;t++)if(e.path[t].cls.includes("neo-gallery-item")){o=s.getItemId(e.path[t].id),this.select(o),s.fire("select",{record:s.store.get(o)});break}}onKeyDownDown(e){this[this.view.orderByRow?"onNavKeyRow":"onNavKeyColumn"](1)}onKeyDownLeft(e){this[this.view.orderByRow?"onNavKeyColumn":"onNavKeyRow"](-1)}onKeyDownRight(e){this[this.view.orderByRow?"onNavKeyColumn":"onNavKeyRow"](1)}onKeyDownUp(e){this[this.view.orderByRow?"onNavKeyRow":"onNavKeyColumn"](-1)}onNavKeyColumn(e=1){let o,t,n=this,{view:s}=n,{store:i}=s,l=n.items[0],r=i.getCount();o=l?i.indexOf(l)+e:0,o<0?o=r-1:o>=r&&(o=0),t=i.getAt(o),n.select(t[i.keyProperty]),s.fire("select",{record:t})}onNavKeyRow(e=1){let o,t,n=this,{stayInRow:s,view:i}=n,{amountRows:l,store:r}=i,c=n.items[0],y=r.getCount();if(i.orderByRow&&(l=Math.ceil(i.store.getCount()/l)),e*=l,o=c?r.indexOf(c)+e:0,o<0)for(s||o++;o<y-l;)o+=l;else if(o>=y)for(s||o--;o>=l;)o-=l;t=r.getAt(o),n.select(t[r.keyProperty]),i.fire("select",{record:t})}register(e){super.register(e);let o=this,{id:t,view:n}=o;n.on({containerClick:o.onContainerClick,itemClick:o.onItemClick,scope:o}),n.keys?._keys.push({fn:"onKeyDownDown",key:"Down",scope:t},{fn:"onKeyDownLeft",key:"Left",scope:t},{fn:"onKeyDownRight",key:"Right",scope:t},{fn:"onKeyDownUp",key:"Up",scope:t})}select(e){let t=this,{items:n,view:s}=t,i=[...n],l=[],r=s?.getItemVnodeId(e);s?(t.singleSelect&&(t.items.forEach((o=>{o!==e&&l.push({id:s.getItemVnodeId(o),cls:{add:[],remove:["neo-selected"]}})})),n.splice(0,n.length)),l.push({id:r,cls:{add:["neo-selected"]}}),o.add(n,e),l.length>0&&s.mounted?Neo.applyDeltas(s.appName,l).then((()=>{s.onSelect?.(n),t.fire("selectionChange",n,i)})):s.mounted&&(s.onSelect?.(n),t.fire("selectionChange",n,i))):o.add(n,e)}unregister(){let{id:e,view:o}=this;o.keys?.removeKeys([{fn:"onKeyDownDown",key:"Down",scope:e},{fn:"onKeyDownLeft",key:"Left",scope:e},{fn:"onKeyDownRight",key:"Right",scope:e},{fn:"onKeyDownUp",key:"Up",scope:e}]),super.unregister()}});