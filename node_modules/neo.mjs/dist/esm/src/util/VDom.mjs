import e from"../core/Base.mjs";import t from"../manager/Component.mjs";class o extends e{static config={className:"Neo.util.VDom"};static clone(e,t=!0){let r=Neo.clone(e,!0);return t&&delete r.id,r.cn&&r.cn.forEach((e,n)=>{r.cn[n]=o.clone(e,t)}),r}static find(e,t,r=!0,n,i){n=n||0,t=Neo.isString(t)?{id:t}:t,r&&(e=o.getVdom(e));let s,d=null,c=[],l=!0,a=0,f=e.cn?.length,m=Object.entries(t),u=m.length;if(m.forEach(([t,o])=>{if(e.hasOwnProperty(t))switch(t){case"cls":if("string"==typeof o&&Neo.isArray(e[t]))e[t].includes(o)&&c.push(!0);else if("string"==typeof o&&"string"==typeof e[t])e[t]===o&&c.push(!0);else if(Neo.isArray(o)&&Neo.isArray(e[t]))throw new Error("find: cls matching not supported for target & source types of Arrays");break;case"style":if("string"==typeof o&&"string"==typeof e[t])e[t]===o&&c.push(!0);else{if(!Neo.isObject(o)||!Neo.isObject(e[t]))throw new Error("find: style matching not supported for mixed target & source types (Object VS String)");Object.entries(o).forEach(([o,r])=>{e[t].hasOwnProperty(o)&&e[t][o]===r||(l=!1)}),l&&c.push(!0)}break;default:e[t]===o&&c.push(!0)}}),c.length===u)return{index:n,parentNode:i,vdom:e};if(e.cn)for(;a<f;a++)if(e.cn[a]&&(s=o.find(e.cn[a],t,r,a,e),s)){d={index:s.index,parentNode:s.parentNode,vdom:s.vdom};break}return d}static getByFlag(e,t){return o.find(e,{flag:t})?.vdom}static getById(e,t){let r,n=(e=o.getVdom(e)).cn||[],i=0,s=n.length;if(e.id===t)return e;for(;i<s;i++){if(r=o.getVdom(n[i]),r.id===t)return r;if(r=o.getById(r,t),r)return r}return null}static getChildIds(e,t=[]){return e=o.getVdom(e),(e?.cn||[]).forEach(e=>{e.id&&t.push(e.id),t=o.getChildIds(e,t)}),t}static getColumnNodes(e,t){e=o.getVdom(e);let r=[];return e.cn?.forEach(e=>{e.cn?.[t]&&r.push(e.cn[t])}),r}static getColumnNodesIds(e,t){return o.getColumnNodes(e,t).map(e=>e.id)}static getFlags(e,t,r){return e=o.getVdom(e),r||(r=[],e.flag===t&&r.push(e)),(e?.cn||[]).forEach(e=>{e.flag===t&&r.push(e),r=o.getFlags(e,t,r)}),r}static getParentNodes(e,t,r=!0){e=o.getVdom(e);let n=null,i=0,s=e.cn?.length||0;if(e.id===t)return[];for(;i<s;i++)if(n=o.getParentNodes(e.cn[i],t,!1),n){n.push(e.cn[i]);break}return r&&n&&n.push(e),n}static getVdom(e){if(e.componentId){const o=t.get(e.componentId);if(!o)throw new Error(`util.VDom.getVdom: Component not found for id: ${e.componentId}`);e=o.vdom}return e}static insertAfterNode(e,t,r){return o.insertNode(e,t,r,!1)}static insertBeforeNode(e,t,r){return o.insertNode(e,t,r,!0)}static insertNode(e,t,r,n){Neo.isObject(r)&&(r=r.id);let i,s=o.find(e,r);return!!s&&(i=n?s.index:s.index+1,s.parentNode.cn.splice(i,0,t),!0)}static removeVdomChild(e,t){let r=o.find(e,t);return!!r&&(r.parentNode.cn.splice(r.index,1),!0)}static replaceVdomChild(e,t,r){let n,i=(e=o.getVdom(e)).cn||[],s=0,d=i.length;if(e.id===t)throw new Error("replaceVdomChild: target id matches the root vnode id: "+t);for(;s<d;s++){if(n=i[s],n.id===t)return i[s]=r,!0;if(o.replaceVdomChild(n,t,r))return!0}return!1}static syncVdomState(e,t,r=!1){if(e&&t){const n=e.nodeName&&t.tag&&e.nodeName.toLowerCase()!==t.tag.toLowerCase();let i,s,d,c=(t=o.getVdom(t)).cn;if(n||(r?e.id&&t.id!==e.id&&(t.id=e.id):!e.id||t.id&&!t.id.startsWith("neo-vnode-")||(t.id=e.id)),Neo.isNumber(e.scrollTop)&&!Neo.isNumber(t.scrollTop)&&(t.scrollTop=e.scrollTop),Neo.isNumber(e.scrollLeft)&&!Neo.isNumber(t.scrollLeft)&&(t.scrollLeft=e.scrollLeft),Neo.isNumber(t.scrollTop)&&(e.scrollTop=t.scrollTop),Neo.isNumber(t.scrollLeft)&&(e.scrollLeft=t.scrollLeft),c)for(i=c.map(e=>o.getVdom(e)),i=i.filter(e=>e&&!0!==e.removeDom),s=0,d=i?.length||0;s<d;s++)e.childNodes&&o.syncVdomState(e.childNodes[s],i[s],r)}}}export default Neo.setupClass(o);