import e from"../core/Base.mjs";import t from"../manager/Component.mjs";class r extends e{static config={className:"Neo.util.VDom"};static clone(e,t=!0){let n=Neo.clone(e,!0);return t&&delete n.id,n.cn&&n.cn.forEach((e,i)=>{n.cn[i]=r.clone(e,t)}),n}static find(e,t,n=!0,i,o){i=i||0,t=Neo.isString(t)?{id:t}:t,n&&(e=r.getVdom(e));let s,d=null,c=[],a=!0,l=0,f=e.cn?.length,g=Object.entries(t),m=g.length;if(g.forEach(([t,r])=>{if(e.hasOwnProperty(t))switch(t){case"cls":if("string"==typeof r&&Neo.isArray(e[t]))e[t].includes(r)&&c.push(!0);else if("string"==typeof r&&"string"==typeof e[t])e[t]===r&&c.push(!0);else if(Neo.isArray(r)&&Neo.isArray(e[t]))throw new Error("find: cls matching not supported for target & source types of Arrays");break;case"style":if("string"==typeof r&&"string"==typeof e[t])e[t]===r&&c.push(!0);else{if(!Neo.isObject(r)||!Neo.isObject(e[t]))throw new Error("find: style matching not supported for mixed target & source types (Object VS String)");Object.entries(r).forEach(([r,n])=>{e[t].hasOwnProperty(r)&&e[t][r]===n||(a=!1)}),a&&c.push(!0)}break;default:e[t]===r&&c.push(!0)}}),c.length===m)return{index:i,parentNode:o,vdom:e};if(e.cn)for(;l<f;l++)if(e.cn[l]&&(s=r.find(e.cn[l],t,n,l,e),s)){d={index:s.index,parentNode:s.parentNode,vdom:s.vdom};break}return d}static getByFlag(e,t){return r.find(e,{flag:t})?.vdom}static getChildIds(e,t=[]){return e=r.getVdom(e),(e?.cn||[]).forEach(e=>{e.id&&t.push(e.id),t=r.getChildIds(e,t)}),t}static getColumnNodes(e,t){e=r.getVdom(e);let n=[];return e.cn?.forEach(e=>{e.cn?.[t]&&n.push(e.cn[t])}),n}static getColumnNodesIds(e,t){return r.getColumnNodes(e,t).map(e=>e.id)}static getFlags(e,t,n){return e=r.getVdom(e),n||(n=[],e.flag===t&&n.push(e)),(e?.cn||[]).forEach(e=>{e.flag===t&&n.push(e),n=r.getFlags(e,t,n)}),n}static getParentNodes(e,t,n=!0){e=r.getVdom(e);let i=null,o=0,s=e.cn?.length||0;if(e.id===t)return[];for(;o<s;o++)if(i=r.getParentNodes(e.cn[o],t,!1),i){i.push(e.cn[o]);break}return n&&i&&i.push(e),i}static getVdom(e){return e.componentId&&(e=t.get(e.componentId).vdom),e}static insertAfterNode(e,t,n){return r.insertNode(e,t,n,!1)}static insertBeforeNode(e,t,n){return r.insertNode(e,t,n,!0)}static insertNode(e,t,n,i){Neo.isObject(n)&&(n=n.id);let o,s=r.find(e,n);return!!s&&(o=i?s.index:s.index+1,s.parentNode.cn.splice(o,0,t),!0)}static removeVdomChild(e,t){let n=r.find(e,t);return!!n&&(n.parentNode.cn.splice(n.index,1),!0)}static replaceVdomChild(e,t,n){let i,o=(e=r.getVdom(e)).cn||[],s=0,d=o.length;if(e.id===t)throw new Error("replaceVdomChild: target id matches the root vnode id: "+t);for(;s<d;s++){if(i=o[s],i.id===t)return o[s]=n,!0;if(r.replaceVdomChild(i,t,n))return!0}return!1}static syncVdomIds(e,t,n=!1){if(e&&t){let i,o,s,d=(t=r.getVdom(t)).cn;if(n?e.id&&t.id!==e.id&&(t.id=e.id):!t.id&&e.id&&(t.id=e.id),d)for(i=d.map(e=>r.getVdom(e)),i=i.filter(e=>!0!==e.removeDom),o=0,s=i?.length||0;o<s;o++)e.childNodes&&r.syncVdomIds(e.childNodes[o],i[o],n)}}}export default Neo.setupClass(r);