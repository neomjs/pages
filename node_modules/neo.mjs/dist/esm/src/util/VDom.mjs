import e from"../core/Base.mjs";import t from"../manager/Component.mjs";class r extends e{static config={className:"Neo.util.VDom"};static clone(e,t=!0){let o=Neo.clone(e,!0);return t&&delete o.id,o.cn&&o.cn.forEach((e,n)=>{o.cn[n]=r.clone(e,t)}),o}static find(e,t,o=!0,n,i){n=n||0,t=Neo.isString(t)?{id:t}:t,o&&(e=r.getVdom(e));let s,d=null,c=[],l=!0,a=0,f=e.cn?.length,u=Object.entries(t),g=u.length;if(u.forEach(([t,r])=>{if(e.hasOwnProperty(t))switch(t){case"cls":if("string"==typeof r&&Neo.isArray(e[t]))e[t].includes(r)&&c.push(!0);else if("string"==typeof r&&"string"==typeof e[t])e[t]===r&&c.push(!0);else if(Neo.isArray(r)&&Neo.isArray(e[t]))throw new Error("find: cls matching not supported for target & source types of Arrays");break;case"style":if("string"==typeof r&&"string"==typeof e[t])e[t]===r&&c.push(!0);else{if(!Neo.isObject(r)||!Neo.isObject(e[t]))throw new Error("find: style matching not supported for mixed target & source types (Object VS String)");Object.entries(r).forEach(([r,o])=>{e[t].hasOwnProperty(r)&&e[t][r]===o||(l=!1)}),l&&c.push(!0)}break;default:e[t]===r&&c.push(!0)}}),c.length===g)return{index:n,parentNode:i,vdom:e};if(e.cn)for(;a<f;a++)if(e.cn[a]&&(s=r.find(e.cn[a],t,o,a,e),s)){d={index:s.index,parentNode:s.parentNode,vdom:s.vdom};break}return d}static getByFlag(e,t){return r.find(e,{flag:t})?.vdom}static getById(e,t){if(!(e=r.getVdom(e)))return null;let o,n=e.cn||[],i=0,s=n.length;if(e.id===t)return e;for(;i<s;i++)if(o=r.getVdom(n[i]),o){if(o.id===t)return o;if(o=r.getById(o,t),o)return o}return null}static getChildIds(e,t=[]){return e=r.getVdom(e),(e?.cn||[]).forEach(e=>{e.id&&t.push(e.id),t=r.getChildIds(e,t)}),t}static getColumnNodes(e,t){e=r.getVdom(e);let o=[];return e.cn?.forEach(e=>{e.cn?.[t]&&o.push(e.cn[t])}),o}static getColumnNodesIds(e,t){return r.getColumnNodes(e,t).map(e=>e.id)}static getFlags(e,t,o){return e=r.getVdom(e),o||(o=[],e.flag===t&&o.push(e)),(e?.cn||[]).forEach(e=>{e.flag===t&&o.push(e),o=r.getFlags(e,t,o)}),o}static getParentNodes(e,t,o=!0){e=r.getVdom(e);let n=null,i=0,s=e.cn?.length||0;if(e.id===t)return[];for(;i<s;i++)if(n=r.getParentNodes(e.cn[i],t,!1),n){n.push(e.cn[i]);break}return o&&n&&n.push(e),n}static getVdom(e){if(e.componentId){const r=t.get(e.componentId);if(!r)throw new Error(`util.VDom.getVdom: Component not found for id: ${e.componentId}`);e=r.vdom}return e}static insertAfterNode(e,t,o){return r.insertNode(e,t,o,!1)}static insertBeforeNode(e,t,o){return r.insertNode(e,t,o,!0)}static insertNode(e,t,o,n){Neo.isObject(o)&&(o=o.id);let i,s=r.find(e,o);return!!s&&(i=n?s.index:s.index+1,s.parentNode.cn.splice(i,0,t),!0)}static removeVdomChild(e,t){let o=r.find(e,t);return!!o&&(o.parentNode.cn.splice(o.index,1),!0)}static replaceVdomChild(e,t,o){let n,i=(e=r.getVdom(e)).cn||[],s=0,d=i.length;if(e.id===t)throw new Error("replaceVdomChild: target id matches the root vnode id: "+t);for(;s<d;s++){if(n=i[s],n.id===t)return i[s]=o,!0;if(r.replaceVdomChild(n,t,o))return!0}return!1}static syncVdomState(e,t,o=!1){if(e&&t){let n,i,s,d=(t=r.getVdom(t)).cn;if(Neo.isNumber(t.scrollTop)&&(e.scrollTop=t.scrollTop),Neo.isNumber(t.scrollLeft)&&(e.scrollLeft=t.scrollLeft),d){if(n=d.map(e=>r.getVdom(e)),n=n.filter(e=>e&&!0!==e.removeDom),i=0,s=n?.length||0,e.childNodes&&e.childNodes.length!==s)return;for(;i<s;i++)e.childNodes&&r.syncVdomState(e.childNodes[i],n[i],o)}}}}export default Neo.setupClass(r);