import e from"../core/Base.mjs";import t from"../manager/Component.mjs";class r extends e{static config={className:"Neo.util.VDom"};static clone(e,t=!0){let o=Neo.clone(e,!0);return t&&delete o.id,o.cn&&o.cn.forEach((e,i)=>{o.cn[i]=r.clone(e,t)}),o}static find(e,t,o=!0,i,n){i=i||0,t=Neo.isString(t)?{id:t}:t,o&&(e=r.getVdom(e));let s,d=null,c=[],l=!0,a=0,f=e.cn?.length,m=Object.entries(t),u=m.length;if(m.forEach(([t,r])=>{if(e.hasOwnProperty(t))switch(t){case"cls":if("string"==typeof r&&Neo.isArray(e[t]))e[t].includes(r)&&c.push(!0);else if("string"==typeof r&&"string"==typeof e[t])e[t]===r&&c.push(!0);else if(Neo.isArray(r)&&Neo.isArray(e[t]))throw new Error("find: cls matching not supported for target & source types of Arrays");break;case"style":if("string"==typeof r&&"string"==typeof e[t])e[t]===r&&c.push(!0);else{if(!Neo.isObject(r)||!Neo.isObject(e[t]))throw new Error("find: style matching not supported for mixed target & source types (Object VS String)");Object.entries(r).forEach(([r,o])=>{e[t].hasOwnProperty(r)&&e[t][r]===o||(l=!1)}),l&&c.push(!0)}break;default:e[t]===r&&c.push(!0)}}),c.length===u)return{index:i,parentNode:n,vdom:e};if(e.cn)for(;a<f;a++)if(e.cn[a]&&(s=r.find(e.cn[a],t,o,a,e),s)){d={index:s.index,parentNode:s.parentNode,vdom:s.vdom};break}return d}static getByFlag(e,t){return r.find(e,{flag:t})?.vdom}static getById(e,t){let o,i=(e=r.getVdom(e)).cn||[],n=0,s=i.length;if(e.id===t)return e;for(;n<s;n++){if(o=r.getVdom(i[n]),o.id===t)return o;if(o=r.getById(o,t),o)return o}return null}static getChildIds(e,t=[]){return e=r.getVdom(e),(e?.cn||[]).forEach(e=>{e.id&&t.push(e.id),t=r.getChildIds(e,t)}),t}static getColumnNodes(e,t){e=r.getVdom(e);let o=[];return e.cn?.forEach(e=>{e.cn?.[t]&&o.push(e.cn[t])}),o}static getColumnNodesIds(e,t){return r.getColumnNodes(e,t).map(e=>e.id)}static getFlags(e,t,o){return e=r.getVdom(e),o||(o=[],e.flag===t&&o.push(e)),(e?.cn||[]).forEach(e=>{e.flag===t&&o.push(e),o=r.getFlags(e,t,o)}),o}static getParentNodes(e,t,o=!0){e=r.getVdom(e);let i=null,n=0,s=e.cn?.length||0;if(e.id===t)return[];for(;n<s;n++)if(i=r.getParentNodes(e.cn[n],t,!1),i){i.push(e.cn[n]);break}return o&&i&&i.push(e),i}static getVdom(e){if(e.componentId){const r=t.get(e.componentId);if(!r)throw new Error(`util.VDom.getVdom: Component not found for id: ${e.componentId}`);e=r.vdom}return e}static insertAfterNode(e,t,o){return r.insertNode(e,t,o,!1)}static insertBeforeNode(e,t,o){return r.insertNode(e,t,o,!0)}static insertNode(e,t,o,i){Neo.isObject(o)&&(o=o.id);let n,s=r.find(e,o);return!!s&&(n=i?s.index:s.index+1,s.parentNode.cn.splice(n,0,t),!0)}static removeVdomChild(e,t){let o=r.find(e,t);return!!o&&(o.parentNode.cn.splice(o.index,1),!0)}static replaceVdomChild(e,t,o){let i,n=(e=r.getVdom(e)).cn||[],s=0,d=n.length;if(e.id===t)throw new Error("replaceVdomChild: target id matches the root vnode id: "+t);for(;s<d;s++){if(i=n[s],i.id===t)return n[s]=o,!0;if(r.replaceVdomChild(i,t,o))return!0}return!1}static syncVdomState(e,t,o=!1){if(e&&t){let i,n,s,d=(t=r.getVdom(t)).cn;if(o?e.id&&t.id!==e.id&&(t.id=e.id):!e.id||t.id&&!t.id.startsWith("neo-vnode-")||(t.id=e.id),Neo.isNumber(e.scrollTop)&&!Neo.isNumber(t.scrollTop)&&(t.scrollTop=e.scrollTop),Neo.isNumber(e.scrollLeft)&&!Neo.isNumber(t.scrollLeft)&&(t.scrollLeft=e.scrollLeft),Neo.isNumber(t.scrollTop)&&(e.scrollTop=t.scrollTop),Neo.isNumber(t.scrollLeft)&&(e.scrollLeft=t.scrollLeft),d)for(i=d.map(e=>r.getVdom(e)),i=i.filter(e=>e&&!0!==e.removeDom),n=0,s=i?.length||0;n<s;n++)e.childNodes&&r.syncVdomState(e.childNodes[n],i[n],o)}}}export default Neo.setupClass(r);