import t from"../component/Base.mjs";import e from"../core/Effect.mjs";import o from"../util/Array.mjs";export default Neo.setupClass(class extends t{static badgePositions=["bottom-left","bottom-right","top-left","top-right"];static iconPositions=["top","right","bottom","left"];static config={className:"Neo.button.Effect",ntype:"effect-button",badgePosition_:"top-right",badgeText_:null,baseCls:["neo-button"],cls:[],editRoute:!0,handler_:null,handlerScope:null,iconCls_:null,iconColor_:null,iconPosition_:"left",menu_:null,pressed_:!1,route_:null,tag:"button",url_:null,urlTarget_:"_blank",useRippleEffect_:!0};rippleEffectDuration=400;#t=null;construct(t){super.construct(t);let e=this;e.addDomListeners({click:e.onClick,scope:e}),e.createVdomEffect()}createVdomEffect(){return new e(()=>{this._vdom=this.getVdomConfig(),this.update()})}getVdomChildren(){return[{tag:"span",cls:["neo-button-glyph",...this._iconCls||[]],removeDom:!this.iconCls,style:{color:this.iconColor||null}},{tag:"span",cls:["neo-button-text"],id:`${this.id}__text`,removeDom:!this.text,text:this.text},{cls:["neo-button-badge","neo-"+this.badgePosition],removeDom:!this.badgeText,text:this.badgeText},{cls:["neo-button-ripple-wrapper"],removeDom:!this.useRippleEffect,cn:[{cls:["neo-button-ripple"]}]}]}getVdomCls(){let t=[...this.baseCls,...this.cls];return o.toggle(t,"no-text",!this.text),o.toggle(t,"pressed",this.pressed),t.push("icon-"+this.iconPosition),t}getVdomConfig(){let t=this,e=!t.editRoute&&t.route||t.url,o=e?"a":"button";return{tag:o,cls:this.getVdomCls(),href:e?e.startsWith("#")?e:"#"+e:null,id:t.id,style:t.style,target:t.url?t.urlTarget:null,type:"button"===o?"button":null,cn:this.getVdomChildren()}}afterSetMenu(t,e){t&&import("../menu/List.mjs").then(e=>{let o=this,i=Array.isArray(t),n=i?t:t.items,s=i?{}:t,l=o.getStateProvider(),{appName:r,theme:a,windowId:u}=o,d=Neo.merge({module:e.default,align:{edgeAlign:"t0-b0",target:o.id},appName:r,displayField:"text",floating:!0,hidden:!0,parentComponent:o,theme:a,windowId:u},s);n&&(d.items=n),l&&(d.stateProvider={parent:l}),o.menuList=Neo.create(d)})}afterSetTheme(t,e){super.afterSetTheme(t,e);let{menuList:o}=this;o&&(o.theme=t)}afterSetWindowId(t,e){super.afterSetWindowId(t,e);let{menuList:o}=this;o&&(o.windowId=t)}beforeGetIconCls(){let t=this._iconCls;return Array.isArray(t)?t.join(" "):t}beforeSetBadgePosition(t,e){return this.beforeSetEnumValue(t,e,"badgePosition")}beforeSetIconCls(t,e){return t&&!Array.isArray(t)&&(t=t.split(" ").filter(Boolean)),t}beforeSetIconPosition(t,e){return this.beforeSetEnumValue(t,e,"iconPosition")}changeRoute(){this.editRoute&&Neo.Main.editRoute(this.route)}destroy(...t){this.menuList?.destroy(!0,!1),super.destroy(...t)}onClick(t){let e=this;e.bindCallback(e.handler,"handler",e.handlerScope||e),e.handler?.(t),e.menu&&e.toggleMenu(),e.route&&e.changeRoute(),e.useRippleEffect&&e.showRipple(t)}async showRipple(t){let e,o=this,i=t.path[0].rect,n=Math.max(i.height,i.width),s=n/2,l=o.rippleEffectDuration,r=o.getVdomRoot().cn[3],a=r.cn[0];a.style=Object.assign(a.style||{},{animation:"none",height:`${n}px`,left:t.clientX-i.left-s+"px",top:t.clientY-i.top-s+"px",width:`${n}px`}),delete r.removeDom,o.update(),await o.timeout(1),a.style.animation=`ripple ${l}ms linear`,o.update(),o.#t=e=setTimeout(()=>{o.#t===e&&(o.#t=null,r.removeDom=!0,o.update())},l)}async toggleMenu(){let{menuList:t}=this,e=!t.hidden;t.hidden=e,e||await this.timeout(50)}});