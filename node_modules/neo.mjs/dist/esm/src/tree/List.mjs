import e from"../list/Base.mjs";import t from"../util/ClassSystem.mjs";import l from"../collection/Base.mjs";import o from"../util/Array.mjs";import n from"../selection/TreeModel.mjs";import s from"../util/VDom.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.tree.List",ntype:"treelist",baseCls:["neo-tree-list"],disableSelection:!1,dragZone:null,folderCls:"neo-list-folder",showCollapseExpandAllIcons:!0,sortable_:!1,sortZone:null,sortZoneConfig:null,wrapperCls:[],_vdom:{cn:[{tag:"ul",cls:["neo-list-container","neo-list"],tabIndex:-1,cn:[]}]}};afterSetDraggable(e,t){let l=this;e&&(l.sortable?console.error("tree.List can be either draggable or sortable, not both.",l.id):l.dragZone||import("../draggable/tree/DragZone.mjs").then((e=>{l.dragZone=Neo.create({module:e.default,appName:l.appName,owner:l,windowId:l.windowId,...l.dragZoneConfig})})))}afterSetSortable(e,t){let l=this;e&&(l.draggable?console.error("tree.List can be either draggable or sortable, not both.",l.id):l.sortZone||import("../draggable/tree/SortZone.mjs").then((e=>{l.sortZone=Neo.create({module:e.default,appName:l.appName,boundaryContainerId:l.id,owner:l,windowId:l.windowId,...l.sortZoneConfig})})))}beforeSetSelectionModel(e,l){return l?.destroy(),t.beforeSetInstance(e,n)}beforeSetStore(e,t){return e||(e=Neo.create(l,{keyProperty:"id"})),super.beforeSetStore(e,t)}collapseAll(e=!1){let t,l=this,n=!1;l.store.items.forEach((e=>{e.isLeaf||(t=l.getVdomChild(l.getItemId(e.id),l.vdom),t.cls.includes("neo-folder-open")&&(o.remove(t.cls,"neo-folder-open"),n=!0))})),n&&!e&&l.update()}createItem(e){let t,l=this,{folderCls:o,itemCls:n}=l,s=[n];return e.isLeaf?s.push(n+(e.singleton?"-leaf-singleton":"-leaf")):(s.push(o),e.collapsed||s.push("neo-folder-open")),t={tag:"li",cls:s,id:l.getItemId(e.id),cn:[{tag:"span",cls:[n+"-content",e.iconCls],innerHTML:e.name,style:{pointerEvents:"none"}}],style:{display:e.hidden?"none":"flex",padding:"10px",position:e.isLeaf?null:"sticky",top:e.isLeaf?null:38*e.level+"px",zIndex:e.isLeaf?null:20/(e.level+1)}},l.itemsFocusable&&(t.tabIndex=-1),t}createItemLevel(e,t,l,o=!1){let n,s=this,r=s.store.find("parentId",e);return r.length>0&&(t.cn||(t.cn=[]),null!==e?(t.cn.push({tag:"ul",cls:["neo-list"],cn:[],style:{display:o?"none":null,paddingLeft:"15px"}}),n=t.cn[t.cn.length-1]):n=t,r.forEach((e=>{e.level=l,n.cn.push(s.createItem(e)),s.createItemLevel(e.id,n,l+1,e.hidden||o)}))),t}createItems(){let e=this,t=e.getListItemsRoot();t.cn=[],e.createItemLevel(null,t,0),e.update()}expandAll(e=!1){let t,l=this,n=!1;l.store.items.forEach((e=>{e.isLeaf||(t=l.getVdomChild(l.getItemId(e.id),l.vdom),t.cls.includes("neo-folder-open")||(o.add(t.cls,"neo-folder-open"),n=!0))})),n&&!e&&l.update()}filter(e,t,l,o=!1){let n,s,r,i=this,a=!0,d=new RegExp(t,"gi");return t||(t=""),i.store.items.forEach((c=>{c.parentId===l&&(s=!1,r=i.getVdomChild(i.getItemId(c.id),i.vdom),r.cn[0].innerHTML=c[e].replace(d,(e=>(s=!0,`<span class="neo-highlight-search">${e}</span>`))),n=!!c.isLeaf||i.filter(e,t,c.id,s||o),(s||o||!1===n||""===t)&&(a=!1),r.style.display=a?"none":"list-item")})),null===l&&(i.expandAll(!0),i.update()),a}getListItemsRoot(){return this.vdom.cn[this.showCollapseExpandAllIcons?2:0]}onClick(e){e.target.cls.includes("neo-treelist-menu-item")?this.onMenuItemClick(e.target.cls):super.onClick(e)}onConstructed(){super.onConstructed();let e=this;e.showCollapseExpandAllIcons&&(e.vdom.cn.unshift({cls:["neo-treelist-menu-item","neo-treelist-collapse-all-icon"],cn:[{tag:"span",cls:["neo-treelist-menu-item-content"]}]},{cls:["neo-treelist-menu-item","neo-treelist-expand-all-icon"],cn:[{tag:"span",cls:["neo-treelist-menu-item-content"]}]}),e.update())}onItemClick(e,t){let l,n,s,r,i=this,{items:a}=i.store,d=0,c=a.length,m=t.path.map((e=>e.id));for(;d<c;d++)if(s=a[d],r=i.getItemId(s.id),m.includes(r)){n=s,l=i.getVdomChild(r);break}l&&(l.cls?.includes(i.folderCls)?(o.toggle(l.cls,"neo-folder-open"),i.update()):(i.onLeafItemClick(n),i.fire("leafItemClick",n)),super.onItemClick(e,t))}onLeafItemClick(e){}onMenuItemClick(e){e.includes("neo-treelist-collapse-all-icon")?this.collapseAll():this.expandAll()}onStoreRecordChange(e){let t=this,{record:l}=e,{index:o,parentNode:n}=s.find(t.vdom,t.getItemId(l.id));n.cn[o]=t.createItem(l),t.update()}});