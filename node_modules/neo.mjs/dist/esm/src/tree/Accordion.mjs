import e from"../util/ClassSystem.mjs";import t from"../util/Array.mjs";import o from"../tree/List.mjs";import l from"../selection/TreeAccordionModel.mjs";import s from"../util/VDom.mjs";export default Neo.setupClass(class extends o{static config={className:"Neo.tree.Accordion",ntype:"treeaccordion",baseCls:["neo-tree-list"],fields:{header:"name",icon:"iconCls",text:"content"},firstParentIsVisible_:!0,rootParentsAreCollapsible_:!1,selection_:null,showIcon_:!0,showCollapseExpandAllIcons:!1,_vdom:{cn:[{tag:"ul",cls:["neo-list-container","neo-list","neo-accordion-style"],cn:[]}]}};onConstructed(){super.onConstructed();let e=this;e.addDomListeners({focusin:e.onFocus,scope:e})}afterSetFirstParentIsVisible(e,t){let o=this.store.first();this.toggleCls("first-parent-not-visible",!e),o&&(o.visible=e)}afterSetRootParentsAreCollapsible(e,t){let o=this;if(o[e?"removeCls":"addCls"]("root-not-collapsible"),o.vnodeInitialized&&!1===e){let{store:e}=o;e.items.forEach(e=>{null!==e.parentId||e.isLeaf||o.expandItem(e)})}}afterSetShowIcon(e,t){const o=this,{store:l}=o,n=!e;l.items.forEach(e=>{const t=o.getItemId(e[o.getKeyProperty()]),l=o.getVdomChild(t),i=s.getByFlag(l,"iconCls");e.isLeaf&&(i.removeDom=n)}),o.update()}beforeSetSelectionModel(t,o){return o?.destroy(),e.beforeSetInstance(t,l)}clear(e=!0){delete this.getVdomRoot().cn[0].cn,e&&this.update()}clearSelection(){this.selectionModel.deselectAll()}createItems(e,o,l){let s,n,i,c,r=this,{folderCls:a,itemCls:d}=r,m=r.store.find("parentId",e);return m.length>0&&(o.cn||(o.cn=[]),null!==e?(o.cn.push({tag:"ul",cls:["neo-list"],cn:[],id:`${r.id}__${e}__ul`}),c=o.cn[o.cn.length-1]):c=o,m.forEach(e=>{s=[d],i=["neo-accordion-item-icon"],e.iconCls&&t.add(i,e.iconCls.split(" ")),e.isLeaf?s.push(d+(e.singleton?"-leaf-singleton":"-leaf")):(s.push(a),e.parentId||r.rootParentsAreCollapsible||(s.push("neo-not-collapsible"),e.collapsed&&(e.collapsed=!1)),e.collapsed||s.push("neo-folder-open")),n=r.getItemId(e.id),c.cn.push({tag:"li",tabIndex:-1,cls:s,id:n,cn:[{flag:"iconCls",tag:"span",cls:i,id:n+"__icon",removeDom:!e.isLeaf||!r.showIcon},{cls:[d+"-content"],id:n+"__item-content",style:{pointerEvents:"none"},cn:[{flag:"name",tag:"span",cls:[d+"-content-header"],id:n+"__item-content-header",text:e[r.fields.header]},{flag:"content",tag:"span",cls:[d+"-content-text"],id:n+"__item-content-text",text:e[r.fields.text]}]}],style:{position:e.isLeaf?null:"sticky",top:e.isLeaf?null:38*l+"px",zIndex:e.isLeaf?null:20/(l+1)}}),c=r.createItems(e.id,c,l+1)})),o}expandItem(e){let o=this,l=o.getItemId(e[o.getKeyProperty()]),s=o.getVdomChild(l);e.collapsed=!1,t.add(s.cls,"neo-folder-open"),o.update()}onItemClick(e,t){super.onItemClick(e,t);let o=this,{selectionModel:l}=o,s=e.id,n=Number(s.split("__")[1]),i=o.store.get(n);l.select(e.id),i.isLeaf||(o.fire("folderItemClick",{record:i}),i.collapsed=!i.collapsed)}getListItemsRoot(){return this.vdom.cn[0]}onFocus(e){let{selectionModel:t}=this;!t.getSelection()[0]&&t.selectRoot()}onSelect(e){let t=this,o=[];e.forEach(e=>{let l=t.getItemRecordId(e),s=t.store.get(l);o.push(s)}),t.selection=o}onStoreLoad(e){let t=this;t.clear(!1),!t.mounted&&t.isVnodeInitializing?t.on("mounted",()=>{t.createItems(null,t.getListItemsRoot(),0),t.update()},t,{once:!0}):(t.createItems(null,t.getListItemsRoot(),0),t.update())}onStoreRecordChange(e){let o,l=this,{fields:n,record:i}=e,c=l.getItemId(i[l.getKeyProperty()]),r=l.getVdomChild(c);n.forEach(e=>{if(o=s.getByFlag(r,e.name),o)if("iconCls"===e.name){let l=e.value.split(" "),s=["neo-accordion-item-icon"];t.add(s,l),o.cls=s}else o.text=e.value}),l.update()}setSelection(e){if(null===e)return void this.clearSelection();Neo.isArray(e)&&(e=e[0]);let t,o,l=this;t=Neo.isRecord(e)?e[l.getKeyProperty()]:e,o=l.getItemId(t),l.selectionModel.selectAndScrollIntoView(o)}});