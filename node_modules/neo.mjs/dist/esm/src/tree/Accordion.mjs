import e from"../util/ClassSystem.mjs";import t from"../util/Array.mjs";import o from"../tree/List.mjs";import s from"../selection/TreeAccordionModel.mjs";import l from"../util/VDom.mjs";export default Neo.setupClass(class extends o{static config={className:"Neo.tree.Accordion",ntype:"treeaccordion",baseCls:["neo-tree-list"],fields:{header:"name",icon:"iconCls",text:"content"},firstParentIsVisible_:!0,rootParentsAreCollapsible_:!1,selection_:null,showIcon_:!0,showCollapseExpandAllIcons:!1,_vdom:{cn:[{tag:"ul",cls:["neo-list-container","neo-list","neo-accordion-style"],cn:[]}]}};onConstructed(){super.onConstructed();let e=this;e.addDomListeners({focusin:e.onFocus,scope:e})}afterSetFirstParentIsVisible(e,t){let o=this.store.first();this.toggleCls("first-parent-not-visible",!e),o&&(o.visible=e)}afterSetRootParentsAreCollapsible(e,t){let o=this;if(o[e?"removeCls":"addCls"]("root-not-collapsible"),o.vnodeInitialized&&!1===e){let{store:e}=o;e.forEach(e=>{null!==e.parentId||e.isLeaf||o.expandItem(e)})}}afterSetShowIcon(e,t){const o=this,{store:s}=o,n=!e;s.forEach(e=>{const t=o.getItemId(o.store.getKey(e)),s=o.getVdomChild(t),i=l.getByFlag(s,"iconCls");e.isLeaf&&(i.removeDom=n)}),o.update()}beforeSetSelectionModel(t,o){return o?.destroy(),e.beforeSetInstance(t,s)}clear(e=!0){delete this.getVdomRoot().cn[0].cn,e&&this.update()}clearSelection(){this.selectionModel.deselectAll()}createItems(e,o,s){let l,n,i,c,r=this,{folderCls:a,itemCls:d}=r,m=r.store.find("parentId",e);return m.length>0&&(o.cn||(o.cn=[]),null!==e?(o.cn.push({tag:"ul",cls:["neo-list"],cn:[],id:`${r.id}__${e}__ul`}),c=o.cn[o.cn.length-1]):c=o,m.forEach(e=>{l=[d],i=["neo-accordion-item-icon"],e.iconCls&&t.add(i,e.iconCls.split(" ")),e.isLeaf?l.push(d+(e.singleton?"-leaf-singleton":"-leaf")):(l.push(a),e.parentId||r.rootParentsAreCollapsible||(l.push("neo-not-collapsible"),e.collapsed&&(e.collapsed=!1)),e.collapsed||l.push("neo-folder-open")),n=r.getItemId(e.id),c.cn.push({tag:"li",tabIndex:-1,cls:l,id:n,cn:[{flag:"iconCls",tag:"span",cls:i,id:n+"__icon",removeDom:!e.isLeaf||!r.showIcon},{cls:[d+"-content"],id:n+"__item-content",style:{pointerEvents:"none"},cn:[{flag:"name",tag:"span",cls:[d+"-content-header"],id:n+"__item-content-header",text:e[r.fields.header]},{flag:"content",tag:"span",cls:[d+"-content-text"],id:n+"__item-content-text",text:e[r.fields.text]}]}],style:{position:e.isLeaf?null:"sticky",top:e.isLeaf?null:38*s+"px",zIndex:e.isLeaf?null:20/(s+1)}}),c=r.createItems(e.id,c,s+1)})),o}expandItem(e){let o=this,s=o.getItemId(o.store.getKey(e)),l=o.getVdomChild(s);e.collapsed=!1,t.add(l.cls,"neo-folder-open"),o.update()}onItemClick(e,t){super.onItemClick(e,t);let o=this,{selectionModel:s}=o,l=e.id,n=o.getItemRecordId(l),i=o.store.get(n);s.select(e.id),i.isLeaf||(o.fire("folderItemClick",{record:i}),i.collapsed=!i.collapsed)}getListItemsRoot(){return this.vdom.cn[0]}onFocus(e){let{selectionModel:t}=this;!t.getSelection()[0]&&t.selectRoot()}onSelect(e){let t=this,o=[];e.forEach(e=>{let s=t.getItemRecordId(e),l=t.store.get(s);o.push(l)}),t.selection=o}onStoreLoad(e){let t=this;t.clear(!1),!t.mounted&&t.isVnodeInitializing?t.on("mounted",()=>{t.createItems(null,t.getListItemsRoot(),0),t.update()},t,{once:!0}):(t.createItems(null,t.getListItemsRoot(),0),t.update())}onStoreRecordChange(e){let o,s=this,{fields:n,record:i}=e,c=s.getItemId(s.store.getKey(i)),r=s.getVdomChild(c);n.forEach(e=>{if(o=l.getByFlag(r,e.name),o)if("iconCls"===e.name){let s=e.value.split(" "),l=["neo-accordion-item-icon"];t.add(l,s),o.cls=l}else o.text=e.value}),s.update()}setSelection(e){if(null===e)return void this.clearSelection();Neo.isArray(e)&&(e=e[0]);let t,o,s=this;t=Neo.isRecord(e)?s.store.getKey(e):e,o=s.getItemId(t),s.selectionModel.selectAndScrollIntoView(o)}});