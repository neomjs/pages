import e from"../util/ClassSystem.mjs";import t from"../util/HashHistory.mjs";import o from"../data/Store.mjs";import s from"./Base.mjs";export default Neo.setupClass(class extends s{static config={className:"Neo.toolbar.Breadcrumb",ntype:"breadcrumb-toolbar",activeKey_:null,baseCls:["neo-breadcrumb-toolbar","neo-toolbar"],itemDefaults:{ntype:"button",ui:"tertiary"},store_:null};defaultStoreConfig={module:o,model:{fields:[{name:"id",type:"Integer"},{name:"name",type:"String"},{name:"parentId",type:"Integer"},{name:"route",type:"String"}]}};updateOnHashChange=!0;construct(e){super.construct(e);let o=this;o.updateOnHashChange&&t.on("change",o.onHashChange,o)}afterSetActiveKey(e,t){let o,s=this;null!==e&&s.store.getCount?.()>0&&(s.updateItems(),o=s.store.get(e)?.route,o&&Neo.Main.setRoute({value:o}))}afterSetStore(e,t){e.on({load:this.onStoreLoad,scope:this})}beforeSetStore(t,o){return o?.destroy(),e.beforeSetInstance(t,null,this.defaultStoreConfig)}destroy(...e){let o=this;o.updateOnHashChange&&t.un("change",o.onHashChange,o),super.destroy(...e)}getPathItems(){let e,t=[],o=this.activeKey,{store:s}=this;for(;null!==o;)e=s.get(o),t.unshift(e),o=e.parentId;return t}onHashChange(e,t){let o,s=e?.hashString,{store:a}=this;s&&!s.endsWith("/")&&(s+="/"),o=s&&a.findFirst({route:s})?.[a.keyProperty]||null,null!==o&&(this.activeKey=o)}onStoreLoad(e){this.afterSetActiveKey(this.activeKey,null)}updateItems(){let e,t,o=this,{items:s}=o,a=o.getPathItems(),n=0,r=a.length,i=[];for(o.silentVdomUpdate=!0;n<r;n++)t=a[n],e={disabled:n===r-1,editRoute:!1,hidden:!1,route:t.route,text:t.name},s[n]?s[n].setSilent(e):i.push(e);for(r=s.length;n<r;n++)s[n].setSilent({hidden:!0});i.length>0&&o.add(i),o.silentVdomUpdate=!1,o.update()}});