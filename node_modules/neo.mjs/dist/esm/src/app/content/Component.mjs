import e from"../../component/Markdown.mjs";import{marked as t}from"../../../node_modules/marked/lib/marked.esm.js";export default Neo.setupClass(class extends e{static config={className:"Neo.app.content.Component",baseCls:["neo-app-content-component","neo-markdown-component"],bind:{record:e=>e.currentPageRecord},issuesUrl:"#/news/tickets/",record_:null,replaceTicketIds:!0,tag:"article",updateSectionsStore:!0};headlineData=null;construct(e){super.construct(e);this.addDomListeners({intersect:"onIntersect",scope:this})}afterSetMounted(e,t){super.afterSetMounted(e,t);let n=this;e&&n.timeout(50).then(()=>{Neo.main.addon.IntersectionObserver.register({callback:"findTopmostItem",id:n.id,root:`#${n.parentId}`,windowId:n.windowId})})}async afterSetRecord(e,t){if(e){let n=this;await n.doFetchContent(e),t&&(await n.timeout(50),Neo.main.DomAccess.scrollTo({direction:"top",id:n.parentId,value:0,windowId:n.windowId}))}}async doFetchContent(e){let t,n,o,a=this,{windowId:s}=a;o=a.getContentPath(e),e.isLeaf&&o&&(n=await fetch(o),t=await n.text(),a.value=t,a.toggleCls("lab",e.name?.startsWith("Lab:")),Neo.main.addon.IntersectionObserver.observe({disconnect:!0,id:a.id,observe:[".neo-h2",".neo-h3"],windowId:s}))}getContentPath(e){return null}modifyMarkdown(e){this.headlineData=[];const t=super.modifyMarkdown(e);return this.updateSectionsStore&&(this.getStateProvider().getStore("sections").data=this.headlineData),this.headlineData=null,t}onHeadline(e,n,o){const a=n.replaceAll("`","");this.headlineData.push({id:o,name:a,sourceId:this.id,tag:e});return`<${e} class="neo-${e}" data-record-id="${o}">${t.parseInline(n)}</${e}>`}});