import e from"../../manager/Component.mjs";import t from"../SharedCanvas.mjs";export default Neo.setupClass(class extends t{static config={className:"Neo.app.header.Canvas",activeId_:null,cls:["app-header-canvas"],hoverId_:null,rendererClassName:"Neo.canvas.Header",rendererImportPath:"src/canvas/Header.mjs"};navRects=null;navRectsTimeoutId=null;afterSetIsCanvasReady(e,t){super.afterSetIsCanvasReady(e,t);let a=this;e&&a.activeId&&a.renderer.updateActiveId({id:a.activeId})}async afterSetOffscreenRegistered(t,a){await super.afterSetOffscreenRegistered(t,a);let s=this;if(t){let t=Neo.get(s.parentId);e.down(t,"button",!1).forEach(e=>{e.addDomListeners({resize:s.onButtonResize,scope:s})}),await s.updateNavRects()}}async afterSetActiveId(e,t){this.isCanvasReady&&await this.renderer.updateActiveId({id:e})}async afterSetHoverId(e,t){this.isCanvasReady&&await this.renderer.updateHoverId({id:e})}getMonitorTargetId(){return this.parentId}onButtonResize(e){this.updateNavRects()}async onDomResize(e){this.fire("resize",e),await this.updateNavRects()}isUpdatingNavRects=!1;pendingNavRectsUpdate=!1;async updateNavRects(t=!1){let a=this;if(!a.isCanvasReady)return;if(t||(a.navRectsTimeoutId&&clearTimeout(a.navRectsTimeoutId),a.navRectsTimeoutId=setTimeout(()=>{a.navRectsTimeoutId=null,a.updateNavRects(!0)},1e3)),a.isUpdatingNavRects)return void(a.pendingNavRectsUpdate=!0);a.isUpdatingNavRects=!0,a.pendingNavRectsUpdate=!1;let s=Neo.get(a.parentId),i=e.down(s,"button",!1).map(e=>e.id);if(i.length>0){let e=[...i,a.id],t=await a.getDomRect(e);if(t){let e=t.pop();a.canvasRect=e,e&&(a.navRects=t.map((t,a)=>t?{id:i[a],x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}:null).filter(Boolean),a.renderer.updateNavRects({height:e.height,rects:a.navRects,width:e.width}))}}a.isUpdatingNavRects=!1,a.pendingNavRectsUpdate&&a.updateNavRects()}});