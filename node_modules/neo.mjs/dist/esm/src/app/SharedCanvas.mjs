import e from"../component/Canvas.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.app.SharedCanvas",isCanvasReady_:!1,rendererClassName:null,rendererImportPath:null,_vdom:{tag:"canvas"}};canvasId=null;canvasRect=null;afterSetIsCanvasReady(e,a){if(e){let e=this.theme?.includes("dark")?"dark":"light";this.renderer?.setTheme(e),this.fire("canvasReady")}}async afterSetMounted(e,a){let t=this;e?await t.ready():t.offscreenRegistered&&t.renderer?.clearGraph(),super.afterSetMounted(e,a)}async afterSetOffscreenRegistered(e,a){let t=this;if(e){if(await t.ready(),!t.rendererClassName)throw new Error("Canvas component missing rendererClassName config");await t.renderer.initGraph({canvasId:t.getCanvasId(),windowId:t.windowId}),t.isCanvasReady=!0,await t.updateSize()}else a&&(t.isCanvasReady=!1,await t.renderer.clearGraph())}afterSetTheme(e,a){if(super.afterSetTheme(e,a),e&&this.isCanvasReady){let a=e.includes("dark")?"dark":"light";this.renderer.setTheme(a)}}getCanvasId(){let e=this;return e.canvasId||(e.canvasId=e.id),e.canvasId}get renderer(){return this.rendererClassName?Neo.ns(this.rendererClassName):null}destroy(...e){this.renderer?.clearGraph(),super.destroy(...e)}async initAsync(){await super.initAsync();let e=this;if(e.rendererImportPath){await Neo.worker.Manager.startWorker({name:"canvas",windowId:e.windowId});let a=0;for(;!Neo.ns("Neo.worker.Canvas.loadModule")&&a<40;)await e.timeout(50),a++;if(Neo.ns("Neo.worker.Canvas.loadModule")){await Neo.worker.Canvas.loadModule({path:e.rendererImportPath});let a=0;for(;!e.renderer&&a<40;)await e.timeout(50),a++;e.renderer||console.error("Renderer Remote Stub not found:",e.rendererClassName)}else console.error("Neo.component.CanvasShared: Canvas Worker failed to register remote methods.")}}onClick(e){let a=this;a.isCanvasReady&&a.canvasRect&&a.renderer.updateMouseState({click:!0,x:e.clientX-a.canvasRect.left,y:e.clientY-a.canvasRect.top})}pause(){this.isCanvasReady&&this.renderer.pause()}onMouseLeave(e){this.isCanvasReady&&this.renderer.updateMouseState({leave:!0})}onMouseMove(e){let a=this;a.isCanvasReady&&a.canvasRect&&a.renderer.updateMouseState({x:e.clientX-a.canvasRect.left,y:e.clientY-a.canvasRect.top})}async onDomResize(e){super.onDomResize(e),await this.updateSize(e.contentRect)}resume(){this.isCanvasReady&&this.renderer.resume()}async updateSize(e){let a=this;await a.ready(),e&&0!==e.width&&0!==e.height||(e=await a.getDomRect(a.id)),e&&(a.canvasRect=e,await(a.renderer?.updateSize({width:e.width,height:e.height})))}});