import e from"../core/Base.mjs";import t from"../util/ClassSystem.mjs";import o from"../manager/Component.mjs";import r from"../mixin/DomEvents.mjs";import n from"../core/Observable.mjs";import i from"../mixin/VdomLifecycle.mjs";import s from"../manager/VDomUpdate.mjs";import d from"../util/VNode.mjs";import{isDescriptor as a}from"../core/ConfigSymbols.mjs";Symbol.for("closestController");const l=Symbol.for("closestProvider"),m=Symbol.for("twoWayBinding");export default Neo.setupClass(class extends e{static config={className:"Neo.component.Abstract",ntype:"abstract-component",additionalThemeFiles:null,appName_:null,bind_:{[a]:!0,merge:"deep",value:null},cls_:null,data_:null,disabled_:!1,mixins:[r,n,i],modelData:null,mounted_:!1,parentComponent_:null,parentId_:"document.body",saveScrollPosition:!0,stateProvider_:null,unmountConfigs_:{[a]:!0,merge:"deep",value:null},windowId_:null};isAwaitingMount=!1;get app(){return Neo.apps[this.windowId]||Neo.appsByName[this.appName]?.[0]||null}get mountedPromise(){let e=this;return e._mountedPromise||(e._mountedPromise=new Promise(t=>{e.mounted?t(e):e.mountedPromiseResolve=t})),e._mountedPromise}get parent(){let e=this;return e.parentComponent||("document.body"===e.parentId?null:Neo.getComponent(e.parentId))}afterSetConfig(e,t,o){let r=this;if(Neo.isUsingStateProviders&&r[m]){if(r._skipTwoWayPush===e)return;let o=r.bind?.[e];o?.twoWay&&this.getStateProvider()?.setData(o.key,t)}}afterSetId(e,t){super.afterSetId(e,t),t&&o.unregister(t),e&&o.register(this)}afterSetMounted(e,t){if(void 0!==t){const t=this;e?(t.initDomEvents?.(),t.mountedPromiseResolve?.(this),delete t.mountedPromiseResolve,s.executeCallbacks(t.id,{deltas:[],vnode:t.vnode})):(delete t._mountedPromise,t.resetMountedDomEvents?.(),t.unmountConfigs&&t.set(t.unmountConfigs))}}afterSetParentId(e,t){o.onParentIdChange(this,t)}afterSetStateProvider(e,t){e?.createBindings(this)}afterSetWindowId(e,t){const o=this;e&&(o.controller&&(o.controller.windowId=e),o.stateProvider&&(o.stateProvider.windowId=e),Neo.currentWorker.insertThemeFiles(e,o.__proto__)),t&&(o.isVdomUpdating=!1)}beforeGetData(e){return this.getStateProvider()?.getHierarchyData()}beforeSetStateProvider(e,o){if(o?.destroy(),e){let o=this,r={component:o,windowId:o.windowId};return o.modelData&&(r.data=o.modelData),t.beforeSetInstance(e,"Neo.state.Provider",r)}return null}destroy(){this.removeDomEvents(),o.unregister(this),this.stateProvider=null,super.destroy()}getConfigInstanceByNtype(e,t){let o=this,r=o[e],{parentComponent:n}=o;return!r||t&&t!==r.ntype?(!n&&o.parentId&&(n=o.parent||Neo.get(o.parentId)),n?n===o?(console.error("Circular parent reference detected",o.id),null):n.getConfigInstanceByNtype?.(e,t):null):r}getState(...e){return this.getStateProvider().getData(...e)}getStateProvider(e){if(!Neo.isUsingStateProviders)return null;let t,o=this;return!e&&(t=o[l],t)||(t=o.getConfigInstanceByNtype("stateProvider",e),e||(o[l]=t)),t}initConfig(...e){super.initConfig(...e),this.getStateProvider()?.createBindings(this)}onScrollCapture(e){let t,o=this;o.vnode&&(t=d.getById(o.vnode,e.target.id),t&&(t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft))}set(e={},t=!1){const o=this,r=o.hidden;return o.setSilent(e),!t&&o.needsVdomUpdate?r&&!o.hidden?(o.show?.(),Promise.resolve()):o.promiseUpdate():Promise.resolve()}setSilent(e={}){this.silentVdomUpdate=!0,super.set(e),this.silentVdomUpdate=!1}setState(...e){this.getStateProvider().setData(...e)}toJSON(){let e=this;return{...super.toJSON(),appName:e.appName,bind:e.bind?Object.keys(e.bind):null,mounted:e.mounted,parentId:e.parentId,stateProvider:e.stateProvider?.toJSON(),windowId:e.windowId}}});