import e from"../Base.mjs";import a from"../../util/ClassSystem.mjs";import o from"../../data/Store.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.component.wrapper.OpenStreetMaps",ntype:"openstreetmaps",center_:{lat:-34.397,lng:150.644},markerStore_:{model:{fields:[{name:"anchorPoint",type:"Object"},{name:"icon",type:"Object"},{name:"id"},{name:"label",type:"String"},{name:"position",type:"Object"},{name:"title",type:"String"}]}},zoom_:8};fullscreenControl=!0;mapCreated=!1;mapOptions={};markerStoreConfig=null;maxZoom=null;minZoom=null;zoomControl=!0;construct(e){super.construct(e);let a=this;a.addDomListeners({openStreetMapZoomChange:a.onMapZoomChange,openStreetMapMarkerClick:a.parseMarkerClick,local:!1,scope:a})}addMarker(e){let{appName:a,windowId:o}=this;Neo.main.addon.OpenStreetMaps.addMarker({appName:a,windowId:o,...e})}afterSetCenter(e,a){let{appName:o,id:t,windowId:r}=this;this.mapCreated&&Neo.main.addon.OpenStreetMaps.setCenter({appName:o,id:t,value:e,windowId:r})}afterSetMarkerStore(e,a){let o=this;e.on({load:o.onMarkerStoreLoad,scope:o}),e.items.length>0&&o.onMarkerStoreLoad()}afterSetMounted(e,a){let o=this;if(!1===e&&void 0!==a&&o.removeMap(),super.afterSetMounted(e,a),e){let e={appName:o.appName,center:o.center,fullscreenControl:o.fullscreenControl,id:o.id,mapOptions:o.mapOptions,maxZoom:o.maxZoom,minZoom:o.minZoom,zoom:o.zoom,zoomControl:o.zoomControl};o.timeout(50).then(()=>{Neo.main.addon.OpenStreetMaps.create(e).then(()=>{o.mapCreated=!0,o.onComponentMounted()})})}}afterSetZoom(e,a){let o=this,{appName:t,id:r,windowId:n}=o;o.mapCreated&&(Neo.main.addon.OpenStreetMaps.setZoom({appName:t,id:r,value:e,windowId:n}),o.fire("zoomChange",{id:r,value:e}))}beforeSetMarkerStore(e,t){return t?.destroy(),a.beforeSetInstance(e,o,this.markerStoreConfig)}destroy(e=!1,a=!1){this.removeMap(),super.destroy(e,a)}hideMarker(e){let{appName:a,windowId:o}=this;Neo.main.addon.OpenStreetMaps.hideMarker({appName:a,id:e,mapId:this.id,windowId:o})}onComponentMounted(){}onMapZoomChange(e){this.zoom=e.value}onMarkerStoreLoad(){let{appName:e,id:a,windowId:o}=this;Neo.main.addon.OpenStreetMaps.destroyMarkers({appName:e,id:a,windowId:o}),this.markerStore.items.forEach(t=>{Neo.main.addon.OpenStreetMaps.addMarker({appName:e,mapId:a,windowId:o,...t})})}panTo(e){let{appName:a,id:o,windowId:t}=this;Neo.main.addon.OpenStreetMaps.panTo({appName:a,mapId:o,position:e,windowId:t})}parseMarkerClick(e){let a=this;e.record=a.markerStore.get(e.id),a.onMarkerClick?.(e),a.fire("markerClick",{id:a.id,data:e})}removeMap(){let{appName:e,id:a,windowId:o}=this;Neo.main.addon.OpenStreetMaps.removeMap({appName:e,mapId:a,windowId:o})}removeMarker(e){let{appName:a,windowId:o}=this;Neo.main.addon.OpenStreetMaps.removeMarker({appName:a,id:e,mapId:this.id,windowId:o})}showMarker(e){let{appName:a,windowId:o}=this;Neo.main.addon.OpenStreetMaps.showMarker({appName:a,id:e,mapId:this.id,windowId:o})}});