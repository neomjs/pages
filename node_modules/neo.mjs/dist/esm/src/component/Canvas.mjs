import e from"./Base.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.component.Canvas",ntype:"canvas",monitorSize_:!0,offscreen:!0,offscreenRegistered_:!1,_vdom:{tag:"canvas"}};async afterSetMounted(e,s){super.afterSetMounted(e,s);let r=this,o=r.getCanvasId(),{offscreen:t,windowId:n}=r;if(e){if(await r.timeout(30),r.monitorSize&&r.addDomListeners([{delegate:`#${r.getMonitorTargetId()}`,resize:r.onDomResize,scope:r}]),t){let e,s=50;for(;r.mounted&&!r.offscreenRegistered&&!r.isDestroyed;){if(e=await Neo.main.DomAccess.getOffscreenCanvas({nodeId:o,windowId:n}),e.offscreen){await Neo.worker.Canvas.registerCanvas({node:e.offscreen,nodeId:o,windowId:n},[e.offscreen]),r.offscreenRegistered=!0;break}if(e.transferred&&Neo.config.useSharedWorkers){if((await Neo.worker.Canvas.retrieveCanvas({nodeId:o,windowId:n})).hasCanvas){r.offscreenRegistered=!0;break}}await r.timeout(s),s<1e3&&(s*=2)}}}else t&&(r.offscreenRegistered&&Neo.worker.Canvas.unregisterCanvas({nodeId:o}),r.offscreenRegistered=!1)}afterSetWindowId(e,s){super.afterSetWindowId(e,s),s&&(this.offscreenRegistered=!1)}destroy(...e){this.offscreenRegistered&&Neo.worker.Canvas.unregisterCanvas({nodeId:this.id}),super.destroy(...e)}getCanvasId(){return this.id}getMonitorTargetId(){return this.vdom.id}onDomResize(e){this.fire("resize",e)}});