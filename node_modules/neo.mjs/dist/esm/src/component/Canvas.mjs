import e from"./Base.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.component.Canvas",ntype:"canvas",monitorSize_:!0,offscreen:!0,offscreenRegistered_:!1,_vdom:{tag:"canvas"}};async afterSetMounted(e,s){super.afterSetMounted(e,s);let o=this,a=o.getCanvasId(),{offscreen:t,windowId:r}=o;if(e){if(await o.timeout(30),o.monitorSize&&o.addDomListeners([{delegate:`#${o.getCanvasId()}`,resize:o.onDomResize,scope:o}]),t){let e,s=50;for(;o.mounted&&!o.offscreenRegistered&&!o.isDestroyed;){if(e=await Neo.main.DomAccess.getOffscreenCanvas({nodeId:a,windowId:r}),e.offscreen){await Neo.worker.Canvas.registerCanvas({node:e.offscreen,nodeId:a,windowId:r},[e.offscreen]),o.offscreenRegistered=!0;break}if(e.transferred&&Neo.config.useSharedWorkers){if((await Neo.worker.Canvas.retrieveCanvas({nodeId:a,windowId:r})).hasCanvas){o.offscreenRegistered=!0;break}}await o.timeout(s),s<1e3&&(s*=2)}}}else t&&(o.offscreenRegistered=!1)}afterSetWindowId(e,s){super.afterSetWindowId(e,s),s&&(this.offscreenRegistered=!1)}getCanvasId(){return this.id}onDomResize(e){this.fire("resize",e)}});