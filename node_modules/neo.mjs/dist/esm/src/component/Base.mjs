import e from"../core/Base.mjs";import t from"../util/ClassSystem.mjs";import o from"../manager/Component.mjs";import n from"../manager/DomEvent.mjs";import d from"../util/KeyNavigation.mjs";import i from"../util/Logger.mjs";import r from"../util/Array.mjs";import s from"../core/Observable.mjs";import a from"../util/Rectangle.mjs";import l from"../util/Style.mjs";import p from"../util/VDom.mjs";import m from"../util/VNode.mjs";const h=e=>null==e||isNaN(e)?e:`${e}px`,u=Symbol.for("closestController"),c=Symbol.for("closestProvider"),{currentWorker:g}=Neo,f=/^\d+\w+$/,v=Symbol.for("twoWayBinding");export default Neo.setupClass(class extends e{static hideModes=["removeDom","visibility"];static observable=!0;static config={className:"Neo.component.Base",ntype:"component",align_:{edgeAlign:"t-b",constrainTo:"document.body"},appName_:null,autoMount:!1,autoRender:!1,baseCls:[],bind:null,cls_:null,containsFocus_:!1,controller_:null,data_:null,disabled_:!1,domListeners_:null,droppable_:!1,dropZone:null,dropZoneConfig:null,floating:!1,hasBeenMounted:!1,hasRenderingListener:!1,hasUnmountedVdomChanges_:!1,height_:null,hidden_:!1,hideMode_:"removeDom",html_:null,isLoading_:!1,isVdomUpdating_:!1,keys_:null,loadingSpinnerCls_:["fa","fa-spinner","fa-spin"],maxHeight_:null,maxWidth_:null,minHeight_:null,minWidth_:null,modelData:null,mounted_:!1,needsVdomUpdate_:!1,parentComponent_:null,parentId_:"document.body",plugins_:null,reference_:null,responsive_:null,rendering_:!1,role_:null,scrollable_:!1,silentVdomUpdate_:!1,stateProvider_:null,style_:null,theme_:null,tag_:null,tooltip_:null,ui_:null,updateDepth_:1,vnode_:null,width_:null,windowId_:null,wrapperCls_:null,wrapperStyle_:null,_vdom:{}};childUpdateCache={};currentUpdateDepth=null;resolveUpdateCache=[];get app(){return Neo.apps[this.appName]||null}get isVisible(){return this.mounted&&!this.hidden&&(!this.parent||this.parent.isVisible)}get listeners(){return this._listeners||{}}set listeners(e){this._listeners=e}get parent(){let e=this;return e.parentComponent||("document.body"===e.parentId?null:Neo.getComponent(e.parentId))}get rendered(){return this._rendered||!1}set rendered(e){let t=this;t._rendered=e,!0===e&&t.fire("rendered",t.id)}get vdom(){return this._vdom}set vdom(e){this.afterSetVdom(e,e)}addCls(e){let{cls:t}=this;r.add(t,e),this.cls=t}addDomListeners(e){Array.isArray(e)||(e=[e]);let t=this.domListeners;t.push(...e),this.domListeners=t}addStyle(e){return Neo.isString(e)&&(e=Neo.createStyleObject(e)),this.style=Object.assign(this.style,e)}addWrapperCls(e){let{wrapperCls:t}=this;r.add(t,e),this.wrapperCls=t}afterSetAppName(e,t){}afterSetCls(e,t){t=t||[];let o,n=this,d=n.vdom,i=n.getVdomRoot();d!==i?i.cls=[...e]:(o=r.union(n.wrapperCls,e),r.remove(o,r.difference(t,e)),d.cls=o),n.update()}afterSetConfig(e,t,o){let n=this;if(g.isUsingStateProviders&&n[v]&&void 0!==o){let o=n.bind?.[e];o?.twoWay&&this.getStateProvider()?.setData(o.key,t)}}afterSetDisabled(e,t){let o=this.cls;r[e?"add":"remove"](o,"neo-disabled"),this.cls=o}afterSetDomListeners(e,t){let o=this;(e?.[0]||t?.[0])&&n.updateDomListeners(o,e,t)}afterSetDroppable(e,t){let o=this;e&&!o.dropZone&&import("../draggable/DropZone.mjs").then((e=>{o.dropZone=Neo.create({module:e.default,appName:o.appName,owner:o,windowId:o.windowId,...o.dropZoneConfig})}))}afterSetFlex(e,t){isNaN(e)||(e=`${e} ${e} 0%`),this.configuredFlex=e,this.changeVdomRootKey("flex",e)}afterSetHasUnmountedVdomChanges(e,t){if(e||!e&&t){let t,n=o.getParentIds(this),d=0,i=n.length;for(;d<i;d++)t=Neo.getComponent(n[d]),t&&(t._hasUnmountedVdomChanges=e)}}afterSetHeight(e,t){this.configuredHeight=h(e),this.changeVdomRootKey("height",e)}afterSetHidden(e,t){let o=this,n=e?"hide":"show";e&&void 0===t&&"removeDom"===o.hideMode?o.vdom.removeDom=!0:(e||void 0!==t)&&o[n](),e||o.revertFocus(),o.fire(n,{id:o.id}),o.fire("hiddenChange",{id:o.id,oldValue:t,value:e})}afterSetHtml(e,t){this.changeVdomRootKey("html",e)}afterSetId(e,t){super.afterSetId(e,t),this.changeVdomRootKey("id",e),t&&o.unregister(t),e&&o.register(this)}afterSetIsLoading(e,t){if(e||void 0!==t){let o,n=this,{wrapperCls:d,vdom:i}=n;void 0!==t&&i.cn&&(o=i.cn.findLastIndex((e=>e.cls?.includes("neo-load-mask"))),-1!==o&&i.cn.splice(o,1)),e&&(i.cn||(i.cn=[]),i.cn.push(n.createLoadingMask(e))),r.toggle(d,"neo-masked",e),n.set({vdom:i,wrapperCls:d})}}afterSetIsVdomUpdating(e,t){this.currentUpdateDepth=e?this.updateDepth:null}afterSetMaxHeight(e,t){this.configuredMaxHeight=h(e),this.changeVdomRootKey("maxHeight",e)}afterSetMaxWidth(e,t){this.configuredMaxWidth=h(e),this.changeVdomRootKey("maxWidth",e)}afterSetMinHeight(e,t){this.configuredMinHeight=h(e),this.changeVdomRootKey("minHeight",e)}afterSetMinWidth(e,t){this.configuredMinWidth=h(e),this.changeVdomRootKey("minWidth",e)}afterSetMounted(e,t){if(void 0!==t){let t=this,{id:o,windowId:d}=t;e?(t.hasBeenMounted=!0,t.domListeners?.length>0&&t.timeout(150).then((()=>{n.mountDomListeners(t)})),t.doResolveUpdateCache(),t.floating&&(t.alignTo(),t.focus(o,!0)),t.fire("mounted",t.id)):t.revertFocus()}}afterSetReference(e,t){e&&this.changeVdomRootKey("data-ref",e)}async afterSetResponsive(e,t){if(e&&!this.getPlugin("responsive")){let t=this,o=await import("../../src/plugin/Responsive.mjs"),n=t.plugins||[];n.push({module:o.default,appName:t.appName,value:e}),t.plugins=n}}afterSetRole(e,t){this.changeVdomRootKey("role",e)}afterSetScrollable(e,t){if(void 0===t&&!e)return;let o=this;if(t){let e="overflow";Neo.isBoolean(t)||(e+=Neo.capitalize(t)),o.removeStyle([e])}if(!Neo.isEmpty(e)){let t="overflow";e&&!Neo.isBoolean(e)&&(t+=Neo.capitalize(e)),e?(o.addStyle(t+":auto"),o.addCls("neo-scrollable")):o.removeCls("neo-scrollable")}}afterSetStyle(e,t){(e||void 0!==t)&&this.updateStyle()}afterSetTag(e,t){e&&this.changeVdomRootKey("tag",e)}afterSetTheme(e,t){if(e||void 0!==t){let o=this,{cls:n}=o,d=!1;t&&n.includes(t)&&(r.remove(n,t),d=!0),e!==o.parent?.theme&&(e&&r.add(n,e),d=!0),d&&(o.cls=n)}}afterSetTooltip(e,t){t?.destroy?.(),e&&(Neo.ns("Neo.tooltip.Base")?this.createTooltip(e):import("../tooltip/Base.mjs").then((()=>{this.createTooltip(e)})))}afterSetUi(e,t){let o=this,n=o.cls;t&&r.remove(n,`neo-${o.ntype}-${t}`),e&&""!==e&&r.add(n,`neo-${o.ntype}-${e}`),o.cls=n}afterSetVdom(e,t){this.updateVdom()}afterSetVnode(e,t){void 0!==t&&this.syncVnodeTree()}afterSetWidth(e,t){this.configuredWidth=h(e),this.changeVdomRootKey("width",e)}afterSetWindowId(e,t){let o=this,n=o.controller;e&&(g.insertThemeFiles(e,o.__proto__),n&&(n.windowId=e)),t&&(o.isVdomUpdating=!1)}afterSetWrapperCls(e,t){t=t||[],e=e||[];let o=this,{vdom:n}=o,d=o.getVdomRoot(),i=n.cls||[];n===d?(i=r.union(i,e),r.remove(i,r.difference(t,e)),n.cls=i):(e=e||[],t&&r.remove(i,t),r.add(i,e),n.cls=i),o.update()}afterSetWrapperStyle(e,t){(e||void 0!==t)&&this.updateStyle()}async alignTo(e={}){const t=this,o={...t.align,...e,id:t.id,configuredFlex:t.configuredFlex,configuredWidth:t.configuredWidth,configuredHeight:t.configuredHeight,configuredMinWidth:t.configuredMinWidth,configuredMinHeight:t.configuredMinHeight,configuredMaxWidth:t.configuredMaxWidth,configuredMaxHeight:t.configuredMaxHeight};o.target&&await Neo.main.DomAccess.align(o)}beforeGetCls(e){return e?[...e]:[]}beforeGetData(e){return this.getStateProvider().getHierarchyData()}beforeGetStyle(e){return{...e}}beforeGetWrapperCls(e){return e?[...e]:[]}beforeGetWrapperStyle(e){return{...Object.assign(this.vdom.style||{},e)}}beforeSetAlign(e,t){return"string"==typeof e&&(e={edgeAlign:e}),Neo.merge({},e,this.constructor.config.align)}beforeSetCls(e,t){return r.union(e||[],this.baseCls,this.getBaseClass())}beforeSetController(e,o){return o?.destroy(),e?t.beforeSetInstance(e,"Neo.controller.Component",{component:this,windowId:this.windowId}):e}beforeSetDomListeners(e,t){return Neo.isObject(e)&&(e=[e]),e||[]}beforeSetHideMode(e,t){return this.beforeSetEnumValue(e,t,"hideMode")}beforeSetKeys(e,o){return o?.destroy(),e&&(e=t.beforeSetInstance(e,d,{keyDownEventBubble:!0,keys:e})),e}beforeSetPlugins(e,o){return Array.isArray(e)&&e.forEach(((o,n)=>{e[n]=t.beforeSetInstance(o,null,{owner:this})})),e}beforeSetSilentVdomUpdate(e,t){return!0===e?Neo.isNumber(t)?t+1:1:Neo.isNumber(t)&&t>0?t-1:0}beforeSetStateProvider(e,o){if(o?.destroy(),e){let o=this,n={component:o};return o.modelData&&(n.data=o.modelData),t.beforeSetInstance(e,"Neo.state.Provider",n)}return null}beforeSetUpdateDepth(e,t){return void 0===t?e:-1===t||-1===e?-1:Math.max(e,t)}changeVdomRootKey(e,t){let o=this.getVdomRoot();t?o[e]=t:delete o[e],this.update()}createLoadingMask(e){return{cls:["neo-load-mask"],cn:[{cls:["neo-load-mask-body"],cn:[{cls:this.loadingSpinnerCls},{cls:["neo-loading-message"],html:e,removeDom:!Neo.isString(e)}]}]}}createTooltip(e){"string"==typeof e&&(e={text:e});let t=this;e.ownInstance?t._tooltip=Neo.create("Neo.tooltip.Base",{...e,appName:t.appName,componentId:t.id,windowId:t.windowId}):(t._tooltip=e,Neo.tooltip.Base.createSingleton(t.app),t.addCls("neo-uses-shared-tooltip"),t.update())}createVdomReference(){let e=this,t={componentId:e.id},o=e.vdom.id;return o&&e.id!==o&&(t.id=o),t}destroy(e=!1,t=!1){let n,d=this,{parent:i,parentId:r}=d,s=i?.getStateProvider();d.revertFocus(),d.domListeners=[],d.controller=null,d.reference&&d.getController()?.removeReference(d),d.stateProvider=null,d.bind&&s?.removeBindings(d.id),d.plugins?.forEach((e=>{e.destroy()})),e&&r&&("document.body"===r?Neo.applyDeltas(d.appName,{action:"removeNode",id:d.vdom.id}):(n=i.vdom,p.removeVdomChild(n,d.vdom.id),i[t?"_vdom":"vdom"]=n)),o.unregister(d),super.destroy(),d.onFocusLeave=Neo.emptyFn,d.unmount=Neo.emptyFn}doResolveUpdateCache(){let e=this;e.resolveUpdateCache&&(e.resolveUpdateCache.forEach((e=>e())),e.resolveUpdateCache=[])}down(e,t=!0){return o.down(this,e,t)}#e(e,t){let n,d=this,{vdom:i,vnode:r}=d,s={};g.isSharedWorker&&(s.appName=d.appName,s.windowId=d.windowId),d.isVdomUpdating=!0,d._needsVdomUpdate=!1,d.afterSetNeedsVdomUpdate?.(!1,!0),s.vdom=o.getVdomTree(i,d.updateDepth),s.vnode=o.getVnodeTree(r,d.updateDepth),d._updateDepth=d.constructor.config.updateDepth,Neo.vdom.Helper.update(s).catch((e=>{d.isVdomUpdating=!1,t?.()})).then((t=>{d.id&&(d.vnode=t.vnode,d.isVdomUpdating=!1,n=t.deltas,!Neo.config.useVdomWorker&&n.length>0?Neo.applyDeltas(d.appName,n).then((()=>{d.resolveVdomUpdate(e)})):d.resolveVdomUpdate(e))}))}focus(e=this.id,t=!1){Neo.main.DomAccess.focus({children:t,id:e,windowId:this.windowId})}getBaseClass(){const e=[];return this.floating&&e.push("neo-floating"),e}getConfigInstanceByNtype(e,t){let o=this,n=o[e],{parentComponent:d}=o;return!n||t&&t!==n.ntype?(!d&&o.parentId&&(d=o.parent||Neo.get(o.parentId)),d?d.getConfigInstanceByNtype(e,t):null):n}getController(e){let t,o=this;return!e&&(t=o[u],t)||(t=o.getConfigInstanceByNtype("controller",e),e||(o[u]=t)),t}async getDomRect(e=this.id,t=this.appName){let o=await Neo.main.DomAccess.getBoundingClientRect({appName:t,id:e,windowId:this.windowId});return Array.isArray(o)?o.map((e=>a.clone(e))):a.clone(o)}getMountedParentId(){let e=this.parentId,t=Neo.getComponent(e),o=t?.getVdomItemsRoot?.();return o?o.id:e}getMountedParentIndex(){let e,t=this.parent,o=t?.items||[],n=0,d=0,i=o.length;for(;n<i;n++){if(e=o[n],e===this)return d;e.hidden||"removeDom"!==e.hideMode||d++}}getParents(){return o.getParents(this)}getPlugin(e){Neo.isString(e)&&(e.startsWith("plugin-")||(e="plugin-"+e),e={ntype:e});let t,o=this;for(const n of o.plugins||[]){t=!0;for(const o in e)if(n[o]!==e[o]){t=!1;break}if(t)return n}return null}getReference(e){return this.down({reference:e})}getState(...e){return this.getStateProvider().getData(...e)}getStateProvider(e){if(!g.isUsingStateProviders)return null;let t,o=this;return!e&&(t=o[c],t)||(t=o.getConfigInstanceByNtype("stateProvider",e),e||(o[c]=t)),t}getTheme(){let e,t,o=this,n="neo-theme-";for(const e of o.cls||[])if(e.startsWith(n))return e;if(e=o.app?.mainView,e){t=p.getParentNodes(e.vdom,o.id);for(const e of t||[])for(const t of e.cls||[])if(t.startsWith(n))return t}return Neo.config.themes?.[0]}getVdomChild(e,t=this.vdom){return p.find(t,e)?.vdom}getVdomRoot(){return this.vdom}getVnodeRoot(){return this.vnode}hasUpdateCollision(e,t){return-1===e||t<e}hide(e){let t=this;if("visibility"!==t.hideMode){let o=function(){"document.body"!==t.parentId?(t.vdom.removeDom=!0,t.parent.updateDepth=2,t.parent.update()):t.unmount()};e?t.timeout(e).then(o):o()}else{let e=t.style;e.visibility="hidden",t.style=e}t._hidden=!0}init(){this.autoRender&&this.render()}initConfig(e,t){super.initConfig(e,t);this.getStateProvider()?.parseConfig(this)}isFloating(){let e=this;return!!e.floating||!!e.parent&&e.parent.floating}isParentUpdating(e=this.parentId,t,o=1){if("document.body"!==e){let n=this,d=Neo.getComponent(e);if(d)return d.isVdomUpdating?!!n.hasUpdateCollision(d.currentUpdateDepth,o)&&(Neo.config.logVdomUpdateCollisions&&console.warn("vdom parent update conflict with:",d,"for:",n),d.childUpdateCache[n.id]={distance:o,resolve:t},t&&n.resolveUpdateCache.push(t),!0):n.isParentUpdating(d.parentId,t,o+1)}return!1}async measure(e){if(null!=e)if(e.endsWith("px"))e=parseFloat(e);else if(f.test(e)){let{id:t,windowId:o}=this;e=await Neo.main.DomAccess.measure({id:t,value:e,windowId:o})}else isNaN(e)||(e=parseFloat(e));return e}mergeConfig(...e){let t=this,o=super.mergeConfig(...e),n={...t._vdom||{},...o.vdom||{}};return t._vdom=Neo.clone(n,!0,!0),o.style&&(t.style="Object"===Neo.typeOf(o.style)?{...o.style,...t.constructor.config.style}:o.style),t.wrapperStyle=Neo.clone(o.wrapperStyle,!1),delete o.style,delete o._vdom,delete o.vdom,delete o.wrapperStyle,o}async mount(){let e,t,n=this;if(!n.vnode)throw new Error("Component vnode must be generated before mounting, use Component.render()");n.hasUnmountedVdomChanges?(n.hasUnmountedVdomChanges=!1,t=o.getChildIds(n.vnode),t.forEach((t=>{e=Neo.getComponent(t),e&&(e._hasUnmountedVdomChanges=!1)})),n.render(!0)):(await g.promiseMessage("main",{action:"mountDom",appName:n.appName,id:n.id,html:n.vnode.outerHTML,parentId:n.getMountedParentId(),parentIndex:n.getMountedParentIndex()}),delete n.vdom.removeDom,await n.timeout(30),n.mounted=!0)}needsParentUpdate(e=this.parentId,t,o=1){if("document.body"!==e){let n=this,d=Neo.getComponent(e);if(d)return d.needsVdomUpdate&&n.hasUpdateCollision(d.updateDepth,o)?(d.resolveUpdateCache.push(...n.resolveUpdateCache),t&&d.resolveUpdateCache.push(t),n.resolveUpdateCache=[],!0):n.needsParentUpdate(d.parentId,t,o+1)}return!1}onConstructed(){super.onConstructed(),this.keys?.register(this)}onFocusEnter(e){this.focusEnterData=e}onFocusLeave(e){this.focusEnterData=null}onRender(e,t){let n=this,{app:d}=n;if(n.rendering=!1,d){d.rendered||(d.rendering=!1,d.rendered=!0,d.fire("render")),n.vnode=e;let i,r=o.getChildIds(e),s=0,a=r.length;for(;s<a;s++)i=Neo.getComponent(r[s]),i&&(i.rendered=!0);n._rendered=!0,n.fire("rendered",n.id),t&&(n.mounted=!0,d.mounted||(d.mounted=!0,d.fire("mounted")))}}promiseUpdate(){return new Promise(((e,t)=>{this.updateVdom(e,t)}))}removeCls(e){let t=this.cls;r.remove(t,e),this.cls=t}removeDomListeners(e){Array.isArray(e)||(e=[e]);let t,o,{domListeners:n}=this;e.forEach((e=>{for(t=0,o=n.length;t<o;t++)if(Neo.isEqual(e,n[t])){n.splice(t,1);break}})),this.domListeners=n}removeStyle(e){Array.isArray(e)||(e=[e]);let{style:t}=this,o=!1;return Object.keys(t).forEach((n=>{e.indexOf(n)>-1&&(delete t[n],o=!0)})),o&&(this.style=t),t}async render(e){let t=this,n=e||t.autoMount,{app:d}=t,{useVdomWorker:i}=Neo.config;if(n&&0!==g.countLoadingThemeFiles)g.on("themeFilesLoaded",(function(){!t.mounted&&t.render(e)}),t,{once:!0});else if(t.rendering=!0,d.rendered||(d.rendering=!0),t.vdom){t.isVdomUpdating=!0,delete t.vdom.removeDom,t._needsVdomUpdate=!1,t.afterSetNeedsVdomUpdate?.(!1,!0);const e=await Neo.vdom.Helper.create({appName:t.appName,autoMount:n,parentId:n?t.getMountedParentId():void 0,parentIndex:n?t.getMountedParentIndex():void 0,windowId:t.windowId,...o.getVdomTree(t.vdom)});t.onRender(e,!!i&&n),t.isVdomUpdating=!1,n&&!i&&t.mount(),t.resolveVdomUpdate()}}resolveVdomUpdate(e){let t,o=this,n=!Neo.isEmpty(o.childUpdateCache);o.doResolveUpdateCache(),e?.(),o.needsVdomUpdate?(n&&(Object.entries(o.childUpdateCache).forEach((([e,n])=>{t=Neo.getComponent(e),t&&(n.resolve&&r.add(o.resolveUpdateCache,n.resolve),-1!==o.updateDepth&&(-1===t.updateDepth?o.updateDepth=-1:o.updateDepth=o.updateDepth+n.distance+t.updateDepth-1))})),o.childUpdateCache={}),o.update()):n&&(Object.keys(o.childUpdateCache).forEach((e=>{Neo.getComponent(e)?.update()})),o.childUpdateCache={})}revertFocus(){let e=this.focusEnterData?.relatedTarget;this.containsFocus&&e&&Neo.getComponent(e.id)?.focus()}set(e={},t=!1){let o=this,n=!1===e.hidden&&e.hidden!==o.hidden;return o.silentVdomUpdate=!0,super.set(e),o.silentVdomUpdate=!1,t||!o.needsVdomUpdate?Promise.resolve():n?(o.show(),Promise.resolve()):o.promiseUpdate()}setSilent(e={}){return this.set(e,!0)}setState(...e){this.getStateProvider().setData(...e)}show(){let e=this;if("visibility"!==e.hideMode)delete e.vdom.removeDom,e.silentVdomUpdate?e.needsVdomUpdate=!0:"document.body"!==e.parentId?(e.parent.updateDepth=2,e.parent.update()):!e.mounted&&e.render(!0);else{let t=e.style;delete t.visibility,e.style=t}e._hidden=!1}syncVdomIds(e=this.vnode,t=this.vdom,o=!1){p.syncVdomIds(e,t,o)}syncVnodeTree(e=this.vnode){let t,n=this,d=o.getChildren(n),i=!1,r={};n.syncVdomIds(),e&&n.id!==e.id&&o.registerWrapperNode(e.id,n),d.forEach((e=>{t=m.find(n.vnode,e.vdom.id)?.vnode,t&&(r[e.id]=t,e.id!==t.id&&o.registerWrapperNode(t.id,e))})),d.forEach((e=>{t=r[e.id],t?(e._vnode=o.addVnodeComponentReferences(t,e.id),e.rendered||(e._rendered=!0,e.fire("rendered",e.id)),e.mounted=!0):console.warn("syncVnodeTree: Could not replace the child vnode for",e.id)})),n._vnode=e?o.addVnodeComponentReferences(e,n.id):null}toggleCls(e,t){let o=this.cls;r.toggle(o,e,t),this.cls=o}unmount(){let e=this;e.vdom.removeDom=!0,e._hidden=!0,e.mounted=!1,Neo.applyDeltas(e.appName,{action:"removeNode",id:e.vdom.id})}up(e){return o.up(this.id,e)}update(){this.afterSetVdom(this.vdom,null)}updateStyle(){let e=this,{vdom:t}=e,o=e.getVdomRoot();t!==o?(t.style=e.wrapperStyle,o.style=e.style):t.style={...e.wrapperStyle,...e.style},e.update()}updateVdom(e,t){let o=this,{app:n,mounted:d,parentId:i,vnode:r}=o;o.isVdomUpdating||o.silentVdomUpdate?(e&&o.resolveUpdateCache.push(e),o.needsVdomUpdate=!0):d||!o.isConstructed||o.hasRenderingListener||!0!==n?.rendering?(!e||d&&r||o.resolveUpdateCache.push(e),!o.needsParentUpdate(i,e)&&!o.isParentUpdating(i,e)&&d&&r&&(0!==g.countLoadingThemeFiles?g.on("themeFilesLoaded",(function(){o.updateVdom(e,t)}),o,{once:!0}):o.#e(e,t))):(o.hasRenderingListener=!0,n.on("mounted",(()=>{o.timeout(50).then((()=>{o.vnode&&o.updateVdom(e,t)}))}),o,{once:!0})),o.hasUnmountedVdomChanges=!d&&o.hasBeenMounted}async waitForDomRect({appName:e=this.appName,attempts:t=10,delay:o=50,id:n=this.id}){let d=this,i=await d.getDomRect(n,e),r=!1;return Array.isArray(i)?i.forEach((e=>{(e.height<1||e.width<1)&&(r=!0)})):(i.height<1||i.width<1)&&(r=!0),r&&t>0?(await d.timeout(o),await d.waitForDomRect({appName:e,attempts:t-1,delay:o,id:n})):i}});