import e from"../container/Base.mjs";import o from"../util/ClassSystem.mjs";import t from"../util/Css.mjs";import r from"../util/Array.mjs";import s from"../data/Store.mjs";import l from"./Body.mjs";import*as a from"./header/_export.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.table.Container",ntype:"table-container",baseCls:["neo-table-container"],bodyConfig:null,bodyId_:null,cellEditing_:!1,columnDefaults:null,columns_:[],headerToolbarConfig:null,headerToolbarId_:null,layout:"base",scrollbarsCssApplied:!1,showHeaderFilters_:!1,sortable_:!0,store_:null,useCustomScrollbars_:!0,items:null,_vdom:{cls:["neo-table-wrapper"],cn:[{tag:"table",cn:[]}]}};get body(){return Neo.getComponent(this.bodyId)||Neo.get(this.bodyId)}get headerToolbar(){return Neo.getComponent(this.headerToolbarId)||Neo.get(this.headerToolbarId)}construct(e){super.construct(e);let o=this;o.bodyId=Neo.getId("table-body"),o.headerToolbarId=Neo.getId("table-header-toolbar"),o.items=[{module:a.Toolbar,id:o.headerToolbarId,showHeaderFilters:o.showHeaderFilters,sortable:o.sortable,...o.headerToolbarConfig},{module:l,containerId:o.id,id:o.bodyId,store:o.store,...o.bodyConfig}],o.vdom.id=o.getWrapperId(),o.createColumns(o.columns)}afterSetCellEditing(e,o){e&&import("./plugin/CellEditing.mjs").then(e=>{let o=this,{appName:t}=o,r=o.plugins||[];r.push({module:e.default,appName:t}),o.plugins=r})}afterSetColumns(e,o){if(Array.isArray(o)&&o.length>0){let o=this,{headerToolbar:t}=o;t&&(t.items=e,t.createItems()),o.body?.createViewData()}}afterSetShowHeaderFilters(e,o){void 0!==o&&(this.headerToolbar.showHeaderFilters=e)}afterSetSortable(e,o){void 0!==o&&(this.headerToolbar.sortable=e)}afterSetStore(e,o){let t=this,r={filter:t.onStoreFilter,load:t.onStoreLoad,scope:t};e?.on(r),o?.un(r),t.body&&(t.body.store=e)}afterSetUseCustomScrollbars(e,o){!0===e&&(this.vdom.cls=r.union(this.vdom.cls,["neo-use-custom-scrollbar"]))}applyCustomScrollbarsCss(){let e=this,o=e.getWrapperId(),r=[];e.dockLeftMargin&&r.push("#"+o+"::-webkit-scrollbar-track:horizontal {margin-left: "+e.dockLeftMargin+"px;}"),e.dockRightMargin&&r.push("#"+o+"::-webkit-scrollbar-track:horizontal {margin-right: "+e.dockRightMargin+"px;}"),r.length>0&&t.insertRules(e.windowId,r),e.scrollbarsCssApplied=!0}beforeSetBodyId(e,o){return e||o}beforeSetColumns(e,o){return this.configsApplied?this.createColumns(e):e}beforeSetHeaderToolbarId(e,o){return e||o}beforeSetStore(e,t){return e&&(e=o.beforeSetInstance(e,s)),e}bulkUpdateRecords(e){let{body:o,store:t}=this,{keyProperty:r}=t;o&&(o.silentVdomUpdate=!0,e.forEach(e=>{t.get(e[r])?.set(e)}),o.silentVdomUpdate=!1,o.update())}createColumns(e){let o,t=this,{columnDefaults:r}=t,s=t.store?.sorters;return e&&e.length||Neo.logError("Attempting to create a table.Container without defined columns",t.id),e.forEach(e=>{o=e.renderer,r&&Neo.assignDefaults(e,r),e.dock&&!e.width&&Neo.logError("Attempting to create a docked column without a defined width",e,t.id),o&&Neo.isString(o)&&t[o]&&(e.renderer=t[o]),s?.[0]&&e.dataField===s[0].property&&(e.isSorted=s[0].direction),e.listeners={sort:t.onSortColumn,scope:t}}),t.items[0].items=e,e}getVdomRoot(){return this.vdom.cn[0]}getVdomItemsRoot(){return this.vdom.cn[0]}getVnodeRoot(){return this.vnode.childNodes[0]}getWrapperId(){return`${this.id}__wrapper`}onSortColumn(e){let o=this;o.store.sort(e),o.removeSortingCss(e.property),e.direction&&o.body.onStoreLoad()}onStoreFilter(){this.onStoreLoad()}onStoreLoad(){let e=this;e.useCustomScrollbars&&!1===e.scrollbarsCssApplied&&e.applyCustomScrollbarsCss(),e.store.sorters?.length<1&&e.removeSortingCss()}removeSortingCss(e){this.headerToolbar.items.forEach(o=>{o.dataField!==e&&o.removeSortingCss()})}});