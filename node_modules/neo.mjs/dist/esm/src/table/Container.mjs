import e from"../container/Base.mjs";import t from"../util/ClassSystem.mjs";import o from"../util/Css.mjs";import r from"../util/Array.mjs";import s from"../data/Store.mjs";import l from"./View.mjs";import*as i from"./header/_export.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.table.Container",ntype:"table-container",baseCls:["neo-table-container"],cellEditing_:!1,columnDefaults:null,columns_:[],headerToolbarConfig:null,headerToolbarId_:null,layout:"base",scrollbarsCssApplied:!1,showHeaderFilters_:!1,sortable_:!0,store_:null,useCustomScrollbars_:!0,viewConfig:null,viewId_:null,items:null,_vdom:{cls:["neo-table-wrapper"],cn:[{tag:"table",cn:[]}]}};get headerToolbar(){return Neo.getComponent(this.headerToolbarId)||Neo.get(this.headerToolbarId)}get view(){return Neo.getComponent(this.viewId)||Neo.get(this.viewId)}construct(e){super.construct(e);let t=this;t.headerToolbarId=Neo.getId("table-header-toolbar"),t.viewId=Neo.getId("table-view"),t.items=[{module:i.Toolbar,id:t.headerToolbarId,showHeaderFilters:t.showHeaderFilters,sortable:t.sortable,...t.headerToolbarConfig},{module:l,containerId:t.id,id:t.viewId,store:t.store,...t.viewConfig}],t.vdom.id=t.getWrapperId(),t.createColumns(t.columns)}afterSetCellEditing(e,t){e&&import("./plugin/CellEditing.mjs").then(e=>{let t=this,{appName:o}=t,r=t.plugins||[];r.push({module:e.default,appName:o}),t.plugins=r})}afterSetColumns(e,t){if(Array.isArray(t)&&t.length>0){let t=this,{headerToolbar:o}=t;o&&(o.items=e,o.createItems()),t.view?.createViewData()}}afterSetShowHeaderFilters(e,t){void 0!==t&&(this.headerToolbar.showHeaderFilters=e)}afterSetSortable(e,t){void 0!==t&&(this.headerToolbar.sortable=e)}afterSetStore(e,t){let o=this,r={filter:o.onStoreFilter,load:o.onStoreLoad,scope:o};e?.on(r),t?.un(r),o.view&&(o.view.store=e)}afterSetUseCustomScrollbars(e,t){!0===e&&(this.vdom.cls=r.union(this.vdom.cls,["neo-use-custom-scrollbar"]))}applyCustomScrollbarsCss(){let e=this,t=e.getWrapperId(),r=[];e.dockLeftMargin&&r.push("#"+t+"::-webkit-scrollbar-track:horizontal {margin-left: "+e.dockLeftMargin+"px;}"),e.dockRightMargin&&r.push("#"+t+"::-webkit-scrollbar-track:horizontal {margin-right: "+e.dockRightMargin+"px;}"),r.length>0&&o.insertRules(e.windowId,r),e.scrollbarsCssApplied=!0}beforeSetColumns(e,t){return this.configsApplied?this.createColumns(e):e}beforeSetHeaderToolbarId(e,t){return e||t}beforeSetStore(e,o){return e&&(e=t.beforeSetInstance(e,s)),e}beforeSetViewId(e,t){return e||t}bulkUpdateRecords(e){let{store:t,view:o}=this,{keyProperty:r}=t;o&&(o.silentVdomUpdate=!0,e.forEach(e=>{t.get(e[r])?.set(e)}),o.silentVdomUpdate=!1,o.update())}createColumns(e){let t,o=this,{columnDefaults:r}=o,s=o.store?.sorters;return e&&e.length||Neo.logError("Attempting to create a table.Container without defined columns",o.id),e.forEach(e=>{t=e.renderer,r&&Neo.assignDefaults(e,r),e.dock&&!e.width&&Neo.logError("Attempting to create a docked column without a defined width",e,o.id),t&&Neo.isString(t)&&o[t]&&(e.renderer=o[t]),s?.[0]&&e.dataField===s[0].property&&(e.isSorted=s[0].direction),e.listeners={sort:o.onSortColumn,scope:o}}),o.items[0].items=e,e}getVdomRoot(){return this.vdom.cn[0]}getVdomItemsRoot(){return this.vdom.cn[0]}getVnodeRoot(){return this.vnode.childNodes[0]}getWrapperId(){return`${this.id}__wrapper`}onSortColumn(e){let t=this;t.store.sort(e),t.removeSortingCss(e.property),e.direction&&t.view.onStoreLoad()}onStoreFilter(){this.onStoreLoad()}onStoreLoad(){let e=this;e.useCustomScrollbars&&!1===e.scrollbarsCssApplied&&e.applyCustomScrollbarsCss(),e.store.sorters?.length<1&&e.removeSortingCss()}removeSortingCss(e){this.headerToolbar.items.forEach(t=>{t.dataField!==e&&t.removeSortingCss()})}});