import e from"./Base.mjs";import t from"../util/Rectangle.mjs";class n extends e{static config={className:"Neo.manager.Window",isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent),singleton:!0};construct(e){super.construct(e);let t=this;Neo.currentWorker.on({connect:t.onWindowConnect,disconnect:t.onWindowDisconnect,scope:t})}getWindowAt(e,t){let n=this.items.find(n=>n.outerRect?.intersects({bottom:t,right:e,x:e,y:t}));return n?n.id:null}calculateGeometry(e){const{innerHeight:n,innerWidth:o,mozInnerScreenX:r,mozInnerScreenY:i,outerHeight:c,outerWidth:s,screenLeft:a,screenTop:m}=e,d=(s-o)/2,u=c-n-d,l={bottom:d,left:d,right:d,top:u};let h,w;"number"==typeof r?(h=r,w=i):this.isSafari?(h=a+d,w=m+u):(h=a,w=m);return{chrome:l,innerRect:new t(h,w,o,n),outerRect:new t(h-d,w-u,s,c)}}onWindowConnect({appName:e,windowData:t,windowId:n}){let o=null,r=null,i=null;t&&({chrome:o,innerRect:r,outerRect:i}=this.calculateGeometry(t)),console.log("Window.onWindowConnect",{windowId:n,appName:e,chrome:o,innerRect:r,outerRect:i}),this.register({appName:e,chrome:o,id:n,innerRect:r,outerRect:i})}onWindowDisconnect({windowId:e}){this.unregister(e)}onWindowPositionChange(e){const t=this,n=t.get(e.windowId),{chrome:o,innerRect:r,outerRect:i}=t.calculateGeometry(e);n?(n.chrome=o,n.innerRect=r,n.outerRect=i):t.register({chrome:o,id:e.windowId,innerRect:r,outerRect:i})}toJSON(){return{className:this.className,windows:this.items.map(e=>({id:e.id,appName:e.appName,chrome:e.chrome,innerRect:e.innerRect,outerRect:e.outerRect}))}}}export default Neo.setupClass(n);