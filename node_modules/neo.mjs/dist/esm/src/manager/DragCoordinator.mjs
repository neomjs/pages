import e from"./Base.mjs";import t from"../util/Rectangle.mjs";import o from"./Window.mjs";class r extends e{static config={className:"Neo.manager.DragCoordinator",singleton:!0,sortZones:new Map};activeTargetZone=null;handleVoid(e,t,o){let r=this;r.activeTargetZone&&(r.activeTargetZone.onRemoteDragLeave(),r.activeTargetZone=null,e.resumeWindowDrag(t.reference||t.id,o))}onDragMove(e){let r,n=this,{draggedItem:a,offsetX:s,offsetY:i,proxyRect:g,screenX:d,screenY:c,sourceSortZone:l}=e,{sortGroup:Z}=l,m=o.getWindowAt(d,c);if(m&&m!==l.windowId&&(r=n.sortZones.get(Z)?.get(m),r)){let e=o.get(m),Z=d-e.innerRect.x,u=c-e.innerRect.y,v=new t(Z-s,u-i,g.width,g.height);if(r.acceptsRemoteDrag(Z,u))return n.activeTargetZone!==r&&(n.activeTargetZone?.onRemoteDragLeave(),n.activeTargetZone||l.suspendWindowDrag(a.reference||a.id),n.activeTargetZone=r),void r.onRemoteDragMove({draggedItem:a,localX:Z,localY:u,offsetX:s,offsetY:i,proxyRect:v})}n.handleVoid(l,a,g)}onDragEnd(e){let t=this;t.activeTargetZone&&(t.activeTargetZone.onRemoteDrop(e.draggedItem),e.sourceSortZone.onRemoteDropOut(e.draggedItem),t.activeTargetZone=null)}register(e){let t=this,{sortGroup:o,windowId:r}=e;o&&(t.sortZones.has(o)||t.sortZones.set(o,new Map),t.sortZones.get(o).set(r,e))}unregister(e){let t=this,{sortGroup:o,windowId:r}=e;if(o&&t.sortZones.has(o)){let e=t.sortZones.get(o);e.delete(r),0===e.size&&t.sortZones.delete(o)}}toJSON(){let e=this;return{className:e.className,activeTargetZone:e.activeTargetZone?{id:e.activeTargetZone.id,sortGroup:e.activeTargetZone.sortGroup,windowId:e.activeTargetZone.windowId}:null,sortZones:Array.from(e.sortZones.entries()).map(([e,t])=>({group:e,windows:Array.from(t.keys())}))}}}export default Neo.setupClass(r);