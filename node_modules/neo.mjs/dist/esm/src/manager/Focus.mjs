import t from"../core/Base.mjs";import o from"../util/Array.mjs";export default Neo.setupClass(class extends t{static config={className:"Neo.manager.Focus",history:[],lastFocusInDate:null,lastFocusOutDate:null,maxFocusInOutGap:50,maxHistoryLength:20,singleton:!0};addToHistory(t){let o=this.history;o.unshift(t),o.length>=this.maxHistoryLength&&o.pop()}focusEnter(t){this.setComponentFocus(t,!0),this.addToHistory(t)}focusLeave(t){this.setComponentFocus(t,!1)}focusMove(t){let e,a,s=this,{history:n}=s,c=t.componentPath,u=n[0].componentPath,h=o.difference(c,u),r=o.difference(u,c),i=o.intersection(c,u);s.setComponentFocus({componentPath:r,data:t.data},!1),s.setComponentFocus({componentPath:h,data:t.data},!0),i.forEach((o=>{e=Neo.getComponent(o),e&&(a={component:e,path:t.data.path,oldPath:n[0].data.path},e.onFocusMove?.(a),e.fire("focusMove",a),e.onFocusChange?.(a),e.fire("focusChange",a))})),s.addToHistory(t)}onFocusin(t){let o=this;o.lastFocusInDate=new Date,o.lastFocusOutDate&&o.lastFocusInDate-o.lastFocusOutDate<o.maxFocusInOutGap?o.focusMove(t):o.focusEnter(t)}onFocusout(t){let o=this;o.lastFocusOutDate=new Date,o.timeout(o.maxFocusInOutGap).then((()=>{o.lastFocusOutDate>o.lastFocusInDate&&o.focusLeave(t)}))}setComponentFocus(t,o){let e,a={relatedTarget:t.data.relatedTarget},s=t.componentPath.map((t=>Neo.getComponent(t)));s.forEach((t=>{t&&(t.containsFocus=o)})),s.forEach((s=>{s&&(a.component=s,a[o?"path":"oldPath"]=t.data.path,e=o?"onFocusEnter":"onFocusLeave",s[e]?.(a),s.fire(o?"focusEnter":"focusLeave",a),s.onFocusChange?.(a),s.fire("focusChange",a))}))}});