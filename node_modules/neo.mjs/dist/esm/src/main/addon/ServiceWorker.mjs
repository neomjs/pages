import e from"./Base.mjs";import r from"../../worker/Manager.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.main.addon.ServiceWorker"};construct(e){super.construct(e),this.registerServiceWorker()}async registerServiceWorker(){if("serviceWorker"in navigator){let e,s=this,{config:o}=Neo,{environment:i}=o,t="dist/esm"===i,a="development"===i||t,n=a?"ServiceWorker.mjs":"serviceworker.js",c=a?{type:"module"}:{},d=(a?o.basePath:o.workerBasePath)+n,{serviceWorker:g}=navigator;t&&(d=d.substring(6)),e=await g.register(d,c),window.addEventListener("beforeunload",s.onBeforeUnload.bind(s)),await g.ready,g.onmessage=r.onWorkerMessage.bind(r),r.getWorker("service")||(r.serviceWorker=e.active),r.sendMessage("service",{action:"registerNeoConfig",data:o})}}onBeforeUnload(){r.sendMessage("service",{action:"unregisterPort"})}});