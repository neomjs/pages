import e from"./Base.mjs";import r from"../../worker/Manager.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.main.addon.ServiceWorker"};construct(e){super.construct(e),this.registerServiceWorker()}async registerServiceWorker(){if("serviceWorker"in navigator){let e,o=this,{config:s}=Neo,{environment:i}=s,a="development"===i||"dist/esm"===i,t=a?"ServiceWorker.mjs":"serviceworker.js",n=a?{type:"module"}:{},c=(a?s.basePath:s.workerBasePath)+t,{serviceWorker:d}=navigator;e=await d.register(c,n),window.addEventListener("beforeunload",o.onBeforeUnload.bind(o)),e.addEventListener("updatefound",(()=>{window.location.reload()})),await d.ready,d.onmessage=r.onWorkerMessage.bind(r),r.getWorker("service")||(r.serviceWorker=e.active),r.sendMessage("service",{action:"registerNeoConfig",data:s})}}onBeforeUnload(){r.sendMessage("service",{action:"unregisterPort"})}});