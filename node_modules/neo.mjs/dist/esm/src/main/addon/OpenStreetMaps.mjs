import e from"./Base.mjs";import o from"../DomAccess.mjs";import r from"../DomEvents.mjs";import t from"../../core/Observable.mjs";export default Neo.setupClass(class extends e{static observable=!0;static config={className:"Neo.main.addon.OpenStreetMaps",interceptRemotes:["create"],remote:{app:["addMarker","create","destroyMarkers","geocode","hideMarker","panTo","removeMap","removeMarker","setCenter","setZoom","showMarker"]}};maps={};markers={};vectorLayers={};vectorSources={};addMarker(e){}async create(e){let o=this,{id:r}=e;if(globalThis.ol||await o.loadFiles(),!r)return void console.error("Map ID is not provided");let t=document.getElementById(r);window.getComputedStyle(t);if(t)try{let a={center:[e.center.lng,e.center.lat],zoom:e.zoom||10,minZoom:null!=e.minZoom?e.minZoom:0,maxZoom:null!=e.maxZoom?e.maxZoom:28},n=new ol.View(a),s=new ol.layer.Tile({source:new ol.source.OSM}),l=[];e.fullscreenControl&&l.push(new ol.control.FullScreen);let i=new ol.Map({controls:l,target:t,layers:[s],view:n});return e.fullscreenControl&&i.addControl(new ol.control.FullScreen),o.maps[r]=i,n.on("change:zoom",()=>{o.onMapZoomChange(i,r)}),i.on("click",e=>{i.forEachFeatureAtPixel(e.pixel,r=>{r.get("neoId")&&o.onMarkerClick(r,e)})}),{success:!0,mapId:r}}catch(e){return console.error(`Failed to create OpenStreetMaps map "${r}":`,e),{success:!1,error:e.message,mapId:r}}else console.error(`Map container element with id "${r}" not found`)}destroyMarkers(e){}async geocode(e){}hideMarker(e){}async loadFiles(){await super.loadFiles();let e=Neo.config.openLayersVersion||"10.6.1",r=Neo.config.openLayersBasePath||`https://cdn.jsdelivr.net/npm/ol@${e}`,t=`${r}/ol.css`,a=`${r}/dist/ol.js`;try{if(await Promise.all([o.loadStylesheet(t),o.loadScript(a)]),"undefined"==typeof ol||!ol.Map||!ol.source||!ol.source.OSM)throw new Error("OpenLayers failed to load completely");ol.proj.useGeographic()}catch(e){throw console.error("Failed to load OpenLayers:",e),e}}onMapZoomChange(e,o){let r=this,t=e.getView(),a=t.getZoom(),n=t.getCenter(),s={lng:n[0],lat:n[1]};r.fire("zoomChanged",{mapId:o,zoom:a,center:s}),r.maps[o].neoData||(r.maps[o].neoData={}),r.maps[o].neoData.currentZoom=a,r.maps[o].neoData.currentCenter=s}onMarkerClick(e,o){}panTo(e){let o=this,{mapId:r,position:t,duration:a=1e3}=e;if(!r||!o.maps[r])return console.error(`Map with id "${r}" not found`),{success:!1,error:`Map with id "${r}" not found`};if(!t||void 0===t.lat||void 0===t.lng)return console.error("Invalid position data. Expected object with lat and lng properties"),{success:!1,error:"Invalid position data"};try{let e=o.maps[r].getView(),n=[t.lng,t.lat];return e.animate({center:n,duration:a,easing:ol.easing.easeOut}),{success:!0,mapId:r,position:t}}catch(e){return console.error(`Failed to pan map "${r}":`,e),{success:!1,error:e.message,mapId:r}}}removeMap(e){}removeMarker(e){}setCenter(e){}setZoom(e){let o=this,{id:r,value:t,duration:a=1e3}=e;if(!r||!o.maps[r])return console.error(`Map with id "${r}" not found`),{success:!1,error:`Map with id "${r}" not found`};if(void 0===t||"number"!=typeof t)return console.error("Invalid zoom level. Expected a number"),{success:!1,error:"Invalid zoom level"};try{let e=o.maps[r].getView(),n=e.getMinZoom(),s=e.getMaxZoom();return void 0!==n&&t<n&&(console.warn(`Zoom level ${t} is below minimum ${n}, setting to minimum`),t=n),void 0!==s&&t>s&&(console.warn(`Zoom level ${t} is above maximum ${s}, setting to maximum`),t=s),e.animate({zoom:t,duration:a,easing:ol.easing.easeOut}),{success:!0,mapId:r,zoom:t}}catch(e){return console.error(`Failed to set zoom for map "${r}":`,e),{success:!1,error:e.message,mapId:r}}}showMarker(e){}getDefaultMarkerStyle(){return new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"data:image/svg+xml;base64,"+btoa('\n                    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                        <path fill="#FF0000" stroke="#FFFFFF" stroke-width="2" \n                              d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>\n                        <circle fill="#FFFFFF" cx="12" cy="9" r="3"/>\n                    </svg>\n                ')})})}});