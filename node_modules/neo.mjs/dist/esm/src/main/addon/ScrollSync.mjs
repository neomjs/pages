import t from"./Base.mjs";import e from"../DomAccess.mjs";export default Neo.setupClass(class extends t{static config={className:"Neo.main.addon.ScrollSync",remote:{app:["register","unregister"]}};isTouching=!1;registrations=new Map;construct(t){super.construct(t);let e=this;document.body.addEventListener("touchstart",e.onTouchStart.bind(e),{passive:!0}),document.body.addEventListener("touchend",e.onTouchEnd.bind(e),{passive:!0}),document.body.addEventListener("touchcancel",e.onTouchEnd.bind(e),{passive:!0})}onTouchStart(){this.isTouching=!0}onTouchEnd(){this.isTouching=!1}addScrollListener(t,s,r,o){let i=this.onScroll.bind(this,s,r,o);return e.getElement(t)?.addEventListener("scroll",i),i}onScroll(t,s,r,o){if(this.isTouching&&r)return;let i=e.getElement(t),{scrollLeft:n,scrollTop:l}=o.target;i&&("both"===s?i.scrollTo({behavior:"instant",left:n,top:l}):"horizontal"===s?i.scrollLeft=n:"vertical"===s&&(i.scrollTop=l))}register({direction:t="vertical",fromId:e,id:s,toId:r,twoWay:o=!0}){let i,n=this;if(n.registrations.has(s)){const i=n.registrations.get(s);if(i.direction===t&&i.fromId===e&&i.toId===r&&i.twoWay===o)return;n.unregister({id:s})}i={direction:t,fromId:e,id:s,toId:r,twoWay:o,listeners:[]},i.listeners.push({listener:n.addScrollListener(e,r,t,!1),fromId:e}),o&&i.listeners.push({listener:n.addScrollListener(r,e,t,!0),fromId:r}),n.registrations.set(s,i)}unregister({id:t}){let s=this,r=s.registrations.get(t);r&&(r.listeners.forEach(t=>{e.getElement(t.fromId)?.removeEventListener("scroll",t.listener)}),s.registrations.delete(t))}});