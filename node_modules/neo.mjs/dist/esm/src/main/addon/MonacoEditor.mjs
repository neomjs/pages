import e from"./Base.mjs";import t from"../DomAccess.mjs";import a from"../DomEvents.mjs";class o extends e{static config={className:"Neo.main.addon.MonacoEditor",libraryBasePath:Neo.config.basePath+"node_modules/monaco-editor/min/vs",remote:{app:["createInstance","destroyInstance","getValue","layoutEditor","setLanguage","setTheme","setValue","updateOptions"]}};map={};createInstance(e){let a,o,i=this,{id:n}=e;if(!i.isReady)return i.cacheMethodCall({fn:"createInstance",data:e});delete e.appName,delete e.id,o=t.getElement(n),o?(a=i.map[n]=monaco.editor.create(o,e),a.getModel().onDidChangeContent(i.onContentChange.bind(i,n))):"development"===Neo.config.environment&&console.warn(`addon.MonacoEditor: node ${n} not found`)}destroyInstance(e){let t=this;if(!t.isReady)return t.cacheMethodCall({fn:"destroyInstance",data:e});delete this.map[e.id]}getValue(e){let t=this;return t.isReady?t.map[e.id].getModel().getValue():t.cacheMethodCall({fn:"getValue",data:e})}layoutEditor(e){this.isReady&&this.map[e.id].layout()}async loadFiles(){let e=this,a=e.libraryBasePath;e.isLoading=!0,window.require={paths:{vs:a}},await t.loadScript(a+"/loader.js"),await Promise.all([t.loadStylesheet(a+"/editor/editor.main.css",{name:"vs/editor/editor.main"}),t.loadScript(a+"/editor/editor.main.nls.js"),t.loadScript(a+"/editor/editor.main.js")]),e.isLoading=!1,e.isReady=!0}onContentChange(e,o){let i=t.getElement(e),n=a.getPathFromElement(i).map((e=>a.getTargetData(e)));a.sendMessageToApp({event:o,id:e,path:n,type:"editorChange",value:this.map[e].getModel().getValue()})}setLanguage(e){let t=this;if(!t.isReady)return t.cacheMethodCall({fn:"setLanguage",data:e});t.map[e.id].getModel().setLanguage(e.value)}setTheme(e){let t=this;if(!t.isReady)return t.cacheMethodCall({fn:"setTheme",data:e});t.map[e.id]._themeService.setTheme(e.value)}setValue(e){let t=this;if(!t.isReady)return t.cacheMethodCall({fn:"setValue",data:e});t.map[e.id].getModel().setValue(e.value)}updateOptions(e){let t=this;if(!t.isReady)return t.cacheMethodCall({fn:"updateOptions",data:e});t.map[e.id].updateOptions(e.options)}}export default Neo.setupClass(o);