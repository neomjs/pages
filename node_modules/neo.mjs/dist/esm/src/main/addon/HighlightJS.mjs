import e from"./Base.mjs";import t from"../DomAccess.mjs";class i extends e{static config={className:"Neo.main.addon.HighlightJS",highlightJsPath:"./resources/lib/highlight/highlight.pack.js",highlightJsLineNumbersPath:Neo.config.basePath+"node_modules/highlightjs-line-numbers.js/dist/highlightjs-line-numbers.min.js",preloadFilesDelay:!1,remote:{app:["highlightAuto","loadFiles","scrollIntoView","syntaxHighlight","switchTheme","syntaxHighlightInit","syntaxHighlightLine"]},themePath:"./resources/lib/highlightjs-custom-github-theme.css"};highlightAuto(e){return this.isReady?hljs.highlightAuto(e.html).value:this.cacheMethodCall({fn:"highlightAuto",data:e})}async loadFiles(e){let i=this;return i.isLoading||i.isReady||(i.isLoading=!0,e&&(delete e.appName,delete e.windowId,i.set(e)),await t.loadScript(i.highlightJsPath),await Promise.all([t.loadScript(i.highlightJsLineNumbersPath),Neo.main.addon.Stylesheet.createStyleSheet(null,"hljs-theme",i.themePath)]),i.isLoading=!1,i.isReady=!0),!0}scrollIntoView(e){if(!this.isReady)return this.cacheMethodCall({fn:"scrollIntoView",data:e});let i=t.getElement(e.vnodeId).querySelector('[data-list-header="'+e.text+'"]');i?.previousSibling.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}switchTheme(e){let t={dark:"./resources/lib/highlightjs-custom-dark-theme.css",light:"./resources/lib/highlightjs-custom-github-theme.css"}[e];t??=e,this.themePath=t,Neo.main.addon.Stylesheet.createStyleSheet(null,"hljs-theme",t)}syntaxHighlight(e){if(!this.isReady)return this.cacheMethodCall({fn:"syntaxHighlight",data:e});let t=document.getElementById(e.vnodeId);t&&(hljs.highlightBlock(t),hljs.lineNumbersBlock(t))}syntaxHighlightInit(e){if(!this.isReady)return this.cacheMethodCall({fn:"syntaxHighlightInit",data:e});let t=document.querySelectorAll("pre code:not(.hljs)");Array.prototype.forEach.call(t,hljs.highlightBlock)}syntaxHighlightLine(e){if(!this.isReady)return this.cacheMethodCall({fn:"syntaxHighlightLine",data:e});let t,i=document.getElementById(e.vnodeId),h="neo-highlighted-line";Neo.isNumber(e.addLine)&&(t=i.querySelector('[data-line-number="'+e.addLine+'"]'),t&&(t.parentNode.classList.add(h),t.parentNode.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}))),Neo.isNumber(e.removeLine)&&(t=i.querySelector('[data-line-number="'+e.removeLine+'"]'),t?.parentNode.classList.remove(h))}}export default Neo.setupClass(i);