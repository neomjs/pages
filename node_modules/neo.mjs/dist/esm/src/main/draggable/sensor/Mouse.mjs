import e from"./Base.mjs";import t from"../../DomEvents.mjs";function n(e){e.preventDefault()}export default Neo.setupClass(class extends e{static config={className:"Neo.main.draggable.sensor.Mouse",delay:100,minDistance:5,mouseDownTime:0,mouseDownTimeout:null,pageX:null,pageY:null};construct(e){super.construct(e),Neo.bindMethods(this,["onDistanceChange","onMouseDown","onMouseMove","onMouseUp"])}attach(){document.addEventListener("mousedown",this.onMouseDown,!0)}detach(){document.removeEventListener("mousedown",this.onMouseDown,!0)}onDistanceChange(e){let n=this;if(n.currentElement){const{pageX:o,pageY:a}=e,s=Date.now()-n.mouseDownTime,i=t.getDistance(n.startEvent.pageX,n.startEvent.pageY,o,a)||0;Object.assign(n,{pageX:o,pageY:a}),s>=n.delay&&i>=n.minDistance&&(clearTimeout(n.mouseDownTimeout),document.removeEventListener("mousemove",n.onDistanceChange),n.startDrag())}}onMouseDown(e){if(0===e.button&&!e.ctrlKey&&!e.metaKey){let o=this,a=t.testPathInclusion(e,o.dragTargetClasses);e.path||(e.path=e.composedPath()),a&&(Object.assign(o,{currentElement:a.node,mouseDownTime:Date.now(),pageX:e.pageX,pageY:e.pageY,startEvent:e}),document.addEventListener("dragstart",n),document.addEventListener("mousemove",o.onDistanceChange),document.addEventListener("mouseup",o.onMouseUp),o.mouseDownTimeout=setTimeout((()=>{o.onDistanceChange({pageX:o.pageX,pageY:o.pageY})}),o.delay))}}onMouseMove(e){let t=this;if(t.dragging){let n=t.currentElement,o=document.elementFromPoint(e.clientX,e.clientY);t.trigger(n,{clientX:e.clientX,clientY:e.clientY,element:n,originalEvent:e,path:t.startEvent.path||t.startEvent.composedPath(),target:o,type:"drag:move"})}}onMouseUp(e){if(0===e.button){let t=this;if(clearTimeout(t.mouseDownTimeout),document.removeEventListener("dragstart",n),document.removeEventListener("mousemove",t.onDistanceChange),document.removeEventListener("mouseup",t.onMouseUp),t.dragging){let o=t.currentElement,a=document.elementFromPoint(e.clientX,e.clientY);t.trigger(o,{clientX:e.clientX,clientY:e.clientY,element:o,originalEvent:e,path:t.startEvent.path||t.startEvent.composedPath(),target:a,type:"drag:end"}),document.removeEventListener("contextmenu",n,!0),document.removeEventListener("mousemove",t.onMouseMove),Object.assign(t,{currentElement:null,dragging:!1,startEvent:null})}t.dragging=!1}}startDrag(){let e=this,t=e.currentElement,{startEvent:o}=e;e.trigger(t,{clientX:o.clientX,clientY:o.clientY,element:t,originalEvent:o,path:o.path||o.composedPath(),target:o.target,type:"drag:start"}),e.dragging=!0,e.dragging&&(document.addEventListener("contextmenu",n,!0),document.addEventListener("mousemove",e.onMouseMove))}});