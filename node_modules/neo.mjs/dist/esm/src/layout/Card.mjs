import e from"./Base.mjs";import t from"../util/Array.mjs";export default Neo.setupClass(class extends e{static activeItemCls="neo-active-item";static inactiveItemCls="neo-inactive-item";static itemCls="neo-layout-card-item";static slideDirections=["horizontal","vertical",null];static config={className:"Neo.layout.Card",ntype:"layout-card",activeIndex_:0,containerCls:"neo-layout-card",removeInactiveCards:!0,slideDirection_:null};async afterSetActiveIndex(e,i){let a,o,r,s,n,c,d,l=this,{container:m,removeInactiveCards:p}=l,v=l.constructor,u=l.slideDirection&&void 0!==i,h=!1;if(Neo.isNumber(e)&&m){for(s=m.items,n=s.length,s[e]||Neo.error("Trying to activate a non existing card",e,s),a=0;a<n;a++)if(c=s[a].module,a===e&&"Function"===Neo.typeOf(c)){h=!0;break}for(a=0;a<n;a++)o=a===e,r=s[a],c=r.module,o&&"Function"===Neo.typeOf(c)&&(r=await l.loadModule(r,a)),r instanceof Neo.component.Base&&(d=r.wrapperCls,t.remove(d,o?v.inactiveItemCls:v.activeItemCls),t.add(d,o?v.activeItemCls:v.inactiveItemCls),(p||h)&&(o?(delete r.vdom.removeDom,!u&&r.activate?.()):p&&(r.mounted=!1,r.vdom.removeDom=!0)),r.wrapperCls=d);u?await l.slideCards(e,i):(p||h)&&(m.updateDepth=-1,m.update())}}applyChildAttributes(e,i,a=!1){let o=this,r=o.activeIndex===i,s=o.constructor,n=e.wrapperCls||[],{vdom:c}=e;t.add(n,s.itemCls),t.add(n,r?s.activeItemCls:s.inactiveItemCls),!a&&o.removeInactiveCards?(c.removeDom=!r,e.wrapperCls=n,e.update?.()):e.wrapperCls=n}beforeSetSlideDirection(e,t){return this.beforeSetEnumValue(e,t,"slideDirection")}async loadModule(e,t){let i,{container:a}=this,o=a.items,{module:r}=e;return Neo.isNumber(t)||(t=o.indexOf(e)),e.isLoading=!0,r=await r(),r=r.default,i=r.prototype,e.className=i.className,e.module=r,delete e.isLoading,delete e.vdom,o[t]=e=Neo.create(e),this.applyChildAttributes(e,t),a.getVdomItemsRoot().cn[t]=e.createVdomReference(),a.fire("cardLoaded",{item:e}),e}async slideCards(e,t){let i,a,o,r,s=this,{container:n}=s,c="vertical"===s.slideDirection,{items:d,vdom:l}=n,m=d[e],p=d[t],v=e>t,u=await n.getDomRect(n.id);delete p.vdom.removeDom,c?(r=v?0:-u.height,a={flexDirection:"column",height:2*u.height+"px",transform:`translateY(${r}px)`,width:`${u.width}px`}):(o=v?0:-u.width,a={height:`${u.height}px`,transform:`translateX(${o}px)`,width:2*u.width+"px"}),l.cn=[{cls:["neo-relative"],cn:[{cls:["neo-animation-wrapper"],style:a,cn:[m.createVdomReference()]}]}],i=l.cn[0].cn[0],i.cn[v?"unshift":"push"](p.createVdomReference()),n.updateDepth=-1,await n.promiseUpdate(),i.style.transform=c?`translateY(${v?-u.height:0}px)`:`translateX(${v?-u.width:0}px)`,await n.promiseUpdate(),await s.timeout(300),l.cn=[],n.items.forEach(e=>{l.cn.push(e.createVdomReference())}),p.vdom.removeDom=!0,n.updateDepth=-1,await n.promiseUpdate()}toJSON(){let e=this;return{...super.toJSON(),activeIndex:e.activeIndex,containerCls:e.containerCls,removeInactiveCards:e.removeInactiveCards,slideDirection:e.slideDirection}}});