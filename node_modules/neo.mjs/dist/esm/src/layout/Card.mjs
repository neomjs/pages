import e from"./Base.mjs";import t from"../util/Array.mjs";export default Neo.setupClass(class extends e{static activeItemCls="neo-active-item";static inactiveItemCls="neo-inactive-item";static itemCls="neo-layout-card-item";static slideDirections=["horizontal","vertical",null];static config={className:"Neo.layout.Card",ntype:"layout-card",activeIndex_:0,containerCls:"neo-layout-card",removeInactiveCards:!0,slideDirection_:null};async afterSetActiveIndex(e,a){let i,o,r,s,n,c,d,l=this,{container:m,removeInactiveCards:p}=l,u=l.constructor,v=l.slideDirection&&void 0!==a,h=!1;if(Neo.isNumber(e)&&m){for(s=m.items,n=s.length,s[e]||Neo.error("Trying to activate a non existing card",e,s),i=0;i<n;i++)if(c=s[i].module,i===e&&"Function"===Neo.typeOf(c)){h=!0;break}for(i=0;i<n;i++)o=i===e,r=s[i],c=r.module,o&&"Function"===Neo.typeOf(c)&&(r=await l.loadModule(r,i)),r instanceof Neo.component.Base&&(d=r.wrapperCls,t.remove(d,o?u.inactiveItemCls:u.activeItemCls),t.add(d,o?u.activeItemCls:u.inactiveItemCls),(p||h)&&(o?(delete r.vdom.removeDom,!v&&r.activate?.()):p&&(r.mounted=!1,r.vdom.removeDom=!0)),r.wrapperCls=d);v?await l.slideCards(e,a):(p||h)&&(m.updateDepth=-1,m.update())}}applyChildAttributes(e,a,i=!1){let o=this,r=o.activeIndex===a,s=o.constructor,n=e.wrapperCls||[],{vdom:c}=e;t.add(n,s.itemCls),t.add(n,r?s.activeItemCls:s.inactiveItemCls),!i&&o.removeInactiveCards?(c.removeDom=!r,e.wrapperCls=n,e.update?.()):e.wrapperCls=n}beforeSetSlideDirection(e,t){return this.beforeSetEnumValue(e,t,"slideDirection")}async loadModule(e,t){let a,{container:i}=this,o=i.items,{module:r}=e;return Neo.isNumber(t)||(t=o.indexOf(e)),e.isLoading=!0,r=await r(),r=r.default,a=r.prototype,e.className=a.className,e.module=r,delete e.isLoading,delete e.vdom,o[t]=e=Neo.create(e),this.applyChildAttributes(e,t),i.getVdomItemsRoot().cn[t]=e.createVdomReference(),i.fire("cardLoaded",{item:e}),e}async slideCards(e,t){let a,i,o,r,s=this,{container:n}=s,c="vertical"===s.slideDirection,{items:d,vdom:l}=n,m=d[e],p=d[t],u=e>t,v=await n.getDomRect(n.id);delete p.vdom.removeDom,c?(r=u?0:-v.height,i={flexDirection:"column",height:2*v.height+"px",transform:`translateY(${r}px)`,width:`${v.width}px`}):(o=u?0:-v.width,i={height:`${v.height}px`,transform:`translateX(${o}px)`,width:2*v.width+"px"}),l.cn=[{cls:["neo-relative"],cn:[{cls:["neo-animation-wrapper"],style:i,cn:[m.createVdomReference()]}]}],a=l.cn[0].cn[0],a.cn[u?"unshift":"push"](p.createVdomReference()),n.updateDepth=-1,await n.promiseUpdate(),a.style.transform=c?`translateY(${u?-v.height:0}px)`:`translateX(${u?-v.width:0}px)`,await n.promiseUpdate(),await s.timeout(300),l.cn=[],n.items.forEach((e=>{l.cn.push(e.createVdomReference())})),p.vdom.removeDom=!0,n.updateDepth=-1,await n.promiseUpdate()}});