import e from"./calendars/Container.mjs";import t from"../../container/Base.mjs";import n from"../../component/DateSelector.mjs";import a from"../../util/Date.mjs";import i from"./calendars/EditContainer.mjs";import o from"./EditEventContainer.mjs";import r from"./MainContainerStateProvider.mjs";import s from"../../toolbar/Base.mjs";const d=new Date;export default Neo.setupClass(class extends t{static validViews=["day","week","month","year"];static config={className:"Neo.calendar.view.MainContainer",ntype:"calendar-maincontainer",activeView_:"week",baseCls:["neo-calendar-maincontainer","neo-container"],baseFontSize_:null,calendarsContainer:null,calendarStoreConfig_:null,colorStoreConfig_:null,dateSelector:null,dateSelectorConfig:null,dayComponent:null,dayComponentConfig:null,editCalendarContainer_:null,editCalendarContainerConfig:null,editEventContainer_:null,editEventContainerConfig:null,eventStoreConfig_:null,layout:{ntype:"vbox",align:"stretch"},monthComponent:null,monthComponentConfig:null,removeInactiveCards:!0,settingsContainerConfig:null,settingsContainerWidth:310,settingsExpanded_:!1,sideBarExpanded_:!0,sideBarWidth:220,stateProvider:r,useSettingsContainer_:!0,views_:["day","week","month","year"],weekComponent:null,weekComponentConfig:null,yearComponent:null,yearComponentConfig:null};construct(e){super.construct(e);let t=this;t.createItemsContent(),!t.sideBarExpanded&&t.afterSetSideBarExpanded(!1,!0)}afterSetActiveView(e,t){if(void 0!==t){let t=this;t.items[1].items[1].layout.activeIndex=t.views.indexOf(e),t.items[0].items[1].items.forEach((t=>{"mainViews"===t.toggleGroup&&(t.pressed=t.value===e)}))}}afterSetBaseFontSize(e,t){if(void 0!==t){let t=this.style||{};e?t.fontSize=`${e}px`:delete t.fontSize,this.style=t}}afterSetSettingsExpanded(e,t){if(Neo.isBoolean(t)){let t=this,n=t.items[1].items[2];e?n?n.expand():t.createSettingsContainer(!0).then((()=>{t.timeout(50).then((()=>{t.items[1].items[2].expand()}))})):n.collapse(t.settingsContainerWidth)}}afterSetSideBarExpanded(e,t){if(void 0!==t){let t=this,n=t.items[1].items[0],a=n.style||{};e?(t.updateDepth=-1,delete n.vdom.removeDom,t.promiseUpdate().then((()=>{n.mounted=!0,t.timeout(50).then((()=>{a.marginLeft="0px",n.style=a}))}))):(a.marginLeft=`-${t.sideBarWidth}px`,n._style=a,n._vdom.style=a,n.promiseUpdate().then((()=>{t.timeout(400).then((()=>{n.vdom.removeDom=!0,n.update(),n.mounted=!1}))})))}}afterSetTheme(e,t){super.afterSetTheme(e,t);let n=this;n._editCalendarContainer&&(n._editCalendarContainer.theme=e),n._editEventContainer&&(n._editEventContainer.theme=e)}afterSetUseSettingsContainer(e,t){let n=this;e?(n.settingsExpanded&&n.createSettingsContainer(!1),n.timeout(10).then((()=>{n.items[0].items[1].add({handler:n.toggleSettings.bind(n),iconCls:"fa fa-cog",style:{marginLeft:"10px"}})}))):!e&&t&&(n.items[1].removeLast(),n.items[0].items[1].removeLast())}beforeGetEditCalendarContainer(e){if(!e){let t=this;t._editCalendarContainer=e=Neo.create({module:i,appName:t.appName,owner:t,stateProvider:{parent:t.getStateProvider()},theme:t.theme,width:250,windowId:t.windowId,...t.editCalendarContainerConfig})}return e}beforeGetEditEventContainer(e){if(!e){let t=this;t._editEventContainer=e=Neo.create({module:o,appName:t.appName,owner:t,stateProvider:{parent:t.getStateProvider()},theme:t.theme,width:250,windowId:t.windowId,...t.editEventContainerConfig})}return e}beforeSetActiveView(e,t){return this.beforeSetEnumValue(e,t,"activeView","validViews")}beforeSetViews(e,t){let n=this.getStaticConfig("validViews");return e.forEach((e=>{if(!n.includes(e))return console.error(e,"is not a valid entry for views. Stick to:",n),t})),e}changeActiveView(e){this.activeView=e}createHeaderItems(){let e=this;return[{module:s,cls:["neo-calendar-header-toolbar","neo-left","neo-toolbar"],width:e.sideBarWidth,items:[{handler:e.toggleSidebar.bind(e),iconCls:"fa fa-bars"},"->",{handler:e.onPreviousIntervalButtonClick.bind(e),iconCls:"fa fa-chevron-left"},{handler:e.onTodayButtonClick.bind(e),height:24,text:"Today"},{handler:e.onNextIntervalButtonClick.bind(e),iconCls:"fa fa-chevron-right"}]},{module:s,cls:["neo-calendar-header-toolbar","neo-toolbar"],items:["->",...e.createViewHeaderButtons()]}]}createItemsContent(){let i=this;i.calendarsContainer=Neo.create({module:e,flex:1,parentId:i.id,owner:i}),i.dateSelector=Neo.create({module:n,appName:i.appName,flex:"none",height:i.sideBarWidth,listeners:{dateChange:i.onDateSelectorChange,scope:i},parentId:i.id,value:null,bind:{locale:e=>e.locale,scrollNewYearFromTop:e=>e.scrollNewYearFromTop,showWeekends:e=>e.showWeekends,value:e=>a.convertToyyyymmdd(e.currentDate),weekStartDay:e=>e.weekStartDay},...i.dateSelectorConfig}),i.items=[{module:t,flex:"none",layout:{ntype:"hbox",align:"stretch"},items:i.createHeaderItems()},{module:t,flex:1,layout:{ntype:"hbox",align:"stretch"},items:[{module:t,cls:["neo-calendar-sidebar","neo-container"],layout:{ntype:"vbox",align:"stretch"},minWidth:i.sideBarWidth,width:i.sideBarWidth,items:[i.dateSelector,i.calendarsContainer]},{module:t,flex:1,items:i.createViews(),listeners:{cardLoaded:i.onCardLoaded,scope:i},layout:{ntype:"card",activeIndex:i.views.indexOf(i.activeView),removeInactiveCards:i.removeInactiveCards}}]}]}createSettingsContainer(e){let t=this;return import("./SettingsContainer.mjs").then((n=>{t.items[1].add({module:n.default,collapsed:e,minWidth:t.settingsContainerWidth,removeInactiveCards:t.removeInactiveCards,style:{marginRight:e?`-${t.settingsContainerWidth}px`:"0"},width:t.settingsContainerWidth,...t.settingsContainerConfig})}))}createViewHeaderButtons(){let e=this,t=e.views.indexOf(e.activeView),n=[];return e.views.forEach(((a,i)=>{n.push({handler:e.changeActiveView.bind(e,a),height:24,pressed:t===i,text:Neo.capitalize(a),toggleGroup:"mainViews",value:a})})),n}createViews(){let e,t=this,n=[],a={appName:t.appName,owner:t,parentId:t.id},i={day:{module:()=>import("./DayComponent.mjs"),flag:"day",...a,...t.dayComponentConfig},month:{module:()=>import("./month/Component.mjs"),flag:"month",...a,...t.monthComponentConfig},week:{module:()=>import("./week/Component.mjs"),flag:"week",...a,...t.weekComponentConfig},year:{module:()=>import("./YearComponent.mjs"),flag:"year",...a,...t.yearComponentConfig}};return t.views.forEach((a=>{t[`${a}Component`]=e=i[a],n.push(e)})),n}onCardLoaded(e){this[`${e.item.flag}Component`]=e.item,this.fire("cardLoaded",{item:e.item})}onDateSelectorChange({value:e}){this.setState("currentDate",e)}onNextIntervalButtonClick(e){this.switchInterval(1)}onPreviousIntervalButtonClick(e){this.switchInterval(-1)}onTodayButtonClick(e){this.stateProvider.setData({currentDate:d})}toggleSettings(){this.settingsExpanded=!this.settingsExpanded}toggleSidebar(){this.sideBarExpanded=!this.sideBarExpanded}switchInterval(e){let t=this,{currentDate:n}=t.data;({day:()=>{n.setDate(n.getDate()+e)},month:()=>{n.setMonth(n.getMonth()+e)},week:()=>{n.setDate(n.getDate()+7*e)},year:()=>{n.setFullYear(n.getFullYear()+e)}})[t.activeView](),t.stateProvider.setData({currentDate:n})}});