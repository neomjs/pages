import e from"../../../container/SortZone.mjs";import t from"../../../../util/VDom.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.draggable.grid.header.toolbar.SortZone",ntype:"grid-header-toolbar-sortzone",itemMargin:"1px",moveColumnContent:!0,moveVertical:!1};adjustProxyRectToParent(e,t){e.x=e.x-t.x-1,e.y=e.y-t.y-1}async createDragProxy(e,o=!0){if(!this.moveColumnContent)return await super.createDragProxy(e,o);let n,i,a=this,d=a.owner.parent,{body:r}=d,s=Neo.getId("grid-body-wrapper"),l=a.dragElement["aria-colindex"]-1,{dataField:c}=r.columnPositions.getAt(l),m=r.getColumnCells(c),p=[],h=await super.createDragProxy(e,!1),g=await d.getDomRect();h.cls=["neo-grid-wrapper",a.owner.getTheme()],h.style.height=g.height-2+"px";let u,w,y=[];return a.movedComponents=[],m.forEach((e,o)=>{if(i=r.items[o],n=t.clone({cls:i.vdom.cls,style:i.vdom.style}),u=t.clone(e),delete u.id,delete u.style.left,w=Neo.getId("proxy-cell"),u.id=w,e.cn&&e.cn.length>0){let t=e.cn[0],o=t.id||t.componentId;o&&(u.cn=[],y.push({action:"moveNode",id:o,index:0,parentId:w}),a.movedComponents.push({id:o,originalParentId:e.id}))}n.cn=[u],p.push(n)}),h.vdom={cn:[{cls:["neo-grid-container",...d.cls],cn:[{...h.vdom,cls:["neo-grid-header-toolbar","neo-toolbar"]},{cls:["neo-grid-body-wrapper"],id:s,cn:[{cls:["neo-grid-body"],cn:p},{cls:["neo-grid-scrollbar"],style:{height:r.vdom.cn[0].height}}]}]}]},h.listeners={mounted(){Neo.main.DomAccess.scrollTo({id:s,value:r.scrollTop,windowId:a.windowId}),y.length>0&&Neo.applyDeltas(a.windowId,y)}},o?a.dragProxy=Neo.create(h):h}moveTo(e,t){super.moveTo(e,t),this.owner.parent.columns.move(e,t)}async onDragEnd(e){if(this.movedComponents?.length>0){let e=this.movedComponents.map(e=>({action:"moveNode",id:e.id,index:0,parentId:e.originalParentId}));await Neo.applyDeltas(this.windowId,e),this.movedComponents=null}await super.onDragEnd(e);let{owner:t}=this;t.items.forEach((e,t)=>{e.vdom["aria-colindex"]=t+1}),t.updateDepth=2,t.update(),await t.passSizeToBody(),await this.timeout(20),t.parent.body.createViewData(!1,!0)}async onDragStart(e){if(await super.onDragStart(e),this.moveColumnContent){let e=this,{body:t}=e.owner.parent,o=e.dragElement["aria-colindex"]-1,n=t.columnPositions.getAt(o),{dataField:i}=n,a=t.getColumnCells(i);n.hidden=!0,a.forEach(e=>{e.style.visibility="hidden"}),t.updateDepth=-1,t.update()}}switchItems(e,t){if(super.switchItems(e,t),this.moveColumnContent){let o=this,{itemRects:n}=o,{body:i}=o.owner.parent,{columnPositions:a}=i,d=a.getAt(e),r=a.getAt(t),s=i.getColumnCells(d.dataField),l=i.getColumnCells(r.dataField);Object.assign(d,{width:n[t].width,x:n[t].x+1}),Object.assign(r,{width:n[e].width,x:n[e].x+1}),a.move(e,t),s.forEach(e=>{e.style.left=d.x+"px",e.style.width=d.width+"px"}),l.forEach(e=>{e.style.left=r.x+"px",e.style.width=r.width+"px"}),i.updateDepth=-1,i.update()}}});