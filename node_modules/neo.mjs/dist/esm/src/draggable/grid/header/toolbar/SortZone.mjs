import e from"../../../toolbar/SortZone.mjs";import t from"../../../../util/Array.mjs";import o from"../../../../util/VDom.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.draggable.grid.header.toolbar.SortZone",ntype:"grid-header-toolbar-sortzone",itemMargin:"1px",moveColumnContent:!0,moveVertical:!1};adjustProxyRectToParent(e,t){e.x=e.x-t.x-1,e.y=e.y-t.y-1}async createDragProxy(e,t=!0){if(!this.moveColumnContent)return await super.createDragProxy(e,t);let i,r=this,a=r.owner.parent,{view:n}=a,s=n.getVdomRoot().cn,l=r.dragElement["aria-colindex"]-1,{dataField:d}=n.columnPositions.getAt(l),c=n.getColumnCells(d),m=[],g=await super.createDragProxy(e,!1),h=await a.getDomRect(),w=Neo.getId("grid-view-wrapper");return g.cls=["neo-grid-wrapper",r.owner.getTheme()],g.style.height=h.height-2+"px",c.forEach(((e,t)=>{i=o.clone({cls:s[t].cls,cn:[e],style:s[t].style}),delete i.cn[0].style.left,m.push(i)})),g.vdom={cn:[{cls:["neo-grid-container"],cn:[{...g.vdom,cls:["neo-grid-header-toolbar","neo-toolbar"]},{cls:["neo-grid-view-wrapper"],id:w,cn:[{cls:["neo-grid-view"],cn:m},{cls:["neo-grid-scrollbar"],style:{height:n.vdom.cn[0].height}}]}]}]},g.listeners={mounted(){Neo.main.DomAccess.scrollTo({id:w,value:n.scrollTop,windowId:this.windowId})}},t?r.dragProxy=Neo.create(g):g}moveTo(e,t){super.moveTo(e,t),this.owner.parent.columns.move(e,t)}async onDragEnd(e){await super.onDragEnd(e);let{owner:t}=this;t.items.forEach(((e,t)=>{e.vdom["aria-colindex"]=t+1})),t.updateDepth=2,t.update(),await t.passSizeToView(),await this.timeout(20),t.parent.view.createViewData()}async onDragStart(e){if(await super.onDragStart(e),this.moveColumnContent){let e=this,{view:t}=e.owner.parent,o=e.dragElement["aria-colindex"]-1,i=t.columnPositions.getAt(o),{dataField:r}=i,a=t.getColumnCells(r);i.hidden=!0,a.forEach((e=>{e.style.visibility="hidden"})),t.update()}}switchItems(e,t){if(super.switchItems(e,t),this.moveColumnContent){let o=this,{itemRects:i}=o,{view:r}=o.owner.parent,{columnPositions:a}=r,n=a.getAt(e),s=a.getAt(t),l=r.getColumnCells(n.dataField),d=r.getColumnCells(s.dataField);Object.assign(n,{width:i[t].width,x:i[t].x+1}),Object.assign(s,{width:i[e].width,x:i[e].x+1}),a.move(e,t),l.forEach((e=>{e.style.left=n.x+"px",e.style.width=n.width+"px"})),d.forEach((e=>{e.style.left=s.x+"px",e.style.width=s.width+"px"})),r.update()}}});