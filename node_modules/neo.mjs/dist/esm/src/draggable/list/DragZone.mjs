import t from"../../draggable/DragZone.mjs";import e from"../../util/Array.mjs";import o from"../../util/VDom.mjs";export default Neo.setupClass(class extends t{static config={className:"Neo.draggable.list.DragZone",ntype:"list-dragzone",dragProxyConfig:{cls:["neo-list"]}};construct(t){super.construct(t);let e=this,{owner:o}=e,r={delegate:".neo-draggable",scope:e},{store:a}=o;o.addDomListeners([{"drag:end":e.onDragEnd,...r},{"drag:start":e.onDragStart,...r}]),a.on({load:e.onStoreLoad,scope:e}),a.getCount()>0&&e.onStoreLoad()}adjustListItemCls(t){let o,r=this,{owner:a}=r,{store:s}=a;s.items.forEach(((a,s)=>{o=r.getItemVdom(a,s),o&&(o.cls=o.cls||[],e[t?"add":"remove"](o.cls,"neo-draggable"))})),a.update()}getItemVdom(t,e){return this.owner.vdom.cn[e]}onDragEnd(t){if(this.owner.draggable){let t=this,o=t.dragProxy,r=o.cls||{},a=t.dragElementRect,s=o.wrapperStyle||{};e.add(r,"neo-animate"),o.cls=r,t.timeout(30).then((()=>{s.left=`${a.left}px`,s.top=`${a.top}px`,o.wrapperStyle=s,t.timeout(300).then((()=>{t.dragEnd()}))}))}}async onDragStart(t){let e=this;e.owner.draggable&&(e.dragElement=o.find(e.owner.vdom,t.path[0].id).vdom,await e.dragStart(t))}onStoreLoad(){this.adjustListItemCls(!0)}setData(t={}){let{owner:e}=this,o=e.getItemRecordId(this.getDragElementRoot().id);t.record=e.store.get(o),super.setData(t)}});