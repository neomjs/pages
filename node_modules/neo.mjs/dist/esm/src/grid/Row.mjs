import e from"../component/Base.mjs";import t from"../util/Array.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.grid.Row",ntype:"grid-row",baseCls:["neo-grid-row"],record:null,rowIndex:null,updateDepth:-1,_vdom:{cn:[]}};afterSetMounted(e,t){if(super.afterSetMounted(e,t),this.components)for(const t in this.components)this.components[t].mounted=e}afterSetTheme(e,t){if(super.afterSetTheme(e,t),this.components)for(const t in this.components)this.components[t].theme=e}applyRendererOutput({cellId:e,column:l,columnIndex:o,isLastColumn:n,record:d,rowIndex:s,silent:i}){let c,r,a=this,p=a.parent.parent,m=a.parent,{selectedCells:u,store:h}=m,f=["neo-grid-cell"],y=d[m.colspanField],{dataField:g}=l,x=m.getRecordId(d),w=m.getLogicalCellId(d,g),I=d.get(g);null==I&&(I=""),"me"!==l.rendererScope&&"this"!==l.rendererScope||(l.rendererScope=l);let C={column:l,columnIndex:o,component:a.components?.[l.dataField],dataField:g,gridContainer:p,record:d,row:a,rowIndex:s,silent:i,store:h,value:I};if(r=l.renderer.call(l.rendererScope||l,C),l.cellCls){let e=l.cellCls;"Function"===Neo.typeOf(e)&&(e=e.call(l.rendererScope||l,C)),e&&t.add(f,e)}switch(r instanceof Neo.component.Base&&(a.components??={},a.components[l.dataField]||(a.components[l.dataField]=r),r=r.createVdomReference()),Neo.typeOf(r)){case"Object":r.html||r.text?r.cls&&f.push(...r.cls):r=[r];break;case"Date":case"Number":case"String":r={cls:f,html:r?.toString()}}return null==r&&(r=""),"left"!==l.cellAlign&&f.push("neo-"+l.cellAlign),m.highlightModifiedCells&&d.isModifiedField(g)&&f.push("neo-is-modified"),e||(e=a.getCellId(l.dataField)),m.selectionModel?.selectedColumns?.includes(g)&&t.add(f,m.selectionModel.selectedColumnCellCls||"neo-selected"),n&&f.push("neo-last-column"),c={"aria-colindex":o+1,data:{field:g,recordId:x},id:e,cls:f,role:"gridcell",style:r.style||{}},u.includes(w)&&(f.push("neo-selected"),c["aria-selected"]=!0),l.width&&(c.style.minWidth=`${l.width}px`),y&&Object.keys(y).includes(g)&&(c.colspan=y[g]),"Object"===Neo.typeOf(r)?Object.hasOwn(r,"html")?c.html=r.html||"":c.text=r.text||"":c.cn=r,c}createVdom(e=!1,l=!0){let o,n,d,s,i,c,r,a,p,m,u=this,h=u.record,f=u.rowIndex,y=u.parent,g=y.parent,x=u.vdom,{columns:w}=g;if(!h)return x.style={display:"none"},void(!e&&u.update());let{mountedColumns:I}=y,{selectedRows:C}=y,F=y.getRecordId(h),b=w.getCount();Object.assign(x,{"aria-rowindex":f+2,data:{recordId:F,rowId:f},role:"row",style:{display:null,height:y.rowHeight+"px",transform:`translate3d(0px, ${f*y.rowHeight}px, 0px)`}}),r=x.cn,x.cn=[];let S=null;if(l&&r){S=new Map;for(let e=0,t=r.length;e<t;e++){let t=r[e];t.data?.field&&S.set(t.data.field,t)}}let v=y.getRowClass(h,f);for(f%2!=0&&v.push("neo-even"),C&&h[y.selectedRecordField]&&t.add(C,F),C?.includes(F)?(v.push("neo-selected"),x["aria-selected"]=!0):delete x["aria-selected"],x.cls=v,c=y.columnPositions.getCount()-1,p=y.cellPoolSize,m=new Array(p),s=I[0];s<=I[1];s++)if(n=w.getAt(s),n&&"removeDom"===n.hideMode){if(a=s%p,l&&S){let e=S.get(n.dataField);if(e&&e.data?.recordId===F){e.id=`${u.id}__cell-${a}`,e["aria-colindex"]=s+1,d=y.columnPositions.get(n.dataField),d&&(e.style.left=d.x+"px",e.style.width=d.width+"px",d.hidden||(e.style.visibility=null)),m[a]=e;continue}}if(o=u.applyRendererOutput({cellId:`${u.id}__cell-${a}`,column:n,columnIndex:s,isLastColumn:s===c,record:h,rowIndex:f,silent:e}),n.dock&&(o.cls=["neo-locked",...o.cls||[]]),d=y.columnPositions.get(n.dataField),!d)continue;o.style={...o.style,left:d.x+"px",width:d.width+"px"},d.hidden&&(o.style.visibility="hidden"),m[a]=o}for(s=0;s<p;s++)m[s]||(m[s]={id:`${u.id}__cell-${s}`,style:{display:"none"}});for(x.cn.push(...m),s=0;s<b;s++)if(n=w.getAt(s),"removeDom"!==n.hideMode){if(i=s>=I[0]&&s<=I[1],o=u.applyRendererOutput({cellId:`${u.id}__${n.dataField}`,column:n,columnIndex:s,isLastColumn:s===c,record:h,rowIndex:f,silent:e}),n.dock&&(o.cls=["neo-locked",...o.cls||[]]),d=y.columnPositions.get(n.dataField),!d)continue;o.style={...o.style,left:d.x+"px",width:d.width+"px"},i?d.hidden&&(o.style.visibility="hidden"):"visibility"===n.hideMode?o.style.visibility="hidden":"display"===n.hideMode&&(o.style.display="none"),x.cn.push(o)}!e&&u.update()}destroy(){let e=this;if(e.components)for(const t in e.components)e.components[t].destroy();super.destroy()}getCellId(e){return`${this.id}__${e}`}updateCellComponents(e,t){let l,o,n=this;if(n.components){l=Neo.isString(e),l||(o=e.prototype,e=o.ntype||o.className);for(const o in n.components){let d=n.components[o];(l?d.ntype===e||d.className===e:d instanceof e)&&d.set(t)}}}updateContent({force:e=!1,record:t,recycle:l=!0,rowIndex:o,silent:n=!1}){let d=this;(e||d.record!==t||d.rowIndex!==o)&&(d.record=t,d.rowIndex=o,d.createVdom(n,l))}});