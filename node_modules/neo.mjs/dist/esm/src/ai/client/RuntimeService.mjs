import e from"../../manager/DomEvent.mjs";import t from"../../util/HashHistory.mjs";import o from"./Service.mjs";export default Neo.setupClass(class extends o{static config={className:"Neo.ai.client.RuntimeService"};checkNamespace({namespace:e}){return{exists:!!Neo.ns(e)}}getDomEventListeners({componentId:t}){const o=[],s=e.items?.[t];return s&&Object.entries(s).forEach(([e,t])=>{t.forEach(t=>{o.push({delegate:t.delegate,event:e,handler:"function"==typeof t.fn?t.fn.name||"anonymous":t.fn,priority:t.priority,scope:t.scope?.id||"unknown"})})}),{listeners:o}}getDomEventSummary(t){const o={byComponent:{},byEvent:{},totalEvents:0};return Object.entries(e.items).forEach(([e,t])=>{let s=0;Object.entries(t).forEach(([e,t])=>{const n=t.length;o.totalEvents+=n,s+=n,o.byEvent[e]=(o.byEvent[e]||0)+n}),s>0&&(o.byComponent[e]=s)}),o}getDragState(e){const t=Neo.manager?.DragCoordinator;return t?t.toJSON():{}}getMethodSource({className:e,methodName:t}){const o=Neo.ns(e);if(!o)return{success:!1,error:`Class '${e}' not found`};const s=Neo.typeOf(o);let n;if("NeoClass"===s)n=o.prototype;else{if("NeoInstance"!==s)return{success:!1,error:`Target '${e}' is not a Neo class or instance`};n=o.constructor.prototype}return"function"!=typeof n[t]?{success:!1,error:`Method '${t}' not found on '${e}'`}:{success:!0,source:n[t].toString()}}getNamespaceTree({root:e="Neo"}){const t=Neo.ns(e),o={};return t?(this.#e(t,e,o),{root:e,tree:o}):{tree:{},error:`Namespace '${e}' not found`}}getNeoConfig({windowId:e}){return e?Neo.windowConfigs?.[e]||null:Neo.config}getRouteHistory({windowId:e}){const o=t.getStack(e);return{count:o.length,history:o,windowId:e||null}}getWindowInfo(e){const t=Neo.manager?.Window;return t?t.toJSON():{windows:[]}}inspectClass({className:e,detail:t="standard"}){const o=Neo.ns(e);if(!o)throw new Error(`Class not found: ${e}`);const s=o.isClass?o:o.constructor,n=s.prototype,r=e=>{const t=[];return Neo.isObject(e)&&Object.values(e).forEach(e=>{e&&e.isClass?t.push(e.prototype.className):t.push(...r(e))}),t},c={},a=new Set,i=new Set(Object.keys(s.config)),u=s.configDescriptors||{},l=["constructor","construct","init","onConstructed","onAfterConstructed"],f=/^(before|after)(Get|Set)([A-Z])/,p=this.serializeConfig(s.config),m=s.__proto__,h=m?.config||{};Object.keys(p).forEach(e=>{if("compact"===t){if(!(!Object.hasOwn(h,e)||h[e]!==s.config[e]))return}c[e]={value:p[e]},u[e]&&(c[e].meta=this.serializeConfig(u[e]));const o=[];["beforeGet","beforeSet","afterSet"].forEach(s=>{const r=((e,t)=>e+t[0].toUpperCase()+t.slice(1))(s,e);"compact"===t?Object.hasOwn(n,r)&&o.push(s):"function"==typeof n[r]&&o.push(s)}),o.length>0&&(c[e].hooks=o)});let N=n;for(;N&&"Object"!==N.constructor.className&&(Object.getOwnPropertyNames(N).forEach(e=>{if(!(i.has(e)||l.includes(e)||e.startsWith("_")||e.startsWith("#"))){if(e.match(f));else{"function"==typeof Object.getOwnPropertyDescriptor(N,e).value&&a.add(e)}}}),"compact"!==t);)N=N.__proto__;return{className:n.className,ntype:n.ntype,ntypeChain:s.ntypeChain,superClass:n.__proto__?.constructor?.config?.className||null,mixins:n.mixins?r(n.mixins):[],configs:c,methods:Array.from(a).sort()}}patchCode({className:e,methodName:t,source:o}){if(!0!==Neo.config.enableHotPatching)return{success:!1,error:"Hot patching is disabled. Set Neo.config.enableHotPatching = true to enable."};const s=Neo.ns(e);if(!s)return{success:!1,error:`Class '${e}' not found`};if(!s.prototype)return{success:!1,error:`Class '${e}' has no prototype (is it a singleton?)`};try{const n=new Function("return "+o)();return"function"!=typeof n?{success:!1,error:"Source did not evaluate to a function"}:(console.warn(`[Neo.ai.client.RuntimeService] Hot-patching ${e}.prototype.${t}`),s.prototype[t]=n,n.$isPatched=!0,n.$originalSource=o,{success:!0})}catch(e){return console.error("[Neo.ai.client.RuntimeService] Hot patch failed:",e),{success:!1,error:e.message}}}reloadPage(e){return Neo.Main.reloadWindow(),{status:"reloading"}}setNeoConfig({config:e}){return Neo.setGlobalConfig(e),{status:"ok"}}setRoute({hash:e,windowId:t}){return Neo.Main.setRoute({value:e,windowId:t}),{status:"ok",hash:e}}#e(e,t,o){Object.keys(e).forEach(s=>{const n=e[s],r=Neo.typeOf(n),c=t?`${t}.${s}`:s;"NeoClass"===r?o[s]={type:"class",className:n.prototype.className}:"NeoInstance"===r?o[s]={type:"singleton",className:n.className}:"Object"===r&&(o[s]={},this.#e(n,c,o[s]),0===Object.keys(o[s]).length&&delete o[s])})}});