import o from"./Service.mjs";import e from"../../util/vdom/TreeBuilder.mjs";import t from"../../util/VDom.mjs";export default Neo.setupClass(class extends o{static config={className:"Neo.ai.client.ComponentService"};async getComputedStyles({componentId:o,variables:e}){const t=Neo.getComponent(o);if(!t)throw new Error(`Component not found: ${o}`);return{styles:await Neo.main.DomAccess.getComputedStyle({id:t.id,style:e})}}async getDomRect({componentIds:o}){if(!Array.isArray(o)||0===o.length)throw new Error("componentIds must be a non-empty array");const e=Neo.getComponent(o[0]);if(!e)throw new Error(`Component not found: ${o[0]}`);const t=await e.getDomRect(o);return{rects:Array.isArray(t)?t:[t]}}highlightComponent({componentId:o,options:e}){let t,n=Neo.getComponent(o);if(!n)throw new Error(`Component not found: ${o}`);const r=(e=e||{}).color||"red",s=e.duration||2e3,i=e.style||"outline";t=n.style||{};let m={};return"outline"===i?(m.outline=`2px solid ${r}`,m.outlineOffset="-2px"):m.boxShadow=`0 0 10px ${r}, inset 0 0 10px ${r}`,n.style={...t,...m},this.timeout(s).then(()=>{n.style=t}),{success:!0}}getComponentTree({depth:o,rootId:e}){return{tree:this.serializeComponent(this.getComponentRoot(e),o||-1)}}getVdomTree({depth:o,rootId:t}){const n=this.getComponentRoot(t);if(!n)throw new Error("Root component not found");return{vdom:e.getVdomTree(n.vdom,o)}}getVnodeTree({depth:o,rootId:t}){const n=this.getComponentRoot(t);if(!n)throw new Error("Root component not found");return{vnode:e.getVnodeTree(n.vnode,o)}}getVdomVnode({depth:o,rootId:t}){const n=this.getComponentRoot(t);if(!n)throw new Error("Root component not found");return{vdom:e.getVdomTree(n.vdom,o),vnode:e.getVnodeTree(n.vnode,o)}}queryComponent({rootId:o,selector:e,returnProperties:t}){let n;if(o){const t=Neo.getComponent(o);if(!t)throw new Error(`Root component not found: ${o}`);n=t.down(e,!1)}else n=Neo.manager.Component.find(e);return{components:n.map(o=>{if(Array.isArray(t)&&t.length>0){const e={};return t.forEach(t=>{e[t]=this.safeSerialize(o[t])}),{className:o.className,id:o.id,properties:e}}return o.toJSON()})}}queryVdom({rootId:o,selector:e}){const n=this.getComponentRoot(o);if(!n)throw new Error("Root component not found");const r=t.find(n.vdom,e);return{vdom:r?.vdom||null,index:r?.index,parentId:r?.parentNode?.id}}getComponentRoot(o){if(o)return Neo.getComponent(o);const e=Object.values(Neo.apps||{});return e.length>0?e[0].mainView:null}serializeComponent(o,e,t=1){if(!o)return null;const n=o.toJSON();if(-1===e||t<e){const r=Neo.manager.Component.getChildComponents(o);r&&r.length>0&&(n.items=r.map(o=>this.serializeComponent(o,e,t+1)))}return n}});