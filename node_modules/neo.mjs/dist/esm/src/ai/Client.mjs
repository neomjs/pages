import e from"../core/Base.mjs";import o from"../util/ClassSystem.mjs";import t from"../data/connection/WebSocket.mjs";export default Neo.setupClass(class extends e{static config={className:"Neo.ai.Client",singleton:!0,socketConfig:null,url:"ws://localhost:8081"};isConnected=!1;socket=null;construct(e){super.construct(e),this.connect()}connect(){let e=this;e.socket=o.beforeSetInstance(e.socketConfig,t,{serverAddress:e.url,listeners:{close:e.onSocketClose,error:e.onSocketError,message:e.onSocketMessage,open:e.onSocketOpen,scope:e}})}async onSocketMessage({data:e}){try{if(e.method){const o=await this.handleRequest(e.method,e.params);this.sendResponse(e.id,o)}}catch(e){console.error("Neo.ai.Client: Failed to handle message",e)}}onSocketOpen(e){console.log("Neo.ai.Client: Connected to MCP Server"),this.isConnected=!0}onSocketClose(e){console.log("Neo.ai.Client: Disconnected"),this.isConnected=!1}onSocketError(e){console.error("Neo.ai.Client: WebSocket Error",e)}async handleRequest(e,o){switch(e){case"reload_page":return Neo.Main.reloadWindow(),{status:"reloading"};case"get_component_tree":return{root:"viewport"};case"get_component_property":return{value:null};case"set_component_property":return{success:!0};default:throw new Error(`Unknown method: ${e}`)}}sendResponse(e,o){this.isConnected&&this.socket.sendMessage(JSON.stringify({jsonrpc:"2.0",id:e,result:o}))}});