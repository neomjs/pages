import e from"../../core/Base.mjs";const n=/className\s*:\s*['"]([^'"]+)['"]/g,t=/export\s+(?:default\s+)?(?:const|let|var|class|function|async\s+function|generator\s+function|async\s+generator\s+function|(\{[\s\S]*?\}))/g,s=/import\s+(?:([\w-]+)|\{([^}]+)\})\s+from\s+['"]([^'"]+)['"]/;export default Neo.setupClass(class extends e{static config={className:"Neo.code.executor.Neo"};findClassNames(e){let t,s=[];for(;null!==(t=n.exec(e));)s.push(t[1]);return s}findMainClassName(e){let n=this.findClassNames(e),t=null,s=["MainContainer","MainComponent","MainView","Main"];if(n.length>0){for(const e of s)if(t=n.find(n=>n.endsWith(e)),t)break;t||(t=n[n.length-1])}return t}async execute({code:e,container:n}){let o,a,{environment:i}=Neo.config,r=e,l=this.findMainClassName(r),c=[],m=[],d=[],p=[];r.split("\n").forEach(e=>{let n=e.match(s);if(n){let e,t=n[1],s=n[2]?.split(",").map(e=>e.trim()),o=n[3];"development"===i?o.startsWith(".")&&(o="../"+o):"dist/development"===i?(e=o.lastIndexOf("../"),o=0===e?"../../../../src/"+o.slice(e+3):o.slice(0,e)+"../../../"+o.slice(e+3)):"dist/production"===i&&(e=o.lastIndexOf("../"),o=0===e?"../../../esm/src/"+o.slice(e+3):o.slice(0,e)+"../../esm/"+o.slice(e+3)),m.push({defaultImport:t,namedImports:s,path:o})}else e.match(t)||c.push(`    ${e}`)}),a=m.map((e,n)=>{let t=`Module${n}`;return d.push(t),e.defaultImport&&p.push(`    const ${e.defaultImport} = ${t}.default;`),e.namedImports&&p.push(`    const {${e.namedImports.join(", ")}} = ${t};`),`import('${e.path}')`}),o=["Promise.all([",`    ${a.join(",\n")}`,`]).then(([${d.join(", ")}]) => {`,`${p.join("\n")}`,`    ${c.join("\n")}`,"",`    module = Neo.ns('${l}');`,"","    if (module && (","        Neo.component.Base.isPrototypeOf(module) ||","        Neo.functional.component.Base.isPrototypeOf(module)","    )) {","        container.add({module})","    }","})",".catch(error => {",'    console.warn("LivePreview Error:", error);',"    container.add({ntype:'component', html:error.message});","})"].join("\n"),n.removeAll(!0,!0),this.findClassNames(o).forEach(e=>{let n=e.split("."),t=n.pop(),s=Neo.ns(n);s&&delete s[t]});try{new Function("container","module",o)(n,void 0)}catch(e){n.add({ntype:"component",html:e.message})}return{}}});