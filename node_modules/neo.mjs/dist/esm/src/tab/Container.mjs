import t from"../container/Base.mjs";import e from"./header/Button.mjs";import a from"./header/Toolbar.mjs";import n from"../util/Array.mjs";import i from"./Strip.mjs";export default Neo.setupClass(class extends t{static tabBarPositions=["top","right","bottom","left"];static config={className:"Neo.tab.Container",ntype:"tab-container",activeIndex_:0,activateInsertedTabs:!1,baseCls:["neo-tab-container"],cardContainerId:null,contentContainer:null,headerToolbar:null,layout:null,plain_:!0,removeInactiveCards:!0,sortable_:!1,tabBarId:null,tabStrip:null,tabStripId:null,tabBarPosition_:"top",tabContainerCls:"neo-tab-container",useActiveTabIndicator_:!0};add(t){return this.insert(this.getTabBar().items.length,t)}async afterSetActiveIndex(t,e){let a=this,n=Neo.getComponent(a.cardContainerId);Neo.isNumber(t)&&t>-1&&!n?a.on("constructed",(()=>{a.afterSetActiveIndex(t,e)})):Neo.isNumber(t)&&t>-1&&(n.layout._activeIndex=t,await n.layout.afterSetActiveIndex(t,e),void 0!==e&&(a.updateTabButtons(),a.fire("activeIndexChange",{item:a.getActiveCard(),oldValue:e,value:t})))}afterSetPlain(t,e){let a=this,{cls:i}=a;n[t?"unshift":"remove"](i,a.tabContainerCls+"-plain"),a.cls=i}afterSetSortable(t,e){void 0!==e&&(this.getTabBar().sortable=t)}afterSetTabBarPosition(t,e){let a=this,{cls:i}=a;n.remove(i,"neo-"+e),n.add(i,"neo-"+t),a.setSilent({cls:i}),a.rendered&&(a.layout.setSilent(a.getLayoutConfig()),a.getTabBar().setSilent({dock:t}),a.getTabStrip().setSilent({cls:["neo-tab-strip","neo-dock-"+t]}),a.updateDepth=2,a.fire("tabBarPositionChange",{component:a,oldValue:e,value:t})),a.update()}afterSetUseActiveTabIndicator(t,e){void 0!==e&&(this.getTabBar().useActiveTabIndicator=t,this.getTabStrip().useActiveTabIndicator=t)}beforeSetTabBarPosition(t,e){return this.beforeSetEnumValue(t,e,"tabBarPosition")}createItems(){let t=this,e=t.items||[],n=[],r=[];Object.assign(t,{cardContainerId:t.cardContainerId||Neo.getId("container"),tabBarId:t.tabBarId||Neo.getId("tab-header-toolbar"),tabStripId:t.tabStripId||Neo.getId("tab-strip")}),e.forEach(((e,a)=>{n.push(t.getTabButtonConfig(e.header,a)),e instanceof Neo.component.Base||(e={flex:1,...t.itemDefaults,isTab:!0,...e}),r.push(e)})),t.items=[{module:a,dock:t.tabBarPosition,flex:"none",id:t.tabBarId,items:n,sortable:t.sortable,useActiveTabIndicator:t.useActiveTabIndicator,...t.headerToolbar},{module:i,cls:["neo-tab-strip","neo-dock-"+t.tabBarPosition],flex:"none",id:t.tabStripId,tabContainerId:t.id,useActiveTabIndicator:t.useActiveTabIndicator,...t.tabStrip},{ntype:"container",cls:["neo-container","neo-tab-content-container"],id:t.cardContainerId,itemDefaults:t.itemDefaults,items:r,layout:{ntype:"card",activeIndex:t.activeIndex,removeInactiveCards:t.removeInactiveCards},useActiveTabIndicator:t.useActiveTabIndicator,...t.contentContainer,insert(e,a,n){a?.isTab?t.insert(e,a,n):super.insert(e,a,n)},remove(e,a,n){e?.isTab?t.remove(e,a,n):super.remove(e,a,n)}}],t.itemDefaults=null,super.createItems()}getActiveCard(){return this.getCardContainer().items[this.activeIndex]||null}getCard(t){return this.getCardContainer().items[t]||null}getCardContainer(){return Neo.getComponent(this.cardContainerId)}getCount(){return this.getTabBar().items.length}getLayoutConfig(){return{bottom:{align:"stretch",direction:"column-reverse",pack:"start"},left:{align:"stretch",direction:"row",pack:"start"},right:{align:"stretch",direction:"row-reverse",pack:"start"},top:{align:"stretch",direction:"column",pack:"start"}}[this.tabBarPosition]||null}getTabAtIndex(t){return this.getTabBar().items[t]||null}getTabBar(){return Neo.getComponent(this.tabBarId)}getTabButtonConfig(t,a){let n=this;return{...{module:e,flex:"none",index:a,pressed:n.activeIndex===a,domListeners:[{click(t){n.activeIndex=t.component.index},scope:n}]},...t}}getTabStrip(){return Neo.getComponent(this.tabStripId)}insert(t,e,a=!1){let n,i,r,o,s,d=this,c=d.getCardContainer(),l=d.getTabBar(),u=!1;if(Array.isArray(e)){for(n=0,i=e.length,r=[];n<i;n++)r.unshift(d.insert(t,e[i-1-n],!0));o=r}else if("object"==typeof e){for(n=0,i=c.items.length;n<i;n++)if(c.items[n].id===e.id){u=!0,o=c.items[n],d.activateInsertedTabs&&(d.activeIndex=n);break}if(!u){for(s=l.insert(t,d.getTabButtonConfig(e.header,t)),n=0,i=l.items.length;n<i;n++)l.items[n].index=n;e.flex=1,o=c.insert(t,e,a),d.activateInsertedTabs&&(d.vnode?s.on("mounted",d.onTabButtonMounted,d):d.activeIndex=t)}}return!a&&d.updateTabButtons(),o}moveTo(t,e){let a,n,i=this,r=i.getCardContainer(),o=i.getTabBar(),s=o.items[i.activeIndex];return o.moveTo(t,e),a=s.index,a!==i.activeIndex&&(i._activeIndex=a,r.layout._activeIndex=a),n=r.moveTo(t,e),i.fire("moveTo",{fromIndex:t,toIndex:e}),n}onConstructed(){this.layout={ntype:"flexbox",...this.getLayoutConfig()},super.onConstructed()}onTabButtonMounted(t){let e,a=this,n=a.getCardContainer(),i=a.getTabBar(),r=0,o=i.items.length,s=-1;for(;r<o;r++)if(i.items[r].id===t){s=r;break}s>-1&&(e=n.items[s],a.vnode&&!e.mounted?e.on("mounted",(()=>{a.activeIndex=s}),a,{once:!0}):a.activeIndex=s)}remove(t,e=!0,a=!1){let n=[...this.getCardContainer().items],i=0,r=n.length;for(;i<r;i++)n[i].id===t.id&&this.removeAt(i,e,a)}removeAt(t,e=!0,a=!1){let n,i,r=this,{activeIndex:o}=r,s=r.getCardContainer(),d=r.getTabBar();for(s.removeAt(t,e,a),d.removeAt(t,!0,!1),t<o?(r._activeIndex=o-1,s.layout._activeIndex=o-1):t===o&&(r.activeIndex=o-1),n=0,i=d.items.length;n<i;n++)d.items[n].index=n}updateTabButtons(){let{activeIndex:t}=this;(this.getTabBar().items||[]).forEach(((e,a)=>{e.pressed=a===t}))}});