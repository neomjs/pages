import e from"../Neo.mjs";import s from"./Base.mjs";export default e.setupClass(class extends s{static config={className:"Neo.worker.Canvas",map:{},singleton:!0};workerId="canvas";afterConnect(){let e=this,s=new MessageChannel,{port1:n,port2:o}=s;n.onmessage=e.onMessage.bind(e),e.sendMessage("app",{action:"registerPort",transfer:o},[o]),e.channelPorts.app=n}onRegisterCanvas(s){this.map[s.nodeId]=s.node,e.currentWorker.sendMessage(s.origin,{action:"reply",replyId:s.id,success:!0})}onRegisterNeoConfig(s){super.onRegisterNeoConfig(s);let n=e.config.appPath;n.endsWith(".mjs")&&(n=n.slice(0,-8)),import(`../../${n}/canvas.mjs`).then(e=>{e.onStart()})}});