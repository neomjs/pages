import e from"../Neo.mjs";import a from"./Base.mjs";export default e.setupClass(class extends a{static config={className:"Neo.worker.Canvas",canvasWindowMap:{},map:{},remote:{app:["registerCanvas","retrieveCanvas"]},singleton:!0};workerId="canvas";afterConnect(){let e=this,a=new MessageChannel,{port1:n,port2:s}=a;n.onmessage=e.onMessage.bind(e),e.sendMessage("app",{action:"registerPort",transfer:s},[s]),e.channelPorts.app=n}registerCanvas(e){let a=this;return e.windowId&&(a.canvasWindowMap[e.nodeId]??={},a.canvasWindowMap[e.nodeId][e.windowId]=e.node),a.map[e.nodeId]=e.node,!0}retrieveCanvas(e){let a=this,n=a.canvasWindowMap[e.nodeId]?.[e.windowId];return n&&(a.map[e.nodeId]=n),{hasCanvas:!!n}}onRegisterNeoConfig(a){super.onRegisterNeoConfig(a);let n=e.config.appPath;n.endsWith(".mjs")&&(n=n.slice(0,-8)),import(`../../${n}/canvas.mjs`).then(e=>{e.onStart()})}});