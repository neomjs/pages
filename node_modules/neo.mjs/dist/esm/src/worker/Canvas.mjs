import e from"../Neo.mjs";import s from"./Base.mjs";import*as o from"../core/_export.mjs";export default e.setupClass(class extends s{static config={className:"Neo.worker.Canvas",map:{},singleton:!0};workerId="canvas";afterConnect(){let e=this,s=new MessageChannel,{port1:o,port2:n}=s;o.onmessage=e.onMessage.bind(e),e.sendMessage("app",{action:"registerPort",transfer:n},[n]),e.channelPorts.app=o}onRegisterCanvas(s){this.map[s.nodeId]=s.node,e.currentWorker.sendMessage(s.origin,{action:"reply",replyId:s.id,success:!0})}onRegisterNeoConfig(s){super.onRegisterNeoConfig(s);let o=e.config.appPath;o.endsWith(".mjs")&&(o=o.slice(0,-8)),import(`../../${o}/canvas.mjs`).then(e=>{e.onStart()})}});