import e from"../Neo.mjs";import a from"./Base.mjs";import s from"../Fetch.mjs";import o from"../Xhr.mjs";export default e.setupClass(class extends a{static config={className:"Neo.worker.Data",singleton:!0};rpcApiManagerLoaded=!1;rpcMessageManagerLoaded=!1;workerId="data";afterConnect(){let e=this,a=new MessageChannel,{port1:s,port2:o}=a;s.onmessage=e.onMessage.bind(e),e.sendMessage("app",{action:"registerPort",transfer:o},[o]),e.channelPorts.app=s}onLoad(){console.log("worker.Data onLoad")}onRegisterApi(e){import("../manager/rpc/Api.mjs").then(a=>{a.default.registerApi(e.data),this.rpcApiManagerLoaded=!0})}onRegisterNeoConfig(a){super.onRegisterNeoConfig(a),e.config.remotesApiUrl&&import("../manager/rpc/Message.mjs").then(e=>{this.rpcMessageManagerLoaded=!0})}async onRpc(a){let s,o=this;o.rpcMessageManagerLoaded?(s=await e.manager.rpc.Message.onMessage(a),o.resolve(a,s)):(console.warn("manager.RemotesApi not loaded yet",a),o.reject(a))}});