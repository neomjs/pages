import e from"../draggable/DragZone.mjs";import t from"../util/Array.mjs";import o from"./Base.mjs";class n extends o{static cursorPositions=["s","sw","se","w","e","n","nw","ne"];static nameRegEx=/-([a-z])/g;static positions=["bottom","bottom-left","bottom-right","left","right","top","top-left","top-right"];static validDirections=["b","bl","br","l","r","t","tl","tr"];static config={className:"Neo.plugin.Resizable",ntype:"plugin-resizable",appName_:null,boundaryContainerId:"document.body",boundaryContainerRect:null,currentNodeName:null,delegationCls:null,directions_:["b","bl","br","l","r","t","tl","tr"],dragZone:null,dragZoneConfig:null,gap:10,initialRect:null,isDragging:!1,maxHeight:null,maxWidth:null,minHeight:200,minWidth:200,nodeBottom:null,nodeBottomLeft:null,nodeBottomRight:null,nodeLeft:null,nodeRight:null,nodeTop:null,nodeTopLeft:null,nodeTopRight:null,targetNode:null};construct(e){super.construct(e);let t=this;t.owner.addDomListeners([{"drag:end":t.onDragEnd,scope:t,delegate:".neo-resizable"},{"drag:move":t.onDragMove,scope:t,delegate:".neo-resizable"},{"drag:start":t.onDragStart,scope:t,delegate:".neo-resizable"},{mousedown:t.onMouseDown,scope:t,delegate:".neo-resizable"},{mousemove:t.onMouseMove,scope:t,local:!0},{mouseleave:t.onMouseLeave,scope:t,delegate:`.${t.delegationCls}`},{mouseup:t.onMouseUp,scope:t,delegate:".neo-resizable"}])}addBodyCursorCls(){Neo.applyDeltas(this.windowId,{id:"document.body",cls:{add:[`neo-cursor-${n.cursorPositions[n.positions.indexOf(this.currentNodeName)]}-resize`],remove:[]}})}addNode(e){let t=this,o="node"+Neo.capitalize(e.replace(n.nameRegEx,(e,t)=>t.toUpperCase())),{targetNode:r}=t;return!!r&&(t.currentNodeName=e,t[o]={cls:["neo-resizable",`neo-resizable-${e}`]},r.cn=r.cn||[],r.cn.push(t[o]),!0)}afterSetAppName(e,t){this.dragZone&&(this.dragZone.appName=e)}afterSetWindowId(e,t){let o=this;e&&Neo.currentWorker.insertThemeFiles(e,o.__proto__),o.dragZone&&(o.dragZone.windowId=e)}beforeSetDirections(e,t){if(Array.isArray(e)){let o=0,n=e.length;for(;o<n;o++)if(this.beforeSetEnumValue(e[o],t,"directions","validDirections")!==e[o])return t}return e}onDragEnd(e){let t=this,{owner:o}=t,n=o.wrapperStyle;Object.assign(t,{boundaryContainerRect:null,initialRect:null,isDragging:!1}),Object.assign(n,{opacity:1,transform:"none",...t.dragZone.dragProxy.wrapperStyle}),o.wrapperStyle=n,t.removeBodyCursorCls(),t.dragZone.dragEnd(),t.removeAllNodes(),o.focus(o.id,!0)}onDragMove(e){let t,o,n,r=this,i=r.currentNodeName,a=r.boundaryContainerRect,{maxHeight:d,maxWidth:l,minHeight:s,minWidth:g}=r,m=r.initialRect;i?r.dragZone.dragProxy&&(n=r.dragZone.dragProxy.wrapperStyle,i.includes("bottom")?(o=Math.max(s,e.clientY-m.top),d&&(o=Math.min(o,d)),a&&(o=Math.min(o,a.bottom-m.top)),n.height=`${o}px`):i.includes("top")&&(t=Math.min(m.bottom-s,e.clientY),o=Math.max(s,m.height+m.top-e.clientY),d&&(t=Math.max(t,m.bottom-d),o=Math.min(o,d)),a&&(t=Math.max(t,a.top),o=Math.min(o,m.bottom-a.top)),n.height=`${o}px`,n.top=`${t}px`),i.includes("left")?(t=Math.min(m.right-g,e.clientX),o=Math.max(g,m.width+m.left-e.clientX),l&&(t=Math.max(t,m.right-l),o=Math.min(o,l)),a&&(t=Math.max(t,a.left),o=Math.min(o,m.right-a.left)),n.left=`${t}px`,n.width=`${o}px`):i.includes("right")&&(o=Math.max(g,m.width-m.right+e.clientX),l&&(o=Math.min(o,l)),a&&(o=Math.min(o,a.right-m.left)),n.width=`${o}px`),r.dragZone.dragProxy.wrapperStyle=n):r.onDragEnd({})}onDragStart(t){let o,n,r,i=this,a=i.boundaryContainerId,d=0,l=t.path.length,{appName:s,owner:g,windowId:m}=i,c=g.wrapperStyle;for(i.isDragging=!0,c.opacity=.3,g.wrapperStyle=c;d<l;d++)if(o=t.path[d],o.cls.includes(i.delegationCls)&&(i.initialRect=o.rect),a&&("document.body"===a&&"body"===o.tagName||a===o.id)){i.boundaryContainerRect=o.rect;break}i.boundaryContainerRect||g.getDomRect(i.boundaryContainerRect).then(e=>{i.boundaryContainerRect=e}),i.addBodyCursorCls(),i.dragZone?i.dragZone.boundaryContainerId=g.boundaryContainerId:(n=Neo.clone(g.vdom,!0),r=n.style,delete n.height,delete n.width,delete r.height,delete r.left,delete r.top,delete r.width,r.opacity=.7,i.dragZone=Neo.create({module:e,appName:s,boundaryContainerId:g.boundaryContainerId,dragElement:n,moveInMainThread:!1,owner:g,windowId:m,...i.dragZoneConfig})),i.dragZone.dragStart(t)}onMouseDown(e){this.isDragging=!0}onMouseMove(e){let t,o,n,r,i,a=this,d=a.directions,l=0,{gap:s,owner:g,targetNode:m}=a,c=!1,u=e.path.length;if(!a.isDragging&&!g.isDragging){for(;l<u;l++)if(e.path[l].cls.includes(a.delegationCls)){r=e.path[l];break}r&&(r.id!==m?.id&&(m&&a.removeAllNodes(),a.targetNode=g.getVdomChild(r.id)),t=e.clientY>=r.rect.y-s+r.rect.height,o=e.clientX<=r.rect.x+s,n=e.clientX>=r.rect.x-s+r.rect.width,i=e.clientY<=r.rect.y+s,a.nodeBottom&&(!t||t&&o||t&&n)&&(c=a.removeNode("bottom")),a.nodeLeft&&(!o||t&&o||i&&o)&&(c=a.removeNode("left")),a.nodeRight&&(!n||t&&n||i&&n)&&(c=a.removeNode("right")),a.nodeTop&&(!i||i&&o||i&&n)&&(c=a.removeNode("top")),!a.nodeBottomLeft||t&&o||(c=a.removeNode("bottom-left")),!a.nodeBottomRight||t&&n||(c=a.removeNode("bottom-right")),!a.nodeTopLeft||i&&o||(c=a.removeNode("top-left")),!a.nodeTopRight||i&&n||(c=a.removeNode("top-right")),d.includes("bl")&&t&&o?a.nodeBottomLeft||(c=a.addNode("bottom-left")):d.includes("br")&&t&&n?a.nodeBottomRight||(c=a.addNode("bottom-right")):d.includes("tl")&&i&&o?a.nodeTopLeft||(c=a.addNode("top-left")):d.includes("tr")&&i&&n?a.nodeTopRight||(c=a.addNode("top-right")):d.includes("b")&&t?a.nodeBottom||(c=a.addNode("bottom")):d.includes("l")&&o?a.nodeLeft||(c=a.addNode("left")):d.includes("r")&&n?a.nodeRight||(c=a.addNode("right")):d.includes("t")&&i&&(a.nodeTop||(c=a.addNode("top"))),c&&g.update())}}onMouseLeave(e){let t=this;t.isDragging||t.owner.isDragging||e.path[0].cls.includes(t.delegationCls)&&t.removeAllNodes()}onMouseUp(e){this.isDragging=!1}removeAllNodes(){let e=this;e.currentNodeName&&(e.removeNode(e.currentNodeName),e.owner.update(),e.currentNodeName=null,e.targetNode=null)}removeBodyCursorCls(){Neo.applyDeltas(this.windowId,{id:"document.body",cls:{add:[],remove:[`neo-cursor-${n.cursorPositions[n.positions.indexOf(this.currentNodeName)]}-resize`]}})}removeNode(e){let o=this,r="node"+Neo.capitalize(e.replace(n.nameRegEx,(e,t)=>t.toUpperCase()));return!!o[r]&&(o.currentNodeName=null,t.remove(o.targetNode.cn,o[r]),o[r]=null,!0)}}export default Neo.setupClass(n);