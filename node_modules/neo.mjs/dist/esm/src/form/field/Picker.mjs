import e from"../../container/Base.mjs";import i from"../../util/Array.mjs";import t from"./trigger/Picker.mjs";import r from"./Text.mjs";export default Neo.setupClass(class extends r{static config={className:"Neo.form.field.Picker",ntype:"pickerfield",baseCls:["neo-pickerfield","neo-textfield"],clientRects:null,keys:{Enter:"onKeyDownEnter",Escape:"onKeyDownEscape"},picker:null,pickerConfig:null,pickerHeight:100,pickerIsMounted_:!1,pickerMaxHeight:200,pickerWidth:null,showPickerOnFocus:!1,triggers:[{module:t}]};construct(e){super.construct(e);let i=this;i.addDomListeners({click:i.onInputClick,scope:i})}afterSetMounted(e,i){!1===e&&i&&this.pickerIsMounted&&this.picker.hide(),super.afterSetMounted(e,i)}afterSetTheme(e,i){super.afterSetTheme(e,i),this.picker&&(this.picker.theme=e)}createPicker(){const i=this,{pickerWidth:t}=i,r=i.createPickerComponent();return i.picker=Neo.create({module:e,parentId:"document.body",floating:!0,align:{edgeAlign:t?"t0-b0":"t-b",matchSize:!t,axisLock:!0,target:i.getInputWrapperId()},appName:i.appName,cls:["neo-picker-container","neo-container"],height:i.pickerHeight,hidden:!0,id:i.getPickerId(),items:r?[r]:[],maxHeight:i.pickerMaxHeight,theme:i.theme,width:t,windowId:i.windowId,...i.pickerConfig,onFocusLeave:e=>{let t,r=!1;for(t of e.oldPath)if(t.id===i.id){r=!0;break}r||(i.hidePicker(),super.onFocusLeave(e))}}),i.picker.on("hiddenChange",i.onPickerHiddenChange,i),i.picker}createPickerComponent(){return null}destroy(...e){let{picker:i}=this;!1===i?.hidden&&i.unmount(),i?.destroy(),super.destroy(...e)}getPicker(){return this.picker||this.createPicker()}getPickerId(){return`${this.id}__picker`}async hidePicker(){this.picker&&(this.picker.hidden=!0)}onFocusEnter(e){super.onFocusEnter(e);this.showPickerOnFocus&&this.showPicker()}onFocusLeave(e){let i,t=this,r=!1;for(i of e.oldPath)if(i.id===t.getPickerId()){r=!0;break}r||(t.hidePicker(),super.onFocusLeave(e))}onInputClick(e){!this.editable&&this.togglePicker()}onKeyDownEnter(e,i,t){!this.pickerIsMounted&&this.showPicker(i,t)}onKeyDownEscape(e){if(this.pickerIsMounted)return this.hidePicker(),e.cancelBubble=!0,!1}onPickerHiddenChange(e){this.pickerIsMounted=!e.value}onPickerTriggerClick(){this.togglePicker()}showPicker(){this.getPicker().hidden=!1}togglePicker(){let e=this.getPicker();e.hidden=!e.hidden}});