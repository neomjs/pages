{"classData":[{"comment":"/**\n * @summary Service for handling session summarization and drift detection.\n *\n * **Architecture & Strategy:**\n * The primary challenge in managing session summaries is that agents are stateless and sessions\n * rarely have a clean, explicit \"end\" event (e.g., crashes, network disconnects, or simply stopping work).\n *\n * To address this, this service employs an **\"Eventual Consistency\"** strategy for summarization:\n * 1.  **Startup Scan:** On initialization, we scan for sessions that have been active recently (last 30 days).\n * 2.  **Drift Detection:** We compare the actual number of memories in the database against the `memoryCount`\n *     recorded in the existing summary.\n * 3.  **Self-Healing:** If the counts differ (indicating new memories added or old ones deleted), we\n *     trigger a re-summarization.\n *\n * **Parallel Sessions Trade-off:**\n * In a scenario where multiple sessions are running in parallel (e.g., Session A and Session B),\n * they may continuously update the memory count. This strategy accepts the overhead of\n * potentially re-summarizing an active session multiple times to ensure that if any session\n * crashes or ends abruptly, its context is preserved and up-to-date for the next agent.\n * Data integrity and context availability are prioritized over minimizing LLM token usage.\n *\n * @class Neo.ai.mcp.server.memory-core.services.SessionService\n * @extends Neo.core.Base\n * @singleton\n */","meta":{"filename":"SessionService.mjs","lineno":10,"columnno":0,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{}},"summary":"Service for handling session summarization and drift detection.\n\n**Architecture & Strategy:**\nThe primary challenge in managing session summaries is that agents are stateless and sessions\nrarely have a clean, explicit \"end\" event (e.g., crashes, network disconnects, or simply stopping work).\n\nTo address this, this service employs an **\"Eventual Consistency\"** strategy for summarization:\n1.  **Startup Scan:** On initialization, we scan for sessions that have been active recently (last 30 days).\n2.  **Drift Detection:** We compare the actual number of memories in the database against the `memoryCount`\n    recorded in the existing summary.\n3.  **Self-Healing:** If the counts differ (indicating new memories added or old ones deleted), we\n    trigger a re-summarization.\n\n**Parallel Sessions Trade-off:**\nIn a scenario where multiple sessions are running in parallel (e.g., Session A and Session B),\nthey may continuously update the memory count. This strategy accepts the overhead of\npotentially re-summarizing an active session multiple times to ensure that if any session\ncrashes or ends abruptly, its context is preserved and up-to-date for the next agent.\nData integrity and context availability are prioritized over minimizing LLM token usage.","kind":"class","name":"SessionService","augments":["Neo.core.Base"],"tags":[{"originalTitle":"singleton","title":"singleton","text":""}],"memberof":"Neo.ai.mcp.server.memory-core.services","longname":"Neo.ai.mcp.server.memory-core.services.SessionService","scope":"static","$longname":"Neo.ai.mcp.server.memory-core.services.SessionService","$kind":"class","id":6560,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n         * @member {String} className='Neo.ai.mcp.server.memory-core.services.SessionService'\n         * @protected\n         */","meta":{"filename":"SessionService.mjs","lineno":41,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{}},"kind":"member","name":"className","type":{"names":["String"]},"defaultvalue":"'Neo.ai.mcp.server.memory-core.services.SessionService'","access":"protected","longname":"className","scope":"global","$longname":"className","$kind":"property","id":6561,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n         * @member {String|null} currentSessionId=crypto.randomUUID()\n         * @protected\n         */","meta":{"filename":"SessionService.mjs","lineno":46,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{}},"kind":"member","name":"currentSessionId","type":{"names":["String","null"]},"defaultvalue":"crypto.randomUUID()","access":"protected","longname":"currentSessionId","scope":"global","$longname":"currentSessionId","$kind":"property","id":6562,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n         * @member {GoogleGenerativeAI|null} embeddingModel_=null\n         * @protected\n         * @reactive\n         */","meta":{"filename":"SessionService.mjs","lineno":52,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{}},"kind":"member","name":"embeddingModel_","type":{"names":["GoogleGenerativeAI","null"]},"defaultvalue":null,"access":"protected","tags":[{"originalTitle":"reactive","title":"reactive","text":""}],"longname":"embeddingModel_","scope":"global","$longname":"embeddingModel_","$kind":"property","id":6563,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n         * @member {Object|null} memoryCollection_=null\n         * @protected\n         * @reactive\n         */","meta":{"filename":"SessionService.mjs","lineno":58,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{}},"kind":"member","name":"memoryCollection_","type":{"names":["Object","null"]},"defaultvalue":null,"access":"protected","tags":[{"originalTitle":"reactive","title":"reactive","text":""}],"longname":"memoryCollection_","scope":"global","$longname":"memoryCollection_","$kind":"property","id":6564,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n         * @member {GoogleGenerativeAI|null} model_=null\n         * @protected\n         * @reactive\n         */","meta":{"filename":"SessionService.mjs","lineno":64,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{}},"kind":"member","name":"model_","type":{"names":["GoogleGenerativeAI","null"]},"defaultvalue":null,"access":"protected","tags":[{"originalTitle":"reactive","title":"reactive","text":""}],"longname":"model_","scope":"global","$longname":"model_","$kind":"property","id":6565,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n         * @member {Object|null} sessionsCollection_=null\n         * @protected\n         * @reactive\n         */","meta":{"filename":"SessionService.mjs","lineno":70,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{}},"kind":"member","name":"sessionsCollection_","type":{"names":["Object","null"]},"defaultvalue":null,"access":"protected","tags":[{"originalTitle":"reactive","title":"reactive","text":""}],"longname":"sessionsCollection_","scope":"global","$longname":"sessionsCollection_","$kind":"property","id":6566,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n         * @member {Boolean} singleton=true\n         * @protected\n         */","meta":{"filename":"SessionService.mjs","lineno":75,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{}},"kind":"member","name":"singleton","type":{"names":["Boolean"]},"defaultvalue":true,"access":"protected","longname":"singleton","scope":"global","$longname":"singleton","$kind":"property","id":6567,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n     * @param {Object} config\n     */","meta":{"range":[3119,3942],"filename":"SessionService.mjs","lineno":81,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{"id":"astnode100020698","name":"SessionService#construct","type":"MethodDefinition","paramnames":["config"]},"vars":{"":null}},"params":[{"type":{"names":["Object"]},"name":"config"}],"name":"construct","longname":"SessionService#construct","kind":"function","memberof":"SessionService","scope":"instance","$longname":"SessionService#construct","$kind":"method","id":6568,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n     * @returns {Promise<void>}\n     */","meta":{"range":[3996,5903],"filename":"SessionService.mjs","lineno":102,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{"id":"astnode100020788","name":"SessionService#initAsync","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"returns":[{"type":{"names":["Promise.<void>"]}}],"name":"initAsync","longname":"SessionService#initAsync","kind":"function","memberof":"SessionService","scope":"instance","params":[],"async":true,"$longname":"SessionService#initAsync","$kind":"method","id":6569,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n     * Finds sessions that need summarization by detecting \"Drift\" between the database state\n     * and the summary metadata.\n     *\n     * **Logic:**\n     * 1.  **Scope:** Fetches memory and summary metadata for the last 30 days. This optimization\n     *     prevents full-table scans on large databases while covering the vast majority of active work.\n     * 2.  **Grouping:** Aggregates actual memory counts per session from the raw memory data.\n     * 3.  **Comparison:**\n     *     -   **Missing Summary:** If a session has memories but no summary, it is flagged.\n     *     -   **Count Mismatch:** If `DB_Count !== Summary_Count`, it implies the session has changed\n     *         (new memories added or removed) since the last summary. It is flagged for update.\n     *\n     * **Scenarios:**\n     * -   **Happy Path (Sequential):** Session A ends. Summary is created (Count: 10). Next startup sees\n     *     DB: 10, Summary: 10. Match. No action. Zero overhead.\n     * -   **Parallel / Crash Path:** Session A crashes after adding 5 memories. Summary has 10, DB has 15.\n     *     Next startup sees Mismatch. Re-summarizes to capture the lost 5 memories.\n     *\n     * @param {Boolean} [includeAll=false] If true, ignores the 30-day limit and scans all sessions.\n     * @returns {Promise<String[]>} List of Session IDs requiring summarization.\n     */","meta":{"range":[7277,12214],"filename":"SessionService.mjs","lineno":167,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{"id":"astnode100020970","name":"SessionService#findSessionsToSummarize","type":"MethodDefinition","paramnames":["includeAll"]},"vars":{"":null}},"description":"<p>Finds sessions that need summarization by detecting &quot;Drift&quot; between the database state\nand the summary metadata.</p>\n<p><strong>Logic:</strong></p>\n<ol>\n<li><strong>Scope:</strong> Fetches memory and summary metadata for the last 30 days. This optimization\nprevents full-table scans on large databases while covering the vast majority of active work.</li>\n<li><strong>Grouping:</strong> Aggregates actual memory counts per session from the raw memory data.</li>\n<li><strong>Comparison:</strong><ul>\n<li><strong>Missing Summary:</strong> If a session has memories but no summary, it is flagged.</li>\n<li><strong>Count Mismatch:</strong> If <code>DB_Count !== Summary_Count</code>, it implies the session has changed\n(new memories added or removed) since the last summary. It is flagged for update.</li>\n</ul>\n</li>\n</ol>\n<p><strong>Scenarios:</strong></p>\n<ul>\n<li><strong>Happy Path (Sequential):</strong> Session A ends. Summary is created (Count: 10). Next startup sees\nDB: 10, Summary: 10. Match. No action. Zero overhead.</li>\n<li><strong>Parallel / Crash Path:</strong> Session A crashes after adding 5 memories. Summary has 10, DB has 15.\nNext startup sees Mismatch. Re-summarizes to capture the lost 5 memories.</li>\n</ul>\n","params":[{"type":{"names":["Boolean"]},"optional":true,"defaultvalue":false,"description":"<p>If true, ignores the 30-day limit and scans all sessions.</p>\n","name":"includeAll"}],"returns":[{"type":{"names":["Promise.<Array.<String>>"]},"description":"List of Session IDs requiring summarization."}],"name":"findSessionsToSummarize","longname":"SessionService#findSessionsToSummarize","kind":"function","memberof":"SessionService","scope":"instance","async":true,"$longname":"SessionService#findSessionsToSummarize","$kind":"method","id":6570,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n     * Summarizes a single session.\n     * @param {String} sessionId The ID of the session to summarize.\n     * @returns {Promise<object|null>}\n     */","meta":{"range":[12380,15931],"filename":"SessionService.mjs","lineno":312,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{"id":"astnode100021406","name":"SessionService#summarizeSession","type":"MethodDefinition","paramnames":["sessionId"]},"vars":{"":null}},"description":"<p>Summarizes a single session.</p>\n","params":[{"type":{"names":["String"]},"description":"<p>The ID of the session to summarize.</p>\n","name":"sessionId"}],"returns":[{"type":{"names":["Promise.<(object|null)>"]}}],"name":"summarizeSession","longname":"SessionService#summarizeSession","kind":"function","memberof":"SessionService","scope":"instance","async":true,"$longname":"SessionService#summarizeSession","$kind":"method","id":6571,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"},{"comment":"/**\n     * Summarizes sessions based on the provided sessionId or all unsummarized sessions.\n     * Note: If the current active sessionId is explicitly passed, it WILL be summarized.\n     * @param {Object}  options\n     * @param {Boolean} [options.includeAll] If true, scans all sessions regardless of time window.\n     * @param {String}  [options.sessionId]  A specific session ID to summarize.\n     * @returns {Promise<{processed: number, sessions: object[]}|{error: string, message: string, code: string}>}\n     */","meta":{"range":[16459,18105],"filename":"SessionService.mjs","lineno":391,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/memory-core/services","code":{"id":"astnode100021675","name":"SessionService#summarizeSessions","type":"MethodDefinition","paramnames":[""]},"vars":{"":null}},"description":"<p>Summarizes sessions based on the provided sessionId or all unsummarized sessions.\nNote: If the current active sessionId is explicitly passed, it WILL be summarized.</p>\n","params":[{"type":{"names":["Object"]},"name":"options"},{"type":{"names":["Boolean"]},"optional":true,"description":"<p>If true, scans all sessions regardless of time window.</p>\n","name":"options.includeAll"},{"type":{"names":["String"]},"optional":true,"description":"<p>A specific session ID to summarize.</p>\n","name":"options.sessionId"}],"returns":[{"type":{"names":["Promise.<({processed: number, sessions: Array.<object>}|{error: string, message: string, code: string})>"]}}],"name":"summarizeSessions","longname":"SessionService#summarizeSessions","kind":"function","memberof":"SessionService","scope":"instance","async":true,"$longname":"SessionService#summarizeSessions","$kind":"method","id":6572,"neoClassName":"Neo.ai.mcp.server.memory-core.services.SessionService"}]}