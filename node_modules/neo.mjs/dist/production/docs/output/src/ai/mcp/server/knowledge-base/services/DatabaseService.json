{"classData":[{"comment":"/**\n * @summary Core engine for building and maintaining the AI's knowledge base.\n *\n * This service is the core engine for building and maintaining the AI's knowledge base.\n * It orchestrates the entire ETL (Extract, Transform, Load) process for knowledge and\n * ensures the database is synchronized on application startup.\n *\n * ### Key Responsibilities:\n * 1.  **Autonomous Startup:** On initialization, it automatically checks if the knowledge base\n *     is synchronized with the source files and runs the necessary embedding or creation\n *     processes to bring it up-to-date.\n * 2.  **ETL Pipeline:**\n *     - **Extract:** Reads from diverse source-of-truth files (`createKnowledgeBase`).\n *     - **Transform:** Parses and structures data into a unified JSONL format.\n *     - **Load:** Generates vector embeddings and upserts them into ChromaDB (`embedKnowledgeBase`).\n * 3.  **Lifecycle Management:** Provides methods for the full lifecycle of the knowledge base,\n *     from creation and synchronization to deletion.\n *\n * @class Neo.ai.mcp.server.knowledge-base.services.DatabaseService\n * @extends Neo.core.Base\n * @singleton\n */","meta":{"filename":"DatabaseService.mjs","lineno":22,"columnno":0,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"summary":"Core engine for building and maintaining the AI's knowledge base.\n\nThis service is the core engine for building and maintaining the AI's knowledge base.\nIt orchestrates the entire ETL (Extract, Transform, Load) process for knowledge and\nensures the database is synchronized on application startup.\n\n### Key Responsibilities:\n1.  **Autonomous Startup:** On initialization, it automatically checks if the knowledge base\n    is synchronized with the source files and runs the necessary embedding or creation\n    processes to bring it up-to-date.\n2.  **ETL Pipeline:**\n    - **Extract:** Reads from diverse source-of-truth files (`createKnowledgeBase`).\n    - **Transform:** Parses and structures data into a unified JSONL format.\n    - **Load:** Generates vector embeddings and upserts them into ChromaDB (`embedKnowledgeBase`).\n3.  **Lifecycle Management:** Provides methods for the full lifecycle of the knowledge base,\n    from creation and synchronization to deletion.","kind":"class","name":"DatabaseService","augments":["Neo.core.Base"],"tags":[{"originalTitle":"singleton","title":"singleton","text":""}],"memberof":"Neo.ai.mcp.server.knowledge-base.services","longname":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService","scope":"static","$longname":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService","$kind":"class","id":6067,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n         * @member {String} className='Neo.ai.mcp.server.knowledge-base.services.DatabaseService'\n         * @protected\n         */","meta":{"filename":"DatabaseService.mjs","lineno":50,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"kind":"member","name":"className","type":{"names":["String"]},"defaultvalue":"'Neo.ai.mcp.server.knowledge-base.services.DatabaseService'","access":"protected","longname":"className","scope":"global","$longname":"className","$kind":"property","id":6068,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n         * @member {Boolean} singleton=true\n         * @protected\n         */","meta":{"filename":"DatabaseService.mjs","lineno":55,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"kind":"member","name":"singleton","type":{"names":["Boolean"]},"defaultvalue":true,"access":"protected","longname":"singleton","scope":"global","$longname":"singleton","$kind":"property","id":6069,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n     * Orchestrates the automated startup synchronization of the knowledge base.\n     *\n     * This method is called automatically by the framework after the service is constructed.\n     * It ensures that the knowledge base is ready and up-to-date before the application\n     * proceeds.\n     *\n     * The logic is as follows:\n     * 1. It first waits for the underlying database connection to be ready.\n     * 2. It then checks for the existence of the `ai-knowledge-base.jsonl` file.\n     * 3. If the file does not exist, it triggers a full `syncDatabase()` (create + embed).\n     * 4. If the file exists, it triggers `embedKnowledgeBase()` to process any new or changed content.\n     *\n     * This entire process is awaited via the `ready()` promise on the service, ensuring\n     * that dependent services or startup sequences only proceed once the knowledge base is\n     * fully initialized.\n     * @protected\n     */","meta":{"range":[3252,4290],"filename":"DatabaseService.mjs","lineno":76,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100024265","name":"DatabaseService#initAsync","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>Orchestrates the automated startup synchronization of the knowledge base.</p>\n<p>This method is called automatically by the framework after the service is constructed.\nIt ensures that the knowledge base is ready and up-to-date before the application\nproceeds.</p>\n<p>The logic is as follows:</p>\n<ol>\n<li>It first waits for the underlying database connection to be ready.</li>\n<li>It then checks for the existence of the <code>ai-knowledge-base.jsonl</code> file.</li>\n<li>If the file does not exist, it triggers a full <code>syncDatabase()</code> (create + embed).</li>\n<li>If the file exists, it triggers <code>embedKnowledgeBase()</code> to process any new or changed content.</li>\n</ol>\n<p>This entire process is awaited via the <code>ready()</code> promise on the service, ensuring\nthat dependent services or startup sequences only proceed once the knowledge base is\nfully initialized.</p>\n","access":"protected","name":"initAsync","longname":"DatabaseService#initAsync","kind":"function","memberof":"DatabaseService","scope":"instance","params":[],"async":true,"$longname":"DatabaseService#initAsync","$kind":"method","id":6070,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n     * Creates a SHA-256 hash from a stable JSON string representation of a chunk's content.\n     * This hash is used to detect changes in content without having to compare the full text.\n     * @param {Object} chunk The chunk object.\n     * @returns {String} The hexadecimal hash string.\n     * @private\n     */","meta":{"range":[4617,5107],"filename":"DatabaseService.mjs","lineno":108,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100024355","name":"DatabaseService#createContentHash","type":"MethodDefinition","paramnames":["chunk"]},"vars":{"":null}},"description":"<p>Creates a SHA-256 hash from a stable JSON string representation of a chunk&#39;s content.\nThis hash is used to detect changes in content without having to compare the full text.</p>\n","params":[{"type":{"names":["Object"]},"description":"<p>The chunk object.</p>\n","name":"chunk"}],"returns":[{"type":{"names":["String"]},"description":"The hexadecimal hash string."}],"access":"private","name":"createContentHash","longname":"DatabaseService#createContentHash","kind":"function","memberof":"DatabaseService","scope":"instance","$longname":"DatabaseService#createContentHash","$kind":"method","id":6071,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n     * Recursively scans a directory and indexes files as raw source chunks.\n     * @param {Object} writeStream The stream to write chunks to.\n     * @param {String} relativePath The relative path from cwd to scan.\n     * @param {String} defaultType The default type to assign to chunks.\n     * @param {Object} options Configuration options.\n     * @param {String[]} options.include Array of file extensions to include (e.g. ['.mjs', '.md']).\n     * @param {String[]} options.exclude Array of directory names to exclude.\n     * @param {Object} options.typeOverrides Map of path segments to type values (e.g. {'examples': 'example'}).\n     * @returns {Promise<Number>} The number of chunks created.\n     */","meta":{"range":[5827,7926],"filename":"DatabaseService.mjs","lineno":133,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100024414","name":"DatabaseService#indexRawDirectory","type":"MethodDefinition","paramnames":["writeStream","relativePath","defaultType","options"]},"vars":{"":null}},"description":"<p>Recursively scans a directory and indexes files as raw source chunks.</p>\n","params":[{"type":{"names":["Object"]},"description":"<p>The stream to write chunks to.</p>\n","name":"writeStream"},{"type":{"names":["String"]},"description":"<p>The relative path from cwd to scan.</p>\n","name":"relativePath"},{"type":{"names":["String"]},"description":"<p>The default type to assign to chunks.</p>\n","name":"defaultType"},{"type":{"names":["Object"]},"description":"<p>Configuration options.</p>\n","name":"options"},{"type":{"names":["Array.<String>"]},"description":"<p>Array of file extensions to include (e.g. [&#39;.mjs&#39;, &#39;.md&#39;]).</p>\n","name":"options.include"},{"type":{"names":["Array.<String>"]},"description":"<p>Array of directory names to exclude.</p>\n","name":"options.exclude"},{"type":{"names":["Object"]},"description":"<p>Map of path segments to type values (e.g. {&#39;examples&#39;: &#39;example&#39;}).</p>\n","name":"options.typeOverrides"}],"returns":[{"type":{"names":["Promise.<Number>"]},"description":"The number of chunks created."}],"name":"indexRawDirectory","longname":"DatabaseService#indexRawDirectory","kind":"function","memberof":"DatabaseService","scope":"instance","async":true,"$longname":"DatabaseService#indexRawDirectory","$kind":"method","id":6072,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n     * Parses all knowledge sources (JSDoc, guides, release notes, tickets) and generates\n     * a structured JSONL file at `dist/ai-knowledge-base.jsonl`.\n     *\n     * This function acts as the \"compiler\" for the knowledge base. Its primary role is to\n     * read from various source-of-truth files and convert them into a unified, structured format.\n     * It uses a write stream to handle potentially large amounts of data efficiently without\n     * holding everything in memory at once.\n     *\n     * ### Key Characteristics:\n     * - **Input:** Reads from `docs/output/all.json` for API data and `learn/tree.json` for the guide structure.\n     * - **Processing:** It breaks down the content into logical \"chunks\" (e.g., a class, a method, a section of a guide).\n     * - **Output:** It streams each chunk as a JSON object into the `dist/ai-knowledge-base.jsonl` file.\n     *\n     * @returns {Promise<object>} A promise that resolves to a success message with the total chunk count.\n     */","meta":{"range":[8936,16284],"filename":"DatabaseService.mjs","lineno":202,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100024637","name":"DatabaseService#createKnowledgeBase","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>Parses all knowledge sources (JSDoc, guides, release notes, tickets) and generates\na structured JSONL file at <code>dist/ai-knowledge-base.jsonl</code>.</p>\n<p>This function acts as the &quot;compiler&quot; for the knowledge base. Its primary role is to\nread from various source-of-truth files and convert them into a unified, structured format.\nIt uses a write stream to handle potentially large amounts of data efficiently without\nholding everything in memory at once.</p>\n<h3>Key Characteristics:</h3>\n<ul>\n<li><strong>Input:</strong> Reads from <code>docs/output/all.json</code> for API data and <code>learn/tree.json</code> for the guide structure.</li>\n<li><strong>Processing:</strong> It breaks down the content into logical &quot;chunks&quot; (e.g., a class, a method, a section of a guide).</li>\n<li><strong>Output:</strong> It streams each chunk as a JSON object into the <code>dist/ai-knowledge-base.jsonl</code> file.</li>\n</ul>\n","returns":[{"type":{"names":["Promise.<object>"]},"description":"A promise that resolves to a success message with the total chunk count."}],"name":"createKnowledgeBase","longname":"DatabaseService#createKnowledgeBase","kind":"function","memberof":"DatabaseService","scope":"instance","params":[],"async":true,"$longname":"DatabaseService#createKnowledgeBase","$kind":"method","id":6073,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n     * Reads the generated JSONL file, enriches the data (e.g., with class inheritance chains),\n     * generates vector embeddings for new/changed content, and upserts the data into the ChromaDB collection.\n     *\n     * This function is intentionally memory-intensive. It loads the entire knowledge base into memory\n     * to perform holistic analysis, such as building the class inheritance map. This heavy, one-time\n     * pre-calculation makes the query-time scoring significantly faster.\n     *\n     * It performs a diff against the existing database content to ensure idempotency, only processing\n     * chunks that are new or have changed, which saves significant time and API costs.\n     *\n     * ### Key Functions:\n     * 1.  **Scoring & Enrichment:** It loads the entire knowledge base into memory to perform holistic analysis,\n     *     pre-calculating the full `inheritanceChain` for every chunk.\n     * 2.  **Embedding & Storage:** It sends chunk content to the Google Generative AI API for vector embeddings\n     *     and \"upserts\" the content, vector, and all metadata into the ChromaDB vector database.\n     *\n     * @returns {Promise<object>} A promise that resolves to a success message with the final document count.\n     */","meta":{"range":[17544,23631],"filename":"DatabaseService.mjs","lineno":364,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100025472","name":"DatabaseService#embedKnowledgeBase","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>Reads the generated JSONL file, enriches the data (e.g., with class inheritance chains),\ngenerates vector embeddings for new/changed content, and upserts the data into the ChromaDB collection.</p>\n<p>This function is intentionally memory-intensive. It loads the entire knowledge base into memory\nto perform holistic analysis, such as building the class inheritance map. This heavy, one-time\npre-calculation makes the query-time scoring significantly faster.</p>\n<p>It performs a diff against the existing database content to ensure idempotency, only processing\nchunks that are new or have changed, which saves significant time and API costs.</p>\n<h3>Key Functions:</h3>\n<ol>\n<li><strong>Scoring &amp; Enrichment:</strong> It loads the entire knowledge base into memory to perform holistic analysis,\npre-calculating the full <code>inheritanceChain</code> for every chunk.</li>\n<li><strong>Embedding &amp; Storage:</strong> It sends chunk content to the Google Generative AI API for vector embeddings\nand &quot;upserts&quot; the content, vector, and all metadata into the ChromaDB vector database.</li>\n</ol>\n","returns":[{"type":{"names":["Promise.<object>"]},"description":"A promise that resolves to a success message with the final document count."}],"name":"embedKnowledgeBase","longname":"DatabaseService#embedKnowledgeBase","kind":"function","memberof":"DatabaseService","scope":"instance","params":[],"async":true,"$longname":"DatabaseService#embedKnowledgeBase","$kind":"method","id":6074,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n     * A convenience orchestrator that runs the entire knowledge base synchronization process.\n     * It first creates the knowledge base file and then embeds its contents into the vector database.\n     * This provides a simple, single-command way to update the knowledge base from scratch.\n     * @returns {Promise<object>} A promise that resolves to the final success message from the embedding step.\n     */","meta":{"range":[24056,24239],"filename":"DatabaseService.mjs","lineno":505,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100026259","name":"DatabaseService#syncDatabase","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>A convenience orchestrator that runs the entire knowledge base synchronization process.\nIt first creates the knowledge base file and then embeds its contents into the vector database.\nThis provides a simple, single-command way to update the knowledge base from scratch.</p>\n","returns":[{"type":{"names":["Promise.<object>"]},"description":"A promise that resolves to the final success message from the embedding step."}],"name":"syncDatabase","longname":"DatabaseService#syncDatabase","kind":"function","memberof":"DatabaseService","scope":"instance","params":[],"async":true,"$longname":"DatabaseService#syncDatabase","$kind":"method","id":6075,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"},{"comment":"/**\n     * Permanently deletes the entire knowledge base collection from ChromaDB.\n     * This is a destructive but necessary operation for performing a clean reset of the knowledge base.\n     * It handles cases where the collection may not exist gracefully.\n     * @returns {Promise<object>} A promise that resolves to a success message.\n     */","meta":{"range":[24596,25294],"filename":"DatabaseService.mjs","lineno":517,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100026281","name":"DatabaseService#deleteDatabase","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>Permanently deletes the entire knowledge base collection from ChromaDB.\nThis is a destructive but necessary operation for performing a clean reset of the knowledge base.\nIt handles cases where the collection may not exist gracefully.</p>\n","returns":[{"type":{"names":["Promise.<object>"]},"description":"A promise that resolves to a success message."}],"name":"deleteDatabase","longname":"DatabaseService#deleteDatabase","kind":"function","memberof":"DatabaseService","scope":"instance","params":[],"async":true,"$longname":"DatabaseService#deleteDatabase","$kind":"method","id":6076,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.DatabaseService"}]}