"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[96,942],{96(e,t,s){s.r(t),s.d(t,{default:()=>i});var a=s(247);class o extends a.A{static config={className:"Neo.main.addon.Base",isMainThreadAddon:!0,preloadFilesDelay:5e3};cache=[];get isLoading(){return!!this.#e&&!!this.#t}#e=null;#t=null;construct(e){super.construct(e);let t=this;if(t.#e=new Promise(e=>{t.#t=e}),!1===t.preloadFilesDelay)t.#t(),t.#t=null;else{const e=Neo.isNumber(t.preloadFilesDelay)?t.preloadFilesDelay:0;0===e?t.#s():t.timeout(e).then(()=>{t.#t&&t.#s()})}}async#s(){let e=this;if(e.#t){const t=e.#t;e.#t=null,await e.loadFiles(),t()}}async initAsync(){await super.initAsync(),await this.#e}afterSetIsReady(e,t){super.afterSetIsReady(e,t),e&&this.#a()}cacheMethodCall(e){let t=this;return t.#t&&t.#s(),new Promise((s,a)=>{t.cache.push({...e,reject:a,resolve:s})})}async loadFiles(){}onInterceptRemotes(e){return this.cacheMethodCall({fn:e.remoteMethod,data:e.data})}async#a(){let e=this;for(const t of e.cache){let s;try{s=e[t.fn](t.data),Neo.isPromise(s)&&(s=await s),t.resolve(s)}catch(e){t.reject(e);break}}e.cache=[]}}const i=Neo.setupClass(o)},942(e,t,s){s.r(t),s.d(t,{default:()=>c});var a=s(96),o=s(392),i=s(160),r=s(49);const n={A:1,BUTTON:1};class l extends a.default{static config={className:"Neo.main.addon.Navigator",remote:{app:["navigateTo","subscribe","unsubscribe"]}};clickItem(e){if("function"==typeof e.click)e.click();else{const t=e.getBoundingClientRect(),s=t.x+t.width/2,a=t.y+t.height/2;e.dispatchEvent(new MouseEvent("click",{bubbles:!0,altKey:Neo.altKeyDown,ctrlKey:Neo.controlKeyDown,metaKey:Neo.metaKeyDown,shiftKey:Neo.shiftKeyDown,clientX:s,clientY:a}))}}fixItemFocusability(e){if(!e.subject.contains(e.eventSource))return;const t=Array.from(e.subject.querySelectorAll(e.selector)).reduce((e,t)=>{const s=r.A.query(t,r.A.isFocusable);return s&&e.push(s),e},[]),s=t[0]||e.subject.querySelector(e.selector);t.forEach(e=>e!==s&&(e.tabIndex=-1)),s&&(s.tabIndex=0)}navigateClickHandler(e,t){let s=e.target.closest(t.selector);s&&!t.findFocusable(s)&&this.navigateTo({data:t,target:s})}navigateFocusInHandler(e,t){let s=e.target.closest(t.selector),{relatedTarget:a}=e,{subject:o}=t;s&&(this.setActiveItem(s,t),o.contains(a)&&(a.tabIndex=-1))}navigateFocusOutHandler(e,t){let{target:s}=e;s.closest(t.selector)?.classList.remove(t.activeCls),r.A.isTabbable(s)||(s.tabIndex=0)}navigateGetAdjacent(e=1,t){let{treeWalker:s}=t;if(s.currentNode=this.navigatorGetActiveItem(t)||t.subject,s[e<0?"previousNode":"nextNode"](),s.currentNode){if(s.currentNode!==t.activeItem)return s.currentNode}else if(!1!==t.wrap){const s=t.subject.querySelector(t.selector);return s[1===e?0:s.length-1]}}navigateKeyDownHandler(e,t){const s=this,{subject:a,wrap:o}=t,i=a.querySelector(t.selector);if(!t.nextKey&&i){const e=getComputedStyle(a),s=getComputedStyle(i);"flex"===e.display&&"row"===e.flexDirection||"inline"===s.display||"inline-block"===s.display?(t.previousKey="ArrowLeft",t.nextKey="ArrowRight"):(t.previousKey="ArrowUp",t.nextKey="ArrowDown")}let r,{key:l,target:c}=e;switch(l){case t.previousKey:r=s.navigateGetAdjacent(-1,t),!r&&o&&(r=a.querySelector(`${t.selector}:last-of-type`));break;case t.nextKey:r=s.navigateGetAdjacent(1,t),!r&&o&&(r=a.querySelector(t.selector));break;case"Home":r=a.querySelector(t.selector);break;case"End":r=a.querySelector(`${t.selector}:last-of-type`);break;case"Enter":t.activeItem&&!n[c.tagName]&&this.clickItem(t.activeItem)}r&&(e.preventDefault(),s.navigateTo({data:t,target:r}))}navigateMouseDownHandler(e,t){const s=e.target.closest(t.selector);s&&!t.findFocusable(s)&&e.preventDefault()}navigateNodeFilter(e,t){return e.offsetParent&&e.matches?.(t.selector)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}navigateTargetChildListChange(e,t){if(this.fixItemFocusability(t),t.keepFocusIndex&&t.activeItem&&!t.subject.contains(t.activeItem)){const e=t.subject.querySelectorAll(t.selector);e.length&&this.navigateTo({data:t,target:e[Math.max(Math.min(t.activeIndex,e.length-1),0)]})}}navigateTo(e){let{data:t,target:s}=e;if(!t.subject&&!(t=o.A.getElement(t.id)?.$navigator))return;if("number"==typeof s?s=t.subject.querySelectorAll(t.selector)?.[s]:"string"==typeof s&&(s=o.A.getElement(s)),!s)return;s.scrollIntoView({behavior:"smooth",block:"nearest"});const a=r.A.query(s,r.A.isFocusable);a?a.focus({preventScroll:!0}):this.setActiveItem(s,t)}navigatorGetActiveItem(e){let t=e.activeItem&&o.A.getElement(e.activeItem.id)||null;if(!t&&"activeIndex"in e){const s=e.subject.querySelectorAll(e.selector);t=s[Math.max(Math.min(e.activeIndex,s.length-1),0)]}return t}setActiveItem(e,t){const s=Array.from(t.subject.querySelectorAll(t.selector));"number"==typeof e&&(e=s[Math.max(Math.min(e,s.length-1),0)]),t.previousActiveIndex=t.activeIndex,(t.previousActiveItem=t.activeItem)?.classList.remove(t.activeCls),(t.activeItem=e)?.classList.add(t.activeCls),t.activeIndex=e?s.indexOf(e):-1,e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),(t.eventSource||t.subject).setAttribute("aria-activedescendant",t.activeItem.id),t.activeItem!==t.previousActiveItem&&i.A.sendMessageToApp({type:"neonavigate",target:t.id,path:[{id:t.id}],activeItem:t.activeItem.id,previousActiveItem:t.previousActiveItem?.id,activeIndex:t.activeIndex,previousActiveIndex:t.previousActiveIndex,altKey:Neo.altKeyDown,ctrlKey:Neo.controlKeyDown,metaKey:Neo.metaKeyDown,shiftKey:Neo.shiftKeyDown}),t.autoClick&&this.clickItem(e)}subscribe(e){const t=this,s=e.subject=o.A.getElement(e.id),a=e.eventSource=e.eventSource?o.A.getElement(e.eventSource):s;s&&(s.$navigator=e,e.activeCls||(e.activeCls="neo-navigator-active-item"),t.fixItemFocusability(e),e.findFocusable=t=>r.A.closest(t,t=>r.A.isFocusable(t)&&s.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY&&t.closest(e.selector)),e.treeWalker=document.createTreeWalker(s,NodeFilter.SHOW_ELEMENT,s=>t.navigateNodeFilter(s,e)),(e.targetMutationMonitor=new MutationObserver(s=>t.navigateTargetChildListChange(s,e))).observe(s,{childList:!0,subtree:!0}),a.addEventListener("keydown",e.l1=s=>t.navigateKeyDownHandler(s,e)),s.addEventListener("mousedown",e.l2=s=>t.navigateMouseDownHandler(s,e)),s.addEventListener("click",e.l3=s=>t.navigateClickHandler(s,e)),s.addEventListener("focusin",e.l4=s=>t.navigateFocusInHandler(s,e)),s.addEventListener("focusout",e.l5=s=>t.navigateFocusOutHandler(s,e)))}unsubscribe(e){const t=o.A.getElement(e.id);e=t?.$navigator,e&&(delete t.$navigator,e.targetMutationMonitor.disconnect(),e.eventSource.removeEventListener("keydown",e.l1),t.removeEventListener("mousedown",e.l2),t.removeEventListener("click",e.l3),t.removeEventListener("focusin",e.l4),t.removeEventListener("focusout",e.l5))}}const c=Neo.setupClass(l)}}]);