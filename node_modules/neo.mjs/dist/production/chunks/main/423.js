"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[96,423],{96(e,o,s){s.r(o),s.d(o,{default:()=>t});var r=s(247);class a extends r.A{static config={className:"Neo.main.addon.Base",isMainThreadAddon:!0,preloadFilesDelay:5e3};cache=[];get isLoading(){return!!this.#e&&!!this.#o}#e=null;#o=null;construct(e){super.construct(e);let o=this;if(o.#e=new Promise(e=>{o.#o=e}),!1===o.preloadFilesDelay)o.#o(),o.#o=null;else{const e=Neo.isNumber(o.preloadFilesDelay)?o.preloadFilesDelay:0;0===e?o.#s():o.timeout(e).then(()=>{o.#o&&o.#s()})}}async#s(){let e=this;if(e.#o){const o=e.#o;e.#o=null,await e.loadFiles(),o()}}async initAsync(){await super.initAsync(),await this.#e}afterSetIsReady(e,o){super.afterSetIsReady(e,o),e&&this.#r()}cacheMethodCall(e){let o=this;return o.#o&&o.#s(),new Promise((s,r)=>{o.cache.push({...e,reject:r,resolve:s})})}async loadFiles(){}onInterceptRemotes(e){return this.cacheMethodCall({fn:e.remoteMethod,data:e.data})}async#r(){let e=this;for(const o of e.cache){let s;try{s=e[o.fn](o.data),Neo.isPromise(s)&&(s=await s),o.resolve(s)}catch(e){o.reject(e);break}}e.cache=[]}}const t=Neo.setupClass(a)},423(e,o,s){s.r(o),s.d(o,{default:()=>l});var r=s(96),a=s(392);s(160),s(691);class t extends r.default{static observable=!0;static config={className:"Neo.main.addon.OpenStreetMaps",interceptRemotes:["create"],remote:{app:["addMarker","create","destroyMarkers","geocode","hideMarker","panTo","removeMap","removeMarker","setCenter","setZoom","showMarker"]}};maps={};markers={};vectorLayers={};vectorSources={};addMarker(e){}async create(e){let o=this,{id:s}=e;if(globalThis.ol||await o.loadFiles(),!s)return void console.error("Map ID is not provided");let r=document.getElementById(s);if(window.getComputedStyle(r),r)try{let a={center:[e.center.lng,e.center.lat],zoom:e.zoom||10,minZoom:null!=e.minZoom?e.minZoom:0,maxZoom:null!=e.maxZoom?e.maxZoom:28},t=new ol.View(a),l=new ol.layer.Tile({source:new ol.source.OSM}),n=[];e.fullscreenControl&&n.push(new ol.control.FullScreen);let i=new ol.Map({controls:n,target:r,layers:[l],view:t});return e.fullscreenControl&&i.addControl(new ol.control.FullScreen),o.maps[s]=i,t.on("change:zoom",()=>{o.onMapZoomChange(i,s)}),i.on("click",e=>{i.forEachFeatureAtPixel(e.pixel,s=>{s.get("neoId")&&o.onMarkerClick(s,e)})}),{success:!0,mapId:s}}catch(e){return console.error(`Failed to create OpenStreetMaps map "${s}":`,e),{success:!1,error:e.message,mapId:s}}else console.error(`Map container element with id "${s}" not found`)}destroyMarkers(e){}async geocode(e){}hideMarker(e){}async loadFiles(){await super.loadFiles();let e=Neo.config.openLayersVersion||"10.6.1",o=Neo.config.openLayersBasePath||`https://cdn.jsdelivr.net/npm/ol@${e}`,s=`${o}/ol.css`,r=`${o}/dist/ol.js`;try{if(await Promise.all([a.A.loadStylesheet(s),a.A.loadScript(r)]),"undefined"==typeof ol||!ol.Map||!ol.source||!ol.source.OSM)throw new Error("OpenLayers failed to load completely");ol.proj.useGeographic()}catch(e){throw console.error("Failed to load OpenLayers:",e),e}}onMapZoomChange(e,o){let s=this,r=e.getView(),a=r.getZoom(),t=r.getCenter(),l={lng:t[0],lat:t[1]};s.fire("zoomChanged",{mapId:o,zoom:a,center:l}),s.maps[o].neoData||(s.maps[o].neoData={}),s.maps[o].neoData.currentZoom=a,s.maps[o].neoData.currentCenter=l}onMarkerClick(e,o){}panTo(e){let o=this,{mapId:s,position:r,duration:a=1e3}=e;if(!s||!o.maps[s])return console.error(`Map with id "${s}" not found`),{success:!1,error:`Map with id "${s}" not found`};if(!r||void 0===r.lat||void 0===r.lng)return console.error("Invalid position data. Expected object with lat and lng properties"),{success:!1,error:"Invalid position data"};try{let e=o.maps[s].getView(),t=[r.lng,r.lat];return e.animate({center:t,duration:a,easing:ol.easing.easeOut}),{success:!0,mapId:s,position:r}}catch(e){return console.error(`Failed to pan map "${s}":`,e),{success:!1,error:e.message,mapId:s}}}removeMap(e){}removeMarker(e){}setCenter(e){}setZoom(e){let o=this,{id:s,value:r,duration:a=1e3}=e;if(!s||!o.maps[s])return console.error(`Map with id "${s}" not found`),{success:!1,error:`Map with id "${s}" not found`};if(void 0===r||"number"!=typeof r)return console.error("Invalid zoom level. Expected a number"),{success:!1,error:"Invalid zoom level"};try{let e=o.maps[s].getView(),t=e.getMinZoom(),l=e.getMaxZoom();return void 0!==t&&r<t&&(console.warn(`Zoom level ${r} is below minimum ${t}, setting to minimum`),r=t),void 0!==l&&r>l&&(console.warn(`Zoom level ${r} is above maximum ${l}, setting to maximum`),r=l),e.animate({zoom:r,duration:a,easing:ol.easing.easeOut}),{success:!0,mapId:s,zoom:r}}catch(e){return console.error(`Failed to set zoom for map "${s}":`,e),{success:!1,error:e.message,mapId:s}}}showMarker(e){}getDefaultMarkerStyle(){return new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"data:image/svg+xml;base64,"+btoa('\n                    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                        <path fill="#FF0000" stroke="#FFFFFF" stroke-width="2" \n                              d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>\n                        <circle fill="#FFFFFF" cx="12" cy="9" r="3"/>\n                    </svg>\n                ')})})}}const l=Neo.setupClass(t)}}]);