"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[96,718],{96:(e,a,t)=>{t.r(a),t.d(a,{default:()=>o});var s=t(583);class l extends s.A{static config={className:"Neo.main.addon.Base",isMainThreadAddon:!0,preloadFilesDelay:5e3};cache=[];get isLoading(){return!!this.#e&&!!this.#a}#e=null;#a=null;construct(e){super.construct(e);let a=this;if(a.#e=new Promise(e=>{a.#a=e}),!1===a.preloadFilesDelay)a.#a(),a.#a=null;else{const e=Neo.isNumber(a.preloadFilesDelay)?a.preloadFilesDelay:0;0===e?a.#t():a.timeout(e).then(()=>{a.#a&&a.#t()})}}async#t(){let e=this;if(e.#a){const a=e.#a;e.#a=null,await e.loadFiles(),a()}}async initAsync(){await super.initAsync(),await this.#e}afterSetIsReady(e,a){e&&this.#s()}cacheMethodCall(e){let a=this;return a.#a&&a.#t(),new Promise((t,s)=>{a.cache.push({...e,reject:s,resolve:t})})}async loadFiles(){}async#s(){let e=this;for(const a of e.cache){let t;try{t=e[a.fn](a.data),Neo.isPromise(t)&&(t=await t),a.resolve(t)}catch(e){a.reject(e);break}}e.cache=[]}}const o=Neo.setupClass(l)},337:(e,a,t)=>{t.r(a),t.d(a,{default:()=>i});var s=t(96),l=t(392);class o extends s.default{static config={className:"Neo.main.addon.AmCharts",charts:{},dataMap:{},downloadPath:"https://cdn.amcharts.com/lib/4/",fallbackPath:"https://raw.githubusercontent.com/neomjs/pages/main/resources_pub/amCharts/",remote:{app:["callMethod","create","destroy","setProperties","setProperty","updateData"]},useFallbackPath:!1};afterSetIsReady(e,a){if(super.afterSetIsReady(e,a),e){let e=this;e.timeout(1e3).then(()=>{Object.entries(e.dataMap).forEach(([a,t])=>{e.updateData(t)}),e.dataMap={}})}}callMethod(e){let a=this;if(!a.isReady)return a.cacheMethodCall({fn:"callMethod",data:e});if(a.hasChart(e.id)){let t=a.charts[e.id],s=e.path.split("."),l=s.pop(),o=s.length<1?t:Neo.ns(s.join("."),!1,t);o[l].call(o,...e.params||[])}}combineSeriesTooltip(e){e.series.each(a=>{a.adapter.add("tooltipText",()=>{let a="[bold]{dateX}[/]\n";return e.series.each(e=>{a+="["+e.stroke+"]â—[/] "+e.name+": {"+e.dataFields.valueY+"}\n"}),a})})}create(e){let a=this;if(!a.isReady)return a.cacheMethodCall({fn:"create",data:e});am4core.useTheme(am4themes_dark),a.charts[e.id]=am4core.createFromConfig(e.config,e.id,globalThis[e.package][e.type||"XYChart"]),e.combineSeriesTooltip&&a.combineSeriesTooltip(a.charts[e.id]),e.data?a.updateData({data:e.data,dataPath:e.dataPath,id:e.id}):a.dataMap[e.id]&&(a.updateData(a.dataMap[e.id]),delete a.dataMap[e.id])}destroy(e){let a=this;if(!a.isReady)return a.cacheMethodCall({fn:"destroy",data:e});a.charts[e.id]?.dispose?.(),delete a.charts[e.id]}hasChart(e){return!!this.charts[e]}async loadFiles(e=!1){let a,t=this,s=t.useFallbackPath||e;s&&Neo.config.isGitHubPages?(a="../../../../resources_pub/amCharts/","development"!==Neo.config.environment&&(a=`../../${a}`)):a=s?t.fallbackPath:t.downloadPath;try{await l.A.loadScript(a+"core.js"),await Promise.all([l.A.loadScript(a+"charts.js"),l.A.loadScript(a+"maps.js"),l.A.loadScript(a+"themes/dark.js"),l.A.loadScript(a+"geodata/worldLow.js")])}catch(a){e||t.useFallbackPath||(console.log("Download from amcharts.com failed, switching to fallback",a),await t.loadFiles(!0))}}setProperties(e){let a=this;if(!a.isReady)return a.cacheMethodCall({fn:"setProperties",data:e});Object.entries(e.properties).forEach(([t,s])=>{a.setProperty({id:e.id,path:t,value:s})})}setProperty(e){if(!this.isReady)return this.cacheMethodCall({fn:"setProperty",data:e});if(this.hasChart(e.id)){let a=this.charts[e.id],t=e.path.split("."),s=t.pop();Neo.ns(t.join("."),!1,a)[s]=e.isColor?am4core.color(e.value):e.value}}updateData(e){let a=this;if(!a.isReady)return a.cacheMethodCall({fn:"updateData",data:e});if(a.hasChart(e.id)){let t=a.charts[e.id];""===e.dataPath?t.data=e.data:Neo.ns(e.dataPath,!1,t).data=e.data}else a.dataMap[e.id]=e}}const i=Neo.setupClass(o)}}]);