"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[4599,5251],{4599:(e,t,o)=>{o.r(t),o.d(t,{default:()=>l});var n=o(5251);class i extends n.default{static config={className:"Neo.grid.plugin.CellEditing",ntype:"plugin-grid-cell-editing",cellCls:"neo-grid-cell",editorCls:["neo-grid-editor"],focusCells:!0}}const l=Neo.setupClass(i)},4367:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(2583);class i extends n.A{static config={className:"Neo.plugin.Base",ntype:"plugin",owner:null,windowId_:null};construct(e){super.construct(e);let t=this;t.owner.mounted?t.onOwnerMounted():t.owner.on("mounted",t.onOwnerMounted,t)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}onOwnerMounted(){}}const l=Neo.setupClass(i)},5251:(e,t,o)=>{o.r(t),o.d(t,{default:()=>s});var n=o(4367),i=o(3599),l=o(825);class d extends n.A{static config={className:"Neo.table.plugin.CellEditing",ntype:"plugin-table-cell-editing",cellCls:"neo-table-cell",disabled_:!1,editorCls:["neo-table-editor"],focusCells:!0};editors={};mountedEditor=null;construct(e){super.construct(e);let t=this,{owner:o}=t,{selectionModel:n}=o;o.on({cellDoubleClick:t.onCellDoubleClick,focusLeave:t.onFocusLeave,selectionModelChange:t.onSelectionModelChange,scope:t}),"NeoInstance"===Neo.typeOf(n)&&t.onSelectionModelChange({value:n}),o.view.keys.add({Enter:"onTableKeyDown",Space:"onTableKeyDown",scope:t})}afterSetDisabled(e,t){t&&this.unmountEditor()}destroy(...e){Object.values(this.editors).forEach((e=>{e.destroy(!1,!0)})),super.destroy(...e)}async mountEditor(e,t){if(this.disabled)return;let o,n=this,{appName:d,windowId:s}=n,{view:a}=n.owner,r=a.getCellId(e,t),c=l.A.find(a.vdom,r).vdom,u=n.owner.headerToolbar.getColumn(t),w=n.editors[t],m=e[t];n.mountedEditor&&(await n.unmountEditor(),await n.timeout(10)),u.editable&&(w?(w.originalConfig.value=m,w.setSilent({record:e,value:m})):(n.editors[t]=w=Neo.create({module:i.A,appName:d,cls:n.editorCls,dataField:t,hideLabel:!0,parentId:a.id,record:e,value:m,windowId:s,...u.editor}),o={Enter:"onEditorKeyEnter",Escape:"onEditorKeyEscape",Tab:"onEditorKeyTab",scope:n},w.keys?w.keys.add(o):w.keys=o),n.mountedEditor=w,c.cn=[w.createVdomReference()],delete c.innerHTML,a.updateDepth=-1,await a.promiseUpdate(),await n.timeout(30),w.focus())}async onCellDoubleClick({data:e,dataField:t,record:o,view:n}){await this.mountEditor(o,t)}async onEditorKeyEnter(e,t){let o=this;await o.submitEditor(),await o.timeout(20),o.selectCell(e)}async onEditorKeyEscape(e,t){let o=this;await o.unmountEditor(),await o.timeout(20),o.selectCell(e)}async onEditorKeyTab(e,t){let o=this,{store:n}=o.owner,i=n.indexOf(t.record),l=n.getCount(),d=(i+(e.altKey?-1:1)+l)%l,s=n.getAt(d);await o.submitEditor(),await o.mountEditor(s,t.dataField)}async onFocusLeave(e){await this.unmountEditor()}onSelectionChange(e){}onSelectionModelChange(e){let t=e.value;t.ntype.includes("cell")&&t.on("selectionChange",this.onSelectionChange,this)}async onTableKeyDown(e){let t,o,n=this,{target:i}=e,{view:l}=n.owner;!n.mountedEditor&&i.cls?.includes("neo-selected")&&(t=l.getCellDataField(i.id),o=l.getRecord(i.id),await n.mountEditor(o,t))}selectCell({path:e}){let t,o=this,{selectionModel:n}=o.owner,i=0,l=e.length;for(;i<l;i++)if(e[i].cls?.includes(o.cellCls)){t=e[i].id;break}t&&(n?.deselect(t,!0),n?.select(t),o.focusCells&&o.owner.focus(t))}async submitEditor(){let e=this,t=e.mountedEditor;t?.isValid()&&(t.isDirty?(e.mountedEditor=null,t.record[t.dataField]=t.getSubmitValue()):await e.unmountEditor())}async unmountEditor(){if(!this.mountedEditor)return;let e=this,t=e.mountedEditor.record,{view:o}=e.owner,n=o.store.indexOf(t);e.mountedEditor=null,o.getVdomRoot().cn[n]=o.createRow({record:t,rowIndex:n}),await o.promiseUpdate()}}const s=Neo.setupClass(d)}}]);