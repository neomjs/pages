"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[9380],{1753(e,t,r){r.d(t,{default:()=>g});var o=r(3572),a=r(1741),n=r(6282),i=r(2450),d=r(1031),l=(r(4556),r(950));class s extends o.A{static observable=!0;static config={className:"Neo.draggable.DragZone",ntype:"dragzone",addDragProxyCls:!0,allowOverdrag:!1,alwaysFireDragMove:!1,appName_:null,bodyCursorStyle:null,boundaryContainerId:null,boundaryContainerRect:null,data:null,dragElement:null,dragElementRect:null,dragProxy:null,dragProxyConfig_:null,dragProxyCls:"neo-dragproxy",dropZoneIdentifier:null,moveHorizontal:!0,moveInMainThread:!0,moveVertical:!0,offsetX:0,offsetY:0,owner:null,proxyParentId_:"document.body",scrollContainerId:null,scrollFactorLeft:1,scrollFactorTop:1,useProxyWrapper:!0,windowId_:null};construct(e){super.construct(e),Neo.main.addon.DragDrop||console.error("You can not use Neo.draggable.DragZone without adding Neo.main.addon.DragDrop to the main thread addons",this.id)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}beforeGetDragProxyConfig(e){return Neo.clone(e,!0,!0)}async createDragProxy(e,t=!0){let r,o,s=this,g=Neo.getComponent(s.getDragElementRoot().id)||s.owner,c=s.dragElementRect,h=s.dragProxyConfig||{},p=h.module===i.A,m=h.vdom,u=!p&&l.A.clone(m||s.dragElement);if(r={module:n.A,appName:s.appName,moveInMainThread:s.moveInMainThread,parentId:s.proxyParentId,windowId:s.windowId,...h},p?(r.height=`${e.height}px`,r.items=[],r.parentComponent=s.owner,r.width=`${e.width}px`,r.cls=r.cls||[],r.cls.push("neo-draggable")):(r.vdom=s.useProxyWrapper?{cn:[u]}:u,u.cls&&!s.useProxyWrapper&&(r.cls=r.cls||[],r.cls.push(...u.cls))),r.cls=r.cls||[],g&&r.cls.push(g.getTheme()),s.addDragProxyCls&&r.cls&&d.A.add(r.cls,s.dragProxyCls),r.style=r.style||{},Object.assign(r.style,{height:`${e.height}px`,left:`${s.moveHorizontal?e.x:c.x}px`,top:`${s.moveVertical?e.y:c.y}px`,width:`${e.width}px`}),t){if(p&&(r.autoInitVnode=!0,r.autoMount=!0),s.dragProxy=o=Neo.create(r),p){await o.mountedPromise,s.dragPlaceholder=Neo.create({module:a.A,flex:g.flex,style:{height:`${e.height}px`,visibility:"hidden",width:`${e.width}px`}}),g.minHeight&&(s.dragPlaceholder.minHeight=g.minHeight),g.minWidth&&(s.dragPlaceholder.minWidth=g.minWidth),s.dragStartIndex=s.owner.items.indexOf(g);const{vnode:t}=await Neo.vdom.Helper.create({vdom:s.dragPlaceholder.vdom});await Neo.applyDeltas(s.windowId,[{action:"insertNode",index:s.dragStartIndex,parentId:s.owner.getVdomItemsRoot().id,vnode:t},{action:"moveNode",id:g.id,index:0,parentId:o.id}]),s.dragPlaceholder.set({vnode:t,mounted:!0,vnodeInitialized:!0})}return o}return r}destroyDragProxy(){let e=this,t=e.dragProxy.id;e.timeout(e.moveInMainThread?0:30).then(()=>{Neo.applyDeltas(e.windowId,[{action:"removeNode",id:t}])}),e.dragProxy.destroy()}dragEnd(e){let t=this,{owner:r}=t,{cls:o}=r;d.A.remove(o,"neo-is-dragging"),r.cls=o,t.dragProxy&&(t.dragPlaceholder&&(t.dragPlaceholder.destroy(),t.dragPlaceholder=null),t.destroyDragProxy(),t.dragProxy=null),Object.assign(t,{dragElementRect:null,dragStartIndex:null,offsetX:0,offsetY:0,scrollContainerId:null}),t.fire("dragEnd",e),t.resetData()}dragMove(e){let t,r=this;!r.moveInMainThread&&r.dragProxy&&(t=r.dragProxy.style,r.moveHorizontal&&(t.left=e.clientX-r.offsetX+"px"),r.moveVertical&&(t.top=e.clientY-r.offsetY+"px"),r.dragProxy.style=t),r.fire("dragMove",e)}async dragStart(e){let t,r,o,a=this,{appName:n,owner:i,windowId:l}=a,{cls:s}=i,g=a.getDragElementRect(e);a.setData(),t=await Neo.main.addon.DragDrop.setConfigs({appName:n,windowId:l,...a.getMainThreadConfigs()}),a.boundaryContainerRect=t.boundaryContainerRect,d.A.add(s,"neo-is-dragging"),i.cls=s,r=e.clientX-g.left,o=e.clientY-g.top,Object.assign(a,{dragElementRect:g,offsetX:r,offsetY:o}),await a.createDragProxy(g),a.fire("dragStart",{clientX:e.clientX,clientY:e.clientY,dragElementRect:g,eventData:e,id:a.id,offsetX:r,offsetY:o})}getDragElementRect(e){let t=this.getDragElementRoot().id;for(let r of e.path)if(r.id===t)return r.rect;for(let r of e.targetPath)if(r.id===t)return r.rect;return null}getDragElementRoot(){return this.dragElement}getMainThreadConfigs(){let e=this;return{allowOverdrag:e.allowOverdrag,alwaysFireDragMove:e.alwaysFireDragMove,bodyCursorStyle:e.bodyCursorStyle,boundaryContainerId:e.boundaryContainerId,dragElementRootId:e.getDragElementRoot().id,dragProxyCls:e.dragProxyCls,dragZoneId:e.id,dropZoneIdentifier:e.dropZoneIdentifier,moveHorizontal:e.moveHorizontal,moveVertical:e.moveVertical,scrollContainerId:e.scrollContainerId,scrollFactorLeft:e.scrollFactorLeft,scrollFactorTop:e.scrollFactorTop}}onDrop(e){this.fire("drop",e)}onDropEnter(e){this.fire("drop:enter",e)}onDropLeave(e){this.fire("drop:leave",e)}resetData(){this.timeout(50).then(()=>{this.data=null})}setData(e={}){let t=this;t.data={dragElement:t.getDragElementRoot(),dragZoneId:t.id,...e}}}const g=Neo.setupClass(s)},9380(e,t,r){r.r(t),r.d(t,{default:()=>s});var o=r(1753),a=r(1031),n=r(950);class i extends o.default{static config={className:"Neo.draggable.container.DragZone",ntype:"container-dragzone"};construct(e){super.construct(e);let t=this,{owner:r}=t,o={delegate:".neo-draggable",scope:t};r.addDomListeners([{"drag:end":t.onDragEnd,...o},{"drag:move":t.onDragMove,...o},{"drag:start":t.onDragStart,...o}]),r.on({insert:t.onItemInsert,itemsCreated:t.onItemsCreated,scope:t}),t.adjustItemCls(!0)}adjustItemCls(e){let t,{owner:r}=this;r.items.forEach(r=>{"string"!=typeof r&&(t=r.wrapperCls||[],a.A.toggle(t,"neo-draggable",e),r.wrapperCls=t)})}onDragEnd(e){if(this.owner.draggable){let e=this,t=e.dragProxy,r=t.cls||{},o=e.dragElementRect,n=t.wrapperStyle||{};a.A.add(r,"neo-animate"),t.cls=r,e.timeout(30).then(()=>{n.left=`${o.left}px`,n.top=`${o.top}px`,t.wrapperStyle=n,e.timeout(100).then(()=>{e.dragEnd()})})}}async onDragStart(e){let t=this;t.owner.draggable&&(t.dragElement=n.A.find(t.owner.vdom,e.path[0].id).vdom,await t.dragStart(e))}onItemInsert(e){let{item:t}=e,r=t.wrapperCls||[];a.A.add(r,"neo-draggable"),t.wrapperCls=r}onItemsCreated(e){this.adjustItemCls(!0)}}const d=Neo.setupClass(i);var l=r(6743);const s=Neo.setupClass(class extends d{static config={className:"Neo.draggable.container.SortZone",ntype:"container-sortzone",adjustItemRectsToParent:!1,alwaysFireDragMove:!0,currentIndex:-1,dragHandleSelector:null,enableProxyToPopup:!1,indexMap:null,itemRects:null,itemStyles:null,ownerRect:null,ownerStyle:null,reversedLayoutDirection:!1,scrollLeft:0,scrollTop:0,sortDirection:"horizontal",startIndex:-1};isOverDragging=!1;isWindowDragging=!1;adjustItemCls(e){let t=this;if(t.dragHandleSelector){const r=t.dragHandleSelector.startsWith(".")?t.dragHandleSelector.substring(1):t.dragHandleSelector;t.owner.items.filter(e=>"string"!=typeof e&&n.A.find(e.vdom,{cls:r})).forEach(t=>{const r=t.wrapperCls||[];a.A.toggle(r,"neo-draggable",e),t.wrapperCls=r})}else super.adjustItemCls(e)}getDragProxyConfig(){return{...this.dragProxyConfig,cls:[...this.owner.cls]}}moveTo(e,t){this.owner.moveTo(e,t)}async onDragEnd(e){let t,r=this,{itemStyles:o,owner:a}=r,n=a.style||{};if(await r.timeout(10),a.dragResortable){if(r.dragPlaceholder){const e=r.dragComponent,t=[],o=r.sortableItems.indexOf(r.dragPlaceholder);e&&o>-1&&(r.isWindowDragging||t.push({action:"moveNode",id:e.id,index:o,parentId:a.getVdomItemsRoot().id}),t.push({action:"removeNode",id:r.dragPlaceholder.id}),await Neo.applyDeltas(r.windowId,t))}if(n.height=r.ownerStyle.height||null,n.minWidth=r.ownerStyle.minWidth||null,n.width=r.ownerStyle.width||null,a.style=n,r.sortableItems?.forEach((e,a)=>{r.isWindowDragging&&e===r.dragComponent||(t=e.wrapperStyle||{},Object.assign(t,{height:o[a].height||null,left:null,margin:null,position:null,top:null,width:o[a].width||null}),a===r.startIndex&&(t.visibility=null),e.wrapperStyle=t)}),!r.isWindowDragging&&r.startIndex!==r.currentIndex){let e,t;if(r.dragPlaceholder){const o=r.dragComponent;e=r.owner.items.indexOf(o),t=r.owner.items.indexOf(r.sortableItems[r.currentIndex])}else e=r.owner.items.indexOf(r.sortableItems[r.startIndex]),t=r.owner.items.indexOf(r.sortableItems[r.currentIndex]);r.moveTo(e,t)}Object.assign(r,{currentIndex:-1,indexMap:null,isWindowDragging:!1,itemRects:null,itemStyles:null,ownerRect:null,startIndex:-1,sortableItems:null}),await r.timeout(30),r.dragEnd(e)}}async onDragMove(e){let t=this;if(!t.itemRects||t.isScrolling)return;if(t.dragProxy&&t.enableProxyToPopup){const{proxyRect:r}=e;if(r&&t.boundaryContainerRect){const e=t.boundaryContainerRect,o=l.A.getIntersection(r,e),a=r.width*r.height,n=o?o.width*o.height:0;if(t.isWindowDragging){if(t.isWindowDragging)return void(a>0&&n/a>.51&&(t.dragPlaceholder.wrapperStyle={...t.dragPlaceholder.wrapperStyle,visibility:"visible"},t.itemRects.forEach((e,r)=>{let o=t.indexMap[r];if(-1!==o){let r=t.owner.items[o];r!==t.dragPlaceholder&&r!==t.dragComponent&&(r.wrapperStyle={...r.wrapperStyle,height:`${e.height}px`,left:`${e.left}px`,top:`${e.top}px`,width:`${e.width}px`})}}),t.fire("dragBoundaryEntry",{draggedItem:t.dragComponent,proxyRect:r,sortZone:t})))}else if(a>0&&n/a<.5)return t.isWindowDragging=!0,void t.fire("dragBoundaryExit",{draggedItem:t.dragComponent,proxyRect:r,sortZone:t})}}let r,o,a,n,i,d,{clientX:s,clientY:g}=e,c=t.currentIndex,{itemRects:h}=t,p=h.length-1,m=t.adjustItemRectsToParent?t.ownerRect.x:0,u=t.adjustItemRectsToParent?t.ownerRect.y:0,w=t.reversedLayoutDirection;"horizontal"===t.sortDirection?(r=s-m+t.scrollLeft-t.offsetX-h[c].left,a=s>t.boundaryContainerRect.right,n=s<t.boundaryContainerRect.left,i="width"):(r=g-u+t.scrollTop-t.offsetY-h[c].top,a=g>t.boundaryContainerRect.bottom,n=g<t.boundaryContainerRect.top,i="height"),o=a||n,d=o?.02:.55,n?c>0&&(t.currentIndex--,await t.scrollToIndex(),t.switchItems(c,t.currentIndex)):a?c<p&&(t.currentIndex++,await t.scrollToIndex(),t.switchItems(c,t.currentIndex)):c>0&&(!w&&r<0||w&&r>0)?Math.abs(r)>h[c-1][i]*d&&(t.currentIndex--,t.switchItems(c,t.currentIndex)):c<p&&(!w&&r>0||w&&r<0)&&Math.abs(r)>h[c+1][i]*d&&(t.currentIndex++,t.switchItems(c,t.currentIndex)),t.isOverDragging=o&&0!==t.currentIndex&&t.currentIndex!==p,t.isOverDragging&&(await t.timeout(30),t.isOverDragging&&await t.onDragMove(e))}async onDragStart(e){let t,r,o,a,i,d,l=this,{adjustItemRectsToParent:s,dragHandleSelector:g,owner:c}=l,h=l.itemStyles=[],{layout:p}=c,m=c.style||{};if(c.dragResortable){if(g){const o=g.substring(1),a=e.path.find(e=>e.cls.includes(o));if(!a)return;for(let r=e.path.indexOf(a);r<e.path.length;r++){const o=e.path[r],a=Neo.getComponent(o.id);if(a&&c.items.includes(a)){t=a;break}}if(!t)return;if(d=c.items.filter(e=>n.A.find(e.vdom,{cls:g.startsWith(".")?g.substring(1):g})),r=d.indexOf(t),r<0)return}else t=Neo.getComponent(e.path[0].id),d=c.items,r=c.indexOf(t.id);o={},Object.assign(l,{currentIndex:r,dragElement:n.A.find(c.vdom,t.id).vdom,dragProxyConfig:l.getDragProxyConfig(),indexMap:o,ownerStyle:{height:m.height,minWidth:m.minWidth,width:m.width},reversedLayoutDirection:"column-reverse"===p.direction||"row-reverse"===p.direction,sortableItems:d,sortDirection:p.direction?.includes("column")?"vertical":"horizontal",startIndex:r}),l.dragComponent=t,d.forEach((e,t)=>{o[t]=c.items.indexOf(e),h.push({height:e.height?`${e.height}px`:e.style?.height,width:e.width?`${e.width}px`:e.style?.width})});const u=await c.getDomRect([c.id].concat(d.map(e=>e.id)));if(l.ownerRect=u.shift(),c.style={...m,height:`${l.ownerRect.height}px`,minWidth:`${l.ownerRect.width}px`,width:`${l.ownerRect.width}px`},s&&u.forEach(e=>{e.x-=l.ownerRect.x,e.y-=l.ownerRect.y}),l.itemRects=u,await l.dragStart(e),l.dragPlaceholder){const e=d.indexOf(t);e>-1&&(d[e]=l.dragPlaceholder),l.dragElement=l.dragPlaceholder.vdom}d.forEach((e,t)=>{a=e.wrapperStyle||{},i=l.itemRects[t],l.adjustProxyRectToParent?.(i,l.ownerRect),e.wrapperStyle=Object.assign(a,{height:`${i.height}px`,left:`${i.left}px`,margin:"0px",position:"absolute",top:`${i.top}px`,width:`${i.width}px`})}),await l.timeout(5),l.dragPlaceholder||(a=t.wrapperStyle||{},a.visibility="hidden",t.wrapperStyle=a)}}calculateExpandedLayout(){let e=this,t=e.ownerRect,r="horizontal"===e.sortDirection,o=r?t.width:t.height,a=[],n=0,i=0,d=[],l=0,s=0,g=0,c=0,h=0,p=0,m=0,u=e.adjustItemRectsToParent?0:t.x,w=e.adjustItemRectsToParent?0:t.y;if(e.itemRects.length>0){let a=e.itemRects[0],n=e.itemRects[e.itemRects.length-1];if(r){if(l=e.adjustItemRectsToParent?a.x:a.x-t.x,s=o-(e.adjustItemRectsToParent?n.x+n.width:n.x-t.x+n.width),c=e.adjustItemRectsToParent?a.y:a.y-t.y,h=t.height-(e.adjustItemRectsToParent?a.y+a.height:a.y-t.y+a.height),e.itemRects.length>1){let t=e.itemRects[1];g=t.x-(a.x+a.width)}}else if(l=e.adjustItemRectsToParent?a.y:a.y-t.y,s=o-(e.adjustItemRectsToParent?n.y+n.height:n.y-t.y+n.height),p=e.adjustItemRectsToParent?a.x:a.x-t.x,m=t.width-(e.adjustItemRectsToParent?a.x+a.width:a.x-t.x+a.width),e.itemRects.length>1){let t=e.itemRects[1];g=t.y-(a.y+a.height)}}for(let t=0;t<e.itemRects.length;t++){let o=e.indexMap[t];if(-1===o)continue;let d=e.owner.items[o];if(d===e.dragPlaceholder||d===e.dragComponent)continue;let l=e.itemRects[t];a.push({item:d,rect:l}),d.flex?n+=d.flex:i+=r?l.width:l.height}let x=Math.max(0,a.length-1),y=Math.max(0,o-l-s-x*g-i),f=l;return a.forEach(({item:e,rect:o},a)=>{let i,l={};i=e.flex?e.flex/n*y:r?o.width:o.height,l=r?{left:`${u+f}px`,top:`${w+c}px`,height:t.height-c-h+"px",width:`${i}px`}:{left:`${u+p}px`,top:`${w+f}px`,height:`${i}px`,width:t.width-p-m+"px"},d.push({item:e,style:l}),f+=i+g}),d}async scrollToIndex(){let e=this;e.isScrolling=!0,await(e.owner.scrollToIndex?.(e.currentIndex,e.itemRects[e.currentIndex])),e.isScrolling=!1}startWindowDrag(e){let t=this,{popupHeight:r,popupWidth:o,windowName:a}=e;t.dragProxy.style={opacity:0},t.isWindowDragging=!0,t.dragPlaceholder&&(t.dragPlaceholder.wrapperStyle={...t.dragPlaceholder.wrapperStyle,visibility:"hidden"}),t.calculateExpandedLayout().forEach(({item:e,style:t})=>{e.wrapperStyle={...e.wrapperStyle,...t}}),Neo.main.addon.DragDrop.startWindowDrag({popupHeight:r,popupName:a,popupWidth:o,windowId:t.windowId})}switchItems(e,t){let r,o=this,a=o.reversedLayoutDirection;(!a&&t<e||a&&e<t)&&(r=e,e=t,t=r);let n=o.itemRects,i=o.indexMap,d=n[e],l=n[t],s=d.clone(),g=l.clone();if("horizontal"===o.sortDirection){const e=g.x-(s.x+s.width);d.width=g.width,l.x=s.x+g.width+e,l.width=s.width}else{const e=g.y-(s.y+s.height);d.height=g.height,l.height=s.height,l.y=s.y+g.height+e}r=i[e],i[e]=i[t],i[t]=r,o.updateItem(e,d),o.updateItem(t,l)}updateItem(e,t){let r,o=this,a=o.indexMap[e];if(-1===a){if(!o.dragPlaceholder)return;r=o.dragPlaceholder}else r=o.owner.items[a],o.dragPlaceholder&&r===o.dragComponent&&(r=o.dragPlaceholder);let{wrapperStyle:n}=r;n.left=`${t.left}px`,n.top=`${t.top}px`,r.wrapperStyle=n}})}}]);