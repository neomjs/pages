"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[5251],{4367:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(2583);class i extends n.A{static config={className:"Neo.plugin.Base",ntype:"plugin",owner:null,windowId_:null};construct(e){super.construct(e);let t=this;t.owner.mounted?t.onOwnerMounted():t.owner.on("mounted",t.onOwnerMounted,t)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}onOwnerMounted(){}}const l=Neo.setupClass(i)},5251:(e,t,o)=>{o.r(t),o.d(t,{default:()=>d});var n=o(4367),i=o(3599),l=o(825);class a extends n.A{static config={className:"Neo.table.plugin.CellEditing",ntype:"plugin-table-cell-editing",cellCls:"neo-table-cell",disabled_:!1,editorCls:["neo-table-editor"]};editors={};mountedEditor=null;construct(e){super.construct(e);let t=this,{owner:o}=t,{selectionModel:n}=o;o.on({cellDoubleClick:t.onCellDoubleClick,focusLeave:t.onFocusLeave,selectionModelChange:t.onSelectionModelChange,scope:t}),"NeoInstance"===Neo.typeOf(n)&&t.onSelectionModelChange({value:n}),o.view.keys.add({Enter:"onTableKeyDown",Space:"onTableKeyDown",scope:t})}afterSetDisabled(e,t){t&&this.unmountEditor()}destroy(...e){Object.values(this.editors).forEach((e=>{e.destroy(!1,!0)})),super.destroy(...e)}async mountEditor(e,t){if(this.disabled)return;let o=this,{appName:n,windowId:a}=o,{view:d}=o.owner,s=d.getCellId(e,t),r=l.A.find(d.vdom,s).vdom,c=o.owner.headerToolbar.getColumn(t),u=o.editors[t],w=e[t];o.mountedEditor&&(await o.unmountEditor(),await o.timeout(10)),c.editable&&(u?(u.originalConfig.value=w,u.setSilent({record:e,value:w})):o.editors[t]=u=Neo.create({module:i.A,appName:n,cls:o.editorCls,dataField:t,hideLabel:!0,parentId:d.id,record:e,value:w,windowId:a,keys:{Enter:"onEditorKeyEnter",Escape:"onEditorKeyEscape",Tab:"onEditorKeyTab",scope:o},...c.editor}),o.mountedEditor=u,r.cn=[u.createVdomReference()],delete r.innerHTML,d.updateDepth=-1,await d.promiseUpdate(),await o.timeout(30),u.focus())}async onCellDoubleClick({data:e,dataField:t,record:o,view:n}){await this.mountEditor(o,t)}async onEditorKeyEnter(e,t){let o=this;await o.submitEditor(),await o.timeout(20),o.selectCell(e)}async onEditorKeyEscape(e,t){let o=this;await o.unmountEditor(),await o.timeout(20),o.selectCell(e)}async onEditorKeyTab(e,t){let o=this,{store:n}=o.owner,i=n.indexOf(t.record),l=n.getCount(),a=(i+(e.altKey?-1:1)+l)%l,d=n.getAt(a);await o.submitEditor(),await o.mountEditor(d,t.dataField)}async onFocusLeave(e){await this.unmountEditor()}onSelectionChange(e){}onSelectionModelChange(e){let t=e.value;t.ntype.includes("cell")&&t.on("selectionChange",this.onSelectionChange,this)}async onTableKeyDown(e){let t,o,n=this,{target:i}=e,l=n.owner.view;!n.mountedEditor&&i.cls?.includes("neo-selected")&&(t=l.getCellDataField(i.id),o=l.getRecord(i.id),await n.mountEditor(o,t))}selectCell({path:e}){let t,o=this,{selectionModel:n}=o.owner,i=0,l=e.length;for(;i<l;i++)if(e[i].cls?.includes(o.cellCls)){t=e[i].id;break}t&&(n?.deselect(t,!0),n?.select(t),o.owner.focus(t))}async submitEditor(){let e=this,t=e.mountedEditor;t?.isValid()&&(t.isDirty?(e.mountedEditor=null,t.record[t.dataField]=t.getSubmitValue()):await e.unmountEditor())}async unmountEditor(){if(!this.mountedEditor)return;let e=this,t=e.mountedEditor.record,o=e.owner.view,n=o.store.indexOf(t);e.mountedEditor=null,o.vdom.cn[n]=o.createRow({record:t,rowIndex:n}),await o.promiseUpdate()}}const d=Neo.setupClass(a)}}]);