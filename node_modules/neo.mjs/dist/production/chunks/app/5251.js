"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[5251],{4367:(e,t,o)=>{o.d(t,{A:()=>d});var n=o(110);class i extends n.A{static config={className:"Neo.plugin.Base",ntype:"plugin",owner:null,windowId_:null};construct(e){super.construct(e);let t=this,{owner:o}=t;o.isConstructed?t.onOwnerConstructed():o.on("constructed",()=>{t.onOwnerConstructed()},t,{once:!0}),o.mounted?t.onOwnerMounted():o.on("mounted",t.onOwnerMounted,t)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}onOwnerConstructed(){let{owner:e}=this;e.windowId&&(this.windowId=e.windowId)}onOwnerMounted(){}}const d=Neo.setupClass(i)},5251:(e,t,o)=>{o.r(t),o.d(t,{default:()=>s});var n=o(4367),i=o(3599),d=o(825);class l extends n.A{static config={className:"Neo.table.plugin.CellEditing",ntype:"plugin-table-cell-editing",cellCls:"neo-table-cell",disabled_:!1,editorCls:["neo-table-editor"],focusCells:!0};editors={};mountedEditor=null;construct(e){super.construct(e);let t=this,{owner:o}=t,{selectionModel:n}=o;o.on({cellDoubleClick:t.onCellDoubleClick,focusLeave:t.onFocusLeave,selectionModelChange:t.onSelectionModelChange,scope:t}),"NeoInstance"===Neo.typeOf(n)&&t.onSelectionModelChange({value:n}),o.body.keys.add({Enter:"onTableKeyDown",Space:"onTableKeyDown",scope:t})}afterSetDisabled(e,t){t&&this.unmountEditor()}destroy(...e){Object.values(this.editors).forEach(e=>{e.destroy(!1,!0)}),super.destroy(...e)}async mountEditor(e,t){if(this.disabled)return;let o,n=this,{appName:l,windowId:s}=n,{body:a}=n.owner,r=a.getCellId(e,t),c=d.A.find(a.vdom,r).vdom,u=n.owner.headerToolbar.getColumn(t),w=n.editors[t],m=e[t];n.mountedEditor&&(await n.unmountEditor(),await n.timeout(10)),u.editable&&(w?(w.originalConfig.value=m,w.setSilent({record:e,value:m})):(n.editors[t]=w=Neo.create({module:i.A,appName:l,cls:n.editorCls,dataField:t,hideLabel:!0,parentId:a.id,record:e,value:m,windowId:s,...u.editor}),o={Enter:"onEditorKeyEnter",Escape:"onEditorKeyEscape",Tab:"onEditorKeyTab",scope:n},w.keys?w.keys.add(o):w.keys=o),n.mountedEditor=w,c.cn=[w.createVdomReference()],delete c.html,a.updateDepth=-1,await a.promiseUpdate(),await n.timeout(30),w.focus())}async onCellDoubleClick({body:e,data:t,dataField:o,record:n}){await this.mountEditor(n,o)}async onEditorKeyEnter(e,t){let o=this;await o.submitEditor(),await o.timeout(20),o.selectCell(e)}async onEditorKeyEscape(e,t){let o=this;await o.unmountEditor(),await o.timeout(20),o.selectCell(e)}async onEditorKeyTab(e,t){let o=this,{store:n}=o.owner,i=n.indexOf(t.record),d=n.getCount(),l=(i+(e.altKey?-1:1)+d)%d,s=n.getAt(l);await o.submitEditor(),await o.mountEditor(s,t.dataField)}async onFocusLeave(e){await this.unmountEditor()}onSelectionChange(e){}onSelectionModelChange(e){let t=e.value;t.ntype.includes("cell")&&t.on("selectionChange",this.onSelectionChange,this)}async onTableKeyDown(e){let t,o,n=this,{target:i}=e,{body:d}=n.owner;!n.mountedEditor&&i.cls?.includes("neo-selected")&&(t=d.getCellDataField(i.id),o=d.getRecord(i.id),await n.mountEditor(o,t))}selectCell({path:e}){let t,o=this,{selectionModel:n}=o.owner,i=0,d=e.length;for(;i<d;i++)if(e[i].cls?.includes(o.cellCls)){t=e[i].id;break}t&&(n?.deselect(t,!0),n?.select(t),o.focusCells&&o.owner.focus(t))}async submitEditor(){let e=this,t=e.mountedEditor;t?.isValid()&&(t.isDirty?(e.mountedEditor=null,t.record[t.dataField]=t.getSubmitValue()):await e.unmountEditor())}async unmountEditor(){if(!this.mountedEditor)return;let e=this,t=e.mountedEditor.record,{body:o}=e.owner,n=o.store.indexOf(t);e.mountedEditor=null,o.getVdomRoot().cn[n]=o.createRow({record:t,rowIndex:n}),await o.promiseUpdate()}}const s=Neo.setupClass(l)}}]);