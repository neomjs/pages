"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[1374],{8202:(e,t,r)=>{r.d(t,{A:()=>i});var o=r(2583),s=r(5902);class a extends o.A{static config={className:"Neo.data.Model",ntype:"model",fields_:null,keyProperty_:"id",storeId:null,trackModifiedFields:!1};fieldsMap=new Map;hasNestedFields=!1;construct(e){super.construct(e),s.A.createRecordClass(this)}afterSetFields(e,t){if(e){let t=this;t.updateFieldsMap(e),t.isConstructed&&s.A.createRecordClass(t,!0)}}getField(e){return this.fieldsMap.get(e)||null}updateFieldsMap(e,t=!0,r=""){let o,s=this,{fieldsMap:a}=s;t&&(a.clear(),s.hasNestedFields=!1),e.forEach((e=>{o=r+e.name,e.fields?(s.hasNestedFields=!0,s.updateFieldsMap(e.fields,!1,e.name+".")):a.set(o,e)}))}}const i=Neo.setupClass(a)},5902:(e,t,r)=>{r.d(t,{A:()=>n});var o=r(2583),s=r(599),a=r(8202);const i=Symbol.for("data");let l;class d extends o.A{static config={className:"Neo.data.RecordFactory",ovPrefix:"ov_",recordNamespace:"Neo.data.record",singleton:!0};createField({field:e,me:t,model:r,path:o=""}){let s,a=e.name,d=""===o?a:`${o}.${a}`;e.fields?e.fields.forEach((e=>{this.createField({field:e,me:t,model:r,path:d})})):(s={[d]:{configurable:!0,enumerable:!0,get(){return r.hasNestedFields?Neo.ns(d,!1,this[i]):this[i][a]},set(t){let o=this,s=o[i][a];t=l.parseRecordValue(o,e,t),Neo.isEqual(t,s)||(l.setRecordData(d,r,o,t),o._isModified=!0,o._isModified=l.isModified(o,r.trackModifiedFields),l.onRecordChange({fields:[{name:d,oldValue:s,value:t}],model:r,record:o}))}}},r.trackModifiedFields&&(s[l.ovPrefix+e.name]={value}),Object.defineProperties(t,s))}createRecord(e,t){let r=Neo.ns(`${this.recordNamespace}.${e.className}.${e.id}`);return r||(r=this.createRecordClass(e)),new r(t)}createRecordClass(e,t=!1){if(e instanceof a.A){let r,o,s,a=`${this.recordNamespace}.${e.className}.${e.id}`,d=Neo.ns(a);return!d||t?(o=a.split("."),r=o.pop(),d=Neo.ns(o,!0),s=d[r]=class{static name="Record";[i]={};constructor(e){this.setSilent(e),this._isModified=!1}set(t){l.setRecordFields(e,this,t)}setSilent(t){l.setRecordFields(e,this,t,!0)}toJSON(){return this[i]}},Array.isArray(e.fields)&&e.fields.forEach((t=>{l.createField({field:t,me:s.prototype,model:e})})),Object.defineProperty(s.prototype,"isRecord",{value:!0}),Object.defineProperty(s,"isClass",{value:!0}),d[r]):d}}isModified(e,t){if(t){let t,r=Object.keys(e),o=0,s=r.length;for(;o<s;o++)if(t=r[o],!Neo.isEqual(e[t],e[this.ovPrefix+t]))return!0;return!1}return e._isModified}isModifiedField(e,t){e.hasOwnProperty(t)||s.A.logError("The record does not contain the field",t,e);let r=this.ovPrefix+t;return e.hasOwnProperty(r)?!Neo.isEqual(e[t],e[r]):null}isRecord(e){return e?.isRecord}onRecordChange(e){Neo.get(e.model.storeId)?.onRecordChange(e)}parseRecordValue(e,t,r,o=null){if(!t&&console.log(e,r),t.calculate)return t.calculate(e,t,o);t.convert&&(r=t.convert(r));let s=t.name,{mapping:a,maxLength:i,minLength:l,nullable:d}=t,n=o?.[s]||e[s],c=t.type?.toLowerCase();if(a&&o){let e=a.split("."),t=e.pop();e=Neo.ns(e,!0,o),r=e[t]}return Object.hasOwn(t,"maxLength")&&r?.toString().length>i?(console.warn(`Setting record field: ${s} value: ${r} conflicts with maxLength: ${i}`),n):Object.hasOwn(t,"minLength")&&r?.toString().length<l?(console.warn(`Setting record field: ${s} value: ${r} conflicts with minLength: ${l}`),n):Object.hasOwn(t,"nullable")&&!1===d&&null===r?(console.warn(`Setting record field: ${s} value: ${r} conflicts with nullable: ${d}`),n):"date"===c&&"Date"!==Neo.typeOf(r)?new Date(r):("float"===c&&r?r=parseFloat(r):"html"===c&&r?r+="":"int"!==c&&"integer"!==c||!r?"string"===c&&r&&(r=(r+="").replace(/(<([^>]+)>)/gi,"")):r=parseInt(r),r)}setRecordData(e,t,r,o){if(t.hasNestedFields&&e.includes(".")){let t,s;s=e.split("."),e=s.pop(),t=Neo.ns(s,!0,r[i]),t[e]=o}else r[i][e]=o}setRecordFields(e,t,r,o=!1,s=[]){let a,i,{fieldsMap:d}=e;Object.entries(r).forEach((([r,o])=>{a=d.has(r),Neo.isObject(o)&&!a?Object.entries(o).forEach((([o,a])=>{this.setRecordFields(e,t,{[`${r}.${o}`]:a},!0,s)})):a&&(i=t[r],o=l.parseRecordValue(t,e.getField(r),o),Neo.isEqual(i,o)||(l.setRecordData(r,e,t,o),t._isModified=!0,s.push({name:r,oldValue:i,value:o})))})),!o&&Object.keys(s).length>0&&Neo.get(e.storeId)?.onRecordChange({fields:s,model:e,record:t})}}l=Neo.setupClass(d);const n=l},1374:(e,t,r)=>{r.d(t,{A:()=>d});var o=r(1058),s=r(2778),a=r(8202),i=(r(5691),r(5902));class l extends o.A{static observable=!0;static config={className:"Neo.data.Store",ntype:"store",api_:null,autoLoad:!1,currentPage_:1,data_:null,initialData_:null,isGrouped:!1,isLoaded:!1,isLoading:!1,model_:null,pageSize_:0,remoteFilter:!1,remoteSort:!1,responseRoot:"data",totalCount:0,url:null};construct(e){super.construct(e);let t=this;t.on({mutate:t.onCollectionMutate,sort:t.onCollectionSort,scope:t})}add(e){return super.add(this.beforeSetData(e))}afterSetCurrentPage(e,t){t&&this.load()}afterSetData(e,t){let r=this;r.configsApplied&&e&&(t?r.clear():r.initialData=[...e],r.add(e))}afterSetFilters(e,t){super.afterSetFilters(e,t);let r=this;r._currentPage=1,t&&r.remoteFilter&&r.load()}afterSetInitialData(e,t){}afterSetModel(e,t){e&&(e.storeId=this.id)}afterSetPageSize(e,t){t&&(this._currentPage=1,this.load())}afterSetSorters(e,t){super.afterSetSorters(e,t);let r=this;r._currentPage=1,t&&r.remoteSort&&r.load()}beforeSetApi(e,t){return"String"===Neo.typeOf(e)&&(e={create:e+".create",destroy:e+".destroy",read:e+".read",update:e+".update"}),e}beforeSetData(e,t){if(e){Array.isArray(e)||(e=[e]);let t,r=this,o=0,s=e.length;for(;o<s;o++)t=e[o],i.A.isRecord(t)||(e[o]=i.A.createRecord(r.model,t))}return e}beforeSetInitialData(e,t){return!e&&t?t:e}beforeSetModel(e,t){return t?.destroy(),s.A.beforeSetInstance(e,a.A)}createRecord(e){i.A.createRecord(e)}getKeyProperty(){return this.keyProperty||this.model.keyProperty}load(e={}){let t=this,r={page:t.currentPage,pageSize:t.pageSize,...e.params};if(t.remoteFilter&&(r.filters=t.exportFilters()),t.remoteSort&&(r.sorters=t.exportSorters()),t.api){let e=t.api.read.split("."),o=e.pop(),s=Neo.ns(e.join("."));s?s[o](r).then((e=>{(e=Neo.ns(t.responseRoot,!1,e)).success&&(t.totalCount=e.totalCount,t.data=Neo.ns(t.responseRoot,!1,e))})):console.log("Api is not defined",this)}else e.url??=t.url,Neo.Xhr.promiseJson(e).catch((e=>{console.log("Error for Neo.Xhr.request",e,t.id)})).then((e=>{t.data=Neo.ns(t.responseRoot,!1,e.json)||e.json}))}onCollectionMutate(e){let t=this;t.configsApplied&&t.fire("load",t.items)}onCollectionSort(){this.configsApplied}onConstructed(){super.onConstructed();let e=this;e.data&&e.afterSetData(e.data),e.autoLoad&&e.timeout(100).then((()=>{e.load()}))}onFilterChange(e){let t=this;t.remoteFilter?(t._currentPage=1,t.load()):super.onFilterChange(e)}onRecordChange(e){this.fire("recordChange",{...e,index:this.indexOf(e.record)})}sort(e={}){let t=this;t._currentPage=1,t.configsApplied&&(e.direction?t.sorters=[{direction:e.direction,property:e.property}]:(t.remoteSort||(t.startUpdate(),t.clear()),t.sorters=[],t.remoteSort||(t.add([...t.initialData]),t.endUpdate(),t.fire("sort"))))}}const d=Neo.setupClass(l)}}]);