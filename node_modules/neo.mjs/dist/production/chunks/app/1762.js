"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[1762],{1762(e,t,s){s.r(t),s.d(t,{onStart:()=>P});var a=s(5367),n=s(8659),o=s(295);class i extends o.A{static config={className:"Legit.view.CommitGrid",baseCls:["legit-commit-grid","neo-grid-container"],bind:{store:"stores.commitStore"},columnDefaults:{renderer:"onCommitColumnRenderer"},columns:[{dataField:"timestamp",text:"Timestamp",width:150},{dataField:"author",text:"Author",width:150},{dataField:"message",text:"Message",flex:1},{dataField:"oid",text:"OID",width:300}]}}const l=Neo.setupClass(i);var r=s(1184),c=s(9361),d=s(6929),p=s(3176),u=s(1956),m=s(8310),h=s(3997),g=s(3572);class f extends g.A{static config={className:"Legit.service.Legit",fs:null,legitFs:null,path:"/.legit/branches/anonymous",singleton:!0};async initAsync(){await super.initAsync();const e=this;try{const{openLegitFs:t}=await import("https://esm.sh/@legit-sdk/core"),s=await import("https://esm.sh/memfs");e.fs=s.default,e.legitFs=await t({storageFs:e.fs,gitRoot:"/",serverUrl:"http://localhost:9999/"}),globalThis.legitFs=e.legitFs,await e.#e()}catch(e){console.error("Failed to initialize Legit Service",e)}}async loadHistory(e="anonymous"){await this.ready();try{const t=await this.legitFs.readFile(`/.legit/branches/${e}/.legit/history`,"utf-8");return JSON.parse(t)}catch(t){return console.warn(`Failed to load history for branch ${e}`,t),[]}}async loadTree(e){await this.ready();const t=this,s={},a=await t.readdir(e);for(const n of a)if((await t.stat(e+n)).isDirectory())s[n]=await t.loadTree(e+n+"/");else{const a=await crypto.subtle.digest("SHA-1",await t.readFile(e+n));s[n]={hash:a,name:n}}return{hash:"",subEntries:s}}async loadTreeDelta(e,t){await this.ready();const s=this,a=t.slice(0,2),n=t.slice(2);let o={};if(e){const t=e.slice(0,2),a=e.slice(2);o=await s.loadTree("/.legit/commits/"+t+"/"+a+"/")}const i=await s.loadTree("/.legit/commits/"+a+"/"+n+"/"),l=[],r=[],c=[];function d(e,t=""){const s={};if(e.subEntries)for(const[a,n]of Object.entries(e.subEntries)){const e=t?`${t}/${a}`:a;n.subEntries?Object.assign(s,d(n,e)):s[e]=n.hash}return s}const p=""!==e?d(o):{},u=d(i);for(const e in p)e in u||l.push(e);for(const e in u)e in p||r.push(e);for(const e in u)if(e in p){const t=new Uint8Array(p[e]),s=new Uint8Array(u[e]);t.length===s.length&&t.every((e,t)=>e===s[t])||c.push(e)}return{deleted:l,added:r,modified:c}}async readFile(e,t){return await this.ready(),this.legitFs.readFile(e,t)}async readdir(e){return await this.ready(),this.legitFs.readdir(e)}async#e(){const e=this;let t=await fetch("../../learn/benefits/FormsEngine.md");t=await t.text(),await e.writeFile({data:t,path:`${e.path}/FormsEngine.md`,skipReady:!0}),t=await fetch("../../learn/benefits/OffTheMainThread.md"),t=await t.text(),await e.writeFile({data:t,path:`${e.path}/OffTheMainThread.md`,skipReady:!0}),await e.writeFile({data:["import Viewport from '../../examples/component/multiWindowHelix/Viewport.mjs';","","class MainView extends Viewport {","    static config = {","        className           : 'Portal.view.MultiWindowHelix',","        showGitHubStarButton: false,","        theme               : 'neo-theme-dark'","    }","}","","MainView = Neo.setupClass(MainView);"].join("\n"),path:`${e.path}/Helix.mjs`,skipReady:!0}),await e.writeFile({data:["import Viewport from '../../examples/component/multiWindowCoronaGallery/Viewport.mjs';","","class MainView extends Viewport {","    static config = {","        className           : 'Portal.view.MultiWindowHelix',","        showGitHubStarButton: false,","        theme               : 'neo-theme-dark'","    }","}","","MainView = Neo.setupClass(MainView);"].join("\n"),path:`${e.path}/Gallery.mjs`,skipReady:!0})}async stat(e){return await this.ready(),this.legitFs.stat(e)}async writeFile({data:e,options:t,path:s,skipReady:a=!1}){return!a&&await this.ready(),this.legitFs.writeFile(s,e,t)}}const y=Neo.setupClass(f);class w extends h.A{static config={className:"Legit.view.ViewportController",pollingInterval:1e3};addDialog=null;currentTreeState=null;running=!1;async initAsync(){await super.initAsync();const e=this;await y.ready(),e.getReference("new-file-button").disabled=!1,e.getReference("save-button").disabled=!1,setInterval(e.poll.bind(e),e.pollingInterval)}async onAddFileDialogSave(e){const t=this.addDialog,s=t.getReference("filename"),a=`${y.path}/${s.value}`;t.hide(),console.log("onAddFileDialogSave",s.value),await y.writeFile({data:"",path:a}),this.setState({currentFile:a})}onCommitColumnRenderer(e){return"author"===e.dataField?e.value.name:"timestamp"===e.dataField?new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric",second:"numeric"}).format(new Date(1e3*e.value)):e.value}onFileItemClick(e){console.log("onFileItemClick",e)}async onEditorChange(e){}async onNewFileButtonClick(e){let t=this,{addDialog:a}=t,n=e.component,{appName:o,theme:i,windowId:l}=n;n.disabled=!0,a?a.show():Promise.all([s.e(3484),s.e(7600)]).then(s.bind(s,7600)).then(e=>{t.addDialog=Neo.create({module:e.default,animateTargetId:n.id,appName:o,listeners:{hide:e=>{n.disabled=!1}},parentComponent:t.component,theme:i,windowId:l})})}async onSaveButtonClick(e){const t=this,s=t.getReference("code-live-preview"),a=t.getState("currentFile");console.log("onSaveButtonClick",t.getState("currentFile"),s.value),await y.writeFile({data:s.value,path:`${y.path}/${a}`})}async onTreeListSelect({records:e}){const t=this.getReference("code-live-preview"),s=e?.[0],a=s.id.includes(".md")?"markdown":"neomjs";if(s?.isLeaf){this.setState({currentFile:s.id});const e=await y.readFile(`${y.path}/${s.id}`,"utf-8");await t.set({language:a,value:e})}}async poll(){let e=this;if(!e.running)try{e.running=!0;let t=await y.readFile(y.path+"/.legit/head","utf-8");if(e.currentTreeState===t)return;const s=e.getStore("commitStore"),a=e.getStore("fileStore"),n=await y.loadTreeDelta(e.currentTreeState,t);s.data=await y.loadHistory(),console.log("TREE DELTA:",n);for(const e of n.deleted)console.log("Deleted FROM TREE: "+e),a.remove(e);for(const e of n.added)console.log("Added From Tree:"+e),a.insert(0,{id:e,name:e,parentId:null});for(const e of n.modified)console.log("MODIFIED From Tree:"+e);e.currentTreeState=t}finally{e.running=!1;let t=e.getReference("files-tree").selectionModel;t.hasSelection()||t.selectAt(0)}}}const C=Neo.setupClass(w);var b=s(1967);class v extends b.A{static config={className:"Legit.model.Commit",fields:[{name:"oid",type:"String"},{name:"message",type:"String"},{name:"author",type:"Object"},{name:"timestamp",type:"Integer"}]}}const x=Neo.setupClass(v);var S=s(2779);class A extends S.A{static config={className:"Legit.store.Commits",model:x,sorters:[{property:"timestamp",direction:"DESC"}]}}const I=Neo.setupClass(A);class N extends b.A{static config={className:"Legit.model.File",fields:[{name:"className",type:"String"},{name:"collapsed",type:"Boolean"},{name:"hidden",type:"Boolean"},{name:"id",type:"String"},{name:"isLeaf",type:"Boolean",defaultValue:!0},{name:"name",type:"String"},{name:"parentId",type:"String"}]}}const F=Neo.setupClass(N);class k extends S.A{static config={className:"Legit.store.Files",model:F}}const L=Neo.setupClass(k);var D=s(9943);class E extends D.A{static config={className:"Legit.view.ViewportStateProvider",data:{currentFile:null},stores:{commitStore:I,fileStore:L}}}const R=Neo.setupClass(E);class T extends a.A{static config={className:"Legit.view.Viewport",cls:["legit-viewport"],controller:C,stateProvider:R,layout:{ntype:"hbox",align:"stretch"},items:[{module:p.A,bind:{store:"stores.fileStore"},cls:["legit-files-tree"],listeners:{leafItemClick:"onFileItemClick",select:"onTreeListSelect"},reference:"files-tree",showCollapseExpandAllIcons:!1,width:300},{module:u.A,resizeTarget:"previous",size:5},{module:r.A,flex:1,layout:{ntype:"vbox",align:"stretch"},items:[{module:m.A,flex:"none",style:{marginRight:"15px"},items:["->",{module:n.A,disabled:!0,handler:"onNewFileButtonClick",iconCls:"fa fa-plus",reference:"new-file-button",text:"New File"},{module:n.A,disabled:!0,handler:"onSaveButtonClick",iconCls:"fa fa-cloud-upload",reference:"save-button",style:{marginLeft:".5em"},text:"Save"}]},{module:c.default,flex:3,language:"markdown",listeners:{editorChange:"onEditorChange"},reference:"code-live-preview",style:{margin:"20px"}},{module:u.A,direction:"horizontal",resizeTarget:"previous",size:5},{module:d.A,cls:["legit-commit-grid-panel"],flex:1,style:{margin:"20px"},headers:[{dock:"top",text:"Legit History"}],items:[{module:l,wrapperStyle:{minHeight:"200px"}}]}]}]}}const H=Neo.setupClass(T),P=()=>Neo.app({mainView:H,name:"Legit"})},3176(e,t,s){s.d(t,{A:()=>d});var a=s(3123),n=s(5023),o=s(6969),i=s(1031),l=s(3675),r=s(950);class c extends a.A{static config={className:"Neo.tree.List",ntype:"treelist",baseCls:["neo-tree-list"],disableSelection:!1,dragResortable_:!1,dragZone:null,folderCls:"neo-list-folder",showCollapseExpandAllIcons:!0,sortZone:null,sortZoneConfig:null,wrapperCls:[],_vdom:{cn:[{tag:"ul",cls:["neo-list-container","neo-list"],tabIndex:-1,cn:[]}]}};afterSetDraggable(e,t){let a=this;e&&(a.dragResortable?console.error("tree.List can be either draggable or dragResortable, not both.",a.id):a.dragZone||Promise.all([s.e(9244),s.e(4520)]).then(s.bind(s,4520)).then(e=>{a.dragZone=Neo.create({module:e.default,appName:a.appName,owner:a,windowId:a.windowId,...a.dragZoneConfig})}))}afterSetDragResortable(e,t){let a=this;e&&(a.draggable?console.error("tree.List can be either draggable or dragResortable, not both.",a.id):a.sortZone||Promise.all([s.e(9244),s.e(9458)]).then(s.bind(s,9458)).then(e=>{a.sortZone=Neo.create({module:e.default,appName:a.appName,boundaryContainerId:a.id,owner:a,windowId:a.windowId,...a.sortZoneConfig})}))}beforeSetSelectionModel(e,t){return t?.destroy(),n.A.beforeSetInstance(e,l.A)}beforeSetStore(e,t){return e||(e=Neo.create(o.A,{keyProperty:"id"})),super.beforeSetStore(e,t)}collapseAll(e=!1){let t,s=this,a=!1;s.store.forEach(e=>{e.isLeaf||(t=s.getVdomChild(s.getItemId(e.id),s.vdom),t.cls.includes("neo-folder-open")&&(i.A.remove(t.cls,"neo-folder-open"),a=!0))}),a&&!e&&s.update()}createItem(e){let t,s=this,{folderCls:a,itemCls:n}=s,o=[n],i=[n+"-content"],l=s.getKeyProperty();return e.iconCls&&(Array.isArray(e.iconCls)?i.push(...e.iconCls):i.push(e.iconCls)),e.isLeaf?o.push(n+(e.singleton?"-leaf-singleton":"-leaf")):(o.push(a),e.collapsed||o.push("neo-folder-open")),t={tag:"li",cls:o,id:s.getItemId(e[l]),cn:[{tag:"span",cls:i,html:e[s.displayField],style:{pointerEvents:"none"}}],style:{display:e.hidden?"none":"flex",padding:"10px",position:e.isLeaf?null:"sticky",top:e.isLeaf?null:38*e.level+"px",zIndex:e.isLeaf?null:20/(e.level+1)}},s.itemsFocusable&&(t.tabIndex=-1),t}createItemLevel(e,t,s,a=!1){let n,o=this,i=o.store.find("parentId",e);return i.length>0&&(t.cn||(t.cn=[]),null!==e?(t.cn.push({tag:"ul",cls:["neo-list"],cn:[],style:{display:a?"none":null,paddingLeft:"15px"}}),n=t.cn[t.cn.length-1]):n=t,i.forEach(e=>{e.level=s,n.cn.push(o.createItem(e)),o.createItemLevel(e.id,n,s+1,e.hidden||a)})),t}createItems(){let e=this,t=e.getListItemsRoot();t.cn=[],e.createItemLevel(null,t,0),e.update()}expandAll(e=!1){let t,s=this,a=!1;s.store.forEach(e=>{e.isLeaf||(t=s.getVdomChild(s.getItemId(e.id),s.vdom),t.cls.includes("neo-folder-open")||(i.A.add(t.cls,"neo-folder-open"),a=!0))}),a&&!e&&s.update()}filter(e,t,s,a=!1){let n,o,i,l=this,r=!0,c=new RegExp(t,"gi");return t||(t=""),l.store.forEach(d=>{d.parentId===s&&(o=!1,i=l.getVdomChild(l.getItemId(d.id),l.vdom),i.cn[0].html=d[e].replace(c,e=>(o=!0,`<span class="neo-highlight-search">${e}</span>`)),n=!!d.isLeaf||l.filter(e,t,d.id,o||a),(o||a||!1===n||""===t)&&(r=!1),i.style.display=r?"none":"list-item")}),null===s&&(l.expandAll(!0),l.update()),r}getListItemsRoot(){return this.vdom.cn[this.showCollapseExpandAllIcons?2:0]}onClick(e){e.target.cls.includes("neo-treelist-menu-item")?this.onMenuItemClick(e.target.cls):super.onClick(e)}onConstructed(){super.onConstructed();let e=this;e.showCollapseExpandAllIcons&&(e.vdom.cn.unshift({cls:["neo-treelist-menu-item","neo-treelist-collapse-all-icon"],cn:[{tag:"span",cls:["neo-treelist-menu-item-content"]}]},{cls:["neo-treelist-menu-item","neo-treelist-expand-all-icon"],cn:[{tag:"span",cls:["neo-treelist-menu-item-content"]}]}),e.update())}onItemClick(e,t){let s,a,n,o,l=this,{items:r}=l.store,c=0,d=r.length,p=l.getKeyProperty(),u=t.path.map(e=>e.id);for(;c<d;c++)if(n=r[c],o=l.getItemId(n[p]),u.includes(o)){a=n,s=l.getVdomChild(o);break}s&&(s.cls?.includes(l.folderCls)?(i.A.toggle(s.cls,"neo-folder-open"),l.update()):(l.onLeafItemClick(a),l.fire("leafItemClick",a)),super.onItemClick(e,t))}onLeafItemClick(e){}onMenuItemClick(e){e.includes("neo-treelist-collapse-all-icon")?this.collapseAll():this.expandAll()}onStoreRecordChange(e){let t=this,{record:s}=e,{index:a,parentNode:n}=r.A.find(t.vdom,t.getItemId(s.id));n.cn[a]=t.createItem(s),t.update()}}const d=Neo.setupClass(c)},3675(e,t,s){s.d(t,{A:()=>o});var a=s(8051);class n extends a.A{static config={className:"Neo.selection.TreeModel",ntype:"selection-treemodel"};onKeyDownEnter(e){}onNavKey(e,t){}}const o=Neo.setupClass(n)},3997(e,t,s){s.d(t,{A:()=>i});var a=s(2915),n=s(9932);class o extends a.A{static config={className:"Neo.controller.Component",ntype:"component-controller",component:null,parent_:null,references:null,windowId:null};construct(e){super.construct(e);let t=this,{component:s}=t;t.references={},s.isConstructed?t.onComponentConstructed():s.on("constructed",()=>{t.onComponentConstructed()},t,{once:!0})}beforeSetParent(e,t){return e||this.getParent()}getHandlerScope(e,t){let s,a=this,{parent:o}=a;return!(!t||(s=(0,n.Ap)(e,t),!s.fn))||(Neo.isFunction(a[e])?a:o?.getHandlerScope(e)||null)}getParent(){let{parent:e}=this;return e||this.component.parent?.getController()||null}getReference(e){let t=this,s=t.references[e];return s||(s=t.component.down({reference:e}),s&&(t.references[e]=s)),s||null}getState(...e){return this.getStateProvider().getData(...e)}getStateProvider(e=!1){let{component:t}=this;return e?t.stateProvider:t.getStateProvider()}getStore(e){return this.getStateProvider().getStore(e)}onComponentConstructed(){}removeReference(e){let t,{references:s}=this;for(t in s)if(e===s[t]){delete s[t];break}this.getParent()?.removeReference(e)}setState(...e){this.getStateProvider().setData(...e)}}const i=Neo.setupClass(o)},5367(e,t,s){s.d(t,{A:()=>o});var a=s(1184);class n extends a.A{static config={className:"Neo.container.Viewport",ntype:"viewport",applyBodyCls:!0,autoMount:!0,baseCls:["neo-viewport"],monitorSize_:!1};afterSetMounted(e,t){super.afterSetMounted(e,t);let s=this;e&&s.monitorSize&&s.addDomListeners([{resize:s.onDomResize,scope:s}])}onConstructed(){super.onConstructed();let{windowId:e}=this;this.applyBodyCls&&Neo.main.DomAccess.applyBodyCls({cls:["neo-body-viewport"],windowId:e})}onDomResize(e){this.fire("resize",e)}}const o=Neo.setupClass(n)},6929(e,t,s){s.d(t,{A:()=>o});var a=s(1184);s(8310);class n extends a.A{static config={className:"Neo.container.Panel",ntype:"panel",baseCls:["neo-panel","neo-container"],containerConfig:null,headerDefaults:null,headers:null,_layout:{ntype:"vbox",align:"stretch"},verticalHeadersFirst:!1};construct(e){super.construct(e);let t=this;t.hasHeaders()&&!0===t.verticalHeadersFirst&&(t.layout={ntype:"hbox",align:"stretch"})}static createHeaderConfig(e){if("NeoInstance"===Neo.typeOf(e))return e;let t={flex:"0 1 auto"};return e.module||e.ntype||(t.cls=["neo-panel-header-toolbar","neo-toolbar"],t.ntype="toolbar"),e.text&&(t.items=[{ntype:"label",cls:["neo-panel-header-text","neo-label"],text:e.text}],delete e.text),Array.isArray(e.items)&&e.items.forEach(e=>{"label"===e.ntype&&(e.cls=["neo-panel-header-text","neo-label"])}),{...t,...e}}createItems(){let e=this,t=e.containerConfig;if(e.hasHeaders()){let s,a=!1===e.verticalHeadersFirst,o=e.headers||[],i=o.filter(e=>e.dock===(a?"bottom":"right")),l=o.filter(e=>e.dock===(a?"left":"top")),r=o.filter(e=>e.dock===(a?"right":"bottom")),c=o.filter(e=>e.dock===(a?"top":"left")),d=i.length>0||c.length>0,p=l.length>0||r.length>0,{items:u}=e,m=[],h=[];c.forEach(e=>{h.push(n.createHeaderConfig(e))}),p&&(a&&d||!a&&d)?(l.forEach(e=>{m.push(n.createHeaderConfig(e))}),s={ntype:"container",flex:1,items:u,itemDefaults:e.itemDefaults,...t},m.push({...e.headerDefaults,...s}),r.forEach(e=>{m.push(n.createHeaderConfig(e))}),h.push({ntype:"container",items:m,layout:{ntype:a?"hbox":"vbox",align:"stretch"},reference:"bodyContainer"})):(s={ntype:"container",flex:1,items:u,itemDefaults:e.itemDefaults,reference:"bodyContainer",...t},h.push({...e.headerDefaults,...s})),i.forEach(e=>{h.push(n.createHeaderConfig(e))}),e.items=h,e.itemDefaults=null,super.createItems()}else t&&e.set(t),super.createItems()}hasHeaders(){return Array.isArray(this.headers)&&this.headers.length>0}}const o=Neo.setupClass(n)},8310(e,t,s){s.d(t,{A:()=>l}),s(8659);var a=s(1741),n=s(1184),o=(s(9217),s(1031));class i extends n.A{static dockPositions=["top","right","bottom","left",null];static config={className:"Neo.toolbar.Base",ntype:"toolbar",baseCls:["neo-toolbar"],dock_:null,itemDefaults:{ntype:"button"},layout:{ntype:"flexbox",align:"center",direction:"row",pack:"start"}};afterSetDock(e,t){if(!e&&!t)return;let s=this,{cls:a}=s,n=s.getStaticConfig("dockPositions"),i=s.getLayoutConfig();n.forEach(t=>{null!==t&&o.A.toggle(a,"neo-dock-"+t,t===e)}),s.layout?(s.layout.set(i),s.cls=a):(i.ntype="flexbox",s.set({cls:a,layout:i}))}beforeSetDock(e,t){return this.beforeSetEnumValue(e,t,"dock","dockPositions")}createItems(){let e=this._items;return Array.isArray(e)&&(this._items=e.map(e=>this.replaceSpacer(e))),super.createItems()}getLayoutConfig(){let e,t=this;if(t.dock)switch(t.dock){case"bottom":case"top":e={align:"center",direction:"row",pack:"start"};break;case"left":e={align:"center",direction:"column-reverse",pack:"start"};break;case"right":e={align:"center",direction:"column",pack:"start"}}return e||t.layout}insert(e,t,s=!1){return t=Array.isArray(t)?t.map(e=>this.replaceSpacer(e)):this.replaceSpacer(t),super.insert(e,t,s)}replaceSpacer(e){return"->"===e?{module:a.A,flex:1}:e}toJSON(){return{...super.toJSON(),dock:this.dock}}}const l=Neo.setupClass(i)},9217(e,t,s){s.d(t,{A:()=>o});var a=s(1741);class n extends a.A{static config={className:"Neo.component.Label",ntype:"label",baseCls:["neo-label"],tag:"label"}}const o=Neo.setupClass(n)}}]);