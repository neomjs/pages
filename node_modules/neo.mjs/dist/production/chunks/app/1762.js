"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[1762],{1762(e,t,a){a.r(t),a.d(t,{onStart:()=>P});var s=a(5367),i=a(8659),n=a(295);class o extends n.A{static config={className:"Legit.view.CommitGrid",baseCls:["legit-commit-grid","neo-grid-container"],bind:{store:"stores.commitStore"},columnDefaults:{renderer:"onCommitColumnRenderer"},columns:[{dataField:"timestamp",text:"Timestamp",width:150},{dataField:"author",text:"Author",width:150},{dataField:"message",text:"Message",flex:1},{dataField:"oid",text:"OID",width:300}]}}const r=Neo.setupClass(o);var l=a(1184),c=a(9361),d=a(6929),u=a(3176),m=a(1956),p=a(8310),h=a(3997),f=a(3572);class g extends f.A{static config={className:"Legit.service.Legit",fs:null,legitFs:null,path:"/.legit/branches/anonymous",singleton:!0};async initAsync(){await super.initAsync();const e=this;try{const{openLegitFs:t}=await import("https://esm.sh/@legit-sdk/core"),a=await import("https://esm.sh/memfs");e.fs=a.default,e.legitFs=await t({storageFs:e.fs,gitRoot:"/",serverUrl:"http://localhost:9999/"}),globalThis.legitFs=e.legitFs,await e.#e()}catch(e){console.error("Failed to initialize Legit Service",e)}}async loadHistory(e="anonymous"){await this.ready();try{const t=await this.legitFs.readFile(`/.legit/branches/${e}/.legit/history`,"utf-8");return JSON.parse(t)}catch(t){return console.warn(`Failed to load history for branch ${e}`,t),[]}}async loadTree(e){await this.ready();const t=this,a={},s=await t.readdir(e);for(const i of s)if((await t.stat(e+i)).isDirectory())a[i]=await t.loadTree(e+i+"/");else{const s=await crypto.subtle.digest("SHA-1",await t.readFile(e+i));a[i]={hash:s,name:i}}return{hash:"",subEntries:a}}async loadTreeDelta(e,t){await this.ready();const a=this,s=t.slice(0,2),i=t.slice(2);let n={};if(e){const t=e.slice(0,2),s=e.slice(2);n=await a.loadTree("/.legit/commits/"+t+"/"+s+"/")}const o=await a.loadTree("/.legit/commits/"+s+"/"+i+"/"),r=[],l=[],c=[];function d(e,t=""){const a={};if(e.subEntries)for(const[s,i]of Object.entries(e.subEntries)){const e=t?`${t}/${s}`:s;i.subEntries?Object.assign(a,d(i,e)):a[e]=i.hash}return a}const u=""!==e?d(n):{},m=d(o);for(const e in u)e in m||r.push(e);for(const e in m)e in u||l.push(e);for(const e in m)if(e in u){const t=new Uint8Array(u[e]),a=new Uint8Array(m[e]);t.length===a.length&&t.every((e,t)=>e===a[t])||c.push(e)}return{deleted:r,added:l,modified:c}}async readFile(e,t){return await this.ready(),this.legitFs.readFile(e,t)}async readdir(e){return await this.ready(),this.legitFs.readdir(e)}async#e(){const e=this;let t=await fetch("../../learn/benefits/FormsEngine.md");t=await t.text(),await e.writeFile({data:t,path:`${e.path}/FormsEngine.md`,skipReady:!0}),t=await fetch("../../learn/benefits/OffTheMainThread.md"),t=await t.text(),await e.writeFile({data:t,path:`${e.path}/OffTheMainThread.md`,skipReady:!0}),await e.writeFile({data:["import Viewport from '../../examples/component/multiWindowHelix/Viewport.mjs';","","class MainView extends Viewport {","    static config = {","        className           : 'Portal.view.MultiWindowHelix',","        showGitHubStarButton: false,","        theme               : 'neo-theme-dark'","    }","}","","MainView = Neo.setupClass(MainView);"].join("\n"),path:`${e.path}/Helix.mjs`,skipReady:!0}),await e.writeFile({data:["import Viewport from '../../examples/component/multiWindowCoronaGallery/Viewport.mjs';","","class MainView extends Viewport {","    static config = {","        className           : 'Portal.view.MultiWindowHelix',","        showGitHubStarButton: false,","        theme               : 'neo-theme-dark'","    }","}","","MainView = Neo.setupClass(MainView);"].join("\n"),path:`${e.path}/Gallery.mjs`,skipReady:!0})}async stat(e){return await this.ready(),this.legitFs.stat(e)}async writeFile({data:e,options:t,path:a,skipReady:s=!1}){return!s&&await this.ready(),this.legitFs.writeFile(a,e,t)}}const y=Neo.setupClass(g);class w extends h.A{static config={className:"Legit.view.ViewportController",pollingInterval:1e3};addDialog=null;currentTreeState=null;running=!1;async initAsync(){await super.initAsync();const e=this;await y.ready(),e.getReference("new-file-button").disabled=!1,e.getReference("save-button").disabled=!1,setInterval(e.poll.bind(e),e.pollingInterval)}async onAddFileDialogSave(e){const t=this.addDialog,a=t.getReference("filename"),s=`${y.path}/${a.value}`;t.hide(),console.log("onAddFileDialogSave",a.value),await y.writeFile({data:"",path:s}),this.setState({currentFile:s})}onCommitColumnRenderer(e){return"author"===e.dataField?e.value.name:"timestamp"===e.dataField?new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric",second:"numeric"}).format(new Date(1e3*e.value)):e.value}onFileItemClick(e){console.log("onFileItemClick",e)}async onEditorChange(e){}async onNewFileButtonClick(e){let t=this,{addDialog:s}=t,i=e.component,{appName:n,theme:o,windowId:r}=i;i.disabled=!0,s?s.show():Promise.all([a.e(3484),a.e(7600)]).then(a.bind(a,7600)).then(e=>{t.addDialog=Neo.create({module:e.default,animateTargetId:i.id,appName:n,listeners:{hide:e=>{i.disabled=!1}},parentComponent:t.component,theme:o,windowId:r})})}async onSaveButtonClick(e){const t=this,a=t.getReference("code-live-preview"),s=t.getState("currentFile");console.log("onSaveButtonClick",t.getState("currentFile"),a.value),await y.writeFile({data:a.value,path:`${y.path}/${s}`})}async onTreeListSelect({records:e}){const t=this.getReference("code-live-preview"),a=e?.[0],s=a.id.includes(".md")?"markdown":"neomjs";if(a?.isLeaf){this.setState({currentFile:a.id});const e=await y.readFile(`${y.path}/${a.id}`,"utf-8");await t.set({language:s,value:e})}}async poll(){let e=this;if(!e.running)try{e.running=!0;let t=await y.readFile(y.path+"/.legit/head","utf-8");if(e.currentTreeState===t)return;const a=e.getStore("commitStore"),s=e.getStore("fileStore"),i=await y.loadTreeDelta(e.currentTreeState,t);a.data=await y.loadHistory(),console.log("TREE DELTA:",i);for(const e of i.deleted)console.log("Deleted FROM TREE: "+e),s.remove(e);for(const e of i.added)console.log("Added From Tree:"+e),s.insert(0,{id:e,name:e,parentId:null});for(const e of i.modified)console.log("MODIFIED From Tree:"+e);e.currentTreeState=t}finally{e.running=!1;let t=e.getReference("files-tree").selectionModel;t.hasSelection()||t.selectAt(0)}}}const C=Neo.setupClass(w);var b=a(1967);class v extends b.A{static config={className:"Legit.model.Commit",fields:[{name:"oid",type:"String"},{name:"message",type:"String"},{name:"author",type:"Object"},{name:"timestamp",type:"Integer"}]}}const S=Neo.setupClass(v);var x=a(2779);class F extends x.A{static config={className:"Legit.store.Commits",model:S,sorters:[{property:"timestamp",direction:"DESC"}]}}const A=Neo.setupClass(F);class N extends b.A{static config={className:"Legit.model.File",fields:[{name:"className",type:"String"},{name:"collapsed",type:"Boolean"},{name:"hidden",type:"Boolean"},{name:"id",type:"String"},{name:"isLeaf",type:"Boolean",defaultValue:!0},{name:"name",type:"String"},{name:"parentId",type:"String"}]}}const k=Neo.setupClass(N);class D extends x.A{static config={className:"Legit.store.Files",model:k}}const I=Neo.setupClass(D);var T=a(9943);class H extends T.A{static config={className:"Legit.view.ViewportStateProvider",data:{currentFile:null},stores:{commitStore:A,fileStore:I}}}const L=Neo.setupClass(H);class E extends s.A{static config={className:"Legit.view.Viewport",cls:["legit-viewport"],controller:C,stateProvider:L,layout:{ntype:"hbox",align:"stretch"},items:[{module:u.A,bind:{store:"stores.fileStore"},cls:["legit-files-tree"],listeners:{leafItemClick:"onFileItemClick",select:"onTreeListSelect"},reference:"files-tree",showCollapseExpandAllIcons:!1,width:300},{module:m.A,resizeTarget:"previous",size:5},{module:l.A,flex:1,layout:{ntype:"vbox",align:"stretch"},items:[{module:p.A,flex:"none",style:{marginRight:"15px"},items:["->",{module:i.A,disabled:!0,handler:"onNewFileButtonClick",iconCls:"fa fa-plus",reference:"new-file-button",text:"New File"},{module:i.A,disabled:!0,handler:"onSaveButtonClick",iconCls:"fa fa-cloud-upload",reference:"save-button",style:{marginLeft:".5em"},text:"Save"}]},{module:c.default,flex:3,language:"markdown",listeners:{editorChange:"onEditorChange"},reference:"code-live-preview",style:{margin:"20px"}},{module:m.A,direction:"horizontal",resizeTarget:"previous",size:5},{module:d.A,cls:["legit-commit-grid-panel"],flex:1,style:{margin:"20px"},headers:[{dock:"top",text:"Legit History"}],items:[{module:r,wrapperStyle:{minHeight:"200px"}}]}]}]}}const R=Neo.setupClass(E),P=()=>Neo.app({mainView:R,name:"Legit"})},3997(e,t,a){a.d(t,{A:()=>o});var s=a(2915),i=a(9932);class n extends s.A{static config={className:"Neo.controller.Component",ntype:"component-controller",component:null,parent_:null,references:null,windowId:null};construct(e){super.construct(e);let t=this,{component:a}=t;t.references={},a.isConstructed?t.onComponentConstructed():a.on("constructed",()=>{t.onComponentConstructed()},t,{once:!0})}beforeSetParent(e,t){return e||this.getParent()}getHandlerScope(e,t){let a,s=this,{parent:n}=s;return!(!t||(a=(0,i.Ap)(e,t),!a.fn))||(Neo.isFunction(s[e])?s:n?.getHandlerScope(e)||null)}getParent(){let{parent:e}=this;return e||this.component.parent?.getController()||null}getReference(e){let t=this,a=t.references[e];return a||(a=t.component.down({reference:e}),a&&(t.references[e]=a)),a||null}getState(...e){return this.getStateProvider().getData(...e)}getStateProvider(e=!1){let{component:t}=this;return e?t.stateProvider:t.getStateProvider()}getStore(e){return this.getStateProvider().getStore(e)}onComponentConstructed(){}removeReference(e){let t,{references:a}=this;for(t in a)if(e===a[t]){delete a[t];break}this.getParent()?.removeReference(e)}setState(...e){this.getStateProvider().setData(...e)}}const o=Neo.setupClass(n)},5367(e,t,a){a.d(t,{A:()=>n});var s=a(1184);class i extends s.A{static config={className:"Neo.container.Viewport",ntype:"viewport",applyBodyCls:!0,autoMount:!0,baseCls:["neo-viewport"],monitorSize_:!1};afterSetMounted(e,t){super.afterSetMounted(e,t);let a=this;e&&a.monitorSize&&a.addDomListeners([{resize:a.onDomResize,scope:a}])}onConstructed(){super.onConstructed();let{windowId:e}=this;this.applyBodyCls&&Neo.main.DomAccess.applyBodyCls({cls:["neo-body-viewport"],windowId:e})}onDomResize(e){this.fire("resize",e)}}const n=Neo.setupClass(i)},6929(e,t,a){a.d(t,{A:()=>n});var s=a(1184);a(8310);class i extends s.A{static config={className:"Neo.container.Panel",ntype:"panel",baseCls:["neo-panel","neo-container"],containerConfig:null,headerDefaults:null,headers:null,_layout:{ntype:"vbox",align:"stretch"},verticalHeadersFirst:!1};construct(e){super.construct(e);let t=this;t.hasHeaders()&&!0===t.verticalHeadersFirst&&(t.layout={ntype:"hbox",align:"stretch"})}static createHeaderConfig(e){if("NeoInstance"===Neo.typeOf(e))return e;let t={flex:"0 1 auto"};return e.module||e.ntype||(t.cls=["neo-panel-header-toolbar","neo-toolbar"],t.ntype="toolbar"),e.text&&(t.items=[{ntype:"label",cls:["neo-panel-header-text","neo-label"],text:e.text}],delete e.text),Array.isArray(e.items)&&e.items.forEach(e=>{"label"===e.ntype&&(e.cls=["neo-panel-header-text","neo-label"])}),{...t,...e}}createItems(){let e=this,t=e.containerConfig;if(e.hasHeaders()){let a,s=!1===e.verticalHeadersFirst,n=e.headers||[],o=n.filter(e=>e.dock===(s?"bottom":"right")),r=n.filter(e=>e.dock===(s?"left":"top")),l=n.filter(e=>e.dock===(s?"right":"bottom")),c=n.filter(e=>e.dock===(s?"top":"left")),d=o.length>0||c.length>0,u=r.length>0||l.length>0,{items:m}=e,p=[],h=[];c.forEach(e=>{h.push(i.createHeaderConfig(e))}),u&&(s&&d||!s&&d)?(r.forEach(e=>{p.push(i.createHeaderConfig(e))}),a={ntype:"container",flex:1,items:m,itemDefaults:e.itemDefaults,...t},p.push({...e.headerDefaults,...a}),l.forEach(e=>{p.push(i.createHeaderConfig(e))}),h.push({ntype:"container",items:p,layout:{ntype:s?"hbox":"vbox",align:"stretch"},reference:"bodyContainer"})):(a={ntype:"container",flex:1,items:m,itemDefaults:e.itemDefaults,reference:"bodyContainer",...t},h.push({...e.headerDefaults,...a})),o.forEach(e=>{h.push(i.createHeaderConfig(e))}),e.items=h,e.itemDefaults=null,super.createItems()}else t&&e.set(t),super.createItems()}hasHeaders(){return Array.isArray(this.headers)&&this.headers.length>0}}const n=Neo.setupClass(i)},8310(e,t,a){a.d(t,{A:()=>r}),a(8659);var s=a(1741),i=a(1184),n=(a(9217),a(1031));class o extends i.A{static dockPositions=["top","right","bottom","left",null];static config={className:"Neo.toolbar.Base",ntype:"toolbar",baseCls:["neo-toolbar"],dock_:null,itemDefaults:{ntype:"button"},layout:{ntype:"flexbox",align:"center",direction:"row",pack:"start"}};afterSetDock(e,t){if(!e&&!t)return;let a=this,{cls:s}=a,i=a.getStaticConfig("dockPositions"),o=a.getLayoutConfig();i.forEach(t=>{null!==t&&n.A.toggle(s,"neo-dock-"+t,t===e)}),a.layout?(a.layout.set(o),a.cls=s):(o.ntype="flexbox",a.set({cls:s,layout:o}))}beforeSetDock(e,t){return this.beforeSetEnumValue(e,t,"dock","dockPositions")}createItems(){let e=this._items;return Array.isArray(e)&&(this._items=e.map(e=>this.replaceSpacer(e))),super.createItems()}getLayoutConfig(){let e,t=this;if(t.dock)switch(t.dock){case"bottom":case"top":e={align:"center",direction:"row",pack:"start"};break;case"left":e={align:"center",direction:"column-reverse",pack:"start"};break;case"right":e={align:"center",direction:"column",pack:"start"}}return e||t.layout}insert(e,t,a=!1){return t=Array.isArray(t)?t.map(e=>this.replaceSpacer(e)):this.replaceSpacer(t),super.insert(e,t,a)}replaceSpacer(e){return"->"===e?{module:s.A,flex:1}:e}toJSON(){return{...super.toJSON(),dock:this.dock}}}const r=Neo.setupClass(o)},9217(e,t,a){a.d(t,{A:()=>n});var s=a(1741);class i extends s.A{static config={className:"Neo.component.Label",ntype:"label",baseCls:["neo-label"],tag:"label"}}const n=Neo.setupClass(i)}}]);