"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[1762],{1762(e,t,a){a.r(t),a.d(t,{onStart:()=>P});var s=a(5367),n=a(8659),o=a(295);class i extends o.A{static config={className:"Legit.view.CommitGrid",baseCls:["legit-commit-grid","neo-grid-container"],bind:{store:"stores.commitStore"},columnDefaults:{renderer:"onCommitColumnRenderer"},columns:[{dataField:"timestamp",text:"Timestamp",width:150},{dataField:"author",text:"Author",width:150},{dataField:"message",text:"Message",flex:1},{dataField:"oid",text:"OID",width:300}]}}const l=Neo.setupClass(i);var r=a(1184),c=a(9361),d=a(6929),p=a(3176),m=a(1956),u=a(8310),h=a(3997),g=a(3572);class f extends g.A{static config={className:"Legit.service.Legit",fs:null,legitFs:null,path:"/.legit/branches/anonymous",singleton:!0};async initAsync(){await super.initAsync();const e=this;try{const{openLegitFs:t}=await import("https://esm.sh/@legit-sdk/core"),a=await import("https://esm.sh/memfs");e.fs=a.default,e.legitFs=await t({storageFs:e.fs,gitRoot:"/",serverUrl:"http://localhost:9999/"}),globalThis.legitFs=e.legitFs,await e.#e()}catch(e){console.error("Failed to initialize Legit Service",e)}}async loadHistory(e="anonymous"){await this.ready();try{const t=await this.legitFs.readFile(`/.legit/branches/${e}/.legit/history`,"utf-8");return JSON.parse(t)}catch(t){return console.warn(`Failed to load history for branch ${e}`,t),[]}}async loadTree(e){await this.ready();const t=this,a={},s=await t.readdir(e);for(const n of s)if((await t.stat(e+n)).isDirectory())a[n]=await t.loadTree(e+n+"/");else{const s=await crypto.subtle.digest("SHA-1",await t.readFile(e+n));a[n]={hash:s,name:n}}return{hash:"",subEntries:a}}async loadTreeDelta(e,t){await this.ready();const a=this,s=t.slice(0,2),n=t.slice(2);let o={};if(e){const t=e.slice(0,2),s=e.slice(2);o=await a.loadTree("/.legit/commits/"+t+"/"+s+"/")}const i=await a.loadTree("/.legit/commits/"+s+"/"+n+"/"),l=[],r=[],c=[];function d(e,t=""){const a={};if(e.subEntries)for(const[s,n]of Object.entries(e.subEntries)){const e=t?`${t}/${s}`:s;n.subEntries?Object.assign(a,d(n,e)):a[e]=n.hash}return a}const p=""!==e?d(o):{},m=d(i);for(const e in p)e in m||l.push(e);for(const e in m)e in p||r.push(e);for(const e in m)if(e in p){const t=new Uint8Array(p[e]),a=new Uint8Array(m[e]);t.length===a.length&&t.every((e,t)=>e===a[t])||c.push(e)}return{deleted:l,added:r,modified:c}}async readFile(e,t){return await this.ready(),this.legitFs.readFile(e,t)}async readdir(e){return await this.ready(),this.legitFs.readdir(e)}async#e(){const e=this;let t=await fetch("../../learn/benefits/FormsEngine.md");t=await t.text(),await e.writeFile({data:t,path:`${e.path}/FormsEngine.md`,skipReady:!0}),t=await fetch("../../learn/benefits/OffTheMainThread.md"),t=await t.text(),await e.writeFile({data:t,path:`${e.path}/OffTheMainThread.md`,skipReady:!0}),await e.writeFile({data:["import Viewport from '../../examples/component/multiWindowHelix/Viewport.mjs';","","class MainView extends Viewport {","    static config = {","        className           : 'Portal.view.MultiWindowHelix',","        showGitHubStarButton: false,","        theme               : 'neo-theme-dark'","    }","}","","MainView = Neo.setupClass(MainView);"].join("\n"),path:`${e.path}/Helix.mjs`,skipReady:!0}),await e.writeFile({data:["import Viewport from '../../examples/component/multiWindowCoronaGallery/Viewport.mjs';","","class MainView extends Viewport {","    static config = {","        className           : 'Portal.view.MultiWindowHelix',","        showGitHubStarButton: false,","        theme               : 'neo-theme-dark'","    }","}","","MainView = Neo.setupClass(MainView);"].join("\n"),path:`${e.path}/Gallery.mjs`,skipReady:!0})}async stat(e){return await this.ready(),this.legitFs.stat(e)}async writeFile({data:e,options:t,path:a,skipReady:s=!1}){return!s&&await this.ready(),this.legitFs.writeFile(a,e,t)}}const y=Neo.setupClass(f);class w extends h.A{static config={className:"Legit.view.ViewportController",pollingInterval:1e3};addDialog=null;currentTreeState=null;running=!1;async initAsync(){await super.initAsync();const e=this;await y.ready(),e.getReference("new-file-button").disabled=!1,e.getReference("save-button").disabled=!1,setInterval(e.poll.bind(e),e.pollingInterval)}async onAddFileDialogSave(e){const t=this.addDialog,a=t.getReference("filename"),s=`${y.path}/${a.value}`;t.hide(),console.log("onAddFileDialogSave",a.value),await y.writeFile({data:"",path:s}),this.setState({currentFile:s})}onCommitColumnRenderer(e){return"author"===e.dataField?e.value.name:"timestamp"===e.dataField?new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric",second:"numeric"}).format(new Date(1e3*e.value)):e.value}onFileItemClick(e){console.log("onFileItemClick",e)}async onEditorChange(e){}async onNewFileButtonClick(e){let t=this,{addDialog:s}=t,n=e.component,{appName:o,theme:i,windowId:l}=n;n.disabled=!0,s?s.show():Promise.all([a.e(3484),a.e(7600)]).then(a.bind(a,7600)).then(e=>{t.addDialog=Neo.create({module:e.default,animateTargetId:n.id,appName:o,listeners:{hide:e=>{n.disabled=!1}},parentComponent:t.component,theme:i,windowId:l})})}async onSaveButtonClick(e){const t=this,a=t.getReference("code-live-preview"),s=t.getState("currentFile");console.log("onSaveButtonClick",t.getState("currentFile"),a.value),await y.writeFile({data:a.value,path:`${y.path}/${s}`})}async onTreeListSelect({records:e}){const t=this.getReference("code-live-preview"),a=e?.[0],s=a.id.includes(".md")?"markdown":"neomjs";if(a?.isLeaf){this.setState({currentFile:a.id});const e=await y.readFile(`${y.path}/${a.id}`,"utf-8");await t.set({language:s,value:e})}}async poll(){let e=this;if(!e.running)try{e.running=!0;let t=await y.readFile(y.path+"/.legit/head","utf-8");if(e.currentTreeState===t)return;const a=e.getStore("commitStore"),s=e.getStore("fileStore"),n=await y.loadTreeDelta(e.currentTreeState,t);a.data=await y.loadHistory(),console.log("TREE DELTA:",n);for(const e of n.deleted)console.log("Deleted FROM TREE: "+e),s.remove(e);for(const e of n.added)console.log("Added From Tree:"+e),s.insert(0,{id:e,name:e,parentId:null});for(const e of n.modified)console.log("MODIFIED From Tree:"+e);e.currentTreeState=t}finally{e.running=!1;let t=e.getReference("files-tree").selectionModel;t.hasSelection()||t.selectAt(0)}}}const C=Neo.setupClass(w);var b=a(1967);class v extends b.A{static config={className:"Legit.model.Commit",fields:[{name:"oid",type:"String"},{name:"message",type:"String"},{name:"author",type:"Object"},{name:"timestamp",type:"Integer"}]}}const x=Neo.setupClass(v);var S=a(2779);class A extends S.A{static config={className:"Legit.store.Commits",model:x,sorters:[{property:"timestamp",direction:"DESC"}]}}const I=Neo.setupClass(A);class N extends b.A{static config={className:"Legit.model.File",fields:[{name:"className",type:"String"},{name:"collapsed",type:"Boolean"},{name:"hidden",type:"Boolean"},{name:"id",type:"String"},{name:"isLeaf",type:"Boolean",defaultValue:!0},{name:"name",type:"String"},{name:"parentId",type:"String"}]}}const F=Neo.setupClass(N);class k extends S.A{static config={className:"Legit.store.Files",model:F}}const L=Neo.setupClass(k);var D=a(9943);class E extends D.A{static config={className:"Legit.view.ViewportStateProvider",data:{currentFile:null},stores:{commitStore:I,fileStore:L}}}const R=Neo.setupClass(E);class T extends s.A{static config={className:"Legit.view.Viewport",cls:["legit-viewport"],controller:C,stateProvider:R,layout:{ntype:"hbox",align:"stretch"},items:[{module:p.A,bind:{store:"stores.fileStore"},cls:["legit-files-tree"],listeners:{leafItemClick:"onFileItemClick",select:"onTreeListSelect"},reference:"files-tree",showCollapseExpandAllIcons:!1,width:300},{module:m.A,resizeTarget:"previous",size:5},{module:r.A,flex:1,layout:{ntype:"vbox",align:"stretch"},items:[{module:u.A,flex:"none",style:{marginRight:"15px"},items:["->",{module:n.A,disabled:!0,handler:"onNewFileButtonClick",iconCls:"fa fa-plus",reference:"new-file-button",text:"New File"},{module:n.A,disabled:!0,handler:"onSaveButtonClick",iconCls:"fa fa-cloud-upload",reference:"save-button",style:{marginLeft:".5em"},text:"Save"}]},{module:c.default,flex:3,language:"markdown",listeners:{editorChange:"onEditorChange"},reference:"code-live-preview",style:{margin:"20px"}},{module:m.A,direction:"horizontal",resizeTarget:"previous",size:5},{module:d.A,cls:["legit-commit-grid-panel"],flex:1,style:{margin:"20px"},headers:[{dock:"top",text:"Legit History"}],items:[{module:l,wrapperStyle:{minHeight:"200px"}}]}]}]}}const H=Neo.setupClass(T),P=()=>Neo.app({mainView:H,name:"Legit"})},3176(e,t,a){a.d(t,{A:()=>d});var s=a(3123),n=a(5023),o=a(6969),i=a(1031),l=a(3675),r=a(950);class c extends s.A{static config={className:"Neo.tree.List",ntype:"treelist",baseCls:["neo-tree-list"],disableSelection:!1,dragResortable_:!1,dragZone:null,folderCls:"neo-list-folder",showCollapseExpandAllIcons:!0,sortZone:null,sortZoneConfig:null,wrapperCls:[],_vdom:{cn:[{tag:"ul",cls:["neo-list-container","neo-list"],tabIndex:-1,cn:[]}]}};afterSetDraggable(e,t){let s=this;e&&(s.dragResortable?console.error("tree.List can be either draggable or dragResortable, not both.",s.id):s.dragZone||Promise.all([a.e(9244),a.e(4520)]).then(a.bind(a,4520)).then(e=>{s.dragZone=Neo.create({module:e.default,appName:s.appName,owner:s,windowId:s.windowId,...s.dragZoneConfig})}))}afterSetDragResortable(e,t){let s=this;e&&(s.draggable?console.error("tree.List can be either draggable or dragResortable, not both.",s.id):s.sortZone||Promise.all([a.e(9244),a.e(9458)]).then(a.bind(a,9458)).then(e=>{s.sortZone=Neo.create({module:e.default,appName:s.appName,boundaryContainerId:s.id,owner:s,windowId:s.windowId,...s.sortZoneConfig})}))}beforeSetSelectionModel(e,t){return t?.destroy(),n.A.beforeSetInstance(e,l.A)}beforeSetStore(e,t){return e||(e=Neo.create(o.A,{keyProperty:"id"})),super.beforeSetStore(e,t)}collapseAll(e=!1){let t,a=this,s=!1;a.store.forEach(e=>{e.isLeaf||(t=a.getVdomChild(a.getItemId(e.id),a.vdom),t.cls.includes("neo-folder-open")&&(i.A.remove(t.cls,"neo-folder-open"),s=!0))}),s&&!e&&a.update()}createItem(e){let t,a=this,{folderCls:s,itemCls:n}=a,o=[n],i=[n+"-content"],l=a.getKeyProperty();return e.iconCls&&(Array.isArray(e.iconCls)?i.push(...e.iconCls):i.push(e.iconCls)),e.isLeaf?o.push(n+(e.singleton?"-leaf-singleton":"-leaf")):(o.push(s),e.collapsed||o.push("neo-folder-open")),t={tag:"li",cls:o,id:a.getItemId(e[l]),cn:[{tag:"span",cls:i,html:e.name,style:{pointerEvents:"none"}}],style:{display:e.hidden?"none":"flex",padding:"10px",position:e.isLeaf?null:"sticky",top:e.isLeaf?null:38*e.level+"px",zIndex:e.isLeaf?null:20/(e.level+1)}},a.itemsFocusable&&(t.tabIndex=-1),t}createItemLevel(e,t,a,s=!1){let n,o=this,i=o.store.find("parentId",e);return i.length>0&&(t.cn||(t.cn=[]),null!==e?(t.cn.push({tag:"ul",cls:["neo-list"],cn:[],style:{display:s?"none":null,paddingLeft:"15px"}}),n=t.cn[t.cn.length-1]):n=t,i.forEach(e=>{e.level=a,n.cn.push(o.createItem(e)),o.createItemLevel(e.id,n,a+1,e.hidden||s)})),t}createItems(){let e=this,t=e.getListItemsRoot();t.cn=[],e.createItemLevel(null,t,0),e.update()}expandAll(e=!1){let t,a=this,s=!1;a.store.forEach(e=>{e.isLeaf||(t=a.getVdomChild(a.getItemId(e.id),a.vdom),t.cls.includes("neo-folder-open")||(i.A.add(t.cls,"neo-folder-open"),s=!0))}),s&&!e&&a.update()}filter(e,t,a,s=!1){let n,o,i,l=this,r=!0,c=new RegExp(t,"gi");return t||(t=""),l.store.forEach(d=>{d.parentId===a&&(o=!1,i=l.getVdomChild(l.getItemId(d.id),l.vdom),i.cn[0].html=d[e].replace(c,e=>(o=!0,`<span class="neo-highlight-search">${e}</span>`)),n=!!d.isLeaf||l.filter(e,t,d.id,o||s),(o||s||!1===n||""===t)&&(r=!1),i.style.display=r?"none":"list-item")}),null===a&&(l.expandAll(!0),l.update()),r}getListItemsRoot(){return this.vdom.cn[this.showCollapseExpandAllIcons?2:0]}onClick(e){e.target.cls.includes("neo-treelist-menu-item")?this.onMenuItemClick(e.target.cls):super.onClick(e)}onConstructed(){super.onConstructed();let e=this;e.showCollapseExpandAllIcons&&(e.vdom.cn.unshift({cls:["neo-treelist-menu-item","neo-treelist-collapse-all-icon"],cn:[{tag:"span",cls:["neo-treelist-menu-item-content"]}]},{cls:["neo-treelist-menu-item","neo-treelist-expand-all-icon"],cn:[{tag:"span",cls:["neo-treelist-menu-item-content"]}]}),e.update())}onItemClick(e,t){let a,s,n,o,l=this,{items:r}=l.store,c=0,d=r.length,p=l.getKeyProperty(),m=t.path.map(e=>e.id);for(;c<d;c++)if(n=r[c],o=l.getItemId(n[p]),m.includes(o)){s=n,a=l.getVdomChild(o);break}a&&(a.cls?.includes(l.folderCls)?(i.A.toggle(a.cls,"neo-folder-open"),l.update()):(l.onLeafItemClick(s),l.fire("leafItemClick",s)),super.onItemClick(e,t))}onLeafItemClick(e){}onMenuItemClick(e){e.includes("neo-treelist-collapse-all-icon")?this.collapseAll():this.expandAll()}onStoreRecordChange(e){let t=this,{record:a}=e,{index:s,parentNode:n}=r.A.find(t.vdom,t.getItemId(a.id));n.cn[s]=t.createItem(a),t.update()}}const d=Neo.setupClass(c)},3675(e,t,a){a.d(t,{A:()=>o});var s=a(8051);class n extends s.A{static config={className:"Neo.selection.TreeModel",ntype:"selection-treemodel"};onKeyDownEnter(e){}onNavKey(e,t){}}const o=Neo.setupClass(n)},3997(e,t,a){a.d(t,{A:()=>i});var s=a(2915),n=a(9932);class o extends s.A{static config={className:"Neo.controller.Component",ntype:"component-controller",component:null,parent_:null,references:null,windowId:null};construct(e){super.construct(e);let t=this,{component:a}=t;t.references={},a.isConstructed?t.onComponentConstructed():a.on("constructed",()=>{t.onComponentConstructed()},t,{once:!0})}beforeSetParent(e,t){return e||this.getParent()}getHandlerScope(e,t){let a,s=this,{parent:o}=s;return!(!t||(a=(0,n.Ap)(e,t),!a.fn))||(Neo.isFunction(s[e])?s:o?.getHandlerScope(e)||null)}getParent(){let{parent:e}=this;return e||this.component.parent?.getController()||null}getReference(e){let t=this,a=t.references[e];return a||(a=t.component.down({reference:e}),a&&(t.references[e]=a)),a||null}getState(...e){return this.getStateProvider().getData(...e)}getStateProvider(e=!1){let{component:t}=this;return e?t.stateProvider:t.getStateProvider()}getStore(e){return this.getStateProvider().getStore(e)}onComponentConstructed(){}removeReference(e){let t,{references:a}=this;for(t in a)if(e===a[t]){delete a[t];break}this.getParent()?.removeReference(e)}setState(...e){this.getStateProvider().setData(...e)}}const i=Neo.setupClass(o)},5367(e,t,a){a.d(t,{A:()=>o});var s=a(1184);class n extends s.A{static config={className:"Neo.container.Viewport",ntype:"viewport",applyBodyCls:!0,autoMount:!0,baseCls:["neo-viewport"],monitorSize_:!1};afterSetMounted(e,t){super.afterSetMounted(e,t);let a=this;e&&a.monitorSize&&a.addDomListeners([{resize:a.onDomResize,scope:a}])}onConstructed(){super.onConstructed();let{windowId:e}=this;this.applyBodyCls&&Neo.main.DomAccess.applyBodyCls({cls:["neo-body-viewport"],windowId:e})}onDomResize(e){this.fire("resize",e)}}const o=Neo.setupClass(n)},6929(e,t,a){a.d(t,{A:()=>o});var s=a(1184);a(8310);class n extends s.A{static config={className:"Neo.container.Panel",ntype:"panel",baseCls:["neo-panel","neo-container"],containerConfig:null,headerDefaults:null,headers:null,_layout:{ntype:"vbox",align:"stretch"},verticalHeadersFirst:!1};construct(e){super.construct(e);let t=this;t.hasHeaders()&&!0===t.verticalHeadersFirst&&(t.layout={ntype:"hbox",align:"stretch"})}static createHeaderConfig(e){if("NeoInstance"===Neo.typeOf(e))return e;let t={flex:"0 1 auto"};return e.module||e.ntype||(t.cls=["neo-panel-header-toolbar","neo-toolbar"],t.ntype="toolbar"),e.text&&(t.items=[{ntype:"label",cls:["neo-panel-header-text","neo-label"],text:e.text}],delete e.text),Array.isArray(e.items)&&e.items.forEach(e=>{"label"===e.ntype&&(e.cls=["neo-panel-header-text","neo-label"])}),{...t,...e}}createItems(){let e=this,t=e.containerConfig;if(e.hasHeaders()){let a,s=!1===e.verticalHeadersFirst,o=e.headers||[],i=o.filter(e=>e.dock===(s?"bottom":"right")),l=o.filter(e=>e.dock===(s?"left":"top")),r=o.filter(e=>e.dock===(s?"right":"bottom")),c=o.filter(e=>e.dock===(s?"top":"left")),d=i.length>0||c.length>0,p=l.length>0||r.length>0,{items:m}=e,u=[],h=[];c.forEach(e=>{h.push(n.createHeaderConfig(e))}),p&&(s&&d||!s&&d)?(l.forEach(e=>{u.push(n.createHeaderConfig(e))}),a={ntype:"container",flex:1,items:m,itemDefaults:e.itemDefaults,...t},u.push({...e.headerDefaults,...a}),r.forEach(e=>{u.push(n.createHeaderConfig(e))}),h.push({ntype:"container",items:u,layout:{ntype:s?"hbox":"vbox",align:"stretch"},reference:"bodyContainer"})):(a={ntype:"container",flex:1,items:m,itemDefaults:e.itemDefaults,reference:"bodyContainer",...t},h.push({...e.headerDefaults,...a})),i.forEach(e=>{h.push(n.createHeaderConfig(e))}),e.items=h,e.itemDefaults=null,super.createItems()}else t&&e.set(t),super.createItems()}hasHeaders(){return Array.isArray(this.headers)&&this.headers.length>0}}const o=Neo.setupClass(n)},8310(e,t,a){a.d(t,{A:()=>l}),a(8659);var s=a(1741),n=a(1184),o=(a(9217),a(1031));class i extends n.A{static dockPositions=["top","right","bottom","left",null];static config={className:"Neo.toolbar.Base",ntype:"toolbar",baseCls:["neo-toolbar"],dock_:null,itemDefaults:{ntype:"button"},layout:{ntype:"flexbox",align:"center",direction:"row",pack:"start"}};afterSetDock(e,t){if(!e&&!t)return;let a=this,{cls:s}=a,n=a.getStaticConfig("dockPositions"),i=a.getLayoutConfig();n.forEach(t=>{null!==t&&o.A.toggle(s,"neo-dock-"+t,t===e)}),a.layout?(a.layout.set(i),a.cls=s):(i.ntype="flexbox",a.set({cls:s,layout:i}))}beforeSetDock(e,t){return this.beforeSetEnumValue(e,t,"dock","dockPositions")}createItems(){let e=this._items;return Array.isArray(e)&&(this._items=e.map(e=>this.replaceSpacer(e))),super.createItems()}getLayoutConfig(){let e,t=this;if(t.dock)switch(t.dock){case"bottom":case"top":e={align:"center",direction:"row",pack:"start"};break;case"left":e={align:"center",direction:"column-reverse",pack:"start"};break;case"right":e={align:"center",direction:"column",pack:"start"}}return e||t.layout}insert(e,t,a=!1){return t=Array.isArray(t)?t.map(e=>this.replaceSpacer(e)):this.replaceSpacer(t),super.insert(e,t,a)}replaceSpacer(e){return"->"===e?{module:s.A,flex:1}:e}}const l=Neo.setupClass(i)},9217(e,t,a){a.d(t,{A:()=>o});var s=a(1741);class n extends s.A{static config={className:"Neo.component.Label",ntype:"label",baseCls:["neo-label"],tag:"label"}}const o=Neo.setupClass(n)}}]);