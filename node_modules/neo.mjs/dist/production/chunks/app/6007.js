"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[1753,6007],{1753:(e,t,r)=>{r.d(t,{default:()=>i});var n=r(3572),a=r(6282),o=r(1031),s=(r(4556),r(950));class d extends n.A{static observable=!0;static config={className:"Neo.draggable.DragZone",ntype:"dragzone",addDragProxyCls:!0,allowOverdrag:!1,alwaysFireDragMove:!1,appName_:null,bodyCursorStyle:null,boundaryContainerId:null,boundaryContainerRect:null,data:null,dragElement:null,dragElementRect:null,dragProxy:null,dragProxyConfig_:null,dragProxyCls:"neo-dragproxy",dropZoneIdentifier:null,moveHorizontal:!0,moveInMainThread:!0,moveVertical:!0,offsetX:0,offsetY:0,owner:null,proxyParentId_:"document.body",scrollContainerId:null,scrollFactorLeft:1,scrollFactorTop:1,useProxyWrapper:!0,windowId_:null};construct(e){super.construct(e),Neo.main.addon.DragDrop||console.error("You can not use Neo.draggable.DragZone without adding Neo.main.addon.DragDrop to the main thread addons",this.id)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}beforeGetDragProxyConfig(e){return Neo.clone(e,!0,!0)}async createDragProxy(e,t=!0){let r=this,n=Neo.getComponent(r.getDragElementRoot().id)||r.owner,d=r.dragElementRect,i=r.dragProxyConfig?.vdom,l=s.A.clone(i||r.dragElement),g={module:a.A,appName:r.appName,moveInMainThread:r.moveInMainThread,parentId:r.proxyParentId,windowId:r.windowId,...r.dragProxyConfig,vdom:r.useProxyWrapper?{cn:[l]}:l};return g.cls=g.cls||[],n&&g.cls.push(n.getTheme()),l.cls&&!r.useProxyWrapper&&g.cls.push(...l.cls),r.addDragProxyCls&&g.cls&&o.A.add(g.cls,r.dragProxyCls),g.style=g.style||{},Object.assign(g.style,{height:`${e.height}px`,left:`${r.moveHorizontal?e.x:d.x}px`,top:`${r.moveVertical?e.y:d.y}px`,width:`${e.width}px`}),t?r.dragProxy=Neo.create(g):g}destroyDragProxy(){let e=this,t=e.dragProxy.id;e.timeout(e.moveInMainThread?0:30).then(()=>{Neo.applyDeltas(e.windowId,[{action:"removeNode",id:t}])}),e.dragProxy.destroy()}dragEnd(e){let t=this,{owner:r}=t,{cls:n}=r;o.A.remove(n,"neo-is-dragging"),r.cls=n,t.dragProxy&&(t.destroyDragProxy(),t.dragProxy=null),Object.assign(t,{dragElementRect:null,offsetX:0,offsetY:0,scrollContainerId:null}),t.fire("dragEnd",e),t.resetData()}dragMove(e){let t,r=this;!r.moveInMainThread&&r.dragProxy&&(t=r.dragProxy.style,r.moveHorizontal&&(t.left=e.clientX-r.offsetX+"px"),r.moveVertical&&(t.top=e.clientY-r.offsetY+"px"),r.dragProxy.style=t),r.fire("dragMove",e)}async dragStart(e){let t,r,n,a=this,{appName:s,owner:d,windowId:i}=a,{cls:l}=d,g=a.getDragElementRect(e);a.setData(),t=await Neo.main.addon.DragDrop.setConfigs({appName:s,windowId:i,...a.getMainThreadConfigs()}),a.boundaryContainerRect=t.boundaryContainerRect,o.A.add(l,"neo-is-dragging"),d.cls=l,r=e.clientX-g.left,n=e.clientY-g.top,Object.assign(a,{dragElementRect:g,offsetX:r,offsetY:n}),await a.createDragProxy(g),a.fire("dragStart",{clientX:e.clientX,clientY:e.clientY,dragElementRect:g,eventData:e,id:a.id,offsetX:r,offsetY:n})}getDragElementRect(e){let t=this.getDragElementRoot().id;for(let r of e.path)if(r.id===t)return r.rect;for(let r of e.targetPath)if(r.id===t)return r.rect;return null}getDragElementRoot(){return this.dragElement}getMainThreadConfigs(){let e=this;return{allowOverdrag:e.allowOverdrag,alwaysFireDragMove:e.alwaysFireDragMove,bodyCursorStyle:e.bodyCursorStyle,boundaryContainerId:e.boundaryContainerId,dragElementRootId:e.getDragElementRoot().id,dragProxyCls:e.dragProxyCls,dragZoneId:e.id,dropZoneIdentifier:e.dropZoneIdentifier,moveHorizontal:e.moveHorizontal,moveVertical:e.moveVertical,scrollContainerId:e.scrollContainerId,scrollFactorLeft:e.scrollFactorLeft,scrollFactorTop:e.scrollFactorTop}}onDrop(e){this.fire("drop",e)}onDropEnter(e){this.fire("drop:enter",e)}onDropLeave(e){this.fire("drop:leave",e)}resetData(){this.timeout(50).then(()=>{this.data=null})}setData(e={}){let t=this;t.data={dragElement:t.getDragElementRoot(),dragZoneId:t.id,...e}}}const i=Neo.setupClass(d)},4880:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(3572);class a extends n.A{static config={className:"Neo.plugin.Base",ntype:"plugin",owner:null,windowId_:null};construct(e){super.construct(e);let t=this,{owner:r}=t;r.isConstructed?t.onOwnerConstructed():r.on("constructed",()=>{t.onOwnerConstructed()},t,{once:!0}),r.mounted?t.onOwnerMounted():r.on("mounted",t.onOwnerMounted,t)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}onOwnerConstructed(){let{owner:e}=this;e.windowId&&(this.windowId=e.windowId)}onOwnerMounted(){}}const o=Neo.setupClass(a)},6007:(e,t,r)=>{r.r(t),r.d(t,{default:()=>p});var n=r(4880),a=r(1692),o=r(6282),s=r(1753),d=r(1031),i=r(950);class l extends s.default{static config={className:"Neo.calendar.view.week.EventDragZone",addDragProxyCls:!1,enableResizingAcrossOppositeEdge:!0,axisEndTime:0,axisStartTime:0,columnHeight:0,columnTop:0,currentInterval:0,eventDuration:0,eventRecord:null,forceUpdate:!1,hasOverflow:!1,intervalSize:15,keepEndDate:!1,keepStartDate:!1,moveHorizontal:!1,moveInMainThread:!1,newEndDate:null,newStartDate:null,scrollFactorLeft:3,useProxyWrapper:!1};addBodyCursorCls(){Neo.applyDeltas(this.windowId,{id:"document.body",cls:{add:["neo-cursor-move"]}})}adjustEndDate(e){return 0===e.getHours()&&0===e.getMinutes()?e.setMinutes(e.getMinutes()-1):23===e.getHours()&&59===e.getMinutes()||e.getMinutes()%this.intervalSize===0||e.setMinutes(e.getMinutes()+1),e}afterSetProxyParentId(e,t){if(e&&void 0!==t){let t=this;t.dragProxy?.vdom.cn[0].id&&Neo.applyDeltas(t.windowId,{action:"moveNode",id:t.dragProxy.id,index:0,parentId:e})}}async createDragProxy(e,t=!0){let r=this,n=Neo.getComponent(r.getDragElementRoot().id)||r.owner,a=r.dragProxyConfig?.vdom,s=i.A.clone(a||r.dragElement);s.cn[2].removeDom=!1;const l={module:o.A,appName:r.appName,moveInMainThread:r.moveInMainThread,parentId:r.proxyParentId,windowId:r.windowId,...r.dragProxyConfig,vdom:r.useProxyWrapper?{cn:[s]}:s};return l.cls=l.cls||[],l.cls.push("neo-focus"),n&&l.cls.push(n.getTheme()),s.cls&&!r.useProxyWrapper&&l.cls.push(...s.cls),r.addDragProxyCls&&d.A.add(l.cls,r.dragProxyCls),Object.assign(l.style,{height:`${e.height}px`,top:e.y-r.columnTop+"px",width:`${e.width}px`}),t?r.dragProxy=Neo.create(l):l}dragEnd(e){super.dragEnd(e);let t,r,n=this,{owner:o}=n,s=n.eventRecord;n.keepStartDate?(t=n.newEndDate,r=n.newStartDate||s.startDate):(r=new Date(i.A.find(o.vdom,n.proxyParentId).vdom.flag+"T12:00:00.000Z"),r.setHours(n.axisStartTime),r.setMinutes(n.currentInterval*n.intervalSize),n.keepEndDate?(t=n.newEndDate||s.endDate,r=n.newStartDate||r):(t=a.A.clone(r),t.setMinutes(t.getMinutes()+n.eventDuration))),t=n.adjustEndDate(t),s.setSilent({endDate:t,startDate:r}),Object.assign(n,{currentInterval:0,hasOverflow:!1,keepEndDate:!1,keepStartDate:!1,newEndDate:null,newStartDate:null,proxyParentId:null}),o.getStateProvider().getStore("events").doSort(),o.updateEvents()}dragMove(e){let t,r,n,o,s,d,i,l,g,c,u,p,m,v,D=this,{axisEndTime:h,axisStartTime:y,columnHeight:w,eventDuration:f,intervalSize:x,keepEndDate:E,keepStartDate:P,owner:C}=D,I=0,M=e.targetPath,S=M.length,T=D.eventRecord,N=!1,{timeAxis:b}=C;if(D.dragProxy){if(!E&&!P)for(;I<S;I++)if(M[I].cls.includes("neo-c-w-column")){D.proxyParentId=M[I].id;break}if(g=60*(h-y)/x,l=w/g,p=Math.min(w,e.clientY-D.offsetY-D.columnTop),r=Math.floor(p/l),s=a.A.clone(T.endDate),m=a.A.clone(T.startDate),E&&y>m.getHours()&&(m.setHours(y),m.setMinutes(0),f=(s-m)/60/1e3),P&&h<s.getHours()&&(s.setHours(h),s.setMinutes(0),f=(s-m)/60/1e3),E||(r=Math.min(r,g-f/x)),n=[{id:D.dragProxy.id,style:{}}],E||P)if(t=a.A.clone(T.startDate),t.setHours(y),t.setMinutes(0),u=C.minimumEventDuration/x,v=(T.startDate-t)/x/60/1e3,E){if(c=v+f/x,D.enableResizingAcrossOppositeEdge){if(D.forceUpdate&&r>c-u&&r<c+u)return;r>=c+u?(N=!0,D.forceUpdate=!0,s.setHours(y),s.setMinutes(r*x),s=D.adjustEndDate(s),D.newEndDate=s,m.setHours(y),m.setMinutes(c*x),D.newStartDate=m,o=(s-m)/60/60/1e3,n[0].style.top=`calc(${c*l/w*100}% + 1px)`):(D.forceUpdate=!1,D.newStartDate=null)}N||(r=Math.min(r,c-u))}else if(P){if(c=v-f/x,D.enableResizingAcrossOppositeEdge)if(r=Math.max(-f/x,r),r<=c-u)N=!0,D.forceUpdate=!0,s.setHours(y),s.setMinutes(f+c*x),s=D.adjustEndDate(s),D.newEndDate=s,m.setHours(y),m.setMinutes(f+r*x),D.newStartDate=m,o=(s-m)/60/60/1e3,p=(f/x+r)*l,p=p/w*100,n[0].style.top=`calc(${p}% + 1px)`;else{if(D.forceUpdate&&r<c+u)return;D.forceUpdate&&r>=c+u&&D.currentInterval!==r&&(D.forceUpdate=!1,D.newStartDate=null,n[0].style.top=`calc(${v*l/w*100}% + 1px)`)}N||(r=Math.max(r,c+u))}P||(r=Math.max(0,r)),D.currentInterval!==r&&(N||(E||(s.setHours(y),s.setMinutes(f+r*x)),P?(D.newEndDate=s,o=(s-T.startDate)/60/60/1e3):(m.setHours(y),m.setMinutes(r*x),p=r*l,p=p/w*100,n[0].style.top=`calc(${p}% + 1px)`),E&&(o=(T.endDate-m)/60/60/1e3)),s=D.adjustEndDate(s),n.push({id:D.dragProxy.vdom.cn[2].id,textContent:C.intlFormat_time.format(s)}),(E||P)&&(i=Math.round(o/(h-y)*100*1e3)/1e3,n[0].style.height=`calc(${i}% - 2px)`),n.push({id:D.dragProxy.vdom.cn[0].id,textContent:C.intlFormat_time.format(m)}),D.dragProxy.vdom.cn[0].id&&(d=(o&&60*o||f)/b.interval,d<=2?b.rowHeight/d<25&&!D.hasOverflow&&(n.push({id:D.dragProxy.id,cls:{add:["neo-overflow"]}}),D.hasOverflow=!0):D.hasOverflow&&(n.push({id:D.dragProxy.id,cls:{remove:["neo-overflow"]}}),D.hasOverflow=!1),Neo.applyDeltas(D.windowId,n))),D.currentInterval=r}}async dragStart(e){let t=this,r=await t.owner.getDomRect([t.getDragElementRoot().id,e.path[1].id]),n=(t.eventRecord.endDate-t.eventRecord.startDate)/60/1e3,a=e.clientX-r[0].left,o=e.clientY-r[0].top;Object.assign(t,{columnHeight:r[1].height,columnTop:r[1].top,dragElementRect:r[0],eventDuration:Math.round(n/t.intervalSize)*t.intervalSize,offsetX:a,offsetY:o}),await t.createDragProxy(r[0]),t.fire("dragStart",{dragElementRect:r[0],id:t.id,offsetX:a,offsetY:o}),t.dragMove(e)}removeBodyCursorCls(){Neo.applyDeltas(this.windowId,{id:"document.body",cls:{remove:["neo-cursor-move"]}})}}const g=Neo.setupClass(l),c=Symbol.for("newRecordSymbol");class u extends n.A{static config={className:"Neo.calendar.view.week.plugin.DragDrop",ntype:"plugin-calendar-week-dragdrop",isDragging:!1,resizablePluginType:"calendar-week-eventresizable"};construct(e){super.construct(e);let t=this,r={scope:t,delegate:".neo-c-w-column"},n={scope:t,delegate:".neo-event"};t.owner.addDomListeners([{"drag:end":t.onColumnDragEnd,...r},{"drag:end":t.onEventDragEnd,...n},{"drag:move":t.onColumnDragMove,...r},{"drag:move":t.onEventDragMove,...n},{"drag:start":t.onColumnDragStart,...r},{"drag:start":t.onEventDragStart,...n}])}adjustResizeEvent(e){return e.path.shift(),e.targetPath.shift(),e.target=e.path[0],e}getEventDragZone(e){let{appName:t,owner:r,windowId:n}=this,{eventDragZone:a,timeAxis:o}=r,s={axisEndTime:o.getTime(r.endTime),axisStartTime:o.getTime(r.startTime),dragElement:e.dragElement,enableResizingAcrossOppositeEdge:e.enableResizingAcrossOppositeEdge,eventRecord:e.eventRecord,proxyParentId:e.proxyParentId};return a?a.set(s):r.eventDragZone=a=Neo.create({module:g,appName:t,owner:r,scrollContainerId:r.getScrollContainer().id,windowId:n,...s,dragProxyConfig:{style:{transition:"none",willChange:"height"}}}),a}isActiveCalendar(){let{owner:e}=this,{calendarStore:t}=e,r=e.data.activeCalendarId||t.getAt(0)[t.keyProperty];return t.get(r).active}isTopLevelColumn(e){return e[0].cls.includes("neo-c-w-column")}isTopLevelEvent(e){return e.path[0].cls.includes("neo-event")}onColumnDragEnd(e){let t=this,{owner:r}=t,n=t[c];n&&t.isTopLevelColumn(e.path)&&(t.isDragging=!1,delete t[c],Neo.applyDeltas(t.windowId,{id:r.getEventId(n.id),style:{opacity:1}}).then(()=>{r.eventDragZone.dragEnd(),r.getPlugin(t.resizablePluginType).onDragEnd(e)}))}onColumnDragMove(e){let t=this;t.isActiveCalendar()&&t.isTopLevelColumn(e.path)&&t.owner.eventDragZone?.dragMove(e)}async onColumnDragStart(e){let t=this;if(t.isActiveCalendar()&&t.isTopLevelColumn(e.targetPath)){let r,n,o,s,d,{owner:l}=t,g=l.timeAxis.getTime(l.startTime),{calendarStore:u}=l,p=e.path[0].rect,m=15,v=60*(l.timeAxis.getTime(l.endTime)-g)/m,D=p.height/v,h=Math.min(p.height,e.clientY-p.top),y=Math.floor(h/D),w=new Date(i.A.find(l.vdom,e.path[0].id).vdom.flag+"T12:00:00.000Z");t.isDragging=!0,w.setHours(g),w.setMinutes(Math.min(y*m,v*m-l.minimumEventDuration)),n=a.A.clone(w),n.setMinutes(n.getMinutes()+l.minimumEventDuration),0===n.getHours()&&0===n.getMinutes()&&n.setMinutes(n.getMinutes()-1),d=l.eventStore.add({calendarId:l.data.activeCalendarId||u.getAt(0)[u.keyProperty],endDate:n,startDate:w,title:"New Event"})[0],t[c]=d,await t.timeout(50),s=l.getEventId(d.id),r=i.A.find(l.vdom,s).vdom,o=t.getEventDragZone({dragElement:r,enableResizingAcrossOppositeEdge:!0,eventRecord:d,proxyParentId:e.path[0].id}),l.getPlugin(t.resizablePluginType).onDragStart(e),await o.dragStart(e),await t.timeout(50),t.isDragging&&Neo.applyDeltas(t.windowId,{id:s,style:{opacity:0}})}}onEventDragEnd(e){let t=this,{owner:r}=t,{eventDragZone:n}=r;r.enableDrag&&(n.dragEnd(),t.isTopLevelEvent(e)?n.removeBodyCursorCls():(e=t.adjustResizeEvent(e),r.getPlugin(t.resizablePluginType).onDragEnd(e)),t.isDragging=!1)}onEventDragMove(e){let t=this,{owner:r}=t;r.enableDrag&&(t.isTopLevelEvent(e)||(e=t.adjustResizeEvent(e)),r.eventDragZone.dragMove(e))}onEventDragStart(e){let t=this,{owner:r}=t,n=r.data;if(r.enableDrag){let a,o,s=t.isTopLevelEvent(e);s||(e=t.adjustResizeEvent(e)),t.isDragging=!0,a=i.A.find(r.vdom,e.path[0].id).vdom,o=t.getEventDragZone({dragElement:a,enableResizingAcrossOppositeEdge:n.events.enableResizingAcrossOppositeEdge,eventRecord:r.eventStore.get(a.flag),proxyParentId:e.path[1].id}),s?o.addBodyCursorCls():r.getPlugin(t.resizablePluginType).onDragStart(e),o.dragStart(e)}}}const p=Neo.setupClass(u)},6282:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(1741);class a extends n.A{static config={className:"Neo.draggable.DragProxyComponent",ntype:"dragproxy",autoInitVnode:!0,autoMount:!0,baseCls:["neo-dragproxy"],moveInMainThread:!0};afterSetMounted(e,t){if(super.afterSetMounted(e,t),e&&this.moveInMainThread){let{appName:e,id:t,windowId:r}=this;Neo.main.addon.DragDrop.setDragProxyElement({appName:e,id:t,windowId:r})}}}const o=Neo.setupClass(a)}}]);