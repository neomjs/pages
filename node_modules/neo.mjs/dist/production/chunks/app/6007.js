"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[1753,2450,6007],{1753(e,t,a){a.d(t,{default:()=>g});var r=a(3572),n=a(1741),o=a(6282),d=a(2450),i=a(1031),s=(a(4556),a(950));class l extends r.A{static observable=!0;static config={className:"Neo.draggable.DragZone",ntype:"dragzone",addDragProxyCls:!0,allowOverdrag:!1,alwaysFireDragMove:!1,appName_:null,bodyCursorStyle:null,boundaryContainerId:null,boundaryContainerRect:null,data:null,dragElement:null,dragElementRect:null,dragProxy:null,dragProxyConfig_:null,dragProxyCls:"neo-dragproxy",dropZoneIdentifier:null,moveHorizontal:!0,moveInMainThread:!0,moveVertical:!0,offsetX:0,offsetY:0,owner:null,proxyParentId_:"document.body",scrollContainerId:null,scrollFactorLeft:1,scrollFactorTop:1,useProxyWrapper:!0,windowId_:null};construct(e){super.construct(e),Neo.main.addon.DragDrop||console.error("You can not use Neo.draggable.DragZone without adding Neo.main.addon.DragDrop to the main thread addons",this.id)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}beforeGetDragProxyConfig(e){return Neo.clone(e,!0,!0)}async createDragProxy(e,t=!0){let a,r,l=this,g=Neo.getComponent(l.getDragElementRoot().id)||l.owner,c=l.dragElementRect,u=l.dragProxyConfig||{},p=u.module===d.A,m=u.vdom,v=!p&&s.A.clone(m||l.dragElement);if(a={module:o.A,appName:l.appName,moveInMainThread:l.moveInMainThread,parentId:l.proxyParentId,windowId:l.windowId,...u},p?(a.height=`${e.height}px`,a.items=[],a.parentComponent=l.owner,a.width=`${e.width}px`,a.cls=a.cls||[],a.cls.push("neo-draggable")):(a.vdom=l.useProxyWrapper?{cn:[v]}:v,v.cls&&!l.useProxyWrapper&&(a.cls=a.cls||[],a.cls.push(...v.cls))),a.cls=a.cls||[],g&&a.cls.push(g.getTheme()),l.addDragProxyCls&&a.cls&&i.A.add(a.cls,l.dragProxyCls),a.style=a.style||{},Object.assign(a.style,{height:`${e.height}px`,left:`${l.moveHorizontal?e.x:c.x}px`,top:`${l.moveVertical?e.y:c.y}px`,width:`${e.width}px`}),t){if(p&&(a.autoInitVnode=!0,a.autoMount=!0),l.dragProxy=r=Neo.create(a),p){await r.mountedPromise,l.dragPlaceholder=Neo.create({module:n.A,flex:g.flex,style:{height:`${e.height}px`,visibility:"hidden",width:`${e.width}px`}}),g.minHeight&&(l.dragPlaceholder.minHeight=g.minHeight),g.minWidth&&(l.dragPlaceholder.minWidth=g.minWidth),l.dragStartIndex=l.owner.items.indexOf(g);const{vnode:t}=await Neo.vdom.Helper.create({vdom:l.dragPlaceholder.vdom});await Neo.applyDeltas(l.windowId,[{action:"insertNode",index:l.dragStartIndex,parentId:l.owner.getVdomItemsRoot().id,vnode:t},{action:"moveNode",id:g.id,index:0,parentId:r.id}]),l.dragPlaceholder.set({vnode:t,mounted:!0,vnodeInitialized:!0})}return r}return a}destroyDragProxy(){let e=this,t=e.dragProxy.id;e.timeout(e.moveInMainThread?0:30).then(()=>{Neo.applyDeltas(e.windowId,[{action:"removeNode",id:t}])}),e.dragProxy.destroy()}dragEnd(e){let t=this,{owner:a}=t,{cls:r}=a;i.A.remove(r,"neo-is-dragging"),a.cls=r,t.dragProxy&&(t.dragPlaceholder&&(t.dragPlaceholder.destroy(),t.dragPlaceholder=null),t.destroyDragProxy(),t.dragProxy=null),Object.assign(t,{dragElementRect:null,dragStartIndex:null,offsetX:0,offsetY:0,scrollContainerId:null}),t.fire("dragEnd",e),t.resetData()}dragMove(e,t=!1){let a,r=this;r.moveInMainThread&&!t||!r.dragProxy||(a=r.dragProxy.style,r.moveHorizontal&&(a.left=e.clientX-r.offsetX+"px"),r.moveVertical&&(a.top=e.clientY-r.offsetY+"px"),r.dragProxy.style=a),r.fire("dragMove",e)}async dragStart(e){let t,a,r,n=this,{appName:o,owner:d,windowId:s}=n,{cls:l}=d,g=n.getDragElementRect(e);n.setData(),t=await Neo.main.addon.DragDrop.setConfigs({appName:o,windowId:s,...n.getMainThreadConfigs()}),n.boundaryContainerRect=t.boundaryContainerRect,i.A.add(l,"neo-is-dragging"),d.cls=l,a=e.clientX-g.left,r=e.clientY-g.top,Object.assign(n,{dragElementRect:g,offsetX:a,offsetY:r}),await n.createDragProxy(g),n.fire("dragStart",{clientX:e.clientX,clientY:e.clientY,dragElementRect:g,eventData:e,id:n.id,offsetX:a,offsetY:r})}getDragElementRect(e){let t=this.getDragElementRoot().id;for(let a of e.path)if(a.id===t)return a.rect;for(let a of e.targetPath)if(a.id===t)return a.rect;return null}getDragElementRoot(){return this.dragElement}getMainThreadConfigs(){let e=this;return{allowOverdrag:e.allowOverdrag,alwaysFireDragMove:e.alwaysFireDragMove,bodyCursorStyle:e.bodyCursorStyle,boundaryContainerId:e.boundaryContainerId,dragElementRootId:e.getDragElementRoot().id,dragProxyCls:e.dragProxyCls,dragZoneId:e.id,dropZoneIdentifier:e.dropZoneIdentifier,moveHorizontal:e.moveHorizontal,moveVertical:e.moveVertical,scrollContainerId:e.scrollContainerId,scrollFactorLeft:e.scrollFactorLeft,scrollFactorTop:e.scrollFactorTop}}onDrop(e){this.fire("drop",e)}onDropEnter(e){this.fire("drop:enter",e)}onDropLeave(e){this.fire("drop:leave",e)}resetData(){this.timeout(50).then(()=>{this.data=null})}setData(e={}){let t=this;t.data={dragElement:t.getDragElementRoot(),dragZoneId:t.id,...e}}}const g=Neo.setupClass(l)},2450(e,t,a){a.d(t,{A:()=>d});var r=a(1184),n=a(6282);class o extends r.A{static config={className:"Neo.draggable.DragProxyContainer",ntype:"dragproxycontainer",autoInitVnode:!0,autoMount:!0,baseCls:["neo-dragproxy"],layout:"fit",moveInMainThread:!0};afterSetMounted(e,t){if(super.afterSetMounted(e,t),e&&this.moveInMainThread){let{appName:e,id:t,windowId:a}=this;Neo.main.addon.DragDrop.setDragProxyElement({appName:e,id:t,windowId:a})}}afterSetWindowId(e,t){super.afterSetWindowId(e,t),e&&Neo.currentWorker.insertThemeFiles(e,n.A.prototype)}destroy(...e){this.items=[],super.destroy(...e)}}const d=Neo.setupClass(o)},4880(e,t,a){a.d(t,{A:()=>o});var r=a(3572);class n extends r.A{static config={className:"Neo.plugin.Base",ntype:"plugin",owner:null,windowId_:null};construct(e){super.construct(e);let t=this,{owner:a}=t;a.isConstructed?t.onOwnerConstructed():a.on("constructed",()=>{t.onOwnerConstructed()},t,{once:!0}),a.mounted?t.onOwnerMounted():a.on("mounted",t.onOwnerMounted,t)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}onOwnerConstructed(){let{owner:e}=this;e.windowId&&(this.windowId=e.windowId)}onOwnerMounted(){}}const o=Neo.setupClass(n)},6007(e,t,a){a.r(t),a.d(t,{default:()=>p});var r=a(4880),n=a(1692),o=a(6282),d=a(1753),i=a(1031),s=a(950);class l extends d.default{static config={className:"Neo.calendar.view.week.EventDragZone",addDragProxyCls:!1,enableResizingAcrossOppositeEdge:!0,axisEndTime:0,axisStartTime:0,columnHeight:0,columnTop:0,currentInterval:0,eventDuration:0,eventRecord:null,forceUpdate:!1,hasOverflow:!1,intervalSize:15,keepEndDate:!1,keepStartDate:!1,moveHorizontal:!1,moveInMainThread:!1,newEndDate:null,newStartDate:null,scrollFactorLeft:3,useProxyWrapper:!1};addBodyCursorCls(){Neo.applyDeltas(this.windowId,{id:"document.body",cls:{add:["neo-cursor-move"]}})}adjustEndDate(e){return 0===e.getHours()&&0===e.getMinutes()?e.setMinutes(e.getMinutes()-1):23===e.getHours()&&59===e.getMinutes()||e.getMinutes()%this.intervalSize===0||e.setMinutes(e.getMinutes()+1),e}afterSetProxyParentId(e,t){if(e&&void 0!==t){let t=this;t.dragProxy?.vdom.cn[0].id&&Neo.applyDeltas(t.windowId,{action:"moveNode",id:t.dragProxy.id,index:0,parentId:e})}}async createDragProxy(e,t=!0){let a=this,r=Neo.getComponent(a.getDragElementRoot().id)||a.owner,n=a.dragProxyConfig?.vdom,d=s.A.clone(n||a.dragElement);d.cn[2].removeDom=!1;const l={module:o.A,appName:a.appName,moveInMainThread:a.moveInMainThread,parentId:a.proxyParentId,windowId:a.windowId,...a.dragProxyConfig,vdom:a.useProxyWrapper?{cn:[d]}:d};return l.cls=l.cls||[],l.cls.push("neo-focus"),r&&l.cls.push(r.getTheme()),d.cls&&!a.useProxyWrapper&&l.cls.push(...d.cls),a.addDragProxyCls&&i.A.add(l.cls,a.dragProxyCls),Object.assign(l.style,{height:`${e.height}px`,top:e.y-a.columnTop+"px",width:`${e.width}px`}),t?a.dragProxy=Neo.create(l):l}dragEnd(e){super.dragEnd(e);let t,a,r=this,{owner:o}=r,d=r.eventRecord;r.keepStartDate?(t=r.newEndDate,a=r.newStartDate||d.startDate):(a=new Date(s.A.find(o.vdom,r.proxyParentId).vdom.flag+"T12:00:00.000Z"),a.setHours(r.axisStartTime),a.setMinutes(r.currentInterval*r.intervalSize),r.keepEndDate?(t=r.newEndDate||d.endDate,a=r.newStartDate||a):(t=n.A.clone(a),t.setMinutes(t.getMinutes()+r.eventDuration))),t=r.adjustEndDate(t),d.setSilent({endDate:t,startDate:a}),Object.assign(r,{currentInterval:0,hasOverflow:!1,keepEndDate:!1,keepStartDate:!1,newEndDate:null,newStartDate:null,proxyParentId:null}),o.getStateProvider().getStore("events").doSort(),o.updateEvents()}dragMove(e){let t,a,r,o,d,i,s,l,g,c,u,p,m,v,h=this,{axisEndTime:w,axisStartTime:y,columnHeight:D,eventDuration:f,intervalSize:x,keepEndDate:E,keepStartDate:I,owner:P}=h,C=0,M=e.targetPath,N=M.length,S=h.eventRecord,T=!1,{timeAxis:b}=P;if(h.dragProxy){if(!E&&!I)for(;C<N;C++)if(M[C].cls.includes("neo-c-w-column")){h.proxyParentId=M[C].id;break}if(g=60*(w-y)/x,l=D/g,p=Math.min(D,e.clientY-h.offsetY-h.columnTop),a=Math.floor(p/l),d=n.A.clone(S.endDate),m=n.A.clone(S.startDate),E&&y>m.getHours()&&(m.setHours(y),m.setMinutes(0),f=(d-m)/60/1e3),I&&w<d.getHours()&&(d.setHours(w),d.setMinutes(0),f=(d-m)/60/1e3),E||(a=Math.min(a,g-f/x)),r=[{id:h.dragProxy.id,style:{}}],E||I)if(t=n.A.clone(S.startDate),t.setHours(y),t.setMinutes(0),u=P.minimumEventDuration/x,v=(S.startDate-t)/x/60/1e3,E){if(c=v+f/x,h.enableResizingAcrossOppositeEdge){if(h.forceUpdate&&a>c-u&&a<c+u)return;a>=c+u?(T=!0,h.forceUpdate=!0,d.setHours(y),d.setMinutes(a*x),d=h.adjustEndDate(d),h.newEndDate=d,m.setHours(y),m.setMinutes(c*x),h.newStartDate=m,o=(d-m)/60/60/1e3,r[0].style.top=`calc(${c*l/D*100}% + 1px)`):(h.forceUpdate=!1,h.newStartDate=null)}T||(a=Math.min(a,c-u))}else if(I){if(c=v-f/x,h.enableResizingAcrossOppositeEdge)if(a=Math.max(-f/x,a),a<=c-u)T=!0,h.forceUpdate=!0,d.setHours(y),d.setMinutes(f+c*x),d=h.adjustEndDate(d),h.newEndDate=d,m.setHours(y),m.setMinutes(f+a*x),h.newStartDate=m,o=(d-m)/60/60/1e3,p=(f/x+a)*l,p=p/D*100,r[0].style.top=`calc(${p}% + 1px)`;else{if(h.forceUpdate&&a<c+u)return;h.forceUpdate&&a>=c+u&&h.currentInterval!==a&&(h.forceUpdate=!1,h.newStartDate=null,r[0].style.top=`calc(${v*l/D*100}% + 1px)`)}T||(a=Math.max(a,c+u))}I||(a=Math.max(0,a)),h.currentInterval!==a&&(T||(E||(d.setHours(y),d.setMinutes(f+a*x)),I?(h.newEndDate=d,o=(d-S.startDate)/60/60/1e3):(m.setHours(y),m.setMinutes(a*x),p=a*l,p=p/D*100,r[0].style.top=`calc(${p}% + 1px)`),E&&(o=(S.endDate-m)/60/60/1e3)),d=h.adjustEndDate(d),r.push({id:h.dragProxy.vdom.cn[2].id,textContent:P.intlFormat_time.format(d)}),(E||I)&&(s=Math.round(o/(w-y)*100*1e3)/1e3,r[0].style.height=`calc(${s}% - 2px)`),r.push({id:h.dragProxy.vdom.cn[0].id,textContent:P.intlFormat_time.format(m)}),h.dragProxy.vdom.cn[0].id&&(i=(o&&60*o||f)/b.interval,i<=2?b.rowHeight/i<25&&!h.hasOverflow&&(r.push({id:h.dragProxy.id,cls:{add:["neo-overflow"]}}),h.hasOverflow=!0):h.hasOverflow&&(r.push({id:h.dragProxy.id,cls:{remove:["neo-overflow"]}}),h.hasOverflow=!1),Neo.applyDeltas(h.windowId,r))),h.currentInterval=a}}async dragStart(e){let t=this,a=await t.owner.getDomRect([t.getDragElementRoot().id,e.path[1].id]),r=(t.eventRecord.endDate-t.eventRecord.startDate)/60/1e3,n=e.clientX-a[0].left,o=e.clientY-a[0].top;Object.assign(t,{columnHeight:a[1].height,columnTop:a[1].top,dragElementRect:a[0],eventDuration:Math.round(r/t.intervalSize)*t.intervalSize,offsetX:n,offsetY:o}),await t.createDragProxy(a[0]),t.fire("dragStart",{dragElementRect:a[0],id:t.id,offsetX:n,offsetY:o}),t.dragMove(e)}removeBodyCursorCls(){Neo.applyDeltas(this.windowId,{id:"document.body",cls:{remove:["neo-cursor-move"]}})}}const g=Neo.setupClass(l),c=Symbol.for("newRecordSymbol");class u extends r.A{static config={className:"Neo.calendar.view.week.plugin.DragDrop",ntype:"plugin-calendar-week-dragdrop",isDragging:!1,resizablePluginType:"calendar-week-eventresizable"};construct(e){super.construct(e);let t=this,a={scope:t,delegate:".neo-c-w-column"},r={scope:t,delegate:".neo-event"};t.owner.addDomListeners([{"drag:end":t.onColumnDragEnd,...a},{"drag:end":t.onEventDragEnd,...r},{"drag:move":t.onColumnDragMove,...a},{"drag:move":t.onEventDragMove,...r},{"drag:start":t.onColumnDragStart,...a},{"drag:start":t.onEventDragStart,...r}])}adjustResizeEvent(e){return e.path.shift(),e.targetPath.shift(),e.target=e.path[0],e}getEventDragZone(e){let{appName:t,owner:a,windowId:r}=this,{eventDragZone:n,timeAxis:o}=a,d={axisEndTime:o.getTime(a.endTime),axisStartTime:o.getTime(a.startTime),dragElement:e.dragElement,enableResizingAcrossOppositeEdge:e.enableResizingAcrossOppositeEdge,eventRecord:e.eventRecord,proxyParentId:e.proxyParentId};return n?n.set(d):a.eventDragZone=n=Neo.create({module:g,appName:t,owner:a,scrollContainerId:a.getScrollContainer().id,windowId:r,...d,dragProxyConfig:{style:{transition:"none",willChange:"height"}}}),n}isActiveCalendar(){let{owner:e}=this,{calendarStore:t}=e,a=e.data.activeCalendarId||t.getAt(0)[t.keyProperty];return t.get(a).active}isTopLevelColumn(e){return e[0].cls.includes("neo-c-w-column")}isTopLevelEvent(e){return e.path[0].cls.includes("neo-event")}onColumnDragEnd(e){let t=this,{owner:a}=t,r=t[c];r&&t.isTopLevelColumn(e.path)&&(t.isDragging=!1,delete t[c],Neo.applyDeltas(t.windowId,{id:a.getEventId(r.id),style:{opacity:1}}).then(()=>{a.eventDragZone.dragEnd(),a.getPlugin(t.resizablePluginType).onDragEnd(e)}))}onColumnDragMove(e){let t=this;t.isActiveCalendar()&&t.isTopLevelColumn(e.path)&&t.owner.eventDragZone?.dragMove(e)}async onColumnDragStart(e){let t=this;if(t.isActiveCalendar()&&t.isTopLevelColumn(e.targetPath)){let a,r,o,d,i,{owner:l}=t,g=l.timeAxis.getTime(l.startTime),{calendarStore:u}=l,p=e.path[0].rect,m=15,v=60*(l.timeAxis.getTime(l.endTime)-g)/m,h=p.height/v,w=Math.min(p.height,e.clientY-p.top),y=Math.floor(w/h),D=new Date(s.A.find(l.vdom,e.path[0].id).vdom.flag+"T12:00:00.000Z");t.isDragging=!0,D.setHours(g),D.setMinutes(Math.min(y*m,v*m-l.minimumEventDuration)),r=n.A.clone(D),r.setMinutes(r.getMinutes()+l.minimumEventDuration),0===r.getHours()&&0===r.getMinutes()&&r.setMinutes(r.getMinutes()-1),i=l.eventStore.add({calendarId:l.data.activeCalendarId||u.getAt(0)[u.keyProperty],endDate:r,startDate:D,title:"New Event"},!0)[0],t[c]=i,await t.timeout(50),d=l.getEventId(i.id),a=s.A.find(l.vdom,d).vdom,o=t.getEventDragZone({dragElement:a,enableResizingAcrossOppositeEdge:!0,eventRecord:i,proxyParentId:e.path[0].id}),l.getPlugin(t.resizablePluginType).onDragStart(e),await o.dragStart(e),await t.timeout(50),t.isDragging&&Neo.applyDeltas(t.windowId,{id:d,style:{opacity:0}})}}onEventDragEnd(e){let t=this,{owner:a}=t,{eventDragZone:r}=a;a.enableDrag&&(r.dragEnd(),t.isTopLevelEvent(e)?r.removeBodyCursorCls():(e=t.adjustResizeEvent(e),a.getPlugin(t.resizablePluginType).onDragEnd(e)),t.isDragging=!1)}onEventDragMove(e){let t=this,{owner:a}=t;a.enableDrag&&(t.isTopLevelEvent(e)||(e=t.adjustResizeEvent(e)),a.eventDragZone.dragMove(e))}onEventDragStart(e){let t=this,{owner:a}=t,r=a.data;if(a.enableDrag){let n,o,d=t.isTopLevelEvent(e);d||(e=t.adjustResizeEvent(e)),t.isDragging=!0,n=s.A.find(a.vdom,e.path[0].id).vdom,o=t.getEventDragZone({dragElement:n,enableResizingAcrossOppositeEdge:r.events.enableResizingAcrossOppositeEdge,eventRecord:a.eventStore.get(n.flag),proxyParentId:e.path[1].id}),d?o.addBodyCursorCls():a.getPlugin(t.resizablePluginType).onDragStart(e),o.dragStart(e)}}}const p=Neo.setupClass(u)},6282(e,t,a){a.d(t,{A:()=>o});var r=a(1741);class n extends r.A{static config={className:"Neo.draggable.DragProxyComponent",ntype:"dragproxy",autoInitVnode:!0,autoMount:!0,baseCls:["neo-dragproxy"],moveInMainThread:!0};afterSetMounted(e,t){if(super.afterSetMounted(e,t),e&&this.moveInMainThread){let{appName:e,id:t,windowId:a}=this;Neo.main.addon.DragDrop.setDragProxyElement({appName:e,id:t,windowId:a})}}}const o=Neo.setupClass(n)}}]);