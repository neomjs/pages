"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[5793],{5793(e,t,a){a.r(t),a.d(t,{default:()=>G});var n=a(1184),s=a(2167),i=a(23);const o=/^---\n([\s\S]*?)\n---\n/,r=/(<h1[^>]*>.*?<\/h1>)/,l=/(\d{4,})/,c=/## Timeline\s*\n([\s\S]*)/,d=/^- ([\dTZ:.-]+) @(\w+) (.*)$/,m=/\b([0-9a-f]{7,40})\b/g;class g extends s.A{static config={className:"Portal.view.news.tickets.Component",cls:["portal-news-tickets-component"],commitsUrl:"https://github.com/neomjs/neo/commit/",repoUserUrl:"https://github.com/",updateSectionsStore:!1};#e=null;#t=null;timelineData=null;construct(e){super.construct(e),this.getStateProvider().setData("contentComponentId",this.id)}formatTimestamp(e){if(!e)return"";let t=this,a=new Date(e),n=new Date;return a.toDateString()===n.toDateString()?(t.#t||(t.#t=new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric"})),t.#t.format(a)):(t.#e||(t.#e=new Intl.DateTimeFormat("default",{day:"numeric",hour:"numeric",minute:"numeric",month:"short",year:"numeric"})),t.#e.format(a))}frontMatterToHtml(e){let t=this,a='<table class="neo-frontmatter-table"><tbody>';return Object.entries(e).forEach(([e,n])=>{let s;s="subIssues"===e&&Array.isArray(n)?n.map(e=>`<div class="neo-sub-issue">${e.replace(l,'<a href="#/news/tickets/$1">$1</a>').replace("[x]",'<i class="fa-solid fa-circle-check"></i>').replace("[ ]",'<i class="fa-regular fa-circle"></i>')}</div>`).join(""):"author"===e?`<a href="${t.repoUserUrl}${n}" target="_blank">${n}</a>`:"createdAt"===e||"closedAt"===e||"updatedAt"===e?t.formatTimestamp(n):"labels"===e&&Array.isArray(n)?t.getBadgesHtml(n):"state"===e?t.getStateBadgeHtml(n):t.formatFrontMatterValue(n),a+=`<tr><td>${e}</td><td>${s}</td></tr>`}),a+="</tbody></table>",t.useFrontmatterDetails?`<details><summary>Frontmatter</summary>${a}</details>`:a}getBadgesHtml(e){if(!e||0===e.length)return"";let t=this,a='<div class="neo-ticket-labels">';return e.forEach(e=>{a+=t.getLabelBadgeHtml(e)}),a+="</div>",a}async doFetchContent(e){let t,a,n,s=this,{windowId:i}=s;n=s.getContentPath(e),e.isLeaf&&n&&(a=await fetch(n),t=await a.text(),s.value=t,s.toggleCls("lab",e.name?.startsWith("Lab:")),Neo.main.addon.IntersectionObserver.observe({disconnect:!0,id:s.id,observe:[".neo-timeline-item[data-record-id]"],windowId:i}))}getContentPath({path:e}){return e?Neo.config.basePath+e:null}getLabelBadgeHtml(e){let t=this.getStateProvider().getStore("labels").get(e);return t?`<span class="neo-badge" style="background-color:${t.color};color:${t.textColor}">${e}</span>`:`<span class="neo-badge">${e}</span>`}getStateBadgeHtml(e){if(!e)return"";let t="neo-badge neo-state-badge",a="fa-circle-dot";return"CLOSED"===e.toUpperCase()?(t+=" neo-state-closed",a="fa-circle-check"):t+=" neo-state-open",`<span class="${t}"><i class="fa-regular ${a}"></i>${Neo.capitalize(e.toLowerCase())}</span>`}modifyMarkdown(e){let t=this,{parentId:a}=t.record,n=null,s=null,i=[],l=null,d=e.match(o),m="",g="";if(t.timelineData=[],d){let e=t.parseFrontMatter(d[1]);e.author&&(n=e.author),e.createdAt&&(s=t.formatTimestamp(e.createdAt)),e.labels&&(i=e.labels),e.state&&(l=e.state)}let u=e.match(c);u&&(m=t.renderTimeline(u[1]),e=e.replace(c,""));let p="";if(d){let a=t.parseFrontMatter(d[1]);p=t.frontMatterToHtml(a),e=e.replace(o,"")}let f=super.modifyMarkdown(e),h="";if(f=f.replace(r,e=>(h=e.replace("<h1",`<h1 id="ticket-title-${t.id}"`),"")),i.length>0||l||a&&"Latest"!==a){if(g='<div class="neo-ticket-labels">',l&&(g+=t.getStateBadgeHtml(l)),a&&"Latest"!==a&&(g+=`\n                    <a class="neo-badge neo-release-badge" href="#/news/releases/${a.substring(1)}">\n                        <i class="fa-solid fa-code-branch"></i> ${a}\n                    </a>`),i.length>0){let e,a=t.getStateProvider().getStore("labels");i.forEach(t=>{e=a.get(t),g+=e?`<span class="neo-badge" style="background-color:${e.color};color:${e.textColor}">${t}</span>`:`<span class="neo-badge">${t}</span>`})}g+="</div>",h+=g}let v=`timeline-${t.record.id}-0`;t.timelineData.unshift({id:v,image:t.repoUserUrl+n+".png",name:"Description",tag:"body"});let w=`\n            <div id="${v}" class="neo-timeline-item comment body-item" data-record-id="${v}">\n                <div id="${v}-target" class="neo-timeline-avatar">\n                    <img src="${t.repoUserUrl}${n}.png" alt="${n}">\n                </div>\n                <div class="neo-timeline-content">\n                    <div class="neo-timeline-header">\n                        <a class="neo-timeline-user" href="${t.repoUserUrl}${n}" target="_blank">${n}</a>\n                        <span class="neo-timeline-date">commented on ${s}</span>\n                    </div>\n                    <div class="neo-timeline-body">${f}</div>\n                </div>\n            </div>`,y=`ticket-timeline-${t.id}`;return m=m?m.replace('<div class="neo-ticket-timeline">',`<div id="${y}" class="neo-ticket-timeline">`+w):`<div id="${y}" class="neo-ticket-timeline">${w}</div>`,t.getStateProvider().getStore("sections").data=t.timelineData,t.timelineData=null,p+h+m}renderTimeline(e){let t,a,n,s,o,r=this,{commitsUrl:l,repoUserUrl:c}=r,g='<div class="neo-ticket-timeline">',u=e.split("\n"),p=[],f=null,h=null,v=0,w=u.length;const y=()=>{if(p.length>0){t=`timeline-${r.record.id}-${r.timelineData.length+1}`,r.timelineData.push({id:t,image:c+f+".png",name:`Comment (${f})`,tag:"comment"});let e=i.xI.parse(p.join("\n"));g+=`\n                    <div id="${t}" class="neo-timeline-item comment" data-record-id="${t}">\n                        <div id="${t}-target" class="neo-timeline-avatar">\n                            <img src="${c}${f}.png" alt="${f}">\n                        </div>\n                        <div class="neo-timeline-content">\n                            <div class="neo-timeline-header">\n                                <a class="neo-timeline-user" href="${c}${f}" target="_blank">${f}</a>\n                                <span class="neo-timeline-date">${r.formatTimestamp(h)}</span>\n                            </div>\n                            <div class="neo-timeline-body">${e}</div>\n                        </div>\n                    </div>`,p=[],f=null,h=null}};for(;v<w;v++)if(a=u[v],n=a.match(d)){y();let[e,a,d,u]=n;s="fa-circle-dot",o="";const p=[{key:"added the `",icon:"fa-tag"},{key:"removed the `",icon:"fa-tag"},{key:"assigned",icon:"fa-user-pen"},{key:"closed",icon:"fa-circle-check",color:"#8250df"},{key:"reopened",icon:"fa-circle-dot",color:"#2da44e"},{key:"referenced",icon:"fa-link"},{key:"cross-referenced",icon:"fa-link"},{key:"milestoned",icon:"fa-sign-post"},{key:"sub-issue",icon:"fa-diagram-project"}].find(e=>u.includes(e.key));let f=null;p&&(s=p.icon,p.color&&(f=p.color));let h=i.xI.parseInline(u);if("fa-tag"===s){h=h.replace(/<code>(.*?)<\/code>/g,(e,t)=>r.getLabelBadgeHtml(t));let e=u.match(/`([^`]+)`/);if(e){let t=e[1],a=r.getStateProvider().getStore("labels").get(t);a&&(f=a.color)}}h=h.replace(m,`<a href="${l}$1" target="_blank">$1</a>`),t=`timeline-${r.record.id}-${r.timelineData.length+1}`;let v=u.split(" ")[0];if("added"===v||"removed"===v){let e=u.match(/`([^`]+)`/);v=e?e[1]:"Label"}r.timelineData.push({color:f,icon:s,id:t,name:`${Neo.capitalize(v)} (${d})`,tag:"event"}),g+=`\n                    <div id="${t}" class="neo-timeline-item event" data-record-id="${t}">\n                        <div id="${t}-target" class="neo-timeline-badge" ${f?`style="color: ${f}"`:""}><i class="fa-solid ${s}"></i></div>\n                        <div class="neo-timeline-body">\n                            <a class="neo-timeline-user" href="${c}${d}" target="_blank">${d}</a> ${h} <span class="neo-timeline-date">on ${r.formatTimestamp(a)}</span>\n                        </div>\n                    </div>`}else if(a.startsWith("### @")){let e=a.match(/^### @(\w+) - ([\dTZ:.-]+)$/);e?(y(),f=e[1],h=e[2]):f&&p.push(a)}else f&&p.push(a);return y(),g+="</div>",g}}const u=Neo.setupClass(g);var p=a(8829);class f extends p.A{static config={className:"Portal.view.news.tickets.TimelineCanvas",listeners:{resize:"onResize"},_vdom:{tag:"div",cls:["neo-ticket-timeline-wrapper"],style:{width:"100%",height:"100%"},cn:[{tag:"canvas",style:{width:"100%",height:"100%"}}]}};canvasId=null;isCanvasReady=!1;lastRecords=null;onConstructed(){super.onConstructed();let e=this;e.getStateProvider().getStore("sections").on("load",e.onTimelineDataLoad,e)}async afterSetOffscreenRegistered(e,t){let a=this;if(e){await Portal.canvas.Helper.importTicketCanvas(),await Portal.canvas.TicketCanvas.initGraph({canvasId:a.getCanvasId(),windowId:a.windowId}),a.isCanvasReady=!0,Neo.main.addon.ResizeObserver.register({id:a.id,windowId:a.windowId}),await a.updateSize();let e=a.getStateProvider().getStore("sections");e.getCount()>0&&a.onTimelineDataLoad(e.items)}else t&&(a.isCanvasReady=!1,await Portal.canvas.TicketCanvas.clearGraph())}getCanvasId(){let e=this;return e.canvasId||(e.canvasId=e.vdom.cn[0].id),e.canvasId}async onResize(e){let t=this;await t.updateSize(e.contentRect),t.lastRecords&&t.onTimelineDataLoad(t.lastRecords,!0)}async onTimelineDataLoad(e,t=!1){let a=this;if(e&&!Array.isArray(e)&&e.items&&(e=e.items),!Array.isArray(e))return;if(!a.isCanvasReady)return;a.lastRecords=e;let n,s,i=e.map(e=>`${e.id}-target`),o=a.getStateProvider().getData("contentComponentId"),r=`ticket-timeline-${o}`;try{if(n=await a.waitForDomRect({attempts:20,delay:50,id:i}),a.lastRecords!==e)return;if(o&&(s=await a.getDomRect(r)),!n||!n.some(e=>e))return;t||await a.updateSize();let l=await a.getDomRect(a.getCanvasId()),c=[],d=0;i.forEach((t,a)=>{let s=n[a],i=e[a];if(s){let e=s.height/2,t=s.y-l.y+e,n=s.x-l.x+s.width/2,o=s.height>32?6:3;c.push({color:i.color,id:i.id,radius:e+o,y:t,x:n}),0===a&&(d=t)}}),await Portal.canvas.TicketCanvas.updateGraphData({nodes:c,reset:!t,startY:d})}catch(e){console.error("TimelineCanvas update failed",e)}}async updateSize(e){e&&0!==e.width&&0!==e.height||(e=await this.waitForDomRect({id:this.getCanvasId()})),await Portal.canvas.TicketCanvas.updateSize({width:e.width,height:e.height})}}const h=Neo.setupClass(f);class v extends n.A{static config={className:"Portal.view.news.tickets.CanvasWrapper",cls:["portal-canvas-wrapper"],contentComponent:u,layout:null,style:{minHeight:"100%",overflow:"visible",position:"relative"}};construct(e){let t=this;e.items=[{module:h,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2,pointerEvents:"none"}},{module:e.contentComponent||t.contentComponent,style:{position:"relative",zIndex:1},listeners:{edit:t.onContentEdit,refresh:t.onContentRefresh,scope:t}}],super.construct(e)}onContentEdit(e){this.fire("edit",e)}onContentRefresh(e){this.fire("refresh",e)}}const w=Neo.setupClass(v);var y=a(3997);class C extends y.A{static config={className:"Portal.view.news.tickets.MainContainerController",routes:{"/news/tickets":"onRouteDefault","/news/tickets/{*itemId}":"onRouteItem"}};navigateTo(e){Neo.Main.setRoute({value:`/news/tickets/${e}`,windowId:this.component.windowId})}onContentEdit(e){}onContentRefresh(e){this.getReference("tree").doFetchContent(e.record)}onIntersect(e){let t,a=this.getReference("page-sections-container").list,n=e.data.recordId;n&&!a.isAnimating&&(t=a.store.get(n),t&&a.selectionModel.select(t))}onNextPageButtonClick(e){this.navigateTo(this.getStateProvider().getData("nextPageRecord").id)}onPageSectionsToggleButtonClick(e){this.getReference("page-sections-container").toggleCls("neo-expanded")}onPreviousPageButtonClick(e){this.navigateTo(this.getStateProvider().getData("previousPageRecord").id)}onRouteDefault(e){let t=this,a=t.getStateProvider().getStore("tree");a.getCount()>0?t.navigateTo(a.getAt(1).id):a.on({load:()=>t.navigateTo(a.getAt(1).id),delay:10,once:!0})}async onRouteItem({itemId:e},t,a){let n=this.getStateProvider(),s=n.getStore("tree"),i=this.getReference("tree");"/news/tickets"!==i.routePrefix&&(i.routePrefix="/news/tickets");const o=async()=>{if(n.data.currentPageRecord=s.get(e),i.expandParents(e),!a?.hashString?.startsWith("/news/tickets")){const t=i.getItemId(e);await i.waitForDomRect({id:t,attempts:20,delay:20})&&i.scrollToItem(e)}};s.getCount()>0?await o():s.on({load:o,delay:10,once:!0})}onSideNavToggleButtonClick(e){this.getReference("sidenav-container").toggleCls("neo-expanded")}}const $=Neo.setupClass(C);var k=a(6728);class b extends k.A{static config={className:"Portal.view.news.tickets.PageContainer",layout:null,style:{flex:1,overflowY:"auto",position:"relative"}}}const S=Neo.setupClass(b);var I=a(5513),P=a(1967);class T extends P.A{static config={className:"Portal.model.TicketLabel",fields:[{name:"color",type:"String"},{name:"description",type:"String"},{name:"name",type:"String"},{name:"textColor",type:"String"}]}}const R=Neo.setupClass(T);var N=a(2779);class D extends N.A{static config={className:"Portal.store.TicketLabels",keyProperty:"name",model:R,url:"../../apps/portal/resources/data/labels.json"}}const x=Neo.setupClass(D);var A=a(9045),L=a(8938);class F extends L.A{static config={className:"Portal.model.TicketTimelineSection",fields:[{name:"color",type:"String"},{name:"icon",type:"String"},{name:"image",type:"String"},{name:"sourceId",type:"String"}]}}const H=Neo.setupClass(F);class z extends A.A{static config={className:"Portal.store.TicketTimelineSections",model:H}}const U=Neo.setupClass(z);class B extends P.A{static config={className:"Portal.model.Ticket",fields:[{name:"collapsed",type:"Boolean",defaultValue:!0},{name:"id",type:"String"},{name:"isLeaf",type:"Boolean",defaultValue:!0},{name:"parentId",type:"String",defaultValue:null},{name:"path",type:"String"},{name:"title",type:"String"},{name:"treeNodeName",type:"html",calculate:({id:e,isLeaf:t,title:a})=>t?`<b>${e}</b> ${a}`:e}]}}const M=Neo.setupClass(B);class _ extends N.A{static config={className:"Portal.store.Tickets",model:M,url:"../../apps/portal/resources/data/tickets.json"}}const j=Neo.setupClass(_);var E=a(9943);class O extends E.A{static config={className:"Portal.view.news.tickets.MainContainerStateProvider",data:{countPages:null,countSections:null,currentPageRecord:null,nextPageRecord:null,previousPageRecord:null},stores:{labels:{autoLoad:!0,module:x},sections:{module:U},tree:{autoLoad:!0,module:j}}};onDataPropertyChange(e,t,a){super.onDataPropertyChange(e,t,a);let n=this;switch(e){case"countSections":t<1&&n.component.getReference("page-sections-container")?.toggleCls("neo-expanded",!1);break;case"currentPageRecord":{let e,a,{data:s}=n,{countPages:i}=s,o=n.getStore("tree"),r=o.indexOf(t),l=null,c=null;for(e=r-1;e>=0;e--)if(a=o.getAt(e),a.isLeaf&&!n.recordIsHidden(a,o)){c=a;break}for(n.setData({previousPageRecord:c}),e=r+1;e<i;e++)if(a=o.getAt(e),a.isLeaf&&!n.recordIsHidden(a,o)){l=a;break}n.setData({nextPageRecord:l}),n.component.getReference("sidenav-container")?.toggleCls("neo-expanded",!1);break}}}recordIsHidden(e,t){return!!e.hidden||null!==e.parentId&&this.recordIsHidden(t.get(e.parentId),t)}}const W=Neo.setupClass(O);class V extends I.A{static config={className:"Portal.view.news.tickets.MainContainer",cls:["portal-tickets-maincontainer"],controller:$,pageContainerConfig:{module:S,buttonTextField:"id",contentConfig:{module:w}},stateProvider:W,treeConfig:{displayField:"treeNodeName"}}}const G=Neo.setupClass(V)},8829(e,t,a){a.d(t,{A:()=>i});var n=a(1741);class s extends n.A{static config={className:"Neo.component.Canvas",ntype:"canvas",monitorSize_:!0,offscreen:!0,offscreenRegistered_:!1,_vdom:{tag:"canvas"}};async afterSetMounted(e,t){super.afterSetMounted(e,t);let a=this,n=a.getCanvasId(),{offscreen:s}=a;if(e){if(await a.timeout(30),a.monitorSize&&a.addDomListeners([{delegate:`#${a.getCanvasId()}`,resize:a.onDomResize,scope:a}]),s){const e=await Neo.main.DomAccess.getOffscreenCanvas({nodeId:n,windowId:a.windowId});e.offscreen?(await Neo.worker.Canvas.registerCanvas({node:e.offscreen,nodeId:n,windowId:a.windowId},[e.offscreen]),a.offscreenRegistered=!0):e.transferred&&Neo.config.useSharedWorkers&&(await Neo.worker.Canvas.retrieveCanvas({nodeId:n,windowId:a.windowId})).hasCanvas&&(a.offscreenRegistered=!0)}}else s&&(a.offscreenRegistered=!1)}afterSetWindowId(e,t){t&&(this.offscreenRegistered=!1)}getCanvasId(){return this.id}onDomResize(e){this.fire("resize",e)}}const i=Neo.setupClass(s)}}]);