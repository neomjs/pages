"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[5793],{5793(e,t,a){a.r(t),a.d(t,{default:()=>G});var n=a(1184),i=a(2167),s=a(23);const o=/^---\n([\s\S]*?)\n---\n/,l=/(<h1[^>]*>.*?<\/h1>)/,r=/(\d{4,})/,c=/## Timeline\s*\n([\s\S]*)/,d=/^- ([\dTZ:.-]+) @(\w+) (.*)$/,m=/\b([0-9a-f]{7,40})\b/g;class g extends i.A{static config={className:"Portal.view.news.tickets.Component",cls:["portal-news-tickets-component"],commitsUrl:"https://github.com/neomjs/neo/commit/",domListeners:{resize:"onResize"},repoUserUrl:"https://github.com/",updateSectionsStore:!1};#e=null;#t=null;timelineData=null;construct(e){super.construct(e),this.getStateProvider().setData("contentComponentId",this.id)}formatTimestamp(e){if(!e)return"";let t=this,a=new Date(e),n=new Date;return a.toDateString()===n.toDateString()?(t.#t||(t.#t=new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric"})),t.#t.format(a)):(t.#e||(t.#e=new Intl.DateTimeFormat("default",{day:"numeric",hour:"numeric",minute:"numeric",month:"short",year:"numeric"})),t.#e.format(a))}frontMatterToHtml(e){let t=this,a='<table class="neo-frontmatter-table"><tbody>';return Object.entries(e).forEach(([e,n])=>{let i;i="subIssues"===e&&Array.isArray(n)?n.map(e=>`<div class="neo-sub-issue">${e.replace(r,'<a href="#/news/tickets/$1">$1</a>').replace("[x]",'<i class="fa-solid fa-circle-check"></i>').replace("[ ]",'<i class="fa-regular fa-circle"></i>')}</div>`).join(""):"author"===e?`<a href="${t.repoUserUrl}${n}" target="_blank">${n}</a>`:"createdAt"===e||"closedAt"===e||"updatedAt"===e?t.formatTimestamp(n):"labels"===e&&Array.isArray(n)?t.getBadgesHtml(n):"state"===e?t.getStateBadgeHtml(n):t.formatFrontMatterValue(n),a+=`<tr><td>${e}</td><td>${i}</td></tr>`}),a+="</tbody></table>",t.useFrontmatterDetails?`<details id="neo-ticket-summary-details-${t.id}"><summary>Frontmatter</summary>${a}</details>`:a}getBadgesHtml(e){if(!e||0===e.length)return"";let t=this,a='<div class="neo-ticket-labels">';return e.forEach(e=>{a+=t.getLabelBadgeHtml(e)}),a+="</div>",a}async doFetchContent(e){let t,a,n,i=this,{windowId:s}=i;n=i.getContentPath(e),e.isLeaf&&n&&(a=await fetch(n),t=await a.text(),i.value=t,i.toggleCls("lab",e.name?.startsWith("Lab:")),Neo.main.addon.IntersectionObserver.observe({disconnect:!0,id:i.id,observe:[".neo-timeline-item[data-record-id]"],windowId:s}))}getContentPath({path:e}){return e?Neo.config.basePath+e:null}getLabelBadgeHtml(e){let t=this.getStateProvider().getStore("labels").get(e);return t?`<span class="neo-badge" style="background-color:${t.color};color:${t.textColor}">${e}</span>`:`<span class="neo-badge">${e}</span>`}getStateBadgeHtml(e){if(!e)return"";let t="neo-badge neo-state-badge",a="fa-circle-dot";return"CLOSED"===e.toUpperCase()?(t+=" neo-state-closed",a="fa-circle-check"):t+=" neo-state-open",`<span class="${t}"><i class="fa-regular ${a}"></i>${Neo.capitalize(e.toLowerCase())}</span>`}modifyMarkdown(e){let t=this,{parentId:a}=t.record,n=null,i=null,s=[],r=null,d=e.match(o),m="",g="";if(t.timelineData=[],d){let e=t.parseFrontMatter(d[1]);e.author&&(n=e.author),e.createdAt&&(i=t.formatTimestamp(e.createdAt)),e.labels&&(s=e.labels),e.state&&(r=e.state)}let u=e.match(c);u&&(m=t.renderTimeline(u[1]),e=e.replace(c,""));let p="";if(d){let a=t.parseFrontMatter(d[1]);p=t.frontMatterToHtml(a),e=e.replace(o,"")}let f=super.modifyMarkdown(e),h="";if(f=f.replace(l,e=>(h=e.replace("<h1",`<h1 id="ticket-title-${t.id}"`),"")),s.length>0||r||a&&"Backlog"!==a){if(g='<div class="neo-ticket-labels">',r&&(g+=t.getStateBadgeHtml(r)),a&&"Backlog"!==a&&(g+=`\n                    <a class="neo-badge neo-release-badge" href="#/news/releases/${a.substring(1)}">\n                        <i class="fa-solid fa-code-branch"></i> ${a}\n                    </a>`),s.length>0){let e,a=t.getStateProvider().getStore("labels");s.forEach(t=>{e=a.get(t),g+=e?`<span class="neo-badge" style="background-color:${e.color};color:${e.textColor}">${t}</span>`:`<span class="neo-badge">${t}</span>`})}g+="</div>",h+=g}let v=`timeline-${t.record.id}-0`;t.timelineData.unshift({id:v,image:t.repoUserUrl+n+".png",name:"Description",tag:"body"});let y=`\n            <div id="${v}" class="neo-timeline-item comment body-item" data-record-id="${v}">\n                <div id="${v}-target" class="neo-timeline-avatar">\n                    <img src="${t.repoUserUrl}${n}.png" alt="${n}">\n                </div>\n                <div class="neo-timeline-content">\n                    <div class="neo-timeline-header">\n                        <a class="neo-timeline-user" href="${t.repoUserUrl}${n}" target="_blank">${n}</a>\n                        <span class="neo-timeline-date">commented on ${i}</span>\n                    </div>\n                    <div class="neo-timeline-body">${f}</div>\n                </div>\n            </div>`,$=`ticket-timeline-${t.id}`;return m=m?m.replace('<div class="neo-ticket-timeline">',`<div id="${$}" class="neo-ticket-timeline">`+y):`<div id="${$}" class="neo-ticket-timeline">${y}</div>`,t.getStateProvider().getStore("sections").data=t.timelineData,t.timelineData=null,p+h+m}onResize(e){this.fire("toggleSummary")}renderTimeline(e){let t,a,n,i,o,l=this,{commitsUrl:r,repoUserUrl:c}=l,g='<div class="neo-ticket-timeline">',u=e.split("\n"),p=[],f=null,h=null,v=0,y=u.length;const $=()=>{if(p.length>0){t=`timeline-${l.record.id}-${l.timelineData.length+1}`,l.timelineData.push({id:t,image:c+f+".png",name:`Comment (${f})`,tag:"comment"});let e=s.xI.parse(p.join("\n"));g+=`\n                    <div id="${t}" class="neo-timeline-item comment" data-record-id="${t}">\n                        <div id="${t}-target" class="neo-timeline-avatar">\n                            <img src="${c}${f}.png" alt="${f}">\n                        </div>\n                        <div class="neo-timeline-content">\n                            <div class="neo-timeline-header">\n                                <a class="neo-timeline-user" href="${c}${f}" target="_blank">${f}</a>\n                                <span class="neo-timeline-date">${l.formatTimestamp(h)}</span>\n                            </div>\n                            <div class="neo-timeline-body">${e}</div>\n                        </div>\n                    </div>`,p=[],f=null,h=null}};for(;v<y;v++)if(a=u[v],n=a.match(d)){$();let[e,a,d,u]=n;i="fa-circle-dot",o="";const p=[{key:"added the `",icon:"fa-tag"},{key:"removed the `",icon:"fa-tag"},{key:"assigned",icon:"fa-user-pen"},{key:"closed",icon:"fa-circle-check",color:"#8250df"},{key:"reopened",icon:"fa-circle-dot",color:"#2da44e"},{key:"referenced",icon:"fa-link"},{key:"cross-referenced",icon:"fa-link"},{key:"milestoned",icon:"fa-sign-post"},{key:"sub-issue",icon:"fa-diagram-project"}].find(e=>u.includes(e.key));let f=null;p&&(i=p.icon,p.color&&(f=p.color));let h=s.xI.parseInline(u);if("fa-tag"===i){h=h.replace(/<code>(.*?)<\/code>/g,(e,t)=>l.getLabelBadgeHtml(t));let e=u.match(/`([^`]+)`/);if(e){let t=e[1],a=l.getStateProvider().getStore("labels").get(t);a&&(f=a.color)}}h=h.replace(m,`<a href="${r}$1" target="_blank">$1</a>`),t=`timeline-${l.record.id}-${l.timelineData.length+1}`;let v,y=u.split(" ")[0];if("added"===y||"removed"===y)if(u.includes("sub-issue")){let e=u.match(/#(\d+)/);v=e?`${Neo.capitalize(y)} sub-issue #${e[1]}`:`${Neo.capitalize(y)} sub-issue`}else{let e=u.match(/`([^`]+)`/);y=e?e[1]:"Label",v=`${Neo.capitalize(y)} (${d})`}else v=`${Neo.capitalize(y)} (${d})`;l.timelineData.push({color:f,icon:i,id:t,name:v,tag:"event"}),g+=`\n                    <div id="${t}" class="neo-timeline-item event" data-record-id="${t}">\n                        <div id="${t}-target" class="neo-timeline-badge" ${f?`style="color: ${f}"`:""}><i class="fa-solid ${i}"></i></div>\n                        <div class="neo-timeline-body">\n                            <a class="neo-timeline-user" href="${c}${d}" target="_blank">${d}</a> ${h} <span class="neo-timeline-date">on ${l.formatTimestamp(a)}</span>\n                        </div>\n                    </div>`}else if(a.startsWith("### @")){let e=a.match(/^### @(\w+) - ([\dTZ:.-]+)$/);e?($(),f=e[1],h=e[2]):f&&p.push(a)}else f&&p.push(a);return $(),g+="</div>",g}}const u=Neo.setupClass(g);var p=a(8829);class f extends p.A{static delayable={ensureFinalAlignment:{type:"debounce",timer:300}};static config={className:"Portal.view.news.tickets.TimelineCanvas",listeners:{resize:"onResize"},_vdom:{tag:"div",cls:["neo-ticket-timeline-wrapper"],style:{width:"100%",height:"100%"},cn:[{tag:"canvas",style:{width:"100%",height:"100%"}}]}};canvasId=null;isCanvasReady=!1;lastRecords=null;ensureFinalAlignment(){let e=this;e.lastRecords&&e.onTimelineDataLoad(e.lastRecords,!0)}async afterSetOffscreenRegistered(e,t){let a=this;if(e){await Portal.canvas.Helper.importTicketCanvas(),await Portal.canvas.TicketCanvas.initGraph({canvasId:a.getCanvasId(),windowId:a.windowId}),a.isCanvasReady=!0,Neo.main.addon.ResizeObserver.register({id:a.id,windowId:a.windowId}),await a.updateSize();let e=a.getStateProvider().getStore("sections");e.getCount()>0&&a.onTimelineDataLoad(e.items)}else t&&(a.isCanvasReady=!1,await Portal.canvas.TicketCanvas.clearGraph())}getCanvasId(){let e=this;return e.canvasId||(e.canvasId=e.vdom.cn[0].id),e.canvasId}onConstructed(){super.onConstructed();let e=this;e.getStateProvider().getStore("sections").on("load",e.onTimelineDataLoad,e)}async onResize(e){let t=this;await t.updateSize(e.contentRect),t.lastRecords&&(await t.onTimelineDataLoad(t.lastRecords,!0),t.ensureFinalAlignment())}async onTimelineDataLoad(e,t=!1){let a=this;if(e&&!Array.isArray(e)&&e.items&&(e=e.items),!Array.isArray(e))return;if(!a.isCanvasReady)return;let n=!t;n&&a.lastRecords&&e[0]?.id===a.lastRecords[0]?.id&&(n=!1),a.lastRecords=e;let i,s=e.map(e=>`${e.id}-target`);try{if(i=await a.waitForDomRect({attempts:20,delay:50,id:s}),a.lastRecords!==e)return;if(!i||!i.some(e=>e))return;t||await a.updateSize();let o=await a.getDomRect(a.getCanvasId()),l=[],r=0;s.forEach((t,a)=>{let n=i[a],s=e[a];if(n){let e=n.height/2,t=n.y-o.y+e,i=n.x-o.x+n.width/2,c=n.height>32?6:3;l.push({color:s.color,id:s.id,radius:e+c,y:t,x:i}),0===a&&(r=t)}}),await Portal.canvas.TicketCanvas.updateGraphData({nodes:l,reset:n,startY:r})}catch(e){console.error("TimelineCanvas update failed",e)}}async updateSize(e){e&&0!==e.width&&0!==e.height||(e=await this.waitForDomRect({id:this.getCanvasId()})),await Portal.canvas.TicketCanvas.updateSize({width:e.width,height:e.height})}}const h=Neo.setupClass(f);class v extends n.A{static config={className:"Portal.view.news.tickets.CanvasWrapper",cls:["portal-canvas-wrapper"],contentComponent:u,layout:null,style:{minHeight:"100%",overflow:"visible",position:"relative"}};construct(e){let t=this;e.items=[{module:h,reference:"timeline-canvas",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2,pointerEvents:"none"}},{module:e.contentComponent||t.contentComponent,style:{position:"relative",zIndex:1},listeners:{toggleSummary:t.onToggleSummary,scope:t}}],super.construct(e)}onToggleSummary(){let e=this.getReference("timeline-canvas");e?.lastRecords&&e.onTimelineDataLoad(e.lastRecords,!0)}}const y=Neo.setupClass(v);var $=a(3997);class w extends $.A{static config={className:"Portal.view.news.tickets.MainContainerController",routes:{"/news/tickets":"onRouteDefault","/news/tickets/{*itemId}":"onRouteItem"}};navigateTo(e){Neo.Main.setRoute({value:`/news/tickets/${e}`,windowId:this.component.windowId})}onIntersect(e){let t,a=this.getReference("page-sections-container").list,n=e.data.recordId;n&&!a.isAnimating&&(t=a.store.get(n),t&&a.selectionModel.select(t))}onNextPageButtonClick(e){this.navigateTo(this.getStateProvider().getData("nextPageRecord").id)}onPageSectionsToggleButtonClick(e){this.getReference("page-sections-container").toggleCls("neo-expanded")}onPreviousPageButtonClick(e){this.navigateTo(this.getStateProvider().getData("previousPageRecord").id)}getDefaultRouteId(){let e,t=this.getStateProvider().getStore("tree"),a=0,n=0,i=t.getCount();for(;n<i;n++)if(e=t.getAt(n),null===e.parentId&&(a++,2===a))return t.getAt(n+1)?.id;return t.getAt(1)?.id}onRouteDefault(e){let t=this,a=t.getStateProvider().getStore("tree");a.getCount()>0?t.navigateTo(t.getDefaultRouteId()):a.on({load:()=>t.navigateTo(t.getDefaultRouteId()),delay:10,once:!0})}async onRouteItem({itemId:e},t,a){let n=this.getStateProvider(),i=n.getStore("tree"),s=this.getReference("tree");"/news/tickets"!==s.routePrefix&&(s.routePrefix="/news/tickets");const o=async()=>{n.data.currentPageRecord=i.get(e),a?.hashString?.startsWith("/news/tickets")?s.expandParents(e):await s.expandAndScrollToItem(e)};i.getCount()>0?await o():i.on({load:o,delay:10,once:!0})}onSideNavToggleButtonClick(e){this.getReference("sidenav-container").toggleCls("neo-expanded")}}const k=Neo.setupClass(w);var b=a(6728);class C extends b.A{static config={className:"Portal.view.news.tickets.PageContainer",layout:null,style:{flex:1,overflowY:"auto",position:"relative"}}}const S=Neo.setupClass(C);var T=a(5513),P=a(1967);class R extends P.A{static config={className:"Portal.model.TicketLabel",fields:[{name:"color",type:"String"},{name:"description",type:"String"},{name:"name",type:"String"},{name:"textColor",type:"String"}]}}const I=Neo.setupClass(R);var N=a(2779);class x extends N.A{static config={className:"Portal.store.TicketLabels",keyProperty:"name",model:I,url:"../../apps/portal/resources/data/labels.json"}}const D=Neo.setupClass(x);var A=a(9045),F=a(8938);class L extends F.A{static config={className:"Portal.model.TicketTimelineSection",fields:[{name:"color",type:"String"},{name:"icon",type:"String"},{name:"image",type:"String"},{name:"sourceId",type:"String"}]}}const H=Neo.setupClass(L);class z extends A.A{static config={className:"Portal.store.TicketTimelineSections",model:H}}const B=Neo.setupClass(z);class U extends P.A{static config={className:"Portal.model.Ticket",fields:[{name:"collapsed",type:"Boolean",defaultValue:!0},{name:"id",type:"String"},{name:"isLeaf",type:"Boolean",defaultValue:!0},{name:"parentId",type:"String",defaultValue:null},{name:"path",type:"String"},{name:"title",type:"String"},{name:"treeNodeName",type:"html",calculate:({id:e,isLeaf:t,title:a})=>t?`<b>${e}</b> ${a}`:e}]}}const M=Neo.setupClass(U);class j extends N.A{static config={className:"Portal.store.Tickets",model:M,url:"../../apps/portal/resources/data/tickets.json"}}const _=Neo.setupClass(j);var E=a(9943);class O extends E.A{static config={className:"Portal.view.news.tickets.MainContainerStateProvider",data:{countPages:null,countSections:null,currentPageRecord:null,nextPageRecord:null,previousPageRecord:null},stores:{labels:{autoLoad:!0,module:D},sections:{module:B},tree:{autoLoad:!0,module:_}}};onDataPropertyChange(e,t,a){super.onDataPropertyChange(e,t,a);let n=this;switch(e){case"countSections":t<1&&n.component.getReference("page-sections-container")?.toggleCls("neo-expanded",!1);break;case"currentPageRecord":{let e,a,{data:i}=n,{countPages:s}=i,o=n.getStore("tree"),l=o.indexOf(t),r=null,c=null;for(e=l-1;e>=0;e--)if(a=o.getAt(e),a.isLeaf&&!n.recordIsHidden(a,o)){c=a;break}for(n.setData({previousPageRecord:c}),e=l+1;e<s;e++)if(a=o.getAt(e),a.isLeaf&&!n.recordIsHidden(a,o)){r=a;break}n.setData({nextPageRecord:r}),n.component.getReference("sidenav-container")?.toggleCls("neo-expanded",!1);break}}}recordIsHidden(e,t){return!!e.hidden||null!==e.parentId&&this.recordIsHidden(t.get(e.parentId),t)}}const V=Neo.setupClass(O);class W extends T.A{static config={className:"Portal.view.news.tickets.MainContainer",cls:["portal-tickets-maincontainer"],controller:k,pageContainerConfig:{module:S,buttonTextField:"id",contentConfig:{module:y}},stateProvider:V,treeConfig:{displayField:"treeNodeName"}}}const G=Neo.setupClass(W)}}]);