"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[6707,8352],{6707:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var r=a(4367),n=a(8987),o=a(9431),s=a(8352),i=a(6270),d=a(825);class l extends s.default{static config={className:"Neo.calendar.view.week.EventDragZone",addDragProxyCls:!1,enableResizingAcrossOppositeEdge:!0,axisEndTime:0,axisStartTime:0,columnHeight:0,columnTop:0,currentInterval:0,eventDuration:0,eventRecord:null,forceUpdate:!1,hasOverflow:!1,intervalSize:15,keepEndDate:!1,keepStartDate:!1,moveHorizontal:!1,moveInMainThread:!1,newEndDate:null,newStartDate:null,scrollFactorLeft:3,useProxyWrapper:!1};addBodyCursorCls(){Neo.applyDeltas(this.appName,{id:"document.body",cls:{add:["neo-cursor-move"]}})}adjustEndDate(e){return 0===e.getHours()&&0===e.getMinutes()?e.setMinutes(e.getMinutes()-1):23===e.getHours()&&59===e.getMinutes()||e.getMinutes()%this.intervalSize==0||e.setMinutes(e.getMinutes()+1),e}afterSetProxyParentId(e,t){if(e&&void 0!==t){let t=this;t.dragProxy?.vdom.cn[0].id&&Neo.applyDeltas(t.appName,{action:"moveNode",id:t.dragProxy.id,index:0,parentId:e})}}createDragProxy(e){let t=this,a=Neo.getComponent(t.getDragElementRoot().id)||t.owner,r=t.dragProxyConfig?.vdom,n=d.A.clone(r||t.dragElement);n.cn[2].removeDom=!1;const s={module:o.A,appName:t.appName,moveInMainThread:t.moveInMainThread,parentId:t.proxyParentId,windowId:t.windowId,...t.dragProxyConfig,vdom:t.useProxyWrapper?{cn:[n]}:n};s.cls=s.cls||[],s.cls.push("neo-focus"),a&&s.cls.push(a.getTheme()),n.cls&&!t.useProxyWrapper&&s.cls.push(...n.cls),t.addDragProxyCls&&i.A.add(s.cls,t.dragProxyCls),Object.assign(s.style,{height:`${e.height}px`,top:e.y-t.columnTop+"px",width:`${e.width}px`}),t.dragProxy=Neo.create(s)}dragEnd(e){super.dragEnd(e);let t,a,r=this,{owner:o}=r,s=r.eventRecord;r.keepStartDate?(t=r.newEndDate,a=r.newStartDate||s.startDate):(a=new Date(d.A.find(o.vdom,r.proxyParentId).vdom.flag+"T00:00:00.000Z"),a.setHours(r.axisStartTime),a.setMinutes(r.currentInterval*r.intervalSize),r.keepEndDate?(t=r.newEndDate||s.endDate,a=r.newStartDate||a):(t=n.A.clone(a),t.setMinutes(t.getMinutes()+r.eventDuration))),t=r.adjustEndDate(t),s.setSilent({endDate:t,startDate:a}),Object.assign(r,{currentInterval:0,hasOverflow:!1,keepEndDate:!1,keepStartDate:!1,newEndDate:null,newStartDate:null,proxyParentId:null}),o.getStateProvider().getStore("events").doSort(),o.updateEvents()}dragMove(e){let t,a,r,o,s,i,d,l,g,c,p,u,m,v,D=this,{axisEndTime:h,axisStartTime:f,columnHeight:y,eventDuration:x,intervalSize:w,keepEndDate:E,keepStartDate:P,owner:M}=D,C=0,I=e.targetPath,N=I.length,T=D.eventRecord,S=!1,{timeAxis:b}=M;if(D.dragProxy){if(!E&&!P)for(;C<N;C++)if(I[C].cls.includes("neo-c-w-column")){D.proxyParentId=I[C].id;break}if(g=60*(h-f)/w,l=y/g,u=Math.min(y,e.clientY-D.offsetY-D.columnTop),a=Math.floor(u/l),s=n.A.clone(T.endDate),m=n.A.clone(T.startDate),E&&f>m.getHours()&&(m.setHours(f),m.setMinutes(0),x=(s-m)/60/1e3),P&&h<s.getHours()&&(s.setHours(h),s.setMinutes(0),x=(s-m)/60/1e3),E||(a=Math.min(a,g-x/w)),r=[{id:D.dragProxy.id,style:{}}],E||P)if(t=n.A.clone(T.startDate),t.setHours(f),t.setMinutes(0),p=M.minimumEventDuration/w,v=(T.startDate-t)/w/60/1e3,E){if(c=v+x/w,D.enableResizingAcrossOppositeEdge){if(D.forceUpdate&&a>c-p&&a<c+p)return;a>=c+p?(S=!0,D.forceUpdate=!0,s.setHours(f),s.setMinutes(a*w),s=D.adjustEndDate(s),D.newEndDate=s,m.setHours(f),m.setMinutes(c*w),D.newStartDate=m,o=(s-m)/60/60/1e3,r[0].style.top=`calc(${c*l/y*100}% + 1px)`):(D.forceUpdate=!1,D.newStartDate=null)}S||(a=Math.min(a,c-p))}else if(P){if(c=v-x/w,D.enableResizingAcrossOppositeEdge)if(a=Math.max(-x/w,a),a<=c-p)S=!0,D.forceUpdate=!0,s.setHours(f),s.setMinutes(x+c*w),s=D.adjustEndDate(s),D.newEndDate=s,m.setHours(f),m.setMinutes(x+a*w),D.newStartDate=m,o=(s-m)/60/60/1e3,u=(x/w+a)*l,u=u/y*100,r[0].style.top=`calc(${u}% + 1px)`;else{if(D.forceUpdate&&a<c+p)return;D.forceUpdate&&a>=c+p&&D.currentInterval!==a&&(D.forceUpdate=!1,D.newStartDate=null,r[0].style.top=`calc(${v*l/y*100}% + 1px)`)}S||(a=Math.max(a,c+p))}P||(a=Math.max(0,a)),D.currentInterval!==a&&(S||(E||(s.setHours(f),s.setMinutes(x+a*w)),P?(D.newEndDate=s,o=(s-T.startDate)/60/60/1e3):(m.setHours(f),m.setMinutes(a*w),u=a*l,u=u/y*100,r[0].style.top=`calc(${u}% + 1px)`),E&&(o=(T.endDate-m)/60/60/1e3)),s=D.adjustEndDate(s),r.push({id:D.dragProxy.vdom.cn[2].id,innerHTML:M.intlFormat_time.format(s)}),(E||P)&&(d=Math.round(o/(h-f)*100*1e3)/1e3,r[0].style.height=`calc(${d}% - 2px)`),r.push({id:D.dragProxy.vdom.cn[0].id,innerHTML:M.intlFormat_time.format(m)}),D.dragProxy.vdom.cn[0].id&&(i=(o&&60*o||x)/b.interval,i<=2?b.rowHeight/i<25&&!D.hasOverflow&&(r.push({id:D.dragProxy.id,cls:{add:["neo-overflow"]}}),D.hasOverflow=!0):D.hasOverflow&&(r.push({id:D.dragProxy.id,cls:{remove:["neo-overflow"]}}),D.hasOverflow=!1),Neo.applyDeltas(D.appName,r))),D.currentInterval=a}}dragStart(e){let t,a,r,n=this;n.owner.getDomRect([n.getDragElementRoot().id,e.path[1].id]).then((o=>{t=(n.eventRecord.endDate-n.eventRecord.startDate)/60/1e3,a=e.clientX-o[0].left,r=e.clientY-o[0].top,Object.assign(n,{columnHeight:o[1].height,columnTop:o[1].top,dragElementRect:o[0],eventDuration:Math.round(t/n.intervalSize)*n.intervalSize,offsetX:a,offsetY:r}),n.createDragProxy(o[0]),n.fire("dragStart",{dragElementRect:o[0],id:n.id,offsetX:a,offsetY:r}),n.dragMove(e)}))}removeBodyCursorCls(){Neo.applyDeltas(this.appName,{id:"document.body",cls:{remove:["neo-cursor-move"]}})}}const g=Neo.setupClass(l),c=Symbol.for("newRecordSymbol");class p extends r.A{static config={className:"Neo.calendar.view.week.plugin.DragDrop",ntype:"plugin-calendar-week-dragdrop",isDragging:!1,resizablePluginType:"calendar-week-eventresizable"};construct(e){super.construct(e);let t=this,a={scope:t,delegate:".neo-c-w-column"},r={scope:t,delegate:".neo-event"};t.owner.addDomListeners([{"drag:end":t.onColumnDragEnd,...a},{"drag:end":t.onEventDragEnd,...r},{"drag:move":t.onColumnDragMove,...a},{"drag:move":t.onEventDragMove,...r},{"drag:start":t.onColumnDragStart,...a},{"drag:start":t.onEventDragStart,...r}])}adjustResizeEvent(e){return e.path.shift(),e.targetPath.shift(),e.target=e.path[0],e}getEventDragZone(e){let{appName:t,owner:a,windowId:r}=this,{eventDragZone:n,timeAxis:o}=a,s={axisEndTime:o.getTime(a.endTime),axisStartTime:o.getTime(a.startTime),dragElement:e.dragElement,enableResizingAcrossOppositeEdge:e.enableResizingAcrossOppositeEdge,eventRecord:e.eventRecord,proxyParentId:e.proxyParentId};return n?n.set(s):a.eventDragZone=n=Neo.create({module:g,appName:t,owner:a,scrollContainerId:a.getScrollContainer().id,windowId:r,...s,dragProxyConfig:{style:{transition:"none",willChange:"height"}}}),n}isActiveCalendar(){let{owner:e}=this,{calendarStore:t}=e,a=e.data.activeCalendarId||t.getAt(0)[t.keyProperty];return t.get(a).active}isTopLevelColumn(e){return e[0].cls.includes("neo-c-w-column")}isTopLevelEvent(e){return e.path[0].cls.includes("neo-event")}onColumnDragEnd(e){let t=this,{owner:a}=t,r=t[c];r&&t.isTopLevelColumn(e.path)&&(t.isDragging=!1,delete t[c],Neo.applyDeltas(t.appName,{id:a.getEventId(r.id),style:{opacity:1}}).then((()=>{a.eventDragZone.dragEnd(),a.getPlugin(t.resizablePluginType).onDragEnd(e)})))}onColumnDragMove(e){let t=this;t.isActiveCalendar()&&t.isTopLevelColumn(e.path)&&t.owner.eventDragZone?.dragMove(e)}onColumnDragStart(e){let t=this;if(t.isActiveCalendar()&&t.isTopLevelColumn(e.targetPath)){let a,r,o,s,i,{owner:l}=t,g=l.timeAxis.getTime(l.startTime),{calendarStore:p}=l,u=e.path[0].rect,m=15,v=60*(l.timeAxis.getTime(l.endTime)-g)/m,D=u.height/v,h=Math.min(u.height,e.clientY-u.top),f=Math.floor(h/D),y=new Date(d.A.find(l.vdom,e.path[0].id).vdom.flag+"T00:00:00.000Z");t.isDragging=!0,y.setHours(g),y.setMinutes(Math.min(f*m,v*m-l.minimumEventDuration)),r=n.A.clone(y),r.setMinutes(r.getMinutes()+l.minimumEventDuration),0===r.getHours()&&0===r.getMinutes()&&r.setMinutes(r.getMinutes()-1),i=l.eventStore.add({calendarId:l.data.activeCalendarId||p.getAt(0)[p.keyProperty],endDate:r,startDate:y,title:"New Event"})[0],t[c]=i,t.timeout(50).then((()=>{s=l.getEventId(i.id),a=d.A.find(l.vdom,s).vdom,o=t.getEventDragZone({dragElement:a,enableResizingAcrossOppositeEdge:!0,eventRecord:i,proxyParentId:e.path[0].id}),l.getPlugin(t.resizablePluginType).onDragStart(e),o.dragStart(e),t.timeout(50).then((()=>{t.isDragging&&Neo.applyDeltas(t.appName,{id:s,style:{opacity:0}})}))}))}}onEventDragEnd(e){let t=this,{owner:a}=t,{eventDragZone:r}=a;a.enableDrag&&(r.dragEnd(),t.isTopLevelEvent(e)?r.removeBodyCursorCls():(e=t.adjustResizeEvent(e),a.getPlugin(t.resizablePluginType).onDragEnd(e)),t.isDragging=!1)}onEventDragMove(e){let t=this,{owner:a}=t;a.enableDrag&&(t.isTopLevelEvent(e)||(e=t.adjustResizeEvent(e)),a.eventDragZone.dragMove(e))}onEventDragStart(e){let t=this,{owner:a}=t,r=a.data;if(a.enableDrag){let n,o,s=t.isTopLevelEvent(e);s||(e=t.adjustResizeEvent(e)),t.isDragging=!0,n=d.A.find(a.vdom,e.path[0].id).vdom,o=t.getEventDragZone({dragElement:n,enableResizingAcrossOppositeEdge:r.events.enableResizingAcrossOppositeEdge,eventRecord:a.eventStore.get(n.flag),proxyParentId:e.path[1].id}),s?o.addBodyCursorCls():a.getPlugin(t.resizablePluginType).onDragStart(e),o.dragStart(e)}}}const u=Neo.setupClass(p)},9431:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(5608);class n extends r.A{static config={className:"Neo.draggable.DragProxyComponent",ntype:"dragproxy",autoMount:!0,autoRender:!0,baseCls:["neo-dragproxy"],moveInMainThread:!0};afterSetMounted(e,t){if(super.afterSetMounted(e,t),e&&this.moveInMainThread){let{appName:e,id:t,windowId:a}=this;Neo.main.addon.DragDrop.setDragProxyElement({appName:e,id:t,windowId:a})}}}const o=Neo.setupClass(n)},8352:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var r=a(2583),n=a(9431),o=a(6270),s=(a(5691),a(825));class i extends r.A{static observable=!0;static config={className:"Neo.draggable.DragZone",ntype:"dragzone",addDragProxyCls:!0,alwaysFireDragMove:!1,appName_:null,bodyCursorStyle:null,boundaryContainerId:null,data:null,dragElement:null,dragElementRect:null,dragProxy:null,dragProxyConfig_:null,dragProxyCls:"neo-dragproxy",dropZoneIdentifier:null,moveHorizontal:!0,moveInMainThread:!0,moveVertical:!0,offsetX:0,offsetY:0,owner:null,proxyParentId_:"document.body",scrollContainerId:null,scrollFactorLeft:1,scrollFactorTop:1,useProxyWrapper:!0,windowId_:null};construct(e){super.construct(e),Neo.main.addon.DragDrop||console.error("You can not use Neo.draggable.DragZone without adding Neo.main.addon.DragDrop to the main thread addons",this.id)}afterSetWindowId(e,t){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}beforeGetDragProxyConfig(e){return Neo.clone(e,!0,!0)}createDragProxy(e){let t=this,a=Neo.getComponent(t.getDragElementRoot().id)||t.owner,r=t.dragElementRect,i=t.dragProxyConfig?.vdom,d=s.A.clone(i||t.dragElement),l={module:n.A,appName:t.appName,moveInMainThread:t.moveInMainThread,parentId:t.proxyParentId,windowId:t.windowId,...t.dragProxyConfig,vdom:t.useProxyWrapper?{cn:[d]}:d};l.cls=l.cls||[],a&&l.cls.push(a.getTheme()),d.cls&&!t.useProxyWrapper&&l.cls.push(...d.cls),t.addDragProxyCls&&l.cls&&o.A.add(l.cls,t.dragProxyCls),l.style=l.style||{},Object.assign(l.style,{height:`${e.height}px`,left:`${t.moveHorizontal?e.x:r.x}px`,top:`${t.moveVertical?e.y:r.y}px`,width:`${e.width}px`}),t.dragProxy=Neo.create(l)}destroyDragProxy(){let e=this,t=e.dragProxy.id;e.timeout(e.moveInMainThread?0:30).then((()=>{Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:e.appName,deltas:[{action:"removeNode",id:t}]})})),e.dragProxy.destroy()}dragEnd(e){let t=this,{owner:a}=t,{cls:r}=a;o.A.remove(r,"neo-is-dragging"),a.cls=r,t.dragProxy&&(t.destroyDragProxy(),t.dragProxy=null),Object.assign(t,{dragElementRect:null,offsetX:0,offsetY:0,scrollContainerId:null}),t.fire("dragEnd",e),t.resetData()}dragMove(e){let t,a=this;!a.moveInMainThread&&a.dragProxy&&(t=a.dragProxy.style,a.moveHorizontal&&(t.left=e.clientX-a.offsetX+"px"),a.moveVertical&&(t.top=e.clientY-a.offsetY+"px"),a.dragProxy.style=t),a.fire("dragMove",e)}dragStart(e){let t,a,r=this,{appName:n,owner:s,windowId:i}=r,{cls:d}=s,l=r.getDragElementRect(e);r.setData(),Neo.main.addon.DragDrop.setConfigs({appName:n,windowId:i,...r.getMainThreadConfigs()}),o.A.add(d,"neo-is-dragging"),s.cls=d,t=e.clientX-l.left,a=e.clientY-l.top,Object.assign(r,{dragElementRect:l,offsetX:t,offsetY:a}),r.createDragProxy(l),r.fire("dragStart",{clientX:e.clientX,clientY:e.clientY,dragElementRect:l,eventData:e,id:r.id,offsetX:t,offsetY:a})}getDragElementRect(e){let t=this.getDragElementRoot().id;for(let a of e.path)if(a.id===t)return a.rect;for(let a of e.targetPath)if(a.id===t)return a.rect;return null}getDragElementRoot(){return this.dragElement}getMainThreadConfigs(){let e=this;return{alwaysFireDragMove:e.alwaysFireDragMove,bodyCursorStyle:e.bodyCursorStyle,boundaryContainerId:e.boundaryContainerId,dragElementRootId:e.getDragElementRoot().id,dragProxyCls:e.dragProxyCls,dragZoneId:e.id,dropZoneIdentifier:e.dropZoneIdentifier,moveHorizontal:e.moveHorizontal,moveVertical:e.moveVertical,scrollContainerId:e.scrollContainerId,scrollFactorLeft:e.scrollFactorLeft,scrollFactorTop:e.scrollFactorTop}}onDrop(e){this.fire("drop",e)}onDropEnter(e){this.fire("drop:enter",e)}onDropLeave(e){this.fire("drop:leave",e)}resetData(){this.timeout(50).then((()=>{this.data=null}))}setData(e={}){let t=this;t.data={dragElement:t.getDragElementRoot(),dragZoneId:t.id,...e}}}const d=Neo.setupClass(i)},4367:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(2583);class n extends r.A{static config={className:"Neo.plugin.Base",ntype:"plugin",owner:null};construct(e){super.construct(e);let t=this;t.owner.mounted?t.onOwnerMounted():t.owner.on("mounted",t.onOwnerMounted,t)}onOwnerMounted(){}}const o=Neo.setupClass(n)}}]);