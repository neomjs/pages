"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[1741],{1741(e,t,o){o.d(t,{A:()=>v});var n=o(8497),i=o(5023),d=o(7466),s=o(3572),r=o(1031);class a extends s.A{static config={className:"Neo.util.KeyNavigation",ntype:"keynav",component_:null,keyDownEventBubble:!1,keys_:null};add(e){this._keys.push(...this.parseKeys(e))}beforeGetComponent(){return Neo.getComponent(this._component)}beforeSetComponent(e){return e?.id}destroy(){this.unregister(),super.destroy()}onKeyDown(e){if(e.key){let t,o=this,n=e.key.toUpperCase();n=o.parseUpperCaseKey(n),o.keys.forEach(i=>{t=Neo.isString(i.scope)?Neo.get(i.scope):i.scope,i.key.toUpperCase()===n&&(Neo.isFunction(i.fn)?i.fn.apply(t,[e,o.component]):t[i.fn]?.apply(t,[e,o.component]))})}}parseKeys(e){if(!Array.isArray(e)){let t=this._component,o=[];t&&(Object.entries(e).forEach(([n,i])=>{"scope"!==n&&o.push({fn:i,key:n,scope:e.scope||t})}),e=o)}return e}parseUpperCaseKey(e){switch(e){case" ":e="SPACE";break;case"ARROWDOWN":e="DOWN";break;case"ARROWLEFT":e="LEFT";break;case"ARROWRIGHT":e="RIGHT";break;case"ARROWUP":e="UP"}return e}register(e){let t=this;t.component=e,t.keys=t.parseKeys(t.keys),e.addDomListeners({keydown:{bubble:t.keyDownEventBubble,fn:t.onKeyDown,scope:t}})}removeKey(e){let t,o=this._keys,n=0,i=o.length;for(;n<i;n++)if(t=o[n],Neo.isEqual(t,e)){r.A.remove(o,t);break}}removeKeys(e){Array.isArray(e)&&e.forEach(e=>this.removeKey(e))}unregister(){}toJSON(){let e=this;return{...super.toJSON(),component:e.serializeConfig(e.component),keys:e.serializeConfig(e.keys)}}}const l=Neo.setupClass(a);o(1812);var p=o(6743),u=(o(5619),o(950)),c=(o(1766),o(4256));const h=e=>null==e||isNaN(e)?e:`${e}px`,m=Symbol.for("closestController"),g=/^\d+\w+$/;class f extends n.A{static hideModes=["removeDom","visibility"];static config={className:"Neo.component.Base",ntype:"component",align_:{[c.o]:!0,merge:"deep",value:{edgeAlign:"t-b",constrainTo:"document.body"}},baseCls:[],containsFocus_:!1,controller_:null,droppable_:!1,dropZone:null,dropZoneConfig:null,floating:!1,hasBeenMounted:!1,height_:null,hidden_:!1,hideMode_:"removeDom",html_:null,isLoading_:!1,keys_:null,loadingSpinnerCls_:["fa","fa-spinner","fa-spin"],maxHeight_:null,maxWidth_:null,minHeight_:null,minWidth_:null,plugins_:null,reference_:null,responsive_:null,role_:null,scrollable_:!1,style_:{[c.o]:!0,merge:"shallow",value:null},theme_:null,tag_:null,text_:null,tooltip_:null,ui_:null,width_:null,wrapperCls_:null,wrapperStyle_:{[c.o]:!0,merge:"shallow",value:null},_vdom:{}};construct(e){let t=this;!Object.hasOwn(t,"_vdom")&&t._vdom&&(t._vdom=Neo.clone(t._vdom,!0)),super.construct(e)}get isVisible(){return this.mounted&&!this.hidden&&(!this.parent||this.parent.isVisible)}get vdom(){return this._vdom}set vdom(e){this.afterSetVdom(e,e)}addCls(e){let{cls:t}=this;r.A.add(t,e),this.cls=t}addStyle(e){return Neo.isString(e)&&(e=Neo.createStyleObject(e)),this.style=Object.assign(this.style,e)}addWrapperCls(e){let{wrapperCls:t}=this;r.A.add(t,e),this.wrapperCls=t}afterSetAppName(e,t){}afterSetCls(e,t){t=t||[];let o,n=this,i=n.vdom,d=n.getVdomRoot();i!==d?d.cls=[...e]:(o=r.A.union(n.wrapperCls,e),r.A.remove(o,r.A.difference(t,e)),i.cls=o),n.update()}afterSetDisabled(e,t){let o=this.cls;r.A[e?"add":"remove"](o,"neo-disabled"),this.cls=o}afterSetDroppable(e,t){let n=this;e&&!n.dropZone&&o.e(8340).then(o.bind(o,8340)).then(e=>{n.dropZone=Neo.create({module:e.default,appName:n.appName,owner:n,windowId:n.windowId,...n.dropZoneConfig})})}afterSetHeight(e,t){this.configuredHeight=h(e),this.changeVdomRootKey("height",e)}afterSetHidden(e,t){let o=this,n=e?"hide":"show";e&&void 0===t&&"removeDom"===o.hideMode?o.vdom.removeDom=!0:(e||void 0!==t)&&o[n](),e||o.revertFocus(),o.fire(n,{id:o.id}),o.fire("hiddenChange",{id:o.id,oldValue:t,value:e})}afterSetHtml(e,t){this.changeVdomRootKey("html",e)}afterSetId(e,t){super.afterSetId(e,t);let o=this;o.configsApplied&&(o.ensureStableIds(),o.update())}afterSetIsLoading(e,t){if(e||void 0!==t){let o,n=this,{wrapperCls:i,vdom:d}=n;void 0!==t&&d.cn&&(o=d.cn.findLastIndex(e=>e.cls?.includes("neo-load-mask")),-1!==o&&d.cn.splice(o,1)),e&&(d.cn||(d.cn=[]),d.cn.push(n.createLoadingMask(e))),r.A.toggle(i,"neo-masked",e),n.set({vdom:d,wrapperCls:i})}}afterSetMaxHeight(e,t){this.configuredMaxHeight=h(e),this.changeVdomRootKey("maxHeight",e)}afterSetMaxWidth(e,t){this.configuredMaxWidth=h(e),this.changeVdomRootKey("maxWidth",e)}afterSetMinHeight(e,t){this.configuredMinHeight=h(e),this.changeVdomRootKey("minHeight",e)}afterSetMinWidth(e,t){this.configuredMinWidth=h(e),this.changeVdomRootKey("minWidth",e)}afterSetMounted(e,t){if(super.afterSetMounted(e,t),void 0!==t){let t=this;e?(t.hasBeenMounted=!0,t.floating&&(t.alignTo(),t.focus(t.id,!0)),t.fire("mounted",t.id)):t.revertFocus()}}afterSetReference(e,t){e&&this.changeVdomRootKey("data-ref",e)}async afterSetResponsive(e,t){if(e&&!this.getPlugin("responsive")){let t=this,n=await o.e(2553).then(o.bind(o,2553)),i=t.plugins||[];i.push({module:n.default,appName:t.appName,value:e}),t.plugins=i}}afterSetRole(e,t){this.changeVdomRootKey("role",e)}afterSetScrollable(e,t){if(void 0===t&&!e)return;let o=this;if(t){let e="overflow";Neo.isBoolean(t)||(e+=Neo.capitalize(t)),o.removeStyle([e])}if(!Neo.isEmpty(e)){let t="overflow";e&&!Neo.isBoolean(e)&&(t+=Neo.capitalize(e)),e?(o.addStyle(t+":auto"),o.addCls("neo-scrollable")):o.removeCls("neo-scrollable")}}afterSetStyle(e,t){(e||void 0!==t)&&this.updateStyle()}afterSetTag(e,t){e&&this.changeVdomRootKey("tag",e)}afterSetTheme(e,t){if(e||void 0!==t){let o=this,{cls:n}=o,i=!1;t&&n.includes(t)&&(r.A.remove(n,t),i=!0),e!==o.parent?.theme&&(e&&r.A.add(n,e),i=!0),i&&(o.cls=n)}}afterSetText(e,t){this.changeVdomRootKey("text",e)}afterSetTooltip(e,t){t?.destroy?.(),e&&(Neo.ns("Neo.tooltip.Base")?this.createTooltip(e):Promise.all([o.e(1184),o.e(8750)]).then(o.bind(o,8750)).then(()=>{this.createTooltip(e)}))}afterSetUi(e,t){let o=this,n=o.cls;t&&r.A.remove(n,`neo-${o.ntype}-${t}`),e&&""!==e&&r.A.add(n,`neo-${o.ntype}-${e}`),o.cls=n}afterSetWidth(e,t){this.configuredWidth=h(e),this.changeVdomRootKey("width",e)}afterSetWindowId(e,t){super.afterSetWindowId(e,t);let o=this.controller;o&&(o.windowId=e)}afterSetWrapperCls(e,t){t=t||[],e=e||[];let o=this,{vdom:n}=o,i=o.getVdomRoot(),d=n.cls||[];n===i?(d=r.A.union(d,e),r.A.remove(d,r.A.difference(t,e)),n.cls=d):(e=e||[],t&&r.A.remove(d,t),r.A.add(d,e),n.cls=d),o.update()}afterSetWrapperStyle(e,t){(e||void 0!==t)&&this.updateStyle()}async alignTo(e={}){const t=this,o={...t.align,...e,id:t.id,configuredFlex:t.configuredFlex,configuredWidth:t.configuredWidth,configuredHeight:t.configuredHeight,configuredMinWidth:t.configuredMinWidth,configuredMinHeight:t.configuredMinHeight,configuredMaxWidth:t.configuredMaxWidth,configuredMaxHeight:t.configuredMaxHeight,windowId:t.windowId};o.target&&await Neo.main.DomAccess.align(o)}beforeGetCls(e){return e?[...e]:[]}beforeGetStyle(e){return{...e}}beforeGetWrapperCls(e){return e?[...e]:[]}beforeGetWrapperStyle(e){return{...Object.assign(this.vdom.style||{},e)}}beforeSetAlign(e,t){return"string"==typeof e&&(e={edgeAlign:e}),e}beforeSetCls(e,t){return r.A.union(e||[],this.baseCls,this.getBaseClass())}beforeSetController(e,t){return t?.destroy(),e?i.A.beforeSetInstance(e,"Neo.controller.Component",{component:this,windowId:this.windowId}):e}beforeSetDomListeners(e,t){return Neo.isObject(e)&&(e=[e]),e||[]}beforeSetHideMode(e,t){return this.beforeSetEnumValue(e,t,"hideMode")}beforeSetKeys(e,t){return t?.destroy(),e&&(e=i.A.beforeSetInstance(e,l,{keyDownEventBubble:!0,keys:e})),e}beforeSetPlugins(e,t){return Array.isArray(e)&&e.forEach((t,o)=>{e[o]=i.A.beforeSetInstance(t,null,{owner:this})}),e}beforeSetSilentVdomUpdate(e,t){return!0===e?Neo.isNumber(t)?t+1:1:Neo.isNumber(t)&&t>0?t-1:0}beforeSetUpdateDepth(e,t){return void 0===t?e:-1===t||-1===e?-1:Math.max(e,t)}changeVdomRootKey(e,t){let o=this.getVdomRoot();t?o[e]=t:delete o[e],this.update()}createLoadingMask(e){return{cls:["neo-load-mask"],cn:[{cls:["neo-load-mask-body"],cn:[{cls:this.loadingSpinnerCls},{cls:["neo-loading-message"],removeDom:!Neo.isString(e),text:e}]}]}}createTooltip(e){"string"==typeof e&&(e={text:e});let t=this;e.ownInstance?t._tooltip=Neo.create("Neo.tooltip.Base",{...e,appName:t.appName,componentId:t.id,windowId:t.windowId}):(t._tooltip=e,Neo.tooltip.Base.createSingleton(t.app),t.addCls("neo-uses-shared-tooltip"),t.update())}destroy(e=!1,t=!1){let o,n=this,{parent:i,parentId:d}=n;n.revertFocus(),n.controller=null,n.reference&&n.getController()?.removeReference(n),n.plugins?.forEach(e=>{e.destroy()}),e&&d&&("document.body"===d?Neo.applyDeltas(n.windowId,{action:"removeNode",id:n.vdom.id}):(o=i.vdom,u.A.removeVdomChild(o,n.vdom.id),i[t?"_vdom":"vdom"]=o)),super.destroy(),n.onFocusLeave=Neo.emptyFn,n.unmount=Neo.emptyFn}down(e,t=!0){return d.A.down(this,e,t)}focus(e=this.id,t=!1){Neo.main.DomAccess.focus({children:t,id:e,windowId:this.windowId})}getBaseClass(){const e=[];return this.floating&&e.push("neo-floating"),e}getController(e){let t,o=this;return!e&&(t=o[m],t)||(t=o.getConfigInstanceByNtype("controller",e),e||(o[m]=t)),t}async getDomRect(e=this.id,t=this.windowId){let o=await Neo.main.DomAccess.getBoundingClientRect({id:e,windowId:t});return Array.isArray(o)?o.map(e=>p.A.clone(e)):p.A.clone(o)}getParents(){return d.A.getParents(this)}getPlugin(e){Neo.isString(e)&&(e.startsWith("plugin-")||(e="plugin-"+e),e={ntype:e});let t,o=this;for(const n of o.plugins||[]){t=!0;for(const o in e)if(n[o]!==e[o]){t=!1;break}if(t)return n}return null}getReference(e){return this.down({reference:e})}getTheme(){let e,t,o=this,n="neo-theme-";for(const e of o.cls||[])if(e.startsWith(n))return e;if(e=o.app?.mainView,e){t=u.A.getParentNodes(e.vdom,o.id);for(const e of t||[])for(const t of e.cls||[])if(t.startsWith(n))return t}return Neo.config.themes?.[0]}hide(e){let t=this;if("visibility"!==t.hideMode){let o=function(){"document.body"!==t.parentId?(t.vdom.removeDom=!0,t.parent.updateDepth=2,t.parent.update()):t.unmount()};e?t.timeout(e).then(o):o()}else{let e=t.style;e.visibility="hidden",t.style=e}t._hidden=!0}init(){this.autoInitVnode&&this.initVnode()}isFloating(){let e=this;return!!e.floating||!!e.parent&&e.parent.floating}async measure(e){if(null!=e)if(e.endsWith("px"))e=parseFloat(e);else if(g.test(e)){let{id:t,windowId:o}=this;e=await Neo.main.DomAccess.measure({id:t,value:e,windowId:o})}else isNaN(e)||(e=parseFloat(e));return e}mergeConfig(...e){let t=super.mergeConfig(...e),o=t.vdom||t._vdom||{};return this._vdom=Neo.clone({...o,...this._vdom||{}},!0),this.ensureStableIds(),delete t._vdom,delete t.vdom,t}async mount(){return this.initVnode(!0)}onConstructed(){super.onConstructed(),this.keys?.register(this)}onScrollCapture(e){super.onScrollCapture(e);let t=this;if(t._vdom){let o=u.A.getById(t._vdom,e.target.id);o&&(o.scrollTop=e.scrollTop,o.scrollLeft=e.scrollLeft)}}onFocusEnter(e){this.focusEnterData=e}onFocusLeave(e){this.focusEnterData=null}removeCls(e){let t=this.cls;r.A.remove(t,e),this.cls=t}removeStyle(e){Array.isArray(e)||(e=[e]);let{style:t}=this,o=!1;return Object.keys(t).forEach(n=>{e.indexOf(n)>-1&&(delete t[n],o=!0)}),o&&(this.style=t),t}revertFocus(){let e=this.focusEnterData?.relatedTarget;this.containsFocus&&e&&Neo.getComponent(e.id)?.focus()}show(){let e=this;if("visibility"!==e.hideMode)delete e.vdom.removeDom,e.silentVdomUpdate?e.needsVdomUpdate=!0:"document.body"!==e.parentId?(e.parent.updateDepth=-1,e.parent.update()):!e.mounted&&e.initVnode(!0);else{let t=e.style;delete t.visibility,e.style=t}e._hidden=!1}toggleCls(e,t){let o=this.cls;r.A.toggle(o,e,t),this.cls=o}unmount(){let e=this;e.vdom.removeDom=!0,e._hidden=!0,e.mounted=!1,Neo.applyDeltas(e.windowId,{action:"removeNode",id:e.vdom.id})}up(e){return d.A.up(this.id,e)}toJSON(){let e=this;return{...super.toJSON(),align:e.align,cls:e.cls,controller:e.controller?.toJSON(),disabled:e.disabled,height:e.height,hidden:e.hidden,keys:e.keys?.toJSON(),reference:e.reference,role:e.role,style:e.style,theme:e.theme,ui:e.ui,vdom:e.vdom,vnode:e.vnode,width:e.width,wrapperCls:e.wrapperCls,wrapperStyle:e.wrapperStyle}}updateStyle(){let e=this,{vdom:t}=e,o=e.getVdomRoot();t!==o?(t.style=e.wrapperStyle,o.style=e.style):t.style={...e.wrapperStyle,...e.style},e.update()}async waitForDomRect({attempts:e=10,delay:t=50,id:o=this.id,windowId:n=this.windowId}={}){let i=this,d=await i.getDomRect(o),s=!1;return Array.isArray(d)?d.forEach(e=>{(e.height<1||e.width<1)&&(s=!0)}):(d.height<1||d.width<1)&&(s=!0),s&&e>0?(await i.timeout(t),await i.waitForDomRect({attempts:e-1,delay:t,id:o,windowId:n})):d}}const v=Neo.setupClass(f)},5619(e,t,o){o.d(t,{A:()=>d});var n=o(3572);class i extends n.A{static config={className:"Neo.util.Style"};static compareStyles(e,t){let o={};return Neo.isString(e)&&(e=Neo.createStyleObject(e)),Neo.isString(t)&&(t=Neo.createStyleObject(t)),e||t?t?(e&&Object.keys(e).forEach(n=>{t.hasOwnProperty(n)&&t[n]===e[n]||(o[n]=e[n])}),Object.keys(t).forEach(t=>{e&&e.hasOwnProperty(t)||(o[t]=null)}),Object.keys(o).length>0?o:null):Neo.clone(e):null}}const d=Neo.setupClass(i)},7150(e,t,o){o.d(t,{A:()=>s});var n=o(3572),i=o(7466);class d extends n.A{static config={className:"Neo.util.vdom.TreeBuilder",singleton:!0};#e(e,t,o,n){if("object"!=typeof e||null===e)return e;let d={...e};return e[n]&&(d[n]=[],e[n].forEach(e=>{let s,r=e;if(r.componentId){if(1===t&&!o?.has(r.componentId))return void d[n].push({...r,neoIgnore:!0});if(t>1||-1===t||o?.has(r.componentId)){const e=i.A.get(r.componentId),t="cn"===n?e?.vdom:e?.vnode;t&&(r=t)}}s=e.componentId?-1===t?-1:Math.max(0,t-1):t,d[n].push(this.#e(r,s,o,n))})),d}getVdomTree(e,t=-1,o=null){return this.#e(e,t,o,"cn")}getVnodeTree(e,t=-1,o=null){return this.#e(e,t,o,"childNodes")}}const s=Neo.setupClass(d)},8497(e,t,o){o.d(t,{A:()=>S});var n=o(3572),i=o(5023),d=o(7466),s=o(6069);class r extends n.A{static config={className:"Neo.mixin.DomEvents",domListeners_:null};addDomListeners(e){Array.isArray(e)||(e=[e]);let t=this.domListeners;t.push(...e),this.domListeners=t}afterSetDomListeners(e,t){(e?.[0]||t?.[0])&&s.A.updateDomListeners(this,e,t)}beforeSetDomListeners(e,t){return Neo.isObject(e)&&(e=[e]),e||[]}initDomEvents(){let e=this;e.domListeners?.length>0&&e.timeout(150).then(()=>{s.A.mountDomListeners(e)})}removeDomEvents(){this.domListeners=[]}removeDomListeners(e){Array.isArray(e)||(e=[e]);let t,o,{domListeners:n}=this;e.forEach(e=>{for(t=0,o=n.length;t<o;t++)if(Neo.isEqual(e,n[t])){n.splice(t,1);break}}),this.domListeners=n}}const a=Neo.setupClass(r);var l=o(4556),p=o(7150),u=o(950),c=o(6969);class h extends c.A{static config={className:"Neo.manager.VDomUpdate",mergedCallbackMap:null,postUpdateQueueMap:null,singleton:!0};inFlightUpdateMap=null;promiseCallbackMap=null;construct(e){super.construct(e);const t=this;t.inFlightUpdateMap=new Map,t.mergedCallbackMap=Neo.create(c.A,{keyProperty:"ownerId"}),t.postUpdateQueueMap=Neo.create(c.A,{keyProperty:"ownerId"}),t.promiseCallbackMap=new Map}addPromiseCallback(e,t){let o=this;o.promiseCallbackMap.has(e)||o.promiseCallbackMap.set(e,[]),o.promiseCallbackMap.get(e).push(t)}executeCallbacks(e,t){let o=this,n=o.mergedCallbackMap.get(e),i=t?[t]:[];n&&(n.children.forEach((e,t)=>{o.executePromiseCallbacks(t,...i)}),o.mergedCallbackMap.remove(n)),o.executePromiseCallbacks(e,...i)}executePromiseCallbacks(e,t){let o=this.promiseCallbackMap.get(e);o?.forEach(e=>e(t)),this.promiseCallbackMap.delete(e)}getAdjustedUpdateDepth(e){let t,o=Neo.getComponent(e),n=this.mergedCallbackMap.get(e),i=o?.updateDepth??1;return n?(n.children.forEach(e=>{t=-1===e.childUpdateDepth?-1:e.distance+e.childUpdateDepth,-1===t?i=-1:-1!==i&&(i=Math.max(i,t))}),i):null}getInFlightUpdateDepth(e){return this.inFlightUpdateMap.get(e)}getMergedChildIds(e){const t=this.mergedCallbackMap.get(e);return t?new Set(t.children.keys()):null}registerInFlightUpdate(e,t){this.inFlightUpdateMap.set(e,t)}registerMerged(e,t,o,n){let i=this.mergedCallbackMap.get(e);i||(i={ownerId:e,children:new Map},this.mergedCallbackMap.add(i)),i.children.set(t,{childUpdateDepth:o,distance:n})}registerPostUpdate(e,t,o){let n=this.postUpdateQueueMap.get(e);n||(n={ownerId:e,children:[]},this.postUpdateQueueMap.add(n)),n.children.push({childId:t,resolve:o})}triggerPostUpdates(e){let t,o=this,n=o.postUpdateQueueMap.get(e);n&&(n.children.forEach(e=>{t=Neo.getComponent(e.childId),t&&(e.resolve&&o.addPromiseCallback(t.id,e.resolve),t.update())}),o.postUpdateQueueMap.remove(n))}unregisterInFlightUpdate(e){this.inFlightUpdateMap.delete(e)}}const m=Neo.setupClass(h);var g=o(1766),f=o(4256);const{currentWorker:v}=Neo;class y extends n.A{static config={className:"Neo.mixin.VdomLifecycle",autoInitVnode:!1,autoMount:!1,isVdomUpdating_:!1,isVnodeInitializing_:!1,mounted_:!1,needsVdomUpdate_:!1,silentVdomUpdate_:!1,updateDepth_:1,vnode_:{[f.o]:!0,clone:"none",cloneOnGet:"none",isEqual:(e,t)=>e===t,value:null},vnodeInitialized_:!1};afterSetVdom(e,t){this.updateVdom()}afterSetVnode(e,t){e&&this.syncVnodeTree()}afterSetVnodeInitialized(e,t){let o=this;e&&(o.fire("vnodeInitialized",o.id),o.needsVdomUpdate&&o.update())}createVdomReference(){let e=this,t={componentId:e.id},o=e.vdom.id;return o&&e.id!==o&&(t.id=o),t}ensureStableIds(){const e=this,t=e.vdom,o=e.getVdomRoot();o&&(o.id=e.id,t!==o&&(t.id=e.id+"__wrapper"))}async executeVdomUpdate(e,t){let o=this;e&&m.addPromiseCallback(o.id,e),o.isVdomUpdating=!0,m.registerInFlightUpdate(o.id,o.updateDepth);try{const{vdom:e,vnode:t}=o,n=m.getMergedChildIds(o.id),i={vdom:p.A.getVdomTree(e,o.updateDepth,n),vnode:p.A.getVnodeTree(t,o.updateDepth,n)};v?.isSharedWorker&&(i.appName=o.appName,i.windowId=o.windowId),o._needsVdomUpdate=!1,o.afterSetNeedsVdomUpdate?.(!1,!0),o._updateDepth=o.constructor.config.updateDepth;const d=await Promise.resolve(Neo.vdom.Helper.update(i));o.id&&(o.vnode=d.vnode,!Neo.config.useVdomWorker&&d.deltas?.length>0&&await Neo.applyDeltas(o.windowId,d.deltas),o.resolveVdomUpdate(d))}catch(e){o.isVdomUpdating=!1,m.unregisterInFlightUpdate(o.id),t?.(e)}}getMountedParentId(){let e=this.parentId,t=Neo.getComponent(e),o=t?.getVdomItemsRoot?.();return o?o.id:e}getMountedParentIndex(){let e,t=this.parent,o=t?.items||[],n=0,i=0,d=o.length;for(;n<d;n++){if(e=o[n],e===this)return i;e.hidden||"removeDom"!==e.hideMode||i++}}getVdomChild(e,t=this.vdom){return u.A.find(t,e)?.vdom}getVdomRoot(){return this.vdom}getVnodeRoot(){return this.vnode}hasUpdateCollision(e,t){return-1===e||t<e}async initVnode(e){let t=this,o=e||t.autoMount,{app:n}=t,{allowVdomUpdatesInTests:i,unitTestMode:d,useVdomWorker:s}=Neo.config;if(!d||i)if(d||!o||0===v.countLoadingThemeFiles){if(t.isVnodeInitializing=!0,n.vnodeInitialized||(n.isVnodeInitializing=!0),t.vdom){t.isVdomUpdating=!0,t.ensureStableIds(),m.registerInFlightUpdate(t.id,-1),delete t.vdom.removeDom,t._needsVdomUpdate=!1,t.afterSetNeedsVdomUpdate?.(!1,!0);const e=await Promise.resolve(Neo.vdom.Helper.create({appName:t.appName,autoMount:o,parentId:o?t.getMountedParentId():void 0,parentIndex:o?t.getMountedParentIndex():void 0,vdom:p.A.getVdomTree(t.vdom,-1),windowId:t.windowId}));return t.onInitVnode(e.vnode,!!s&&o),o&&!s&&(await Neo.applyDeltas(t.windowId,[{action:"insertNode",id:t.id,index:t.getMountedParentIndex(),outerHTML:e.outerHTML,parentId:t.getMountedParentId(),vnode:e.vnode}]),t.mounted=!0),t.resolveVdomUpdate(),e}}else v.on("themeFilesLoaded",function(){!t.mounted&&t.initVnode(e)},t,{once:!0})}isParentUpdating(e=this.parentId,t,o=1){if("document.body"!==e){let n=this,i=Neo.getComponent(e);if(i){if(i.isVdomUpdating){const e=m.getInFlightUpdateDepth(i.id);return!!n.hasUpdateCollision(e,o)&&(Neo.config.logVdomUpdateCollisions&&console.warn("vdom parent update conflict with:",i,"for:",n),m.registerPostUpdate(i.id,n.id,t),!0)}return n.isParentUpdating(i.parentId,t,o+1)}}return!1}mergeIntoParentUpdate(e=this.parentId,t=1){if("document.body"!==e){let o=this,n=Neo.getComponent(e);if(n)return n.needsVdomUpdate&&o.hasUpdateCollision(n.updateDepth,t)?(m.registerMerged(n.id,o.id,o.updateDepth,t),!0):o.mergeIntoParentUpdate(n.parentId,t+1)}return!1}onInitVnode(e,t){let o=this,{app:n}=o;if(o.isVnodeInitializing=!1,n){n.vnodeInitialized||(n.isVnodeInitializing=!1,n.vnodeInitialized=!0,n.fire("vnodeInitialized")),o.vnode=e;let i,s=d.A.getChildIds(e),r=0,a=s.length;for(;r<a;r++)i=Neo.getComponent(s[r]),i&&(i.vnodeInitialized=!0);o.vnodeInitialized=!0,t&&(o.mounted=!0,n.mounted||(n.mounted=!0,n.fire("mounted")))}}promiseUpdate(){return new Promise((e,t)=>{this.updateVdom(e,t)})}resolveVdomUpdate(e){let t=this;t.isVdomUpdating=!1,m.executeCallbacks(t.id,e),m.unregisterInFlightUpdate(t.id),m.triggerPostUpdates(t.id),t.needsVdomUpdate&&t.update()}syncVdomState(e=this.vnode,t=this.vdom,o=!1){u.A.syncVdomState(e,t,o)}syncVnodeTree(e=this.vnode){let t,o=this,n=d.A.getChildren(o),i={};o.syncVdomState(),e&&o.id!==e.id&&d.A.registerWrapperNode(e.id,o),n.forEach(e=>{t=g.A.find(o.vnode,e.vdom.id)?.vnode,t&&(i[e.id]=t,e.id!==t.id&&d.A.registerWrapperNode(t.id,e))}),n.forEach(e=>{t=i[e.id],t?(e._vnode=d.A.addVnodeComponentReferences(t,e.id),e.vnodeInitialized=!0,e.mounted=!0):console.warn("syncVnodeTree: Could not replace the child vnode for",e.id)}),o._vnode=e?d.A.addVnodeComponentReferences(e,o.id):null}update(){this.afterSetVdom(this.vdom,null)}updateVdom(e,t){if(!this.isConstructed)return void e?.();let o=this,{mounted:n,parentId:i,vnode:d}=o,{config:s}=Neo;if(!s.unitTestMode||s.allowVdomUpdatesInTests)if(o.isVdomUpdating||!o.vnodeInitialized||o.silentVdomUpdate)e&&m.addPromiseCallback(o.id,e),o.needsVdomUpdate=!0;else if(o.ensureStableIds(),e&&m.addPromiseCallback(o.id,e),n){if(!o.mergeIntoParentUpdate(i)&&!o.isParentUpdating(i,e)&&n&&d){let n=m.getAdjustedUpdateDepth(o.id);null!==n&&(o.updateDepth=n),s.isMiddleware||s.unitTestMode||0===v.countLoadingThemeFiles?o.executeVdomUpdate(null,t):v.on("themeFilesLoaded",function(){o.updateVdom(e,t)},o,{once:!0})}}else o.isAwaitingMount||(o.isAwaitingMount=!0,o.mountedPromise.then(()=>{o.isAwaitingMount=!1,o.vnode&&o.update()}));else t?.()}}const w=Neo.setupClass(y),N=(Symbol.for("closestController"),Symbol.for("closestProvider")),b=Symbol.for("twoWayBinding");class I extends n.A{static config={className:"Neo.component.Abstract",ntype:"abstract-component",additionalThemeFiles:null,appName_:null,bind:null,cls_:null,data_:null,disabled_:!1,mixins:[a,l.A,w],modelData:null,mounted_:!1,parentComponent_:null,parentId_:"document.body",saveScrollPosition:!0,stateProvider_:null,windowId_:null};isAwaitingMount=!1;get app(){return Neo.apps[this.windowId]||Neo.appsByName[this.appName]?.[0]||null}get mountedPromise(){let e=this;return e._mountedPromise||(e._mountedPromise=new Promise(t=>{e.mounted?t(e):e.mountedPromiseResolve=t})),e._mountedPromise}get parent(){let e=this;return e.parentComponent||("document.body"===e.parentId?null:Neo.getComponent(e.parentId))}afterSetConfig(e,t,o){let n=this;if(Neo.isUsingStateProviders&&n[b]){if(n._skipTwoWayPush===e)return;let o=n.bind?.[e];o?.twoWay&&this.getStateProvider()?.setData(o.key,t)}}afterSetId(e,t){super.afterSetId(e,t),t&&d.A.unregister(t),e&&d.A.register(this)}afterSetMounted(e,t){if(void 0!==t){const t=this;e?(t.initDomEvents?.(),t.mountedPromiseResolve?.(this),delete t.mountedPromiseResolve,m.executeCallbacks(t.id)):delete t._mountedPromise}}afterSetStateProvider(e,t){e?.createBindings(this)}afterSetWindowId(e,t){const o=this;e&&(o.controller&&(o.controller.windowId=e),o.stateProvider&&(o.stateProvider.windowId=e),Neo.currentWorker.insertThemeFiles(e,o.__proto__)),t&&(o.isVdomUpdating=!1)}beforeGetData(e){return this.getStateProvider()?.getHierarchyData()}beforeSetStateProvider(e,t){if(t?.destroy(),e){let t=this,o={component:t,windowId:t.windowId};return t.modelData&&(o.data=t.modelData),i.A.beforeSetInstance(e,"Neo.state.Provider",o)}return null}destroy(){this.removeDomEvents(),d.A.unregister(this),this.stateProvider=null,super.destroy()}getConfigInstanceByNtype(e,t){let o=this,n=o[e],{parentComponent:i}=o;return!n||t&&t!==n.ntype?(!i&&o.parentId&&(i=o.parent||Neo.get(o.parentId)),i?i===o?(console.error("Circular parent reference detected",o.id),null):i.getConfigInstanceByNtype?.(e,t):null):n}getState(...e){return this.getStateProvider().getData(...e)}getStateProvider(e){if(!Neo.isUsingStateProviders)return null;let t,o=this;return!e&&(t=o[N],t)||(t=o.getConfigInstanceByNtype("stateProvider",e),e||(o[N]=t)),t}initConfig(...e){super.initConfig(...e),this.getStateProvider()?.createBindings(this)}onScrollCapture(e){let t;this.vnode&&(t=g.A.getById(this.vnode,e.target.id),t&&(t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft))}set(e={},t=!1){const o=this,n=o.hidden;return o.setSilent(e),!t&&o.needsVdomUpdate?n&&!o.hidden?(o.show?.(),Promise.resolve()):o.promiseUpdate():Promise.resolve()}setSilent(e={}){this.silentVdomUpdate=!0,super.set(e),this.silentVdomUpdate=!1}setState(...e){this.getStateProvider().setData(...e)}toJSON(){let e=this;return{...super.toJSON(),appName:e.appName,bind:e.bind?Object.keys(e.bind):null,mounted:e.mounted,parentId:e.parentId,stateProvider:e.stateProvider?.toJSON(),windowId:e.windowId}}}const S=Neo.setupClass(I)}}]);