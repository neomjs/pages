"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[3303],{8202:(e,t,r)=>{r.d(t,{A:()=>s});var o=r(2583);class a extends o.A{static config={className:"Neo.data.Model",ntype:"model",fields:null,keyProperty_:"id",storeId:null,trackModifiedFields:!1};getField(e){let t=this,r=0,o=t.fields?.length||0;for(;r<o;r++)if(t.fields[r].name===e)return t.fields[r];return null}}const s=Neo.setupClass(a)},3303:(e,t,r)=>{r.d(t,{A:()=>f});var o=r(1058),a=r(2778),s=r(8202),i=(r(5691),r(2583)),l=r(599);let n;class d extends i.A{static config={className:"Neo.data.RecordFactory",ovPrefix:"ov_",recordNamespace:"Neo.data.record",singleton:!0};createField({config:e,field:t,me:r,model:o,path:a=""}){let s,i,l,d=Neo.ns(t.mapping||t.name,!1,e),c=t.name.split(".").pop(),u=Symbol.for(c);t.fields?t.fields.forEach((i=>{s=a.split("."),s=s.filter(Boolean),s.push(t.name),this.createField({config:e,field:i,me:r,model:o,path:s.join(".")})})):(void 0===d&&Object.hasOwn(t,"defaultValue")&&(d=t.defaultValue),i=n.parseRecordValue(r,t,d,e),l={[u]:{value:Neo.clone(i,!0),writable:!0},[c]:{configurable:!0,enumerable:!0,get(){return this[u]},set(e){let a=this[u];e=n.parseRecordValue(r,t,e),Neo.isEqual(e,a)||(this[u]=e,r._isModified=!0,r._isModified=n.isModified(r,o.trackModifiedFields),n.onRecordChange({fields:[{name:t.name,oldValue:a,value:e}],model:o,record:r}))}}},o.trackModifiedFields&&(l[n.ovPrefix+t.name]={value:i}),Object.defineProperties(a?Neo.ns(a,!0,r):r,l))}createRecord(e,t){let r=Neo.ns(`${this.recordNamespace}.${e.className}.${e.id}`);return r||(r=this.createRecordClass(e)),new r(t)}createRecordClass(e){if(e instanceof s.A){let t,r,o,a=`${this.recordNamespace}.${e.className}.${e.id}`,s=Neo.ns(a);return s||(r=a.split("."),t=r.pop(),s=Neo.ns(r,!0),o=s[t]=class{static name="Record";constructor(t){let r=this;Object.defineProperties(r,{_isModified:{value:!1,writable:!0}}),Array.isArray(e.fields)&&e.fields.forEach((o=>{n.createField({config:t,field:o,me:r,model:e})}))}set(t){n.setRecordFields(e,this,t)}setSilent(t){n.setRecordFields(e,this,t,!0)}},Object.defineProperty(o.prototype,"isRecord",{value:!0}),Object.defineProperty(o,"isClass",{value:!0}),s[t])}}isModified(e,t){if(t){let t,r=Object.keys(e),o=0,a=r.length;for(;o<a;o++)if(t=r[o],!Neo.isEqual(e[t],e[this.ovPrefix+t]))return!0;return!1}return e._isModified}isModifiedField(e,t){e.hasOwnProperty(t)||l.A.logError("The record does not contain the field",t,e);let r=this.ovPrefix+t;return e.hasOwnProperty(r)?!Neo.isEqual(e[t],e[r]):null}isRecord(e){return e?.isRecord}onRecordChange(e){Neo.get(e.model.storeId)?.onRecordChange(e)}parseRecordValue(e,t,r,o=null){if(t.calculate)return t.calculate(e,t,o);t.convert&&(r=t.convert(r));let a=t.name,{mapping:s,maxLength:i,minLength:l,nullable:n}=t,d=o?.[a]||e[a],c=t.type?.toLowerCase();if(s&&o){let e=s.split("."),t=e.pop();e=Neo.ns(e,!0,o),r=e[t]}return Object.hasOwn(t,"maxLength")&&r?.toString().length>i?(console.warn(`Setting record field: ${a} value: ${r} conflicts with maxLength: ${i}`),d):Object.hasOwn(t,"minLength")&&r?.toString().length<l?(console.warn(`Setting record field: ${a} value: ${r} conflicts with minLength: ${l}`),d):Object.hasOwn(t,"nullable")&&!1===n&&null===r?(console.warn(`Setting record field: ${a} value: ${r} conflicts with nullable: ${n}`),d):"date"===c&&"Date"!==Neo.typeOf(r)?new Date(r):("float"===c&&r?r=parseFloat(r):"html"===c&&r?r+="":"int"!==c&&"integer"!==c||!r?"string"===c&&r&&(r=(r+="").replace(/(<([^>]+)>)/gi,"")):r=parseInt(r),r)}setRecordFields(e,t,r,o=!1){let a,s=[];Object.entries(r).forEach((([r,o])=>{a=t[r],o=n.parseRecordValue(t,e.getField(r),o),Neo.isEqual(a,o)||(t[Symbol.for(r)]=o,t._isModified=!0,s.push({name:r,oldValue:a,value:o}))})),!o&&Object.keys(s).length>0&&Neo.get(e.storeId)?.onRecordChange({fields:s,model:e,record:t})}}n=Neo.setupClass(d);const c=n;class u extends o.A{static observable=!0;static config={className:"Neo.data.Store",ntype:"store",api_:null,autoLoad:!1,currentPage_:1,data_:null,initialData_:null,isGrouped:!1,isLoaded:!1,isLoading:!1,model_:null,pageSize_:0,remoteFilter:!1,remoteSort:!1,responseRoot:"data",totalCount:0,url:null};construct(e){super.construct(e);let t=this;t.on({mutate:t.onCollectionMutate,sort:t.onCollectionSort,scope:t})}add(e){return super.add(this.beforeSetData(e))}afterSetCurrentPage(e,t){t&&this.load()}afterSetData(e,t){let r=this;r.configsApplied&&e&&(t?r.clear():r.initialData=[...e],r.add(e))}afterSetFilters(e,t){super.afterSetFilters(e,t);let r=this;r._currentPage=1,t&&r.remoteFilter&&r.load()}afterSetInitialData(e,t){}afterSetModel(e,t){e&&(e.storeId=this.id,c.createRecordClass(e))}afterSetPageSize(e,t){t&&(this._currentPage=1,this.load())}afterSetSorters(e,t){super.afterSetSorters(e,t);let r=this;r._currentPage=1,t&&r.remoteSort&&r.load()}beforeSetApi(e,t){return"String"===Neo.typeOf(e)&&(e={create:e+".create",destroy:e+".destroy",read:e+".read",update:e+".update"}),e}beforeSetData(e,t){if(e){Array.isArray(e)||(e=[e]);let t,r=this,o=0,a=e.length;for(;o<a;o++)t=e[o],c.isRecord(t)||(e[o]=c.createRecord(r.model,t))}return e}beforeSetInitialData(e,t){return!e&&t?t:e}beforeSetModel(e,t){return t?.destroy(),a.A.beforeSetInstance(e,s.A)}createRecord(e){c.createRecord(e)}getKeyProperty(){return this.keyProperty||this.model.keyProperty}load(e={}){let t=this,r={page:t.currentPage,pageSize:t.pageSize,...e.params};if(t.remoteFilter&&(r.filters=t.exportFilters()),t.remoteSort&&(r.sorters=t.exportSorters()),t.api){let e=t.api.read.split("."),o=e.pop(),a=Neo.ns(e.join("."));a?a[o](r).then((e=>{(e=Neo.ns(t.responseRoot,!1,e)).success&&(t.totalCount=e.totalCount,t.data=Neo.ns(t.responseRoot,!1,e))})):console.log("Api is not defined",this)}else e.url??=t.url,Neo.Xhr.promiseJson(e).catch((e=>{console.log("Error for Neo.Xhr.request",e,t.id)})).then((e=>{t.data=Neo.ns(t.responseRoot,!1,e.json)||e.json}))}onCollectionMutate(e){let t=this;t.configsApplied&&t.fire("load",t.items)}onCollectionSort(){this.configsApplied}onConstructed(){super.onConstructed();let e=this;e.data&&e.afterSetData(e.data),e.autoLoad&&e.timeout(100).then((()=>{e.load()}))}onFilterChange(e){let t=this;t.remoteFilter?(t._currentPage=1,t.load()):super.onFilterChange(e)}onRecordChange(e){this.fire("recordChange",{...e,index:this.indexOf(e.record)})}sort(e={}){let t=this;t._currentPage=1,t.configsApplied&&(e.direction?t.sorters=[{direction:e.direction,property:e.property}]:(t.remoteSort||(t.startUpdate(),t.clear()),t.sorters=[],t.remoteSort||(t.add([...t.initialData]),t.endUpdate(),t.fire("sort"))))}}const f=Neo.setupClass(u)}}]);