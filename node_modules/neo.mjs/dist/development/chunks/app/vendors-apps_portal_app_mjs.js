export const __webpack_esm_id__ = "vendors-apps_portal_app_mjs";
export const __webpack_esm_ids__ = ["vendors-apps_portal_app_mjs"];
export const __webpack_esm_modules__ = {

/***/ "./apps/portal/Overwrites.mjs"
/*!************************************!*\
  !*** ./apps/portal/Overwrites.mjs ***!
  \************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
Neo.overwrites = {
    Neo: {
        button: {
            Base: {
                editRoute: false
            }
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.overwrites);


/***/ },

/***/ "./apps/portal/app.mjs"
/*!*****************************!*\
  !*** ./apps/portal/app.mjs ***!
  \*****************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   onStart: () => (/* binding */ onStart)
/* harmony export */ });
/* harmony import */ var _Overwrites_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Overwrites.mjs */ "./apps/portal/Overwrites.mjs");
/* harmony import */ var _view_Viewport_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./view/Viewport.mjs */ "./apps/portal/view/Viewport.mjs");



const onStart = () => Neo.app({
    mainView: _view_Viewport_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
    name    : 'Portal'
})


/***/ },

/***/ "./apps/portal/service/Seo.mjs"
/*!*************************************!*\
  !*** ./apps/portal/service/Seo.mjs ***!
  \*************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/core/Base.mjs */ "./src/core/Base.mjs");


/**
 * @summary Manages SEO metadata for the Portal application, fetching it from a JSON file
 * and intelligently updating the document head based on route changes.
 *
 * This singleton service is responsible for centralizing all SEO-related logic.
 * It fetches route-specific title and description metadata from `apps/portal/resources/data/seo.json`
 * during its asynchronous initialization. It then provides a mechanism for the `ViewportController`
 * to notify it of route changes. The service ensures that the document's `<title>` and `<meta name="description">`
 * tags are updated only when the service is fully ready and with the most recent route hash,
 * preventing race conditions on slow network connections.
 *
 * This class demonstrates the use of asynchronous initialization (`initAsync`), reactive config hooks (`afterSetIsReady`),
 * and private class fields to manage internal state and ensure robust behavior.
 *
 * @class Portal.service.Seo
 * @extends Neo.core.Base
 * @singleton
 * @see Portal.view.ViewportController
 */
class Seo extends _src_core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Portal.service.Seo'
         * @protected
         */
        className: 'Portal.service.Seo',
        /**
         * @member {Boolean} singleton=true
         * @protected
         */
        singleton: true
    }

    /**
     * Stores the most recent route received from `onRouteChanged()`.
     * This is used to process a pending route update if the service becomes ready after a route change occurred.
     * @member {Object|null} #lastRouteHash=null
     * @private
     */
    #lastRoute = null
    /**
     * Caches the SEO metadata fetched from `apps/portal/resources/data/seo.json`.
     * This object maps route hash strings to their corresponding title and description.
     * @member {Object|null} #metadata=null
     * @private
     */
    #metadata = null

    /**
     * Hook that fires after the `isReady` config changes. If the service becomes ready (`value` is true)
     * and there's a pending route hash (`#lastRouteHash` is not null), it triggers an update
     * of the document head with the metadata for that route.
     * @param {Boolean} value The new value of the `isReady` config.
     * @param {Boolean} oldValue The old value of the `isReady` config.
     * @protected
     */
    afterSetIsReady(value, oldValue) {
        if (value && this.#lastRoute) {
            this.#updateDocumentHeadIfNeeded(this.#lastRoute)
        }
    }

    /**
     * Retrieves the SEO metadata (title and description) for a given route hash.
     * Supports nested routes by falling back to parent paths if an exact match is not found.
     * e.g., '/news/blog/my-post' -> '/news/blog' -> '/news'
     * @param {String} route The route hash string (e.g., '/home', '/blog').
     * @returns {Object|null} An object containing `title` and `description` for the route, or `null` if not found.
     */
    getMetadata(route) {
        let metadata = this.#metadata,
            parts;

        if (!metadata) return null;

        if (metadata[route]) {
            return metadata[route]
        }

        // Fallback logic for nested routes
        parts = route.split('/');

        while (parts.length > 1) {
            parts.pop();
            route = parts.join('/');

            if (metadata[route]) {
                return metadata[route]
            }
        }

        return null
    }

    /**
     * Asynchronously initializes the SEO service by fetching the `seo.json` file.
     * This method simulates an API call to retrieve SEO data, making the service ready
     * to provide metadata. It ensures that the service is fully loaded before processing
     * any route-related document head updates.
     * @returns {Promise<void>} A promise that resolves when the metadata has been fetched and parsed.
     */
    async initAsync() {
        await super.initAsync();

        try {
            const response = await fetch(Neo.config.basePath + 'apps/portal/resources/data/seo.json');
            if (!response.ok) {
                throw new Error(`HTTP error with status: ${response.status}`)
            }
            this.#metadata = await response.json()
        } catch (error) {
            console.error('Error fetching SEO metadata:', error)
        }
    }

    /**
     * Called by the `ViewportController` when the application's route changes.
     * This method stores the new route hash and attempts to update the document head.
     * If the service is not yet ready (i.e., `initAsync` is still running), the update
     * is deferred until `isReady` becomes true.
     * @param {Object} config          The configuration object.
     * @param {String} config.hash     The new route hash string.
     * @param {String} config.windowId The windowId matching the route.
     */
    onRouteChanged(config) {
        this.#lastRoute = config;
        this.#updateDocumentHeadIfNeeded(config)
    }

    /**
     * This private method calls the `DocumentHead` main thread addon to update the document's
     * title and meta-description for SEO purposes. It is the actual mechanism for applying
     * the SEO changes to the browser's DOM.
     * @param {Object} config The configuration object containing `description` and `title`.
     * @param {String} config.description The new meta-description for the document.
     * @param {String} config.title The new title for the document.
     * @param {String} config.windowId The new title for the document.
     * @private
     */
    async #updateDocumentHead({description, title, windowId}) {
        let DocumentHead = await Neo.currentWorker.getAddon('DocumentHead', windowId);
        await DocumentHead.update({description, title, windowId})
    }

    /**
     * A private helper method that conditionally updates the document head.
     * It checks if the service is `isReady` before attempting to retrieve metadata
     * and call `#updateDocumentHead`. If an update occurs, it clears `#lastRouteHash`.
     * This prevents multiple updates for the same route if `onRouteChanged` is called
     * before `initAsync` completes.
     * @param {Object} config The route hash for which to update the document head.
     * @private
     */
    #updateDocumentHeadIfNeeded(config) {
        let me = this;

        if (me.isReady) {
            let metadata = me.getMetadata(config.hashString);

            if (metadata) {
                me.#updateDocumentHead({...metadata, windowId: config.windowId});
                me.#lastRoute = null
            }
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Seo));


/***/ },

/***/ "./apps/portal/view/HeaderToolbar.mjs"
/*!********************************************!*\
  !*** ./apps/portal/view/HeaderToolbar.mjs ***!
  \********************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_app_header_Toolbar_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/app/header/Toolbar.mjs */ "./src/app/header/Toolbar.mjs");


/**
 * @class Portal.view.HeaderToolbar
 * @extends Neo.app.header.Toolbar
 */
class HeaderToolbar extends _src_app_header_Toolbar_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Portal.view.HeaderToolbar'
         * @protected
         */
        className: 'Portal.view.HeaderToolbar',
        /**
         * @member {String[]} cls=['portal-header-toolbar']
         * @reactive
         */
        cls: ['portal-header-toolbar'],
        /**
         * @member {Object[]} items
         */
        items: [{
            cls     : ['logo'],
            iconCls : 'neo-logo-blue',
            minWidth: 60,
            reference: 'home-button',
            route   : '/home',
            text    : 'Neo.mjs'
        }, '->', {
            reference: 'learn-button',
            text     : 'Learn',
            route    : '/learn'
        }, {
            bind     : {badgeText: 'blogPostCount'},
            reference: 'news-header-button',
            route    : '/news',
            text     : 'News'
        }, {
            reference: 'examples-button',
            route    : '/examples',
            text     : 'Examples'
        }, {
            reference: 'services-button',
            route    : '/services',
            text     : 'Services'
        }, {
            ntype    : 'container',
            layout   : 'hbox',
            reference: 'header-social-icons',

            itemDefaults: {
                handler: 'onButtonClick',
                ntype  : 'button',
                ui     : 'ghost'
            },

            items: [{
                handler: 'onSwitchTheme',
                iconCls: 'fa-solid fa-moon',
                reference: 'theme-switch-button',
                tooltip: {
                    text     : 'Switch Theme',
                    showDelay: 0,
                    hideDelay: 0
                }
            }, {
                iconCls: 'fa-brands fa-github',
                url    : 'https://github.com/neomjs/neo',
                tooltip: {
                    text     : 'GitHub',
                    showDelay: 0,
                    hideDelay: 0
                }
            }, {
                iconCls: 'fa-brands fa-discord',
                url    : 'https://discord.gg/6p8paPq',
                tooltip: {
                    text     : 'Join Discord',
                    showDelay: 0,
                    hideDelay: 0
                }
            }]
        }]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(HeaderToolbar));


/***/ },

/***/ "./apps/portal/view/Viewport.mjs"
/*!***************************************!*\
  !*** ./apps/portal/view/Viewport.mjs ***!
  \***************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_container_Viewport_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/container/Viewport.mjs */ "./src/container/Viewport.mjs");
/* harmony import */ var _src_container_Base_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../src/container/Base.mjs */ "./src/container/Base.mjs");
/* harmony import */ var _HeaderToolbar_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./HeaderToolbar.mjs */ "./apps/portal/view/HeaderToolbar.mjs");
/* harmony import */ var _src_util_Array_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../src/util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _ViewportController_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ViewportController.mjs */ "./apps/portal/view/ViewportController.mjs");
/* harmony import */ var _ViewportStateProvider_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ViewportStateProvider.mjs */ "./apps/portal/view/ViewportStateProvider.mjs");







/**
 * @class Portal.view.Viewport
 * @extends Neo.container.Viewport
 */
class Viewport extends _src_container_Viewport_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    /**
     * Valid values for size
     * @member {String[]} sizes=['large','medium','small','x-small',null]
     * @protected
     * @static
     */
    static sizes = ['large', 'medium', 'small', 'x-small', null]

    static config = {
        /**
         * @member {String} className='Portal.view.Viewport'
         * @protected
         */
        className: 'Portal.view.Viewport',
        /**
         * @member {Neo.controller.Component} controller=ViewportController
         * @reactive
         */
        controller: _ViewportController_mjs__WEBPACK_IMPORTED_MODULE_4__["default"],
        /**
         * @member {Object} layout={ntype:'vbox',align:'stretch'}
         * @reactive
         */
        layout: {ntype: 'vbox', align: 'stretch'},
        /**
         * @member {Object[]} items
         */
        items: [{
            module: _HeaderToolbar_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
            flex  : 'none'
        }, {
            module   : _src_container_Base_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
            cls      : ['portal-main-content'],
            reference: 'main-content',

            // The layout will get assigned inside ViewportController

            items: [
                {module: () => Promise.all(/*! import() */[__webpack_require__.e("vendors-src_tab_Container_mjs"), __webpack_require__.e("vendors-src_component_wrapper_MonacoEditor_mjs"), __webpack_require__.e("vendors-src_code_LivePreview_mjs"), __webpack_require__.e("vendors-src_component_MagicMoveText_mjs"), __webpack_require__.e("vendors-apps_portal_view_home_MainContainer_mjs")]).then(__webpack_require__.bind(__webpack_require__, /*! ./home/MainContainer.mjs */ "./apps/portal/view/home/MainContainer.mjs"))},
                {module: () => Promise.all(/*! import() */[__webpack_require__.e("vendors-src_data_Store_mjs"), __webpack_require__.e("vendors-src_list_Base_mjs"), __webpack_require__.e("vendors-src_draggable_DragZone_mjs"), __webpack_require__.e("vendors-src_tree_List_mjs"), __webpack_require__.e("vendors-src_component_Splitter_mjs-src_draggable_DragProxyContainer_mjs"), __webpack_require__.e("vendors-src_component_Markdown_mjs"), __webpack_require__.e("vendors-src_app_content_Container_mjs-src_selection_Model_mjs"), __webpack_require__.e("vendors-apps_portal_view_learn_MainContainer_mjs")]).then(__webpack_require__.bind(__webpack_require__, /*! ./learn/MainContainer.mjs */ "./apps/portal/view/learn/MainContainer.mjs"))},
                {module: () => Promise.all(/*! import() */[__webpack_require__.e("vendors-src_tab_Container_mjs"), __webpack_require__.e("apps_portal_view_news_TabContainer_mjs")]).then(__webpack_require__.bind(__webpack_require__, /*! ./news/TabContainer.mjs */ "./apps/portal/view/news/TabContainer.mjs"))},
                {module: () => __webpack_require__.e(/*! import() */ "apps_portal_view_services_Container_mjs").then(__webpack_require__.bind(__webpack_require__, /*! ./services/Container.mjs */ "./apps/portal/view/services/Container.mjs"))},
                {module: () => Promise.all(/*! import() */[__webpack_require__.e("vendors-src_data_Store_mjs"), __webpack_require__.e("vendors-src_list_Base_mjs"), __webpack_require__.e("vendors-src_tab_Container_mjs"), __webpack_require__.e("vendors-apps_portal_view_examples_TabContainer_mjs-src_selection_Model_mjs")]).then(__webpack_require__.bind(__webpack_require__, /*! ./examples/TabContainer.mjs */ "./apps/portal/view/examples/TabContainer.mjs"))},
                {module: () => __webpack_require__.e(/*! import() */ "apps_portal_view_about_Container_mjs").then(__webpack_require__.bind(__webpack_require__, /*! ./about/Container.mjs */ "./apps/portal/view/about/Container.mjs"))},
                {module: () => Promise.all(/*! import() */[__webpack_require__.e("vendors-src_form_field_Text_mjs"), __webpack_require__.e("vendors-src_form_field_Base_mjs"), __webpack_require__.e("vendors-src_data_Store_mjs"), __webpack_require__.e("vendors-src_list_Base_mjs"), __webpack_require__.e("vendors-src_draggable_DragZone_mjs"), __webpack_require__.e("vendors-src_tab_Container_mjs"), __webpack_require__.e("vendors-src_tree_List_mjs"), __webpack_require__.e("vendors-src_component_Splitter_mjs-src_draggable_DragProxyContainer_mjs"), __webpack_require__.e("vendors-docs_app_view_ApiTreeList_mjs-src_selection_Model_mjs"), __webpack_require__.e("vendors-docs_app_view_MainContainer_mjs")]).then(__webpack_require__.bind(__webpack_require__, /*! ../../../docs/app/view/MainContainer.mjs */ "./docs/app/view/MainContainer.mjs"))}
            ]
        }],
        /**
         * @member {Boolean} monitorSize=true
         * @reactive
         */
        monitorSize: true,
        /**
         * Values are: large, medium, small, xSmall
         * @member {String|null} size_=null
         * @reactive
         */
        size_: null,
        /**
         * @member {Neo.state.Provider} stateProvider=ViewportStateProvider
         * @reactive
         */
        stateProvider: _ViewportStateProvider_mjs__WEBPACK_IMPORTED_MODULE_5__["default"]
    }

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me = this;

        me.on('resize', me.onResize, me)
    }

    /**
     * Triggered after the size config got changed
     * @param {String|null} value
     * @param {String|null} oldValue
     * @protected
     */
    afterSetSize(value, oldValue) {
        if (value) {
            let me  = this,
                cls = me.cls;

            _src_util_Array_mjs__WEBPACK_IMPORTED_MODULE_3__["default"].remove(cls, 'portal-size-' + oldValue);
            _src_util_Array_mjs__WEBPACK_IMPORTED_MODULE_3__["default"].add(   cls, 'portal-size-' + value);
            me.cls = cls;

            me.stateProvider.setData({size: value});

            me.controller.size = value
        }
    }

    /**
     * Triggered before the size config gets changed
     * @param {String|null} value
     * @param {String|null} oldValue
     * @returns {String|null}
     * @protected
     */
    beforeSetSize(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'size')
    }

    /**
     * @param {Number} width
     * @returns {String}
     */
    getSize(width) {
        if (width <=  640) return 'x-small';
        if (width <= 1024) return 'small';
        if (width <= 1296) return 'medium';
        return 'large'
    }

    /**
     * @param {Object} data
     */
    onResize(data) {
        let me = this;

        if (me.id === data.id) {
            me.size = me.getSize(data.borderBoxSize.inlineSize)
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Viewport));


/***/ },

/***/ "./apps/portal/view/ViewportController.mjs"
/*!*************************************************!*\
  !*** ./apps/portal/view/ViewportController.mjs ***!
  \*************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_controller_Component_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/controller/Component.mjs */ "./src/controller/Component.mjs");
/* harmony import */ var _src_layout_Cube_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../src/layout/Cube.mjs */ "./src/layout/Cube.mjs");
/* harmony import */ var _src_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../src/util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _service_Seo_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../service/Seo.mjs */ "./apps/portal/service/Seo.mjs");





/**
 * @summary The main controller for the portal's viewport.
 *
 * This controller is the central hub for the portal application. It is responsible for:
 * - **Top-Level Routing:** It uses the `routes` config to map the main URL hash changes (e.g., /home, /learn, /blog) to specific methods, which in turn control which main view is active. It's important to note that while this controller handles the top-level navigation, child views can implement their own nested routing logic (see `Portal.view.learn.MainContainerController` for an example).
 * - **Layout Management:** It manages the main content area's layout, including the "mixed" mode which uses a CubeLayout for slick transitions between views.
 * - **SEO:** It coordinates with the `DocumentHead` main thread addon to update the document's title and meta tags on each route change, ensuring the application is SEO-friendly.
 * - **Multi-Window Coordination:** It handles the disconnection of child windows, such as the live code example previews.
 *
 * @class Portal.view.ViewportController
 * @extends Neo.controller.Component
 */
class ViewportController extends _src_controller_Component_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    /**
     * Valid values for mainContentLayout
     * @member {String[]} mainContentLayouts=['card','cube','mixed']
     * @protected
     * @static
     */
    static mainContentLayouts = ['card', 'cube', 'mixed']

    static config = {
        /**
         * @member {String} className='Portal.view.ViewportController'
         * @protected
         */
        className: 'Portal.view.ViewportController',
        /**
         * @member {String} ntype='viewport-controller'
         * @protected
         */
        ntype: 'viewport-controller',
        /**
         * @member {Number|null} activeIndex_=null
         * @reactive
         */
        activeIndex_: null,
        /**
         * @member {String|null} defaultHash='/home'
         */
        defaultHash: '/home',
        /**
         * @member {String} mainContentLayout_='card'
         * @reactive
         */
        mainContentLayout_: 'card',
        /**
         * @member {Object} routes
         */
        routes: {
            '/about-us'         : 'onAboutUsRoute',
            '/docs'             : 'onDocsRoute',
            '/examples'         : 'onExamplesRoute',
            '/examples/{itemId}': 'onExamplesRoute',
            '/home'             : 'onHomeRoute',
            '/learn'            : 'onLearnRoute',
            '/learn/{*itemId}'  : 'onLearnRoute',
            '/news'             : 'onNewsRoute',
            '/news/{*itemId}'   : 'onNewsRoute',
            '/services'         : 'onServicesRoute'
        },
        /**
         * Values are: large, medium, small, xSmall
         * @member {String|null} size_=null
         * @reactive
         */
        size_: null
    }

    /**
     * @member {String[]} connectedApps=[]
     */
    connectedApps = []
    /**
     * Internal flag to store the amount of main navigation changes
     * @member {Number} #transitionId=0
     * @private
     */
    #transitionId = 0

    /**
     * Triggered after the size activeIndex got changed
     * @param {Number|null} value
     * @param {Number|null} oldValue
     * @protected
     */
    afterSetActiveIndex(value, oldValue) {
        value !== null && this.updateHeaderToolbar()
    }

    /**
     * Triggered after the mainContentLayout config got changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetMainContentLayout(value, oldValue) {
        let me                      = this,
            {activeIndex, windowId} = me,
            container               = me.component.getItem('main-content'); // happens before instantiation

        if (oldValue === undefined) {
            // We can not turn this method itself into async and await the addon response,
            // since the container needs its layout right away
            Neo.main.addon.LocalStorage.readLocalStorageItem({
                key: 'mainContentLayout',
                windowId
            }).then(({value}) => {
                if (value && value !== 'card') {
                    me.mainContentLayout = value
                }
            })
        }

        if (value === 'cube') {
            container.layout = {ntype: 'cube', activeIndex, fitContainer: true, hideInactiveCardsOnDestroy: true}
        } else {
            container.layout = {ntype: 'card', activeIndex}
        }

        Neo.main.addon.LocalStorage.updateLocalStorageItem({key: 'mainContentLayout', value, windowId})
    }

    /**
     * Triggered after the size config got changed
     * @param {String|null} value
     * @param {String|null} oldValue
     * @protected
     */
    afterSetSize(value, oldValue) {
        value && this.updateHeaderToolbar()
    }

    /**
     * Triggered before the mainContentLayout config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetMainContentLayout(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'mainContentLayout')
    }

    /**
     * The route handlers (e.g., onAboutUsRoute, onBlogRoute) are now only responsible for
     * setting the main content index. The logic for updating the document head is centralized
     * in the onHashChange method.
     * @param {Object} params
     * @param {Object} value
     * @param {Object} oldValue
     */
    onAboutUsRoute(params, value, oldValue) {
        this.setMainContentIndex(5)
    }

    /**
     * @param {Object} data
     * @param {String} data.appName
     * @param {Number} data.windowId
     */
    async onAppDisconnect({appName, windowId}) {
        // Close popup windows when closing or reloading the main window
        if (appName === 'Portal') {
            Neo.Main.windowCloseAll({windowId})
        }
    }

    /**
     * @param {Object} data
     */
    onMediumSearchFieldChange(data) {
        this.getReference('medium-list').filterItems(data)
    }

    /**
     *
     */
    onConstructed() {
        super.onConstructed();

        let me = this;

        Neo.currentWorker.on({
            disconnect: me.onAppDisconnect,
            scope     : me
        });

        Neo.main.addon.LocalStorage.readLocalStorageItem({
            key     : 'portalTheme',
            windowId: me.windowId
        }).then(({value}) => {
            if (value) {
                me.setTheme(value, false)
            } else if (Neo.config.prefersDarkTheme) {
                me.setTheme('neo-theme-neo-dark', false)
            }
        })
    }

    /**
     * @param {Object} params
     * @param {Object} value
     * @param {Object} oldValue
     */
    onDocsRoute(params, value, oldValue) {
        this.setMainContentIndex(6)
    }

    /**
     * @param {Object} params
     * @param {Object} value
     * @param {Object} oldValue
     */
    onExamplesRoute(params, value, oldValue) {
        this.setMainContentIndex(4)
    }

    /**
     * This is the central handler for all route changes. It is now responsible for delegating
     * the document's head metadata (title and description) updates to the `Portal.service.Seo` service.
     * @param {Object} value               The new route object.
     * @param {String} value.hashString    The new hash string.
     * @param {Object} oldValue            The previous route object.
     * @param {String} oldValue.hashString The previous hash string.
     * @returns {Promise<void>}
     */
    async onHashChange(value, oldValue) {
        await super.onHashChange(value, oldValue);
        _service_Seo_mjs__WEBPACK_IMPORTED_MODULE_3__["default"].onRouteChanged(value)
    }

    /**
     * @param {Object} params
     * @param {Object} value
     * @param {Object} oldValue
     */
    onHomeRoute(params, value, oldValue) {
        this.setMainContentIndex(0)
    }

    /**
     * @param {Object} params
     * @param {Object} value
     * @param {Object} oldValue
     */
    onLearnRoute(params, value, oldValue) {
        this.setMainContentIndex(1)
    }

    /**
     * @param {Object} params
     * @param {Object} value
     * @param {Object} oldValue
     */
    onNewsRoute(params, value, oldValue) {
        this.setMainContentIndex(2)
    }

    /**
     * @param {Object} params
     * @param {Object} value
     * @param {Object} oldValue
     */
    onServicesRoute(params, value, oldValue) {
        this.setMainContentIndex(3)
    }

    /**
     * @param {Object} data
     */
    async onSwitchTheme(data) {
        let me       = this,
            viewport = me.component,
            oldTheme = viewport.theme || 'neo-theme-neo-light',
            newTheme = oldTheme === 'neo-theme-neo-light' ? 'neo-theme-neo-dark' : 'neo-theme-neo-light',
            radius, x, y;

        if (data.clientX) {
            x      = data.clientX;
            y      = data.clientY;
            radius = Math.hypot(Math.max(x, 3000 - x), Math.max(y, 3000 - y)) // simplified max calculation
        }

        await Neo.main.DomAccess.startViewTransition({
            animate: {
                keyframes: [
                    {clipPath: `circle(0px at ${x}px ${y}px)`},
                    {clipPath: `circle(${radius}px at ${x}px ${y}px)`}
                ],
                options: {
                    duration     : 500,
                    easing       : 'ease-in',
                    pseudoElement: '::view-transition-new(root)'
                }
            },
            delay   : 100,
            windowId: me.windowId
        });

        me.setTheme(newTheme)
    }

    /**
     * This method orchestrates the visual transition between the main content cards.
     * It uses a "mixed" layout mode, which temporarily switches to a CubeLayout for
     * a 3D transition effect, and then back to a CardLayout for performance.
     * @param {Number} index
     */
    async setMainContentIndex(index) {
        let me                               = this,
            {activeIndex, mainContentLayout} = me,
            container                        = me.getReference('main-content'),
            updateLayout                     = true,
            transitionId;

        if (index !== activeIndex) {
            me.activeIndex = index;

            if (
                mainContentLayout === 'mixed' &&
                // skip the initial layout-switch, since we do not need a transition
                Neo.isNumber(activeIndex) &&
                // also skip the layout switch in case the index >= 6, since a cube only has 6 faces
                index < 6 &&
                // also skip the layout switch in case we navigate back from a non-cube item
                activeIndex < 6
            ) {
                me.#transitionId++;

                transitionId = me.#transitionId;
                updateLayout = false;

                // enable "fast clicking" on main nav items => do not replace a cube layout with a new instance of cube
                if (container.layout.ntype !== 'layout-cube') {
                    await container.set({
                        layout: {ntype: 'cube', activeIndex, fitContainer: true, hideInactiveCardsOnDestroy: true}
                    });
                    await me.timeout(20)
                }

                container.layout.activeIndex = index;

                await me.timeout(1100);

                if (transitionId === me.#transitionId) {
                    await container.set({
                        layout: {ntype: 'card', activeIndex: index}
                    });
                    await me.timeout(20)
                }
            }

            if (updateLayout) {
                container.layout.activeIndex = index
            }
        }
    }

    /**
     * @param {String} theme
     * @param {Boolean} [updateStorage=true]
     */
    setTheme(theme, updateStorage=true) {
        let me      = this,
            btn     = me.getReference('theme-switch-button'),
            iconCls = theme === 'neo-theme-neo-dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';

        me.component.theme = theme;

        if (btn) {
            btn.iconCls = iconCls
        }

        if (updateStorage) {
            Neo.main.addon.LocalStorage.updateLocalStorageItem({
                key     : 'portalTheme',
                value   : theme,
                windowId: me.windowId
            })
        }
    }

    /**
     *
     */
    async updateHeaderToolbar() {
        let me                  = this,
            {activeIndex, size} = me;

        if (Neo.isNumber(activeIndex) && size) {
            let headerSocialIcons = me.getReference('header-social-icons'),
                {cls}             = headerSocialIcons,
                vertical          = size === 'x-small',
                hidden            = activeIndex !== 0 && vertical;

            _src_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].toggle(cls, 'hide-sidebar', hidden);

            if (!hidden) {
                _src_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].toggle(cls, 'separate-bar', vertical)
            }

            headerSocialIcons.cls = cls;


            if (hidden && vertical) {
                await me.timeout(200)
            }

            headerSocialIcons.hidden = hidden
        }

        if (Neo.isNumber(activeIndex)) {
            let headerCanvas = me.getReference('header-canvas'),
                refs         = ['home-button', 'learn-button', 'news-header-button', 'services-button', 'examples-button'],
                activeBtn    = me.getReference(refs[activeIndex]);

            if (headerCanvas) {
                headerCanvas.activeId = activeBtn?.id || null
            }
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(ViewportController));


/***/ },

/***/ "./apps/portal/view/ViewportStateProvider.mjs"
/*!****************************************************!*\
  !*** ./apps/portal/view/ViewportStateProvider.mjs ***!
  \****************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_state_Provider_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/state/Provider.mjs */ "./src/state/Provider.mjs");


/**
 * @class Portal.view.ViewportStateProvider
 * @extends Neo.state.Provider
 */
class ViewportStateProvider extends _src_state_Provider_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Portal.view.ViewportStateProvider'
         * @protected
         */
        className: 'Portal.view.ViewportStateProvider',
        /**
         * @member {Object} data
         */
        data: {
            /**
             * @member {Number|null} blogPostCount=null
             */
            blogPostCount: null,
            /**
             * Values are: large, medium, small, xSmall, null
             * @member {String|null} size
             */
            size: null
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(ViewportStateProvider));


/***/ }

};

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLWFwcHNfcG9ydGFsX2FwcF9tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUVBQWUsY0FBYyxFQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztBQ1ZZO0FBQ0c7O0FBRXRDO0FBQ1AsY0FBYywwREFBUTtBQUN0QjtBQUNBLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7QUNONkM7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDBEQUFJO0FBQ3RCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixhQUFhO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixhQUFhO0FBQzdCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QixlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsaUJBQWlCLGFBQWE7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixlQUFlO0FBQ2hDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsZ0JBQWdCO0FBQzNFO0FBQ0E7QUFDQSxVQUFV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RUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lby5tanMvLi9hcHBzL3BvcnRhbC9PdmVyd3JpdGVzLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vYXBwcy9wb3J0YWwvYXBwLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vYXBwcy9wb3J0YWwvc2VydmljZS9TZW8ubWpzIiwid2VicGFjazovL25lby5tanMvLi9hcHBzL3BvcnRhbC92aWV3L0hlYWRlclRvb2xiYXIubWpzIiwid2VicGFjazovL25lby5tanMvLi9hcHBzL3BvcnRhbC92aWV3L1ZpZXdwb3J0Lm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vYXBwcy9wb3J0YWwvdmlldy9WaWV3cG9ydENvbnRyb2xsZXIubWpzIiwid2VicGFjazovL25lby5tanMvLi9hcHBzL3BvcnRhbC92aWV3L1ZpZXdwb3J0U3RhdGVQcm92aWRlci5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiTmVvLm92ZXJ3cml0ZXMgPSB7XG4gICAgTmVvOiB7XG4gICAgICAgIGJ1dHRvbjoge1xuICAgICAgICAgICAgQmFzZToge1xuICAgICAgICAgICAgICAgIGVkaXRSb3V0ZTogZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLm92ZXJ3cml0ZXM7XG4iLCJpbXBvcnQgT3ZlcndyaXRlcyBmcm9tICcuL092ZXJ3cml0ZXMubWpzJztcbmltcG9ydCBWaWV3cG9ydCAgIGZyb20gJy4vdmlldy9WaWV3cG9ydC5tanMnO1xuXG5leHBvcnQgY29uc3Qgb25TdGFydCA9ICgpID0+IE5lby5hcHAoe1xuICAgIG1haW5WaWV3OiBWaWV3cG9ydCxcbiAgICBuYW1lICAgIDogJ1BvcnRhbCdcbn0pXG4iLCJpbXBvcnQgQmFzZSBmcm9tICcuLi8uLi8uLi9zcmMvY29yZS9CYXNlLm1qcyc7XG5cbi8qKlxuICogQHN1bW1hcnkgTWFuYWdlcyBTRU8gbWV0YWRhdGEgZm9yIHRoZSBQb3J0YWwgYXBwbGljYXRpb24sIGZldGNoaW5nIGl0IGZyb20gYSBKU09OIGZpbGVcbiAqIGFuZCBpbnRlbGxpZ2VudGx5IHVwZGF0aW5nIHRoZSBkb2N1bWVudCBoZWFkIGJhc2VkIG9uIHJvdXRlIGNoYW5nZXMuXG4gKlxuICogVGhpcyBzaW5nbGV0b24gc2VydmljZSBpcyByZXNwb25zaWJsZSBmb3IgY2VudHJhbGl6aW5nIGFsbCBTRU8tcmVsYXRlZCBsb2dpYy5cbiAqIEl0IGZldGNoZXMgcm91dGUtc3BlY2lmaWMgdGl0bGUgYW5kIGRlc2NyaXB0aW9uIG1ldGFkYXRhIGZyb20gYGFwcHMvcG9ydGFsL3Jlc291cmNlcy9kYXRhL3Nlby5qc29uYFxuICogZHVyaW5nIGl0cyBhc3luY2hyb25vdXMgaW5pdGlhbGl6YXRpb24uIEl0IHRoZW4gcHJvdmlkZXMgYSBtZWNoYW5pc20gZm9yIHRoZSBgVmlld3BvcnRDb250cm9sbGVyYFxuICogdG8gbm90aWZ5IGl0IG9mIHJvdXRlIGNoYW5nZXMuIFRoZSBzZXJ2aWNlIGVuc3VyZXMgdGhhdCB0aGUgZG9jdW1lbnQncyBgPHRpdGxlPmAgYW5kIGA8bWV0YSBuYW1lPVwiZGVzY3JpcHRpb25cIj5gXG4gKiB0YWdzIGFyZSB1cGRhdGVkIG9ubHkgd2hlbiB0aGUgc2VydmljZSBpcyBmdWxseSByZWFkeSBhbmQgd2l0aCB0aGUgbW9zdCByZWNlbnQgcm91dGUgaGFzaCxcbiAqIHByZXZlbnRpbmcgcmFjZSBjb25kaXRpb25zIG9uIHNsb3cgbmV0d29yayBjb25uZWN0aW9ucy5cbiAqXG4gKiBUaGlzIGNsYXNzIGRlbW9uc3RyYXRlcyB0aGUgdXNlIG9mIGFzeW5jaHJvbm91cyBpbml0aWFsaXphdGlvbiAoYGluaXRBc3luY2ApLCByZWFjdGl2ZSBjb25maWcgaG9va3MgKGBhZnRlclNldElzUmVhZHlgKSxcbiAqIGFuZCBwcml2YXRlIGNsYXNzIGZpZWxkcyB0byBtYW5hZ2UgaW50ZXJuYWwgc3RhdGUgYW5kIGVuc3VyZSByb2J1c3QgYmVoYXZpb3IuXG4gKlxuICogQGNsYXNzIFBvcnRhbC5zZXJ2aWNlLlNlb1xuICogQGV4dGVuZHMgTmVvLmNvcmUuQmFzZVxuICogQHNpbmdsZXRvblxuICogQHNlZSBQb3J0YWwudmlldy5WaWV3cG9ydENvbnRyb2xsZXJcbiAqL1xuY2xhc3MgU2VvIGV4dGVuZHMgQmFzZSB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdQb3J0YWwuc2VydmljZS5TZW8nXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ1BvcnRhbC5zZXJ2aWNlLlNlbycsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBzaW5nbGV0b249dHJ1ZVxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBzaW5nbGV0b246IHRydWVcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdG9yZXMgdGhlIG1vc3QgcmVjZW50IHJvdXRlIHJlY2VpdmVkIGZyb20gYG9uUm91dGVDaGFuZ2VkKClgLlxuICAgICAqIFRoaXMgaXMgdXNlZCB0byBwcm9jZXNzIGEgcGVuZGluZyByb3V0ZSB1cGRhdGUgaWYgdGhlIHNlcnZpY2UgYmVjb21lcyByZWFkeSBhZnRlciBhIHJvdXRlIGNoYW5nZSBvY2N1cnJlZC5cbiAgICAgKiBAbWVtYmVyIHtPYmplY3R8bnVsbH0gI2xhc3RSb3V0ZUhhc2g9bnVsbFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgI2xhc3RSb3V0ZSA9IG51bGxcbiAgICAvKipcbiAgICAgKiBDYWNoZXMgdGhlIFNFTyBtZXRhZGF0YSBmZXRjaGVkIGZyb20gYGFwcHMvcG9ydGFsL3Jlc291cmNlcy9kYXRhL3Nlby5qc29uYC5cbiAgICAgKiBUaGlzIG9iamVjdCBtYXBzIHJvdXRlIGhhc2ggc3RyaW5ncyB0byB0aGVpciBjb3JyZXNwb25kaW5nIHRpdGxlIGFuZCBkZXNjcmlwdGlvbi5cbiAgICAgKiBAbWVtYmVyIHtPYmplY3R8bnVsbH0gI21ldGFkYXRhPW51bGxcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgICNtZXRhZGF0YSA9IG51bGxcblxuICAgIC8qKlxuICAgICAqIEhvb2sgdGhhdCBmaXJlcyBhZnRlciB0aGUgYGlzUmVhZHlgIGNvbmZpZyBjaGFuZ2VzLiBJZiB0aGUgc2VydmljZSBiZWNvbWVzIHJlYWR5IChgdmFsdWVgIGlzIHRydWUpXG4gICAgICogYW5kIHRoZXJlJ3MgYSBwZW5kaW5nIHJvdXRlIGhhc2ggKGAjbGFzdFJvdXRlSGFzaGAgaXMgbm90IG51bGwpLCBpdCB0cmlnZ2VycyBhbiB1cGRhdGVcbiAgICAgKiBvZiB0aGUgZG9jdW1lbnQgaGVhZCB3aXRoIHRoZSBtZXRhZGF0YSBmb3IgdGhhdCByb3V0ZS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHZhbHVlIFRoZSBuZXcgdmFsdWUgb2YgdGhlIGBpc1JlYWR5YCBjb25maWcuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBvbGRWYWx1ZSBUaGUgb2xkIHZhbHVlIG9mIHRoZSBgaXNSZWFkeWAgY29uZmlnLlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldElzUmVhZHkodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAmJiB0aGlzLiNsYXN0Um91dGUpIHtcbiAgICAgICAgICAgIHRoaXMuI3VwZGF0ZURvY3VtZW50SGVhZElmTmVlZGVkKHRoaXMuI2xhc3RSb3V0ZSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyB0aGUgU0VPIG1ldGFkYXRhICh0aXRsZSBhbmQgZGVzY3JpcHRpb24pIGZvciBhIGdpdmVuIHJvdXRlIGhhc2guXG4gICAgICogU3VwcG9ydHMgbmVzdGVkIHJvdXRlcyBieSBmYWxsaW5nIGJhY2sgdG8gcGFyZW50IHBhdGhzIGlmIGFuIGV4YWN0IG1hdGNoIGlzIG5vdCBmb3VuZC5cbiAgICAgKiBlLmcuLCAnL25ld3MvYmxvZy9teS1wb3N0JyAtPiAnL25ld3MvYmxvZycgLT4gJy9uZXdzJ1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSByb3V0ZSBUaGUgcm91dGUgaGFzaCBzdHJpbmcgKGUuZy4sICcvaG9tZScsICcvYmxvZycpLlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R8bnVsbH0gQW4gb2JqZWN0IGNvbnRhaW5pbmcgYHRpdGxlYCBhbmQgYGRlc2NyaXB0aW9uYCBmb3IgdGhlIHJvdXRlLCBvciBgbnVsbGAgaWYgbm90IGZvdW5kLlxuICAgICAqL1xuICAgIGdldE1ldGFkYXRhKHJvdXRlKSB7XG4gICAgICAgIGxldCBtZXRhZGF0YSA9IHRoaXMuI21ldGFkYXRhLFxuICAgICAgICAgICAgcGFydHM7XG5cbiAgICAgICAgaWYgKCFtZXRhZGF0YSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgaWYgKG1ldGFkYXRhW3JvdXRlXSkge1xuICAgICAgICAgICAgcmV0dXJuIG1ldGFkYXRhW3JvdXRlXVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmFsbGJhY2sgbG9naWMgZm9yIG5lc3RlZCByb3V0ZXNcbiAgICAgICAgcGFydHMgPSByb3V0ZS5zcGxpdCgnLycpO1xuXG4gICAgICAgIHdoaWxlIChwYXJ0cy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBwYXJ0cy5wb3AoKTtcbiAgICAgICAgICAgIHJvdXRlID0gcGFydHMuam9pbignLycpO1xuXG4gICAgICAgICAgICBpZiAobWV0YWRhdGFbcm91dGVdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1ldGFkYXRhW3JvdXRlXVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3luY2hyb25vdXNseSBpbml0aWFsaXplcyB0aGUgU0VPIHNlcnZpY2UgYnkgZmV0Y2hpbmcgdGhlIGBzZW8uanNvbmAgZmlsZS5cbiAgICAgKiBUaGlzIG1ldGhvZCBzaW11bGF0ZXMgYW4gQVBJIGNhbGwgdG8gcmV0cmlldmUgU0VPIGRhdGEsIG1ha2luZyB0aGUgc2VydmljZSByZWFkeVxuICAgICAqIHRvIHByb3ZpZGUgbWV0YWRhdGEuIEl0IGVuc3VyZXMgdGhhdCB0aGUgc2VydmljZSBpcyBmdWxseSBsb2FkZWQgYmVmb3JlIHByb2Nlc3NpbmdcbiAgICAgKiBhbnkgcm91dGUtcmVsYXRlZCBkb2N1bWVudCBoZWFkIHVwZGF0ZXMuXG4gICAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIG1ldGFkYXRhIGhhcyBiZWVuIGZldGNoZWQgYW5kIHBhcnNlZC5cbiAgICAgKi9cbiAgICBhc3luYyBpbml0QXN5bmMoKSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmluaXRBc3luYygpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKE5lby5jb25maWcuYmFzZVBhdGggKyAnYXBwcy9wb3J0YWwvcmVzb3VyY2VzL2RhdGEvc2VvLmpzb24nKTtcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3Igd2l0aCBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfWApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLiNtZXRhZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgU0VPIG1ldGFkYXRhOicsIGVycm9yKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIGJ5IHRoZSBgVmlld3BvcnRDb250cm9sbGVyYCB3aGVuIHRoZSBhcHBsaWNhdGlvbidzIHJvdXRlIGNoYW5nZXMuXG4gICAgICogVGhpcyBtZXRob2Qgc3RvcmVzIHRoZSBuZXcgcm91dGUgaGFzaCBhbmQgYXR0ZW1wdHMgdG8gdXBkYXRlIHRoZSBkb2N1bWVudCBoZWFkLlxuICAgICAqIElmIHRoZSBzZXJ2aWNlIGlzIG5vdCB5ZXQgcmVhZHkgKGkuZS4sIGBpbml0QXN5bmNgIGlzIHN0aWxsIHJ1bm5pbmcpLCB0aGUgdXBkYXRlXG4gICAgICogaXMgZGVmZXJyZWQgdW50aWwgYGlzUmVhZHlgIGJlY29tZXMgdHJ1ZS5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnICAgICAgICAgIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gY29uZmlnLmhhc2ggICAgIFRoZSBuZXcgcm91dGUgaGFzaCBzdHJpbmcuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGNvbmZpZy53aW5kb3dJZCBUaGUgd2luZG93SWQgbWF0Y2hpbmcgdGhlIHJvdXRlLlxuICAgICAqL1xuICAgIG9uUm91dGVDaGFuZ2VkKGNvbmZpZykge1xuICAgICAgICB0aGlzLiNsYXN0Um91dGUgPSBjb25maWc7XG4gICAgICAgIHRoaXMuI3VwZGF0ZURvY3VtZW50SGVhZElmTmVlZGVkKGNvbmZpZylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIHByaXZhdGUgbWV0aG9kIGNhbGxzIHRoZSBgRG9jdW1lbnRIZWFkYCBtYWluIHRocmVhZCBhZGRvbiB0byB1cGRhdGUgdGhlIGRvY3VtZW50J3NcbiAgICAgKiB0aXRsZSBhbmQgbWV0YS1kZXNjcmlwdGlvbiBmb3IgU0VPIHB1cnBvc2VzLiBJdCBpcyB0aGUgYWN0dWFsIG1lY2hhbmlzbSBmb3IgYXBwbHlpbmdcbiAgICAgKiB0aGUgU0VPIGNoYW5nZXMgdG8gdGhlIGJyb3dzZXIncyBET00uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBUaGUgY29uZmlndXJhdGlvbiBvYmplY3QgY29udGFpbmluZyBgZGVzY3JpcHRpb25gIGFuZCBgdGl0bGVgLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb25maWcuZGVzY3JpcHRpb24gVGhlIG5ldyBtZXRhLWRlc2NyaXB0aW9uIGZvciB0aGUgZG9jdW1lbnQuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGNvbmZpZy50aXRsZSBUaGUgbmV3IHRpdGxlIGZvciB0aGUgZG9jdW1lbnQuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGNvbmZpZy53aW5kb3dJZCBUaGUgbmV3IHRpdGxlIGZvciB0aGUgZG9jdW1lbnQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBhc3luYyAjdXBkYXRlRG9jdW1lbnRIZWFkKHtkZXNjcmlwdGlvbiwgdGl0bGUsIHdpbmRvd0lkfSkge1xuICAgICAgICBsZXQgRG9jdW1lbnRIZWFkID0gYXdhaXQgTmVvLmN1cnJlbnRXb3JrZXIuZ2V0QWRkb24oJ0RvY3VtZW50SGVhZCcsIHdpbmRvd0lkKTtcbiAgICAgICAgYXdhaXQgRG9jdW1lbnRIZWFkLnVwZGF0ZSh7ZGVzY3JpcHRpb24sIHRpdGxlLCB3aW5kb3dJZH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQSBwcml2YXRlIGhlbHBlciBtZXRob2QgdGhhdCBjb25kaXRpb25hbGx5IHVwZGF0ZXMgdGhlIGRvY3VtZW50IGhlYWQuXG4gICAgICogSXQgY2hlY2tzIGlmIHRoZSBzZXJ2aWNlIGlzIGBpc1JlYWR5YCBiZWZvcmUgYXR0ZW1wdGluZyB0byByZXRyaWV2ZSBtZXRhZGF0YVxuICAgICAqIGFuZCBjYWxsIGAjdXBkYXRlRG9jdW1lbnRIZWFkYC4gSWYgYW4gdXBkYXRlIG9jY3VycywgaXQgY2xlYXJzIGAjbGFzdFJvdXRlSGFzaGAuXG4gICAgICogVGhpcyBwcmV2ZW50cyBtdWx0aXBsZSB1cGRhdGVzIGZvciB0aGUgc2FtZSByb3V0ZSBpZiBgb25Sb3V0ZUNoYW5nZWRgIGlzIGNhbGxlZFxuICAgICAqIGJlZm9yZSBgaW5pdEFzeW5jYCBjb21wbGV0ZXMuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBUaGUgcm91dGUgaGFzaCBmb3Igd2hpY2ggdG8gdXBkYXRlIHRoZSBkb2N1bWVudCBoZWFkLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgI3VwZGF0ZURvY3VtZW50SGVhZElmTmVlZGVkKGNvbmZpZykge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGlmIChtZS5pc1JlYWR5KSB7XG4gICAgICAgICAgICBsZXQgbWV0YWRhdGEgPSBtZS5nZXRNZXRhZGF0YShjb25maWcuaGFzaFN0cmluZyk7XG5cbiAgICAgICAgICAgIGlmIChtZXRhZGF0YSkge1xuICAgICAgICAgICAgICAgIG1lLiN1cGRhdGVEb2N1bWVudEhlYWQoey4uLm1ldGFkYXRhLCB3aW5kb3dJZDogY29uZmlnLndpbmRvd0lkfSk7XG4gICAgICAgICAgICAgICAgbWUuI2xhc3RSb3V0ZSA9IG51bGxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoU2VvKTtcbiIsImltcG9ydCBCYXNlSGVhZGVyVG9vbGJhciBmcm9tICcuLi8uLi8uLi9zcmMvYXBwL2hlYWRlci9Ub29sYmFyLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIFBvcnRhbC52aWV3LkhlYWRlclRvb2xiYXJcbiAqIEBleHRlbmRzIE5lby5hcHAuaGVhZGVyLlRvb2xiYXJcbiAqL1xuY2xhc3MgSGVhZGVyVG9vbGJhciBleHRlbmRzIEJhc2VIZWFkZXJUb29sYmFyIHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J1BvcnRhbC52aWV3LkhlYWRlclRvb2xiYXInXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ1BvcnRhbC52aWV3LkhlYWRlclRvb2xiYXInLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nW119IGNscz1bJ3BvcnRhbC1oZWFkZXItdG9vbGJhciddXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgY2xzOiBbJ3BvcnRhbC1oZWFkZXItdG9vbGJhciddLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0W119IGl0ZW1zXG4gICAgICAgICAqL1xuICAgICAgICBpdGVtczogW3tcbiAgICAgICAgICAgIGNscyAgICAgOiBbJ2xvZ28nXSxcbiAgICAgICAgICAgIGljb25DbHMgOiAnbmVvLWxvZ28tYmx1ZScsXG4gICAgICAgICAgICBtaW5XaWR0aDogNjAsXG4gICAgICAgICAgICByZWZlcmVuY2U6ICdob21lLWJ1dHRvbicsXG4gICAgICAgICAgICByb3V0ZSAgIDogJy9ob21lJyxcbiAgICAgICAgICAgIHRleHQgICAgOiAnTmVvLm1qcydcbiAgICAgICAgfSwgJy0+Jywge1xuICAgICAgICAgICAgcmVmZXJlbmNlOiAnbGVhcm4tYnV0dG9uJyxcbiAgICAgICAgICAgIHRleHQgICAgIDogJ0xlYXJuJyxcbiAgICAgICAgICAgIHJvdXRlICAgIDogJy9sZWFybidcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgYmluZCAgICAgOiB7YmFkZ2VUZXh0OiAnYmxvZ1Bvc3RDb3VudCd9LFxuICAgICAgICAgICAgcmVmZXJlbmNlOiAnbmV3cy1oZWFkZXItYnV0dG9uJyxcbiAgICAgICAgICAgIHJvdXRlICAgIDogJy9uZXdzJyxcbiAgICAgICAgICAgIHRleHQgICAgIDogJ05ld3MnXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHJlZmVyZW5jZTogJ2V4YW1wbGVzLWJ1dHRvbicsXG4gICAgICAgICAgICByb3V0ZSAgICA6ICcvZXhhbXBsZXMnLFxuICAgICAgICAgICAgdGV4dCAgICAgOiAnRXhhbXBsZXMnXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHJlZmVyZW5jZTogJ3NlcnZpY2VzLWJ1dHRvbicsXG4gICAgICAgICAgICByb3V0ZSAgICA6ICcvc2VydmljZXMnLFxuICAgICAgICAgICAgdGV4dCAgICAgOiAnU2VydmljZXMnXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG50eXBlICAgIDogJ2NvbnRhaW5lcicsXG4gICAgICAgICAgICBsYXlvdXQgICA6ICdoYm94JyxcbiAgICAgICAgICAgIHJlZmVyZW5jZTogJ2hlYWRlci1zb2NpYWwtaWNvbnMnLFxuXG4gICAgICAgICAgICBpdGVtRGVmYXVsdHM6IHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiAnb25CdXR0b25DbGljaycsXG4gICAgICAgICAgICAgICAgbnR5cGUgIDogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgdWkgICAgIDogJ2dob3N0J1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaXRlbXM6IFt7XG4gICAgICAgICAgICAgICAgaGFuZGxlcjogJ29uU3dpdGNoVGhlbWUnLFxuICAgICAgICAgICAgICAgIGljb25DbHM6ICdmYS1zb2xpZCBmYS1tb29uJyxcbiAgICAgICAgICAgICAgICByZWZlcmVuY2U6ICd0aGVtZS1zd2l0Y2gtYnV0dG9uJyxcbiAgICAgICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQgICAgIDogJ1N3aXRjaCBUaGVtZScsXG4gICAgICAgICAgICAgICAgICAgIHNob3dEZWxheTogMCxcbiAgICAgICAgICAgICAgICAgICAgaGlkZURlbGF5OiAwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGljb25DbHM6ICdmYS1icmFuZHMgZmEtZ2l0aHViJyxcbiAgICAgICAgICAgICAgICB1cmwgICAgOiAnaHR0cHM6Ly9naXRodWIuY29tL25lb21qcy9uZW8nLFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCAgICAgOiAnR2l0SHViJyxcbiAgICAgICAgICAgICAgICAgICAgc2hvd0RlbGF5OiAwLFxuICAgICAgICAgICAgICAgICAgICBoaWRlRGVsYXk6IDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaWNvbkNsczogJ2ZhLWJyYW5kcyBmYS1kaXNjb3JkJyxcbiAgICAgICAgICAgICAgICB1cmwgICAgOiAnaHR0cHM6Ly9kaXNjb3JkLmdnLzZwOHBhUHEnLFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCAgICAgOiAnSm9pbiBEaXNjb3JkJyxcbiAgICAgICAgICAgICAgICAgICAgc2hvd0RlbGF5OiAwLFxuICAgICAgICAgICAgICAgICAgICBoaWRlRGVsYXk6IDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XVxuICAgICAgICB9XVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoSGVhZGVyVG9vbGJhcik7XG4iLCJpbXBvcnQgQmFzZVZpZXdwb3J0ICAgICAgICAgIGZyb20gJy4uLy4uLy4uL3NyYy9jb250YWluZXIvVmlld3BvcnQubWpzJztcbmltcG9ydCBDb250YWluZXIgICAgICAgICAgICAgZnJvbSAnLi4vLi4vLi4vc3JjL2NvbnRhaW5lci9CYXNlLm1qcyc7XG5pbXBvcnQgSGVhZGVyVG9vbGJhciAgICAgICAgIGZyb20gJy4vSGVhZGVyVG9vbGJhci5tanMnO1xuaW1wb3J0IE5lb0FycmF5ICAgICAgICAgICAgICBmcm9tICcuLi8uLi8uLi9zcmMvdXRpbC9BcnJheS5tanMnO1xuaW1wb3J0IFZpZXdwb3J0Q29udHJvbGxlciAgICBmcm9tICcuL1ZpZXdwb3J0Q29udHJvbGxlci5tanMnO1xuaW1wb3J0IFZpZXdwb3J0U3RhdGVQcm92aWRlciBmcm9tICcuL1ZpZXdwb3J0U3RhdGVQcm92aWRlci5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBQb3J0YWwudmlldy5WaWV3cG9ydFxuICogQGV4dGVuZHMgTmVvLmNvbnRhaW5lci5WaWV3cG9ydFxuICovXG5jbGFzcyBWaWV3cG9ydCBleHRlbmRzIEJhc2VWaWV3cG9ydCB7XG4gICAgLyoqXG4gICAgICogVmFsaWQgdmFsdWVzIGZvciBzaXplXG4gICAgICogQG1lbWJlciB7U3RyaW5nW119IHNpemVzPVsnbGFyZ2UnLCdtZWRpdW0nLCdzbWFsbCcsJ3gtc21hbGwnLG51bGxdXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqIEBzdGF0aWNcbiAgICAgKi9cbiAgICBzdGF0aWMgc2l6ZXMgPSBbJ2xhcmdlJywgJ21lZGl1bScsICdzbWFsbCcsICd4LXNtYWxsJywgbnVsbF1cblxuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nUG9ydGFsLnZpZXcuVmlld3BvcnQnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ1BvcnRhbC52aWV3LlZpZXdwb3J0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge05lby5jb250cm9sbGVyLkNvbXBvbmVudH0gY29udHJvbGxlcj1WaWV3cG9ydENvbnRyb2xsZXJcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBjb250cm9sbGVyOiBWaWV3cG9ydENvbnRyb2xsZXIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGxheW91dD17bnR5cGU6J3Zib3gnLGFsaWduOidzdHJldGNoJ31cbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBsYXlvdXQ6IHtudHlwZTogJ3Zib3gnLCBhbGlnbjogJ3N0cmV0Y2gnfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdFtdfSBpdGVtc1xuICAgICAgICAgKi9cbiAgICAgICAgaXRlbXM6IFt7XG4gICAgICAgICAgICBtb2R1bGU6IEhlYWRlclRvb2xiYXIsXG4gICAgICAgICAgICBmbGV4ICA6ICdub25lJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBtb2R1bGUgICA6IENvbnRhaW5lcixcbiAgICAgICAgICAgIGNscyAgICAgIDogWydwb3J0YWwtbWFpbi1jb250ZW50J10sXG4gICAgICAgICAgICByZWZlcmVuY2U6ICdtYWluLWNvbnRlbnQnLFxuXG4gICAgICAgICAgICAvLyBUaGUgbGF5b3V0IHdpbGwgZ2V0IGFzc2lnbmVkIGluc2lkZSBWaWV3cG9ydENvbnRyb2xsZXJcblxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgICB7bW9kdWxlOiAoKSA9PiBpbXBvcnQoJy4vaG9tZS9NYWluQ29udGFpbmVyLm1qcycpfSxcbiAgICAgICAgICAgICAgICB7bW9kdWxlOiAoKSA9PiBpbXBvcnQoJy4vbGVhcm4vTWFpbkNvbnRhaW5lci5tanMnKX0sXG4gICAgICAgICAgICAgICAge21vZHVsZTogKCkgPT4gaW1wb3J0KCcuL25ld3MvVGFiQ29udGFpbmVyLm1qcycpfSxcbiAgICAgICAgICAgICAgICB7bW9kdWxlOiAoKSA9PiBpbXBvcnQoJy4vc2VydmljZXMvQ29udGFpbmVyLm1qcycpfSxcbiAgICAgICAgICAgICAgICB7bW9kdWxlOiAoKSA9PiBpbXBvcnQoJy4vZXhhbXBsZXMvVGFiQ29udGFpbmVyLm1qcycpfSxcbiAgICAgICAgICAgICAgICB7bW9kdWxlOiAoKSA9PiBpbXBvcnQoJy4vYWJvdXQvQ29udGFpbmVyLm1qcycpfSxcbiAgICAgICAgICAgICAgICB7bW9kdWxlOiAoKSA9PiBpbXBvcnQoJy4uLy4uLy4uL2RvY3MvYXBwL3ZpZXcvTWFpbkNvbnRhaW5lci5tanMnKX1cbiAgICAgICAgICAgIF1cbiAgICAgICAgfV0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBtb25pdG9yU2l6ZT10cnVlXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgbW9uaXRvclNpemU6IHRydWUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWYWx1ZXMgYXJlOiBsYXJnZSwgbWVkaXVtLCBzbWFsbCwgeFNtYWxsXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBzaXplXz1udWxsXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgc2l6ZV86IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uc3RhdGUuUHJvdmlkZXJ9IHN0YXRlUHJvdmlkZXI9Vmlld3BvcnRTdGF0ZVByb3ZpZGVyXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGVQcm92aWRlcjogVmlld3BvcnRTdGF0ZVByb3ZpZGVyXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdChjb25maWcpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0KGNvbmZpZyk7XG5cbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBtZS5vbigncmVzaXplJywgbWUub25SZXNpemUsIG1lKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgc2l6ZSBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0U2l6ZSh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBsZXQgbWUgID0gdGhpcyxcbiAgICAgICAgICAgICAgICBjbHMgPSBtZS5jbHM7XG5cbiAgICAgICAgICAgIE5lb0FycmF5LnJlbW92ZShjbHMsICdwb3J0YWwtc2l6ZS0nICsgb2xkVmFsdWUpO1xuICAgICAgICAgICAgTmVvQXJyYXkuYWRkKCAgIGNscywgJ3BvcnRhbC1zaXplLScgKyB2YWx1ZSk7XG4gICAgICAgICAgICBtZS5jbHMgPSBjbHM7XG5cbiAgICAgICAgICAgIG1lLnN0YXRlUHJvdmlkZXIuc2V0RGF0YSh7c2l6ZTogdmFsdWV9KTtcblxuICAgICAgICAgICAgbWUuY29udHJvbGxlci5zaXplID0gdmFsdWVcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBiZWZvcmUgdGhlIHNpemUgY29uZmlnIGdldHMgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gb2xkVmFsdWVcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfG51bGx9XG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldFNpemUodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVNldEVudW1WYWx1ZSh2YWx1ZSwgb2xkVmFsdWUsICdzaXplJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGhcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfVxuICAgICAqL1xuICAgIGdldFNpemUod2lkdGgpIHtcbiAgICAgICAgaWYgKHdpZHRoIDw9ICA2NDApIHJldHVybiAneC1zbWFsbCc7XG4gICAgICAgIGlmICh3aWR0aCA8PSAxMDI0KSByZXR1cm4gJ3NtYWxsJztcbiAgICAgICAgaWYgKHdpZHRoIDw9IDEyOTYpIHJldHVybiAnbWVkaXVtJztcbiAgICAgICAgcmV0dXJuICdsYXJnZSdcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqL1xuICAgIG9uUmVzaXplKGRhdGEpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBpZiAobWUuaWQgPT09IGRhdGEuaWQpIHtcbiAgICAgICAgICAgIG1lLnNpemUgPSBtZS5nZXRTaXplKGRhdGEuYm9yZGVyQm94U2l6ZS5pbmxpbmVTaXplKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhWaWV3cG9ydCk7XG4iLCJpbXBvcnQgQ29udHJvbGxlciAgICAgICAgZnJvbSAnLi4vLi4vLi4vc3JjL2NvbnRyb2xsZXIvQ29tcG9uZW50Lm1qcyc7XG5pbXBvcnQgQ3ViZUxheW91dCAgICAgICAgZnJvbSAnLi4vLi4vLi4vc3JjL2xheW91dC9DdWJlLm1qcyc7XG5pbXBvcnQgTmVvQXJyYXkgICAgICAgICAgZnJvbSAnLi4vLi4vLi4vc3JjL3V0aWwvQXJyYXkubWpzJztcbmltcG9ydCBTZW9TZXJ2aWNlICAgICAgICBmcm9tICcuLi9zZXJ2aWNlL1Nlby5tanMnO1xuXG4vKipcbiAqIEBzdW1tYXJ5IFRoZSBtYWluIGNvbnRyb2xsZXIgZm9yIHRoZSBwb3J0YWwncyB2aWV3cG9ydC5cbiAqXG4gKiBUaGlzIGNvbnRyb2xsZXIgaXMgdGhlIGNlbnRyYWwgaHViIGZvciB0aGUgcG9ydGFsIGFwcGxpY2F0aW9uLiBJdCBpcyByZXNwb25zaWJsZSBmb3I6XG4gKiAtICoqVG9wLUxldmVsIFJvdXRpbmc6KiogSXQgdXNlcyB0aGUgYHJvdXRlc2AgY29uZmlnIHRvIG1hcCB0aGUgbWFpbiBVUkwgaGFzaCBjaGFuZ2VzIChlLmcuLCAvaG9tZSwgL2xlYXJuLCAvYmxvZykgdG8gc3BlY2lmaWMgbWV0aG9kcywgd2hpY2ggaW4gdHVybiBjb250cm9sIHdoaWNoIG1haW4gdmlldyBpcyBhY3RpdmUuIEl0J3MgaW1wb3J0YW50IHRvIG5vdGUgdGhhdCB3aGlsZSB0aGlzIGNvbnRyb2xsZXIgaGFuZGxlcyB0aGUgdG9wLWxldmVsIG5hdmlnYXRpb24sIGNoaWxkIHZpZXdzIGNhbiBpbXBsZW1lbnQgdGhlaXIgb3duIG5lc3RlZCByb3V0aW5nIGxvZ2ljIChzZWUgYFBvcnRhbC52aWV3LmxlYXJuLk1haW5Db250YWluZXJDb250cm9sbGVyYCBmb3IgYW4gZXhhbXBsZSkuXG4gKiAtICoqTGF5b3V0IE1hbmFnZW1lbnQ6KiogSXQgbWFuYWdlcyB0aGUgbWFpbiBjb250ZW50IGFyZWEncyBsYXlvdXQsIGluY2x1ZGluZyB0aGUgXCJtaXhlZFwiIG1vZGUgd2hpY2ggdXNlcyBhIEN1YmVMYXlvdXQgZm9yIHNsaWNrIHRyYW5zaXRpb25zIGJldHdlZW4gdmlld3MuXG4gKiAtICoqU0VPOioqIEl0IGNvb3JkaW5hdGVzIHdpdGggdGhlIGBEb2N1bWVudEhlYWRgIG1haW4gdGhyZWFkIGFkZG9uIHRvIHVwZGF0ZSB0aGUgZG9jdW1lbnQncyB0aXRsZSBhbmQgbWV0YSB0YWdzIG9uIGVhY2ggcm91dGUgY2hhbmdlLCBlbnN1cmluZyB0aGUgYXBwbGljYXRpb24gaXMgU0VPLWZyaWVuZGx5LlxuICogLSAqKk11bHRpLVdpbmRvdyBDb29yZGluYXRpb246KiogSXQgaGFuZGxlcyB0aGUgZGlzY29ubmVjdGlvbiBvZiBjaGlsZCB3aW5kb3dzLCBzdWNoIGFzIHRoZSBsaXZlIGNvZGUgZXhhbXBsZSBwcmV2aWV3cy5cbiAqXG4gKiBAY2xhc3MgUG9ydGFsLnZpZXcuVmlld3BvcnRDb250cm9sbGVyXG4gKiBAZXh0ZW5kcyBOZW8uY29udHJvbGxlci5Db21wb25lbnRcbiAqL1xuY2xhc3MgVmlld3BvcnRDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlciB7XG4gICAgLyoqXG4gICAgICogVmFsaWQgdmFsdWVzIGZvciBtYWluQ29udGVudExheW91dFxuICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBtYWluQ29udGVudExheW91dHM9WydjYXJkJywnY3ViZScsJ21peGVkJ11cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICogQHN0YXRpY1xuICAgICAqL1xuICAgIHN0YXRpYyBtYWluQ29udGVudExheW91dHMgPSBbJ2NhcmQnLCAnY3ViZScsICdtaXhlZCddXG5cbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J1BvcnRhbC52aWV3LlZpZXdwb3J0Q29udHJvbGxlcidcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnUG9ydGFsLnZpZXcuVmlld3BvcnRDb250cm9sbGVyJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gbnR5cGU9J3ZpZXdwb3J0LWNvbnRyb2xsZXInXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG50eXBlOiAndmlld3BvcnQtY29udHJvbGxlcicsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ8bnVsbH0gYWN0aXZlSW5kZXhfPW51bGxcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBhY3RpdmVJbmRleF86IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd8bnVsbH0gZGVmYXVsdEhhc2g9Jy9ob21lJ1xuICAgICAgICAgKi9cbiAgICAgICAgZGVmYXVsdEhhc2g6ICcvaG9tZScsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG1haW5Db250ZW50TGF5b3V0Xz0nY2FyZCdcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBtYWluQ29udGVudExheW91dF86ICdjYXJkJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdH0gcm91dGVzXG4gICAgICAgICAqL1xuICAgICAgICByb3V0ZXM6IHtcbiAgICAgICAgICAgICcvYWJvdXQtdXMnICAgICAgICAgOiAnb25BYm91dFVzUm91dGUnLFxuICAgICAgICAgICAgJy9kb2NzJyAgICAgICAgICAgICA6ICdvbkRvY3NSb3V0ZScsXG4gICAgICAgICAgICAnL2V4YW1wbGVzJyAgICAgICAgIDogJ29uRXhhbXBsZXNSb3V0ZScsXG4gICAgICAgICAgICAnL2V4YW1wbGVzL3tpdGVtSWR9JzogJ29uRXhhbXBsZXNSb3V0ZScsXG4gICAgICAgICAgICAnL2hvbWUnICAgICAgICAgICAgIDogJ29uSG9tZVJvdXRlJyxcbiAgICAgICAgICAgICcvbGVhcm4nICAgICAgICAgICAgOiAnb25MZWFyblJvdXRlJyxcbiAgICAgICAgICAgICcvbGVhcm4veyppdGVtSWR9JyAgOiAnb25MZWFyblJvdXRlJyxcbiAgICAgICAgICAgICcvbmV3cycgICAgICAgICAgICAgOiAnb25OZXdzUm91dGUnLFxuICAgICAgICAgICAgJy9uZXdzL3sqaXRlbUlkfScgICA6ICdvbk5ld3NSb3V0ZScsXG4gICAgICAgICAgICAnL3NlcnZpY2VzJyAgICAgICAgIDogJ29uU2VydmljZXNSb3V0ZSdcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZhbHVlcyBhcmU6IGxhcmdlLCBtZWRpdW0sIHNtYWxsLCB4U21hbGxcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IHNpemVfPW51bGxcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBzaXplXzogbnVsbFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBjb25uZWN0ZWRBcHBzPVtdXG4gICAgICovXG4gICAgY29ubmVjdGVkQXBwcyA9IFtdXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgZmxhZyB0byBzdG9yZSB0aGUgYW1vdW50IG9mIG1haW4gbmF2aWdhdGlvbiBjaGFuZ2VzXG4gICAgICogQG1lbWJlciB7TnVtYmVyfSAjdHJhbnNpdGlvbklkPTBcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgICN0cmFuc2l0aW9uSWQgPSAwXG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIHNpemUgYWN0aXZlSW5kZXggZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge051bWJlcnxudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfG51bGx9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0QWN0aXZlSW5kZXgodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHZhbHVlICE9PSBudWxsICYmIHRoaXMudXBkYXRlSGVhZGVyVG9vbGJhcigpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBtYWluQ29udGVudExheW91dCBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRNYWluQ29udGVudExheW91dCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHthY3RpdmVJbmRleCwgd2luZG93SWR9ID0gbWUsXG4gICAgICAgICAgICBjb250YWluZXIgICAgICAgICAgICAgICA9IG1lLmNvbXBvbmVudC5nZXRJdGVtKCdtYWluLWNvbnRlbnQnKTsgLy8gaGFwcGVucyBiZWZvcmUgaW5zdGFudGlhdGlvblxuXG4gICAgICAgIGlmIChvbGRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyBXZSBjYW4gbm90IHR1cm4gdGhpcyBtZXRob2QgaXRzZWxmIGludG8gYXN5bmMgYW5kIGF3YWl0IHRoZSBhZGRvbiByZXNwb25zZSxcbiAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBjb250YWluZXIgbmVlZHMgaXRzIGxheW91dCByaWdodCBhd2F5XG4gICAgICAgICAgICBOZW8ubWFpbi5hZGRvbi5Mb2NhbFN0b3JhZ2UucmVhZExvY2FsU3RvcmFnZUl0ZW0oe1xuICAgICAgICAgICAgICAgIGtleTogJ21haW5Db250ZW50TGF5b3V0JyxcbiAgICAgICAgICAgICAgICB3aW5kb3dJZFxuICAgICAgICAgICAgfSkudGhlbigoe3ZhbHVlfSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSAhPT0gJ2NhcmQnKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lLm1haW5Db250ZW50TGF5b3V0ID0gdmFsdWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHZhbHVlID09PSAnY3ViZScpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5sYXlvdXQgPSB7bnR5cGU6ICdjdWJlJywgYWN0aXZlSW5kZXgsIGZpdENvbnRhaW5lcjogdHJ1ZSwgaGlkZUluYWN0aXZlQ2FyZHNPbkRlc3Ryb3k6IHRydWV9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250YWluZXIubGF5b3V0ID0ge250eXBlOiAnY2FyZCcsIGFjdGl2ZUluZGV4fVxuICAgICAgICB9XG5cbiAgICAgICAgTmVvLm1haW4uYWRkb24uTG9jYWxTdG9yYWdlLnVwZGF0ZUxvY2FsU3RvcmFnZUl0ZW0oe2tleTogJ21haW5Db250ZW50TGF5b3V0JywgdmFsdWUsIHdpbmRvd0lkfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIHNpemUgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldFNpemUodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHZhbHVlICYmIHRoaXMudXBkYXRlSGVhZGVyVG9vbGJhcigpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGJlZm9yZSB0aGUgbWFpbkNvbnRlbnRMYXlvdXQgY29uZmlnIGdldHMgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBiZWZvcmVTZXRNYWluQ29udGVudExheW91dCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmVmb3JlU2V0RW51bVZhbHVlKHZhbHVlLCBvbGRWYWx1ZSwgJ21haW5Db250ZW50TGF5b3V0JylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcm91dGUgaGFuZGxlcnMgKGUuZy4sIG9uQWJvdXRVc1JvdXRlLCBvbkJsb2dSb3V0ZSkgYXJlIG5vdyBvbmx5IHJlc3BvbnNpYmxlIGZvclxuICAgICAqIHNldHRpbmcgdGhlIG1haW4gY29udGVudCBpbmRleC4gVGhlIGxvZ2ljIGZvciB1cGRhdGluZyB0aGUgZG9jdW1lbnQgaGVhZCBpcyBjZW50cmFsaXplZFxuICAgICAqIGluIHRoZSBvbkhhc2hDaGFuZ2UgbWV0aG9kLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXNcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBvbkFib3V0VXNSb3V0ZShwYXJhbXMsIHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB0aGlzLnNldE1haW5Db250ZW50SW5kZXgoNSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLmFwcE5hbWVcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZGF0YS53aW5kb3dJZFxuICAgICAqL1xuICAgIGFzeW5jIG9uQXBwRGlzY29ubmVjdCh7YXBwTmFtZSwgd2luZG93SWR9KSB7XG4gICAgICAgIC8vIENsb3NlIHBvcHVwIHdpbmRvd3Mgd2hlbiBjbG9zaW5nIG9yIHJlbG9hZGluZyB0aGUgbWFpbiB3aW5kb3dcbiAgICAgICAgaWYgKGFwcE5hbWUgPT09ICdQb3J0YWwnKSB7XG4gICAgICAgICAgICBOZW8uTWFpbi53aW5kb3dDbG9zZUFsbCh7d2luZG93SWR9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbk1lZGl1bVNlYXJjaEZpZWxkQ2hhbmdlKGRhdGEpIHtcbiAgICAgICAgdGhpcy5nZXRSZWZlcmVuY2UoJ21lZGl1bS1saXN0JykuZmlsdGVySXRlbXMoZGF0YSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIG9uQ29uc3RydWN0ZWQoKSB7XG4gICAgICAgIHN1cGVyLm9uQ29uc3RydWN0ZWQoKTtcblxuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIE5lby5jdXJyZW50V29ya2VyLm9uKHtcbiAgICAgICAgICAgIGRpc2Nvbm5lY3Q6IG1lLm9uQXBwRGlzY29ubmVjdCxcbiAgICAgICAgICAgIHNjb3BlICAgICA6IG1lXG4gICAgICAgIH0pO1xuXG4gICAgICAgIE5lby5tYWluLmFkZG9uLkxvY2FsU3RvcmFnZS5yZWFkTG9jYWxTdG9yYWdlSXRlbSh7XG4gICAgICAgICAgICBrZXkgICAgIDogJ3BvcnRhbFRoZW1lJyxcbiAgICAgICAgICAgIHdpbmRvd0lkOiBtZS53aW5kb3dJZFxuICAgICAgICB9KS50aGVuKCh7dmFsdWV9KSA9PiB7XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBtZS5zZXRUaGVtZSh2YWx1ZSwgZmFsc2UpXG4gICAgICAgICAgICB9IGVsc2UgaWYgKE5lby5jb25maWcucHJlZmVyc0RhcmtUaGVtZSkge1xuICAgICAgICAgICAgICAgIG1lLnNldFRoZW1lKCduZW8tdGhlbWUtbmVvLWRhcmsnLCBmYWxzZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHZhbHVlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9sZFZhbHVlXG4gICAgICovXG4gICAgb25Eb2NzUm91dGUocGFyYW1zLCB2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRNYWluQ29udGVudEluZGV4KDYpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtc1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvbGRWYWx1ZVxuICAgICAqL1xuICAgIG9uRXhhbXBsZXNSb3V0ZShwYXJhbXMsIHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB0aGlzLnNldE1haW5Db250ZW50SW5kZXgoNClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIHRoZSBjZW50cmFsIGhhbmRsZXIgZm9yIGFsbCByb3V0ZSBjaGFuZ2VzLiBJdCBpcyBub3cgcmVzcG9uc2libGUgZm9yIGRlbGVnYXRpbmdcbiAgICAgKiB0aGUgZG9jdW1lbnQncyBoZWFkIG1ldGFkYXRhICh0aXRsZSBhbmQgZGVzY3JpcHRpb24pIHVwZGF0ZXMgdG8gdGhlIGBQb3J0YWwuc2VydmljZS5TZW9gIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHZhbHVlICAgICAgICAgICAgICAgVGhlIG5ldyByb3V0ZSBvYmplY3QuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlLmhhc2hTdHJpbmcgICAgVGhlIG5ldyBoYXNoIHN0cmluZy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2xkVmFsdWUgICAgICAgICAgICBUaGUgcHJldmlvdXMgcm91dGUgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZS5oYXNoU3RyaW5nIFRoZSBwcmV2aW91cyBoYXNoIHN0cmluZy5cbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICAgKi9cbiAgICBhc3luYyBvbkhhc2hDaGFuZ2UodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLm9uSGFzaENoYW5nZSh2YWx1ZSwgb2xkVmFsdWUpO1xuICAgICAgICBTZW9TZXJ2aWNlLm9uUm91dGVDaGFuZ2VkKHZhbHVlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXNcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBvbkhvbWVSb3V0ZShwYXJhbXMsIHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB0aGlzLnNldE1haW5Db250ZW50SW5kZXgoMClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHZhbHVlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9sZFZhbHVlXG4gICAgICovXG4gICAgb25MZWFyblJvdXRlKHBhcmFtcywgdmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0TWFpbkNvbnRlbnRJbmRleCgxKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXNcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBvbk5ld3NSb3V0ZShwYXJhbXMsIHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB0aGlzLnNldE1haW5Db250ZW50SW5kZXgoMilcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHZhbHVlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9sZFZhbHVlXG4gICAgICovXG4gICAgb25TZXJ2aWNlc1JvdXRlKHBhcmFtcywgdmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0TWFpbkNvbnRlbnRJbmRleCgzKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgYXN5bmMgb25Td2l0Y2hUaGVtZShkYXRhKSB7XG4gICAgICAgIGxldCBtZSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB2aWV3cG9ydCA9IG1lLmNvbXBvbmVudCxcbiAgICAgICAgICAgIG9sZFRoZW1lID0gdmlld3BvcnQudGhlbWUgfHwgJ25lby10aGVtZS1uZW8tbGlnaHQnLFxuICAgICAgICAgICAgbmV3VGhlbWUgPSBvbGRUaGVtZSA9PT0gJ25lby10aGVtZS1uZW8tbGlnaHQnID8gJ25lby10aGVtZS1uZW8tZGFyaycgOiAnbmVvLXRoZW1lLW5lby1saWdodCcsXG4gICAgICAgICAgICByYWRpdXMsIHgsIHk7XG5cbiAgICAgICAgaWYgKGRhdGEuY2xpZW50WCkge1xuICAgICAgICAgICAgeCAgICAgID0gZGF0YS5jbGllbnRYO1xuICAgICAgICAgICAgeSAgICAgID0gZGF0YS5jbGllbnRZO1xuICAgICAgICAgICAgcmFkaXVzID0gTWF0aC5oeXBvdChNYXRoLm1heCh4LCAzMDAwIC0geCksIE1hdGgubWF4KHksIDMwMDAgLSB5KSkgLy8gc2ltcGxpZmllZCBtYXggY2FsY3VsYXRpb25cbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IE5lby5tYWluLkRvbUFjY2Vzcy5zdGFydFZpZXdUcmFuc2l0aW9uKHtcbiAgICAgICAgICAgIGFuaW1hdGU6IHtcbiAgICAgICAgICAgICAgICBrZXlmcmFtZXM6IFtcbiAgICAgICAgICAgICAgICAgICAge2NsaXBQYXRoOiBgY2lyY2xlKDBweCBhdCAke3h9cHggJHt5fXB4KWB9LFxuICAgICAgICAgICAgICAgICAgICB7Y2xpcFBhdGg6IGBjaXJjbGUoJHtyYWRpdXN9cHggYXQgJHt4fXB4ICR7eX1weClgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiAgICAgOiA1MDAsXG4gICAgICAgICAgICAgICAgICAgIGVhc2luZyAgICAgICA6ICdlYXNlLWluJyxcbiAgICAgICAgICAgICAgICAgICAgcHNldWRvRWxlbWVudDogJzo6dmlldy10cmFuc2l0aW9uLW5ldyhyb290KSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVsYXkgICA6IDEwMCxcbiAgICAgICAgICAgIHdpbmRvd0lkOiBtZS53aW5kb3dJZFxuICAgICAgICB9KTtcblxuICAgICAgICBtZS5zZXRUaGVtZShuZXdUaGVtZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBvcmNoZXN0cmF0ZXMgdGhlIHZpc3VhbCB0cmFuc2l0aW9uIGJldHdlZW4gdGhlIG1haW4gY29udGVudCBjYXJkcy5cbiAgICAgKiBJdCB1c2VzIGEgXCJtaXhlZFwiIGxheW91dCBtb2RlLCB3aGljaCB0ZW1wb3JhcmlseSBzd2l0Y2hlcyB0byBhIEN1YmVMYXlvdXQgZm9yXG4gICAgICogYSAzRCB0cmFuc2l0aW9uIGVmZmVjdCwgYW5kIHRoZW4gYmFjayB0byBhIENhcmRMYXlvdXQgZm9yIHBlcmZvcm1hbmNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleFxuICAgICAqL1xuICAgIGFzeW5jIHNldE1haW5Db250ZW50SW5kZXgoaW5kZXgpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHthY3RpdmVJbmRleCwgbWFpbkNvbnRlbnRMYXlvdXR9ID0gbWUsXG4gICAgICAgICAgICBjb250YWluZXIgICAgICAgICAgICAgICAgICAgICAgICA9IG1lLmdldFJlZmVyZW5jZSgnbWFpbi1jb250ZW50JyksXG4gICAgICAgICAgICB1cGRhdGVMYXlvdXQgICAgICAgICAgICAgICAgICAgICA9IHRydWUsXG4gICAgICAgICAgICB0cmFuc2l0aW9uSWQ7XG5cbiAgICAgICAgaWYgKGluZGV4ICE9PSBhY3RpdmVJbmRleCkge1xuICAgICAgICAgICAgbWUuYWN0aXZlSW5kZXggPSBpbmRleDtcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIG1haW5Db250ZW50TGF5b3V0ID09PSAnbWl4ZWQnICYmXG4gICAgICAgICAgICAgICAgLy8gc2tpcCB0aGUgaW5pdGlhbCBsYXlvdXQtc3dpdGNoLCBzaW5jZSB3ZSBkbyBub3QgbmVlZCBhIHRyYW5zaXRpb25cbiAgICAgICAgICAgICAgICBOZW8uaXNOdW1iZXIoYWN0aXZlSW5kZXgpICYmXG4gICAgICAgICAgICAgICAgLy8gYWxzbyBza2lwIHRoZSBsYXlvdXQgc3dpdGNoIGluIGNhc2UgdGhlIGluZGV4ID49IDYsIHNpbmNlIGEgY3ViZSBvbmx5IGhhcyA2IGZhY2VzXG4gICAgICAgICAgICAgICAgaW5kZXggPCA2ICYmXG4gICAgICAgICAgICAgICAgLy8gYWxzbyBza2lwIHRoZSBsYXlvdXQgc3dpdGNoIGluIGNhc2Ugd2UgbmF2aWdhdGUgYmFjayBmcm9tIGEgbm9uLWN1YmUgaXRlbVxuICAgICAgICAgICAgICAgIGFjdGl2ZUluZGV4IDwgNlxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgbWUuI3RyYW5zaXRpb25JZCsrO1xuXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbklkID0gbWUuI3RyYW5zaXRpb25JZDtcbiAgICAgICAgICAgICAgICB1cGRhdGVMYXlvdXQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIC8vIGVuYWJsZSBcImZhc3QgY2xpY2tpbmdcIiBvbiBtYWluIG5hdiBpdGVtcyA9PiBkbyBub3QgcmVwbGFjZSBhIGN1YmUgbGF5b3V0IHdpdGggYSBuZXcgaW5zdGFuY2Ugb2YgY3ViZVxuICAgICAgICAgICAgICAgIGlmIChjb250YWluZXIubGF5b3V0Lm50eXBlICE9PSAnbGF5b3V0LWN1YmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbnRhaW5lci5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0OiB7bnR5cGU6ICdjdWJlJywgYWN0aXZlSW5kZXgsIGZpdENvbnRhaW5lcjogdHJ1ZSwgaGlkZUluYWN0aXZlQ2FyZHNPbkRlc3Ryb3k6IHRydWV9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBtZS50aW1lb3V0KDIwKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5sYXlvdXQuYWN0aXZlSW5kZXggPSBpbmRleDtcblxuICAgICAgICAgICAgICAgIGF3YWl0IG1lLnRpbWVvdXQoMTEwMCk7XG5cbiAgICAgICAgICAgICAgICBpZiAodHJhbnNpdGlvbklkID09PSBtZS4jdHJhbnNpdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbnRhaW5lci5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0OiB7bnR5cGU6ICdjYXJkJywgYWN0aXZlSW5kZXg6IGluZGV4fVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbWUudGltZW91dCgyMClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh1cGRhdGVMYXlvdXQpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIubGF5b3V0LmFjdGl2ZUluZGV4ID0gaW5kZXhcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0aGVtZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3VwZGF0ZVN0b3JhZ2U9dHJ1ZV1cbiAgICAgKi9cbiAgICBzZXRUaGVtZSh0aGVtZSwgdXBkYXRlU3RvcmFnZT10cnVlKSB7XG4gICAgICAgIGxldCBtZSAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGJ0biAgICAgPSBtZS5nZXRSZWZlcmVuY2UoJ3RoZW1lLXN3aXRjaC1idXR0b24nKSxcbiAgICAgICAgICAgIGljb25DbHMgPSB0aGVtZSA9PT0gJ25lby10aGVtZS1uZW8tZGFyaycgPyAnZmEtc29saWQgZmEtc3VuJyA6ICdmYS1zb2xpZCBmYS1tb29uJztcblxuICAgICAgICBtZS5jb21wb25lbnQudGhlbWUgPSB0aGVtZTtcblxuICAgICAgICBpZiAoYnRuKSB7XG4gICAgICAgICAgICBidG4uaWNvbkNscyA9IGljb25DbHNcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1cGRhdGVTdG9yYWdlKSB7XG4gICAgICAgICAgICBOZW8ubWFpbi5hZGRvbi5Mb2NhbFN0b3JhZ2UudXBkYXRlTG9jYWxTdG9yYWdlSXRlbSh7XG4gICAgICAgICAgICAgICAga2V5ICAgICA6ICdwb3J0YWxUaGVtZScsXG4gICAgICAgICAgICAgICAgdmFsdWUgICA6IHRoZW1lLFxuICAgICAgICAgICAgICAgIHdpbmRvd0lkOiBtZS53aW5kb3dJZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgYXN5bmMgdXBkYXRlSGVhZGVyVG9vbGJhcigpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAge2FjdGl2ZUluZGV4LCBzaXplfSA9IG1lO1xuXG4gICAgICAgIGlmIChOZW8uaXNOdW1iZXIoYWN0aXZlSW5kZXgpICYmIHNpemUpIHtcbiAgICAgICAgICAgIGxldCBoZWFkZXJTb2NpYWxJY29ucyA9IG1lLmdldFJlZmVyZW5jZSgnaGVhZGVyLXNvY2lhbC1pY29ucycpLFxuICAgICAgICAgICAgICAgIHtjbHN9ICAgICAgICAgICAgID0gaGVhZGVyU29jaWFsSWNvbnMsXG4gICAgICAgICAgICAgICAgdmVydGljYWwgICAgICAgICAgPSBzaXplID09PSAneC1zbWFsbCcsXG4gICAgICAgICAgICAgICAgaGlkZGVuICAgICAgICAgICAgPSBhY3RpdmVJbmRleCAhPT0gMCAmJiB2ZXJ0aWNhbDtcblxuICAgICAgICAgICAgTmVvQXJyYXkudG9nZ2xlKGNscywgJ2hpZGUtc2lkZWJhcicsIGhpZGRlbik7XG5cbiAgICAgICAgICAgIGlmICghaGlkZGVuKSB7XG4gICAgICAgICAgICAgICAgTmVvQXJyYXkudG9nZ2xlKGNscywgJ3NlcGFyYXRlLWJhcicsIHZlcnRpY2FsKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBoZWFkZXJTb2NpYWxJY29ucy5jbHMgPSBjbHM7XG5cblxuICAgICAgICAgICAgaWYgKGhpZGRlbiAmJiB2ZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IG1lLnRpbWVvdXQoMjAwKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBoZWFkZXJTb2NpYWxJY29ucy5oaWRkZW4gPSBoaWRkZW5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChOZW8uaXNOdW1iZXIoYWN0aXZlSW5kZXgpKSB7XG4gICAgICAgICAgICBsZXQgaGVhZGVyQ2FudmFzID0gbWUuZ2V0UmVmZXJlbmNlKCdoZWFkZXItY2FudmFzJyksXG4gICAgICAgICAgICAgICAgcmVmcyAgICAgICAgID0gWydob21lLWJ1dHRvbicsICdsZWFybi1idXR0b24nLCAnbmV3cy1oZWFkZXItYnV0dG9uJywgJ3NlcnZpY2VzLWJ1dHRvbicsICdleGFtcGxlcy1idXR0b24nXSxcbiAgICAgICAgICAgICAgICBhY3RpdmVCdG4gICAgPSBtZS5nZXRSZWZlcmVuY2UocmVmc1thY3RpdmVJbmRleF0pO1xuXG4gICAgICAgICAgICBpZiAoaGVhZGVyQ2FudmFzKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVyQ2FudmFzLmFjdGl2ZUlkID0gYWN0aXZlQnRuPy5pZCB8fCBudWxsXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKFZpZXdwb3J0Q29udHJvbGxlcik7XG4iLCJpbXBvcnQgU3RhdGVQcm92aWRlciBmcm9tICcuLi8uLi8uLi9zcmMvc3RhdGUvUHJvdmlkZXIubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgUG9ydGFsLnZpZXcuVmlld3BvcnRTdGF0ZVByb3ZpZGVyXG4gKiBAZXh0ZW5kcyBOZW8uc3RhdGUuUHJvdmlkZXJcbiAqL1xuY2xhc3MgVmlld3BvcnRTdGF0ZVByb3ZpZGVyIGV4dGVuZHMgU3RhdGVQcm92aWRlciB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdQb3J0YWwudmlldy5WaWV3cG9ydFN0YXRlUHJvdmlkZXInXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ1BvcnRhbC52aWV3LlZpZXdwb3J0U3RhdGVQcm92aWRlcicsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGRhdGFcbiAgICAgICAgICovXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfG51bGx9IGJsb2dQb3N0Q291bnQ9bnVsbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBibG9nUG9zdENvdW50OiBudWxsLFxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBWYWx1ZXMgYXJlOiBsYXJnZSwgbWVkaXVtLCBzbWFsbCwgeFNtYWxsLCBudWxsXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd8bnVsbH0gc2l6ZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBzaXplOiBudWxsXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKFZpZXdwb3J0U3RhdGVQcm92aWRlcik7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=