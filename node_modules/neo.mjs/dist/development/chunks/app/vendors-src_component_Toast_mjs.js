"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-src_component_Toast_mjs"],{

/***/ "./src/component/Toast.mjs":
/*!*********************************!*\
  !*** ./src/component/Toast.mjs ***!
  \*********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../component/Base.mjs */ "./src/component/Base.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../manager/Toast.mjs */ "./src/manager/Toast.mjs");




/**
 * @class Neo.component.Toast
 * @extends Neo.component.Base
 *
 * @example
        Neo.toast({
            // mandatory
            appName         : this.component.appName,
            msg             : 'Alarm was set to 11:30 for journey into Neo development',
            // optional                        defaults
            closable        : true,         // false
            iconCls         : 'fa fa-bell', // null
            maxWidth        : 300,          // 250
            position        : 'br',         // 'tr'
            slideDirection  : 'right',      // 'right'
            title           : 'Alarm Clock' // null
        })
 */
class Toast extends _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    /**
     * Valid values for positions
     * @member {String[]} positions = ['tl','tc','tr','bl','bc','br']
     * @protected
     * @static
     */
    static positions = ['tl', 'tc', 'tr', 'bl', 'bc', 'br']
    /**
     * True automatically applies the core/Observable.mjs mixin
     * @member {String[]} slideDirections = ['down','up','left','right']
     * @static
     */
    static slideDirections = ['down', 'up', 'left', 'right']

    static config = {
        /**
         * @member {String} className='Neo.component.Toast'
         * @protected
         */
        className: 'Neo.component.Toast',
        /**
         * @member {String} ntype='toast'
         * @protected
         */
        ntype: 'toast',
        /**
         * @member {String[]} baseCls=['neo-toast']
         * @protected
         */
        baseCls: ['neo-toast'],
        /**
         * If true makes the toast sticky and show a close icon
         * @member {Boolean} closable=false
         */
        closable_: false,
        /**
         * @member {Boolean} floating=true
         */
        floating: true,
        /**
         * If set, it shows this icon in front of the text
         * e.g. 'fa fa-cog'
         * @member {String|null} iconCls=null
         */
        iconCls_: null,
        /**
         * Limits the width of the Toast
         * @member {Number} maxWidth=250
         */
        maxWidth: 250,
        /**
         * Sets the minimum height of the Toast
         * @member {Number} minHeight=50
         */
        minHeight: 50,
        /**
         * Your message. You can also pass in an iconCls
         * @member {String|null} msg_=null
         */
        msg_: null,
        /**
         * Describes the position of the toast, e.g. bl=bottom-left
         * This creates a cls `noe-toast-position`
         * @member {'tl'|'tc'|'tr'|'bl'|'bc'|'br'} position='tr'
         */
        position_: 'tr',
        /**
         * Describes which direction from which side the toasts slides-in
         * This creates a cls `neo-toast-slide-${direction}-in`
         * @member {'down'|'up'|'left'|'right'} slideDirection_='right'
         */
        slideDirection_: 'right',
        /**
         * Adds a title to the toast
         * @member {Number} title_=null
         */
        title_: null,
        /**
         * @member {String|null} title=null
         */
        vdom:
        {cn: [{
            cls: 'neo-toast-inner', cn: [
                {cls: ['neo-toast-icon'], removeDom: true},
                {cls: 'neo-toast-text', cn: [
                    {cls: ['neo-toast-title'], removeDom: true},
                    {cls: 'neo-toast-msg'}
                ]},
                {cls: ['neo-toast-close', 'fa', 'fa-close'], removeDom: true}
            ]
        }]}
    }

    /**
     * Timeout in ms after which the toast is removed
     * @member {Number} removeDelay=3000
     */
    removeDelay = 3000
    /**
     * Used by the ToastManager
     * @member {Boolean} running=false
     * @private
     */
    running = false

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me = this;

        // click listener for close
        me.addDomListeners([
            {click: {fn: me.destroy, delegate: '.neo-toast-close', scope: me}}
        ]);

        _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].register(me)
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetClosable(value, oldValue) {
        let vdom = this.getVdomInner().cn[2];

        vdom.removeDom = !value
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetIconCls(value, oldValue) {
        let vdom  = this.getVdomInner().cn[0],
            {cls} = vdom;

        vdom.removeDom = Neo.isEmpty(value);
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"][value ? 'add' : 'remove'](cls, value)
    }

    /**
     * Using the afterSetMsg to trigger the setup of the dom
     * A new container is added as an item.
     * We cannot use the vdom here.
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetMsg(value, oldValue) {
        let vdom = this.getTextRootVdom().cn[1];

        vdom.innerHTML = value
    }

    /**
     * Apply a cls, based on the position
     * @param {String} value
     * @param {String} oldValue
     */
    afterSetPosition(value, oldValue) {
        value && this.addCls(`neo-toast-${value}`)
    }

    /**
     * Apply a cls, based on the slideDirection
     * @param {String} value
     * @param {String} oldValue
     */
    afterSetSlideDirection(value, oldValue) {
        value && this.addCls(`neo-toast-slide-${value}-in`)
    }

    /**
     * Close the toast after the mounted if not closable
     * @param {Boolean} value
     * @param {Boolean} oldValue
     */
    afterSetMounted(value, oldValue) {
        super.afterSetMounted(value, oldValue);

        let me = this;

        if (!me.closable && value) {
            me.timeout(me.removeDelay).then(() => {
                me.destroy(true)
            })
        }
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetTitle(value, oldValue) {
        let vdom = this.getTextRootVdom().cn[0];

        vdom.removeDom = Neo.isEmpty(value);
        vdom.innerHTML = value;
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"][value ? 'add' : 'remove'](vdom.cls, 'neo-toast-has-title')
    }

    /**
     * Triggered before the position config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetPosition(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'position')
    }

    /**
     * Triggered before the slideDirection config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetSlideDirection(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'slideDirection')
    }

    /**
     *
     */
    async destroy(...args) {
        let me = this;
        const superDestroy = super.destroy.bind(me);

        me.addDomListeners({
            animationend: function () {
                _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].removeToast(me.id);
                _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].unregister(me);
                superDestroy(...args);
            }
        });

        me.addCls('neo-toast-fade-out')
    }

    /**
     * This is a dialog, so we have to add an item to be able to
     * @returns {Object} vdom
     */
    getTextRootVdom() {
        return this.getVdomInner().cn[1]
    }

    /**
     * This is a dialog, so we have to add an item to be able to
     * @returns {Object} vdom
     */
    getVdomInner() {
        return this.vdom.cn[0]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Toast));


/***/ }),

/***/ "./src/manager/Toast.mjs":
/*!*******************************!*\
  !*** ./src/manager/Toast.mjs ***!
  \*******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/manager/Base.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");



/**
 * See Neo.dialog.Toast for examples
 * @class Neo.manager.Toast
 * @extends Neo.manager.Base
 * @singleton
 */
class Toast extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.manager.Toast'
         * @protected
         */
        className: 'Neo.manager.Toast',
        /**
         * @member {Boolean} singleton=true
         * @protected
         */
        singleton: true
    }

    /**
     * Using a default margin between the item
     * If you switch the distance to the top or bottom you have to change this value accordingly
     * @member {Number} defaultMargin=16
     */
    defaultMargin = 16
    /**
     * Currently only 1 is supported, because they would overlap
     * @member {Number} maxToasts=3
     */
    maxToasts = 3
    /**
     * Counts the currently running Toasts per area
     * @member {Object} running
     */
    running = {
        bc: [], bl: [], br: [],
        tc: [], tl: [], tr: []
    }
    /**
     * If you prefer your own class to open, override here
     * @member {String} toastClass='Neo.component.Toast'
     */
    toastClass = 'Neo.component.Toast'

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);
        Neo.toast = this.createToast.bind(this);
    }

    /**
     * Create the Toast definition and pass it to the Collection
     * @param {Object} toast
     * @returns {String|null}
     */
    createToast(toast) {
        let me = this;

        if (toast.position && !me.running[toast.position]) {
            Neo.logError('[Neo.manager.Toast] Supported values for slideDirection are: tl, tc, tr, bl, bc, br');
            return null
        }

        if (!toast.msg || !toast.appName) {
            !toast.msg     && Neo.logError('[Neo.manager.Toast] Toast has to define a msg');
            !toast.appName && Neo.logError('[Neo.manager.Toast] Toast has to define an appName. Typically me.appName.');
            return null
        }

        toast = Neo.create({
            className: this.toastClass,
            ...toast
        });

        toast.on({
            mounted: me.updateItemsInPosition,
            scope  : me
        })

        return toast.id
    }

    /**
     * Find the first toast based on the maximum allowed toasts
     * @returns {*}
     * @private
     */
    findFirstToast() {
        let me = this,
            firstToast, item;

        me.filters = [{property: 'running', value: false}];

        for (item of me.map.values()) {
            if (me.running[item.position].length < me.maxToasts) {
                firstToast = item;
                firstToast.running = true;
                break
            }
        }

        me.clearFilters();

        return firstToast
    }

    /**
     * @param {Object} item
     */
    register(item) {
        super.register(item);
        this.runQueue()
    }

    /**
     * Removes a task from collection.
     * @param {String} toastId
     */
    removeToast(toastId) {
        let me    = this,
            toast = me.get(toastId),
            position;

        if (!toast) {
            return
        }

        position = toast.position;

        // decrease total of displayed toasts for a position
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].remove(me.running[position], toastId);

        me.updateItemsInPosition(toastId)
    }

    /**
     * Runs a ToastManager to show an item from collection.
     */
    runQueue() {
        let me = this,
            toast;

        if (me.getCount() > 0) {
            toast = me.findFirstToast();

            toast && me.showToast(toast)
        }
    }

    /**
     * @param {Neo.component.Toast} toast
     */
    showToast(toast) {
        toast.render(true);

        let me = this;

        // increase total of displayed toasts for a position
        me.running[toast.position].unshift(toast.id);

        // todo: we could use a mounted listener
        me.timeout(50).then(() => {
            me.updateItemsInPosition(toast.id)
        })
    }

    /**
     * Removes a collection item passed by reference or key
     * @param {Object|String} item
     */
    unregister(item) {
        super.unregister(item);
        this.runQueue()
    }

    /**
     * To handle multiple toasts we handle the exact position
     * from the top or bottom
     * @param {String} id
     * @returns {Promise<void>}
     */
    async updateItemsInPosition(id) {
        let me            = this,
            toast         = me.get(id),
            {position}    = toast,
            positionArray = me.running[position],
            acc           = 0,
            margin        = me.defaultMargin,
            moveTo        = position.substring(0, 1) === 't' ? 'top' : 'bottom',
            component, componentId, index, moveObj, rects;

        rects = await toast.getDomRect(positionArray);

        for ([index, componentId] of positionArray.entries()) {
            component = Neo.getComponent(componentId);
            moveObj   = {};

            acc = acc + margin;
            moveObj[moveTo] = acc + 'px';
            component.style = moveObj;
            component.update();

            // Sometimes the index is already reduced
            // so the last index might not be available
            if(rects[index]) {
                acc = acc + rects[index].height
            }
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Toast));


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLXNyY19jb21wb25lbnRfVG9hc3RfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBaUQ7QUFDSjtBQUNHOztBQUVoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLG9CQUFvQiwyREFBSTtBQUN4QjtBQUNBO0FBQ0EsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFVBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLCtCQUErQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxVQUFVO0FBQzNELG9CQUFvQiw0QkFBNEI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsaUJBQWlCLHlDQUF5QztBQUMxRCxpQkFBaUI7QUFDakIscUJBQXFC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QUVBLHVCQUF1QixrQ0FBa0M7O0FBRXpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsUUFBUSx1REFBUTs7QUFFaEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLHFCQUFxQjtBQUNwQztBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBLGVBQWUsZUFBZTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGFBQWE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpRUFBZSxxQkFBcUIsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lby5tanMvLi9zcmMvY29tcG9uZW50L1RvYXN0Lm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL21hbmFnZXIvVG9hc3QubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlICAgICAgICAgZnJvbSAnLi4vY29tcG9uZW50L0Jhc2UubWpzJztcbmltcG9ydCBOZW9BcnJheSAgICAgZnJvbSBcIi4uL3V0aWwvQXJyYXkubWpzXCI7XG5pbXBvcnQgVG9hc3RNYW5hZ2VyIGZyb20gJy4uL21hbmFnZXIvVG9hc3QubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTmVvLmNvbXBvbmVudC5Ub2FzdFxuICogQGV4dGVuZHMgTmVvLmNvbXBvbmVudC5CYXNlXG4gKlxuICogQGV4YW1wbGVcbiAgICAgICAgTmVvLnRvYXN0KHtcbiAgICAgICAgICAgIC8vIG1hbmRhdG9yeVxuICAgICAgICAgICAgYXBwTmFtZSAgICAgICAgIDogdGhpcy5jb21wb25lbnQuYXBwTmFtZSxcbiAgICAgICAgICAgIG1zZyAgICAgICAgICAgICA6ICdBbGFybSB3YXMgc2V0IHRvIDExOjMwIGZvciBqb3VybmV5IGludG8gTmVvIGRldmVsb3BtZW50JyxcbiAgICAgICAgICAgIC8vIG9wdGlvbmFsICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdHNcbiAgICAgICAgICAgIGNsb3NhYmxlICAgICAgICA6IHRydWUsICAgICAgICAgLy8gZmFsc2VcbiAgICAgICAgICAgIGljb25DbHMgICAgICAgICA6ICdmYSBmYS1iZWxsJywgLy8gbnVsbFxuICAgICAgICAgICAgbWF4V2lkdGggICAgICAgIDogMzAwLCAgICAgICAgICAvLyAyNTBcbiAgICAgICAgICAgIHBvc2l0aW9uICAgICAgICA6ICdicicsICAgICAgICAgLy8gJ3RyJ1xuICAgICAgICAgICAgc2xpZGVEaXJlY3Rpb24gIDogJ3JpZ2h0JywgICAgICAvLyAncmlnaHQnXG4gICAgICAgICAgICB0aXRsZSAgICAgICAgICAgOiAnQWxhcm0gQ2xvY2snIC8vIG51bGxcbiAgICAgICAgfSlcbiAqL1xuY2xhc3MgVG9hc3QgZXh0ZW5kcyBCYXNlIHtcbiAgICAvKipcbiAgICAgKiBWYWxpZCB2YWx1ZXMgZm9yIHBvc2l0aW9uc1xuICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBwb3NpdGlvbnMgPSBbJ3RsJywndGMnLCd0cicsJ2JsJywnYmMnLCdiciddXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqIEBzdGF0aWNcbiAgICAgKi9cbiAgICBzdGF0aWMgcG9zaXRpb25zID0gWyd0bCcsICd0YycsICd0cicsICdibCcsICdiYycsICdiciddXG4gICAgLyoqXG4gICAgICogVHJ1ZSBhdXRvbWF0aWNhbGx5IGFwcGxpZXMgdGhlIGNvcmUvT2JzZXJ2YWJsZS5tanMgbWl4aW5cbiAgICAgKiBAbWVtYmVyIHtTdHJpbmdbXX0gc2xpZGVEaXJlY3Rpb25zID0gWydkb3duJywndXAnLCdsZWZ0JywncmlnaHQnXVxuICAgICAqIEBzdGF0aWNcbiAgICAgKi9cbiAgICBzdGF0aWMgc2xpZGVEaXJlY3Rpb25zID0gWydkb3duJywgJ3VwJywgJ2xlZnQnLCAncmlnaHQnXVxuXG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8uY29tcG9uZW50LlRvYXN0J1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8uY29tcG9uZW50LlRvYXN0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gbnR5cGU9J3RvYXN0J1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ3RvYXN0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBiYXNlQ2xzPVsnbmVvLXRvYXN0J11cbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgYmFzZUNsczogWyduZW8tdG9hc3QnXSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElmIHRydWUgbWFrZXMgdGhlIHRvYXN0IHN0aWNreSBhbmQgc2hvdyBhIGNsb3NlIGljb25cbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gY2xvc2FibGU9ZmFsc2VcbiAgICAgICAgICovXG4gICAgICAgIGNsb3NhYmxlXzogZmFsc2UsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBmbG9hdGluZz10cnVlXG4gICAgICAgICAqL1xuICAgICAgICBmbG9hdGluZzogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElmIHNldCwgaXQgc2hvd3MgdGhpcyBpY29uIGluIGZyb250IG9mIHRoZSB0ZXh0XG4gICAgICAgICAqIGUuZy4gJ2ZhIGZhLWNvZydcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IGljb25DbHM9bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgaWNvbkNsc186IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaW1pdHMgdGhlIHdpZHRoIG9mIHRoZSBUb2FzdFxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IG1heFdpZHRoPTI1MFxuICAgICAgICAgKi9cbiAgICAgICAgbWF4V2lkdGg6IDI1MCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdGhlIG1pbmltdW0gaGVpZ2h0IG9mIHRoZSBUb2FzdFxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IG1pbkhlaWdodD01MFxuICAgICAgICAgKi9cbiAgICAgICAgbWluSGVpZ2h0OiA1MCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFlvdXIgbWVzc2FnZS4gWW91IGNhbiBhbHNvIHBhc3MgaW4gYW4gaWNvbkNsc1xuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd8bnVsbH0gbXNnXz1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBtc2dfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGVzY3JpYmVzIHRoZSBwb3NpdGlvbiBvZiB0aGUgdG9hc3QsIGUuZy4gYmw9Ym90dG9tLWxlZnRcbiAgICAgICAgICogVGhpcyBjcmVhdGVzIGEgY2xzIGBub2UtdG9hc3QtcG9zaXRpb25gXG4gICAgICAgICAqIEBtZW1iZXIgeyd0bCd8J3RjJ3wndHInfCdibCd8J2JjJ3wnYnInfSBwb3NpdGlvbj0ndHInXG4gICAgICAgICAqL1xuICAgICAgICBwb3NpdGlvbl86ICd0cicsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXNjcmliZXMgd2hpY2ggZGlyZWN0aW9uIGZyb20gd2hpY2ggc2lkZSB0aGUgdG9hc3RzIHNsaWRlcy1pblxuICAgICAgICAgKiBUaGlzIGNyZWF0ZXMgYSBjbHMgYG5lby10b2FzdC1zbGlkZS0ke2RpcmVjdGlvbn0taW5gXG4gICAgICAgICAqIEBtZW1iZXIgeydkb3duJ3wndXAnfCdsZWZ0J3wncmlnaHQnfSBzbGlkZURpcmVjdGlvbl89J3JpZ2h0J1xuICAgICAgICAgKi9cbiAgICAgICAgc2xpZGVEaXJlY3Rpb25fOiAncmlnaHQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkcyBhIHRpdGxlIHRvIHRoZSB0b2FzdFxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IHRpdGxlXz1udWxsXG4gICAgICAgICAqL1xuICAgICAgICB0aXRsZV86IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd8bnVsbH0gdGl0bGU9bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgdmRvbTpcbiAgICAgICAge2NuOiBbe1xuICAgICAgICAgICAgY2xzOiAnbmVvLXRvYXN0LWlubmVyJywgY246IFtcbiAgICAgICAgICAgICAgICB7Y2xzOiBbJ25lby10b2FzdC1pY29uJ10sIHJlbW92ZURvbTogdHJ1ZX0sXG4gICAgICAgICAgICAgICAge2NsczogJ25lby10b2FzdC10ZXh0JywgY246IFtcbiAgICAgICAgICAgICAgICAgICAge2NsczogWyduZW8tdG9hc3QtdGl0bGUnXSwgcmVtb3ZlRG9tOiB0cnVlfSxcbiAgICAgICAgICAgICAgICAgICAge2NsczogJ25lby10b2FzdC1tc2cnfVxuICAgICAgICAgICAgICAgIF19LFxuICAgICAgICAgICAgICAgIHtjbHM6IFsnbmVvLXRvYXN0LWNsb3NlJywgJ2ZhJywgJ2ZhLWNsb3NlJ10sIHJlbW92ZURvbTogdHJ1ZX1cbiAgICAgICAgICAgIF1cbiAgICAgICAgfV19XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGltZW91dCBpbiBtcyBhZnRlciB3aGljaCB0aGUgdG9hc3QgaXMgcmVtb3ZlZFxuICAgICAqIEBtZW1iZXIge051bWJlcn0gcmVtb3ZlRGVsYXk9MzAwMFxuICAgICAqL1xuICAgIHJlbW92ZURlbGF5ID0gMzAwMFxuICAgIC8qKlxuICAgICAqIFVzZWQgYnkgdGhlIFRvYXN0TWFuYWdlclxuICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IHJ1bm5pbmc9ZmFsc2VcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHJ1bm5pbmcgPSBmYWxzZVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdChjb25maWcpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0KGNvbmZpZyk7XG5cbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICAvLyBjbGljayBsaXN0ZW5lciBmb3IgY2xvc2VcbiAgICAgICAgbWUuYWRkRG9tTGlzdGVuZXJzKFtcbiAgICAgICAgICAgIHtjbGljazoge2ZuOiBtZS5kZXN0cm95LCBkZWxlZ2F0ZTogJy5uZW8tdG9hc3QtY2xvc2UnLCBzY29wZTogbWV9fVxuICAgICAgICBdKTtcblxuICAgICAgICBUb2FzdE1hbmFnZXIucmVnaXN0ZXIobWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBvbGRWYWx1ZVxuICAgICAqL1xuICAgIGFmdGVyU2V0Q2xvc2FibGUodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGxldCB2ZG9tID0gdGhpcy5nZXRWZG9tSW5uZXIoKS5jblsyXTtcblxuICAgICAgICB2ZG9tLnJlbW92ZURvbSA9ICF2YWx1ZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldEljb25DbHModmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGxldCB2ZG9tICA9IHRoaXMuZ2V0VmRvbUlubmVyKCkuY25bMF0sXG4gICAgICAgICAgICB7Y2xzfSA9IHZkb207XG5cbiAgICAgICAgdmRvbS5yZW1vdmVEb20gPSBOZW8uaXNFbXB0eSh2YWx1ZSk7XG4gICAgICAgIE5lb0FycmF5W3ZhbHVlID8gJ2FkZCcgOiAncmVtb3ZlJ10oY2xzLCB2YWx1ZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVc2luZyB0aGUgYWZ0ZXJTZXRNc2cgdG8gdHJpZ2dlciB0aGUgc2V0dXAgb2YgdGhlIGRvbVxuICAgICAqIEEgbmV3IGNvbnRhaW5lciBpcyBhZGRlZCBhcyBhbiBpdGVtLlxuICAgICAqIFdlIGNhbm5vdCB1c2UgdGhlIHZkb20gaGVyZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IG9sZFZhbHVlXG4gICAgICovXG4gICAgYWZ0ZXJTZXRNc2codmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGxldCB2ZG9tID0gdGhpcy5nZXRUZXh0Um9vdFZkb20oKS5jblsxXTtcblxuICAgICAgICB2ZG9tLmlubmVySFRNTCA9IHZhbHVlXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwbHkgYSBjbHMsIGJhc2VkIG9uIHRoZSBwb3NpdGlvblxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqL1xuICAgIGFmdGVyU2V0UG9zaXRpb24odmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHZhbHVlICYmIHRoaXMuYWRkQ2xzKGBuZW8tdG9hc3QtJHt2YWx1ZX1gKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwcGx5IGEgY2xzLCBiYXNlZCBvbiB0aGUgc2xpZGVEaXJlY3Rpb25cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldFNsaWRlRGlyZWN0aW9uKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB2YWx1ZSAmJiB0aGlzLmFkZENscyhgbmVvLXRvYXN0LXNsaWRlLSR7dmFsdWV9LWluYClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbG9zZSB0aGUgdG9hc3QgYWZ0ZXIgdGhlIG1vdW50ZWQgaWYgbm90IGNsb3NhYmxlXG4gICAgICogQHBhcmFtIHtCb29sZWFufSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldE1vdW50ZWQodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHN1cGVyLmFmdGVyU2V0TW91bnRlZCh2YWx1ZSwgb2xkVmFsdWUpO1xuXG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCFtZS5jbG9zYWJsZSAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgbWUudGltZW91dChtZS5yZW1vdmVEZWxheSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgbWUuZGVzdHJveSh0cnVlKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldFRpdGxlKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBsZXQgdmRvbSA9IHRoaXMuZ2V0VGV4dFJvb3RWZG9tKCkuY25bMF07XG5cbiAgICAgICAgdmRvbS5yZW1vdmVEb20gPSBOZW8uaXNFbXB0eSh2YWx1ZSk7XG4gICAgICAgIHZkb20uaW5uZXJIVE1MID0gdmFsdWU7XG4gICAgICAgIE5lb0FycmF5W3ZhbHVlID8gJ2FkZCcgOiAncmVtb3ZlJ10odmRvbS5jbHMsICduZW8tdG9hc3QtaGFzLXRpdGxlJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYmVmb3JlIHRoZSBwb3NpdGlvbiBjb25maWcgZ2V0cyBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldFBvc2l0aW9uKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iZWZvcmVTZXRFbnVtVmFsdWUodmFsdWUsIG9sZFZhbHVlLCAncG9zaXRpb24nKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBiZWZvcmUgdGhlIHNsaWRlRGlyZWN0aW9uIGNvbmZpZyBnZXRzIGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYmVmb3JlU2V0U2xpZGVEaXJlY3Rpb24odmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVNldEVudW1WYWx1ZSh2YWx1ZSwgb2xkVmFsdWUsICdzbGlkZURpcmVjdGlvbicpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBhc3luYyBkZXN0cm95KC4uLmFyZ3MpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcbiAgICAgICAgY29uc3Qgc3VwZXJEZXN0cm95ID0gc3VwZXIuZGVzdHJveS5iaW5kKG1lKTtcblxuICAgICAgICBtZS5hZGREb21MaXN0ZW5lcnMoe1xuICAgICAgICAgICAgYW5pbWF0aW9uZW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgVG9hc3RNYW5hZ2VyLnJlbW92ZVRvYXN0KG1lLmlkKTtcbiAgICAgICAgICAgICAgICBUb2FzdE1hbmFnZXIudW5yZWdpc3RlcihtZSk7XG4gICAgICAgICAgICAgICAgc3VwZXJEZXN0cm95KC4uLmFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBtZS5hZGRDbHMoJ25lby10b2FzdC1mYWRlLW91dCcpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBpcyBhIGRpYWxvZywgc28gd2UgaGF2ZSB0byBhZGQgYW4gaXRlbSB0byBiZSBhYmxlIHRvXG4gICAgICogQHJldHVybnMge09iamVjdH0gdmRvbVxuICAgICAqL1xuICAgIGdldFRleHRSb290VmRvbSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmRvbUlubmVyKCkuY25bMV1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIGEgZGlhbG9nLCBzbyB3ZSBoYXZlIHRvIGFkZCBhbiBpdGVtIHRvIGJlIGFibGUgdG9cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSB2ZG9tXG4gICAgICovXG4gICAgZ2V0VmRvbUlubmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy52ZG9tLmNuWzBdXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhUb2FzdCk7XG4iLCJpbXBvcnQgTWFuYWdlciAgZnJvbSAnLi9CYXNlLm1qcyc7XG5pbXBvcnQgTmVvQXJyYXkgZnJvbSAnLi4vdXRpbC9BcnJheS5tanMnO1xuXG4vKipcbiAqIFNlZSBOZW8uZGlhbG9nLlRvYXN0IGZvciBleGFtcGxlc1xuICogQGNsYXNzIE5lby5tYW5hZ2VyLlRvYXN0XG4gKiBAZXh0ZW5kcyBOZW8ubWFuYWdlci5CYXNlXG4gKiBAc2luZ2xldG9uXG4gKi9cbmNsYXNzIFRvYXN0IGV4dGVuZHMgTWFuYWdlciB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8ubWFuYWdlci5Ub2FzdCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLm1hbmFnZXIuVG9hc3QnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gc2luZ2xldG9uPXRydWVcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgc2luZ2xldG9uOiB0cnVlXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXNpbmcgYSBkZWZhdWx0IG1hcmdpbiBiZXR3ZWVuIHRoZSBpdGVtXG4gICAgICogSWYgeW91IHN3aXRjaCB0aGUgZGlzdGFuY2UgdG8gdGhlIHRvcCBvciBib3R0b20geW91IGhhdmUgdG8gY2hhbmdlIHRoaXMgdmFsdWUgYWNjb3JkaW5nbHlcbiAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IGRlZmF1bHRNYXJnaW49MTZcbiAgICAgKi9cbiAgICBkZWZhdWx0TWFyZ2luID0gMTZcbiAgICAvKipcbiAgICAgKiBDdXJyZW50bHkgb25seSAxIGlzIHN1cHBvcnRlZCwgYmVjYXVzZSB0aGV5IHdvdWxkIG92ZXJsYXBcbiAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IG1heFRvYXN0cz0zXG4gICAgICovXG4gICAgbWF4VG9hc3RzID0gM1xuICAgIC8qKlxuICAgICAqIENvdW50cyB0aGUgY3VycmVudGx5IHJ1bm5pbmcgVG9hc3RzIHBlciBhcmVhXG4gICAgICogQG1lbWJlciB7T2JqZWN0fSBydW5uaW5nXG4gICAgICovXG4gICAgcnVubmluZyA9IHtcbiAgICAgICAgYmM6IFtdLCBibDogW10sIGJyOiBbXSxcbiAgICAgICAgdGM6IFtdLCB0bDogW10sIHRyOiBbXVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBJZiB5b3UgcHJlZmVyIHlvdXIgb3duIGNsYXNzIHRvIG9wZW4sIG92ZXJyaWRlIGhlcmVcbiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IHRvYXN0Q2xhc3M9J05lby5jb21wb25lbnQuVG9hc3QnXG4gICAgICovXG4gICAgdG9hc3RDbGFzcyA9ICdOZW8uY29tcG9uZW50LlRvYXN0J1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdChjb25maWcpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0KGNvbmZpZyk7XG4gICAgICAgIE5lby50b2FzdCA9IHRoaXMuY3JlYXRlVG9hc3QuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIFRvYXN0IGRlZmluaXRpb24gYW5kIHBhc3MgaXQgdG8gdGhlIENvbGxlY3Rpb25cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9hc3RcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfG51bGx9XG4gICAgICovXG4gICAgY3JlYXRlVG9hc3QodG9hc3QpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBpZiAodG9hc3QucG9zaXRpb24gJiYgIW1lLnJ1bm5pbmdbdG9hc3QucG9zaXRpb25dKSB7XG4gICAgICAgICAgICBOZW8ubG9nRXJyb3IoJ1tOZW8ubWFuYWdlci5Ub2FzdF0gU3VwcG9ydGVkIHZhbHVlcyBmb3Igc2xpZGVEaXJlY3Rpb24gYXJlOiB0bCwgdGMsIHRyLCBibCwgYmMsIGJyJyk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0b2FzdC5tc2cgfHwgIXRvYXN0LmFwcE5hbWUpIHtcbiAgICAgICAgICAgICF0b2FzdC5tc2cgICAgICYmIE5lby5sb2dFcnJvcignW05lby5tYW5hZ2VyLlRvYXN0XSBUb2FzdCBoYXMgdG8gZGVmaW5lIGEgbXNnJyk7XG4gICAgICAgICAgICAhdG9hc3QuYXBwTmFtZSAmJiBOZW8ubG9nRXJyb3IoJ1tOZW8ubWFuYWdlci5Ub2FzdF0gVG9hc3QgaGFzIHRvIGRlZmluZSBhbiBhcHBOYW1lLiBUeXBpY2FsbHkgbWUuYXBwTmFtZS4nKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cblxuICAgICAgICB0b2FzdCA9IE5lby5jcmVhdGUoe1xuICAgICAgICAgICAgY2xhc3NOYW1lOiB0aGlzLnRvYXN0Q2xhc3MsXG4gICAgICAgICAgICAuLi50b2FzdFxuICAgICAgICB9KTtcblxuICAgICAgICB0b2FzdC5vbih7XG4gICAgICAgICAgICBtb3VudGVkOiBtZS51cGRhdGVJdGVtc0luUG9zaXRpb24sXG4gICAgICAgICAgICBzY29wZSAgOiBtZVxuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiB0b2FzdC5pZFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgdGhlIGZpcnN0IHRvYXN0IGJhc2VkIG9uIHRoZSBtYXhpbXVtIGFsbG93ZWQgdG9hc3RzXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmaW5kRmlyc3RUb2FzdCgpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcyxcbiAgICAgICAgICAgIGZpcnN0VG9hc3QsIGl0ZW07XG5cbiAgICAgICAgbWUuZmlsdGVycyA9IFt7cHJvcGVydHk6ICdydW5uaW5nJywgdmFsdWU6IGZhbHNlfV07XG5cbiAgICAgICAgZm9yIChpdGVtIG9mIG1lLm1hcC52YWx1ZXMoKSkge1xuICAgICAgICAgICAgaWYgKG1lLnJ1bm5pbmdbaXRlbS5wb3NpdGlvbl0ubGVuZ3RoIDwgbWUubWF4VG9hc3RzKSB7XG4gICAgICAgICAgICAgICAgZmlyc3RUb2FzdCA9IGl0ZW07XG4gICAgICAgICAgICAgICAgZmlyc3RUb2FzdC5ydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbWUuY2xlYXJGaWx0ZXJzKCk7XG5cbiAgICAgICAgcmV0dXJuIGZpcnN0VG9hc3RcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbVxuICAgICAqL1xuICAgIHJlZ2lzdGVyKGl0ZW0pIHtcbiAgICAgICAgc3VwZXIucmVnaXN0ZXIoaXRlbSk7XG4gICAgICAgIHRoaXMucnVuUXVldWUoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYSB0YXNrIGZyb20gY29sbGVjdGlvbi5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdG9hc3RJZFxuICAgICAqL1xuICAgIHJlbW92ZVRvYXN0KHRvYXN0SWQpIHtcbiAgICAgICAgbGV0IG1lICAgID0gdGhpcyxcbiAgICAgICAgICAgIHRvYXN0ID0gbWUuZ2V0KHRvYXN0SWQpLFxuICAgICAgICAgICAgcG9zaXRpb247XG5cbiAgICAgICAgaWYgKCF0b2FzdCkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBwb3NpdGlvbiA9IHRvYXN0LnBvc2l0aW9uO1xuXG4gICAgICAgIC8vIGRlY3JlYXNlIHRvdGFsIG9mIGRpc3BsYXllZCB0b2FzdHMgZm9yIGEgcG9zaXRpb25cbiAgICAgICAgTmVvQXJyYXkucmVtb3ZlKG1lLnJ1bm5pbmdbcG9zaXRpb25dLCB0b2FzdElkKTtcblxuICAgICAgICBtZS51cGRhdGVJdGVtc0luUG9zaXRpb24odG9hc3RJZClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSdW5zIGEgVG9hc3RNYW5hZ2VyIHRvIHNob3cgYW4gaXRlbSBmcm9tIGNvbGxlY3Rpb24uXG4gICAgICovXG4gICAgcnVuUXVldWUoKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXMsXG4gICAgICAgICAgICB0b2FzdDtcblxuICAgICAgICBpZiAobWUuZ2V0Q291bnQoKSA+IDApIHtcbiAgICAgICAgICAgIHRvYXN0ID0gbWUuZmluZEZpcnN0VG9hc3QoKTtcblxuICAgICAgICAgICAgdG9hc3QgJiYgbWUuc2hvd1RvYXN0KHRvYXN0KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtOZW8uY29tcG9uZW50LlRvYXN0fSB0b2FzdFxuICAgICAqL1xuICAgIHNob3dUb2FzdCh0b2FzdCkge1xuICAgICAgICB0b2FzdC5yZW5kZXIodHJ1ZSk7XG5cbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICAvLyBpbmNyZWFzZSB0b3RhbCBvZiBkaXNwbGF5ZWQgdG9hc3RzIGZvciBhIHBvc2l0aW9uXG4gICAgICAgIG1lLnJ1bm5pbmdbdG9hc3QucG9zaXRpb25dLnVuc2hpZnQodG9hc3QuaWQpO1xuXG4gICAgICAgIC8vIHRvZG86IHdlIGNvdWxkIHVzZSBhIG1vdW50ZWQgbGlzdGVuZXJcbiAgICAgICAgbWUudGltZW91dCg1MCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBtZS51cGRhdGVJdGVtc0luUG9zaXRpb24odG9hc3QuaWQpXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIGNvbGxlY3Rpb24gaXRlbSBwYXNzZWQgYnkgcmVmZXJlbmNlIG9yIGtleVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gaXRlbVxuICAgICAqL1xuICAgIHVucmVnaXN0ZXIoaXRlbSkge1xuICAgICAgICBzdXBlci51bnJlZ2lzdGVyKGl0ZW0pO1xuICAgICAgICB0aGlzLnJ1blF1ZXVlKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUbyBoYW5kbGUgbXVsdGlwbGUgdG9hc3RzIHdlIGhhbmRsZSB0aGUgZXhhY3QgcG9zaXRpb25cbiAgICAgKiBmcm9tIHRoZSB0b3Agb3IgYm90dG9tXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGlkXG4gICAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XG4gICAgICovXG4gICAgYXN5bmMgdXBkYXRlSXRlbXNJblBvc2l0aW9uKGlkKSB7XG4gICAgICAgIGxldCBtZSAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHRvYXN0ICAgICAgICAgPSBtZS5nZXQoaWQpLFxuICAgICAgICAgICAge3Bvc2l0aW9ufSAgICA9IHRvYXN0LFxuICAgICAgICAgICAgcG9zaXRpb25BcnJheSA9IG1lLnJ1bm5pbmdbcG9zaXRpb25dLFxuICAgICAgICAgICAgYWNjICAgICAgICAgICA9IDAsXG4gICAgICAgICAgICBtYXJnaW4gICAgICAgID0gbWUuZGVmYXVsdE1hcmdpbixcbiAgICAgICAgICAgIG1vdmVUbyAgICAgICAgPSBwb3NpdGlvbi5zdWJzdHJpbmcoMCwgMSkgPT09ICd0JyA/ICd0b3AnIDogJ2JvdHRvbScsXG4gICAgICAgICAgICBjb21wb25lbnQsIGNvbXBvbmVudElkLCBpbmRleCwgbW92ZU9iaiwgcmVjdHM7XG5cbiAgICAgICAgcmVjdHMgPSBhd2FpdCB0b2FzdC5nZXREb21SZWN0KHBvc2l0aW9uQXJyYXkpO1xuXG4gICAgICAgIGZvciAoW2luZGV4LCBjb21wb25lbnRJZF0gb2YgcG9zaXRpb25BcnJheS5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudCA9IE5lby5nZXRDb21wb25lbnQoY29tcG9uZW50SWQpO1xuICAgICAgICAgICAgbW92ZU9iaiAgID0ge307XG5cbiAgICAgICAgICAgIGFjYyA9IGFjYyArIG1hcmdpbjtcbiAgICAgICAgICAgIG1vdmVPYmpbbW92ZVRvXSA9IGFjYyArICdweCc7XG4gICAgICAgICAgICBjb21wb25lbnQuc3R5bGUgPSBtb3ZlT2JqO1xuICAgICAgICAgICAgY29tcG9uZW50LnVwZGF0ZSgpO1xuXG4gICAgICAgICAgICAvLyBTb21ldGltZXMgdGhlIGluZGV4IGlzIGFscmVhZHkgcmVkdWNlZFxuICAgICAgICAgICAgLy8gc28gdGhlIGxhc3QgaW5kZXggbWlnaHQgbm90IGJlIGF2YWlsYWJsZVxuICAgICAgICAgICAgaWYocmVjdHNbaW5kZXhdKSB7XG4gICAgICAgICAgICAgICAgYWNjID0gYWNjICsgcmVjdHNbaW5kZXhdLmhlaWdodFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhUb2FzdCk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=