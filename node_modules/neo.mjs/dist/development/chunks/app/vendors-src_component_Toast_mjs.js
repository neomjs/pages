"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-src_component_Toast_mjs"],{

/***/ "./src/component/Toast.mjs"
/*!*********************************!*\
  !*** ./src/component/Toast.mjs ***!
  \*********************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../component/Base.mjs */ "./src/component/Base.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../manager/Toast.mjs */ "./src/manager/Toast.mjs");




/**
 * @class Neo.component.Toast
 * @extends Neo.component.Base
 *
 * @example
        Neo.toast({
            // mandatory
            appName         : this.component.appName,
            msg             : 'Alarm was set to 11:30 for journey into Neo development',
            windowId        : this.component.windowId
            // optional                        defaults
            closable        : true,         // false
            iconCls         : 'fa fa-bell', // null
            maxWidth        : 300,          // 250
            position        : 'br',         // 'tr'
            slideDirection  : 'right',      // 'right'
            title           : 'Alarm Clock' // null
        })
 */
class Toast extends _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    /**
     * Valid values for positions
     * @member {String[]} positions = ['tl','tc','tr','bl','bc','br']
     * @protected
     * @static
     */
    static positions = ['tl', 'tc', 'tr', 'bl', 'bc', 'br']
    /**
     * True automatically applies the core/Observable.mjs mixin
     * @member {String[]} slideDirections = ['down','up','left','right']
     * @static
     */
    static slideDirections = ['down', 'up', 'left', 'right']

    static config = {
        /**
         * @member {String} className='Neo.component.Toast'
         * @protected
         */
        className: 'Neo.component.Toast',
        /**
         * @member {String} ntype='toast'
         * @protected
         */
        ntype: 'toast',
        /**
         * @member {String[]} baseCls=['neo-toast']
         * @protected
         */
        baseCls: ['neo-toast'],
        /**
         * If true makes the toast sticky and show a close icon
         * @member {Boolean} closable_=false
         * @reactive
         */
        closable_: false,
        /**
         * @member {Boolean} floating=true
         */
        floating: true,
        /**
         * If set, it shows this icon in front of the text
         * e.g. 'fa fa-cog'
         * @member {String|null} iconCls_=null
         * @reactive
         */
        iconCls_: null,
        /**
         * Limits the width of the Toast
         * @member {Number} maxWidth=250
         * @reactive
         */
        maxWidth: 250,
        /**
         * Sets the minimum height of the Toast
         * @member {Number} minHeight=50
         * @reactive
         */
        minHeight: 50,
        /**
         * Your message. You can also pass in an iconCls
         * @member {String|null} msg_=null
         * @reactive
         */
        msg_: null,
        /**
         * Describes the position of the toast, e.g. bl=bottom-left
         * This creates a cls `noe-toast-position`
         * @member {'tl'|'tc'|'tr'|'bl'|'bc'|'br'} position_='tr'
         * @reactive
         */
        position_: 'tr',
        /**
         * Describes which direction from which side the toasts slides-in
         * This creates a cls `neo-toast-slide-${direction}-in`
         * @member {'down'|'up'|'left'|'right'} slideDirection_='right'
         * @reactive
         */
        slideDirection_: 'right',
        /**
         * Adds a title to the toast
         * @member {Number} title_=null
         * @reactive
         */
        title_: null,
        /**
         * @member {String|null} title=null
         * @reactive
         */
        vdom:
        {cn: [
            {cls: 'neo-toast-inner', cn: [
                {cls: ['neo-toast-icon'], removeDom: true},
                {cls: 'neo-toast-text', cn: [
                    {cls: ['neo-toast-title'], removeDom: true},
                    {cls: 'neo-toast-msg'}
                ]},
                {cls: ['neo-toast-close', 'fa', 'fa-close'], removeDom: true}
            ]}
        ]}
    }

    /**
     * Timeout in ms after which the toast is removed
     * @member {Number} removeDelay=3000
     */
    removeDelay = 3000
    /**
     * Used by the ToastManager
     * @member {Boolean} running=false
     * @private
     */
    running = false

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me = this;

        // click listener for close
        me.addDomListeners([
            {click: {fn: me.destroy, delegate: '.neo-toast-close', scope: me}}
        ]);

        _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].register(me)
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetClosable(value, oldValue) {
        let vdom = this.getVdomInner().cn[2];

        vdom.removeDom = !value
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetIconCls(value, oldValue) {
        let vdom  = this.getVdomInner().cn[0],
            {cls} = vdom;

        vdom.removeDom = Neo.isEmpty(value);
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"][value ? 'add' : 'remove'](cls, value)
    }

    /**
     * Using the afterSetMsg to trigger the setup of the dom
     * A new container is added as an item.
     * We cannot use the vdom here.
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetMsg(value, oldValue) {
        let vdom = this.getTextRootVdom().cn[1];

        vdom.text = value
    }

    /**
     * Apply a cls, based on the position
     * @param {String} value
     * @param {String} oldValue
     */
    afterSetPosition(value, oldValue) {
        value && this.addCls(`neo-toast-${value}`)
    }

    /**
     * Apply a cls, based on the slideDirection
     * @param {String} value
     * @param {String} oldValue
     */
    afterSetSlideDirection(value, oldValue) {
        value && this.addCls(`neo-toast-slide-${value}-in`)
    }

    /**
     * Close the toast after the mounted if not closable
     * @param {Boolean} value
     * @param {Boolean} oldValue
     */
    afterSetMounted(value, oldValue) {
        super.afterSetMounted(value, oldValue);

        let me = this;

        if (!me.closable && value) {
            me.timeout(me.removeDelay).then(() => {
                me.destroy(true)
            })
        }
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetTitle(value, oldValue) {
        let vdom = this.getTextRootVdom().cn[0];

        vdom.removeDom = Neo.isEmpty(value);
        vdom.text      = value;
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].toggle(vdom.cls, 'neo-toast-has-title', value);

        this.update()
    }

    /**
     * Triggered before the position config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetPosition(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'position')
    }

    /**
     * Triggered before the slideDirection config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetSlideDirection(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'slideDirection')
    }

    /**
     *
     */
    async destroy(...args) {
        let me = this;
        const superDestroy = super.destroy.bind(me);

        me.addDomListeners({
            animationend: function () {
                _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].removeToast(me.id);
                _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].unregister(me);
                superDestroy(...args);
            }
        });

        me.addCls('neo-toast-fade-out')
    }

    /**
     * This is a dialog, so we have to add an item to be able to
     * @returns {Object} vdom
     */
    getTextRootVdom() {
        return this.getVdomInner().cn[1]
    }

    /**
     * This is a dialog, so we have to add an item to be able to
     * @returns {Object} vdom
     */
    getVdomInner() {
        return this.vdom.cn[0]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Toast));


/***/ },

/***/ "./src/manager/Toast.mjs"
/*!*******************************!*\
  !*** ./src/manager/Toast.mjs ***!
  \*******************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/manager/Base.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");



/**
 * See Neo.dialog.Toast for examples
 * @class Neo.manager.Toast
 * @extends Neo.manager.Base
 * @singleton
 */
class Toast extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.manager.Toast'
         * @protected
         */
        className: 'Neo.manager.Toast',
        /**
         * @member {Boolean} singleton=true
         * @protected
         */
        singleton: true
    }

    /**
     * Using a default margin between the item
     * If you switch the distance to the top or bottom you have to change this value accordingly
     * @member {Number} defaultMargin=16
     */
    defaultMargin = 16
    /**
     * Currently only 1 is supported, because they would overlap
     * @member {Number} maxToasts=3
     */
    maxToasts = 3
    /**
     * Counts the currently running Toasts per area
     * @member {Object} running
     */
    running = {
        bc: [], bl: [], br: [],
        tc: [], tl: [], tr: []
    }
    /**
     * If you prefer your own class to open, override here
     * @member {String} toastClass='Neo.component.Toast'
     */
    toastClass = 'Neo.component.Toast'

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);
        Neo.toast = this.createToast.bind(this);
    }

    /**
     * Create the Toast definition and pass it to the Collection
     * @param {Object} toast
     * @returns {String|null}
     */
    createToast(toast) {
        let me = this;

        if (toast.position && !me.running[toast.position]) {
            Neo.logError('[Neo.manager.Toast] Supported values for slideDirection are: tl, tc, tr, bl, bc, br');
            return null
        }

        if (!toast.msg || !toast.appName) {
            !toast.msg     && Neo.logError('[Neo.manager.Toast] Toast has to define a msg');
            !toast.appName && Neo.logError('[Neo.manager.Toast] Toast has to define an appName. Typically me.appName.');
            return null
        }

        toast = Neo.create({
            className: this.toastClass,
            ...toast
        });

        toast.on({
            mounted: me.updateItemsInPosition,
            scope  : me
        })

        return toast.id
    }

    /**
     * Find the first toast based on the maximum allowed toasts
     * @returns {*}
     * @private
     */
    findFirstToast() {
        let me = this,
            firstToast, item;

        me.filters = [{property: 'running', value: false}];

        for (item of me.map.values()) {
            if (me.running[item.position].length < me.maxToasts) {
                firstToast = item;
                firstToast.running = true;
                break
            }
        }

        me.clearFilters();

        return firstToast
    }

    /**
     * @param {Object} item
     */
    register(item) {
        super.register(item);
        this.runQueue()
    }

    /**
     * Removes a task from collection.
     * @param {String} toastId
     */
    removeToast(toastId) {
        let me    = this,
            toast = me.get(toastId),
            position;

        if (!toast) {
            return
        }

        position = toast.position;

        // decrease total of displayed toasts for a position
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].remove(me.running[position], toastId);

        me.updateItemsInPosition(toastId)
    }

    /**
     * Runs a ToastManager to show an item from collection.
     */
    runQueue() {
        let me = this,
            toast;

        if (me.getCount() > 0) {
            toast = me.findFirstToast();

            toast && me.showToast(toast)
        }
    }

    /**
     * @param {Neo.component.Toast} toast
     */
    showToast(toast) {
        toast.initVnode(true);

        let me = this;

        // increase total of displayed toasts for a position
        me.running[toast.position].unshift(toast.id);

        // todo: we could use a mounted listener
        me.timeout(50).then(() => {
            me.updateItemsInPosition(toast.id)
        })
    }

    /**
     * Removes a collection item passed by reference or key
     * @param {Object|String} item
     */
    unregister(item) {
        super.unregister(item);
        this.runQueue()
    }

    /**
     * To handle multiple toasts we handle the exact position
     * from the top or bottom
     * @param {String} id
     * @returns {Promise<void>}
     */
    async updateItemsInPosition(id) {
        let me            = this,
            toast         = me.get(id),
            {position}    = toast,
            positionArray = me.running[position],
            acc           = 0,
            margin        = me.defaultMargin,
            moveTo        = position.substring(0, 1) === 't' ? 'top' : 'bottom',
            component, componentId, index, moveObj, rects;

        rects = await toast.getDomRect(positionArray);

        for ([index, componentId] of positionArray.entries()) {
            component = Neo.getComponent(componentId);
            moveObj   = {};

            acc = acc + margin;
            moveObj[moveTo] = acc + 'px';
            component.style = moveObj;
            component.update();

            // Sometimes the index is already reduced
            // so the last index might not be available
            if(rects[index]) {
                acc = acc + rects[index].height
            }
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Toast));


/***/ }

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLXNyY19jb21wb25lbnRfVG9hc3RfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBaUQ7QUFDSjtBQUNHOztBQUVoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0Esb0JBQW9CLDJEQUFTO0FBQzdCO0FBQ0E7QUFDQSxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsVUFBVTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLCtCQUErQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELFVBQVU7QUFDM0Qsb0JBQW9CLDRCQUE0QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQSxTQUFT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QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLGtDQUFrQzs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxRQUFRLHVEQUFROztBQUVoQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUscUJBQXFCO0FBQ3BDO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxlQUFlO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsYUFBYTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLHFCQUFxQixFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9jb21wb25lbnQvVG9hc3QubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvbWFuYWdlci9Ub2FzdC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbXBvbmVudCAgICBmcm9tICcuLi9jb21wb25lbnQvQmFzZS5tanMnO1xuaW1wb3J0IE5lb0FycmF5ICAgICBmcm9tIFwiLi4vdXRpbC9BcnJheS5tanNcIjtcbmltcG9ydCBUb2FzdE1hbmFnZXIgZnJvbSAnLi4vbWFuYWdlci9Ub2FzdC5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8uY29tcG9uZW50LlRvYXN0XG4gKiBAZXh0ZW5kcyBOZW8uY29tcG9uZW50LkJhc2VcbiAqXG4gKiBAZXhhbXBsZVxuICAgICAgICBOZW8udG9hc3Qoe1xuICAgICAgICAgICAgLy8gbWFuZGF0b3J5XG4gICAgICAgICAgICBhcHBOYW1lICAgICAgICAgOiB0aGlzLmNvbXBvbmVudC5hcHBOYW1lLFxuICAgICAgICAgICAgbXNnICAgICAgICAgICAgIDogJ0FsYXJtIHdhcyBzZXQgdG8gMTE6MzAgZm9yIGpvdXJuZXkgaW50byBOZW8gZGV2ZWxvcG1lbnQnLFxuICAgICAgICAgICAgd2luZG93SWQgICAgICAgIDogdGhpcy5jb21wb25lbnQud2luZG93SWRcbiAgICAgICAgICAgIC8vIG9wdGlvbmFsICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdHNcbiAgICAgICAgICAgIGNsb3NhYmxlICAgICAgICA6IHRydWUsICAgICAgICAgLy8gZmFsc2VcbiAgICAgICAgICAgIGljb25DbHMgICAgICAgICA6ICdmYSBmYS1iZWxsJywgLy8gbnVsbFxuICAgICAgICAgICAgbWF4V2lkdGggICAgICAgIDogMzAwLCAgICAgICAgICAvLyAyNTBcbiAgICAgICAgICAgIHBvc2l0aW9uICAgICAgICA6ICdicicsICAgICAgICAgLy8gJ3RyJ1xuICAgICAgICAgICAgc2xpZGVEaXJlY3Rpb24gIDogJ3JpZ2h0JywgICAgICAvLyAncmlnaHQnXG4gICAgICAgICAgICB0aXRsZSAgICAgICAgICAgOiAnQWxhcm0gQ2xvY2snIC8vIG51bGxcbiAgICAgICAgfSlcbiAqL1xuY2xhc3MgVG9hc3QgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIFZhbGlkIHZhbHVlcyBmb3IgcG9zaXRpb25zXG4gICAgICogQG1lbWJlciB7U3RyaW5nW119IHBvc2l0aW9ucyA9IFsndGwnLCd0YycsJ3RyJywnYmwnLCdiYycsJ2JyJ11cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICogQHN0YXRpY1xuICAgICAqL1xuICAgIHN0YXRpYyBwb3NpdGlvbnMgPSBbJ3RsJywgJ3RjJywgJ3RyJywgJ2JsJywgJ2JjJywgJ2JyJ11cbiAgICAvKipcbiAgICAgKiBUcnVlIGF1dG9tYXRpY2FsbHkgYXBwbGllcyB0aGUgY29yZS9PYnNlcnZhYmxlLm1qcyBtaXhpblxuICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBzbGlkZURpcmVjdGlvbnMgPSBbJ2Rvd24nLCd1cCcsJ2xlZnQnLCdyaWdodCddXG4gICAgICogQHN0YXRpY1xuICAgICAqL1xuICAgIHN0YXRpYyBzbGlkZURpcmVjdGlvbnMgPSBbJ2Rvd24nLCAndXAnLCAnbGVmdCcsICdyaWdodCddXG5cbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5jb21wb25lbnQuVG9hc3QnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5jb21wb25lbnQuVG9hc3QnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBudHlwZT0ndG9hc3QnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG50eXBlOiAndG9hc3QnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nW119IGJhc2VDbHM9WyduZW8tdG9hc3QnXVxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBiYXNlQ2xzOiBbJ25lby10b2FzdCddLFxuICAgICAgICAvKipcbiAgICAgICAgICogSWYgdHJ1ZSBtYWtlcyB0aGUgdG9hc3Qgc3RpY2t5IGFuZCBzaG93IGEgY2xvc2UgaWNvblxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBjbG9zYWJsZV89ZmFsc2VcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBjbG9zYWJsZV86IGZhbHNlLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gZmxvYXRpbmc9dHJ1ZVxuICAgICAgICAgKi9cbiAgICAgICAgZmxvYXRpbmc6IHRydWUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZiBzZXQsIGl0IHNob3dzIHRoaXMgaWNvbiBpbiBmcm9udCBvZiB0aGUgdGV4dFxuICAgICAgICAgKiBlLmcuICdmYSBmYS1jb2cnXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBpY29uQ2xzXz1udWxsXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgaWNvbkNsc186IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaW1pdHMgdGhlIHdpZHRoIG9mIHRoZSBUb2FzdFxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IG1heFdpZHRoPTI1MFxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIG1heFdpZHRoOiAyNTAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHRoZSBtaW5pbXVtIGhlaWdodCBvZiB0aGUgVG9hc3RcbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfSBtaW5IZWlnaHQ9NTBcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBtaW5IZWlnaHQ6IDUwLFxuICAgICAgICAvKipcbiAgICAgICAgICogWW91ciBtZXNzYWdlLiBZb3UgY2FuIGFsc28gcGFzcyBpbiBhbiBpY29uQ2xzXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBtc2dfPW51bGxcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBtc2dfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGVzY3JpYmVzIHRoZSBwb3NpdGlvbiBvZiB0aGUgdG9hc3QsIGUuZy4gYmw9Ym90dG9tLWxlZnRcbiAgICAgICAgICogVGhpcyBjcmVhdGVzIGEgY2xzIGBub2UtdG9hc3QtcG9zaXRpb25gXG4gICAgICAgICAqIEBtZW1iZXIgeyd0bCd8J3RjJ3wndHInfCdibCd8J2JjJ3wnYnInfSBwb3NpdGlvbl89J3RyJ1xuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIHBvc2l0aW9uXzogJ3RyJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlc2NyaWJlcyB3aGljaCBkaXJlY3Rpb24gZnJvbSB3aGljaCBzaWRlIHRoZSB0b2FzdHMgc2xpZGVzLWluXG4gICAgICAgICAqIFRoaXMgY3JlYXRlcyBhIGNscyBgbmVvLXRvYXN0LXNsaWRlLSR7ZGlyZWN0aW9ufS1pbmBcbiAgICAgICAgICogQG1lbWJlciB7J2Rvd24nfCd1cCd8J2xlZnQnfCdyaWdodCd9IHNsaWRlRGlyZWN0aW9uXz0ncmlnaHQnXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgc2xpZGVEaXJlY3Rpb25fOiAncmlnaHQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkcyBhIHRpdGxlIHRvIHRoZSB0b2FzdFxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IHRpdGxlXz1udWxsXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGl0bGVfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IHRpdGxlPW51bGxcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICB2ZG9tOlxuICAgICAgICB7Y246IFtcbiAgICAgICAgICAgIHtjbHM6ICduZW8tdG9hc3QtaW5uZXInLCBjbjogW1xuICAgICAgICAgICAgICAgIHtjbHM6IFsnbmVvLXRvYXN0LWljb24nXSwgcmVtb3ZlRG9tOiB0cnVlfSxcbiAgICAgICAgICAgICAgICB7Y2xzOiAnbmVvLXRvYXN0LXRleHQnLCBjbjogW1xuICAgICAgICAgICAgICAgICAgICB7Y2xzOiBbJ25lby10b2FzdC10aXRsZSddLCByZW1vdmVEb206IHRydWV9LFxuICAgICAgICAgICAgICAgICAgICB7Y2xzOiAnbmVvLXRvYXN0LW1zZyd9XG4gICAgICAgICAgICAgICAgXX0sXG4gICAgICAgICAgICAgICAge2NsczogWyduZW8tdG9hc3QtY2xvc2UnLCAnZmEnLCAnZmEtY2xvc2UnXSwgcmVtb3ZlRG9tOiB0cnVlfVxuICAgICAgICAgICAgXX1cbiAgICAgICAgXX1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaW1lb3V0IGluIG1zIGFmdGVyIHdoaWNoIHRoZSB0b2FzdCBpcyByZW1vdmVkXG4gICAgICogQG1lbWJlciB7TnVtYmVyfSByZW1vdmVEZWxheT0zMDAwXG4gICAgICovXG4gICAgcmVtb3ZlRGVsYXkgPSAzMDAwXG4gICAgLyoqXG4gICAgICogVXNlZCBieSB0aGUgVG9hc3RNYW5hZ2VyXG4gICAgICogQG1lbWJlciB7Qm9vbGVhbn0gcnVubmluZz1mYWxzZVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcnVubmluZyA9IGZhbHNlXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0KGNvbmZpZykge1xuICAgICAgICBzdXBlci5jb25zdHJ1Y3QoY29uZmlnKTtcblxuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIC8vIGNsaWNrIGxpc3RlbmVyIGZvciBjbG9zZVxuICAgICAgICBtZS5hZGREb21MaXN0ZW5lcnMoW1xuICAgICAgICAgICAge2NsaWNrOiB7Zm46IG1lLmRlc3Ryb3ksIGRlbGVnYXRlOiAnLm5lby10b2FzdC1jbG9zZScsIHNjb3BlOiBtZX19XG4gICAgICAgIF0pO1xuXG4gICAgICAgIFRvYXN0TWFuYWdlci5yZWdpc3RlcihtZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IG9sZFZhbHVlXG4gICAgICovXG4gICAgYWZ0ZXJTZXRDbG9zYWJsZSh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IHZkb20gPSB0aGlzLmdldFZkb21Jbm5lcigpLmNuWzJdO1xuXG4gICAgICAgIHZkb20ucmVtb3ZlRG9tID0gIXZhbHVlXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBvbGRWYWx1ZVxuICAgICAqL1xuICAgIGFmdGVyU2V0SWNvbkNscyh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IHZkb20gID0gdGhpcy5nZXRWZG9tSW5uZXIoKS5jblswXSxcbiAgICAgICAgICAgIHtjbHN9ID0gdmRvbTtcblxuICAgICAgICB2ZG9tLnJlbW92ZURvbSA9IE5lby5pc0VtcHR5KHZhbHVlKTtcbiAgICAgICAgTmVvQXJyYXlbdmFsdWUgPyAnYWRkJyA6ICdyZW1vdmUnXShjbHMsIHZhbHVlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVzaW5nIHRoZSBhZnRlclNldE1zZyB0byB0cmlnZ2VyIHRoZSBzZXR1cCBvZiB0aGUgZG9tXG4gICAgICogQSBuZXcgY29udGFpbmVyIGlzIGFkZGVkIGFzIGFuIGl0ZW0uXG4gICAgICogV2UgY2Fubm90IHVzZSB0aGUgdmRvbSBoZXJlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldE1zZyh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IHZkb20gPSB0aGlzLmdldFRleHRSb290VmRvbSgpLmNuWzFdO1xuXG4gICAgICAgIHZkb20udGV4dCA9IHZhbHVlXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwbHkgYSBjbHMsIGJhc2VkIG9uIHRoZSBwb3NpdGlvblxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqL1xuICAgIGFmdGVyU2V0UG9zaXRpb24odmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHZhbHVlICYmIHRoaXMuYWRkQ2xzKGBuZW8tdG9hc3QtJHt2YWx1ZX1gKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwcGx5IGEgY2xzLCBiYXNlZCBvbiB0aGUgc2xpZGVEaXJlY3Rpb25cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldFNsaWRlRGlyZWN0aW9uKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB2YWx1ZSAmJiB0aGlzLmFkZENscyhgbmVvLXRvYXN0LXNsaWRlLSR7dmFsdWV9LWluYClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbG9zZSB0aGUgdG9hc3QgYWZ0ZXIgdGhlIG1vdW50ZWQgaWYgbm90IGNsb3NhYmxlXG4gICAgICogQHBhcmFtIHtCb29sZWFufSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldE1vdW50ZWQodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHN1cGVyLmFmdGVyU2V0TW91bnRlZCh2YWx1ZSwgb2xkVmFsdWUpO1xuXG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCFtZS5jbG9zYWJsZSAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgbWUudGltZW91dChtZS5yZW1vdmVEZWxheSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgbWUuZGVzdHJveSh0cnVlKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldFRpdGxlKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBsZXQgdmRvbSA9IHRoaXMuZ2V0VGV4dFJvb3RWZG9tKCkuY25bMF07XG5cbiAgICAgICAgdmRvbS5yZW1vdmVEb20gPSBOZW8uaXNFbXB0eSh2YWx1ZSk7XG4gICAgICAgIHZkb20udGV4dCAgICAgID0gdmFsdWU7XG4gICAgICAgIE5lb0FycmF5LnRvZ2dsZSh2ZG9tLmNscywgJ25lby10b2FzdC1oYXMtdGl0bGUnLCB2YWx1ZSk7XG5cbiAgICAgICAgdGhpcy51cGRhdGUoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBiZWZvcmUgdGhlIHBvc2l0aW9uIGNvbmZpZyBnZXRzIGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYmVmb3JlU2V0UG9zaXRpb24odmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVNldEVudW1WYWx1ZSh2YWx1ZSwgb2xkVmFsdWUsICdwb3NpdGlvbicpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGJlZm9yZSB0aGUgc2xpZGVEaXJlY3Rpb24gY29uZmlnIGdldHMgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBiZWZvcmVTZXRTbGlkZURpcmVjdGlvbih2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmVmb3JlU2V0RW51bVZhbHVlKHZhbHVlLCBvbGRWYWx1ZSwgJ3NsaWRlRGlyZWN0aW9uJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGFzeW5jIGRlc3Ryb3koLi4uYXJncykge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuICAgICAgICBjb25zdCBzdXBlckRlc3Ryb3kgPSBzdXBlci5kZXN0cm95LmJpbmQobWUpO1xuXG4gICAgICAgIG1lLmFkZERvbUxpc3RlbmVycyh7XG4gICAgICAgICAgICBhbmltYXRpb25lbmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBUb2FzdE1hbmFnZXIucmVtb3ZlVG9hc3QobWUuaWQpO1xuICAgICAgICAgICAgICAgIFRvYXN0TWFuYWdlci51bnJlZ2lzdGVyKG1lKTtcbiAgICAgICAgICAgICAgICBzdXBlckRlc3Ryb3koLi4uYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1lLmFkZENscygnbmVvLXRvYXN0LWZhZGUtb3V0JylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIGEgZGlhbG9nLCBzbyB3ZSBoYXZlIHRvIGFkZCBhbiBpdGVtIHRvIGJlIGFibGUgdG9cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSB2ZG9tXG4gICAgICovXG4gICAgZ2V0VGV4dFJvb3RWZG9tKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRWZG9tSW5uZXIoKS5jblsxXVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgaXMgYSBkaWFsb2csIHNvIHdlIGhhdmUgdG8gYWRkIGFuIGl0ZW0gdG8gYmUgYWJsZSB0b1xuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IHZkb21cbiAgICAgKi9cbiAgICBnZXRWZG9tSW5uZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZkb20uY25bMF1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKFRvYXN0KTtcbiIsImltcG9ydCBNYW5hZ2VyICBmcm9tICcuL0Jhc2UubWpzJztcbmltcG9ydCBOZW9BcnJheSBmcm9tICcuLi91dGlsL0FycmF5Lm1qcyc7XG5cbi8qKlxuICogU2VlIE5lby5kaWFsb2cuVG9hc3QgZm9yIGV4YW1wbGVzXG4gKiBAY2xhc3MgTmVvLm1hbmFnZXIuVG9hc3RcbiAqIEBleHRlbmRzIE5lby5tYW5hZ2VyLkJhc2VcbiAqIEBzaW5nbGV0b25cbiAqL1xuY2xhc3MgVG9hc3QgZXh0ZW5kcyBNYW5hZ2VyIHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5tYW5hZ2VyLlRvYXN0J1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8ubWFuYWdlci5Ub2FzdCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBzaW5nbGV0b249dHJ1ZVxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBzaW5nbGV0b246IHRydWVcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVc2luZyBhIGRlZmF1bHQgbWFyZ2luIGJldHdlZW4gdGhlIGl0ZW1cbiAgICAgKiBJZiB5b3Ugc3dpdGNoIHRoZSBkaXN0YW5jZSB0byB0aGUgdG9wIG9yIGJvdHRvbSB5b3UgaGF2ZSB0byBjaGFuZ2UgdGhpcyB2YWx1ZSBhY2NvcmRpbmdseVxuICAgICAqIEBtZW1iZXIge051bWJlcn0gZGVmYXVsdE1hcmdpbj0xNlxuICAgICAqL1xuICAgIGRlZmF1bHRNYXJnaW4gPSAxNlxuICAgIC8qKlxuICAgICAqIEN1cnJlbnRseSBvbmx5IDEgaXMgc3VwcG9ydGVkLCBiZWNhdXNlIHRoZXkgd291bGQgb3ZlcmxhcFxuICAgICAqIEBtZW1iZXIge051bWJlcn0gbWF4VG9hc3RzPTNcbiAgICAgKi9cbiAgICBtYXhUb2FzdHMgPSAzXG4gICAgLyoqXG4gICAgICogQ291bnRzIHRoZSBjdXJyZW50bHkgcnVubmluZyBUb2FzdHMgcGVyIGFyZWFcbiAgICAgKiBAbWVtYmVyIHtPYmplY3R9IHJ1bm5pbmdcbiAgICAgKi9cbiAgICBydW5uaW5nID0ge1xuICAgICAgICBiYzogW10sIGJsOiBbXSwgYnI6IFtdLFxuICAgICAgICB0YzogW10sIHRsOiBbXSwgdHI6IFtdXG4gICAgfVxuICAgIC8qKlxuICAgICAqIElmIHlvdSBwcmVmZXIgeW91ciBvd24gY2xhc3MgdG8gb3Blbiwgb3ZlcnJpZGUgaGVyZVxuICAgICAqIEBtZW1iZXIge1N0cmluZ30gdG9hc3RDbGFzcz0nTmVvLmNvbXBvbmVudC5Ub2FzdCdcbiAgICAgKi9cbiAgICB0b2FzdENsYXNzID0gJ05lby5jb21wb25lbnQuVG9hc3QnXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0KGNvbmZpZykge1xuICAgICAgICBzdXBlci5jb25zdHJ1Y3QoY29uZmlnKTtcbiAgICAgICAgTmVvLnRvYXN0ID0gdGhpcy5jcmVhdGVUb2FzdC5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgVG9hc3QgZGVmaW5pdGlvbiBhbmQgcGFzcyBpdCB0byB0aGUgQ29sbGVjdGlvblxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0b2FzdFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd8bnVsbH1cbiAgICAgKi9cbiAgICBjcmVhdGVUb2FzdCh0b2FzdCkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGlmICh0b2FzdC5wb3NpdGlvbiAmJiAhbWUucnVubmluZ1t0b2FzdC5wb3NpdGlvbl0pIHtcbiAgICAgICAgICAgIE5lby5sb2dFcnJvcignW05lby5tYW5hZ2VyLlRvYXN0XSBTdXBwb3J0ZWQgdmFsdWVzIGZvciBzbGlkZURpcmVjdGlvbiBhcmU6IHRsLCB0YywgdHIsIGJsLCBiYywgYnInKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRvYXN0Lm1zZyB8fCAhdG9hc3QuYXBwTmFtZSkge1xuICAgICAgICAgICAgIXRvYXN0Lm1zZyAgICAgJiYgTmVvLmxvZ0Vycm9yKCdbTmVvLm1hbmFnZXIuVG9hc3RdIFRvYXN0IGhhcyB0byBkZWZpbmUgYSBtc2cnKTtcbiAgICAgICAgICAgICF0b2FzdC5hcHBOYW1lICYmIE5lby5sb2dFcnJvcignW05lby5tYW5hZ2VyLlRvYXN0XSBUb2FzdCBoYXMgdG8gZGVmaW5lIGFuIGFwcE5hbWUuIFR5cGljYWxseSBtZS5hcHBOYW1lLicpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuXG4gICAgICAgIHRvYXN0ID0gTmVvLmNyZWF0ZSh7XG4gICAgICAgICAgICBjbGFzc05hbWU6IHRoaXMudG9hc3RDbGFzcyxcbiAgICAgICAgICAgIC4uLnRvYXN0XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRvYXN0Lm9uKHtcbiAgICAgICAgICAgIG1vdW50ZWQ6IG1lLnVwZGF0ZUl0ZW1zSW5Qb3NpdGlvbixcbiAgICAgICAgICAgIHNjb3BlICA6IG1lXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHRvYXN0LmlkXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCB0aGUgZmlyc3QgdG9hc3QgYmFzZWQgb24gdGhlIG1heGltdW0gYWxsb3dlZCB0b2FzdHNcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZpbmRGaXJzdFRvYXN0KCkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzLFxuICAgICAgICAgICAgZmlyc3RUb2FzdCwgaXRlbTtcblxuICAgICAgICBtZS5maWx0ZXJzID0gW3twcm9wZXJ0eTogJ3J1bm5pbmcnLCB2YWx1ZTogZmFsc2V9XTtcblxuICAgICAgICBmb3IgKGl0ZW0gb2YgbWUubWFwLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBpZiAobWUucnVubmluZ1tpdGVtLnBvc2l0aW9uXS5sZW5ndGggPCBtZS5tYXhUb2FzdHMpIHtcbiAgICAgICAgICAgICAgICBmaXJzdFRvYXN0ID0gaXRlbTtcbiAgICAgICAgICAgICAgICBmaXJzdFRvYXN0LnJ1bm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBtZS5jbGVhckZpbHRlcnMoKTtcblxuICAgICAgICByZXR1cm4gZmlyc3RUb2FzdFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtXG4gICAgICovXG4gICAgcmVnaXN0ZXIoaXRlbSkge1xuICAgICAgICBzdXBlci5yZWdpc3RlcihpdGVtKTtcbiAgICAgICAgdGhpcy5ydW5RdWV1ZSgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIHRhc2sgZnJvbSBjb2xsZWN0aW9uLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0b2FzdElkXG4gICAgICovXG4gICAgcmVtb3ZlVG9hc3QodG9hc3RJZCkge1xuICAgICAgICBsZXQgbWUgICAgPSB0aGlzLFxuICAgICAgICAgICAgdG9hc3QgPSBtZS5nZXQodG9hc3RJZCksXG4gICAgICAgICAgICBwb3NpdGlvbjtcblxuICAgICAgICBpZiAoIXRvYXN0KSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHBvc2l0aW9uID0gdG9hc3QucG9zaXRpb247XG5cbiAgICAgICAgLy8gZGVjcmVhc2UgdG90YWwgb2YgZGlzcGxheWVkIHRvYXN0cyBmb3IgYSBwb3NpdGlvblxuICAgICAgICBOZW9BcnJheS5yZW1vdmUobWUucnVubmluZ1twb3NpdGlvbl0sIHRvYXN0SWQpO1xuXG4gICAgICAgIG1lLnVwZGF0ZUl0ZW1zSW5Qb3NpdGlvbih0b2FzdElkKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJ1bnMgYSBUb2FzdE1hbmFnZXIgdG8gc2hvdyBhbiBpdGVtIGZyb20gY29sbGVjdGlvbi5cbiAgICAgKi9cbiAgICBydW5RdWV1ZSgpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcyxcbiAgICAgICAgICAgIHRvYXN0O1xuXG4gICAgICAgIGlmIChtZS5nZXRDb3VudCgpID4gMCkge1xuICAgICAgICAgICAgdG9hc3QgPSBtZS5maW5kRmlyc3RUb2FzdCgpO1xuXG4gICAgICAgICAgICB0b2FzdCAmJiBtZS5zaG93VG9hc3QodG9hc3QpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge05lby5jb21wb25lbnQuVG9hc3R9IHRvYXN0XG4gICAgICovXG4gICAgc2hvd1RvYXN0KHRvYXN0KSB7XG4gICAgICAgIHRvYXN0LmluaXRWbm9kZSh0cnVlKTtcblxuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIC8vIGluY3JlYXNlIHRvdGFsIG9mIGRpc3BsYXllZCB0b2FzdHMgZm9yIGEgcG9zaXRpb25cbiAgICAgICAgbWUucnVubmluZ1t0b2FzdC5wb3NpdGlvbl0udW5zaGlmdCh0b2FzdC5pZCk7XG5cbiAgICAgICAgLy8gdG9kbzogd2UgY291bGQgdXNlIGEgbW91bnRlZCBsaXN0ZW5lclxuICAgICAgICBtZS50aW1lb3V0KDUwKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIG1lLnVwZGF0ZUl0ZW1zSW5Qb3NpdGlvbih0b2FzdC5pZClcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgY29sbGVjdGlvbiBpdGVtIHBhc3NlZCBieSByZWZlcmVuY2Ugb3Iga2V5XG4gICAgICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBpdGVtXG4gICAgICovXG4gICAgdW5yZWdpc3RlcihpdGVtKSB7XG4gICAgICAgIHN1cGVyLnVucmVnaXN0ZXIoaXRlbSk7XG4gICAgICAgIHRoaXMucnVuUXVldWUoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvIGhhbmRsZSBtdWx0aXBsZSB0b2FzdHMgd2UgaGFuZGxlIHRoZSBleGFjdCBwb3NpdGlvblxuICAgICAqIGZyb20gdGhlIHRvcCBvciBib3R0b21cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWRcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVJdGVtc0luUG9zaXRpb24oaWQpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgdG9hc3QgICAgICAgICA9IG1lLmdldChpZCksXG4gICAgICAgICAgICB7cG9zaXRpb259ICAgID0gdG9hc3QsXG4gICAgICAgICAgICBwb3NpdGlvbkFycmF5ID0gbWUucnVubmluZ1twb3NpdGlvbl0sXG4gICAgICAgICAgICBhY2MgICAgICAgICAgID0gMCxcbiAgICAgICAgICAgIG1hcmdpbiAgICAgICAgPSBtZS5kZWZhdWx0TWFyZ2luLFxuICAgICAgICAgICAgbW92ZVRvICAgICAgICA9IHBvc2l0aW9uLnN1YnN0cmluZygwLCAxKSA9PT0gJ3QnID8gJ3RvcCcgOiAnYm90dG9tJyxcbiAgICAgICAgICAgIGNvbXBvbmVudCwgY29tcG9uZW50SWQsIGluZGV4LCBtb3ZlT2JqLCByZWN0cztcblxuICAgICAgICByZWN0cyA9IGF3YWl0IHRvYXN0LmdldERvbVJlY3QocG9zaXRpb25BcnJheSk7XG5cbiAgICAgICAgZm9yIChbaW5kZXgsIGNvbXBvbmVudElkXSBvZiBwb3NpdGlvbkFycmF5LmVudHJpZXMoKSkge1xuICAgICAgICAgICAgY29tcG9uZW50ID0gTmVvLmdldENvbXBvbmVudChjb21wb25lbnRJZCk7XG4gICAgICAgICAgICBtb3ZlT2JqICAgPSB7fTtcblxuICAgICAgICAgICAgYWNjID0gYWNjICsgbWFyZ2luO1xuICAgICAgICAgICAgbW92ZU9ialttb3ZlVG9dID0gYWNjICsgJ3B4JztcbiAgICAgICAgICAgIGNvbXBvbmVudC5zdHlsZSA9IG1vdmVPYmo7XG4gICAgICAgICAgICBjb21wb25lbnQudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIC8vIFNvbWV0aW1lcyB0aGUgaW5kZXggaXMgYWxyZWFkeSByZWR1Y2VkXG4gICAgICAgICAgICAvLyBzbyB0aGUgbGFzdCBpbmRleCBtaWdodCBub3QgYmUgYXZhaWxhYmxlXG4gICAgICAgICAgICBpZihyZWN0c1tpbmRleF0pIHtcbiAgICAgICAgICAgICAgICBhY2MgPSBhY2MgKyByZWN0c1tpbmRleF0uaGVpZ2h0XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKFRvYXN0KTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=