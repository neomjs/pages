"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-src_code_LivePreview_mjs"],{

/***/ "./src/code/LivePreview.mjs"
/*!**********************************!*\
  !*** ./src/code/LivePreview.mjs ***!
  \**********************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _container_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../container/Base.mjs */ "./src/container/Base.mjs");
/* harmony import */ var _component_wrapper_MonacoEditor_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component/wrapper/MonacoEditor.mjs */ "./src/component/wrapper/MonacoEditor.mjs");
/* harmony import */ var _tab_Container_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../tab/Container.mjs */ "./src/tab/Container.mjs");




const configSymbol = Symbol.for('configSymbol');

/**
 * @summary A split-view component for real-time code editing and execution.
 *
 * This class provides a robust environment for editing source code and viewing the results in real-time.
 * It integrates the **Monaco Editor** for a rich editing experience and supports multiple languages and execution modes.
 *
 * Key features:
 * - **Multi-Language Support**: Supports 'neomjs' (JS execution) and 'markdown' (rendering).
 * - **Dynamic Imports**: Utilizes `import()` to lazy-load the Markdown component or Code Executor, optimizing initial load performance.
 * - **Sandboxed Execution**: Executes Neo.mjs code within a controlled context using `new Function`.
 * - **Responsive Layout**: collapsible, pop-out support, and configurable views (source vs. preview).
 *
 * This component is central to the Neo.mjs learning experience and documentation portal.
 *
 * @class Neo.code.LivePreview
 * @extends Neo.container.Base
 * @see Neo.code.executor.Neo
 * @see Neo.component.Markdown
 * @see Neo.component.wrapper.MonacoEditor
 */
class LivePreview extends _container_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    /**
     * Valid values for activeView
     * @member {String[]} activeViews=['preview','source']
     * @protected
     * @static
     */
    static activeViews = ['preview', 'source']
    /**
     * Valid values for language
     * @member {String[]} languages=['markdown','neomjs']
     * @protected
     * @static
     */
    static languages = ['markdown', 'neomjs']

    static config = {
        /**
         * @member {String} className='Neo.code.LivePreview'
         * @protected
         */
        className: 'Neo.code.LivePreview',
        /**
         * @member {String} ntype='live-preview'
         * @protected
         */
        ntype: 'live-preview',
        /**
         * Valid values are 'preview' and 'source'
         * @member {String} activeView_='source'
         * @reactive
         */
        activeView_: 'source',
        /**
         * @member {String[]} baseCls=['neo-code-live-preview']
         */
        baseCls: ['neo-code-live-preview'],
        /**
         * @member {Boolean} disableRunSource=false
         */
        disableRunSource: false,
        /**
         * @member {Boolean} enableFullscreen=true
         */
        enableFullscreen: true,
        /**
         * @member {String} language_='neomjs'
         * @reactive
         */
        language_: 'neomjs',
        /**
         * @member {Object|String} layout='fit'
         * @reactive
         */
        layout: 'fit',
        /**
         * @member {Object[]} items
         */
        items: [{
            module             : _tab_Container_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
            cls                : ['live-preview-container'],
            reference          : 'tab-container',
            removeInactiveCards: false,

            items: [{
                module   : _component_wrapper_MonacoEditor_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                header   : {text: 'Source'},
                hideLabel: true,
                listeners: {editorChange: 'up.onEditorChange'},
                style    : {height: '100%'},
                reference: 'editor'
            }, {
                module   : _container_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"],
                header   : {text: 'Preview'},
                reference: 'preview'
            }]
        }],
        /**
         * The code to display inside the Monaco editor
         * @member {String|null} value_=null
         * @reactive
         */
        value_: null,
        /**
         * The url for the child app to use for the popout window
         * @member {String} windowUrl_='./childapps/preview/index.html'
         * @reactive
         */
        windowUrl_: './childapps/preview/index.html'
    }

    /**
     * @member {Number|null} connectedWindowId=null
     */
    connectedWindowId = null
    /**
     * @member {Neo.component.Markdown|null} markdownComponent=null
     */
    markdownComponent = null
    /**
     * @member {Class|null} markdownComponentClass=null
     */
    markdownComponentClass = null
    /**
     * @member {Neo.code.executor.Neo|null} neoExecutor=null
     */
    neoExecutor = null
    /**
     * Link the preview output to different targets
     * @member {Neo.component.Base} previewContainer=null
     */
    previewContainer = null

    /**
     * @returns {Neo.component.Base|null}
     */
    get tabContainer() {
        return this.getItem('tab-container')
    }

    /**
     * Triggered after the activeView config got changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetActiveView(value, oldValue) {
        this.tabContainer.activeIndex = value === 'source' ? 0 : 1
    }

    /**
     * Triggered after the language config got changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetLanguage(value, oldValue) {
        let me = this;

        if (value !== 'markdown') {
            me.markdownComponent = null
        }

        me.getItem('editor').language = value === 'neomjs' ? 'javascript' : value;

        // If there is a new pending value for the value config, it will run trigger doRunSource().
        // This can happen when calling: this.set({language, value})
        if (oldValue && !Object.hasOwn(me[configSymbol], 'value')) {
            me.doRunSource()
        }
    }


    /**
     * Triggered after the value config got changed
     * @param {String|null} value
     * @param {String|null} oldValue
     * @protected
     */
    afterSetValue(value, oldValue) {
        if (value) {
            this.getItem('editor').value = value?.trim()
        }
    }

    /**
     * Triggered before the activeView config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @returns {String}
     * @protected
     */
    beforeSetActiveView(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'activeView')
    }

    /**
     * Triggered before the language config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @returns {String}
     * @protected
     */
    beforeSetLanguage(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'language')
    }

    /**
     * Triggered before the language config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @returns {String}
     * @protected
     */
    beforeSetWindowUrl(value, oldValue) {
        if (value.startsWith('./')) {
            let appPath = Neo.config.appPath.split('/');
            appPath.pop()

            return new URL(Neo.config.basePath + appPath.join('/') + value.substring(1), location.href).href
        }

        return value
    }

    /**
     * @param {Object} data
     */
    async collapseExpand(data) {
        let me       = this,
            button   = data.component,
            collapse = button.iconCls === 'fas fa-compress',
            {vdom}   = me,
            rect;

        if (collapse) {
            button.iconCls = 'fas fa-expand';

            rect = me.collapseRect;

            delete me.collapseRect;

            Object.assign(vdom.style, {
                height  : rect.height + 'px',
                left    : rect.x      + 'px',
                top     : rect.y      + 'px',
                width   : rect.width  + 'px'
            });

            me.update();

            await me.timeout(300);

            Object.assign(vdom.style, {
                position: null,
                zIndex  : null
            })
        } else {
            button.iconCls = 'fas fa-compress';

            rect = await me.getDomRect();

            me.collapseRect = rect;

            vdom.style = vdom.style || {};

            Object.assign(vdom.style, {
                height  : rect.height + 'px',
                left    : rect.x      + 'px',
                position: 'fixed',
                top     : rect.y      + 'px',
                width   : rect.width  + 'px',
                zIndex  : 103
            });

            me.update();

            await me.timeout(50);

            Object.assign(vdom.style, {
                height: '100%',
                left  : 0,
                top   : 0,
                width : '100%'
            })
        }

        me.update()
    }

    /**
     *
     */
    async createPopupWindow() {
        let me         = this,
            {windowId} = me,
            winData    = await Neo.Main.getWindowData({windowId}),
            rect       = await me.getDomRect(me.getReference('preview').id);

        let {height, left, top, width} = rect;

        left += winData.screenLeft;
        top  += (winData.outerHeight - winData.innerHeight + winData.screenTop);

        Neo.Main.windowOpen({
            url           : `${me.windowUrl}?id=${me.id}`,
            windowFeatures: `height=${height},left=${left},top=${top},width=${width}`,
            windowId,
            windowName    : me.id
        })
    }

    /**
     * @param {...*} args
     */
    destroy(...args) {
        if (this.connectedWindowId) {
            Neo.Main.windowClose({names: [this.id], windowId: this.windowId})
        }

        super.destroy(...args)
    }

    /**
     * Executes the current source code.
     *
     * This method acts as the **execution trigger**. It orchestrates the process by:
     * 1.  **Validation**: Ensuring source code exists.
     * 2.  **Execution**:
     *     - For **Markdown**: Clears the container and adds a new `Neo.component.Markdown` instance.
     *     - For **Neo.mjs**: Delegates execution to the `Neo.code.executor.Neo` instance.
     *
     * @returns {Promise<void>}
     */
    async doRunSource() {
        if (this.disableRunSource) {
            return
        }

        let me        = this,
            container = me.getPreviewContainer(),
            source    = me.editorValue || me.value; // Use current editor value or initial value

        if (!source) return;

        if (me.language === 'markdown') {
            if (!me.markdownComponentClass) {
                const module = await __webpack_require__.e(/*! import() */ "vendors-src_component_Markdown_mjs").then(__webpack_require__.bind(__webpack_require__, /*! ../component/Markdown.mjs */ "./src/component/Markdown.mjs"));
                me.markdownComponentClass = module.default;
            }

            if (me.markdownComponent && !me.markdownComponent.isDestroyed) {
                me.markdownComponent.value = source
            } else {
                // destroy, silent => merge changes into one update cycle
                container.removeAll(true, true);

                me.markdownComponent = container.add({
                    module   : me.markdownComponentClass,
                    style    : {height: '100%', overflow: 'auto'},
                    value    : source,
                    windowUrl: me.windowUrl
                })
            }
        } else {
            if (!me.neoExecutor) {
                const module = await __webpack_require__.e(/*! import() */ "src_code_executor_Neo_mjs").then(__webpack_require__.bind(__webpack_require__, /*! ./executor/Neo.mjs */ "./src/code/executor/Neo.mjs"));
                me.neoExecutor = Neo.create(module.default);
            }

            await me.neoExecutor.execute({code: source, container})
        }
    }

    /**
     * @returns {Neo.component.Base|null}
     */
    getPreviewContainer() {
        let me = this;

        if (me.previewContainer) {
            return me.previewContainer
        }

        return me.getReference('preview')
    }

    /**
     * @param {Object} data
     * @param {Neo.component.Base} data.item
     * @param {Number} data.oldValue
     * @param {String} data.source
     * @param {Number} data.value
     */
    onActiveIndexChange(data) {
        let me        = this,
            isPreview = data.value === 1;

        if (data.item.reference === 'preview') {
            me.doRunSource()
        }
        // Navigating to the source view should destroy the app, in case the preview view is not popped out
        else if (!isPreview && !me.previewContainer) {
            me.getReference('preview').removeAll()
        }

        me.getReference('popout-window-button').hidden = !isPreview
        me.disableRunSource = false;
    }

    /**
     *
     */
    onConstructed() {
        super.onConstructed();

        let me             = this,
            items          = [],
            {tabContainer} = me;

        me.editor

        if (me.enableFullscreen) {
            items.push({
                handler: me.collapseExpand.bind(me),
                iconCls: 'fas fa-expand',
                ui     : 'ghost'
            })
        }

        // Only add the popout window button in case we are using shared workers
        if (Neo.config.useSharedWorkers) {
            items.push({
                handler  : me.popoutPreview.bind(me),
                hidden   : tabContainer.activeIndex !== 1,
                iconCls  : 'far fa-window-maximize',
                reference: 'popout-window-button',
                ui       : 'ghost'
            });

            Neo.currentWorker.on({
                connect   : me.onWindowConnect,
                disconnect: me.onWindowDisconnect,
                scope     : me
            })
        }

        items.unshift('->');

        // we want to add a normal (non-header) button
        tabContainer.getTabBar().add(items);

        tabContainer.getTabBar().update();

        tabContainer.on('activeIndexChange', me.onActiveIndexChange, me);

        // changing the activeView initially will not trigger our onActiveIndexChange() logic
        me.activeView === 'preview' && me.doRunSource()
    }

    /**
     * @param {Object} data
     * @param {String} data.value
     */
    onEditorChange({value}) {
        let me = this;

        me._value = value;

        me.editorValue = value;

        me.fire('editorChange', {value});

        me.doRunSource()
    }

    /**
     * @param {Object} data
     * @param {String} data.appName
     * @param {Number} data.windowId
     */
    async onWindowConnect(data) {
        let me           = this,
            searchString = await Neo.Main.getByPath({path: 'location.search', windowId: data.windowId}),
            params       = new URLSearchParams(searchString),
            id           = params.get('id');

        if (id === me.id) {
            me.connectedWindowId = data.windowId;

            let app              = Neo.apps[data.windowId],
                mainView         = app.mainView,
                previewContainer = me.getReference('preview'),
                {tabContainer}   = me,
                previewView      = previewContainer.removeAt(0, false);

            me.previewContainer = mainView;
            mainView.add(previewView);

            tabContainer.activeIndex = 0; // switch to the source view

            tabContainer.getTabAtIndex(1).disabled = true
        }
    }

    /**
     * @param {Object} data
     * @param {String} data.appName
     * @param {Number} data.windowId
     */
    async onWindowDisconnect(data) {
        let me = this;

        if (data.windowId === me.connectedWindowId) {
            let app              = Neo.apps[data.windowId],
                mainView         = app.mainView,
                previewContainer = me.getReference('preview'),
                {tabContainer}   = me,
                previewView      = mainView.removeAt(0, false);

            me.previewContainer = null;
            previewContainer.add(previewView);

            me.disableRunSource = true; // will get reset after the next activeIndex change (async)
            tabContainer.activeIndex = 1;        // switch to the source view

            me.getReference('popout-window-button').disabled = false;
            tabContainer.getTabAtIndex(1).disabled = false;

            me.connectedWindowId = null
        }
    }

    /**
     * @param {Object} data
     */
    async popoutPreview(data) {
        let me = this;

        data.component.disabled = true;
        await me.createPopupWindow()
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(LivePreview));


/***/ }

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLXNyY19jb2RlX0xpdmVQcmV2aWV3X21qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQWlEO0FBQ2U7QUFDaEI7O0FBRWhEOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsMkRBQVM7QUFDbkM7QUFDQTtBQUNBLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixVQUFVO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGVBQWU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsVUFBVTtBQUM5QjtBQUNBO0FBQ0EsaUNBQWlDLDBEQUFZO0FBQzdDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQiwyRUFBWTtBQUN2Qyw0QkFBNEIsZUFBZTtBQUMzQztBQUNBLDRCQUE0QixrQ0FBa0M7QUFDOUQsNEJBQTRCLGVBQWU7QUFDM0M7QUFDQSxhQUFhO0FBQ2IsMkJBQTJCLDJEQUFTO0FBQ3BDLDRCQUE0QixnQkFBZ0I7QUFDNUM7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNq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QUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLDJCQUEyQixFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9jb2RlL0xpdmVQcmV2aWV3Lm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ29udGFpbmVyICAgIGZyb20gJy4uL2NvbnRhaW5lci9CYXNlLm1qcyc7XG5pbXBvcnQgTW9uYWNvRWRpdG9yIGZyb20gJy4uL2NvbXBvbmVudC93cmFwcGVyL01vbmFjb0VkaXRvci5tanMnXG5pbXBvcnQgVGFiQ29udGFpbmVyIGZyb20gJy4uL3RhYi9Db250YWluZXIubWpzJztcblxuY29uc3QgY29uZmlnU3ltYm9sID0gU3ltYm9sLmZvcignY29uZmlnU3ltYm9sJyk7XG5cbi8qKlxuICogQHN1bW1hcnkgQSBzcGxpdC12aWV3IGNvbXBvbmVudCBmb3IgcmVhbC10aW1lIGNvZGUgZWRpdGluZyBhbmQgZXhlY3V0aW9uLlxuICpcbiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYSByb2J1c3QgZW52aXJvbm1lbnQgZm9yIGVkaXRpbmcgc291cmNlIGNvZGUgYW5kIHZpZXdpbmcgdGhlIHJlc3VsdHMgaW4gcmVhbC10aW1lLlxuICogSXQgaW50ZWdyYXRlcyB0aGUgKipNb25hY28gRWRpdG9yKiogZm9yIGEgcmljaCBlZGl0aW5nIGV4cGVyaWVuY2UgYW5kIHN1cHBvcnRzIG11bHRpcGxlIGxhbmd1YWdlcyBhbmQgZXhlY3V0aW9uIG1vZGVzLlxuICpcbiAqIEtleSBmZWF0dXJlczpcbiAqIC0gKipNdWx0aS1MYW5ndWFnZSBTdXBwb3J0Kio6IFN1cHBvcnRzICduZW9tanMnIChKUyBleGVjdXRpb24pIGFuZCAnbWFya2Rvd24nIChyZW5kZXJpbmcpLlxuICogLSAqKkR5bmFtaWMgSW1wb3J0cyoqOiBVdGlsaXplcyBgaW1wb3J0KClgIHRvIGxhenktbG9hZCB0aGUgTWFya2Rvd24gY29tcG9uZW50IG9yIENvZGUgRXhlY3V0b3IsIG9wdGltaXppbmcgaW5pdGlhbCBsb2FkIHBlcmZvcm1hbmNlLlxuICogLSAqKlNhbmRib3hlZCBFeGVjdXRpb24qKjogRXhlY3V0ZXMgTmVvLm1qcyBjb2RlIHdpdGhpbiBhIGNvbnRyb2xsZWQgY29udGV4dCB1c2luZyBgbmV3IEZ1bmN0aW9uYC5cbiAqIC0gKipSZXNwb25zaXZlIExheW91dCoqOiBjb2xsYXBzaWJsZSwgcG9wLW91dCBzdXBwb3J0LCBhbmQgY29uZmlndXJhYmxlIHZpZXdzIChzb3VyY2UgdnMuIHByZXZpZXcpLlxuICpcbiAqIFRoaXMgY29tcG9uZW50IGlzIGNlbnRyYWwgdG8gdGhlIE5lby5tanMgbGVhcm5pbmcgZXhwZXJpZW5jZSBhbmQgZG9jdW1lbnRhdGlvbiBwb3J0YWwuXG4gKlxuICogQGNsYXNzIE5lby5jb2RlLkxpdmVQcmV2aWV3XG4gKiBAZXh0ZW5kcyBOZW8uY29udGFpbmVyLkJhc2VcbiAqIEBzZWUgTmVvLmNvZGUuZXhlY3V0b3IuTmVvXG4gKiBAc2VlIE5lby5jb21wb25lbnQuTWFya2Rvd25cbiAqIEBzZWUgTmVvLmNvbXBvbmVudC53cmFwcGVyLk1vbmFjb0VkaXRvclxuICovXG5jbGFzcyBMaXZlUHJldmlldyBleHRlbmRzIENvbnRhaW5lciB7XG4gICAgLyoqXG4gICAgICogVmFsaWQgdmFsdWVzIGZvciBhY3RpdmVWaWV3XG4gICAgICogQG1lbWJlciB7U3RyaW5nW119IGFjdGl2ZVZpZXdzPVsncHJldmlldycsJ3NvdXJjZSddXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqIEBzdGF0aWNcbiAgICAgKi9cbiAgICBzdGF0aWMgYWN0aXZlVmlld3MgPSBbJ3ByZXZpZXcnLCAnc291cmNlJ11cbiAgICAvKipcbiAgICAgKiBWYWxpZCB2YWx1ZXMgZm9yIGxhbmd1YWdlXG4gICAgICogQG1lbWJlciB7U3RyaW5nW119IGxhbmd1YWdlcz1bJ21hcmtkb3duJywnbmVvbWpzJ11cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICogQHN0YXRpY1xuICAgICAqL1xuICAgIHN0YXRpYyBsYW5ndWFnZXMgPSBbJ21hcmtkb3duJywgJ25lb21qcyddXG5cbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5jb2RlLkxpdmVQcmV2aWV3J1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8uY29kZS5MaXZlUHJldmlldycsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSdsaXZlLXByZXZpZXcnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG50eXBlOiAnbGl2ZS1wcmV2aWV3JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZhbGlkIHZhbHVlcyBhcmUgJ3ByZXZpZXcnIGFuZCAnc291cmNlJ1xuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGFjdGl2ZVZpZXdfPSdzb3VyY2UnXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgYWN0aXZlVmlld186ICdzb3VyY2UnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nW119IGJhc2VDbHM9WyduZW8tY29kZS1saXZlLXByZXZpZXcnXVxuICAgICAgICAgKi9cbiAgICAgICAgYmFzZUNsczogWyduZW8tY29kZS1saXZlLXByZXZpZXcnXSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IGRpc2FibGVSdW5Tb3VyY2U9ZmFsc2VcbiAgICAgICAgICovXG4gICAgICAgIGRpc2FibGVSdW5Tb3VyY2U6IGZhbHNlLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gZW5hYmxlRnVsbHNjcmVlbj10cnVlXG4gICAgICAgICAqL1xuICAgICAgICBlbmFibGVGdWxsc2NyZWVuOiB0cnVlLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBsYW5ndWFnZV89J25lb21qcydcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBsYW5ndWFnZV86ICduZW9tanMnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fFN0cmluZ30gbGF5b3V0PSdmaXQnXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgbGF5b3V0OiAnZml0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdFtdfSBpdGVtc1xuICAgICAgICAgKi9cbiAgICAgICAgaXRlbXM6IFt7XG4gICAgICAgICAgICBtb2R1bGUgICAgICAgICAgICAgOiBUYWJDb250YWluZXIsXG4gICAgICAgICAgICBjbHMgICAgICAgICAgICAgICAgOiBbJ2xpdmUtcHJldmlldy1jb250YWluZXInXSxcbiAgICAgICAgICAgIHJlZmVyZW5jZSAgICAgICAgICA6ICd0YWItY29udGFpbmVyJyxcbiAgICAgICAgICAgIHJlbW92ZUluYWN0aXZlQ2FyZHM6IGZhbHNlLFxuXG4gICAgICAgICAgICBpdGVtczogW3tcbiAgICAgICAgICAgICAgICBtb2R1bGUgICA6IE1vbmFjb0VkaXRvcixcbiAgICAgICAgICAgICAgICBoZWFkZXIgICA6IHt0ZXh0OiAnU291cmNlJ30sXG4gICAgICAgICAgICAgICAgaGlkZUxhYmVsOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxpc3RlbmVyczoge2VkaXRvckNoYW5nZTogJ3VwLm9uRWRpdG9yQ2hhbmdlJ30sXG4gICAgICAgICAgICAgICAgc3R5bGUgICAgOiB7aGVpZ2h0OiAnMTAwJSd9LFxuICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogJ2VkaXRvcidcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUgICA6IENvbnRhaW5lcixcbiAgICAgICAgICAgICAgICBoZWFkZXIgICA6IHt0ZXh0OiAnUHJldmlldyd9LFxuICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogJ3ByZXZpZXcnXG4gICAgICAgICAgICB9XVxuICAgICAgICB9XSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjb2RlIHRvIGRpc3BsYXkgaW5zaWRlIHRoZSBNb25hY28gZWRpdG9yXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSB2YWx1ZV89bnVsbFxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIHZhbHVlXzogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB1cmwgZm9yIHRoZSBjaGlsZCBhcHAgdG8gdXNlIGZvciB0aGUgcG9wb3V0IHdpbmRvd1xuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IHdpbmRvd1VybF89Jy4vY2hpbGRhcHBzL3ByZXZpZXcvaW5kZXguaHRtbCdcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICB3aW5kb3dVcmxfOiAnLi9jaGlsZGFwcHMvcHJldmlldy9pbmRleC5odG1sJ1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZW1iZXIge051bWJlcnxudWxsfSBjb25uZWN0ZWRXaW5kb3dJZD1udWxsXG4gICAgICovXG4gICAgY29ubmVjdGVkV2luZG93SWQgPSBudWxsXG4gICAgLyoqXG4gICAgICogQG1lbWJlciB7TmVvLmNvbXBvbmVudC5NYXJrZG93bnxudWxsfSBtYXJrZG93bkNvbXBvbmVudD1udWxsXG4gICAgICovXG4gICAgbWFya2Rvd25Db21wb25lbnQgPSBudWxsXG4gICAgLyoqXG4gICAgICogQG1lbWJlciB7Q2xhc3N8bnVsbH0gbWFya2Rvd25Db21wb25lbnRDbGFzcz1udWxsXG4gICAgICovXG4gICAgbWFya2Rvd25Db21wb25lbnRDbGFzcyA9IG51bGxcbiAgICAvKipcbiAgICAgKiBAbWVtYmVyIHtOZW8uY29kZS5leGVjdXRvci5OZW98bnVsbH0gbmVvRXhlY3V0b3I9bnVsbFxuICAgICAqL1xuICAgIG5lb0V4ZWN1dG9yID0gbnVsbFxuICAgIC8qKlxuICAgICAqIExpbmsgdGhlIHByZXZpZXcgb3V0cHV0IHRvIGRpZmZlcmVudCB0YXJnZXRzXG4gICAgICogQG1lbWJlciB7TmVvLmNvbXBvbmVudC5CYXNlfSBwcmV2aWV3Q29udGFpbmVyPW51bGxcbiAgICAgKi9cbiAgICBwcmV2aWV3Q29udGFpbmVyID0gbnVsbFxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge05lby5jb21wb25lbnQuQmFzZXxudWxsfVxuICAgICAqL1xuICAgIGdldCB0YWJDb250YWluZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEl0ZW0oJ3RhYi1jb250YWluZXInKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgYWN0aXZlVmlldyBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRBY3RpdmVWaWV3KHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB0aGlzLnRhYkNvbnRhaW5lci5hY3RpdmVJbmRleCA9IHZhbHVlID09PSAnc291cmNlJyA/IDAgOiAxXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBsYW5ndWFnZSBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRMYW5ndWFnZSh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBpZiAodmFsdWUgIT09ICdtYXJrZG93bicpIHtcbiAgICAgICAgICAgIG1lLm1hcmtkb3duQ29tcG9uZW50ID0gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgbWUuZ2V0SXRlbSgnZWRpdG9yJykubGFuZ3VhZ2UgPSB2YWx1ZSA9PT0gJ25lb21qcycgPyAnamF2YXNjcmlwdCcgOiB2YWx1ZTtcblxuICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIG5ldyBwZW5kaW5nIHZhbHVlIGZvciB0aGUgdmFsdWUgY29uZmlnLCBpdCB3aWxsIHJ1biB0cmlnZ2VyIGRvUnVuU291cmNlKCkuXG4gICAgICAgIC8vIFRoaXMgY2FuIGhhcHBlbiB3aGVuIGNhbGxpbmc6IHRoaXMuc2V0KHtsYW5ndWFnZSwgdmFsdWV9KVxuICAgICAgICBpZiAob2xkVmFsdWUgJiYgIU9iamVjdC5oYXNPd24obWVbY29uZmlnU3ltYm9sXSwgJ3ZhbHVlJykpIHtcbiAgICAgICAgICAgIG1lLmRvUnVuU291cmNlKClcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSB2YWx1ZSBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0VmFsdWUodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5nZXRJdGVtKCdlZGl0b3InKS52YWx1ZSA9IHZhbHVlPy50cmltKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBiZWZvcmUgdGhlIGFjdGl2ZVZpZXcgY29uZmlnIGdldHMgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9XG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldEFjdGl2ZVZpZXcodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVNldEVudW1WYWx1ZSh2YWx1ZSwgb2xkVmFsdWUsICdhY3RpdmVWaWV3JylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYmVmb3JlIHRoZSBsYW5ndWFnZSBjb25maWcgZ2V0cyBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG9sZFZhbHVlXG4gICAgICogQHJldHVybnMge1N0cmluZ31cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYmVmb3JlU2V0TGFuZ3VhZ2UodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVNldEVudW1WYWx1ZSh2YWx1ZSwgb2xkVmFsdWUsICdsYW5ndWFnZScpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGJlZm9yZSB0aGUgbGFuZ3VhZ2UgY29uZmlnIGdldHMgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9XG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldFdpbmRvd1VybCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJy4vJykpIHtcbiAgICAgICAgICAgIGxldCBhcHBQYXRoID0gTmVvLmNvbmZpZy5hcHBQYXRoLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICBhcHBQYXRoLnBvcCgpXG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgVVJMKE5lby5jb25maWcuYmFzZVBhdGggKyBhcHBQYXRoLmpvaW4oJy8nKSArIHZhbHVlLnN1YnN0cmluZygxKSwgbG9jYXRpb24uaHJlZikuaHJlZlxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBhc3luYyBjb2xsYXBzZUV4cGFuZChkYXRhKSB7XG4gICAgICAgIGxldCBtZSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBidXR0b24gICA9IGRhdGEuY29tcG9uZW50LFxuICAgICAgICAgICAgY29sbGFwc2UgPSBidXR0b24uaWNvbkNscyA9PT0gJ2ZhcyBmYS1jb21wcmVzcycsXG4gICAgICAgICAgICB7dmRvbX0gICA9IG1lLFxuICAgICAgICAgICAgcmVjdDtcblxuICAgICAgICBpZiAoY29sbGFwc2UpIHtcbiAgICAgICAgICAgIGJ1dHRvbi5pY29uQ2xzID0gJ2ZhcyBmYS1leHBhbmQnO1xuXG4gICAgICAgICAgICByZWN0ID0gbWUuY29sbGFwc2VSZWN0O1xuXG4gICAgICAgICAgICBkZWxldGUgbWUuY29sbGFwc2VSZWN0O1xuXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHZkb20uc3R5bGUsIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgIDogcmVjdC5oZWlnaHQgKyAncHgnLFxuICAgICAgICAgICAgICAgIGxlZnQgICAgOiByZWN0LnggICAgICArICdweCcsXG4gICAgICAgICAgICAgICAgdG9wICAgICA6IHJlY3QueSAgICAgICsgJ3B4JyxcbiAgICAgICAgICAgICAgICB3aWR0aCAgIDogcmVjdC53aWR0aCAgKyAncHgnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbWUudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIGF3YWl0IG1lLnRpbWVvdXQoMzAwKTtcblxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih2ZG9tLnN0eWxlLCB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IG51bGwsXG4gICAgICAgICAgICAgICAgekluZGV4ICA6IG51bGxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBidXR0b24uaWNvbkNscyA9ICdmYXMgZmEtY29tcHJlc3MnO1xuXG4gICAgICAgICAgICByZWN0ID0gYXdhaXQgbWUuZ2V0RG9tUmVjdCgpO1xuXG4gICAgICAgICAgICBtZS5jb2xsYXBzZVJlY3QgPSByZWN0O1xuXG4gICAgICAgICAgICB2ZG9tLnN0eWxlID0gdmRvbS5zdHlsZSB8fCB7fTtcblxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih2ZG9tLnN0eWxlLCB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ICA6IHJlY3QuaGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAgICAgICBsZWZ0ICAgIDogcmVjdC54ICAgICAgKyAncHgnLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgIHRvcCAgICAgOiByZWN0LnkgICAgICArICdweCcsXG4gICAgICAgICAgICAgICAgd2lkdGggICA6IHJlY3Qud2lkdGggICsgJ3B4JyxcbiAgICAgICAgICAgICAgICB6SW5kZXggIDogMTAzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbWUudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIGF3YWl0IG1lLnRpbWVvdXQoNTApO1xuXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHZkb20uc3R5bGUsIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICBsZWZ0ICA6IDAsXG4gICAgICAgICAgICAgICAgdG9wICAgOiAwLFxuICAgICAgICAgICAgICAgIHdpZHRoIDogJzEwMCUnXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgbWUudXBkYXRlKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZVBvcHVwV2luZG93KCkge1xuICAgICAgICBsZXQgbWUgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7d2luZG93SWR9ID0gbWUsXG4gICAgICAgICAgICB3aW5EYXRhICAgID0gYXdhaXQgTmVvLk1haW4uZ2V0V2luZG93RGF0YSh7d2luZG93SWR9KSxcbiAgICAgICAgICAgIHJlY3QgICAgICAgPSBhd2FpdCBtZS5nZXREb21SZWN0KG1lLmdldFJlZmVyZW5jZSgncHJldmlldycpLmlkKTtcblxuICAgICAgICBsZXQge2hlaWdodCwgbGVmdCwgdG9wLCB3aWR0aH0gPSByZWN0O1xuXG4gICAgICAgIGxlZnQgKz0gd2luRGF0YS5zY3JlZW5MZWZ0O1xuICAgICAgICB0b3AgICs9ICh3aW5EYXRhLm91dGVySGVpZ2h0IC0gd2luRGF0YS5pbm5lckhlaWdodCArIHdpbkRhdGEuc2NyZWVuVG9wKTtcblxuICAgICAgICBOZW8uTWFpbi53aW5kb3dPcGVuKHtcbiAgICAgICAgICAgIHVybCAgICAgICAgICAgOiBgJHttZS53aW5kb3dVcmx9P2lkPSR7bWUuaWR9YCxcbiAgICAgICAgICAgIHdpbmRvd0ZlYXR1cmVzOiBgaGVpZ2h0PSR7aGVpZ2h0fSxsZWZ0PSR7bGVmdH0sdG9wPSR7dG9wfSx3aWR0aD0ke3dpZHRofWAsXG4gICAgICAgICAgICB3aW5kb3dJZCxcbiAgICAgICAgICAgIHdpbmRvd05hbWUgICAgOiBtZS5pZFxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Li4uKn0gYXJnc1xuICAgICAqL1xuICAgIGRlc3Ryb3koLi4uYXJncykge1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRXaW5kb3dJZCkge1xuICAgICAgICAgICAgTmVvLk1haW4ud2luZG93Q2xvc2Uoe25hbWVzOiBbdGhpcy5pZF0sIHdpbmRvd0lkOiB0aGlzLndpbmRvd0lkfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHN1cGVyLmRlc3Ryb3koLi4uYXJncylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlcyB0aGUgY3VycmVudCBzb3VyY2UgY29kZS5cbiAgICAgKlxuICAgICAqIFRoaXMgbWV0aG9kIGFjdHMgYXMgdGhlICoqZXhlY3V0aW9uIHRyaWdnZXIqKi4gSXQgb3JjaGVzdHJhdGVzIHRoZSBwcm9jZXNzIGJ5OlxuICAgICAqIDEuICAqKlZhbGlkYXRpb24qKjogRW5zdXJpbmcgc291cmNlIGNvZGUgZXhpc3RzLlxuICAgICAqIDIuICAqKkV4ZWN1dGlvbioqOlxuICAgICAqICAgICAtIEZvciAqKk1hcmtkb3duKio6IENsZWFycyB0aGUgY29udGFpbmVyIGFuZCBhZGRzIGEgbmV3IGBOZW8uY29tcG9uZW50Lk1hcmtkb3duYCBpbnN0YW5jZS5cbiAgICAgKiAgICAgLSBGb3IgKipOZW8ubWpzKio6IERlbGVnYXRlcyBleGVjdXRpb24gdG8gdGhlIGBOZW8uY29kZS5leGVjdXRvci5OZW9gIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XG4gICAgICovXG4gICAgYXN5bmMgZG9SdW5Tb3VyY2UoKSB7XG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVSdW5Tb3VyY2UpIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG1lICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBjb250YWluZXIgPSBtZS5nZXRQcmV2aWV3Q29udGFpbmVyKCksXG4gICAgICAgICAgICBzb3VyY2UgICAgPSBtZS5lZGl0b3JWYWx1ZSB8fCBtZS52YWx1ZTsgLy8gVXNlIGN1cnJlbnQgZWRpdG9yIHZhbHVlIG9yIGluaXRpYWwgdmFsdWVcblxuICAgICAgICBpZiAoIXNvdXJjZSkgcmV0dXJuO1xuXG4gICAgICAgIGlmIChtZS5sYW5ndWFnZSA9PT0gJ21hcmtkb3duJykge1xuICAgICAgICAgICAgaWYgKCFtZS5tYXJrZG93bkNvbXBvbmVudENsYXNzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kdWxlID0gYXdhaXQgaW1wb3J0KCcuLi9jb21wb25lbnQvTWFya2Rvd24ubWpzJyk7XG4gICAgICAgICAgICAgICAgbWUubWFya2Rvd25Db21wb25lbnRDbGFzcyA9IG1vZHVsZS5kZWZhdWx0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWUubWFya2Rvd25Db21wb25lbnQgJiYgIW1lLm1hcmtkb3duQ29tcG9uZW50LmlzRGVzdHJveWVkKSB7XG4gICAgICAgICAgICAgICAgbWUubWFya2Rvd25Db21wb25lbnQudmFsdWUgPSBzb3VyY2VcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gZGVzdHJveSwgc2lsZW50ID0+IG1lcmdlIGNoYW5nZXMgaW50byBvbmUgdXBkYXRlIGN5Y2xlXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZUFsbCh0cnVlLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgIG1lLm1hcmtkb3duQ29tcG9uZW50ID0gY29udGFpbmVyLmFkZCh7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZSAgIDogbWUubWFya2Rvd25Db21wb25lbnRDbGFzcyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGUgICAgOiB7aGVpZ2h0OiAnMTAwJScsIG92ZXJmbG93OiAnYXV0byd9LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSAgICA6IHNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgd2luZG93VXJsOiBtZS53aW5kb3dVcmxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFtZS5uZW9FeGVjdXRvcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vZHVsZSA9IGF3YWl0IGltcG9ydCgnLi9leGVjdXRvci9OZW8ubWpzJyk7XG4gICAgICAgICAgICAgICAgbWUubmVvRXhlY3V0b3IgPSBOZW8uY3JlYXRlKG1vZHVsZS5kZWZhdWx0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXdhaXQgbWUubmVvRXhlY3V0b3IuZXhlY3V0ZSh7Y29kZTogc291cmNlLCBjb250YWluZXJ9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge05lby5jb21wb25lbnQuQmFzZXxudWxsfVxuICAgICAqL1xuICAgIGdldFByZXZpZXdDb250YWluZXIoKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKG1lLnByZXZpZXdDb250YWluZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBtZS5wcmV2aWV3Q29udGFpbmVyXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbWUuZ2V0UmVmZXJlbmNlKCdwcmV2aWV3JylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwYXJhbSB7TmVvLmNvbXBvbmVudC5CYXNlfSBkYXRhLml0ZW1cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZGF0YS5vbGRWYWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLnNvdXJjZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkYXRhLnZhbHVlXG4gICAgICovXG4gICAgb25BY3RpdmVJbmRleENoYW5nZShkYXRhKSB7XG4gICAgICAgIGxldCBtZSAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgaXNQcmV2aWV3ID0gZGF0YS52YWx1ZSA9PT0gMTtcblxuICAgICAgICBpZiAoZGF0YS5pdGVtLnJlZmVyZW5jZSA9PT0gJ3ByZXZpZXcnKSB7XG4gICAgICAgICAgICBtZS5kb1J1blNvdXJjZSgpXG4gICAgICAgIH1cbiAgICAgICAgLy8gTmF2aWdhdGluZyB0byB0aGUgc291cmNlIHZpZXcgc2hvdWxkIGRlc3Ryb3kgdGhlIGFwcCwgaW4gY2FzZSB0aGUgcHJldmlldyB2aWV3IGlzIG5vdCBwb3BwZWQgb3V0XG4gICAgICAgIGVsc2UgaWYgKCFpc1ByZXZpZXcgJiYgIW1lLnByZXZpZXdDb250YWluZXIpIHtcbiAgICAgICAgICAgIG1lLmdldFJlZmVyZW5jZSgncHJldmlldycpLnJlbW92ZUFsbCgpXG4gICAgICAgIH1cblxuICAgICAgICBtZS5nZXRSZWZlcmVuY2UoJ3BvcG91dC13aW5kb3ctYnV0dG9uJykuaGlkZGVuID0gIWlzUHJldmlld1xuICAgICAgICBtZS5kaXNhYmxlUnVuU291cmNlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBvbkNvbnN0cnVjdGVkKCkge1xuICAgICAgICBzdXBlci5vbkNvbnN0cnVjdGVkKCk7XG5cbiAgICAgICAgbGV0IG1lICAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGl0ZW1zICAgICAgICAgID0gW10sXG4gICAgICAgICAgICB7dGFiQ29udGFpbmVyfSA9IG1lO1xuXG4gICAgICAgIG1lLmVkaXRvclxuXG4gICAgICAgIGlmIChtZS5lbmFibGVGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiBtZS5jb2xsYXBzZUV4cGFuZC5iaW5kKG1lKSxcbiAgICAgICAgICAgICAgICBpY29uQ2xzOiAnZmFzIGZhLWV4cGFuZCcsXG4gICAgICAgICAgICAgICAgdWkgICAgIDogJ2dob3N0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE9ubHkgYWRkIHRoZSBwb3BvdXQgd2luZG93IGJ1dHRvbiBpbiBjYXNlIHdlIGFyZSB1c2luZyBzaGFyZWQgd29ya2Vyc1xuICAgICAgICBpZiAoTmVvLmNvbmZpZy51c2VTaGFyZWRXb3JrZXJzKSB7XG4gICAgICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyICA6IG1lLnBvcG91dFByZXZpZXcuYmluZChtZSksXG4gICAgICAgICAgICAgICAgaGlkZGVuICAgOiB0YWJDb250YWluZXIuYWN0aXZlSW5kZXggIT09IDEsXG4gICAgICAgICAgICAgICAgaWNvbkNscyAgOiAnZmFyIGZhLXdpbmRvdy1tYXhpbWl6ZScsXG4gICAgICAgICAgICAgICAgcmVmZXJlbmNlOiAncG9wb3V0LXdpbmRvdy1idXR0b24nLFxuICAgICAgICAgICAgICAgIHVpICAgICAgIDogJ2dob3N0J1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIE5lby5jdXJyZW50V29ya2VyLm9uKHtcbiAgICAgICAgICAgICAgICBjb25uZWN0ICAgOiBtZS5vbldpbmRvd0Nvbm5lY3QsXG4gICAgICAgICAgICAgICAgZGlzY29ubmVjdDogbWUub25XaW5kb3dEaXNjb25uZWN0LFxuICAgICAgICAgICAgICAgIHNjb3BlICAgICA6IG1lXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgaXRlbXMudW5zaGlmdCgnLT4nKTtcblxuICAgICAgICAvLyB3ZSB3YW50IHRvIGFkZCBhIG5vcm1hbCAobm9uLWhlYWRlcikgYnV0dG9uXG4gICAgICAgIHRhYkNvbnRhaW5lci5nZXRUYWJCYXIoKS5hZGQoaXRlbXMpO1xuXG4gICAgICAgIHRhYkNvbnRhaW5lci5nZXRUYWJCYXIoKS51cGRhdGUoKTtcblxuICAgICAgICB0YWJDb250YWluZXIub24oJ2FjdGl2ZUluZGV4Q2hhbmdlJywgbWUub25BY3RpdmVJbmRleENoYW5nZSwgbWUpO1xuXG4gICAgICAgIC8vIGNoYW5naW5nIHRoZSBhY3RpdmVWaWV3IGluaXRpYWxseSB3aWxsIG5vdCB0cmlnZ2VyIG91ciBvbkFjdGl2ZUluZGV4Q2hhbmdlKCkgbG9naWNcbiAgICAgICAgbWUuYWN0aXZlVmlldyA9PT0gJ3ByZXZpZXcnICYmIG1lLmRvUnVuU291cmNlKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLnZhbHVlXG4gICAgICovXG4gICAgb25FZGl0b3JDaGFuZ2Uoe3ZhbHVlfSkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIG1lLl92YWx1ZSA9IHZhbHVlO1xuXG4gICAgICAgIG1lLmVkaXRvclZhbHVlID0gdmFsdWU7XG5cbiAgICAgICAgbWUuZmlyZSgnZWRpdG9yQ2hhbmdlJywge3ZhbHVlfSk7XG5cbiAgICAgICAgbWUuZG9SdW5Tb3VyY2UoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEuYXBwTmFtZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkYXRhLndpbmRvd0lkXG4gICAgICovXG4gICAgYXN5bmMgb25XaW5kb3dDb25uZWN0KGRhdGEpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBzZWFyY2hTdHJpbmcgPSBhd2FpdCBOZW8uTWFpbi5nZXRCeVBhdGgoe3BhdGg6ICdsb2NhdGlvbi5zZWFyY2gnLCB3aW5kb3dJZDogZGF0YS53aW5kb3dJZH0pLFxuICAgICAgICAgICAgcGFyYW1zICAgICAgID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhzZWFyY2hTdHJpbmcpLFxuICAgICAgICAgICAgaWQgICAgICAgICAgID0gcGFyYW1zLmdldCgnaWQnKTtcblxuICAgICAgICBpZiAoaWQgPT09IG1lLmlkKSB7XG4gICAgICAgICAgICBtZS5jb25uZWN0ZWRXaW5kb3dJZCA9IGRhdGEud2luZG93SWQ7XG5cbiAgICAgICAgICAgIGxldCBhcHAgICAgICAgICAgICAgID0gTmVvLmFwcHNbZGF0YS53aW5kb3dJZF0sXG4gICAgICAgICAgICAgICAgbWFpblZpZXcgICAgICAgICA9IGFwcC5tYWluVmlldyxcbiAgICAgICAgICAgICAgICBwcmV2aWV3Q29udGFpbmVyID0gbWUuZ2V0UmVmZXJlbmNlKCdwcmV2aWV3JyksXG4gICAgICAgICAgICAgICAge3RhYkNvbnRhaW5lcn0gICA9IG1lLFxuICAgICAgICAgICAgICAgIHByZXZpZXdWaWV3ICAgICAgPSBwcmV2aWV3Q29udGFpbmVyLnJlbW92ZUF0KDAsIGZhbHNlKTtcblxuICAgICAgICAgICAgbWUucHJldmlld0NvbnRhaW5lciA9IG1haW5WaWV3O1xuICAgICAgICAgICAgbWFpblZpZXcuYWRkKHByZXZpZXdWaWV3KTtcblxuICAgICAgICAgICAgdGFiQ29udGFpbmVyLmFjdGl2ZUluZGV4ID0gMDsgLy8gc3dpdGNoIHRvIHRoZSBzb3VyY2Ugdmlld1xuXG4gICAgICAgICAgICB0YWJDb250YWluZXIuZ2V0VGFiQXRJbmRleCgxKS5kaXNhYmxlZCA9IHRydWVcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEuYXBwTmFtZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkYXRhLndpbmRvd0lkXG4gICAgICovXG4gICAgYXN5bmMgb25XaW5kb3dEaXNjb25uZWN0KGRhdGEpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBpZiAoZGF0YS53aW5kb3dJZCA9PT0gbWUuY29ubmVjdGVkV2luZG93SWQpIHtcbiAgICAgICAgICAgIGxldCBhcHAgICAgICAgICAgICAgID0gTmVvLmFwcHNbZGF0YS53aW5kb3dJZF0sXG4gICAgICAgICAgICAgICAgbWFpblZpZXcgICAgICAgICA9IGFwcC5tYWluVmlldyxcbiAgICAgICAgICAgICAgICBwcmV2aWV3Q29udGFpbmVyID0gbWUuZ2V0UmVmZXJlbmNlKCdwcmV2aWV3JyksXG4gICAgICAgICAgICAgICAge3RhYkNvbnRhaW5lcn0gICA9IG1lLFxuICAgICAgICAgICAgICAgIHByZXZpZXdWaWV3ICAgICAgPSBtYWluVmlldy5yZW1vdmVBdCgwLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIG1lLnByZXZpZXdDb250YWluZXIgPSBudWxsO1xuICAgICAgICAgICAgcHJldmlld0NvbnRhaW5lci5hZGQocHJldmlld1ZpZXcpO1xuXG4gICAgICAgICAgICBtZS5kaXNhYmxlUnVuU291cmNlID0gdHJ1ZTsgLy8gd2lsbCBnZXQgcmVzZXQgYWZ0ZXIgdGhlIG5leHQgYWN0aXZlSW5kZXggY2hhbmdlIChhc3luYylcbiAgICAgICAgICAgIHRhYkNvbnRhaW5lci5hY3RpdmVJbmRleCA9IDE7ICAgICAgICAvLyBzd2l0Y2ggdG8gdGhlIHNvdXJjZSB2aWV3XG5cbiAgICAgICAgICAgIG1lLmdldFJlZmVyZW5jZSgncG9wb3V0LXdpbmRvdy1idXR0b24nKS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGFiQ29udGFpbmVyLmdldFRhYkF0SW5kZXgoMSkuZGlzYWJsZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgbWUuY29ubmVjdGVkV2luZG93SWQgPSBudWxsXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqL1xuICAgIGFzeW5jIHBvcG91dFByZXZpZXcoZGF0YSkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGRhdGEuY29tcG9uZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgYXdhaXQgbWUuY3JlYXRlUG9wdXBXaW5kb3coKVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoTGl2ZVByZXZpZXcpO1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==