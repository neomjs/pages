export const __webpack_esm_id__ = "src_remotes_Api_mjs";
export const __webpack_esm_ids__ = ["src_remotes_Api_mjs"];
export const __webpack_esm_modules__ = {

/***/ "./src/remotes/Api.mjs"
/*!*****************************!*\
  !*** ./src/remotes/Api.mjs ***!
  \*****************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/Base.mjs */ "./src/core/Base.mjs");


/**
 * @class Neo.remotes.Api
 * @extends Neo.core.Base
 * @singleton
 */
class Api extends _core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.remotes.Api'
         * @protected
         */
        className: 'Neo.remotes.Api',
        /**
         * @member {Boolean} singleton=true
         * @protected
         */
        singleton: true
    }

    /**
     * @param {String} service
     * @param {String} method
     * @returns {function(*=, *=): Promise<any>}
     */
    generateRemote(service, method) {
        return function(...args) {
            return Neo.currentWorker.promiseMessage('data', {
                action: 'rpc',
                method,
                params: [...args],
                service
            })
        }
    }

    /**
     *
     */
    load() {
        let {config}    = Neo,
            useMjsFiles = config.environment === 'development' || config.environment === 'dist/esm',
            path        = config.remotesApiUrl;

        // Relative paths need a special treatment
        if (!path.includes('http')) {
            path = config.appPath.split('/');
            path.pop();
            path = `${path.join('/')}/${config.remotesApiUrl}`;
            path = (useMjsFiles ? '../../' : './') + path
        }

        fetch(path)
            .then(response => response.json())
            .then(data => {
                Neo.currentWorker.sendMessage('data', {action: 'registerApi', data});
                this.register(data)
            })
    }

    /**
     * @param {Object} api
     */
    register(api) {
        let ns;

        Object.entries(api.services).forEach(([service, serviceValue]) => {
            ns = Neo.ns(`${api.namespace}.${service}`, true);

            Object.entries(serviceValue.methods).forEach(([method, methodValue]) => {
                ns[method] = this.generateRemote(service, method)
            })
        })
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Api));


/***/ }

};

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC9zcmNfcmVtb3Rlc19BcGlfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFvQzs7QUFFcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixzREFBSTtBQUN0QjtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsV0FBVztBQUN4QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGVBQWUsR0FBRyxxQkFBcUI7QUFDN0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsNEJBQTRCO0FBQ25GO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixjQUFjLEdBQUcsUUFBUTs7QUFFcEQ7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTs7QUFFQSxpRUFBZSxtQkFBbUIsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lby5tanMvLi9zcmMvcmVtb3Rlcy9BcGkubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlIGZyb20gJy4uL2NvcmUvQmFzZS5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8ucmVtb3Rlcy5BcGlcbiAqIEBleHRlbmRzIE5lby5jb3JlLkJhc2VcbiAqIEBzaW5nbGV0b25cbiAqL1xuY2xhc3MgQXBpIGV4dGVuZHMgQmFzZSB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8ucmVtb3Rlcy5BcGknXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5yZW1vdGVzLkFwaScsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBzaW5nbGV0b249dHJ1ZVxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBzaW5nbGV0b246IHRydWVcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2RcbiAgICAgKiBAcmV0dXJucyB7ZnVuY3Rpb24oKj0sICo9KTogUHJvbWlzZTxhbnk+fVxuICAgICAqL1xuICAgIGdlbmVyYXRlUmVtb3RlKHNlcnZpY2UsIG1ldGhvZCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgICAgICAgcmV0dXJuIE5lby5jdXJyZW50V29ya2VyLnByb21pc2VNZXNzYWdlKCdkYXRhJywge1xuICAgICAgICAgICAgICAgIGFjdGlvbjogJ3JwYycsXG4gICAgICAgICAgICAgICAgbWV0aG9kLFxuICAgICAgICAgICAgICAgIHBhcmFtczogWy4uLmFyZ3NdLFxuICAgICAgICAgICAgICAgIHNlcnZpY2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGxvYWQoKSB7XG4gICAgICAgIGxldCB7Y29uZmlnfSAgICA9IE5lbyxcbiAgICAgICAgICAgIHVzZU1qc0ZpbGVzID0gY29uZmlnLmVudmlyb25tZW50ID09PSAnZGV2ZWxvcG1lbnQnIHx8IGNvbmZpZy5lbnZpcm9ubWVudCA9PT0gJ2Rpc3QvZXNtJyxcbiAgICAgICAgICAgIHBhdGggICAgICAgID0gY29uZmlnLnJlbW90ZXNBcGlVcmw7XG5cbiAgICAgICAgLy8gUmVsYXRpdmUgcGF0aHMgbmVlZCBhIHNwZWNpYWwgdHJlYXRtZW50XG4gICAgICAgIGlmICghcGF0aC5pbmNsdWRlcygnaHR0cCcpKSB7XG4gICAgICAgICAgICBwYXRoID0gY29uZmlnLmFwcFBhdGguc3BsaXQoJy8nKTtcbiAgICAgICAgICAgIHBhdGgucG9wKCk7XG4gICAgICAgICAgICBwYXRoID0gYCR7cGF0aC5qb2luKCcvJyl9LyR7Y29uZmlnLnJlbW90ZXNBcGlVcmx9YDtcbiAgICAgICAgICAgIHBhdGggPSAodXNlTWpzRmlsZXMgPyAnLi4vLi4vJyA6ICcuLycpICsgcGF0aFxuICAgICAgICB9XG5cbiAgICAgICAgZmV0Y2gocGF0aClcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAgICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIE5lby5jdXJyZW50V29ya2VyLnNlbmRNZXNzYWdlKCdkYXRhJywge2FjdGlvbjogJ3JlZ2lzdGVyQXBpJywgZGF0YX0pO1xuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXIoZGF0YSlcbiAgICAgICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGFwaVxuICAgICAqL1xuICAgIHJlZ2lzdGVyKGFwaSkge1xuICAgICAgICBsZXQgbnM7XG5cbiAgICAgICAgT2JqZWN0LmVudHJpZXMoYXBpLnNlcnZpY2VzKS5mb3JFYWNoKChbc2VydmljZSwgc2VydmljZVZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgbnMgPSBOZW8ubnMoYCR7YXBpLm5hbWVzcGFjZX0uJHtzZXJ2aWNlfWAsIHRydWUpO1xuXG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyhzZXJ2aWNlVmFsdWUubWV0aG9kcykuZm9yRWFjaCgoW21ldGhvZCwgbWV0aG9kVmFsdWVdKSA9PiB7XG4gICAgICAgICAgICAgICAgbnNbbWV0aG9kXSA9IHRoaXMuZ2VuZXJhdGVSZW1vdGUoc2VydmljZSwgbWV0aG9kKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKEFwaSk7XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9