"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-examples_functional_hostComponent_app_mjs"],{

/***/ "./examples/functional/hostComponent/Component.mjs":
/*!*********************************************************!*\
  !*** ./examples/functional/hostComponent/Component.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_functional_export_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/functional/_export.mjs */ "./src/functional/_export.mjs");
/* harmony import */ var _src_button_Base_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../src/button/Base.mjs */ "./src/button/Base.mjs");



/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_src_functional_export_mjs__WEBPACK_IMPORTED_MODULE_0__.defineComponent)({
    config: {
        className: 'Neo.examples.functional.hostComponent.Component'
    },
    createVdom() {
        const [count, setCount] = (0,_src_functional_export_mjs__WEBPACK_IMPORTED_MODULE_0__.useConfig)(0);

        const style = {
            display       : 'flex',
            flexDirection : 'column',
            alignItems    : 'center',
            justifyContent: 'center',
            fontSize      : '20px'
        };

        return {style, cn: [
            {
                tag : 'p',
                text: `Button clicked ${count} times`
            }, {
                module : _src_button_Base_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                id     : 'myButtonModule',
                theme  : 'neo-theme-neo-light',
                text   : 'Click Me (Neo Button)',
                handler: () => setCount(prev => prev + 1)
            }
        ]}
    }
}));


/***/ }),

/***/ "./examples/functional/hostComponent/MainContainer.mjs":
/*!*************************************************************!*\
  !*** ./examples/functional/hostComponent/MainContainer.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _ConfigurationViewport_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ConfigurationViewport.mjs */ "./examples/ConfigurationViewport.mjs");
/* harmony import */ var _Component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Component.mjs */ "./examples/functional/hostComponent/Component.mjs");
/* harmony import */ var _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../src/form/field/Text.mjs */ "./src/form/field/Text.mjs");




/**
 * @class Neo.examples.functional.hostComponent.MainContainer
 * @extends Neo.examples.ConfigurationViewport
 */
class MainContainer extends _ConfigurationViewport_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        className           : 'Neo.examples.functional.hostComponent.MainContainer',
        configItemLabelWidth: 120,
        configItemWidth     : 300,
        layout              : {ntype: 'hbox', align: 'stretch'}
    }

    async createConfigurationComponents() {
        // Wait one micro task queue tick, to ensure the fn render Effect is done
        await Promise.resolve();

        const button = Neo.getComponent('myButtonModule');

        return [{
            module    : _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
            clearable : true,
            labelText : 'Button Text',
            style     : {marginTop: '10px'},
            value     : button.text,

            listeners : {
                change({value}) {
                    button.text = value
                }
            }
        }]
    }

    /**
     * @returns {Neo.functional.Component}
     */
    createExampleComponent() {
        return {
            module: _Component_mjs__WEBPACK_IMPORTED_MODULE_1__["default"]
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(MainContainer));


/***/ }),

/***/ "./examples/functional/hostComponent/app.mjs":
/*!***************************************************!*\
  !*** ./examples/functional/hostComponent/app.mjs ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   onStart: () => (/* binding */ onStart)
/* harmony export */ });
/* harmony import */ var _MainContainer_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./MainContainer.mjs */ "./examples/functional/hostComponent/MainContainer.mjs");


const onStart = () => Neo.app({
    mainView: _MainContainer_mjs__WEBPACK_IMPORTED_MODULE_0__["default"],
    name    : 'Neo.examples.functional.hostComponent'
});


/***/ }),

/***/ "./src/functional/_export.mjs":
/*!************************************!*\
  !*** ./src/functional/_export.mjs ***!
  \************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Component: () => (/* reexport safe */ _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]),
/* harmony export */   defineComponent: () => (/* reexport safe */ _defineComponent_mjs__WEBPACK_IMPORTED_MODULE_1__["default"]),
/* harmony export */   useConfig: () => (/* reexport safe */ _useConfig_mjs__WEBPACK_IMPORTED_MODULE_2__["default"]),
/* harmony export */   useEvent: () => (/* reexport safe */ _useEvent_mjs__WEBPACK_IMPORTED_MODULE_3__["default"])
/* harmony export */ });
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./component/Base.mjs */ "./src/functional/component/Base.mjs");
/* harmony import */ var _defineComponent_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./defineComponent.mjs */ "./src/functional/defineComponent.mjs");
/* harmony import */ var _useConfig_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useConfig.mjs */ "./src/functional/useConfig.mjs");
/* harmony import */ var _useEvent_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useEvent.mjs */ "./src/functional/useEvent.mjs");








/***/ }),

/***/ "./src/functional/defineComponent.mjs":
/*!********************************************!*\
  !*** ./src/functional/defineComponent.mjs ***!
  \********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   defineComponent: () => (/* binding */ defineComponent)
/* harmony export */ });
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./component/Base.mjs */ "./src/functional/component/Base.mjs");


/**
 * Factory function to create a functional component class from a specification object.
 * This enables a "Beginner Mode" for creating components without writing a class,
 * while still providing access to the full class-based feature set.
 *
 * It's important to understand the two ways of managing state:
 *
 * 1.  **Named Configs (Public API):** Defined in the `config` object (e.g., `text_`).
 *     - **Purpose:** Defines the component's public API for external control, similar to props.
 *     - **Use Case:** For data that a parent component will set or change.
 *     - **Features:** Integrates with the full config system (e.g., `afterSetText()` hooks).
 *
 * 2.  **`useConfig()` (Internal State):** Used inside `createVdom` or other methods.
 *     - **Purpose:** Manages private, encapsulated state that is internal to the component.
 *     - **Use Case:** For state that the component manages itself and is not controlled by the parent.
 *     - **Features:** Provides a simple, concise way to handle local reactive state.
 *
 * @param {Object} spec - The specification object for the component.
 * @returns {Neo.functional.component.Base} The generated component class.
 *
 * @example
 * import { defineComponent } from 'neo/functional/defineComponent.mjs';
 * import { useConfig }       from 'neo/functional/useConfig.mjs';
 *
 * const MyComponent = defineComponent({
 *     // 1. Define the Public API via the `config` object.
 *     config: {
 *         className: 'MyApp.MyFunctionalComponent',
 *         ntype    : 'my-functional-component',
 *
 *         // `text_` is a NAMED CONFIG. It's part of the component's public API.
 *         // A parent can create this component with a `text` config.
 *         // It is reactive and will generate `afterSetText()` and `beforeSetText()` hooks.
 *         text_: 'Hello World'
 *     },
 *
 *     // 2. Define the component's logic and VDOM.
 *     createVdom(config) {
 *         // `useConfig` creates ANONYMOUS, INTERNAL STATE.
 *         // The `count` state is private to this component and cannot be set by a parent.
 *         const [count, setCount] = useConfig(0);
 *
 *         return {
 *             tag: 'div',
 *             cn: [{
 *                 tag: 'h1',
 *                 // Access the public, named config via the `config` parameter.
 *                 text: config.text
 *             }, {
 *                 tag: 'p',
 *                 // Access the private, internal state directly.
 *                 text: `You clicked ${count} times`
 *             }, {
 *                 tag: 'button',
 *                 text: 'Click me',
 *                 // The setter from `useConfig` updates the internal state.
 *                 onclick: () => setCount(count + 1)
 *             }]
 *         };
 *     },
 *
 *     // 3. Lifecycle hooks for named configs work automatically.
 *     afterSetText(newValue, oldValue) {
 *         console.log(`Text changed from '${oldValue}' to '${newValue}'`);
 *     }
 * });
 *
 * // The returned MyComponent is a class constructor that can be used with Neo.create()
 * // const instance = Neo.create(MyComponent, {
 * //     text: 'Welcome to Neo.mjs!' // Set the public config on creation.
 * // });
 */
function defineComponent(spec) {
    const configSpec = spec.config;
    delete spec.config;

    if (!configSpec?.className) {
        throw new Error('defineComponent requires a config object with a className.');
    }

    class FunctionalComponent extends _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
        static config = {
            ...configSpec
            // We can add our own configurations here
        }
    }

    // Assign instance methods
    Object.entries(spec).forEach(([key, value]) => {
        FunctionalComponent.prototype[key] = value
    });

    // To support multiple envs (like `devmode`, `dist/esm`, `dist/production` in parallel,
    // we must re-assign FunctionalComponent to the setupClass() output.
    FunctionalComponent = Neo.setupClass(FunctionalComponent);

    return FunctionalComponent
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (defineComponent);


/***/ }),

/***/ "./src/functional/useConfig.mjs":
/*!**************************************!*\
  !*** ./src/functional/useConfig.mjs ***!
  \**************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   useConfig: () => (/* binding */ useConfig)
/* harmony export */ });
/* harmony import */ var _core_Config_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/Config.mjs */ "./src/core/Config.mjs");
/* harmony import */ var _core_EffectManager_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../core/EffectManager.mjs */ "./src/core/EffectManager.mjs");



const
    hookIndexSymbol = Symbol.for('hookIndex'),
    hooksSymbol     = Symbol.for('hooks');

/**
 * A hook for managing reactive state within a functional component's `createVdom` method.
 * It mirrors the behavior of React's `useState` but is powered by `Neo.core.Config` for reactivity.
 * @param {*} initialValue The initial value for the state.
 * @returns {Array<any>} A tuple containing the current value and a setter function.
 */
function useConfig(initialValue) {
    _core_EffectManager_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].pause();

    const
        effect    = _core_EffectManager_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].getActiveEffect(),
        component = effect && Neo.getComponent(effect.componentId);

    if (!component) {
        throw new Error('useConfig must be called from within a functional component\'s createVdom method.')
    }

    const currentIndex = component[hookIndexSymbol];

    // Increment the index for the next hook call within the same component render cycle.
    component[hookIndexSymbol]++;

    // If this is the first time this hook is being called for this component, initialize its state.
    if (!component[hooksSymbol][currentIndex]) {
        const config = new _core_Config_mjs__WEBPACK_IMPORTED_MODULE_0__["default"](initialValue);

        const customSetter = (newValue) => {
            if (typeof newValue === 'function') {
                newValue = newValue(config.get())
            }
            config.set(newValue)
        };

        component[hooksSymbol][currentIndex] = [config, customSetter]
    }

    const [config, setter] = component[hooksSymbol][currentIndex];

    _core_EffectManager_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].resume();

    // Call config.get() to ensure this component's effect tracks this config as a dependency.
    return [config.get(), setter]
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useConfig);


/***/ }),

/***/ "./src/functional/useEvent.mjs":
/*!*************************************!*\
  !*** ./src/functional/useEvent.mjs ***!
  \*************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   useEvent: () => (/* binding */ useEvent)
/* harmony export */ });
/* harmony import */ var _core_EffectManager_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/EffectManager.mjs */ "./src/core/EffectManager.mjs");


const pendingDomEventsSymbol = Symbol.for('pendingDomEvents');

/**
 * A hook for registering DOM event listeners within a functional component.
 * Event listeners registered via this hook will be managed by Neo.mjs's
 * delegated DOM event system, ensuring efficient and proper lifecycle handling.
 *
 * @param {String} eventType - The type of DOM event to listen for (e.g., 'click', 'input').
 * @param {Function} handler - The event handler function. It will receive the event data as its argument.
 * @param {String} [delegate] - An optional CSS selector for event delegation. If provided,
 *                               the handler will only fire if the event target matches this selector.
 */
function useEvent(eventType, handler, delegate) {
    const
        activeEffect = _core_EffectManager_mjs__WEBPACK_IMPORTED_MODULE_0__["default"].getActiveEffect(),
        componentId  = activeEffect?.componentId;

    if (!componentId) {
        throw new Error('useEvent must be called from within a functional component\'s createVdom method.')
    }

    _core_EffectManager_mjs__WEBPACK_IMPORTED_MODULE_0__["default"].pause();
    const component = Neo.getComponent(componentId);
    _core_EffectManager_mjs__WEBPACK_IMPORTED_MODULE_0__["default"].resume();

    if (!component) {
        throw new Error(`Component with id ${componentId} not found for useEvent hook.`);
    }

    // Ensure pendingDomEventsSymbol exists on the component instance
    component[pendingDomEventsSymbol] ??= [];

    // Add the event listener configuration to the component's pending list
    component[pendingDomEventsSymbol].push({
        [eventType]: handler,
        delegate,
        scope      : component // The component instance itself will be the scope
    })
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useEvent);


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLWV4YW1wbGVzX2Z1bmN0aW9uYWxfaG9zdENvbXBvbmVudF9hcHBfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUErRTtBQUNQOztBQUV4RSxpRUFBZSwyRUFBZTtBQUM5QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esa0NBQWtDLHFFQUFTOztBQUUzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBLHdDQUF3QyxPQUFPO0FBQy9DLGFBQWE7QUFDYix5QkFBeUIsNERBQU07QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLENBQUMsRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDL0JpRTtBQUNoQjtBQUNpQjs7QUFFckU7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsa0VBQXFCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9COztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHdCQUF3QixnRUFBUztBQUNqQztBQUNBO0FBQ0EseUJBQXlCLGtCQUFrQjtBQUMzQzs7QUFFQTtBQUNBLHdCQUF3QixNQUFNO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isc0RBQXFCO0FBQ3pDO0FBQ0E7QUFDQTs7QUFFQSxpRUFBZSw2QkFBNkIsRUFBQzs7Ozs7Ozs7Ozs7Ozs7OztBQy9DRzs7QUFFekM7QUFDUCxjQUFjLDBEQUFhO0FBQzNCO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ0xrRDtBQUNDO0FBQ047QUFDRDs7QUFFWTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNMUDs7QUFFbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixhQUFhLCtCQUErQjtBQUM1QztBQUNBO0FBQ0EsWUFBWSxrQkFBa0I7QUFDOUIsWUFBWSxrQkFBa0I7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0Esd0NBQXdDLE9BQU87QUFDL0MsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxTQUFTLFFBQVEsU0FBUztBQUN2RTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsc0NBQXNDLDJEQUFjO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxpRUFBZSxlQUFlLEVBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3JHZ0I7QUFDTzs7QUFFdEQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsR0FBRztBQUNkLGFBQWEsWUFBWTtBQUN6QjtBQUNPO0FBQ1AsSUFBSSwrREFBYTs7QUFFakI7QUFDQSxvQkFBb0IsK0RBQWE7QUFDakM7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJCQUEyQix3REFBTTs7QUFFakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUEsSUFBSSwrREFBYTs7QUFFakI7QUFDQTtBQUNBOztBQUVBLGlFQUFlLFNBQVMsRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNuRDZCOztBQUV0RDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxRQUFRO0FBQ25CLFdBQVcsVUFBVTtBQUNyQixXQUFXLFFBQVE7QUFDbkI7QUFDQTtBQUNPO0FBQ1A7QUFDQSx1QkFBdUIsK0RBQWE7QUFDcEM7O0FBRUE7QUFDQTtBQUNBOztBQUVBLElBQUksK0RBQWE7QUFDakI7QUFDQSxJQUFJLCtEQUFhOztBQUVqQjtBQUNBLDZDQUE2QyxhQUFhO0FBQzFEOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQSxpRUFBZSxRQUFRLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW8ubWpzLy4vZXhhbXBsZXMvZnVuY3Rpb25hbC9ob3N0Q29tcG9uZW50L0NvbXBvbmVudC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL2V4YW1wbGVzL2Z1bmN0aW9uYWwvaG9zdENvbXBvbmVudC9NYWluQ29udGFpbmVyLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vZXhhbXBsZXMvZnVuY3Rpb25hbC9ob3N0Q29tcG9uZW50L2FwcC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9mdW5jdGlvbmFsL19leHBvcnQubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvZnVuY3Rpb25hbC9kZWZpbmVDb21wb25lbnQubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvZnVuY3Rpb25hbC91c2VDb25maWcubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvZnVuY3Rpb25hbC91c2VFdmVudC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtkZWZpbmVDb21wb25lbnQsIHVzZUNvbmZpZ30gZnJvbSAnLi4vLi4vLi4vc3JjL2Z1bmN0aW9uYWwvX2V4cG9ydC5tanMnO1xuaW1wb3J0IEJ1dHRvbiAgICAgICAgICAgICAgICAgICAgICAgZnJvbSAnLi4vLi4vLi4vc3JjL2J1dHRvbi9CYXNlLm1qcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7XG4gICAgY29uZmlnOiB7XG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5leGFtcGxlcy5mdW5jdGlvbmFsLmhvc3RDb21wb25lbnQuQ29tcG9uZW50J1xuICAgIH0sXG4gICAgY3JlYXRlVmRvbSgpIHtcbiAgICAgICAgY29uc3QgW2NvdW50LCBzZXRDb3VudF0gPSB1c2VDb25maWcoMCk7XG5cbiAgICAgICAgY29uc3Qgc3R5bGUgPSB7XG4gICAgICAgICAgICBkaXNwbGF5ICAgICAgIDogJ2ZsZXgnLFxuICAgICAgICAgICAgZmxleERpcmVjdGlvbiA6ICdjb2x1bW4nLFxuICAgICAgICAgICAgYWxpZ25JdGVtcyAgICA6ICdjZW50ZXInLFxuICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLFxuICAgICAgICAgICAgZm9udFNpemUgICAgICA6ICcyMHB4J1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7c3R5bGUsIGNuOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGFnIDogJ3AnLFxuICAgICAgICAgICAgICAgIHRleHQ6IGBCdXR0b24gY2xpY2tlZCAke2NvdW50fSB0aW1lc2BcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUgOiBCdXR0b24sXG4gICAgICAgICAgICAgICAgaWQgICAgIDogJ215QnV0dG9uTW9kdWxlJyxcbiAgICAgICAgICAgICAgICB0aGVtZSAgOiAnbmVvLXRoZW1lLW5lby1saWdodCcsXG4gICAgICAgICAgICAgICAgdGV4dCAgIDogJ0NsaWNrIE1lIChOZW8gQnV0dG9uKScsXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogKCkgPT4gc2V0Q291bnQocHJldiA9PiBwcmV2ICsgMSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgXX1cbiAgICB9XG59KTtcbiIsImltcG9ydCBDb25maWd1cmF0aW9uVmlld3BvcnQgZnJvbSAnLi4vLi4vQ29uZmlndXJhdGlvblZpZXdwb3J0Lm1qcyc7XG5pbXBvcnQgTXlGdW5jdGlvbmFsQ29tcG9uZW50IGZyb20gJy4vQ29tcG9uZW50Lm1qcyc7XG5pbXBvcnQgVGV4dEZpZWxkICAgICAgICAgICAgIGZyb20gJy4uLy4uLy4uL3NyYy9mb3JtL2ZpZWxkL1RleHQubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTmVvLmV4YW1wbGVzLmZ1bmN0aW9uYWwuaG9zdENvbXBvbmVudC5NYWluQ29udGFpbmVyXG4gKiBAZXh0ZW5kcyBOZW8uZXhhbXBsZXMuQ29uZmlndXJhdGlvblZpZXdwb3J0XG4gKi9cbmNsYXNzIE1haW5Db250YWluZXIgZXh0ZW5kcyBDb25maWd1cmF0aW9uVmlld3BvcnQge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIGNsYXNzTmFtZSAgICAgICAgICAgOiAnTmVvLmV4YW1wbGVzLmZ1bmN0aW9uYWwuaG9zdENvbXBvbmVudC5NYWluQ29udGFpbmVyJyxcbiAgICAgICAgY29uZmlnSXRlbUxhYmVsV2lkdGg6IDEyMCxcbiAgICAgICAgY29uZmlnSXRlbVdpZHRoICAgICA6IDMwMCxcbiAgICAgICAgbGF5b3V0ICAgICAgICAgICAgICA6IHtudHlwZTogJ2hib3gnLCBhbGlnbjogJ3N0cmV0Y2gnfVxuICAgIH1cblxuICAgIGFzeW5jIGNyZWF0ZUNvbmZpZ3VyYXRpb25Db21wb25lbnRzKCkge1xuICAgICAgICAvLyBXYWl0IG9uZSBtaWNybyB0YXNrIHF1ZXVlIHRpY2ssIHRvIGVuc3VyZSB0aGUgZm4gcmVuZGVyIEVmZmVjdCBpcyBkb25lXG4gICAgICAgIGF3YWl0IFByb21pc2UucmVzb2x2ZSgpO1xuXG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IE5lby5nZXRDb21wb25lbnQoJ215QnV0dG9uTW9kdWxlJyk7XG5cbiAgICAgICAgcmV0dXJuIFt7XG4gICAgICAgICAgICBtb2R1bGUgICAgOiBUZXh0RmllbGQsXG4gICAgICAgICAgICBjbGVhcmFibGUgOiB0cnVlLFxuICAgICAgICAgICAgbGFiZWxUZXh0IDogJ0J1dHRvbiBUZXh0JyxcbiAgICAgICAgICAgIHN0eWxlICAgICA6IHttYXJnaW5Ub3A6ICcxMHB4J30sXG4gICAgICAgICAgICB2YWx1ZSAgICAgOiBidXR0b24udGV4dCxcblxuICAgICAgICAgICAgbGlzdGVuZXJzIDoge1xuICAgICAgICAgICAgICAgIGNoYW5nZSh7dmFsdWV9KSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi50ZXh0ID0gdmFsdWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1dXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge05lby5mdW5jdGlvbmFsLkNvbXBvbmVudH1cbiAgICAgKi9cbiAgICBjcmVhdGVFeGFtcGxlQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbW9kdWxlOiBNeUZ1bmN0aW9uYWxDb21wb25lbnRcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoTWFpbkNvbnRhaW5lcik7XG4iLCJpbXBvcnQgTWFpbkNvbnRhaW5lciBmcm9tICcuL01haW5Db250YWluZXIubWpzJztcblxuZXhwb3J0IGNvbnN0IG9uU3RhcnQgPSAoKSA9PiBOZW8uYXBwKHtcbiAgICBtYWluVmlldzogTWFpbkNvbnRhaW5lcixcbiAgICBuYW1lICAgIDogJ05lby5leGFtcGxlcy5mdW5jdGlvbmFsLmhvc3RDb21wb25lbnQnXG59KTtcbiIsImltcG9ydCBDb21wb25lbnQgICAgICAgZnJvbSAnLi9jb21wb25lbnQvQmFzZS5tanMnO1xuaW1wb3J0IGRlZmluZUNvbXBvbmVudCBmcm9tICcuL2RlZmluZUNvbXBvbmVudC5tanMnO1xuaW1wb3J0IHVzZUNvbmZpZyAgICAgICBmcm9tICcuL3VzZUNvbmZpZy5tanMnO1xuaW1wb3J0IHVzZUV2ZW50ICAgICAgICBmcm9tICcuL3VzZUV2ZW50Lm1qcyc7XG5cbmV4cG9ydCB7Q29tcG9uZW50LCBkZWZpbmVDb21wb25lbnQsIHVzZUNvbmZpZywgdXNlRXZlbnR9O1xuIiwiaW1wb3J0IEZ1bmN0aW9uYWxCYXNlIGZyb20gJy4vY29tcG9uZW50L0Jhc2UubWpzJztcblxuLyoqXG4gKiBGYWN0b3J5IGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGZ1bmN0aW9uYWwgY29tcG9uZW50IGNsYXNzIGZyb20gYSBzcGVjaWZpY2F0aW9uIG9iamVjdC5cbiAqIFRoaXMgZW5hYmxlcyBhIFwiQmVnaW5uZXIgTW9kZVwiIGZvciBjcmVhdGluZyBjb21wb25lbnRzIHdpdGhvdXQgd3JpdGluZyBhIGNsYXNzLFxuICogd2hpbGUgc3RpbGwgcHJvdmlkaW5nIGFjY2VzcyB0byB0aGUgZnVsbCBjbGFzcy1iYXNlZCBmZWF0dXJlIHNldC5cbiAqXG4gKiBJdCdzIGltcG9ydGFudCB0byB1bmRlcnN0YW5kIHRoZSB0d28gd2F5cyBvZiBtYW5hZ2luZyBzdGF0ZTpcbiAqXG4gKiAxLiAgKipOYW1lZCBDb25maWdzIChQdWJsaWMgQVBJKToqKiBEZWZpbmVkIGluIHRoZSBgY29uZmlnYCBvYmplY3QgKGUuZy4sIGB0ZXh0X2ApLlxuICogICAgIC0gKipQdXJwb3NlOioqIERlZmluZXMgdGhlIGNvbXBvbmVudCdzIHB1YmxpYyBBUEkgZm9yIGV4dGVybmFsIGNvbnRyb2wsIHNpbWlsYXIgdG8gcHJvcHMuXG4gKiAgICAgLSAqKlVzZSBDYXNlOioqIEZvciBkYXRhIHRoYXQgYSBwYXJlbnQgY29tcG9uZW50IHdpbGwgc2V0IG9yIGNoYW5nZS5cbiAqICAgICAtICoqRmVhdHVyZXM6KiogSW50ZWdyYXRlcyB3aXRoIHRoZSBmdWxsIGNvbmZpZyBzeXN0ZW0gKGUuZy4sIGBhZnRlclNldFRleHQoKWAgaG9va3MpLlxuICpcbiAqIDIuICAqKmB1c2VDb25maWcoKWAgKEludGVybmFsIFN0YXRlKToqKiBVc2VkIGluc2lkZSBgY3JlYXRlVmRvbWAgb3Igb3RoZXIgbWV0aG9kcy5cbiAqICAgICAtICoqUHVycG9zZToqKiBNYW5hZ2VzIHByaXZhdGUsIGVuY2Fwc3VsYXRlZCBzdGF0ZSB0aGF0IGlzIGludGVybmFsIHRvIHRoZSBjb21wb25lbnQuXG4gKiAgICAgLSAqKlVzZSBDYXNlOioqIEZvciBzdGF0ZSB0aGF0IHRoZSBjb21wb25lbnQgbWFuYWdlcyBpdHNlbGYgYW5kIGlzIG5vdCBjb250cm9sbGVkIGJ5IHRoZSBwYXJlbnQuXG4gKiAgICAgLSAqKkZlYXR1cmVzOioqIFByb3ZpZGVzIGEgc2ltcGxlLCBjb25jaXNlIHdheSB0byBoYW5kbGUgbG9jYWwgcmVhY3RpdmUgc3RhdGUuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IHNwZWMgLSBUaGUgc3BlY2lmaWNhdGlvbiBvYmplY3QgZm9yIHRoZSBjb21wb25lbnQuXG4gKiBAcmV0dXJucyB7TmVvLmZ1bmN0aW9uYWwuY29tcG9uZW50LkJhc2V9IFRoZSBnZW5lcmF0ZWQgY29tcG9uZW50IGNsYXNzLlxuICpcbiAqIEBleGFtcGxlXG4gKiBpbXBvcnQgeyBkZWZpbmVDb21wb25lbnQgfSBmcm9tICduZW8vZnVuY3Rpb25hbC9kZWZpbmVDb21wb25lbnQubWpzJztcbiAqIGltcG9ydCB7IHVzZUNvbmZpZyB9ICAgICAgIGZyb20gJ25lby9mdW5jdGlvbmFsL3VzZUNvbmZpZy5tanMnO1xuICpcbiAqIGNvbnN0IE15Q29tcG9uZW50ID0gZGVmaW5lQ29tcG9uZW50KHtcbiAqICAgICAvLyAxLiBEZWZpbmUgdGhlIFB1YmxpYyBBUEkgdmlhIHRoZSBgY29uZmlnYCBvYmplY3QuXG4gKiAgICAgY29uZmlnOiB7XG4gKiAgICAgICAgIGNsYXNzTmFtZTogJ015QXBwLk15RnVuY3Rpb25hbENvbXBvbmVudCcsXG4gKiAgICAgICAgIG50eXBlICAgIDogJ215LWZ1bmN0aW9uYWwtY29tcG9uZW50JyxcbiAqXG4gKiAgICAgICAgIC8vIGB0ZXh0X2AgaXMgYSBOQU1FRCBDT05GSUcuIEl0J3MgcGFydCBvZiB0aGUgY29tcG9uZW50J3MgcHVibGljIEFQSS5cbiAqICAgICAgICAgLy8gQSBwYXJlbnQgY2FuIGNyZWF0ZSB0aGlzIGNvbXBvbmVudCB3aXRoIGEgYHRleHRgIGNvbmZpZy5cbiAqICAgICAgICAgLy8gSXQgaXMgcmVhY3RpdmUgYW5kIHdpbGwgZ2VuZXJhdGUgYGFmdGVyU2V0VGV4dCgpYCBhbmQgYGJlZm9yZVNldFRleHQoKWAgaG9va3MuXG4gKiAgICAgICAgIHRleHRfOiAnSGVsbG8gV29ybGQnXG4gKiAgICAgfSxcbiAqXG4gKiAgICAgLy8gMi4gRGVmaW5lIHRoZSBjb21wb25lbnQncyBsb2dpYyBhbmQgVkRPTS5cbiAqICAgICBjcmVhdGVWZG9tKGNvbmZpZykge1xuICogICAgICAgICAvLyBgdXNlQ29uZmlnYCBjcmVhdGVzIEFOT05ZTU9VUywgSU5URVJOQUwgU1RBVEUuXG4gKiAgICAgICAgIC8vIFRoZSBgY291bnRgIHN0YXRlIGlzIHByaXZhdGUgdG8gdGhpcyBjb21wb25lbnQgYW5kIGNhbm5vdCBiZSBzZXQgYnkgYSBwYXJlbnQuXG4gKiAgICAgICAgIGNvbnN0IFtjb3VudCwgc2V0Q291bnRdID0gdXNlQ29uZmlnKDApO1xuICpcbiAqICAgICAgICAgcmV0dXJuIHtcbiAqICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gKiAgICAgICAgICAgICBjbjogW3tcbiAqICAgICAgICAgICAgICAgICB0YWc6ICdoMScsXG4gKiAgICAgICAgICAgICAgICAgLy8gQWNjZXNzIHRoZSBwdWJsaWMsIG5hbWVkIGNvbmZpZyB2aWEgdGhlIGBjb25maWdgIHBhcmFtZXRlci5cbiAqICAgICAgICAgICAgICAgICB0ZXh0OiBjb25maWcudGV4dFxuICogICAgICAgICAgICAgfSwge1xuICogICAgICAgICAgICAgICAgIHRhZzogJ3AnLFxuICogICAgICAgICAgICAgICAgIC8vIEFjY2VzcyB0aGUgcHJpdmF0ZSwgaW50ZXJuYWwgc3RhdGUgZGlyZWN0bHkuXG4gKiAgICAgICAgICAgICAgICAgdGV4dDogYFlvdSBjbGlja2VkICR7Y291bnR9IHRpbWVzYFxuICogICAgICAgICAgICAgfSwge1xuICogICAgICAgICAgICAgICAgIHRhZzogJ2J1dHRvbicsXG4gKiAgICAgICAgICAgICAgICAgdGV4dDogJ0NsaWNrIG1lJyxcbiAqICAgICAgICAgICAgICAgICAvLyBUaGUgc2V0dGVyIGZyb20gYHVzZUNvbmZpZ2AgdXBkYXRlcyB0aGUgaW50ZXJuYWwgc3RhdGUuXG4gKiAgICAgICAgICAgICAgICAgb25jbGljazogKCkgPT4gc2V0Q291bnQoY291bnQgKyAxKVxuICogICAgICAgICAgICAgfV1cbiAqICAgICAgICAgfTtcbiAqICAgICB9LFxuICpcbiAqICAgICAvLyAzLiBMaWZlY3ljbGUgaG9va3MgZm9yIG5hbWVkIGNvbmZpZ3Mgd29yayBhdXRvbWF0aWNhbGx5LlxuICogICAgIGFmdGVyU2V0VGV4dChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAqICAgICAgICAgY29uc29sZS5sb2coYFRleHQgY2hhbmdlZCBmcm9tICcke29sZFZhbHVlfScgdG8gJyR7bmV3VmFsdWV9J2ApO1xuICogICAgIH1cbiAqIH0pO1xuICpcbiAqIC8vIFRoZSByZXR1cm5lZCBNeUNvbXBvbmVudCBpcyBhIGNsYXNzIGNvbnN0cnVjdG9yIHRoYXQgY2FuIGJlIHVzZWQgd2l0aCBOZW8uY3JlYXRlKClcbiAqIC8vIGNvbnN0IGluc3RhbmNlID0gTmVvLmNyZWF0ZShNeUNvbXBvbmVudCwge1xuICogLy8gICAgIHRleHQ6ICdXZWxjb21lIHRvIE5lby5tanMhJyAvLyBTZXQgdGhlIHB1YmxpYyBjb25maWcgb24gY3JlYXRpb24uXG4gKiAvLyB9KTtcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlZmluZUNvbXBvbmVudChzcGVjKSB7XG4gICAgY29uc3QgY29uZmlnU3BlYyA9IHNwZWMuY29uZmlnO1xuICAgIGRlbGV0ZSBzcGVjLmNvbmZpZztcblxuICAgIGlmICghY29uZmlnU3BlYz8uY2xhc3NOYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignZGVmaW5lQ29tcG9uZW50IHJlcXVpcmVzIGEgY29uZmlnIG9iamVjdCB3aXRoIGEgY2xhc3NOYW1lLicpO1xuICAgIH1cblxuICAgIGNsYXNzIEZ1bmN0aW9uYWxDb21wb25lbnQgZXh0ZW5kcyBGdW5jdGlvbmFsQmFzZSB7XG4gICAgICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgICAgICAuLi5jb25maWdTcGVjXG4gICAgICAgICAgICAvLyBXZSBjYW4gYWRkIG91ciBvd24gY29uZmlndXJhdGlvbnMgaGVyZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gQXNzaWduIGluc3RhbmNlIG1ldGhvZHNcbiAgICBPYmplY3QuZW50cmllcyhzcGVjKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgRnVuY3Rpb25hbENvbXBvbmVudC5wcm90b3R5cGVba2V5XSA9IHZhbHVlXG4gICAgfSk7XG5cbiAgICAvLyBUbyBzdXBwb3J0IG11bHRpcGxlIGVudnMgKGxpa2UgYGRldm1vZGVgLCBgZGlzdC9lc21gLCBgZGlzdC9wcm9kdWN0aW9uYCBpbiBwYXJhbGxlbCxcbiAgICAvLyB3ZSBtdXN0IHJlLWFzc2lnbiBGdW5jdGlvbmFsQ29tcG9uZW50IHRvIHRoZSBzZXR1cENsYXNzKCkgb3V0cHV0LlxuICAgIEZ1bmN0aW9uYWxDb21wb25lbnQgPSBOZW8uc2V0dXBDbGFzcyhGdW5jdGlvbmFsQ29tcG9uZW50KTtcblxuICAgIHJldHVybiBGdW5jdGlvbmFsQ29tcG9uZW50XG59XG5cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudDtcbiIsImltcG9ydCBDb25maWcgICAgICAgIGZyb20gJy4uL2NvcmUvQ29uZmlnLm1qcyc7XG5pbXBvcnQgRWZmZWN0TWFuYWdlciBmcm9tICcuLi9jb3JlL0VmZmVjdE1hbmFnZXIubWpzJztcblxuY29uc3RcbiAgICBob29rSW5kZXhTeW1ib2wgPSBTeW1ib2wuZm9yKCdob29rSW5kZXgnKSxcbiAgICBob29rc1N5bWJvbCAgICAgPSBTeW1ib2wuZm9yKCdob29rcycpO1xuXG4vKipcbiAqIEEgaG9vayBmb3IgbWFuYWdpbmcgcmVhY3RpdmUgc3RhdGUgd2l0aGluIGEgZnVuY3Rpb25hbCBjb21wb25lbnQncyBgY3JlYXRlVmRvbWAgbWV0aG9kLlxuICogSXQgbWlycm9ycyB0aGUgYmVoYXZpb3Igb2YgUmVhY3QncyBgdXNlU3RhdGVgIGJ1dCBpcyBwb3dlcmVkIGJ5IGBOZW8uY29yZS5Db25maWdgIGZvciByZWFjdGl2aXR5LlxuICogQHBhcmFtIHsqfSBpbml0aWFsVmFsdWUgVGhlIGluaXRpYWwgdmFsdWUgZm9yIHRoZSBzdGF0ZS5cbiAqIEByZXR1cm5zIHtBcnJheTxhbnk+fSBBIHR1cGxlIGNvbnRhaW5pbmcgdGhlIGN1cnJlbnQgdmFsdWUgYW5kIGEgc2V0dGVyIGZ1bmN0aW9uLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlQ29uZmlnKGluaXRpYWxWYWx1ZSkge1xuICAgIEVmZmVjdE1hbmFnZXIucGF1c2UoKTtcblxuICAgIGNvbnN0XG4gICAgICAgIGVmZmVjdCAgICA9IEVmZmVjdE1hbmFnZXIuZ2V0QWN0aXZlRWZmZWN0KCksXG4gICAgICAgIGNvbXBvbmVudCA9IGVmZmVjdCAmJiBOZW8uZ2V0Q29tcG9uZW50KGVmZmVjdC5jb21wb25lbnRJZCk7XG5cbiAgICBpZiAoIWNvbXBvbmVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3VzZUNvbmZpZyBtdXN0IGJlIGNhbGxlZCBmcm9tIHdpdGhpbiBhIGZ1bmN0aW9uYWwgY29tcG9uZW50XFwncyBjcmVhdGVWZG9tIG1ldGhvZC4nKVxuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IGNvbXBvbmVudFtob29rSW5kZXhTeW1ib2xdO1xuXG4gICAgLy8gSW5jcmVtZW50IHRoZSBpbmRleCBmb3IgdGhlIG5leHQgaG9vayBjYWxsIHdpdGhpbiB0aGUgc2FtZSBjb21wb25lbnQgcmVuZGVyIGN5Y2xlLlxuICAgIGNvbXBvbmVudFtob29rSW5kZXhTeW1ib2xdKys7XG5cbiAgICAvLyBJZiB0aGlzIGlzIHRoZSBmaXJzdCB0aW1lIHRoaXMgaG9vayBpcyBiZWluZyBjYWxsZWQgZm9yIHRoaXMgY29tcG9uZW50LCBpbml0aWFsaXplIGl0cyBzdGF0ZS5cbiAgICBpZiAoIWNvbXBvbmVudFtob29rc1N5bWJvbF1bY3VycmVudEluZGV4XSkge1xuICAgICAgICBjb25zdCBjb25maWcgPSBuZXcgQ29uZmlnKGluaXRpYWxWYWx1ZSk7XG5cbiAgICAgICAgY29uc3QgY3VzdG9tU2V0dGVyID0gKG5ld1ZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG5ld1ZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWUgPSBuZXdWYWx1ZShjb25maWcuZ2V0KCkpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25maWcuc2V0KG5ld1ZhbHVlKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbXBvbmVudFtob29rc1N5bWJvbF1bY3VycmVudEluZGV4XSA9IFtjb25maWcsIGN1c3RvbVNldHRlcl1cbiAgICB9XG5cbiAgICBjb25zdCBbY29uZmlnLCBzZXR0ZXJdID0gY29tcG9uZW50W2hvb2tzU3ltYm9sXVtjdXJyZW50SW5kZXhdO1xuXG4gICAgRWZmZWN0TWFuYWdlci5yZXN1bWUoKTtcblxuICAgIC8vIENhbGwgY29uZmlnLmdldCgpIHRvIGVuc3VyZSB0aGlzIGNvbXBvbmVudCdzIGVmZmVjdCB0cmFja3MgdGhpcyBjb25maWcgYXMgYSBkZXBlbmRlbmN5LlxuICAgIHJldHVybiBbY29uZmlnLmdldCgpLCBzZXR0ZXJdXG59XG5cbmV4cG9ydCBkZWZhdWx0IHVzZUNvbmZpZztcbiIsImltcG9ydCBFZmZlY3RNYW5hZ2VyIGZyb20gJy4uL2NvcmUvRWZmZWN0TWFuYWdlci5tanMnO1xuXG5jb25zdCBwZW5kaW5nRG9tRXZlbnRzU3ltYm9sID0gU3ltYm9sLmZvcigncGVuZGluZ0RvbUV2ZW50cycpO1xuXG4vKipcbiAqIEEgaG9vayBmb3IgcmVnaXN0ZXJpbmcgRE9NIGV2ZW50IGxpc3RlbmVycyB3aXRoaW4gYSBmdW5jdGlvbmFsIGNvbXBvbmVudC5cbiAqIEV2ZW50IGxpc3RlbmVycyByZWdpc3RlcmVkIHZpYSB0aGlzIGhvb2sgd2lsbCBiZSBtYW5hZ2VkIGJ5IE5lby5tanMnc1xuICogZGVsZWdhdGVkIERPTSBldmVudCBzeXN0ZW0sIGVuc3VyaW5nIGVmZmljaWVudCBhbmQgcHJvcGVyIGxpZmVjeWNsZSBoYW5kbGluZy5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gZXZlbnRUeXBlIC0gVGhlIHR5cGUgb2YgRE9NIGV2ZW50IHRvIGxpc3RlbiBmb3IgKGUuZy4sICdjbGljaycsICdpbnB1dCcpLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciAtIFRoZSBldmVudCBoYW5kbGVyIGZ1bmN0aW9uLiBJdCB3aWxsIHJlY2VpdmUgdGhlIGV2ZW50IGRhdGEgYXMgaXRzIGFyZ3VtZW50LlxuICogQHBhcmFtIHtTdHJpbmd9IFtkZWxlZ2F0ZV0gLSBBbiBvcHRpb25hbCBDU1Mgc2VsZWN0b3IgZm9yIGV2ZW50IGRlbGVnYXRpb24uIElmIHByb3ZpZGVkLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGhhbmRsZXIgd2lsbCBvbmx5IGZpcmUgaWYgdGhlIGV2ZW50IHRhcmdldCBtYXRjaGVzIHRoaXMgc2VsZWN0b3IuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VFdmVudChldmVudFR5cGUsIGhhbmRsZXIsIGRlbGVnYXRlKSB7XG4gICAgY29uc3RcbiAgICAgICAgYWN0aXZlRWZmZWN0ID0gRWZmZWN0TWFuYWdlci5nZXRBY3RpdmVFZmZlY3QoKSxcbiAgICAgICAgY29tcG9uZW50SWQgID0gYWN0aXZlRWZmZWN0Py5jb21wb25lbnRJZDtcblxuICAgIGlmICghY29tcG9uZW50SWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd1c2VFdmVudCBtdXN0IGJlIGNhbGxlZCBmcm9tIHdpdGhpbiBhIGZ1bmN0aW9uYWwgY29tcG9uZW50XFwncyBjcmVhdGVWZG9tIG1ldGhvZC4nKVxuICAgIH1cblxuICAgIEVmZmVjdE1hbmFnZXIucGF1c2UoKTtcbiAgICBjb25zdCBjb21wb25lbnQgPSBOZW8uZ2V0Q29tcG9uZW50KGNvbXBvbmVudElkKTtcbiAgICBFZmZlY3RNYW5hZ2VyLnJlc3VtZSgpO1xuXG4gICAgaWYgKCFjb21wb25lbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb21wb25lbnQgd2l0aCBpZCAke2NvbXBvbmVudElkfSBub3QgZm91bmQgZm9yIHVzZUV2ZW50IGhvb2suYCk7XG4gICAgfVxuXG4gICAgLy8gRW5zdXJlIHBlbmRpbmdEb21FdmVudHNTeW1ib2wgZXhpc3RzIG9uIHRoZSBjb21wb25lbnQgaW5zdGFuY2VcbiAgICBjb21wb25lbnRbcGVuZGluZ0RvbUV2ZW50c1N5bWJvbF0gPz89IFtdO1xuXG4gICAgLy8gQWRkIHRoZSBldmVudCBsaXN0ZW5lciBjb25maWd1cmF0aW9uIHRvIHRoZSBjb21wb25lbnQncyBwZW5kaW5nIGxpc3RcbiAgICBjb21wb25lbnRbcGVuZGluZ0RvbUV2ZW50c1N5bWJvbF0ucHVzaCh7XG4gICAgICAgIFtldmVudFR5cGVdOiBoYW5kbGVyLFxuICAgICAgICBkZWxlZ2F0ZSxcbiAgICAgICAgc2NvcGUgICAgICA6IGNvbXBvbmVudCAvLyBUaGUgY29tcG9uZW50IGluc3RhbmNlIGl0c2VsZiB3aWxsIGJlIHRoZSBzY29wZVxuICAgIH0pXG59XG5cbmV4cG9ydCBkZWZhdWx0IHVzZUV2ZW50O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9