"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-apps_legit_app_mjs"],{

/***/ "./apps/legit/app.mjs"
/*!****************************!*\
  !*** ./apps/legit/app.mjs ***!
  \****************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   onStart: () => (/* binding */ onStart)
/* harmony export */ });
/* harmony import */ var _view_Viewport_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./view/Viewport.mjs */ "./apps/legit/view/Viewport.mjs");


const onStart = () => Neo.app({
    mainView: _view_Viewport_mjs__WEBPACK_IMPORTED_MODULE_0__["default"],
    name    : 'Legit'
});

/***/ },

/***/ "./apps/legit/model/Commit.mjs"
/*!*************************************!*\
  !*** ./apps/legit/model/Commit.mjs ***!
  \*************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/data/Model.mjs */ "./src/data/Model.mjs");


/**
 * @class Legit.model.Commit
 * @extends Neo.data.Model
 */
class Commit extends _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.model.Commit'
         * @protected
         */
        className: 'Legit.model.Commit',
        /**
         * @member {Object[]} fields
         */
        fields: [{
            name: 'oid',
            type: 'String'
        }, {
            name: 'message',
            type: 'String'
        }, {
            name: 'author',
            type: 'Object'
        }, {
            name: 'timestamp',
            type: 'Integer'
        }]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Commit));


/***/ },

/***/ "./apps/legit/model/File.mjs"
/*!***********************************!*\
  !*** ./apps/legit/model/File.mjs ***!
  \***********************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/data/Model.mjs */ "./src/data/Model.mjs");


/**
 * @class Legit.model.File
 * @extends Neo.data.Model
 */
class File extends _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.model.File'
         * @protected
         */
        className: 'Legit.model.File',
        /**
         * @member {Object[]} fields
         */
        fields: [{
            name: 'className',
            type: 'String'
        }, {
            name: 'collapsed',
            type: 'Boolean'
        }, {
            name: 'hidden',
            type: 'Boolean'
        }, {
            name: 'id',
            type: 'String'
        }, {
            name        : 'isLeaf',
            type        : 'Boolean',
            defaultValue: true
        }, {
            name: 'name',
            type: 'String'
        }, {
            name: 'parentId',
            type: 'String'
        }]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(File));


/***/ },

/***/ "./apps/legit/service/Legit.mjs"
/*!**************************************!*\
  !*** ./apps/legit/service/Legit.mjs ***!
  \**************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/core/Base.mjs */ "./src/core/Base.mjs");


/**
 * @summary A singleton service that provides a virtual file system layer for the Legit IDE.
 *
 * This service acts as the central hub for file system operations within the Legit application.
 * It abstracts the underlying storage mechanism (using `memfs`) and provides a git-like interface
 * for interacting with file trees and commits (using `@legit-sdk/core`).
 *
 * Key responsibilities include:
 * - **Initialization:** Dynamically loading external dependencies (`memfs`, `@legit-sdk/core`) to ensure the app remains lightweight until needed.
 * - **File System Seeding:** Populating the in-memory file system with initial demo content.
 * - **Git Operations:** Providing methods to load file trees (`loadTree`) and calculate deltas between commits (`loadTreeDelta`).
 * - **File I/O:** Exposing standard file system methods (`readFile`, `writeFile`, `readdir`, `stat`) that automatically await the service's ready state.
 *
 * This service is designed to be robust against initialization failures and provides a safe, asynchronous API for the `ViewportController` to consume.
 *
 * @class Legit.service.Legit
 * @extends Neo.core.Base
 * @singleton
 */
class Legit extends _src_core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.service.Legit'
         * @protected
         */
        className: 'Legit.service.Legit',
        /**
         * @member {Object|null} fs=null
         */
        fs: null,
        /**
         * @member {Object|null} legitFs=null
         */
        legitFs: null,
        /**
         * @member {String} path='/.legit/branches/anonymous'
         */
        path: '/.legit/branches/anonymous',
        /**
         * @member {Boolean} singleton=true
         * @protected
         */
        singleton: true
    }

    /**
     * Initializes the service by dynamically importing dependencies and setting up the file system.
     * @returns {Promise<void>}
     */
    async initAsync() {
        await super.initAsync();

        const me = this;

        try {
            const {openLegitFs} = await import(/* webpackIgnore: true */ 'https://esm.sh/@legit-sdk/core');
            const fsModule      = await import(/* webpackIgnore: true */ 'https://esm.sh/memfs');

            me.fs = fsModule.default;

            me.legitFs = await openLegitFs({
                storageFs: me.fs,
                gitRoot  : '/',
                serverUrl: 'http://localhost:9999/',
                // publicKey: process.env.NEXT_PUBLIC_LEGIT_PUBLIC_KEY,
            });

            // For debugging
            globalThis.legitFs = me.legitFs;

            await me.#seedFileSystem();
        } catch (e) {
            console.error('Failed to initialize Legit Service', e);
        }
    }

    /**
     * Retrieves the commit history for a given branch.
     * @param {String} [branch='anonymous'] The branch name to load history for.
     * @returns {Promise<Object[]>} An array of commit objects.
     */
    async loadHistory(branch='anonymous') {
        await this.ready();

        try {
            const historyJson = await this.legitFs.readFile(`/.legit/branches/${branch}/.legit/history`, 'utf-8');
            return JSON.parse(historyJson);
        } catch (e) {
            console.warn(`Failed to load history for branch ${branch}`, e);
            return [];
        }
    }

    /**
     * Recursively loads the file tree structure from a given path.
     * @param {String} treePath The path to start loading the tree from.
     * @returns {Promise<{hash: string, subEntries: {}}>} The tree structure with hashes.
     */
    async loadTree(treePath) {
        await this.ready();

        const
            me         = this,
            subEntries = {},
            pathEntries = await me.readdir(treePath);

        for (const entryName of pathEntries) {
            const stat = await me.stat(treePath + entryName);

            if (stat.isDirectory()) {
                subEntries[entryName] = await me.loadTree(treePath + entryName + '/');
            } else {
                const contenHash = await crypto.subtle.digest("SHA-1", await me.readFile(treePath + entryName));

                subEntries[entryName] = {
                    // for now its the content instead of the hash
                    hash: contenHash,
                    name: entryName,
                };
            }
        }

        return {
            hash: '',
            subEntries
        }
    }

    /**
     * Calculates the difference between two tree states (commits).
     * Useful for identifying added, deleted, and modified files.
     * @param {String} currentState The hash or path of the current state.
     * @param {String} newState The hash or path of the new state.
     * @returns {Promise<{deleted: String[], added: String[], modified: String[]}>} An object containing arrays of changed file paths.
     */
    async loadTreeDelta(currentState, newState) {
        await this.ready();

        const me = this;

        const prefixNewState = newState.slice(0, 2);
        const suffixNewState = newState.slice(2);

        let currentstateTree = {}

        if (currentState) {
            const prefixCurrentState = currentState.slice(0, 2);
            const suffixCurrentState = currentState.slice(2);

            currentstateTree = await me.loadTree('/.legit/commits/' + prefixCurrentState + '/' + suffixCurrentState + '/');
        }
        const newStateTree = await me.loadTree('/.legit/commits/' + prefixNewState + '/' + suffixNewState + '/');

        const deleted  = [];
        const added    = [];
        const modified = [];

        function flattenTree(tree, path = '') {
            const result = {};

            if (tree.subEntries) {
                for (const [key, value] of Object.entries(tree.subEntries)) {
                    const currentPath = path ? `${path}/${key}` : key;

                    if (value.subEntries) {
                        Object.assign(result, flattenTree(value, currentPath));
                    } else {
                        result[currentPath] = value.hash;
                    }
                }
            }

            return result;
        }

        const currentStateFlat = currentState !== '' ? flattenTree(currentstateTree) : {};
        const newStateFlat     = flattenTree(newStateTree);

        // Find deleted (in current but not in new)
        for (const path in currentStateFlat) {
            if (!(path in newStateFlat)) {
                deleted.push(path);
            }
        }

        // Find added (in new but not in current)
        for (const path in newStateFlat) {
            if (!(path in currentStateFlat)) {
                added.push(path);
            }
        }

        // Find modified (in both but hash differs)
        for (const path in newStateFlat) {
            if (path in currentStateFlat) {
                const currentHash = new Uint8Array(currentStateFlat[path]);
                const newHash     = new Uint8Array(newStateFlat[path]);

                if (currentHash.length !== newHash.length ||
                    !currentHash.every((byte, i) => byte === newHash[i])) {
                    modified.push(path);
                }
            }
        }

        return {
            deleted,
            added,
            modified
        }
    }

    /**
     * Reads the content of a file.
     * @param {String} path The file path.
     * @param {Object} [options] Read options.
     * @returns {Promise<*>} The file content.
     */
    async readFile(path, options) {
        await this.ready();
        return this.legitFs.readFile(path, options)
    }

    /**
     * Reads the contents of a directory.
     * @param {String} path The directory path.
     * @returns {Promise<String[]>} An array of file names.
     */
    async readdir(path) {
        await this.ready();
        return this.legitFs.readdir(path)
    }

    /**
     * Seeds the in-memory file system with initial demo content.
     * This method bypasses the `ready()` check to avoid deadlocks during initialization.
     * @returns {Promise<void>}
     * @private
     */
    async #seedFileSystem() {
        const me = this;

        let mdFile = await fetch('../../learn/benefits/FormsEngine.md');
        mdFile = await mdFile.text();

        await me.writeFile({
            data     : mdFile,
            path     : `${me.path}/FormsEngine.md`,
            skipReady: true
        });

        mdFile = await fetch('../../learn/benefits/OffTheMainThread.md');
        mdFile = await mdFile.text();

        await me.writeFile({
            data     : mdFile,
            path     : `${me.path}/OffTheMainThread.md`,
            skipReady: true
        });

        await me.writeFile({
            data: [
                "import Viewport from '../../examples/component/multiWindowHelix/Viewport.mjs';",
                "",
                "class MainView extends Viewport {",
                "    static config = {",
                "        className           : 'Portal.view.MultiWindowHelix',",
                "        showGitHubStarButton: false,",
                "        theme               : 'neo-theme-dark'",
                "    }",
                "}",
                "",
                "MainView = Neo.setupClass(MainView);"
            ].join('\n'),
            path     : `${me.path}/Helix.mjs`,
            skipReady: true
        });

        await me.writeFile({
            data: [
                "import Viewport from '../../examples/component/multiWindowCoronaGallery/Viewport.mjs';",
                "",
                "class MainView extends Viewport {",
                "    static config = {",
                "        className           : 'Portal.view.MultiWindowHelix',",
                "        showGitHubStarButton: false,",
                "        theme               : 'neo-theme-dark'",
                "    }",
                "}",
                "",
                "MainView = Neo.setupClass(MainView);"
            ].join('\n'),
            path     : `${me.path}/Gallery.mjs`,
            skipReady: true
        });
    }

    /**
     * Retrieves file statistics.
     * @param {String} path The file or directory path.
     * @returns {Promise<Object>} The file statistics object.
     */
    async stat(path) {
        await this.ready();
        return this.legitFs.stat(path)
    }

    /**
     * Writes data to a file.
     * @param {Object}        config Configuration object.
     * @param {String|Buffer} config.data The data to write.
     * @param {Object}        [config.options] Write options.
     * @param {String}        config.path The file path.
     * @param {Boolean}       [config.skipReady=false] If true, bypasses the `await this.ready()` check.
     * @returns {Promise<*>}
     */
    async writeFile({data, options, path, skipReady=false}) {
        !skipReady && await this.ready();
        return this.legitFs.writeFile(path, data, options)
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Legit));


/***/ },

/***/ "./apps/legit/store/Commits.mjs"
/*!**************************************!*\
  !*** ./apps/legit/store/Commits.mjs ***!
  \**************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _model_Commit_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../model/Commit.mjs */ "./apps/legit/model/Commit.mjs");
/* harmony import */ var _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../src/data/Store.mjs */ "./src/data/Store.mjs");



/**
 * @class Legit.store.Commits
 * @extends Neo.data.Store
 */
class Commits extends _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.store.Commits'
         * @protected
         */
        className: 'Legit.store.Commits',
        /**
         * @member {Neo.data.Model} model=CommitModel
         */
        model: _model_Commit_mjs__WEBPACK_IMPORTED_MODULE_0__["default"],
        /**
         * @member {Object[]} sorters=[{property:'timestamp',direction:'DESC'}]
         */
        sorters: [{
            property : 'timestamp',
            direction: 'DESC'
        }]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Commits));


/***/ },

/***/ "./apps/legit/store/Files.mjs"
/*!************************************!*\
  !*** ./apps/legit/store/Files.mjs ***!
  \************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _model_File_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../model/File.mjs */ "./apps/legit/model/File.mjs");
/* harmony import */ var _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../src/data/Store.mjs */ "./src/data/Store.mjs");



/**
 * @class Legit.store.Files
 * @extends Neo.data.Store
 */
class Files extends _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.store.Files'
         * @protected
         */
        className: 'Legit.store.Files',
        /**
         * @member {Neo.data.Model} model=FileModel
         */
        model: _model_File_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Files));


/***/ },

/***/ "./apps/legit/view/CommitGrid.mjs"
/*!****************************************!*\
  !*** ./apps/legit/view/CommitGrid.mjs ***!
  \****************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_grid_Container_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/grid/Container.mjs */ "./src/grid/Container.mjs");


/**
 * @class Legit.view.CommitGrid
 * @extends Neo.grid.Container
 */
class CommitGrid extends _src_grid_Container_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.view.CommitGrid'
         * @protected
         */
        className: 'Legit.view.CommitGrid',
        /**
         * @member {String[]} baseCls=['legit-commit-grid','neo-grid-container']
         * @protected
         */
        baseCls: ['legit-commit-grid', 'neo-grid-container'],
        /**
         * @member {Object} bind={store:'stores.commitStore'}
         */
        bind: {store: 'stores.commitStore'},
        /**
         * @member {Object} columnDefaults={renderer:'onCommitColumnRenderer'}
         */
        columnDefaults: {
            renderer: 'onCommitColumnRenderer'
        },
        /**
         * @member {Object[]} columns
         */
        columns: [{
            dataField: 'timestamp',
            text     : 'Timestamp',
            width    : 150
        }, {
            dataField: 'author',
            text     : 'Author',
            width    : 150
        }, {
            dataField: 'message',
            text     : 'Message',
            flex     : 1
        }, {
            dataField: 'oid',
            text     : 'OID',
            width    : 300
        }]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(CommitGrid));


/***/ },

/***/ "./apps/legit/view/Viewport.mjs"
/*!**************************************!*\
  !*** ./apps/legit/view/Viewport.mjs ***!
  \**************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_container_Viewport_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/container/Viewport.mjs */ "./src/container/Viewport.mjs");
/* harmony import */ var _src_button_Base_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../src/button/Base.mjs */ "./src/button/Base.mjs");
/* harmony import */ var _CommitGrid_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./CommitGrid.mjs */ "./apps/legit/view/CommitGrid.mjs");
/* harmony import */ var _src_container_Base_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../src/container/Base.mjs */ "./src/container/Base.mjs");
/* harmony import */ var _src_code_LivePreview_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../src/code/LivePreview.mjs */ "./src/code/LivePreview.mjs");
/* harmony import */ var _src_container_Panel_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../src/container/Panel.mjs */ "./src/container/Panel.mjs");
/* harmony import */ var _src_tree_List_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../src/tree/List.mjs */ "./src/tree/List.mjs");
/* harmony import */ var _src_component_Splitter_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../src/component/Splitter.mjs */ "./src/component/Splitter.mjs");
/* harmony import */ var _src_toolbar_Base_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../src/toolbar/Base.mjs */ "./src/toolbar/Base.mjs");
/* harmony import */ var _ViewportController_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ViewportController.mjs */ "./apps/legit/view/ViewportController.mjs");
/* harmony import */ var _ViewportStateProvider_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./ViewportStateProvider.mjs */ "./apps/legit/view/ViewportStateProvider.mjs");












/**
 * @class Legit.view.Viewport
 * @extends Neo.container.Viewport
 */
class Viewport extends _src_container_Viewport_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.view.Viewport'
         * @protected
         */
        className: 'Legit.view.Viewport',
        /**
         * @member {String[]} cls=['legit-viewport']
         */
        cls: ['legit-viewport'],
        /**
         * @member {Neo.controller.Component} controller=ViewportController
         */
        controller: _ViewportController_mjs__WEBPACK_IMPORTED_MODULE_9__["default"],
        /**
         * @member {Neo.state.Provider} stateProvider=ViewportStateProvider
         */
        stateProvider: _ViewportStateProvider_mjs__WEBPACK_IMPORTED_MODULE_10__["default"],
        /*
         * @member {Object} layout={ntype:'hbox',align:'stretch'}
         */
        layout: {ntype: 'hbox', align: 'stretch'},
        /**
         * @member {Object[]} items
         */
        items: [{
            module                    : _src_tree_List_mjs__WEBPACK_IMPORTED_MODULE_6__["default"],
            bind                      : {store: 'stores.fileStore'},
            cls                       : ['legit-files-tree'],
            listeners                 : {leafItemClick: 'onFileItemClick', select: 'onTreeListSelect'},
            reference                 : 'files-tree',
            showCollapseExpandAllIcons: false,
            width                     : 300,
        }, {
            module      : _src_component_Splitter_mjs__WEBPACK_IMPORTED_MODULE_7__["default"],
            resizeTarget: 'previous',
            size        : 5
        }, {
            module: _src_container_Base_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
            flex  : 1,
            layout: {ntype: 'vbox', align: 'stretch'},
            items: [{
                module: _src_toolbar_Base_mjs__WEBPACK_IMPORTED_MODULE_8__["default"],
                flex  : 'none',
                style : {marginRight: '15px'},
                items :['->', {
                    module   : _src_button_Base_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                    disabled : true,
                    handler  : 'onNewFileButtonClick',
                    iconCls  : 'fa fa-plus',
                    reference: 'new-file-button',
                    text     : 'New File'
                }, {
                    module   : _src_button_Base_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                    disabled : true,
                    handler  : 'onSaveButtonClick',
                    iconCls  : 'fa fa-cloud-upload',
                    reference: 'save-button',
                    style    : {marginLeft: '.5em'},
                    text     : 'Save'
                }]
            }, {
                module   : _src_code_LivePreview_mjs__WEBPACK_IMPORTED_MODULE_4__["default"],
                flex     : 3,
                language : 'markdown',
                listeners: {editorChange: 'onEditorChange'},
                reference: 'code-live-preview',
                style : {margin: '20px'}
            }, {
                module      : _src_component_Splitter_mjs__WEBPACK_IMPORTED_MODULE_7__["default"],
                direction   : 'horizontal',
                resizeTarget: 'previous',
                size        : 5
            }, {
                module: _src_container_Panel_mjs__WEBPACK_IMPORTED_MODULE_5__["default"],
                cls   : ['legit-commit-grid-panel'],
                flex  : 1,
                style : {margin: '20px'},
                headers: [{
                    dock: 'top',
                    text: 'Legit History'
                }],
                items : [{
                    module      : _CommitGrid_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
                    wrapperStyle: {minHeight: '200px'}
                }]
            }]
        }]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Viewport));


/***/ },

/***/ "./apps/legit/view/ViewportController.mjs"
/*!************************************************!*\
  !*** ./apps/legit/view/ViewportController.mjs ***!
  \************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_controller_Component_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../src/controller/Component.mjs */ "./src/controller/Component.mjs");
/* harmony import */ var _service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../service/Legit.mjs */ "./apps/legit/service/Legit.mjs");



/**
 * @class Legit.view.ViewportController
 * @extends Neo.controller.Component
 */
class ViewportController extends _src_controller_Component_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.view.ViewportController'
         * @protected
         */
        className: 'Legit.view.ViewportController',
        /**
         * @member {Number} pollingInterval=1000
         */
        pollingInterval: 1000
    }

    /**
     * @member {Neo.dialog.Base|null}
     */
    addDialog = null
    /**
     * @member {String} currentTreeState=null
     */
    currentTreeState = null
    /**
     * @member {Boolean} running=false
     */
    running = false

    /**
     * @returns {Promise<void>}
     */
    async initAsync() {
        await super.initAsync();

        const me = this;

        await _service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].ready();

        me.getReference('new-file-button').disabled = false;
        me.getReference('save-button')    .disabled = false;

        setInterval(me.poll.bind(me), me.pollingInterval)
    }

    /**
     * @param {Object} data
     */
    async onAddFileDialogSave(data) {
        const
            me        = this,
            dialog    = me.addDialog,
            textField = dialog.getReference('filename'),
            filePath  = `${_service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].path}/${textField.value}`;

        dialog.hide();

        console.log('onAddFileDialogSave', textField.value);
        await _service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].writeFile({
            data: '',
            path: filePath
        });

        me.setState({currentFile: filePath});
    }

    /**
     * @param {Object} data
     */
    onCommitColumnRenderer(data) {
        if (data.dataField === 'author') {
            return data.value.name;
        }

        if (data.dataField === 'timestamp') {
            return new Intl.DateTimeFormat('default', {
                hour: 'numeric',
                minute: 'numeric',
                second: 'numeric'
            }).format(new Date(data.value * 1000));
        }

        return data.value;
    }

    /**
     * @param {Record} record
     */
    onFileItemClick(record) {
        console.log('onFileItemClick', record)
    }

    /**
     * @param data
     * @returns {Promise<void>}
     */
    async onEditorChange(data) {
        // console.log('onEditorChange', data);
    }

    /**
     * @param data
     * @returns {Promise<void>}
     */
    async onNewFileButtonClick(data) {
        let me          = this,
            {addDialog} = me,
            button      = data.component,
            {appName, theme, windowId} = button;

        button.disabled = true;

        if (!addDialog) {
            Promise.all(/*! import() */[__webpack_require__.e("vendors-src_dialog_Base_mjs"), __webpack_require__.e("vendors-src_form_Container_mjs"), __webpack_require__.e("apps_legit_view_AddFileDialog_mjs")]).then(__webpack_require__.bind(__webpack_require__, /*! ./AddFileDialog.mjs */ "./apps/legit/view/AddFileDialog.mjs")).then(module => {
                me.addDialog = Neo.create({
                    module         : module.default,
                    animateTargetId: button.id,
                    appName,
                    listeners      : {hide: data => {button.disabled = false}},
                    parentComponent: me.component,
                    theme,
                    windowId
                })
            })
        } else {
            addDialog.show()
        }
    }

    /**
     * @param {Object} data
     */
    async onSaveButtonClick(data) {
        const
            me          = this,
            livePreview = me.getReference('code-live-preview'),
            currentFile = me.getState('currentFile');

        console.log('onSaveButtonClick', me.getState('currentFile'), livePreview.value);

        await _service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].writeFile({
            data: livePreview.value,
            path: `${_service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].path}/${currentFile}`
        });
    }

    /**
     * @param {Object}   data
     * @param {Record[]} data.records
     * @param {String[]} data.selection // selected dom node ids
     * @param {String}   data.source    // id of the event-firing instance
     */
    async onTreeListSelect({records}) {
        const
            livePreview = this.getReference('code-live-preview'),
            record      = records?.[0],
            language    = record.id.includes('.md') ? 'markdown' : 'neomjs';

        if (record?.isLeaf) {
            this.setState({currentFile: record.id});

            const value = await _service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].readFile(`${_service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].path}/${record.id}`, 'utf-8');

            await livePreview.set({language, value});
        }
    }

    /**
     * @returns {Promise<void>}
     */
    async poll() {
        let me = this;

        if (me.running) {
            return
        }

        try {
            me.running = true;

            let newState = await _service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].readFile(_service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].path + '/.legit/head', 'utf-8');

            if (me.currentTreeState === newState) {
                return;
            }

            const commitStore = me.getStore('commitStore');
            const fileStore   = me.getStore('fileStore');
            const treeDelta   = await _service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].loadTreeDelta(me.currentTreeState, newState);

            commitStore.data = await _service_Legit_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].loadHistory();

            console.log('TREE DELTA:', treeDelta);
            for (const deletedEntry of treeDelta.deleted) {
                console.log('Deleted FROM TREE: ' + deletedEntry);
                fileStore.remove(deletedEntry)
            }

            for (const addedEntry of treeDelta.added) {
                console.log('Added From Tree:' + addedEntry);
                fileStore.insert(0, {
                    id      : addedEntry,
                    name    : addedEntry,
                    parentId: null
                })
            }

            for (const modifiedEntry of treeDelta.modified) {
                // const newItem = await legitFs.readFile(path + '/' + addedEntry, 'utf8');
                // todo update item in tree store
                console.log('MODIFIED From Tree:' + modifiedEntry);
            }

            me.currentTreeState = newState;
        } finally {
            me.running = false;

            let selectionModel = me.getReference('files-tree').selectionModel;

            if (!selectionModel.hasSelection()) {
                selectionModel.selectAt(0)
            }
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(ViewportController));


/***/ },

/***/ "./apps/legit/view/ViewportStateProvider.mjs"
/*!***************************************************!*\
  !*** ./apps/legit/view/ViewportStateProvider.mjs ***!
  \***************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _store_Commits_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../store/Commits.mjs */ "./apps/legit/store/Commits.mjs");
/* harmony import */ var _store_Files_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../store/Files.mjs */ "./apps/legit/store/Files.mjs");
/* harmony import */ var _src_state_Provider_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../src/state/Provider.mjs */ "./src/state/Provider.mjs");




/**
 * @class Legit.view.ViewportStateProvider
 * @extends Neo.state.Provider
 */
class ViewportStateProvider extends _src_state_Provider_mjs__WEBPACK_IMPORTED_MODULE_2__["default"] {
    static config = {
        /**
         * @member {String} className='Legit.view.ViewportStateProvider'
         * @protected
         */
        className: 'Legit.view.ViewportStateProvider',
        /**
         * @member {Object} data
         */
        data: {
            /**
             * @member {String|null} data.currentFile=null
             */
            currentFile: null
        },
        /**
         * @member {Object} stores
         */
        stores: {
            commitStore: _store_Commits_mjs__WEBPACK_IMPORTED_MODULE_0__["default"],
            fileStore  : _store_Files_mjs__WEBPACK_IMPORTED_MODULE_1__["default"]
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(ViewportStateProvider));

/***/ },

/***/ "./src/component/Label.mjs"
/*!*********************************!*\
  !*** ./src/component/Label.mjs ***!
  \*********************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/component/Base.mjs");


/**
 * Convenience class to render a label with a text
 * @class Neo.component.Label
 * @extends Neo.component.Base
 */
class Label extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.component.Label'
         * @protected
         */
        className: 'Neo.component.Label',
        /**
         * @member {String} ntype='label'
         * @protected
         */
        ntype: 'label',
        /**
         * @member {String[]} baseCls=['neo-label']
         */
        baseCls: ['neo-label'],
        /**
         * @member {String} tag='label'
         * @protected
         * @reactive
         */
        tag: 'label'
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Label));


/***/ },

/***/ "./src/container/Panel.mjs"
/*!*********************************!*\
  !*** ./src/container/Panel.mjs ***!
  \*********************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/container/Base.mjs");
/* harmony import */ var _toolbar_Base_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../toolbar/Base.mjs */ "./src/toolbar/Base.mjs");



/**
 * An extended Container supporting multiple docked header toolbars
 * @class Neo.container.Panel
 * @extends Neo.container.Base
 */
class Panel extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.container.Panel'
         * @protected
         */
        className: 'Neo.container.Panel',
        /**
         * @member {String} ntype='panel'
         * @protected
         */
        ntype: 'panel',
        /**
         * @member {String[]} baseCls=['neo-panel','neo-container']
         */
        baseCls: ['neo-panel', 'neo-container'],
        /**
         * @member {Object} containerConfig=null
         */
        containerConfig: null,
        /**
         * @member {Object} headerDefaults=null
         */
        headerDefaults: null,
        /**
         * @member {Array} headers=null
         */
        headers: null,
        /**
         * @member {Object} items={ntype: 'vbox', align: 'stretch'}
         * @reactive
         */
        _layout: {
            ntype: 'vbox',
            align: 'stretch'
        },
        /**
         * @member {Boolean} verticalHeadersFirst=false
         */
        verticalHeadersFirst: false
    }

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me = this;

        if (me.hasHeaders() && me.verticalHeadersFirst === true) {
            me.layout = {
                ntype: 'hbox',
                align: 'stretch'
            };
        }
    }

    /**
     * @param {Object} header the header config
     * @returns {Object}
     */
    static createHeaderConfig(header) {
        if (Neo.typeOf(header) === 'NeoInstance') {
            return header;
        }

        let config = {
            flex: '0 1 auto'
        };

        if (!header.module && !header.ntype) {
            config.cls   = ['neo-panel-header-toolbar', 'neo-toolbar'];
            config.ntype = 'toolbar';
        }

        if (header.text) {
            config.items = [{
                ntype: 'label',
                cls  : ['neo-panel-header-text', 'neo-label'],
                text : header.text
            }];

            delete header.text;
        }

        // assuming all labels inside a Panel Header are meant to be titles -> look the same way
        if (Array.isArray(header.items)) {
            header.items.forEach(item => {
                if (item.ntype === 'label') {
                    item.cls = ['neo-panel-header-text', 'neo-label'];
                }
            });
        }

        return {...config, ...header}
    }

    /**
     *
     */
    createItems() {
        let me              = this,
            containerConfig = me.containerConfig;

        if (!me.hasHeaders()) {
            containerConfig && me.set(containerConfig);
            super.createItems();
        } else {
            let hf                   = me.verticalHeadersFirst === false,
                headers              = me.headers || [],
                bottomHeaders        = headers.filter(header => {return header.dock === (hf ?'bottom': 'right')}),
                leftHeaders          = headers.filter(header => {return header.dock === (hf ?'left'  : 'top')}),
                rightHeaders         = headers.filter(header => {return header.dock === (hf ?'right' : 'bottom')}),
                topHeaders           = headers.filter(header => {return header.dock === (hf ?'top'   : 'left')}),
                hasHorizontalHeaders = bottomHeaders.length > 0 || topHeaders  .length > 0,
                hasVerticalHeaders   = leftHeaders  .length > 0 || rightHeaders.length > 0,
                {items}              = me,
                horizontalItems      = [],
                verticalItems        = [],
                config;

            topHeaders.forEach(header => {
                verticalItems.push(Panel.createHeaderConfig(header))
            });

            if (hasVerticalHeaders && (hf && hasHorizontalHeaders || !hf && hasHorizontalHeaders)) {
                leftHeaders.forEach(header => {
                    horizontalItems.push(Panel.createHeaderConfig(header))
                });

                config = {
                    ntype       : 'container',
                    flex        : 1,
                    items,
                    itemDefaults: me.itemDefaults,
                    ...containerConfig
                };

                horizontalItems.push({...me.headerDefaults, ...config});

                rightHeaders.forEach(header => {
                    horizontalItems.push(Panel.createHeaderConfig(header))
                });

                verticalItems.push({
                    ntype    : 'container',
                    items    : horizontalItems,
                    layout   : {ntype: (hf ? 'hbox' : 'vbox'), align: 'stretch'},
                    reference: 'bodyContainer'
                });
            } else {
                config = {
                    ntype       : 'container',
                    flex        : 1,
                    items,
                    itemDefaults: me.itemDefaults,
                    reference   : 'bodyContainer',
                    ...containerConfig
                };

                verticalItems.push({...me.headerDefaults, ...config})
            }

            bottomHeaders.forEach(header => {
                verticalItems.push(Panel.createHeaderConfig(header))
            });

            me.items = verticalItems;

            me.itemDefaults = null;

            super.createItems()
        }
    }

    /**
     * @returns {Boolean}
     */
    hasHeaders() {
        return Array.isArray(this.headers) && this.headers.length > 0
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Panel));


/***/ },

/***/ "./src/container/Viewport.mjs"
/*!************************************!*\
  !*** ./src/container/Viewport.mjs ***!
  \************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/container/Base.mjs");


/**
 * @class Neo.container.Viewport
 * @extends Neo.container.Base
 */
class Viewport extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.container.Viewport'
         * @protected
         */
        className: 'Neo.container.Viewport',
        /**
         * @member {String} ntype='viewport'
         * @protected
         */
        ntype: 'viewport',
        /**
         * true applies 'neo-body-viewport' to the document.body
         * @member {Boolean} applyBodyCls=true
         */
        applyBodyCls: true,
        /**
         * Assuming that a Viewport is the top level view of your app, and you want to mount it right away.
         * Could be without any items. Use false otherwise.
         * @member {Boolean} autoMount=true
         */
        autoMount: true,
        /**
         * @member {String[]} baseCls=['neo-viewport']
         */
        baseCls: ['neo-viewport'],
        /**
         * true applies a main.addon.ResizeObserver and fires a custom resize event
         * which other instances can subscribe to.
         * @member {Boolean} monitorSize_=false
         * @reactive
         */
        monitorSize_: false
    }

    /**
     * Triggered after the mounted config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetMounted(value, oldValue) {
        super.afterSetMounted(value, oldValue);

        let me = this;

        if (value && me.monitorSize) {
            me.addDomListeners([{resize: me.onDomResize, scope: me}])
        }
    }

    /**
     *
     */
    onConstructed() {
        super.onConstructed();

        let {windowId} = this;

        this.applyBodyCls && Neo.main.DomAccess.applyBodyCls({
            cls: ['neo-body-viewport'],
            windowId
        })
    }

    /**
     * @param {Object} data
     */
    onDomResize(data) {
        this.fire('resize', data)
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Viewport));


/***/ },

/***/ "./src/controller/Component.mjs"
/*!**************************************!*\
  !*** ./src/controller/Component.mjs ***!
  \**************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/controller/Base.mjs");
/* harmony import */ var _util_Function_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Function.mjs */ "./src/util/Function.mjs");



/**
 * @class Neo.controller.Component
 * @extends Neo.controller.Base
 */
class Component extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.controller.Component'
         * @protected
         */
        className: 'Neo.controller.Component',
        /**
         * @member {String} ntype='component-controller'
         * @protected
         */
        ntype: 'component-controller',
        /**
         * @member {Neo.component.Base|null} component=null
         * @protected
         */
        component: null,
        /**
         * @member {Neo.controller.Component|null} parent_=null
         * @reactive
         */
        parent_: null,
        /**
         * @member {Object} references=null
         * @protected
         */
        references: null,
        /**
         * @member {String|null} windowId=null
         */
        windowId: null
    }

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me          = this,
            {component} = me;

        me.references = {};

        if (component.isConstructed) {
            me.onComponentConstructed()
        } else {
            component.on('constructed', () => {
                me.onComponentConstructed()
            }, me, {once: true})
        }
    }

    /**
     * Triggered before the parent config gets changed
     * @param {Neo.controller.Component|null} value
     * @param {Neo.controller.Component|null} oldValue
     * @protected
     */
    beforeSetParent(value, oldValue) {
        return value || this.getParent()
    }

    /**
     * @param {String} handlerName
     * @param {Neo.component.Base|null} [component]
     * @returns {Neo.controller.Component|Boolean|null}
     */
    getHandlerScope(handlerName, component) {
        let me       = this,
            {parent} = me,
            handlerCb;

        if (component) {
            // Look for ths function *name* first in the Component itself.
            // If we find it, return true so calling code knows not to continue to search.
            handlerCb = (0,_util_Function_mjs__WEBPACK_IMPORTED_MODULE_1__.resolveCallback)(handlerName, component);

            // Handler fn is resolved in the Component or its own parent chain.
            // Return a status indicating that we do not need an early binding
            if (handlerCb.fn) {
                return true
            }
        }

        return Neo.isFunction(me[handlerName]) ?
            me : parent?.getHandlerScope(handlerName) || null
    }

    /**
     * Get the closest controller inside the components parent tree
     * @returns {Neo.controller.Component|null}
     */
    getParent() {
        let me       = this,
            {parent} = me;

        if (parent) {
            return parent
        }

        return me.component.parent?.getController() || null
    }

    /**
     * todo: update changed references (e.g. container.remove() then container.add() using the same key)
     * @param {String} name
     * @returns {*}
     */
    getReference(name) {
        let me        = this,
            component = me.references[name];

        if (!component) {
            component = me.component.down({reference: name});

            if (component) {
                me.references[name] = component
            }
        }

        return component || null
    }

    /**
     * Convenience shortcut
     * @param args
     * @returns {*}
     */
    getState(...args) {
        return this.getStateProvider().getData(...args)
    }

    /**
     * sameLevelOnly=false will return the closest stateProvider inside the component parent tree,
     * in case there is none on the same level.
     * @param {Boolean} [sameLevelOnly=false]
     */
    getStateProvider(sameLevelOnly=false) {
        let {component} = this;
        return sameLevelOnly ? component.stateProvider : component.getStateProvider()
    }

    /**
     * Convenience shortcut for accessing state.Provider based data.Stores
     * @param {String} key
     * @returns {Neo.data.Store}
     */
    getStore(key) {
        return this.getStateProvider().getStore(key)
    }

    /**
     * Override this method inside your view controllers as a starting point in case you need references
     * (instead of using onConstructed() inside your controller)
     */
    onComponentConstructed() {}

    /**
     * Will get called by component.Base: destroy() in case the component has a reference config
     * @param {Neo.component.Base} component
     */
    removeReference(component) {
        let me           = this,
            {references} = me,
            key;

        for (key in references) {
            if (component === references[key]) {
                delete references[key];
                break
            }
        }

        me.getParent()?.removeReference(component)
    }

    /**
     * Convenience shortcut
     * @param args
     */
    setState(...args) {
        this.getStateProvider().setData(...args)
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Component));


/***/ },

/***/ "./src/toolbar/Base.mjs"
/*!******************************!*\
  !*** ./src/toolbar/Base.mjs ***!
  \******************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _button_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../button/Base.mjs */ "./src/button/Base.mjs");
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component/Base.mjs */ "./src/component/Base.mjs");
/* harmony import */ var _container_Base_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../container/Base.mjs */ "./src/container/Base.mjs");
/* harmony import */ var _component_Label_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../component/Label.mjs */ "./src/component/Label.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");






/**
 * @class Neo.toolbar.Base
 * @extends Neo.container.Base
 */
class Toolbar extends _container_Base_mjs__WEBPACK_IMPORTED_MODULE_2__["default"] {
    /**
     * Valid values for dock
     * @member {String[]} dockPositions=['top','right','bottom','left', null]
     * @static
     */
    static dockPositions = ['top', 'right', 'bottom', 'left', null]

    static config = {
        /**
         * @member {String} className='Neo.toolbar.Base'
         * @protected
         */
        className: 'Neo.toolbar.Base',
        /**
         * @member {String} ntype='toolbar'
         * @protected
         */
        ntype: 'toolbar',
        /**
         * @member {String[]} baseCls=['neo-toolbar']
         */
        baseCls: ['neo-toolbar'],
        /**
         * @member {String|null} dock_=null
         * @reactive
         */
        dock_: null,
        /**
         * @member {Object} itemDefaults={ntype:'button'}
         * @reactive
         */
        itemDefaults: {
            ntype: 'button'
        },
        /**
         * @member {Object} layout={ntype:'flexbox',align:'center',direction: 'row', pack:'start'}
         * @reactive
         */
        layout: {
            ntype    : 'flexbox',
            align    : 'center',
            direction: 'row',
            pack     : 'start'
        }
    }

    /**
     * Triggered after the dock config got changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetDock(value, oldValue) {
        if (!value && !oldValue) {
            return
        }

        let me            = this,
            {cls}         = me,
            dockPositions = me.getStaticConfig('dockPositions'),
            layoutConfig  = me.getLayoutConfig();

        dockPositions.forEach(key => {
            key !== null && _util_Array_mjs__WEBPACK_IMPORTED_MODULE_4__["default"].toggle(cls, 'neo-dock-' + key, key === value)
        });

        if (!me.layout) {
            layoutConfig.ntype = 'flexbox';
            me.set({cls, layout: layoutConfig})
        } else {
            me.layout.set(layoutConfig);
            me.cls = cls;
        }
    }

    /**
     * Checks if the new dock position matches a value of the static dockPositions config
     * @param {String} value
     * @param {String} oldValue
     * @returns {String} value
     * @protected
     */
    beforeSetDock(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'dock', 'dockPositions')
    }

    /**
     *
     */
    createItems() {
        let items = this._items;

        if (Array.isArray(items)) {
            this._items = items.map(item => this.replaceSpacer(item))
        }

        return super.createItems()
    }

    /**
     * Creates a layout config depending on this.dock
     * @returns {Object} layoutConfig
     */
    getLayoutConfig() {
        let me = this,
            layoutConfig;

        if (me.dock) {
            switch (me.dock) {
                case 'bottom':
                case 'top':
                    layoutConfig = {
                        align    : 'center',
                        direction: 'row',
                        pack     : 'start'
                    };
                    break
                case 'left':
                    layoutConfig = {
                        align    : 'center',
                        direction: 'column-reverse',
                        pack     : 'start'
                    };
                    break
                case 'right':
                    layoutConfig = {
                        align    : 'center',
                        direction: 'column',
                        pack     : 'start'
                    };
                    break
            }
        }

        return layoutConfig || me.layout
    }

    /**
     * Inserts an item or array of items at a specific index
     * @param {Number} index
     * @param {Array|Object} item
     * @param {Boolean} [silent=false]
     * @returns {Neo.component.Base|Neo.component.Base[]}
     */
    insert(index, item, silent=false) {
        if (Array.isArray(item)) {
            item = item.map(item => this.replaceSpacer(item))
        } else {
            item = this.replaceSpacer(item)
        }

        return super.insert(index, item, silent)
    }

    /**
     * @param {Array|Object|String} item
     * @returns {Array|Object}
     */
    replaceSpacer(item) {
        return item === '->' ? {module: _component_Base_mjs__WEBPACK_IMPORTED_MODULE_1__["default"], flex: 1} : item
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Toolbar));


/***/ }

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLWFwcHNfbGVnaXRfYXBwX21qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUEyQzs7QUFFcEM7QUFDUCxjQUFjLDBEQUFRO0FBQ3RCO0FBQ0EsQ0FBQyxFOzs7Ozs7Ozs7Ozs7Ozs7QUNMK0M7O0FBRWhEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLDJEQUFLO0FBQzFCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixVQUFVO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUEsaUVBQWUsc0JBQXNCLEVBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7QUNoQ1U7O0FBRWhEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDJEQUFLO0FBQ3hCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixVQUFVO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQSxpRUFBZSxvQkFBb0IsRUFBQzs7Ozs7Ozs7Ozs7Ozs7OztBQzFDVTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsMERBQUk7QUFDeEI7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakM7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakM7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxtQkFBbUIsYUFBYTtBQUNoQzs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBOztBQUVBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGlCQUFpQixtQkFBbUI7QUFDcEM7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0ZBQWdGLE9BQU87QUFDdkY7QUFDQSxVQUFVO0FBQ1YsOERBQThELE9BQU87QUFDckU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsaUJBQWlCLFNBQVMsNkJBQTZCLEdBQUc7QUFDMUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QixpQkFBaUIsU0FBUyx1REFBdUQsR0FBRztBQUNwRjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrREFBa0QsS0FBSyxHQUFHLElBQUk7O0FBRTlEO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCLGlCQUFpQixZQUFZO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixpQkFBaUIsbUJBQW1CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDBCQUEwQixRQUFRO0FBQ2xDO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSwwQkFBMEIsUUFBUTtBQUNsQztBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLCtGQUErRjtBQUMvRjtBQUNBLGtEQUFrRDtBQUNsRCxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCLGtCQUFrQjtBQUNsQjtBQUNBLHFEQUFxRDtBQUNyRDtBQUNBLDBCQUEwQixRQUFRO0FBQ2xDO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsdUdBQXVHO0FBQ3ZHO0FBQ0Esa0RBQWtEO0FBQ2xELHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEIsa0JBQWtCO0FBQ2xCO0FBQ0EscURBQXFEO0FBQ3JEO0FBQ0EsMEJBQTBCLFFBQVE7QUFDbEM7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixpQkFBaUIsaUJBQWlCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsZUFBZTtBQUM5QixlQUFlLGVBQWU7QUFDOUIsZUFBZSxlQUFlO0FBQzlCLGVBQWUsZUFBZTtBQUM5QixlQUFlLGVBQWU7QUFDOUIsaUJBQWlCO0FBQ2pCO0FBQ0EscUJBQXFCLHFDQUFxQztBQUMxRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpRUFBZSxxQkFBcUIsRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNwVVM7QUFDUTs7QUFFdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsMkRBQUs7QUFDM0I7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdCQUFnQjtBQUNwQztBQUNBLGVBQWUseURBQVc7QUFDMUI7QUFDQSxvQkFBb0IsVUFBVSxVQUFVLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBLGlFQUFlLHVCQUF1QixFQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztBQzVCRztBQUNVOztBQUVwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwyREFBSztBQUN6QjtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsZ0JBQWdCO0FBQ3BDO0FBQ0EsZUFBZSx1REFBUztBQUN4QjtBQUNBOztBQUVBLGlFQUFlLHFCQUFxQixFQUFDOzs7Ozs7Ozs7Ozs7Ozs7O0FDckJjOztBQUVuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QiwrREFBSTtBQUM3QjtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsVUFBVTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRLE1BQU07QUFDbEM7QUFDQSxlQUFlLDRCQUE0QjtBQUMzQztBQUNBLG9CQUFvQixRQUFRLGdCQUFnQjtBQUM1QztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxvQkFBb0IsVUFBVTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUEsaUVBQWUsMEJBQTBCLEVBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbkQ4QjtBQUNQO0FBQ1o7QUFDZTtBQUNFO0FBQ0Q7QUFDTjtBQUNTO0FBQ047QUFDTDtBQUNHOztBQUVoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixtRUFBWTtBQUNuQztBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsVUFBVTtBQUM5QjtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0Esb0JBQW9CLCtEQUFrQjtBQUN0QztBQUNBLG9CQUFvQixvQkFBb0I7QUFDeEM7QUFDQSx1QkFBdUIsbUVBQXFCO0FBQzVDO0FBQ0Esb0JBQW9CLFFBQVEsUUFBUTtBQUNwQztBQUNBLGlCQUFpQixnQ0FBZ0M7QUFDakQ7QUFDQSxvQkFBb0IsVUFBVTtBQUM5QjtBQUNBO0FBQ0Esd0NBQXdDLDBEQUFRO0FBQ2hELHlDQUF5QywwQkFBMEI7QUFDbkU7QUFDQSx5Q0FBeUMsNkRBQTZEO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCwwQkFBMEIsbUVBQVE7QUFDbEM7QUFDQTtBQUNBLFNBQVM7QUFDVCxvQkFBb0IsK0RBQVM7QUFDN0I7QUFDQSxxQkFBcUIsZ0NBQWdDO0FBQ3JEO0FBQ0Esd0JBQXdCLDZEQUFPO0FBQy9CO0FBQ0EseUJBQXlCLG9CQUFvQjtBQUM3QztBQUNBLCtCQUErQiw0REFBTTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLCtCQUErQiw0REFBTTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxtQkFBbUI7QUFDbkQ7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLDJCQUEyQixpRUFBVztBQUN0QztBQUNBO0FBQ0EsNEJBQTRCLCtCQUErQjtBQUMzRDtBQUNBLHlCQUF5QjtBQUN6QixhQUFhO0FBQ2IsOEJBQThCLG1FQUFRO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYix3QkFBd0IsZ0VBQUs7QUFDN0I7QUFDQTtBQUNBLHlCQUF5QixlQUFlO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGtDQUFrQyx1REFBVTtBQUM1QyxtQ0FBbUM7QUFDbkMsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTs7QUFFQSxpRUFBZSx3QkFBd0IsRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUM1R3lCO0FBQ2pCOztBQUVoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxxRUFBUztBQUMxQztBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFFBQVE7QUFDeEI7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFNBQVM7QUFDekI7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsY0FBYywwREFBWTs7QUFFMUI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiwwREFBWSxNQUFNLEdBQUcsZ0JBQWdCOztBQUVoRTs7QUFFQTtBQUNBLGNBQWMsMERBQVk7QUFDMUI7QUFDQTtBQUNBLFNBQVM7O0FBRVQscUJBQXFCLHNCQUFzQjtBQUMzQzs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYSxXQUFXO0FBQ3hCO0FBQ0EsYUFBYSwwQkFBMEI7O0FBRXZDOztBQUVBO0FBQ0EsWUFBWSw2VEFBNkI7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsZUFBZSx5QkFBeUI7QUFDOUU7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxjQUFjLDBEQUFZO0FBQzFCO0FBQ0EscUJBQXFCLDBEQUFZLE1BQU0sR0FBRyxZQUFZO0FBQ3RELFNBQVM7QUFDVDs7QUFFQTtBQUNBLGVBQWUsVUFBVTtBQUN6QixlQUFlLFVBQVU7QUFDekIsZUFBZSxVQUFVO0FBQ3pCLGVBQWUsVUFBVTtBQUN6QjtBQUNBLDRCQUE0QixRQUFRO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLHVCQUF1Qjs7QUFFbEQsZ0NBQWdDLDBEQUFZLGFBQWEsMERBQVksTUFBTSxHQUFHLFVBQVU7O0FBRXhGLG1DQUFtQyxnQkFBZ0I7QUFDbkQ7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsaUNBQWlDLDBEQUFZLFVBQVUsMERBQVk7O0FBRW5FO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esc0NBQXNDLDBEQUFZOztBQUVsRCxxQ0FBcUMsMERBQVk7O0FBRWpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxVQUFVO0FBQ1Y7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLGtDQUFrQyxFQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN0T0g7QUFDRjtBQUNhOztBQUUxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQywrREFBUTtBQUM1QztBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsYUFBYTtBQUNyQztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBLHlCQUF5QiwwREFBVztBQUNwQyx5QkFBeUIsd0RBQVM7QUFDbEM7QUFDQTtBQUNBOztBQUVBLGlFQUFlLHFDQUFxQyxFOzs7Ozs7Ozs7Ozs7Ozs7QUNsQ2pCOztBQUVuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGlEQUFTO0FBQzdCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFVBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLHFCQUFxQixFQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztBQ2hDRjtBQUNTOztBQUU1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGlEQUFTO0FBQzdCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFVBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE9BQU87QUFDM0I7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVEsT0FBTztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUEsZ0JBQWdCO0FBQ2hCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLGlFQUFpRSwrQ0FBK0M7QUFDaEgsaUVBQWlFLDZDQUE2QztBQUM5RyxpRUFBaUUsZ0RBQWdEO0FBQ2pILGlFQUFpRSw4Q0FBOEM7QUFDL0c7QUFDQTtBQUNBLGlCQUFpQixvQkFBb0I7QUFDckM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsc0NBQXNDLGdDQUFnQzs7QUFFdEU7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLGdEQUFnRDtBQUNoRjtBQUNBLGlCQUFpQjtBQUNqQixjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxvQ0FBb0MsZ0NBQWdDO0FBQ3BFOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLHFCQUFxQixFQUFDOzs7Ozs7Ozs7Ozs7Ozs7O0FDaE1GOztBQUVuQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixpREFBUztBQUNoQztBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixVQUFVO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxTQUFTO0FBQ3hCLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGlDQUFpQyxrQ0FBa0M7QUFDbkU7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGFBQWEsVUFBVTs7QUFFdkI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUVBQWUsd0JBQXdCLEVBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDaEZHO0FBQ1U7O0FBRXJEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGlEQUFJO0FBQzVCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHlCQUF5QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwrQkFBK0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhLFdBQVc7O0FBRXhCOztBQUVBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLGFBQWEsT0FBTyxXQUFXO0FBQy9CO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsK0JBQStCO0FBQzlDLGVBQWUsK0JBQStCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkIsZUFBZSx5QkFBeUI7QUFDeEMsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWEsUUFBUTtBQUNyQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsbUVBQWU7O0FBRXZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhLFFBQVE7O0FBRXJCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkNBQTJDLGdCQUFnQjs7QUFFM0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZUFBZSxTQUFTO0FBQ3hCO0FBQ0E7QUFDQSxhQUFhLFdBQVc7QUFDeEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLG9CQUFvQjtBQUNuQztBQUNBO0FBQ0E7QUFDQSxhQUFhLFlBQVk7QUFDekI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpRUFBZSx5QkFBeUIsRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNqTUU7QUFDRztBQUNBO0FBQ0M7QUFDTDs7QUFFMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsMkRBQVM7QUFDL0I7QUFDQTtBQUNBLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixVQUFVO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVEsY0FBYztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLG9CQUFvQixRQUFRLFFBQVE7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGFBQWEsYUFBYTtBQUMxQjtBQUNBOztBQUVBO0FBQ0EsNEJBQTRCLHVEQUFRO0FBQ3BDLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUMsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCLGlCQUFpQixRQUFRO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCLFFBQVE7QUFDekI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsZUFBZSxjQUFjO0FBQzdCLGVBQWUsU0FBUztBQUN4QixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxxQkFBcUI7QUFDcEMsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxnQ0FBZ0MsUUFBUSwyREFBUyxXQUFXO0FBQzVEO0FBQ0E7O0FBRUEsaUVBQWUsdUJBQXVCLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW8ubWpzLy4vYXBwcy9sZWdpdC9hcHAubWpzIiwid2VicGFjazovL25lby5tanMvLi9hcHBzL2xlZ2l0L21vZGVsL0NvbW1pdC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL2FwcHMvbGVnaXQvbW9kZWwvRmlsZS5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL2FwcHMvbGVnaXQvc2VydmljZS9MZWdpdC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL2FwcHMvbGVnaXQvc3RvcmUvQ29tbWl0cy5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL2FwcHMvbGVnaXQvc3RvcmUvRmlsZXMubWpzIiwid2VicGFjazovL25lby5tanMvLi9hcHBzL2xlZ2l0L3ZpZXcvQ29tbWl0R3JpZC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL2FwcHMvbGVnaXQvdmlldy9WaWV3cG9ydC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL2FwcHMvbGVnaXQvdmlldy9WaWV3cG9ydENvbnRyb2xsZXIubWpzIiwid2VicGFjazovL25lby5tanMvLi9hcHBzL2xlZ2l0L3ZpZXcvVmlld3BvcnRTdGF0ZVByb3ZpZGVyLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL2NvbXBvbmVudC9MYWJlbC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9jb250YWluZXIvUGFuZWwubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvY29udGFpbmVyL1ZpZXdwb3J0Lm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL2NvbnRyb2xsZXIvQ29tcG9uZW50Lm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL3Rvb2xiYXIvQmFzZS5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZpZXdwb3J0IGZyb20gJy4vdmlldy9WaWV3cG9ydC5tanMnO1xuXG5leHBvcnQgY29uc3Qgb25TdGFydCA9ICgpID0+IE5lby5hcHAoe1xuICAgIG1haW5WaWV3OiBWaWV3cG9ydCxcbiAgICBuYW1lICAgIDogJ0xlZ2l0J1xufSk7IiwiaW1wb3J0IE1vZGVsIGZyb20gJy4uLy4uLy4uL3NyYy9kYXRhL01vZGVsLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIExlZ2l0Lm1vZGVsLkNvbW1pdFxuICogQGV4dGVuZHMgTmVvLmRhdGEuTW9kZWxcbiAqL1xuY2xhc3MgQ29tbWl0IGV4dGVuZHMgTW9kZWwge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTGVnaXQubW9kZWwuQ29tbWl0J1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdMZWdpdC5tb2RlbC5Db21taXQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0W119IGZpZWxkc1xuICAgICAgICAgKi9cbiAgICAgICAgZmllbGRzOiBbe1xuICAgICAgICAgICAgbmFtZTogJ29pZCcsXG4gICAgICAgICAgICB0eXBlOiAnU3RyaW5nJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnbWVzc2FnZScsXG4gICAgICAgICAgICB0eXBlOiAnU3RyaW5nJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnYXV0aG9yJyxcbiAgICAgICAgICAgIHR5cGU6ICdPYmplY3QnXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICd0aW1lc3RhbXAnLFxuICAgICAgICAgICAgdHlwZTogJ0ludGVnZXInXG4gICAgICAgIH1dXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhDb21taXQpO1xuIiwiaW1wb3J0IE1vZGVsIGZyb20gJy4uLy4uLy4uL3NyYy9kYXRhL01vZGVsLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIExlZ2l0Lm1vZGVsLkZpbGVcbiAqIEBleHRlbmRzIE5lby5kYXRhLk1vZGVsXG4gKi9cbmNsYXNzIEZpbGUgZXh0ZW5kcyBNb2RlbCB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdMZWdpdC5tb2RlbC5GaWxlJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdMZWdpdC5tb2RlbC5GaWxlJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdFtdfSBmaWVsZHNcbiAgICAgICAgICovXG4gICAgICAgIGZpZWxkczogW3tcbiAgICAgICAgICAgIG5hbWU6ICdjbGFzc05hbWUnLFxuICAgICAgICAgICAgdHlwZTogJ1N0cmluZydcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ2NvbGxhcHNlZCcsXG4gICAgICAgICAgICB0eXBlOiAnQm9vbGVhbidcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ2hpZGRlbicsXG4gICAgICAgICAgICB0eXBlOiAnQm9vbGVhbidcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ2lkJyxcbiAgICAgICAgICAgIHR5cGU6ICdTdHJpbmcnXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWUgICAgICAgIDogJ2lzTGVhZicsXG4gICAgICAgICAgICB0eXBlICAgICAgICA6ICdCb29sZWFuJyxcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnbmFtZScsXG4gICAgICAgICAgICB0eXBlOiAnU3RyaW5nJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAncGFyZW50SWQnLFxuICAgICAgICAgICAgdHlwZTogJ1N0cmluZydcbiAgICAgICAgfV1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKEZpbGUpO1xuIiwiaW1wb3J0IEJhc2UgZnJvbSAnLi4vLi4vLi4vc3JjL2NvcmUvQmFzZS5tanMnO1xuXG4vKipcbiAqIEBzdW1tYXJ5IEEgc2luZ2xldG9uIHNlcnZpY2UgdGhhdCBwcm92aWRlcyBhIHZpcnR1YWwgZmlsZSBzeXN0ZW0gbGF5ZXIgZm9yIHRoZSBMZWdpdCBJREUuXG4gKlxuICogVGhpcyBzZXJ2aWNlIGFjdHMgYXMgdGhlIGNlbnRyYWwgaHViIGZvciBmaWxlIHN5c3RlbSBvcGVyYXRpb25zIHdpdGhpbiB0aGUgTGVnaXQgYXBwbGljYXRpb24uXG4gKiBJdCBhYnN0cmFjdHMgdGhlIHVuZGVybHlpbmcgc3RvcmFnZSBtZWNoYW5pc20gKHVzaW5nIGBtZW1mc2ApIGFuZCBwcm92aWRlcyBhIGdpdC1saWtlIGludGVyZmFjZVxuICogZm9yIGludGVyYWN0aW5nIHdpdGggZmlsZSB0cmVlcyBhbmQgY29tbWl0cyAodXNpbmcgYEBsZWdpdC1zZGsvY29yZWApLlxuICpcbiAqIEtleSByZXNwb25zaWJpbGl0aWVzIGluY2x1ZGU6XG4gKiAtICoqSW5pdGlhbGl6YXRpb246KiogRHluYW1pY2FsbHkgbG9hZGluZyBleHRlcm5hbCBkZXBlbmRlbmNpZXMgKGBtZW1mc2AsIGBAbGVnaXQtc2RrL2NvcmVgKSB0byBlbnN1cmUgdGhlIGFwcCByZW1haW5zIGxpZ2h0d2VpZ2h0IHVudGlsIG5lZWRlZC5cbiAqIC0gKipGaWxlIFN5c3RlbSBTZWVkaW5nOioqIFBvcHVsYXRpbmcgdGhlIGluLW1lbW9yeSBmaWxlIHN5c3RlbSB3aXRoIGluaXRpYWwgZGVtbyBjb250ZW50LlxuICogLSAqKkdpdCBPcGVyYXRpb25zOioqIFByb3ZpZGluZyBtZXRob2RzIHRvIGxvYWQgZmlsZSB0cmVlcyAoYGxvYWRUcmVlYCkgYW5kIGNhbGN1bGF0ZSBkZWx0YXMgYmV0d2VlbiBjb21taXRzIChgbG9hZFRyZWVEZWx0YWApLlxuICogLSAqKkZpbGUgSS9POioqIEV4cG9zaW5nIHN0YW5kYXJkIGZpbGUgc3lzdGVtIG1ldGhvZHMgKGByZWFkRmlsZWAsIGB3cml0ZUZpbGVgLCBgcmVhZGRpcmAsIGBzdGF0YCkgdGhhdCBhdXRvbWF0aWNhbGx5IGF3YWl0IHRoZSBzZXJ2aWNlJ3MgcmVhZHkgc3RhdGUuXG4gKlxuICogVGhpcyBzZXJ2aWNlIGlzIGRlc2lnbmVkIHRvIGJlIHJvYnVzdCBhZ2FpbnN0IGluaXRpYWxpemF0aW9uIGZhaWx1cmVzIGFuZCBwcm92aWRlcyBhIHNhZmUsIGFzeW5jaHJvbm91cyBBUEkgZm9yIHRoZSBgVmlld3BvcnRDb250cm9sbGVyYCB0byBjb25zdW1lLlxuICpcbiAqIEBjbGFzcyBMZWdpdC5zZXJ2aWNlLkxlZ2l0XG4gKiBAZXh0ZW5kcyBOZW8uY29yZS5CYXNlXG4gKiBAc2luZ2xldG9uXG4gKi9cbmNsYXNzIExlZ2l0IGV4dGVuZHMgQmFzZSB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdMZWdpdC5zZXJ2aWNlLkxlZ2l0J1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdMZWdpdC5zZXJ2aWNlLkxlZ2l0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdHxudWxsfSBmcz1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBmczogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdHxudWxsfSBsZWdpdEZzPW51bGxcbiAgICAgICAgICovXG4gICAgICAgIGxlZ2l0RnM6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IHBhdGg9Jy8ubGVnaXQvYnJhbmNoZXMvYW5vbnltb3VzJ1xuICAgICAgICAgKi9cbiAgICAgICAgcGF0aDogJy8ubGVnaXQvYnJhbmNoZXMvYW5vbnltb3VzJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IHNpbmdsZXRvbj10cnVlXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHNpbmdsZXRvbjogdHJ1ZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSBzZXJ2aWNlIGJ5IGR5bmFtaWNhbGx5IGltcG9ydGluZyBkZXBlbmRlbmNpZXMgYW5kIHNldHRpbmcgdXAgdGhlIGZpbGUgc3lzdGVtLlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICAgICAqL1xuICAgIGFzeW5jIGluaXRBc3luYygpIHtcbiAgICAgICAgYXdhaXQgc3VwZXIuaW5pdEFzeW5jKCk7XG5cbiAgICAgICAgY29uc3QgbWUgPSB0aGlzO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7b3BlbkxlZ2l0RnN9ID0gYXdhaXQgaW1wb3J0KC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8gJ2h0dHBzOi8vZXNtLnNoL0BsZWdpdC1zZGsvY29yZScpO1xuICAgICAgICAgICAgY29uc3QgZnNNb2R1bGUgICAgICA9IGF3YWl0IGltcG9ydCgvKiB3ZWJwYWNrSWdub3JlOiB0cnVlICovICdodHRwczovL2VzbS5zaC9tZW1mcycpO1xuXG4gICAgICAgICAgICBtZS5mcyA9IGZzTW9kdWxlLmRlZmF1bHQ7XG5cbiAgICAgICAgICAgIG1lLmxlZ2l0RnMgPSBhd2FpdCBvcGVuTGVnaXRGcyh7XG4gICAgICAgICAgICAgICAgc3RvcmFnZUZzOiBtZS5mcyxcbiAgICAgICAgICAgICAgICBnaXRSb290ICA6ICcvJyxcbiAgICAgICAgICAgICAgICBzZXJ2ZXJVcmw6ICdodHRwOi8vbG9jYWxob3N0Ojk5OTkvJyxcbiAgICAgICAgICAgICAgICAvLyBwdWJsaWNLZXk6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0xFR0lUX1BVQkxJQ19LRVksXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gRm9yIGRlYnVnZ2luZ1xuICAgICAgICAgICAgZ2xvYmFsVGhpcy5sZWdpdEZzID0gbWUubGVnaXRGcztcblxuICAgICAgICAgICAgYXdhaXQgbWUuI3NlZWRGaWxlU3lzdGVtKCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBpbml0aWFsaXplIExlZ2l0IFNlcnZpY2UnLCBlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyB0aGUgY29tbWl0IGhpc3RvcnkgZm9yIGEgZ2l2ZW4gYnJhbmNoLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbYnJhbmNoPSdhbm9ueW1vdXMnXSBUaGUgYnJhbmNoIG5hbWUgdG8gbG9hZCBoaXN0b3J5IGZvci5cbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3RbXT59IEFuIGFycmF5IG9mIGNvbW1pdCBvYmplY3RzLlxuICAgICAqL1xuICAgIGFzeW5jIGxvYWRIaXN0b3J5KGJyYW5jaD0nYW5vbnltb3VzJykge1xuICAgICAgICBhd2FpdCB0aGlzLnJlYWR5KCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGhpc3RvcnlKc29uID0gYXdhaXQgdGhpcy5sZWdpdEZzLnJlYWRGaWxlKGAvLmxlZ2l0L2JyYW5jaGVzLyR7YnJhbmNofS8ubGVnaXQvaGlzdG9yeWAsICd1dGYtOCcpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoaGlzdG9yeUpzb24pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEZhaWxlZCB0byBsb2FkIGhpc3RvcnkgZm9yIGJyYW5jaCAke2JyYW5jaH1gLCBlKTtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlY3Vyc2l2ZWx5IGxvYWRzIHRoZSBmaWxlIHRyZWUgc3RydWN0dXJlIGZyb20gYSBnaXZlbiBwYXRoLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0cmVlUGF0aCBUaGUgcGF0aCB0byBzdGFydCBsb2FkaW5nIHRoZSB0cmVlIGZyb20uXG4gICAgICogQHJldHVybnMge1Byb21pc2U8e2hhc2g6IHN0cmluZywgc3ViRW50cmllczoge319Pn0gVGhlIHRyZWUgc3RydWN0dXJlIHdpdGggaGFzaGVzLlxuICAgICAqL1xuICAgIGFzeW5jIGxvYWRUcmVlKHRyZWVQYXRoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVhZHkoKTtcblxuICAgICAgICBjb25zdFxuICAgICAgICAgICAgbWUgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBzdWJFbnRyaWVzID0ge30sXG4gICAgICAgICAgICBwYXRoRW50cmllcyA9IGF3YWl0IG1lLnJlYWRkaXIodHJlZVBhdGgpO1xuXG4gICAgICAgIGZvciAoY29uc3QgZW50cnlOYW1lIG9mIHBhdGhFbnRyaWVzKSB7XG4gICAgICAgICAgICBjb25zdCBzdGF0ID0gYXdhaXQgbWUuc3RhdCh0cmVlUGF0aCArIGVudHJ5TmFtZSk7XG5cbiAgICAgICAgICAgIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICAgICAgICBzdWJFbnRyaWVzW2VudHJ5TmFtZV0gPSBhd2FpdCBtZS5sb2FkVHJlZSh0cmVlUGF0aCArIGVudHJ5TmFtZSArICcvJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbkhhc2ggPSBhd2FpdCBjcnlwdG8uc3VidGxlLmRpZ2VzdChcIlNIQS0xXCIsIGF3YWl0IG1lLnJlYWRGaWxlKHRyZWVQYXRoICsgZW50cnlOYW1lKSk7XG5cbiAgICAgICAgICAgICAgICBzdWJFbnRyaWVzW2VudHJ5TmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciBub3cgaXRzIHRoZSBjb250ZW50IGluc3RlYWQgb2YgdGhlIGhhc2hcbiAgICAgICAgICAgICAgICAgICAgaGFzaDogY29udGVuSGFzaCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZW50cnlOYW1lLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaGFzaDogJycsXG4gICAgICAgICAgICBzdWJFbnRyaWVzXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGVzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gdHdvIHRyZWUgc3RhdGVzIChjb21taXRzKS5cbiAgICAgKiBVc2VmdWwgZm9yIGlkZW50aWZ5aW5nIGFkZGVkLCBkZWxldGVkLCBhbmQgbW9kaWZpZWQgZmlsZXMuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGN1cnJlbnRTdGF0ZSBUaGUgaGFzaCBvciBwYXRoIG9mIHRoZSBjdXJyZW50IHN0YXRlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuZXdTdGF0ZSBUaGUgaGFzaCBvciBwYXRoIG9mIHRoZSBuZXcgc3RhdGUuXG4gICAgICogQHJldHVybnMge1Byb21pc2U8e2RlbGV0ZWQ6IFN0cmluZ1tdLCBhZGRlZDogU3RyaW5nW10sIG1vZGlmaWVkOiBTdHJpbmdbXX0+fSBBbiBvYmplY3QgY29udGFpbmluZyBhcnJheXMgb2YgY2hhbmdlZCBmaWxlIHBhdGhzLlxuICAgICAqL1xuICAgIGFzeW5jIGxvYWRUcmVlRGVsdGEoY3VycmVudFN0YXRlLCBuZXdTdGF0ZSkge1xuICAgICAgICBhd2FpdCB0aGlzLnJlYWR5KCk7XG5cbiAgICAgICAgY29uc3QgbWUgPSB0aGlzO1xuXG4gICAgICAgIGNvbnN0IHByZWZpeE5ld1N0YXRlID0gbmV3U3RhdGUuc2xpY2UoMCwgMik7XG4gICAgICAgIGNvbnN0IHN1ZmZpeE5ld1N0YXRlID0gbmV3U3RhdGUuc2xpY2UoMik7XG5cbiAgICAgICAgbGV0IGN1cnJlbnRzdGF0ZVRyZWUgPSB7fVxuXG4gICAgICAgIGlmIChjdXJyZW50U3RhdGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHByZWZpeEN1cnJlbnRTdGF0ZSA9IGN1cnJlbnRTdGF0ZS5zbGljZSgwLCAyKTtcbiAgICAgICAgICAgIGNvbnN0IHN1ZmZpeEN1cnJlbnRTdGF0ZSA9IGN1cnJlbnRTdGF0ZS5zbGljZSgyKTtcblxuICAgICAgICAgICAgY3VycmVudHN0YXRlVHJlZSA9IGF3YWl0IG1lLmxvYWRUcmVlKCcvLmxlZ2l0L2NvbW1pdHMvJyArIHByZWZpeEN1cnJlbnRTdGF0ZSArICcvJyArIHN1ZmZpeEN1cnJlbnRTdGF0ZSArICcvJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3U3RhdGVUcmVlID0gYXdhaXQgbWUubG9hZFRyZWUoJy8ubGVnaXQvY29tbWl0cy8nICsgcHJlZml4TmV3U3RhdGUgKyAnLycgKyBzdWZmaXhOZXdTdGF0ZSArICcvJyk7XG5cbiAgICAgICAgY29uc3QgZGVsZXRlZCAgPSBbXTtcbiAgICAgICAgY29uc3QgYWRkZWQgICAgPSBbXTtcbiAgICAgICAgY29uc3QgbW9kaWZpZWQgPSBbXTtcblxuICAgICAgICBmdW5jdGlvbiBmbGF0dGVuVHJlZSh0cmVlLCBwYXRoID0gJycpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuXG4gICAgICAgICAgICBpZiAodHJlZS5zdWJFbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXModHJlZS5zdWJFbnRyaWVzKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UGF0aCA9IHBhdGggPyBgJHtwYXRofS8ke2tleX1gIDoga2V5O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zdWJFbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgZmxhdHRlblRyZWUodmFsdWUsIGN1cnJlbnRQYXRoKSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbY3VycmVudFBhdGhdID0gdmFsdWUuaGFzaDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRTdGF0ZUZsYXQgPSBjdXJyZW50U3RhdGUgIT09ICcnID8gZmxhdHRlblRyZWUoY3VycmVudHN0YXRlVHJlZSkgOiB7fTtcbiAgICAgICAgY29uc3QgbmV3U3RhdGVGbGF0ICAgICA9IGZsYXR0ZW5UcmVlKG5ld1N0YXRlVHJlZSk7XG5cbiAgICAgICAgLy8gRmluZCBkZWxldGVkIChpbiBjdXJyZW50IGJ1dCBub3QgaW4gbmV3KVxuICAgICAgICBmb3IgKGNvbnN0IHBhdGggaW4gY3VycmVudFN0YXRlRmxhdCkge1xuICAgICAgICAgICAgaWYgKCEocGF0aCBpbiBuZXdTdGF0ZUZsYXQpKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlZC5wdXNoKHBhdGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmluZCBhZGRlZCAoaW4gbmV3IGJ1dCBub3QgaW4gY3VycmVudClcbiAgICAgICAgZm9yIChjb25zdCBwYXRoIGluIG5ld1N0YXRlRmxhdCkge1xuICAgICAgICAgICAgaWYgKCEocGF0aCBpbiBjdXJyZW50U3RhdGVGbGF0KSkge1xuICAgICAgICAgICAgICAgIGFkZGVkLnB1c2gocGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaW5kIG1vZGlmaWVkIChpbiBib3RoIGJ1dCBoYXNoIGRpZmZlcnMpXG4gICAgICAgIGZvciAoY29uc3QgcGF0aCBpbiBuZXdTdGF0ZUZsYXQpIHtcbiAgICAgICAgICAgIGlmIChwYXRoIGluIGN1cnJlbnRTdGF0ZUZsYXQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SGFzaCA9IG5ldyBVaW50OEFycmF5KGN1cnJlbnRTdGF0ZUZsYXRbcGF0aF0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0hhc2ggICAgID0gbmV3IFVpbnQ4QXJyYXkobmV3U3RhdGVGbGF0W3BhdGhdKTtcblxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50SGFzaC5sZW5ndGggIT09IG5ld0hhc2gubGVuZ3RoIHx8XG4gICAgICAgICAgICAgICAgICAgICFjdXJyZW50SGFzaC5ldmVyeSgoYnl0ZSwgaSkgPT4gYnl0ZSA9PT0gbmV3SGFzaFtpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWQucHVzaChwYXRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGVsZXRlZCxcbiAgICAgICAgICAgIGFkZGVkLFxuICAgICAgICAgICAgbW9kaWZpZWRcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlYWRzIHRoZSBjb250ZW50IG9mIGEgZmlsZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGF0aCBUaGUgZmlsZSBwYXRoLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gUmVhZCBvcHRpb25zLlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPCo+fSBUaGUgZmlsZSBjb250ZW50LlxuICAgICAqL1xuICAgIGFzeW5jIHJlYWRGaWxlKHBhdGgsIG9wdGlvbnMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5yZWFkeSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5sZWdpdEZzLnJlYWRGaWxlKHBhdGgsIG9wdGlvbnMpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVhZHMgdGhlIGNvbnRlbnRzIG9mIGEgZGlyZWN0b3J5LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoIFRoZSBkaXJlY3RvcnkgcGF0aC5cbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxTdHJpbmdbXT59IEFuIGFycmF5IG9mIGZpbGUgbmFtZXMuXG4gICAgICovXG4gICAgYXN5bmMgcmVhZGRpcihwYXRoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVhZHkoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVnaXRGcy5yZWFkZGlyKHBhdGgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VlZHMgdGhlIGluLW1lbW9yeSBmaWxlIHN5c3RlbSB3aXRoIGluaXRpYWwgZGVtbyBjb250ZW50LlxuICAgICAqIFRoaXMgbWV0aG9kIGJ5cGFzc2VzIHRoZSBgcmVhZHkoKWAgY2hlY2sgdG8gYXZvaWQgZGVhZGxvY2tzIGR1cmluZyBpbml0aWFsaXphdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGFzeW5jICNzZWVkRmlsZVN5c3RlbSgpIHtcbiAgICAgICAgY29uc3QgbWUgPSB0aGlzO1xuXG4gICAgICAgIGxldCBtZEZpbGUgPSBhd2FpdCBmZXRjaCgnLi4vLi4vbGVhcm4vYmVuZWZpdHMvRm9ybXNFbmdpbmUubWQnKTtcbiAgICAgICAgbWRGaWxlID0gYXdhaXQgbWRGaWxlLnRleHQoKTtcblxuICAgICAgICBhd2FpdCBtZS53cml0ZUZpbGUoe1xuICAgICAgICAgICAgZGF0YSAgICAgOiBtZEZpbGUsXG4gICAgICAgICAgICBwYXRoICAgICA6IGAke21lLnBhdGh9L0Zvcm1zRW5naW5lLm1kYCxcbiAgICAgICAgICAgIHNraXBSZWFkeTogdHJ1ZVxuICAgICAgICB9KTtcblxuICAgICAgICBtZEZpbGUgPSBhd2FpdCBmZXRjaCgnLi4vLi4vbGVhcm4vYmVuZWZpdHMvT2ZmVGhlTWFpblRocmVhZC5tZCcpO1xuICAgICAgICBtZEZpbGUgPSBhd2FpdCBtZEZpbGUudGV4dCgpO1xuXG4gICAgICAgIGF3YWl0IG1lLndyaXRlRmlsZSh7XG4gICAgICAgICAgICBkYXRhICAgICA6IG1kRmlsZSxcbiAgICAgICAgICAgIHBhdGggICAgIDogYCR7bWUucGF0aH0vT2ZmVGhlTWFpblRocmVhZC5tZGAsXG4gICAgICAgICAgICBza2lwUmVhZHk6IHRydWVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXdhaXQgbWUud3JpdGVGaWxlKHtcbiAgICAgICAgICAgIGRhdGE6IFtcbiAgICAgICAgICAgICAgICBcImltcG9ydCBWaWV3cG9ydCBmcm9tICcuLi8uLi9leGFtcGxlcy9jb21wb25lbnQvbXVsdGlXaW5kb3dIZWxpeC9WaWV3cG9ydC5tanMnO1wiLFxuICAgICAgICAgICAgICAgIFwiXCIsXG4gICAgICAgICAgICAgICAgXCJjbGFzcyBNYWluVmlldyBleHRlbmRzIFZpZXdwb3J0IHtcIixcbiAgICAgICAgICAgICAgICBcIiAgICBzdGF0aWMgY29uZmlnID0ge1wiLFxuICAgICAgICAgICAgICAgIFwiICAgICAgICBjbGFzc05hbWUgICAgICAgICAgIDogJ1BvcnRhbC52aWV3Lk11bHRpV2luZG93SGVsaXgnLFwiLFxuICAgICAgICAgICAgICAgIFwiICAgICAgICBzaG93R2l0SHViU3RhckJ1dHRvbjogZmFsc2UsXCIsXG4gICAgICAgICAgICAgICAgXCIgICAgICAgIHRoZW1lICAgICAgICAgICAgICAgOiAnbmVvLXRoZW1lLWRhcmsnXCIsXG4gICAgICAgICAgICAgICAgXCIgICAgfVwiLFxuICAgICAgICAgICAgICAgIFwifVwiLFxuICAgICAgICAgICAgICAgIFwiXCIsXG4gICAgICAgICAgICAgICAgXCJNYWluVmlldyA9IE5lby5zZXR1cENsYXNzKE1haW5WaWV3KTtcIlxuICAgICAgICAgICAgXS5qb2luKCdcXG4nKSxcbiAgICAgICAgICAgIHBhdGggICAgIDogYCR7bWUucGF0aH0vSGVsaXgubWpzYCxcbiAgICAgICAgICAgIHNraXBSZWFkeTogdHJ1ZVxuICAgICAgICB9KTtcblxuICAgICAgICBhd2FpdCBtZS53cml0ZUZpbGUoe1xuICAgICAgICAgICAgZGF0YTogW1xuICAgICAgICAgICAgICAgIFwiaW1wb3J0IFZpZXdwb3J0IGZyb20gJy4uLy4uL2V4YW1wbGVzL2NvbXBvbmVudC9tdWx0aVdpbmRvd0Nvcm9uYUdhbGxlcnkvVmlld3BvcnQubWpzJztcIixcbiAgICAgICAgICAgICAgICBcIlwiLFxuICAgICAgICAgICAgICAgIFwiY2xhc3MgTWFpblZpZXcgZXh0ZW5kcyBWaWV3cG9ydCB7XCIsXG4gICAgICAgICAgICAgICAgXCIgICAgc3RhdGljIGNvbmZpZyA9IHtcIixcbiAgICAgICAgICAgICAgICBcIiAgICAgICAgY2xhc3NOYW1lICAgICAgICAgICA6ICdQb3J0YWwudmlldy5NdWx0aVdpbmRvd0hlbGl4JyxcIixcbiAgICAgICAgICAgICAgICBcIiAgICAgICAgc2hvd0dpdEh1YlN0YXJCdXR0b246IGZhbHNlLFwiLFxuICAgICAgICAgICAgICAgIFwiICAgICAgICB0aGVtZSAgICAgICAgICAgICAgIDogJ25lby10aGVtZS1kYXJrJ1wiLFxuICAgICAgICAgICAgICAgIFwiICAgIH1cIixcbiAgICAgICAgICAgICAgICBcIn1cIixcbiAgICAgICAgICAgICAgICBcIlwiLFxuICAgICAgICAgICAgICAgIFwiTWFpblZpZXcgPSBOZW8uc2V0dXBDbGFzcyhNYWluVmlldyk7XCJcbiAgICAgICAgICAgIF0uam9pbignXFxuJyksXG4gICAgICAgICAgICBwYXRoICAgICA6IGAke21lLnBhdGh9L0dhbGxlcnkubWpzYCxcbiAgICAgICAgICAgIHNraXBSZWFkeTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgZmlsZSBzdGF0aXN0aWNzLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoIFRoZSBmaWxlIG9yIGRpcmVjdG9yeSBwYXRoLlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IFRoZSBmaWxlIHN0YXRpc3RpY3Mgb2JqZWN0LlxuICAgICAqL1xuICAgIGFzeW5jIHN0YXQocGF0aCkge1xuICAgICAgICBhd2FpdCB0aGlzLnJlYWR5KCk7XG4gICAgICAgIHJldHVybiB0aGlzLmxlZ2l0RnMuc3RhdChwYXRoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdyaXRlcyBkYXRhIHRvIGEgZmlsZS5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gICAgICAgIGNvbmZpZyBDb25maWd1cmF0aW9uIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xCdWZmZXJ9IGNvbmZpZy5kYXRhIFRoZSBkYXRhIHRvIHdyaXRlLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgW2NvbmZpZy5vcHRpb25zXSBXcml0ZSBvcHRpb25zLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSAgICAgICAgY29uZmlnLnBhdGggVGhlIGZpbGUgcGF0aC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59ICAgICAgIFtjb25maWcuc2tpcFJlYWR5PWZhbHNlXSBJZiB0cnVlLCBieXBhc3NlcyB0aGUgYGF3YWl0IHRoaXMucmVhZHkoKWAgY2hlY2suXG4gICAgICogQHJldHVybnMge1Byb21pc2U8Kj59XG4gICAgICovXG4gICAgYXN5bmMgd3JpdGVGaWxlKHtkYXRhLCBvcHRpb25zLCBwYXRoLCBza2lwUmVhZHk9ZmFsc2V9KSB7XG4gICAgICAgICFza2lwUmVhZHkgJiYgYXdhaXQgdGhpcy5yZWFkeSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5sZWdpdEZzLndyaXRlRmlsZShwYXRoLCBkYXRhLCBvcHRpb25zKVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoTGVnaXQpO1xuIiwiaW1wb3J0IENvbW1pdE1vZGVsIGZyb20gJy4uL21vZGVsL0NvbW1pdC5tanMnO1xuaW1wb3J0IFN0b3JlICAgICAgIGZyb20gJy4uLy4uLy4uL3NyYy9kYXRhL1N0b3JlLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIExlZ2l0LnN0b3JlLkNvbW1pdHNcbiAqIEBleHRlbmRzIE5lby5kYXRhLlN0b3JlXG4gKi9cbmNsYXNzIENvbW1pdHMgZXh0ZW5kcyBTdG9yZSB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdMZWdpdC5zdG9yZS5Db21taXRzJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdMZWdpdC5zdG9yZS5Db21taXRzJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge05lby5kYXRhLk1vZGVsfSBtb2RlbD1Db21taXRNb2RlbFxuICAgICAgICAgKi9cbiAgICAgICAgbW9kZWw6IENvbW1pdE1vZGVsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0W119IHNvcnRlcnM9W3twcm9wZXJ0eTondGltZXN0YW1wJyxkaXJlY3Rpb246J0RFU0MnfV1cbiAgICAgICAgICovXG4gICAgICAgIHNvcnRlcnM6IFt7XG4gICAgICAgICAgICBwcm9wZXJ0eSA6ICd0aW1lc3RhbXAnLFxuICAgICAgICAgICAgZGlyZWN0aW9uOiAnREVTQydcbiAgICAgICAgfV1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKENvbW1pdHMpO1xuIiwiaW1wb3J0IEZpbGVNb2RlbCBmcm9tICcuLi9tb2RlbC9GaWxlLm1qcyc7XG5pbXBvcnQgU3RvcmUgICAgIGZyb20gJy4uLy4uLy4uL3NyYy9kYXRhL1N0b3JlLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIExlZ2l0LnN0b3JlLkZpbGVzXG4gKiBAZXh0ZW5kcyBOZW8uZGF0YS5TdG9yZVxuICovXG5jbGFzcyBGaWxlcyBleHRlbmRzIFN0b3JlIHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J0xlZ2l0LnN0b3JlLkZpbGVzJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdMZWdpdC5zdG9yZS5GaWxlcycsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uZGF0YS5Nb2RlbH0gbW9kZWw9RmlsZU1vZGVsXG4gICAgICAgICAqL1xuICAgICAgICBtb2RlbDogRmlsZU1vZGVsXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhGaWxlcyk7XG4iLCJpbXBvcnQgR3JpZCBmcm9tICcuLi8uLi8uLi9zcmMvZ3JpZC9Db250YWluZXIubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTGVnaXQudmlldy5Db21taXRHcmlkXG4gKiBAZXh0ZW5kcyBOZW8uZ3JpZC5Db250YWluZXJcbiAqL1xuY2xhc3MgQ29tbWl0R3JpZCBleHRlbmRzIEdyaWQge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTGVnaXQudmlldy5Db21taXRHcmlkJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdMZWdpdC52aWV3LkNvbW1pdEdyaWQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nW119IGJhc2VDbHM9WydsZWdpdC1jb21taXQtZ3JpZCcsJ25lby1ncmlkLWNvbnRhaW5lciddXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGJhc2VDbHM6IFsnbGVnaXQtY29tbWl0LWdyaWQnLCAnbmVvLWdyaWQtY29udGFpbmVyJ10sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGJpbmQ9e3N0b3JlOidzdG9yZXMuY29tbWl0U3RvcmUnfVxuICAgICAgICAgKi9cbiAgICAgICAgYmluZDoge3N0b3JlOiAnc3RvcmVzLmNvbW1pdFN0b3JlJ30sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGNvbHVtbkRlZmF1bHRzPXtyZW5kZXJlcjonb25Db21taXRDb2x1bW5SZW5kZXJlcid9XG4gICAgICAgICAqL1xuICAgICAgICBjb2x1bW5EZWZhdWx0czoge1xuICAgICAgICAgICAgcmVuZGVyZXI6ICdvbkNvbW1pdENvbHVtblJlbmRlcmVyJ1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0W119IGNvbHVtbnNcbiAgICAgICAgICovXG4gICAgICAgIGNvbHVtbnM6IFt7XG4gICAgICAgICAgICBkYXRhRmllbGQ6ICd0aW1lc3RhbXAnLFxuICAgICAgICAgICAgdGV4dCAgICAgOiAnVGltZXN0YW1wJyxcbiAgICAgICAgICAgIHdpZHRoICAgIDogMTUwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGRhdGFGaWVsZDogJ2F1dGhvcicsXG4gICAgICAgICAgICB0ZXh0ICAgICA6ICdBdXRob3InLFxuICAgICAgICAgICAgd2lkdGggICAgOiAxNTBcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgZGF0YUZpZWxkOiAnbWVzc2FnZScsXG4gICAgICAgICAgICB0ZXh0ICAgICA6ICdNZXNzYWdlJyxcbiAgICAgICAgICAgIGZsZXggICAgIDogMVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBkYXRhRmllbGQ6ICdvaWQnLFxuICAgICAgICAgICAgdGV4dCAgICAgOiAnT0lEJyxcbiAgICAgICAgICAgIHdpZHRoICAgIDogMzAwXG4gICAgICAgIH1dXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhDb21taXRHcmlkKTtcbiIsImltcG9ydCBCYXNlVmlld3BvcnQgICAgICAgICAgZnJvbSAnLi4vLi4vLi4vc3JjL2NvbnRhaW5lci9WaWV3cG9ydC5tanMnO1xuaW1wb3J0IEJ1dHRvbiAgICAgICAgICAgICAgICBmcm9tICcuLi8uLi8uLi9zcmMvYnV0dG9uL0Jhc2UubWpzJztcbmltcG9ydCBDb21taXRHcmlkICAgICAgICAgICAgZnJvbSAnLi9Db21taXRHcmlkLm1qcyc7XG5pbXBvcnQgQ29udGFpbmVyICAgICAgICAgICAgIGZyb20gJy4uLy4uLy4uL3NyYy9jb250YWluZXIvQmFzZS5tanMnO1xuaW1wb3J0IExpdmVQcmV2aWV3ICAgICAgICAgICBmcm9tICcuLi8uLi8uLi9zcmMvY29kZS9MaXZlUHJldmlldy5tanMnO1xuaW1wb3J0IFBhbmVsICAgICAgICAgICAgICAgICBmcm9tICcuLi8uLi8uLi9zcmMvY29udGFpbmVyL1BhbmVsLm1qcyc7XG5pbXBvcnQgVHJlZUxpc3QgICAgICAgICAgICAgIGZyb20gJy4uLy4uLy4uL3NyYy90cmVlL0xpc3QubWpzJztcbmltcG9ydCBTcGxpdHRlciAgICAgICAgICAgICAgZnJvbSAnLi4vLi4vLi4vc3JjL2NvbXBvbmVudC9TcGxpdHRlci5tanMnO1xuaW1wb3J0IFRvb2xiYXIgICAgICAgICAgICAgICBmcm9tICcuLi8uLi8uLi9zcmMvdG9vbGJhci9CYXNlLm1qcyc7XG5pbXBvcnQgVmlld3BvcnRDb250cm9sbGVyICAgIGZyb20gJy4vVmlld3BvcnRDb250cm9sbGVyLm1qcyc7XG5pbXBvcnQgVmlld3BvcnRTdGF0ZVByb3ZpZGVyIGZyb20gJy4vVmlld3BvcnRTdGF0ZVByb3ZpZGVyLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIExlZ2l0LnZpZXcuVmlld3BvcnRcbiAqIEBleHRlbmRzIE5lby5jb250YWluZXIuVmlld3BvcnRcbiAqL1xuY2xhc3MgVmlld3BvcnQgZXh0ZW5kcyBCYXNlVmlld3BvcnQge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTGVnaXQudmlldy5WaWV3cG9ydCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTGVnaXQudmlldy5WaWV3cG9ydCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmdbXX0gY2xzPVsnbGVnaXQtdmlld3BvcnQnXVxuICAgICAgICAgKi9cbiAgICAgICAgY2xzOiBbJ2xlZ2l0LXZpZXdwb3J0J10sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uY29udHJvbGxlci5Db21wb25lbnR9IGNvbnRyb2xsZXI9Vmlld3BvcnRDb250cm9sbGVyXG4gICAgICAgICAqL1xuICAgICAgICBjb250cm9sbGVyOiBWaWV3cG9ydENvbnRyb2xsZXIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uc3RhdGUuUHJvdmlkZXJ9IHN0YXRlUHJvdmlkZXI9Vmlld3BvcnRTdGF0ZVByb3ZpZGVyXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0ZVByb3ZpZGVyOiBWaWV3cG9ydFN0YXRlUHJvdmlkZXIsXG4gICAgICAgIC8qXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdH0gbGF5b3V0PXtudHlwZTonaGJveCcsYWxpZ246J3N0cmV0Y2gnfVxuICAgICAgICAgKi9cbiAgICAgICAgbGF5b3V0OiB7bnR5cGU6ICdoYm94JywgYWxpZ246ICdzdHJldGNoJ30sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3RbXX0gaXRlbXNcbiAgICAgICAgICovXG4gICAgICAgIGl0ZW1zOiBbe1xuICAgICAgICAgICAgbW9kdWxlICAgICAgICAgICAgICAgICAgICA6IFRyZWVMaXN0LFxuICAgICAgICAgICAgYmluZCAgICAgICAgICAgICAgICAgICAgICA6IHtzdG9yZTogJ3N0b3Jlcy5maWxlU3RvcmUnfSxcbiAgICAgICAgICAgIGNscyAgICAgICAgICAgICAgICAgICAgICAgOiBbJ2xlZ2l0LWZpbGVzLXRyZWUnXSxcbiAgICAgICAgICAgIGxpc3RlbmVycyAgICAgICAgICAgICAgICAgOiB7bGVhZkl0ZW1DbGljazogJ29uRmlsZUl0ZW1DbGljaycsIHNlbGVjdDogJ29uVHJlZUxpc3RTZWxlY3QnfSxcbiAgICAgICAgICAgIHJlZmVyZW5jZSAgICAgICAgICAgICAgICAgOiAnZmlsZXMtdHJlZScsXG4gICAgICAgICAgICBzaG93Q29sbGFwc2VFeHBhbmRBbGxJY29uczogZmFsc2UsXG4gICAgICAgICAgICB3aWR0aCAgICAgICAgICAgICAgICAgICAgIDogMzAwLFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBtb2R1bGUgICAgICA6IFNwbGl0dGVyLFxuICAgICAgICAgICAgcmVzaXplVGFyZ2V0OiAncHJldmlvdXMnLFxuICAgICAgICAgICAgc2l6ZSAgICAgICAgOiA1XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG1vZHVsZTogQ29udGFpbmVyLFxuICAgICAgICAgICAgZmxleCAgOiAxLFxuICAgICAgICAgICAgbGF5b3V0OiB7bnR5cGU6ICd2Ym94JywgYWxpZ246ICdzdHJldGNoJ30sXG4gICAgICAgICAgICBpdGVtczogW3tcbiAgICAgICAgICAgICAgICBtb2R1bGU6IFRvb2xiYXIsXG4gICAgICAgICAgICAgICAgZmxleCAgOiAnbm9uZScsXG4gICAgICAgICAgICAgICAgc3R5bGUgOiB7bWFyZ2luUmlnaHQ6ICcxNXB4J30sXG4gICAgICAgICAgICAgICAgaXRlbXMgOlsnLT4nLCB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZSAgIDogQnV0dG9uLFxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZCA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIgIDogJ29uTmV3RmlsZUJ1dHRvbkNsaWNrJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbkNscyAgOiAnZmEgZmEtcGx1cycsXG4gICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogJ25ldy1maWxlLWJ1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgIHRleHQgICAgIDogJ05ldyBGaWxlJ1xuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlICAgOiBCdXR0b24sXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlciAgOiAnb25TYXZlQnV0dG9uQ2xpY2snLFxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xzICA6ICdmYSBmYS1jbG91ZC11cGxvYWQnLFxuICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2U6ICdzYXZlLWJ1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlICAgIDoge21hcmdpbkxlZnQ6ICcuNWVtJ30sXG4gICAgICAgICAgICAgICAgICAgIHRleHQgICAgIDogJ1NhdmUnXG4gICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUgICA6IExpdmVQcmV2aWV3LFxuICAgICAgICAgICAgICAgIGZsZXggICAgIDogMyxcbiAgICAgICAgICAgICAgICBsYW5ndWFnZSA6ICdtYXJrZG93bicsXG4gICAgICAgICAgICAgICAgbGlzdGVuZXJzOiB7ZWRpdG9yQ2hhbmdlOiAnb25FZGl0b3JDaGFuZ2UnfSxcbiAgICAgICAgICAgICAgICByZWZlcmVuY2U6ICdjb2RlLWxpdmUtcHJldmlldycsXG4gICAgICAgICAgICAgICAgc3R5bGUgOiB7bWFyZ2luOiAnMjBweCd9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbW9kdWxlICAgICAgOiBTcGxpdHRlcixcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gICA6ICdob3Jpem9udGFsJyxcbiAgICAgICAgICAgICAgICByZXNpemVUYXJnZXQ6ICdwcmV2aW91cycsXG4gICAgICAgICAgICAgICAgc2l6ZSAgICAgICAgOiA1XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbW9kdWxlOiBQYW5lbCxcbiAgICAgICAgICAgICAgICBjbHMgICA6IFsnbGVnaXQtY29tbWl0LWdyaWQtcGFuZWwnXSxcbiAgICAgICAgICAgICAgICBmbGV4ICA6IDEsXG4gICAgICAgICAgICAgICAgc3R5bGUgOiB7bWFyZ2luOiAnMjBweCd9LFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IFt7XG4gICAgICAgICAgICAgICAgICAgIGRvY2s6ICd0b3AnLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnTGVnaXQgSGlzdG9yeSdcbiAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICBpdGVtcyA6IFt7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZSAgICAgIDogQ29tbWl0R3JpZCxcbiAgICAgICAgICAgICAgICAgICAgd3JhcHBlclN0eWxlOiB7bWluSGVpZ2h0OiAnMjAwcHgnfVxuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9XVxuICAgICAgICB9XVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoVmlld3BvcnQpO1xuIiwiaW1wb3J0IENvbXBvbmVudCAgICBmcm9tICcuLi8uLi8uLi9zcmMvY29udHJvbGxlci9Db21wb25lbnQubWpzJztcbmltcG9ydCBMZWdpdFNlcnZpY2UgZnJvbSAnLi4vc2VydmljZS9MZWdpdC5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBMZWdpdC52aWV3LlZpZXdwb3J0Q29udHJvbGxlclxuICogQGV4dGVuZHMgTmVvLmNvbnRyb2xsZXIuQ29tcG9uZW50XG4gKi9cbmNsYXNzIFZpZXdwb3J0Q29udHJvbGxlciBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdMZWdpdC52aWV3LlZpZXdwb3J0Q29udHJvbGxlcidcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTGVnaXQudmlldy5WaWV3cG9ydENvbnRyb2xsZXInLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfSBwb2xsaW5nSW50ZXJ2YWw9MTAwMFxuICAgICAgICAgKi9cbiAgICAgICAgcG9sbGluZ0ludGVydmFsOiAxMDAwXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1lbWJlciB7TmVvLmRpYWxvZy5CYXNlfG51bGx9XG4gICAgICovXG4gICAgYWRkRGlhbG9nID0gbnVsbFxuICAgIC8qKlxuICAgICAqIEBtZW1iZXIge1N0cmluZ30gY3VycmVudFRyZWVTdGF0ZT1udWxsXG4gICAgICovXG4gICAgY3VycmVudFRyZWVTdGF0ZSA9IG51bGxcbiAgICAvKipcbiAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBydW5uaW5nPWZhbHNlXG4gICAgICovXG4gICAgcnVubmluZyA9IGZhbHNlXG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICAgKi9cbiAgICBhc3luYyBpbml0QXN5bmMoKSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmluaXRBc3luYygpO1xuXG4gICAgICAgIGNvbnN0IG1lID0gdGhpcztcblxuICAgICAgICBhd2FpdCBMZWdpdFNlcnZpY2UucmVhZHkoKTtcblxuICAgICAgICBtZS5nZXRSZWZlcmVuY2UoJ25ldy1maWxlLWJ1dHRvbicpLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIG1lLmdldFJlZmVyZW5jZSgnc2F2ZS1idXR0b24nKSAgICAuZGlzYWJsZWQgPSBmYWxzZTtcblxuICAgICAgICBzZXRJbnRlcnZhbChtZS5wb2xsLmJpbmQobWUpLCBtZS5wb2xsaW5nSW50ZXJ2YWwpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBhc3luYyBvbkFkZEZpbGVEaWFsb2dTYXZlKGRhdGEpIHtcbiAgICAgICAgY29uc3RcbiAgICAgICAgICAgIG1lICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBkaWFsb2cgICAgPSBtZS5hZGREaWFsb2csXG4gICAgICAgICAgICB0ZXh0RmllbGQgPSBkaWFsb2cuZ2V0UmVmZXJlbmNlKCdmaWxlbmFtZScpLFxuICAgICAgICAgICAgZmlsZVBhdGggID0gYCR7TGVnaXRTZXJ2aWNlLnBhdGh9LyR7dGV4dEZpZWxkLnZhbHVlfWA7XG5cbiAgICAgICAgZGlhbG9nLmhpZGUoKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnb25BZGRGaWxlRGlhbG9nU2F2ZScsIHRleHRGaWVsZC52YWx1ZSk7XG4gICAgICAgIGF3YWl0IExlZ2l0U2VydmljZS53cml0ZUZpbGUoe1xuICAgICAgICAgICAgZGF0YTogJycsXG4gICAgICAgICAgICBwYXRoOiBmaWxlUGF0aFxuICAgICAgICB9KTtcblxuICAgICAgICBtZS5zZXRTdGF0ZSh7Y3VycmVudEZpbGU6IGZpbGVQYXRofSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbkNvbW1pdENvbHVtblJlbmRlcmVyKGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGEuZGF0YUZpZWxkID09PSAnYXV0aG9yJykge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEudmFsdWUubmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmRhdGFGaWVsZCA9PT0gJ3RpbWVzdGFtcCcpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCgnZGVmYXVsdCcsIHtcbiAgICAgICAgICAgICAgICBob3VyOiAnbnVtZXJpYycsXG4gICAgICAgICAgICAgICAgbWludXRlOiAnbnVtZXJpYycsXG4gICAgICAgICAgICAgICAgc2Vjb25kOiAnbnVtZXJpYydcbiAgICAgICAgICAgIH0pLmZvcm1hdChuZXcgRGF0ZShkYXRhLnZhbHVlICogMTAwMCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRhdGEudmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtSZWNvcmR9IHJlY29yZFxuICAgICAqL1xuICAgIG9uRmlsZUl0ZW1DbGljayhyZWNvcmQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ29uRmlsZUl0ZW1DbGljaycsIHJlY29yZClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICAgICAqL1xuICAgIGFzeW5jIG9uRWRpdG9yQ2hhbmdlKGRhdGEpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ29uRWRpdG9yQ2hhbmdlJywgZGF0YSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICAgKi9cbiAgICBhc3luYyBvbk5ld0ZpbGVCdXR0b25DbGljayhkYXRhKSB7XG4gICAgICAgIGxldCBtZSAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7YWRkRGlhbG9nfSA9IG1lLFxuICAgICAgICAgICAgYnV0dG9uICAgICAgPSBkYXRhLmNvbXBvbmVudCxcbiAgICAgICAgICAgIHthcHBOYW1lLCB0aGVtZSwgd2luZG93SWR9ID0gYnV0dG9uO1xuXG4gICAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICAgICAgaWYgKCFhZGREaWFsb2cpIHtcbiAgICAgICAgICAgIGltcG9ydCgnLi9BZGRGaWxlRGlhbG9nLm1qcycpLnRoZW4obW9kdWxlID0+IHtcbiAgICAgICAgICAgICAgICBtZS5hZGREaWFsb2cgPSBOZW8uY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlICAgICAgICAgOiBtb2R1bGUuZGVmYXVsdCxcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZVRhcmdldElkOiBidXR0b24uaWQsXG4gICAgICAgICAgICAgICAgICAgIGFwcE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVycyAgICAgIDoge2hpZGU6IGRhdGEgPT4ge2J1dHRvbi5kaXNhYmxlZCA9IGZhbHNlfX0sXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudENvbXBvbmVudDogbWUuY29tcG9uZW50LFxuICAgICAgICAgICAgICAgICAgICB0aGVtZSxcbiAgICAgICAgICAgICAgICAgICAgd2luZG93SWRcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFkZERpYWxvZy5zaG93KClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgYXN5bmMgb25TYXZlQnV0dG9uQ2xpY2soZGF0YSkge1xuICAgICAgICBjb25zdFxuICAgICAgICAgICAgbWUgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgbGl2ZVByZXZpZXcgPSBtZS5nZXRSZWZlcmVuY2UoJ2NvZGUtbGl2ZS1wcmV2aWV3JyksXG4gICAgICAgICAgICBjdXJyZW50RmlsZSA9IG1lLmdldFN0YXRlKCdjdXJyZW50RmlsZScpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdvblNhdmVCdXR0b25DbGljaycsIG1lLmdldFN0YXRlKCdjdXJyZW50RmlsZScpLCBsaXZlUHJldmlldy52YWx1ZSk7XG5cbiAgICAgICAgYXdhaXQgTGVnaXRTZXJ2aWNlLndyaXRlRmlsZSh7XG4gICAgICAgICAgICBkYXRhOiBsaXZlUHJldmlldy52YWx1ZSxcbiAgICAgICAgICAgIHBhdGg6IGAke0xlZ2l0U2VydmljZS5wYXRofS8ke2N1cnJlbnRGaWxlfWBcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9ICAgZGF0YVxuICAgICAqIEBwYXJhbSB7UmVjb3JkW119IGRhdGEucmVjb3Jkc1xuICAgICAqIEBwYXJhbSB7U3RyaW5nW119IGRhdGEuc2VsZWN0aW9uIC8vIHNlbGVjdGVkIGRvbSBub2RlIGlkc1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSAgIGRhdGEuc291cmNlICAgIC8vIGlkIG9mIHRoZSBldmVudC1maXJpbmcgaW5zdGFuY2VcbiAgICAgKi9cbiAgICBhc3luYyBvblRyZWVMaXN0U2VsZWN0KHtyZWNvcmRzfSkge1xuICAgICAgICBjb25zdFxuICAgICAgICAgICAgbGl2ZVByZXZpZXcgPSB0aGlzLmdldFJlZmVyZW5jZSgnY29kZS1saXZlLXByZXZpZXcnKSxcbiAgICAgICAgICAgIHJlY29yZCAgICAgID0gcmVjb3Jkcz8uWzBdLFxuICAgICAgICAgICAgbGFuZ3VhZ2UgICAgPSByZWNvcmQuaWQuaW5jbHVkZXMoJy5tZCcpID8gJ21hcmtkb3duJyA6ICduZW9tanMnO1xuXG4gICAgICAgIGlmIChyZWNvcmQ/LmlzTGVhZikge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7Y3VycmVudEZpbGU6IHJlY29yZC5pZH0pO1xuXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IExlZ2l0U2VydmljZS5yZWFkRmlsZShgJHtMZWdpdFNlcnZpY2UucGF0aH0vJHtyZWNvcmQuaWR9YCwgJ3V0Zi04Jyk7XG5cbiAgICAgICAgICAgIGF3YWl0IGxpdmVQcmV2aWV3LnNldCh7bGFuZ3VhZ2UsIHZhbHVlfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICAgKi9cbiAgICBhc3luYyBwb2xsKCkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGlmIChtZS5ydW5uaW5nKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBtZS5ydW5uaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgbGV0IG5ld1N0YXRlID0gYXdhaXQgTGVnaXRTZXJ2aWNlLnJlYWRGaWxlKExlZ2l0U2VydmljZS5wYXRoICsgJy8ubGVnaXQvaGVhZCcsICd1dGYtOCcpO1xuXG4gICAgICAgICAgICBpZiAobWUuY3VycmVudFRyZWVTdGF0ZSA9PT0gbmV3U3RhdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbW1pdFN0b3JlID0gbWUuZ2V0U3RvcmUoJ2NvbW1pdFN0b3JlJyk7XG4gICAgICAgICAgICBjb25zdCBmaWxlU3RvcmUgICA9IG1lLmdldFN0b3JlKCdmaWxlU3RvcmUnKTtcbiAgICAgICAgICAgIGNvbnN0IHRyZWVEZWx0YSAgID0gYXdhaXQgTGVnaXRTZXJ2aWNlLmxvYWRUcmVlRGVsdGEobWUuY3VycmVudFRyZWVTdGF0ZSwgbmV3U3RhdGUpO1xuXG4gICAgICAgICAgICBjb21taXRTdG9yZS5kYXRhID0gYXdhaXQgTGVnaXRTZXJ2aWNlLmxvYWRIaXN0b3J5KCk7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUUkVFIERFTFRBOicsIHRyZWVEZWx0YSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRlbGV0ZWRFbnRyeSBvZiB0cmVlRGVsdGEuZGVsZXRlZCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEZWxldGVkIEZST00gVFJFRTogJyArIGRlbGV0ZWRFbnRyeSk7XG4gICAgICAgICAgICAgICAgZmlsZVN0b3JlLnJlbW92ZShkZWxldGVkRW50cnkpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgYWRkZWRFbnRyeSBvZiB0cmVlRGVsdGEuYWRkZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQWRkZWQgRnJvbSBUcmVlOicgKyBhZGRlZEVudHJ5KTtcbiAgICAgICAgICAgICAgICBmaWxlU3RvcmUuaW5zZXJ0KDAsIHtcbiAgICAgICAgICAgICAgICAgICAgaWQgICAgICA6IGFkZGVkRW50cnksXG4gICAgICAgICAgICAgICAgICAgIG5hbWUgICAgOiBhZGRlZEVudHJ5LFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRJZDogbnVsbFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgbW9kaWZpZWRFbnRyeSBvZiB0cmVlRGVsdGEubW9kaWZpZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zdCBuZXdJdGVtID0gYXdhaXQgbGVnaXRGcy5yZWFkRmlsZShwYXRoICsgJy8nICsgYWRkZWRFbnRyeSwgJ3V0ZjgnKTtcbiAgICAgICAgICAgICAgICAvLyB0b2RvIHVwZGF0ZSBpdGVtIGluIHRyZWUgc3RvcmVcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTU9ESUZJRUQgRnJvbSBUcmVlOicgKyBtb2RpZmllZEVudHJ5KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWUuY3VycmVudFRyZWVTdGF0ZSA9IG5ld1N0YXRlO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgbWUucnVubmluZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICBsZXQgc2VsZWN0aW9uTW9kZWwgPSBtZS5nZXRSZWZlcmVuY2UoJ2ZpbGVzLXRyZWUnKS5zZWxlY3Rpb25Nb2RlbDtcblxuICAgICAgICAgICAgaWYgKCFzZWxlY3Rpb25Nb2RlbC5oYXNTZWxlY3Rpb24oKSkge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbk1vZGVsLnNlbGVjdEF0KDApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKFZpZXdwb3J0Q29udHJvbGxlcik7XG4iLCJpbXBvcnQgQ29tbWl0U3RvcmUgZnJvbSAnLi4vc3RvcmUvQ29tbWl0cy5tanMnO1xuaW1wb3J0IEZpbGVTdG9yZSAgIGZyb20gJy4uL3N0b3JlL0ZpbGVzLm1qcyc7XG5pbXBvcnQgUHJvdmlkZXIgICAgZnJvbSAnLi4vLi4vLi4vc3JjL3N0YXRlL1Byb3ZpZGVyLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIExlZ2l0LnZpZXcuVmlld3BvcnRTdGF0ZVByb3ZpZGVyXG4gKiBAZXh0ZW5kcyBOZW8uc3RhdGUuUHJvdmlkZXJcbiAqL1xuY2xhc3MgVmlld3BvcnRTdGF0ZVByb3ZpZGVyIGV4dGVuZHMgUHJvdmlkZXIge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTGVnaXQudmlldy5WaWV3cG9ydFN0YXRlUHJvdmlkZXInXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ0xlZ2l0LnZpZXcuVmlld3BvcnRTdGF0ZVByb3ZpZGVyJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdH0gZGF0YVxuICAgICAgICAgKi9cbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd8bnVsbH0gZGF0YS5jdXJyZW50RmlsZT1udWxsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGN1cnJlbnRGaWxlOiBudWxsXG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IHN0b3Jlc1xuICAgICAgICAgKi9cbiAgICAgICAgc3RvcmVzOiB7XG4gICAgICAgICAgICBjb21taXRTdG9yZTogQ29tbWl0U3RvcmUsXG4gICAgICAgICAgICBmaWxlU3RvcmUgIDogRmlsZVN0b3JlXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKFZpZXdwb3J0U3RhdGVQcm92aWRlcik7IiwiaW1wb3J0IENvbXBvbmVudCBmcm9tICcuL0Jhc2UubWpzJztcblxuLyoqXG4gKiBDb252ZW5pZW5jZSBjbGFzcyB0byByZW5kZXIgYSBsYWJlbCB3aXRoIGEgdGV4dFxuICogQGNsYXNzIE5lby5jb21wb25lbnQuTGFiZWxcbiAqIEBleHRlbmRzIE5lby5jb21wb25lbnQuQmFzZVxuICovXG5jbGFzcyBMYWJlbCBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8uY29tcG9uZW50LkxhYmVsJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8uY29tcG9uZW50LkxhYmVsJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gbnR5cGU9J2xhYmVsJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ2xhYmVsJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBiYXNlQ2xzPVsnbmVvLWxhYmVsJ11cbiAgICAgICAgICovXG4gICAgICAgIGJhc2VDbHM6IFsnbmVvLWxhYmVsJ10sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IHRhZz0nbGFiZWwnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICB0YWc6ICdsYWJlbCdcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKExhYmVsKTtcbiIsImltcG9ydCBDb250YWluZXIgZnJvbSAnLi9CYXNlLm1qcyc7XG5pbXBvcnQgVG9vbGJhciAgIGZyb20gJy4uL3Rvb2xiYXIvQmFzZS5tanMnO1xuXG4vKipcbiAqIEFuIGV4dGVuZGVkIENvbnRhaW5lciBzdXBwb3J0aW5nIG11bHRpcGxlIGRvY2tlZCBoZWFkZXIgdG9vbGJhcnNcbiAqIEBjbGFzcyBOZW8uY29udGFpbmVyLlBhbmVsXG4gKiBAZXh0ZW5kcyBOZW8uY29udGFpbmVyLkJhc2VcbiAqL1xuY2xhc3MgUGFuZWwgZXh0ZW5kcyBDb250YWluZXIge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLmNvbnRhaW5lci5QYW5lbCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLmNvbnRhaW5lci5QYW5lbCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSdwYW5lbCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgbnR5cGU6ICdwYW5lbCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmdbXX0gYmFzZUNscz1bJ25lby1wYW5lbCcsJ25lby1jb250YWluZXInXVxuICAgICAgICAgKi9cbiAgICAgICAgYmFzZUNsczogWyduZW8tcGFuZWwnLCAnbmVvLWNvbnRhaW5lciddLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSBjb250YWluZXJDb25maWc9bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgY29udGFpbmVyQ29uZmlnOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSBoZWFkZXJEZWZhdWx0cz1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBoZWFkZXJEZWZhdWx0czogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge0FycmF5fSBoZWFkZXJzPW51bGxcbiAgICAgICAgICovXG4gICAgICAgIGhlYWRlcnM6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGl0ZW1zPXtudHlwZTogJ3Zib3gnLCBhbGlnbjogJ3N0cmV0Y2gnfVxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIF9sYXlvdXQ6IHtcbiAgICAgICAgICAgIG50eXBlOiAndmJveCcsXG4gICAgICAgICAgICBhbGlnbjogJ3N0cmV0Y2gnXG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSB2ZXJ0aWNhbEhlYWRlcnNGaXJzdD1mYWxzZVxuICAgICAgICAgKi9cbiAgICAgICAgdmVydGljYWxIZWFkZXJzRmlyc3Q6IGZhbHNlXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdChjb25maWcpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0KGNvbmZpZyk7XG5cbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBpZiAobWUuaGFzSGVhZGVycygpICYmIG1lLnZlcnRpY2FsSGVhZGVyc0ZpcnN0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICBtZS5sYXlvdXQgPSB7XG4gICAgICAgICAgICAgICAgbnR5cGU6ICdoYm94JyxcbiAgICAgICAgICAgICAgICBhbGlnbjogJ3N0cmV0Y2gnXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGhlYWRlciB0aGUgaGVhZGVyIGNvbmZpZ1xuICAgICAqIEByZXR1cm5zIHtPYmplY3R9XG4gICAgICovXG4gICAgc3RhdGljIGNyZWF0ZUhlYWRlckNvbmZpZyhoZWFkZXIpIHtcbiAgICAgICAgaWYgKE5lby50eXBlT2YoaGVhZGVyKSA9PT0gJ05lb0luc3RhbmNlJykge1xuICAgICAgICAgICAgcmV0dXJuIGhlYWRlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjb25maWcgPSB7XG4gICAgICAgICAgICBmbGV4OiAnMCAxIGF1dG8nXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCFoZWFkZXIubW9kdWxlICYmICFoZWFkZXIubnR5cGUpIHtcbiAgICAgICAgICAgIGNvbmZpZy5jbHMgICA9IFsnbmVvLXBhbmVsLWhlYWRlci10b29sYmFyJywgJ25lby10b29sYmFyJ107XG4gICAgICAgICAgICBjb25maWcubnR5cGUgPSAndG9vbGJhcic7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaGVhZGVyLnRleHQpIHtcbiAgICAgICAgICAgIGNvbmZpZy5pdGVtcyA9IFt7XG4gICAgICAgICAgICAgICAgbnR5cGU6ICdsYWJlbCcsXG4gICAgICAgICAgICAgICAgY2xzICA6IFsnbmVvLXBhbmVsLWhlYWRlci10ZXh0JywgJ25lby1sYWJlbCddLFxuICAgICAgICAgICAgICAgIHRleHQgOiBoZWFkZXIudGV4dFxuICAgICAgICAgICAgfV07XG5cbiAgICAgICAgICAgIGRlbGV0ZSBoZWFkZXIudGV4dDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFzc3VtaW5nIGFsbCBsYWJlbHMgaW5zaWRlIGEgUGFuZWwgSGVhZGVyIGFyZSBtZWFudCB0byBiZSB0aXRsZXMgLT4gbG9vayB0aGUgc2FtZSB3YXlcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaGVhZGVyLml0ZW1zKSkge1xuICAgICAgICAgICAgaGVhZGVyLml0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ubnR5cGUgPT09ICdsYWJlbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jbHMgPSBbJ25lby1wYW5lbC1oZWFkZXItdGV4dCcsICduZW8tbGFiZWwnXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7Li4uY29uZmlnLCAuLi5oZWFkZXJ9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBjcmVhdGVJdGVtcygpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBjb250YWluZXJDb25maWcgPSBtZS5jb250YWluZXJDb25maWc7XG5cbiAgICAgICAgaWYgKCFtZS5oYXNIZWFkZXJzKCkpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lckNvbmZpZyAmJiBtZS5zZXQoY29udGFpbmVyQ29uZmlnKTtcbiAgICAgICAgICAgIHN1cGVyLmNyZWF0ZUl0ZW1zKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgaGYgICAgICAgICAgICAgICAgICAgPSBtZS52ZXJ0aWNhbEhlYWRlcnNGaXJzdCA9PT0gZmFsc2UsXG4gICAgICAgICAgICAgICAgaGVhZGVycyAgICAgICAgICAgICAgPSBtZS5oZWFkZXJzIHx8IFtdLFxuICAgICAgICAgICAgICAgIGJvdHRvbUhlYWRlcnMgICAgICAgID0gaGVhZGVycy5maWx0ZXIoaGVhZGVyID0+IHtyZXR1cm4gaGVhZGVyLmRvY2sgPT09IChoZiA/J2JvdHRvbSc6ICdyaWdodCcpfSksXG4gICAgICAgICAgICAgICAgbGVmdEhlYWRlcnMgICAgICAgICAgPSBoZWFkZXJzLmZpbHRlcihoZWFkZXIgPT4ge3JldHVybiBoZWFkZXIuZG9jayA9PT0gKGhmID8nbGVmdCcgIDogJ3RvcCcpfSksXG4gICAgICAgICAgICAgICAgcmlnaHRIZWFkZXJzICAgICAgICAgPSBoZWFkZXJzLmZpbHRlcihoZWFkZXIgPT4ge3JldHVybiBoZWFkZXIuZG9jayA9PT0gKGhmID8ncmlnaHQnIDogJ2JvdHRvbScpfSksXG4gICAgICAgICAgICAgICAgdG9wSGVhZGVycyAgICAgICAgICAgPSBoZWFkZXJzLmZpbHRlcihoZWFkZXIgPT4ge3JldHVybiBoZWFkZXIuZG9jayA9PT0gKGhmID8ndG9wJyAgIDogJ2xlZnQnKX0pLFxuICAgICAgICAgICAgICAgIGhhc0hvcml6b250YWxIZWFkZXJzID0gYm90dG9tSGVhZGVycy5sZW5ndGggPiAwIHx8IHRvcEhlYWRlcnMgIC5sZW5ndGggPiAwLFxuICAgICAgICAgICAgICAgIGhhc1ZlcnRpY2FsSGVhZGVycyAgID0gbGVmdEhlYWRlcnMgIC5sZW5ndGggPiAwIHx8IHJpZ2h0SGVhZGVycy5sZW5ndGggPiAwLFxuICAgICAgICAgICAgICAgIHtpdGVtc30gICAgICAgICAgICAgID0gbWUsXG4gICAgICAgICAgICAgICAgaG9yaXpvbnRhbEl0ZW1zICAgICAgPSBbXSxcbiAgICAgICAgICAgICAgICB2ZXJ0aWNhbEl0ZW1zICAgICAgICA9IFtdLFxuICAgICAgICAgICAgICAgIGNvbmZpZztcblxuICAgICAgICAgICAgdG9wSGVhZGVycy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgICAgICAgICAgdmVydGljYWxJdGVtcy5wdXNoKFBhbmVsLmNyZWF0ZUhlYWRlckNvbmZpZyhoZWFkZXIpKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChoYXNWZXJ0aWNhbEhlYWRlcnMgJiYgKGhmICYmIGhhc0hvcml6b250YWxIZWFkZXJzIHx8ICFoZiAmJiBoYXNIb3Jpem9udGFsSGVhZGVycykpIHtcbiAgICAgICAgICAgICAgICBsZWZ0SGVhZGVycy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGhvcml6b250YWxJdGVtcy5wdXNoKFBhbmVsLmNyZWF0ZUhlYWRlckNvbmZpZyhoZWFkZXIpKVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgICAgICBudHlwZSAgICAgICA6ICdjb250YWluZXInLFxuICAgICAgICAgICAgICAgICAgICBmbGV4ICAgICAgICA6IDEsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLFxuICAgICAgICAgICAgICAgICAgICBpdGVtRGVmYXVsdHM6IG1lLml0ZW1EZWZhdWx0cyxcbiAgICAgICAgICAgICAgICAgICAgLi4uY29udGFpbmVyQ29uZmlnXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGhvcml6b250YWxJdGVtcy5wdXNoKHsuLi5tZS5oZWFkZXJEZWZhdWx0cywgLi4uY29uZmlnfSk7XG5cbiAgICAgICAgICAgICAgICByaWdodEhlYWRlcnMuZm9yRWFjaChoZWFkZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBob3Jpem9udGFsSXRlbXMucHVzaChQYW5lbC5jcmVhdGVIZWFkZXJDb25maWcoaGVhZGVyKSlcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZlcnRpY2FsSXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG50eXBlICAgIDogJ2NvbnRhaW5lcicsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zICAgIDogaG9yaXpvbnRhbEl0ZW1zLFxuICAgICAgICAgICAgICAgICAgICBsYXlvdXQgICA6IHtudHlwZTogKGhmID8gJ2hib3gnIDogJ3Zib3gnKSwgYWxpZ246ICdzdHJldGNoJ30sXG4gICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogJ2JvZHlDb250YWluZXInXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICAgICAgbnR5cGUgICAgICAgOiAnY29udGFpbmVyJyxcbiAgICAgICAgICAgICAgICAgICAgZmxleCAgICAgICAgOiAxLFxuICAgICAgICAgICAgICAgICAgICBpdGVtcyxcbiAgICAgICAgICAgICAgICAgICAgaXRlbURlZmF1bHRzOiBtZS5pdGVtRGVmYXVsdHMsXG4gICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZSAgIDogJ2JvZHlDb250YWluZXInLFxuICAgICAgICAgICAgICAgICAgICAuLi5jb250YWluZXJDb25maWdcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmVydGljYWxJdGVtcy5wdXNoKHsuLi5tZS5oZWFkZXJEZWZhdWx0cywgLi4uY29uZmlnfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYm90dG9tSGVhZGVycy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgICAgICAgICAgdmVydGljYWxJdGVtcy5wdXNoKFBhbmVsLmNyZWF0ZUhlYWRlckNvbmZpZyhoZWFkZXIpKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1lLml0ZW1zID0gdmVydGljYWxJdGVtcztcblxuICAgICAgICAgICAgbWUuaXRlbURlZmF1bHRzID0gbnVsbDtcblxuICAgICAgICAgICAgc3VwZXIuY3JlYXRlSXRlbXMoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAgICovXG4gICAgaGFzSGVhZGVycygpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodGhpcy5oZWFkZXJzKSAmJiB0aGlzLmhlYWRlcnMubGVuZ3RoID4gMFxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoUGFuZWwpO1xuIiwiaW1wb3J0IENvbnRhaW5lciBmcm9tICcuL0Jhc2UubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTmVvLmNvbnRhaW5lci5WaWV3cG9ydFxuICogQGV4dGVuZHMgTmVvLmNvbnRhaW5lci5CYXNlXG4gKi9cbmNsYXNzIFZpZXdwb3J0IGV4dGVuZHMgQ29udGFpbmVyIHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5jb250YWluZXIuVmlld3BvcnQnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5jb250YWluZXIuVmlld3BvcnQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBudHlwZT0ndmlld3BvcnQnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG50eXBlOiAndmlld3BvcnQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogdHJ1ZSBhcHBsaWVzICduZW8tYm9keS12aWV3cG9ydCcgdG8gdGhlIGRvY3VtZW50LmJvZHlcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gYXBwbHlCb2R5Q2xzPXRydWVcbiAgICAgICAgICovXG4gICAgICAgIGFwcGx5Qm9keUNsczogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFzc3VtaW5nIHRoYXQgYSBWaWV3cG9ydCBpcyB0aGUgdG9wIGxldmVsIHZpZXcgb2YgeW91ciBhcHAsIGFuZCB5b3Ugd2FudCB0byBtb3VudCBpdCByaWdodCBhd2F5LlxuICAgICAgICAgKiBDb3VsZCBiZSB3aXRob3V0IGFueSBpdGVtcy4gVXNlIGZhbHNlIG90aGVyd2lzZS5cbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gYXV0b01vdW50PXRydWVcbiAgICAgICAgICovXG4gICAgICAgIGF1dG9Nb3VudDogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBiYXNlQ2xzPVsnbmVvLXZpZXdwb3J0J11cbiAgICAgICAgICovXG4gICAgICAgIGJhc2VDbHM6IFsnbmVvLXZpZXdwb3J0J10sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiB0cnVlIGFwcGxpZXMgYSBtYWluLmFkZG9uLlJlc2l6ZU9ic2VydmVyIGFuZCBmaXJlcyBhIGN1c3RvbSByZXNpemUgZXZlbnRcbiAgICAgICAgICogd2hpY2ggb3RoZXIgaW5zdGFuY2VzIGNhbiBzdWJzY3JpYmUgdG8uXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IG1vbml0b3JTaXplXz1mYWxzZVxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIG1vbml0b3JTaXplXzogZmFsc2VcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIG1vdW50ZWQgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtCb29sZWFufSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRNb3VudGVkKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBzdXBlci5hZnRlclNldE1vdW50ZWQodmFsdWUsIG9sZFZhbHVlKTtcblxuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGlmICh2YWx1ZSAmJiBtZS5tb25pdG9yU2l6ZSkge1xuICAgICAgICAgICAgbWUuYWRkRG9tTGlzdGVuZXJzKFt7cmVzaXplOiBtZS5vbkRvbVJlc2l6ZSwgc2NvcGU6IG1lfV0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIG9uQ29uc3RydWN0ZWQoKSB7XG4gICAgICAgIHN1cGVyLm9uQ29uc3RydWN0ZWQoKTtcblxuICAgICAgICBsZXQge3dpbmRvd0lkfSA9IHRoaXM7XG5cbiAgICAgICAgdGhpcy5hcHBseUJvZHlDbHMgJiYgTmVvLm1haW4uRG9tQWNjZXNzLmFwcGx5Qm9keUNscyh7XG4gICAgICAgICAgICBjbHM6IFsnbmVvLWJvZHktdmlld3BvcnQnXSxcbiAgICAgICAgICAgIHdpbmRvd0lkXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbkRvbVJlc2l6ZShkYXRhKSB7XG4gICAgICAgIHRoaXMuZmlyZSgncmVzaXplJywgZGF0YSlcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKFZpZXdwb3J0KTtcbiIsImltcG9ydCBCYXNlICAgICAgICAgICAgICBmcm9tICcuL0Jhc2UubWpzJztcbmltcG9ydCB7cmVzb2x2ZUNhbGxiYWNrfSBmcm9tICcuLi91dGlsL0Z1bmN0aW9uLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5jb250cm9sbGVyLkNvbXBvbmVudFxuICogQGV4dGVuZHMgTmVvLmNvbnRyb2xsZXIuQmFzZVxuICovXG5jbGFzcyBDb21wb25lbnQgZXh0ZW5kcyBCYXNlIHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5jb250cm9sbGVyLkNvbXBvbmVudCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLmNvbnRyb2xsZXIuQ29tcG9uZW50JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gbnR5cGU9J2NvbXBvbmVudC1jb250cm9sbGVyJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ2NvbXBvbmVudC1jb250cm9sbGVyJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge05lby5jb21wb25lbnQuQmFzZXxudWxsfSBjb21wb25lbnQ9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjb21wb25lbnQ6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uY29udHJvbGxlci5Db21wb25lbnR8bnVsbH0gcGFyZW50Xz1udWxsXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgcGFyZW50XzogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdH0gcmVmZXJlbmNlcz1udWxsXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHJlZmVyZW5jZXM6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd8bnVsbH0gd2luZG93SWQ9bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgd2luZG93SWQ6IG51bGxcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0KGNvbmZpZykge1xuICAgICAgICBzdXBlci5jb25zdHJ1Y3QoY29uZmlnKTtcblxuICAgICAgICBsZXQgbWUgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAge2NvbXBvbmVudH0gPSBtZTtcblxuICAgICAgICBtZS5yZWZlcmVuY2VzID0ge307XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudC5pc0NvbnN0cnVjdGVkKSB7XG4gICAgICAgICAgICBtZS5vbkNvbXBvbmVudENvbnN0cnVjdGVkKClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5vbignY29uc3RydWN0ZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgbWUub25Db21wb25lbnRDb25zdHJ1Y3RlZCgpXG4gICAgICAgICAgICB9LCBtZSwge29uY2U6IHRydWV9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGJlZm9yZSB0aGUgcGFyZW50IGNvbmZpZyBnZXRzIGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge05lby5jb250cm9sbGVyLkNvbXBvbmVudHxudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7TmVvLmNvbnRyb2xsZXIuQ29tcG9uZW50fG51bGx9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldFBhcmVudCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlIHx8IHRoaXMuZ2V0UGFyZW50KClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaGFuZGxlck5hbWVcbiAgICAgKiBAcGFyYW0ge05lby5jb21wb25lbnQuQmFzZXxudWxsfSBbY29tcG9uZW50XVxuICAgICAqIEByZXR1cm5zIHtOZW8uY29udHJvbGxlci5Db21wb25lbnR8Qm9vbGVhbnxudWxsfVxuICAgICAqL1xuICAgIGdldEhhbmRsZXJTY29wZShoYW5kbGVyTmFtZSwgY29tcG9uZW50KSB7XG4gICAgICAgIGxldCBtZSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7cGFyZW50fSA9IG1lLFxuICAgICAgICAgICAgaGFuZGxlckNiO1xuXG4gICAgICAgIGlmIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgIC8vIExvb2sgZm9yIHRocyBmdW5jdGlvbiAqbmFtZSogZmlyc3QgaW4gdGhlIENvbXBvbmVudCBpdHNlbGYuXG4gICAgICAgICAgICAvLyBJZiB3ZSBmaW5kIGl0LCByZXR1cm4gdHJ1ZSBzbyBjYWxsaW5nIGNvZGUga25vd3Mgbm90IHRvIGNvbnRpbnVlIHRvIHNlYXJjaC5cbiAgICAgICAgICAgIGhhbmRsZXJDYiA9IHJlc29sdmVDYWxsYmFjayhoYW5kbGVyTmFtZSwgY29tcG9uZW50KTtcblxuICAgICAgICAgICAgLy8gSGFuZGxlciBmbiBpcyByZXNvbHZlZCBpbiB0aGUgQ29tcG9uZW50IG9yIGl0cyBvd24gcGFyZW50IGNoYWluLlxuICAgICAgICAgICAgLy8gUmV0dXJuIGEgc3RhdHVzIGluZGljYXRpbmcgdGhhdCB3ZSBkbyBub3QgbmVlZCBhbiBlYXJseSBiaW5kaW5nXG4gICAgICAgICAgICBpZiAoaGFuZGxlckNiLmZuKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBOZW8uaXNGdW5jdGlvbihtZVtoYW5kbGVyTmFtZV0pID9cbiAgICAgICAgICAgIG1lIDogcGFyZW50Py5nZXRIYW5kbGVyU2NvcGUoaGFuZGxlck5hbWUpIHx8IG51bGxcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGNsb3Nlc3QgY29udHJvbGxlciBpbnNpZGUgdGhlIGNvbXBvbmVudHMgcGFyZW50IHRyZWVcbiAgICAgKiBAcmV0dXJucyB7TmVvLmNvbnRyb2xsZXIuQ29tcG9uZW50fG51bGx9XG4gICAgICovXG4gICAgZ2V0UGFyZW50KCkge1xuICAgICAgICBsZXQgbWUgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAge3BhcmVudH0gPSBtZTtcblxuICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyZW50XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbWUuY29tcG9uZW50LnBhcmVudD8uZ2V0Q29udHJvbGxlcigpIHx8IG51bGxcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiB0b2RvOiB1cGRhdGUgY2hhbmdlZCByZWZlcmVuY2VzIChlLmcuIGNvbnRhaW5lci5yZW1vdmUoKSB0aGVuIGNvbnRhaW5lci5hZGQoKSB1c2luZyB0aGUgc2FtZSBrZXkpXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRSZWZlcmVuY2UobmFtZSkge1xuICAgICAgICBsZXQgbWUgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGNvbXBvbmVudCA9IG1lLnJlZmVyZW5jZXNbbmFtZV07XG5cbiAgICAgICAgaWYgKCFjb21wb25lbnQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudCA9IG1lLmNvbXBvbmVudC5kb3duKHtyZWZlcmVuY2U6IG5hbWV9KTtcblxuICAgICAgICAgICAgaWYgKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgICAgIG1lLnJlZmVyZW5jZXNbbmFtZV0gPSBjb21wb25lbnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb21wb25lbnQgfHwgbnVsbFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlbmllbmNlIHNob3J0Y3V0XG4gICAgICogQHBhcmFtIGFyZ3NcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRTdGF0ZSguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFN0YXRlUHJvdmlkZXIoKS5nZXREYXRhKC4uLmFyZ3MpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogc2FtZUxldmVsT25seT1mYWxzZSB3aWxsIHJldHVybiB0aGUgY2xvc2VzdCBzdGF0ZVByb3ZpZGVyIGluc2lkZSB0aGUgY29tcG9uZW50IHBhcmVudCB0cmVlLFxuICAgICAqIGluIGNhc2UgdGhlcmUgaXMgbm9uZSBvbiB0aGUgc2FtZSBsZXZlbC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzYW1lTGV2ZWxPbmx5PWZhbHNlXVxuICAgICAqL1xuICAgIGdldFN0YXRlUHJvdmlkZXIoc2FtZUxldmVsT25seT1mYWxzZSkge1xuICAgICAgICBsZXQge2NvbXBvbmVudH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gc2FtZUxldmVsT25seSA/IGNvbXBvbmVudC5zdGF0ZVByb3ZpZGVyIDogY29tcG9uZW50LmdldFN0YXRlUHJvdmlkZXIoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlbmllbmNlIHNob3J0Y3V0IGZvciBhY2Nlc3Npbmcgc3RhdGUuUHJvdmlkZXIgYmFzZWQgZGF0YS5TdG9yZXNcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5XG4gICAgICogQHJldHVybnMge05lby5kYXRhLlN0b3JlfVxuICAgICAqL1xuICAgIGdldFN0b3JlKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRTdGF0ZVByb3ZpZGVyKCkuZ2V0U3RvcmUoa2V5KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE92ZXJyaWRlIHRoaXMgbWV0aG9kIGluc2lkZSB5b3VyIHZpZXcgY29udHJvbGxlcnMgYXMgYSBzdGFydGluZyBwb2ludCBpbiBjYXNlIHlvdSBuZWVkIHJlZmVyZW5jZXNcbiAgICAgKiAoaW5zdGVhZCBvZiB1c2luZyBvbkNvbnN0cnVjdGVkKCkgaW5zaWRlIHlvdXIgY29udHJvbGxlcilcbiAgICAgKi9cbiAgICBvbkNvbXBvbmVudENvbnN0cnVjdGVkKCkge31cblxuICAgIC8qKlxuICAgICAqIFdpbGwgZ2V0IGNhbGxlZCBieSBjb21wb25lbnQuQmFzZTogZGVzdHJveSgpIGluIGNhc2UgdGhlIGNvbXBvbmVudCBoYXMgYSByZWZlcmVuY2UgY29uZmlnXG4gICAgICogQHBhcmFtIHtOZW8uY29tcG9uZW50LkJhc2V9IGNvbXBvbmVudFxuICAgICAqL1xuICAgIHJlbW92ZVJlZmVyZW5jZShjb21wb25lbnQpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7cmVmZXJlbmNlc30gPSBtZSxcbiAgICAgICAgICAgIGtleTtcblxuICAgICAgICBmb3IgKGtleSBpbiByZWZlcmVuY2VzKSB7XG4gICAgICAgICAgICBpZiAoY29tcG9uZW50ID09PSByZWZlcmVuY2VzW2tleV0pIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgcmVmZXJlbmNlc1trZXldO1xuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBtZS5nZXRQYXJlbnQoKT8ucmVtb3ZlUmVmZXJlbmNlKGNvbXBvbmVudClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZW5pZW5jZSBzaG9ydGN1dFxuICAgICAqIEBwYXJhbSBhcmdzXG4gICAgICovXG4gICAgc2V0U3RhdGUoLi4uYXJncykge1xuICAgICAgICB0aGlzLmdldFN0YXRlUHJvdmlkZXIoKS5zZXREYXRhKC4uLmFyZ3MpXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhDb21wb25lbnQpO1xuIiwiaW1wb3J0IEJ1dHRvbiAgICBmcm9tICcuLi9idXR0b24vQmFzZS5tanMnO1xuaW1wb3J0IENvbXBvbmVudCBmcm9tICcuLi9jb21wb25lbnQvQmFzZS5tanMnO1xuaW1wb3J0IENvbnRhaW5lciBmcm9tICcuLi9jb250YWluZXIvQmFzZS5tanMnO1xuaW1wb3J0IExhYmVsICAgICBmcm9tICcuLi9jb21wb25lbnQvTGFiZWwubWpzJztcbmltcG9ydCBOZW9BcnJheSAgZnJvbSAnLi4vdXRpbC9BcnJheS5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8udG9vbGJhci5CYXNlXG4gKiBAZXh0ZW5kcyBOZW8uY29udGFpbmVyLkJhc2VcbiAqL1xuY2xhc3MgVG9vbGJhciBleHRlbmRzIENvbnRhaW5lciB7XG4gICAgLyoqXG4gICAgICogVmFsaWQgdmFsdWVzIGZvciBkb2NrXG4gICAgICogQG1lbWJlciB7U3RyaW5nW119IGRvY2tQb3NpdGlvbnM9Wyd0b3AnLCdyaWdodCcsJ2JvdHRvbScsJ2xlZnQnLCBudWxsXVxuICAgICAqIEBzdGF0aWNcbiAgICAgKi9cbiAgICBzdGF0aWMgZG9ja1Bvc2l0aW9ucyA9IFsndG9wJywgJ3JpZ2h0JywgJ2JvdHRvbScsICdsZWZ0JywgbnVsbF1cblxuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLnRvb2xiYXIuQmFzZSdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLnRvb2xiYXIuQmFzZScsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSd0b29sYmFyJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ3Rvb2xiYXInLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nW119IGJhc2VDbHM9WyduZW8tdG9vbGJhciddXG4gICAgICAgICAqL1xuICAgICAgICBiYXNlQ2xzOiBbJ25lby10b29sYmFyJ10sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd8bnVsbH0gZG9ja189bnVsbFxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIGRvY2tfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSBpdGVtRGVmYXVsdHM9e250eXBlOididXR0b24nfVxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIGl0ZW1EZWZhdWx0czoge1xuICAgICAgICAgICAgbnR5cGU6ICdidXR0b24nXG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGxheW91dD17bnR5cGU6J2ZsZXhib3gnLGFsaWduOidjZW50ZXInLGRpcmVjdGlvbjogJ3JvdycsIHBhY2s6J3N0YXJ0J31cbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBsYXlvdXQ6IHtcbiAgICAgICAgICAgIG50eXBlICAgIDogJ2ZsZXhib3gnLFxuICAgICAgICAgICAgYWxpZ24gICAgOiAnY2VudGVyJyxcbiAgICAgICAgICAgIGRpcmVjdGlvbjogJ3JvdycsXG4gICAgICAgICAgICBwYWNrICAgICA6ICdzdGFydCdcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgZG9jayBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXREb2NrKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBpZiAoIXZhbHVlICYmICFvbGRWYWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbWUgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7Y2xzfSAgICAgICAgID0gbWUsXG4gICAgICAgICAgICBkb2NrUG9zaXRpb25zID0gbWUuZ2V0U3RhdGljQ29uZmlnKCdkb2NrUG9zaXRpb25zJyksXG4gICAgICAgICAgICBsYXlvdXRDb25maWcgID0gbWUuZ2V0TGF5b3V0Q29uZmlnKCk7XG5cbiAgICAgICAgZG9ja1Bvc2l0aW9ucy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICBrZXkgIT09IG51bGwgJiYgTmVvQXJyYXkudG9nZ2xlKGNscywgJ25lby1kb2NrLScgKyBrZXksIGtleSA9PT0gdmFsdWUpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghbWUubGF5b3V0KSB7XG4gICAgICAgICAgICBsYXlvdXRDb25maWcubnR5cGUgPSAnZmxleGJveCc7XG4gICAgICAgICAgICBtZS5zZXQoe2NscywgbGF5b3V0OiBsYXlvdXRDb25maWd9KVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWUubGF5b3V0LnNldChsYXlvdXRDb25maWcpO1xuICAgICAgICAgICAgbWUuY2xzID0gY2xzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHRoZSBuZXcgZG9jayBwb3NpdGlvbiBtYXRjaGVzIGEgdmFsdWUgb2YgdGhlIHN0YXRpYyBkb2NrUG9zaXRpb25zIGNvbmZpZ1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldERvY2sodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVNldEVudW1WYWx1ZSh2YWx1ZSwgb2xkVmFsdWUsICdkb2NrJywgJ2RvY2tQb3NpdGlvbnMnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgY3JlYXRlSXRlbXMoKSB7XG4gICAgICAgIGxldCBpdGVtcyA9IHRoaXMuX2l0ZW1zO1xuXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW1zKSkge1xuICAgICAgICAgICAgdGhpcy5faXRlbXMgPSBpdGVtcy5tYXAoaXRlbSA9PiB0aGlzLnJlcGxhY2VTcGFjZXIoaXRlbSkpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc3VwZXIuY3JlYXRlSXRlbXMoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBsYXlvdXQgY29uZmlnIGRlcGVuZGluZyBvbiB0aGlzLmRvY2tcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBsYXlvdXRDb25maWdcbiAgICAgKi9cbiAgICBnZXRMYXlvdXRDb25maWcoKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXMsXG4gICAgICAgICAgICBsYXlvdXRDb25maWc7XG5cbiAgICAgICAgaWYgKG1lLmRvY2spIHtcbiAgICAgICAgICAgIHN3aXRjaCAobWUuZG9jaykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0Q29uZmlnID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxpZ24gICAgOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ3JvdycsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWNrICAgICA6ICdzdGFydCdcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0Q29uZmlnID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxpZ24gICAgOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ2NvbHVtbi1yZXZlcnNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhY2sgICAgIDogJ3N0YXJ0J1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0Q29uZmlnID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxpZ24gICAgOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWNrICAgICA6ICdzdGFydCdcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBsYXlvdXRDb25maWcgfHwgbWUubGF5b3V0XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0cyBhbiBpdGVtIG9yIGFycmF5IG9mIGl0ZW1zIGF0IGEgc3BlY2lmaWMgaW5kZXhcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXhcbiAgICAgKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gaXRlbVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3NpbGVudD1mYWxzZV1cbiAgICAgKiBAcmV0dXJucyB7TmVvLmNvbXBvbmVudC5CYXNlfE5lby5jb21wb25lbnQuQmFzZVtdfVxuICAgICAqL1xuICAgIGluc2VydChpbmRleCwgaXRlbSwgc2lsZW50PWZhbHNlKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0pKSB7XG4gICAgICAgICAgICBpdGVtID0gaXRlbS5tYXAoaXRlbSA9PiB0aGlzLnJlcGxhY2VTcGFjZXIoaXRlbSkpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtID0gdGhpcy5yZXBsYWNlU3BhY2VyKGl0ZW0pXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc3VwZXIuaW5zZXJ0KGluZGV4LCBpdGVtLCBzaWxlbnQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtBcnJheXxPYmplY3R8U3RyaW5nfSBpdGVtXG4gICAgICogQHJldHVybnMge0FycmF5fE9iamVjdH1cbiAgICAgKi9cbiAgICByZXBsYWNlU3BhY2VyKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0gPT09ICctPicgPyB7bW9kdWxlOiBDb21wb25lbnQsIGZsZXg6IDF9IDogaXRlbVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoVG9vbGJhcik7XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9