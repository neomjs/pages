export const __webpack_esm_id__ = "vendors-src_menu_List_mjs";
export const __webpack_esm_ids__ = ["vendors-src_menu_List_mjs"];
export const __webpack_esm_modules__ = {

/***/ "./src/menu/List.mjs"
/*!***************************!*\
  !*** ./src/menu/List.mjs ***!
  \***************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _list_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../list/Base.mjs */ "./src/list/Base.mjs");
/* harmony import */ var _selection_menu_ListModel_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../selection/menu/ListModel.mjs */ "./src/selection/menu/ListModel.mjs");
/* harmony import */ var _Store_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Store.mjs */ "./src/menu/Store.mjs");




/**
 * @class Neo.menu.List
 * @extends Neo.list.Base
 */
class List extends _list_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.menu.List'
         * @protected
         */
        className: 'Neo.menu.List',
        /**
         * @member {String} ntype='menu-list'
         * @protected
         */
        ntype: 'menu-list',
        /**
         * Read only. We are storing the currently visible subMenu instance.
         * @member {Neo.menu.List|Neo.menu.Panel|null} activeSubMenu=null
         */
        activeSubMenu: null,
        /**
         * @member {String[]} baseCls=['neo-menu-list','neo-list']
         */
        baseCls: ['neo-menu-list', 'neo-list'],
        /**
         * setTimeout() id after a focus-leave event.
         * @member {Number|null} focusTimeoutId=null
         * @protected
         */
        focusTimeoutId: null,
        /**
         * Hides a floating list on leaf item click, in case it has a parentComponent
         * @member {Boolean} hideOnLeafItemClick=true
         */
        hideOnLeafItemClick: true,
        /**
         * Optionally pass menu.Store data directly
         * @member {Object[]|null} items_=null
         * @reactive
         */
        items_: null,
        /**
         * Internal flag.
         * Sub-menus will bubble focus changes to the top level.
         * @member {Boolean} menuFocus_=false
         * @protected
         * @reactive
         */
        menuFocus_: false,
        /**
         * Internal flag.
         * True for a top level menu, false for sub-menus.
         * @member {Boolean} isRoot=true
         * @protected
         */
        isRoot: true,
        /**
         * Storing the list item index of the parent menu in case it exists.
         * @member {Number} parentIndex=0
         * @protected
         */
        parentIndex: 0,
        /**
         * Storing a reference to the parent menu in case it exists.
         * @member {Neo.menu.List|Neo.menu.Panel|null} parentMenu=null
         * @protected
         */
        parentMenu: null,
        /**
         * Value for the list.Base selectionModel_ config
         * @member {Neo.selection.menu.ListModel} selectionModel=ListModel
         * @reactive
         */
        selectionModel: _selection_menu_ListModel_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
        /**
         * Value for the list.Base store_ config
         * @member {Neo.menu.Store} store=Store
         * @reactive
         */
        store: _Store_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
        /**
         * The distance in px between a menu and a child menu
         * See: https://github.com/neomjs/neo/issues/2569
         * @member {Number} subMenuGap=0
         */
        subMenuGap: 0,
        /**
         * Storing childMenus by record keyProperty
         * @member {Object} subMenuMap=null
         * @protected
         */
        subMenuMap: null,
        /**
         * We are applying a z-index style which is 1 number higher to each sub-menu
         * @member {Number} zIndex_=100
         * @reactive
         */
        zIndex_: 100,
        /**
         * @member {Object} _vdom
         */
        _vdom:
        {tag: 'ul', cn: []}
    }

    /**
     * If the menu is floating, it will anchor itself to the parentRect
     * @member {Neo.component.Base|null} parentComponent=null
     * @reactive
     */
    parentComponent = null

    /**
     * Triggered after the items config got changed
     * @param {Object[]} value
     * @param {Object[]} oldValue
     * @protected
     */
    afterSetItems(value, oldValue) {
        let {store} = this;

        oldValue && store.clear(); // we can not use remove() here, since items are no records => often no id
        value    && store.add(value)
    }

    /**
     * Triggered after the menuFocus config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetMenuFocus(value, oldValue) {
        if (oldValue !== undefined) {
            let me = this;

            if (me.isRoot) {
                if (!value) {
                    me.focusTimeoutId = setTimeout(() => {
                        me[me.floating ? 'unmount' : 'hideSubMenu']()
                    }, 20)
                } else {
                    clearTimeout(me.focusTimeoutId);
                    me.focusTimeoutId = null
                }
            } else {
                // bubble the focus change upwards
                me.parentMenu.menuFocus = value
            }
        }
    }

    /**
     * Triggered after the theme config got changed
     * @param {String|null} value
     * @param {String|null} oldValue
     * @protected
     */
    afterSetTheme(value, oldValue) {
        super.afterSetTheme(value, oldValue);

        Object.values(this.subMenuMap || {}).forEach(menu => {
            menu.theme = value
        })
    }

    /**
     * Triggered after the zIndex config got changed
     * @param {Number} value
     * @param {Number} oldValue
     * @protected
     */
    afterSetZIndex(value, oldValue) {
        this.style = {...this.style, zIndex: value}
    }

    /**
     * Override this method for custom renderers
     * @param {Object} record
     * @param {Number} index
     * @returns {Object|Object[]|String} Either a config object to assign to the item, a vdom cn array or a html string
     */
    createItemContent(record, index) {
        let me        = this,
            {iconCls} = record,
            id        = record[me.store.keyProperty],
            vdomCn    = [{tag: 'span', cls: ['neo-content'], text: record[me.displayField]}];

        if (iconCls && iconCls !== '') {
            vdomCn.unshift({tag: 'i', cls: ['neo-menu-icon', 'neo-icon', iconCls], id: me.getIconId(id)})
        }

        if (me.hasChildren(record)) {
            vdomCn.push({tag: 'i', cls: ['neo-arrow-icon', 'neo-icon', 'fas fa-chevron-right'], id: me.getArrowIconId(id)})
        }

        return vdomCn
    }

    /**
     *
     */
    destroy(...args) {
        let me              = this,
            {activeSubMenu} = me,
            subMenuMap      = me.subMenuMap || {};

        activeSubMenu?.unmount();

        Object.entries(subMenuMap).forEach(([key, value]) => {
            value.destroy();
            subMenuMap[key] = null
        });

        super.destroy(...args)
    }

    /**
     * @param {Number|String} recordId
     * @returns {String}
     */
    getArrowIconId(recordId) {
        return `${this.id}__arrow_icon__${recordId}`
    }

    /**
     * @param {Number|String} recordId
     * @returns {String}
     */
    getIconId(recordId) {
        return `${this.id}__icon__${recordId}`
    }

    /**
     * recordIds can be Numbers, so we do need a prefix
     * @param {Number|String} recordId
     * @returns {String}
     */
    getMenuMapId(recordId) {
        return `menu__${recordId}`
    }

    /**
     * Checks if a record has items
     * @param {Object} record
     * @returns {Boolean}
     */
    hasChildren(record) {
        return Array.isArray(record.items) && record.items.length > 0
    }

    /**
     *
     */
    hideSubMenu() {
        let {activeSubMenu} = this;

        if (activeSubMenu) {
            activeSubMenu.unmount();
            this.activeSubMenu = null
        }
    }

    /**
     * @param {Object} data
     * @param {Object[]} data.path
     */
    onFocusEnter(data) {
        super.onFocusEnter(data);
        this.menuFocus = true
    }

    /**
     * @param {Object} data
     * @param {Object[]} data.oldPath
     */
    onFocusLeave(data) {
        super.onFocusLeave(data);

        let insideParent = false,
            parentId     = this.parentComponent?.id,
            item;

        if (parentId) {
            for (item of data.oldPath) {
                if (item.id === parentId) {
                    insideParent = true;
                    break
                }
            }
        }

        if (!insideParent) {
            this.menuFocus = false
        }
    }

    /**
     * @param {Object} node
     * @param {Object} data
     */
    onItemClick(node, data) {
        super.onItemClick(node, data);

        this.onKeyDownEnter(node.id)
    }

    /**
     * @param {String} nodeId
     */
    onKeyDownEnter(nodeId) {
        if (nodeId) {
            let me       = this,
                recordId = me.getItemRecordId(nodeId),
                record   = me.store.get(recordId),
                submenu;

            me.callback(record.handler, me, [record]);

            record.route && Neo.Main.setRoute({
                appName: me.appName,
                value  : record.route
            });

            me.hideOnLeafItemClick && !record.items && me.unmount();

            if (record.items) {
                submenu = me.subMenuMap?.[me.getMenuMapId(recordId)];

                if (submenu) {
                    me.toggleSubMenu(nodeId, record)
                }
            }
        }
    }

    /**
     * @param {Object} data
     */
    onKeyDownEscape(data) {
        this.floating && this.unmount()
    }

    /**
     * @param {String[]} items
     */
    onSelect(items) {
        let me       = this,
            nodeId   = items[0],
            recordId = me.getItemRecordId(nodeId),
            record   = me.store.get(recordId);

        if (me.activeSubMenu !== me.subMenuMap?.[me.getMenuMapId(recordId)]) {
            me.hideSubMenu();
            me.hasChildren(record) && me.showSubMenu(nodeId, record)
        }
    }

    /**
     * @param {String} nodeId
     * @param {Object} record
     */
    showSubMenu(nodeId, record) {
        const
            me           = this,
            {store}      = me,
            recordId     = record[store.keyProperty],
            subMenuMap   = me.subMenuMap || (me.subMenuMap = {}),
            subMenuMapId = me.getMenuMapId(recordId),
            subMenu      = subMenuMap[subMenuMapId] || (subMenuMap[subMenuMapId] = Neo.create({
                module         : List,
                align          : {
                    target       : nodeId,
                    edgeAlign    : 'l0-r0',
                    axisLock     : true,
                    targetMargin : me.subMenuGap
                },
                appName        : me.appName,
                displayField   : me.displayField,
                floating       : true,
                items          : record.items,
                isRoot         : false,
                parentComponent: me.parentComponent,
                parentId       : me.app.mainView.id,
                parentIndex    : store.indexOf(record),
                parentMenu     : me,
                theme          : me.theme,
                zIndex         : me.zIndex + 1
            }));

        if (me.activeSubMenu !== subMenu) {
            me.activeSubMenu = subMenu;
            subMenu.initVnode(true)
        }
    }

    /**
     * @param {String} nodeId
     * @param {Object} record
     */
    toggleSubMenu(nodeId, record) {
        let me       = this,
            recordId = record[me.getKeyProperty()],
            submenu  = me.subMenuMap?.[me.getMenuMapId(recordId)];

        if (!submenu?.mounted) {
            me.showSubMenu(nodeId, record)
        } else {
            me.hideSubMenu()
        }
    }

    /**
     *
     */
    unmount() {
        this.selectionModel?.deselectAll(true); // silent update
        this.hideSubMenu();

        super.unmount()
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(List));


/***/ },

/***/ "./src/menu/Model.mjs"
/*!****************************!*\
  !*** ./src/menu/Model.mjs ***!
  \****************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/data/Model.mjs */ "./src/data/Model.mjs");


/**
 * @class Neo.menu.Model
 * @extends Neo.data.Model
 */
class Model extends _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.menu.Model'
         * @protected
         */
        className: 'Neo.menu.Model',
        /**
         * @member {String} keyProperty='id'
         * @reactive
         */
        keyProperty: 'id',
        /**
         * @member {Object[]} fields
         */
        fields: [{
            name: 'cls',
            type: 'Array'
        }, {
            name: 'handler',
            type: 'Function'
        }, {
            name: 'hidden',
            type: 'Boolean'
        }, {
            name: 'iconCls',
            type: 'String'
        }, {
            name: 'id',
            type: 'Integer'
        }, {
            name: 'items', // optional
            type: 'Array'
        }, {
            name: 'route',
            type: 'String'
        }, {
            name: 'text',
            type: 'String'
        }]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Model));


/***/ },

/***/ "./src/menu/Store.mjs"
/*!****************************!*\
  !*** ./src/menu/Store.mjs ***!
  \****************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Model_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Model.mjs */ "./src/menu/Model.mjs");
/* harmony import */ var _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/data/Store.mjs */ "./src/data/Store.mjs");



/**
 * @class Neo.menu.Store
 * @extends Neo.data.Store
 */
class Store extends _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.menu.Store'
         * @protected
         */
        className: 'Neo.menu.Store',
        /**
         * @member {Neo.menu.Model} model=Model
         * @reactive
         */
        model: _Model_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Store));


/***/ },

/***/ "./src/selection/menu/ListModel.mjs"
/*!******************************************!*\
  !*** ./src/selection/menu/ListModel.mjs ***!
  \******************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _ListModel_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../ListModel.mjs */ "./src/selection/ListModel.mjs");


/**
 * @class Neo.selection.menu.ListModel
 * @extends Neo.selection.ListModel
 */
class ListModel extends _ListModel_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.selection.menu.ListModel'
         * @protected
         */
        className: 'Neo.selection.menu.ListModel',
        /**
         * @member {String} ntype='selection-menu-listmodel'
         * @protected
         */
        ntype: 'selection-menu-listmodel'
    }

    /**
     * @param {Object} data
     */
    onKeyDownEscape(data) {
        this.view.onKeyDownEscape(data)
    }

    /**
     * @param {Object} data
     */
    onKeyDownLeft(data) {
        let {view}       = this,
            {parentMenu} = view;

        if (parentMenu) {
            view.hideSubMenu();
            view.selectionModel.deselectAll();
            parentMenu.selectionModel.selectAt(view.parentIndex)
        }
    }

    /**
     * @param {Object} data
     */
    onKeyDownRight(data) {
        this.view.activeSubMenu?.selectionModel.selectAt(0)
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(ListModel));


/***/ }

};

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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b0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0EsYUFBYSxZQUFZO0FBQ3pCLGFBQWEsWUFBWTs7QUFFekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUVBQWUseUJBQXlCLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL21lbnUvTGlzdC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9tZW51L01vZGVsLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL21lbnUvU3RvcmUubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvc2VsZWN0aW9uL21lbnUvTGlzdE1vZGVsLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmFzZUxpc3QgIGZyb20gJy4uL2xpc3QvQmFzZS5tanMnO1xuaW1wb3J0IExpc3RNb2RlbCBmcm9tICcuLi9zZWxlY3Rpb24vbWVudS9MaXN0TW9kZWwubWpzJztcbmltcG9ydCBTdG9yZSAgICAgZnJvbSAnLi9TdG9yZS5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8ubWVudS5MaXN0XG4gKiBAZXh0ZW5kcyBOZW8ubGlzdC5CYXNlXG4gKi9cbmNsYXNzIExpc3QgZXh0ZW5kcyBCYXNlTGlzdCB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8ubWVudS5MaXN0J1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8ubWVudS5MaXN0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gbnR5cGU9J21lbnUtbGlzdCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgbnR5cGU6ICdtZW51LWxpc3QnLFxuICAgICAgICAvKipcbiAgICAgICAgICogUmVhZCBvbmx5LiBXZSBhcmUgc3RvcmluZyB0aGUgY3VycmVudGx5IHZpc2libGUgc3ViTWVudSBpbnN0YW5jZS5cbiAgICAgICAgICogQG1lbWJlciB7TmVvLm1lbnUuTGlzdHxOZW8ubWVudS5QYW5lbHxudWxsfSBhY3RpdmVTdWJNZW51PW51bGxcbiAgICAgICAgICovXG4gICAgICAgIGFjdGl2ZVN1Yk1lbnU6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmdbXX0gYmFzZUNscz1bJ25lby1tZW51LWxpc3QnLCduZW8tbGlzdCddXG4gICAgICAgICAqL1xuICAgICAgICBiYXNlQ2xzOiBbJ25lby1tZW51LWxpc3QnLCAnbmVvLWxpc3QnXSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHNldFRpbWVvdXQoKSBpZCBhZnRlciBhIGZvY3VzLWxlYXZlIGV2ZW50LlxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ8bnVsbH0gZm9jdXNUaW1lb3V0SWQ9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBmb2N1c1RpbWVvdXRJZDogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpZGVzIGEgZmxvYXRpbmcgbGlzdCBvbiBsZWFmIGl0ZW0gY2xpY2ssIGluIGNhc2UgaXQgaGFzIGEgcGFyZW50Q29tcG9uZW50XG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IGhpZGVPbkxlYWZJdGVtQ2xpY2s9dHJ1ZVxuICAgICAgICAgKi9cbiAgICAgICAgaGlkZU9uTGVhZkl0ZW1DbGljazogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wdGlvbmFsbHkgcGFzcyBtZW51LlN0b3JlIGRhdGEgZGlyZWN0bHlcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0W118bnVsbH0gaXRlbXNfPW51bGxcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBpdGVtc186IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnRlcm5hbCBmbGFnLlxuICAgICAgICAgKiBTdWItbWVudXMgd2lsbCBidWJibGUgZm9jdXMgY2hhbmdlcyB0byB0aGUgdG9wIGxldmVsLlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBtZW51Rm9jdXNfPWZhbHNlXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBtZW51Rm9jdXNfOiBmYWxzZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIGZsYWcuXG4gICAgICAgICAqIFRydWUgZm9yIGEgdG9wIGxldmVsIG1lbnUsIGZhbHNlIGZvciBzdWItbWVudXMuXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IGlzUm9vdD10cnVlXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGlzUm9vdDogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JpbmcgdGhlIGxpc3QgaXRlbSBpbmRleCBvZiB0aGUgcGFyZW50IG1lbnUgaW4gY2FzZSBpdCBleGlzdHMuXG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcn0gcGFyZW50SW5kZXg9MFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBwYXJlbnRJbmRleDogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JpbmcgYSByZWZlcmVuY2UgdG8gdGhlIHBhcmVudCBtZW51IGluIGNhc2UgaXQgZXhpc3RzLlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8ubWVudS5MaXN0fE5lby5tZW51LlBhbmVsfG51bGx9IHBhcmVudE1lbnU9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBwYXJlbnRNZW51OiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogVmFsdWUgZm9yIHRoZSBsaXN0LkJhc2Ugc2VsZWN0aW9uTW9kZWxfIGNvbmZpZ1xuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uc2VsZWN0aW9uLm1lbnUuTGlzdE1vZGVsfSBzZWxlY3Rpb25Nb2RlbD1MaXN0TW9kZWxcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxlY3Rpb25Nb2RlbDogTGlzdE1vZGVsLFxuICAgICAgICAvKipcbiAgICAgICAgICogVmFsdWUgZm9yIHRoZSBsaXN0LkJhc2Ugc3RvcmVfIGNvbmZpZ1xuICAgICAgICAgKiBAbWVtYmVyIHtOZW8ubWVudS5TdG9yZX0gc3RvcmU9U3RvcmVcbiAgICAgICAgICogQHJlYWN0aXZlXG4gICAgICAgICAqL1xuICAgICAgICBzdG9yZTogU3RvcmUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGlzdGFuY2UgaW4gcHggYmV0d2VlbiBhIG1lbnUgYW5kIGEgY2hpbGQgbWVudVxuICAgICAgICAgKiBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9uZW9tanMvbmVvL2lzc3Vlcy8yNTY5XG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcn0gc3ViTWVudUdhcD0wXG4gICAgICAgICAqL1xuICAgICAgICBzdWJNZW51R2FwOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmluZyBjaGlsZE1lbnVzIGJ5IHJlY29yZCBrZXlQcm9wZXJ0eVxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IHN1Yk1lbnVNYXA9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBzdWJNZW51TWFwOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogV2UgYXJlIGFwcGx5aW5nIGEgei1pbmRleCBzdHlsZSB3aGljaCBpcyAxIG51bWJlciBoaWdoZXIgdG8gZWFjaCBzdWItbWVudVxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IHpJbmRleF89MTAwXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgekluZGV4XzogMTAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSBfdmRvbVxuICAgICAgICAgKi9cbiAgICAgICAgX3Zkb206XG4gICAgICAgIHt0YWc6ICd1bCcsIGNuOiBbXX1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJZiB0aGUgbWVudSBpcyBmbG9hdGluZywgaXQgd2lsbCBhbmNob3IgaXRzZWxmIHRvIHRoZSBwYXJlbnRSZWN0XG4gICAgICogQG1lbWJlciB7TmVvLmNvbXBvbmVudC5CYXNlfG51bGx9IHBhcmVudENvbXBvbmVudD1udWxsXG4gICAgICogQHJlYWN0aXZlXG4gICAgICovXG4gICAgcGFyZW50Q29tcG9uZW50ID0gbnVsbFxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBpdGVtcyBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0SXRlbXModmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGxldCB7c3RvcmV9ID0gdGhpcztcblxuICAgICAgICBvbGRWYWx1ZSAmJiBzdG9yZS5jbGVhcigpOyAvLyB3ZSBjYW4gbm90IHVzZSByZW1vdmUoKSBoZXJlLCBzaW5jZSBpdGVtcyBhcmUgbm8gcmVjb3JkcyA9PiBvZnRlbiBubyBpZFxuICAgICAgICB2YWx1ZSAgICAmJiBzdG9yZS5hZGQodmFsdWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBtZW51Rm9jdXMgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtCb29sZWFufSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRNZW51Rm9jdXModmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGlmIChvbGRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAobWUuaXNSb290KSB7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBtZS5mb2N1c1RpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVbbWUuZmxvYXRpbmcgPyAndW5tb3VudCcgOiAnaGlkZVN1Yk1lbnUnXSgpXG4gICAgICAgICAgICAgICAgICAgIH0sIDIwKVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChtZS5mb2N1c1RpbWVvdXRJZCk7XG4gICAgICAgICAgICAgICAgICAgIG1lLmZvY3VzVGltZW91dElkID0gbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gYnViYmxlIHRoZSBmb2N1cyBjaGFuZ2UgdXB3YXJkc1xuICAgICAgICAgICAgICAgIG1lLnBhcmVudE1lbnUubWVudUZvY3VzID0gdmFsdWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgdGhlbWUgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldFRoZW1lKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBzdXBlci5hZnRlclNldFRoZW1lKHZhbHVlLCBvbGRWYWx1ZSk7XG5cbiAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnN1Yk1lbnVNYXAgfHwge30pLmZvckVhY2gobWVudSA9PiB7XG4gICAgICAgICAgICBtZW51LnRoZW1lID0gdmFsdWVcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIHpJbmRleCBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRaSW5kZXgodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHRoaXMuc3R5bGUgPSB7Li4udGhpcy5zdHlsZSwgekluZGV4OiB2YWx1ZX1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPdmVycmlkZSB0aGlzIG1ldGhvZCBmb3IgY3VzdG9tIHJlbmRlcmVyc1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWNvcmRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXhcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fE9iamVjdFtdfFN0cmluZ30gRWl0aGVyIGEgY29uZmlnIG9iamVjdCB0byBhc3NpZ24gdG8gdGhlIGl0ZW0sIGEgdmRvbSBjbiBhcnJheSBvciBhIGh0bWwgc3RyaW5nXG4gICAgICovXG4gICAgY3JlYXRlSXRlbUNvbnRlbnQocmVjb3JkLCBpbmRleCkge1xuICAgICAgICBsZXQgbWUgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHtpY29uQ2xzfSA9IHJlY29yZCxcbiAgICAgICAgICAgIGlkICAgICAgICA9IHJlY29yZFttZS5zdG9yZS5rZXlQcm9wZXJ0eV0sXG4gICAgICAgICAgICB2ZG9tQ24gICAgPSBbe3RhZzogJ3NwYW4nLCBjbHM6IFsnbmVvLWNvbnRlbnQnXSwgdGV4dDogcmVjb3JkW21lLmRpc3BsYXlGaWVsZF19XTtcblxuICAgICAgICBpZiAoaWNvbkNscyAmJiBpY29uQ2xzICE9PSAnJykge1xuICAgICAgICAgICAgdmRvbUNuLnVuc2hpZnQoe3RhZzogJ2knLCBjbHM6IFsnbmVvLW1lbnUtaWNvbicsICduZW8taWNvbicsIGljb25DbHNdLCBpZDogbWUuZ2V0SWNvbklkKGlkKX0pXG4gICAgICAgIH1cblxuICAgICAgICBpZiAobWUuaGFzQ2hpbGRyZW4ocmVjb3JkKSkge1xuICAgICAgICAgICAgdmRvbUNuLnB1c2goe3RhZzogJ2knLCBjbHM6IFsnbmVvLWFycm93LWljb24nLCAnbmVvLWljb24nLCAnZmFzIGZhLWNoZXZyb24tcmlnaHQnXSwgaWQ6IG1lLmdldEFycm93SWNvbklkKGlkKX0pXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmRvbUNuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBkZXN0cm95KC4uLmFyZ3MpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7YWN0aXZlU3ViTWVudX0gPSBtZSxcbiAgICAgICAgICAgIHN1Yk1lbnVNYXAgICAgICA9IG1lLnN1Yk1lbnVNYXAgfHwge307XG5cbiAgICAgICAgYWN0aXZlU3ViTWVudT8udW5tb3VudCgpO1xuXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKHN1Yk1lbnVNYXApLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgdmFsdWUuZGVzdHJveSgpO1xuICAgICAgICAgICAgc3ViTWVudU1hcFtrZXldID0gbnVsbFxuICAgICAgICB9KTtcblxuICAgICAgICBzdXBlci5kZXN0cm95KC4uLmFyZ3MpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ8U3RyaW5nfSByZWNvcmRJZFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9XG4gICAgICovXG4gICAgZ2V0QXJyb3dJY29uSWQocmVjb3JkSWQpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuaWR9X19hcnJvd19pY29uX18ke3JlY29yZElkfWBcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge051bWJlcnxTdHJpbmd9IHJlY29yZElkXG4gICAgICogQHJldHVybnMge1N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRJY29uSWQocmVjb3JkSWQpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuaWR9X19pY29uX18ke3JlY29yZElkfWBcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiByZWNvcmRJZHMgY2FuIGJlIE51bWJlcnMsIHNvIHdlIGRvIG5lZWQgYSBwcmVmaXhcbiAgICAgKiBAcGFyYW0ge051bWJlcnxTdHJpbmd9IHJlY29yZElkXG4gICAgICogQHJldHVybnMge1N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRNZW51TWFwSWQocmVjb3JkSWQpIHtcbiAgICAgICAgcmV0dXJuIGBtZW51X18ke3JlY29yZElkfWBcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYSByZWNvcmQgaGFzIGl0ZW1zXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlY29yZFxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgICAqL1xuICAgIGhhc0NoaWxkcmVuKHJlY29yZCkge1xuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShyZWNvcmQuaXRlbXMpICYmIHJlY29yZC5pdGVtcy5sZW5ndGggPiAwXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBoaWRlU3ViTWVudSgpIHtcbiAgICAgICAgbGV0IHthY3RpdmVTdWJNZW51fSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKGFjdGl2ZVN1Yk1lbnUpIHtcbiAgICAgICAgICAgIGFjdGl2ZVN1Yk1lbnUudW5tb3VudCgpO1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVTdWJNZW51ID0gbnVsbFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhLnBhdGhcbiAgICAgKi9cbiAgICBvbkZvY3VzRW50ZXIoZGF0YSkge1xuICAgICAgICBzdXBlci5vbkZvY3VzRW50ZXIoZGF0YSk7XG4gICAgICAgIHRoaXMubWVudUZvY3VzID0gdHJ1ZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtPYmplY3RbXX0gZGF0YS5vbGRQYXRoXG4gICAgICovXG4gICAgb25Gb2N1c0xlYXZlKGRhdGEpIHtcbiAgICAgICAgc3VwZXIub25Gb2N1c0xlYXZlKGRhdGEpO1xuXG4gICAgICAgIGxldCBpbnNpZGVQYXJlbnQgPSBmYWxzZSxcbiAgICAgICAgICAgIHBhcmVudElkICAgICA9IHRoaXMucGFyZW50Q29tcG9uZW50Py5pZCxcbiAgICAgICAgICAgIGl0ZW07XG5cbiAgICAgICAgaWYgKHBhcmVudElkKSB7XG4gICAgICAgICAgICBmb3IgKGl0ZW0gb2YgZGF0YS5vbGRQYXRoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IHBhcmVudElkKSB7XG4gICAgICAgICAgICAgICAgICAgIGluc2lkZVBhcmVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpbnNpZGVQYXJlbnQpIHtcbiAgICAgICAgICAgIHRoaXMubWVudUZvY3VzID0gZmFsc2VcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbkl0ZW1DbGljayhub2RlLCBkYXRhKSB7XG4gICAgICAgIHN1cGVyLm9uSXRlbUNsaWNrKG5vZGUsIGRhdGEpO1xuXG4gICAgICAgIHRoaXMub25LZXlEb3duRW50ZXIobm9kZS5pZClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbm9kZUlkXG4gICAgICovXG4gICAgb25LZXlEb3duRW50ZXIobm9kZUlkKSB7XG4gICAgICAgIGlmIChub2RlSWQpIHtcbiAgICAgICAgICAgIGxldCBtZSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcmVjb3JkSWQgPSBtZS5nZXRJdGVtUmVjb3JkSWQobm9kZUlkKSxcbiAgICAgICAgICAgICAgICByZWNvcmQgICA9IG1lLnN0b3JlLmdldChyZWNvcmRJZCksXG4gICAgICAgICAgICAgICAgc3VibWVudTtcblxuICAgICAgICAgICAgbWUuY2FsbGJhY2socmVjb3JkLmhhbmRsZXIsIG1lLCBbcmVjb3JkXSk7XG5cbiAgICAgICAgICAgIHJlY29yZC5yb3V0ZSAmJiBOZW8uTWFpbi5zZXRSb3V0ZSh7XG4gICAgICAgICAgICAgICAgYXBwTmFtZTogbWUuYXBwTmFtZSxcbiAgICAgICAgICAgICAgICB2YWx1ZSAgOiByZWNvcmQucm91dGVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtZS5oaWRlT25MZWFmSXRlbUNsaWNrICYmICFyZWNvcmQuaXRlbXMgJiYgbWUudW5tb3VudCgpO1xuXG4gICAgICAgICAgICBpZiAocmVjb3JkLml0ZW1zKSB7XG4gICAgICAgICAgICAgICAgc3VibWVudSA9IG1lLnN1Yk1lbnVNYXA/LlttZS5nZXRNZW51TWFwSWQocmVjb3JkSWQpXTtcblxuICAgICAgICAgICAgICAgIGlmIChzdWJtZW51KSB7XG4gICAgICAgICAgICAgICAgICAgIG1lLnRvZ2dsZVN1Yk1lbnUobm9kZUlkLCByZWNvcmQpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbktleURvd25Fc2NhcGUoZGF0YSkge1xuICAgICAgICB0aGlzLmZsb2F0aW5nICYmIHRoaXMudW5tb3VudCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtTdHJpbmdbXX0gaXRlbXNcbiAgICAgKi9cbiAgICBvblNlbGVjdChpdGVtcykge1xuICAgICAgICBsZXQgbWUgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgbm9kZUlkICAgPSBpdGVtc1swXSxcbiAgICAgICAgICAgIHJlY29yZElkID0gbWUuZ2V0SXRlbVJlY29yZElkKG5vZGVJZCksXG4gICAgICAgICAgICByZWNvcmQgICA9IG1lLnN0b3JlLmdldChyZWNvcmRJZCk7XG5cbiAgICAgICAgaWYgKG1lLmFjdGl2ZVN1Yk1lbnUgIT09IG1lLnN1Yk1lbnVNYXA/LlttZS5nZXRNZW51TWFwSWQocmVjb3JkSWQpXSkge1xuICAgICAgICAgICAgbWUuaGlkZVN1Yk1lbnUoKTtcbiAgICAgICAgICAgIG1lLmhhc0NoaWxkcmVuKHJlY29yZCkgJiYgbWUuc2hvd1N1Yk1lbnUobm9kZUlkLCByZWNvcmQpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbm9kZUlkXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlY29yZFxuICAgICAqL1xuICAgIHNob3dTdWJNZW51KG5vZGVJZCwgcmVjb3JkKSB7XG4gICAgICAgIGNvbnN0XG4gICAgICAgICAgICBtZSAgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAge3N0b3JlfSAgICAgID0gbWUsXG4gICAgICAgICAgICByZWNvcmRJZCAgICAgPSByZWNvcmRbc3RvcmUua2V5UHJvcGVydHldLFxuICAgICAgICAgICAgc3ViTWVudU1hcCAgID0gbWUuc3ViTWVudU1hcCB8fCAobWUuc3ViTWVudU1hcCA9IHt9KSxcbiAgICAgICAgICAgIHN1Yk1lbnVNYXBJZCA9IG1lLmdldE1lbnVNYXBJZChyZWNvcmRJZCksXG4gICAgICAgICAgICBzdWJNZW51ICAgICAgPSBzdWJNZW51TWFwW3N1Yk1lbnVNYXBJZF0gfHwgKHN1Yk1lbnVNYXBbc3ViTWVudU1hcElkXSA9IE5lby5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIG1vZHVsZSAgICAgICAgIDogTGlzdCxcbiAgICAgICAgICAgICAgICBhbGlnbiAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ICAgICAgIDogbm9kZUlkLFxuICAgICAgICAgICAgICAgICAgICBlZGdlQWxpZ24gICAgOiAnbDAtcjAnLFxuICAgICAgICAgICAgICAgICAgICBheGlzTG9jayAgICAgOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRNYXJnaW4gOiBtZS5zdWJNZW51R2FwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhcHBOYW1lICAgICAgICA6IG1lLmFwcE5hbWUsXG4gICAgICAgICAgICAgICAgZGlzcGxheUZpZWxkICAgOiBtZS5kaXNwbGF5RmllbGQsXG4gICAgICAgICAgICAgICAgZmxvYXRpbmcgICAgICAgOiB0cnVlLFxuICAgICAgICAgICAgICAgIGl0ZW1zICAgICAgICAgIDogcmVjb3JkLml0ZW1zLFxuICAgICAgICAgICAgICAgIGlzUm9vdCAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcGFyZW50Q29tcG9uZW50OiBtZS5wYXJlbnRDb21wb25lbnQsXG4gICAgICAgICAgICAgICAgcGFyZW50SWQgICAgICAgOiBtZS5hcHAubWFpblZpZXcuaWQsXG4gICAgICAgICAgICAgICAgcGFyZW50SW5kZXggICAgOiBzdG9yZS5pbmRleE9mKHJlY29yZCksXG4gICAgICAgICAgICAgICAgcGFyZW50TWVudSAgICAgOiBtZSxcbiAgICAgICAgICAgICAgICB0aGVtZSAgICAgICAgICA6IG1lLnRoZW1lLFxuICAgICAgICAgICAgICAgIHpJbmRleCAgICAgICAgIDogbWUuekluZGV4ICsgMVxuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIGlmIChtZS5hY3RpdmVTdWJNZW51ICE9PSBzdWJNZW51KSB7XG4gICAgICAgICAgICBtZS5hY3RpdmVTdWJNZW51ID0gc3ViTWVudTtcbiAgICAgICAgICAgIHN1Yk1lbnUuaW5pdFZub2RlKHRydWUpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbm9kZUlkXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlY29yZFxuICAgICAqL1xuICAgIHRvZ2dsZVN1Yk1lbnUobm9kZUlkLCByZWNvcmQpIHtcbiAgICAgICAgbGV0IG1lICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHJlY29yZElkID0gcmVjb3JkW21lLmdldEtleVByb3BlcnR5KCldLFxuICAgICAgICAgICAgc3VibWVudSAgPSBtZS5zdWJNZW51TWFwPy5bbWUuZ2V0TWVudU1hcElkKHJlY29yZElkKV07XG5cbiAgICAgICAgaWYgKCFzdWJtZW51Py5tb3VudGVkKSB7XG4gICAgICAgICAgICBtZS5zaG93U3ViTWVudShub2RlSWQsIHJlY29yZClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1lLmhpZGVTdWJNZW51KClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgdW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25Nb2RlbD8uZGVzZWxlY3RBbGwodHJ1ZSk7IC8vIHNpbGVudCB1cGRhdGVcbiAgICAgICAgdGhpcy5oaWRlU3ViTWVudSgpO1xuXG4gICAgICAgIHN1cGVyLnVubW91bnQoKVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoTGlzdCk7XG4iLCJpbXBvcnQgQmFzZU1vZGVsIGZyb20gJy4uLy4uL3NyYy9kYXRhL01vZGVsLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5tZW51Lk1vZGVsXG4gKiBAZXh0ZW5kcyBOZW8uZGF0YS5Nb2RlbFxuICovXG5jbGFzcyBNb2RlbCBleHRlbmRzIEJhc2VNb2RlbCB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8ubWVudS5Nb2RlbCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLm1lbnUuTW9kZWwnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBrZXlQcm9wZXJ0eT0naWQnXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAga2V5UHJvcGVydHk6ICdpZCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3RbXX0gZmllbGRzXG4gICAgICAgICAqL1xuICAgICAgICBmaWVsZHM6IFt7XG4gICAgICAgICAgICBuYW1lOiAnY2xzJyxcbiAgICAgICAgICAgIHR5cGU6ICdBcnJheSdcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ2hhbmRsZXInLFxuICAgICAgICAgICAgdHlwZTogJ0Z1bmN0aW9uJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnaGlkZGVuJyxcbiAgICAgICAgICAgIHR5cGU6ICdCb29sZWFuJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnaWNvbkNscycsXG4gICAgICAgICAgICB0eXBlOiAnU3RyaW5nJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnaWQnLFxuICAgICAgICAgICAgdHlwZTogJ0ludGVnZXInXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdpdGVtcycsIC8vIG9wdGlvbmFsXG4gICAgICAgICAgICB0eXBlOiAnQXJyYXknXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdyb3V0ZScsXG4gICAgICAgICAgICB0eXBlOiAnU3RyaW5nJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAndGV4dCcsXG4gICAgICAgICAgICB0eXBlOiAnU3RyaW5nJ1xuICAgICAgICB9XVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoTW9kZWwpO1xuIiwiaW1wb3J0IE1vZGVsICAgICBmcm9tICcuL01vZGVsLm1qcyc7XG5pbXBvcnQgQmFzZVN0b3JlIGZyb20gJy4uLy4uL3NyYy9kYXRhL1N0b3JlLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5tZW51LlN0b3JlXG4gKiBAZXh0ZW5kcyBOZW8uZGF0YS5TdG9yZVxuICovXG5jbGFzcyBTdG9yZSBleHRlbmRzIEJhc2VTdG9yZSB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8ubWVudS5TdG9yZSdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLm1lbnUuU3RvcmUnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7TmVvLm1lbnUuTW9kZWx9IG1vZGVsPU1vZGVsXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgbW9kZWw6IE1vZGVsXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhTdG9yZSk7XG4iLCJpbXBvcnQgQmFzZUxpc3RNb2RlbCBmcm9tICcuLi9MaXN0TW9kZWwubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTmVvLnNlbGVjdGlvbi5tZW51Lkxpc3RNb2RlbFxuICogQGV4dGVuZHMgTmVvLnNlbGVjdGlvbi5MaXN0TW9kZWxcbiAqL1xuY2xhc3MgTGlzdE1vZGVsIGV4dGVuZHMgQmFzZUxpc3RNb2RlbCB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8uc2VsZWN0aW9uLm1lbnUuTGlzdE1vZGVsJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8uc2VsZWN0aW9uLm1lbnUuTGlzdE1vZGVsJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gbnR5cGU9J3NlbGVjdGlvbi1tZW51LWxpc3Rtb2RlbCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgbnR5cGU6ICdzZWxlY3Rpb24tbWVudS1saXN0bW9kZWwnXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbktleURvd25Fc2NhcGUoZGF0YSkge1xuICAgICAgICB0aGlzLnZpZXcub25LZXlEb3duRXNjYXBlKGRhdGEpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbktleURvd25MZWZ0KGRhdGEpIHtcbiAgICAgICAgbGV0IHt2aWV3fSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7cGFyZW50TWVudX0gPSB2aWV3O1xuXG4gICAgICAgIGlmIChwYXJlbnRNZW51KSB7XG4gICAgICAgICAgICB2aWV3LmhpZGVTdWJNZW51KCk7XG4gICAgICAgICAgICB2aWV3LnNlbGVjdGlvbk1vZGVsLmRlc2VsZWN0QWxsKCk7XG4gICAgICAgICAgICBwYXJlbnRNZW51LnNlbGVjdGlvbk1vZGVsLnNlbGVjdEF0KHZpZXcucGFyZW50SW5kZXgpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqL1xuICAgIG9uS2V5RG93blJpZ2h0KGRhdGEpIHtcbiAgICAgICAgdGhpcy52aWV3LmFjdGl2ZVN1Yk1lbnU/LnNlbGVjdGlvbk1vZGVsLnNlbGVjdEF0KDApXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhMaXN0TW9kZWwpO1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==