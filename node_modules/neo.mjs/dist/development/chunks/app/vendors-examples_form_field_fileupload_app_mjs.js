"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-examples_form_field_fileupload_app_mjs"],{

/***/ "./examples/form/field/fileupload/MainContainer.mjs"
/*!**********************************************************!*\
  !*** ./examples/form/field/fileupload/MainContainer.mjs ***!
  \**********************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _ConfigurationViewport_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../ConfigurationViewport.mjs */ "./examples/ConfigurationViewport.mjs");
/* harmony import */ var _src_form_field_FileUpload_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../src/form/field/FileUpload.mjs */ "./src/form/field/FileUpload.mjs");
/* harmony import */ var _src_form_field_Number_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../src/form/field/Number.mjs */ "./src/form/field/Number.mjs");
/* harmony import */ var _src_container_Panel_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../src/container/Panel.mjs */ "./src/container/Panel.mjs");





/**
 * @class Neo.examples.form.field.text.MainContainer
 * @extends Neo.examples.ConfigurationViewport
 */
class MainContainer extends _ConfigurationViewport_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        className           : 'Neo.examples.form.field.text.MainContainer',
        autoMount           : true,
        configItemLabelWidth: 160,
        layout              : {ntype: 'hbox', align: 'stretch'}
    }

    createConfigurationComponents() {
        let me = this;

        return [{
            module   : _src_form_field_Number_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
            labelText: 'width',
            listeners: {change: me.onConfigChange.bind(me, 'width')},
            maxValue : 350,
            minValue : 200,
            stepSize : 5,
            style    : {marginTop: '10px'},
            value    : me.exampleComponent.width
        }]
    }

    createExampleComponent() {
        return Neo.create(_src_container_Panel_mjs__WEBPACK_IMPORTED_MODULE_3__["default"], {
            style : 'padding:1em',
            items : [{
                module            : _src_form_field_FileUpload_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                id                : 'my-downloadable-test',
                uploadUrl         : 'http://127.0.0.1:3000/file-upload-test',
                documentStatusUrl : 'http://127.0.0.1:3000/document-status-downloadable?documentId={documentId}',
                documentDeleteUrl : 'http://127.0.0.1:3000/document-delete?documentId={documentId}',
                downloadUrl       : 'http://127.0.0.1:3000/getDocument?documentId={documentId}',
                width             : 350,
                maxSize           : '10mb',
                types             : {
                    png : 1,
                    jpg : 1,
                    xls : 1,
                    pdf : 1
                },
                listeners : {
                    beforeRequest({ headers }) {
                        headers['X-XSRF-TOKEN'] = 'my-xsrf-token'
                    }
                }
            }, {
                module            : _src_form_field_FileUpload_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                id                : 'my-not-downloadable-test',
                uploadUrl         : 'http://127.0.0.1:3000/file-upload-test',
                documentStatusUrl : 'http://127.0.0.1:3000/document-status-not-downloadable?documentId={documentId}',
                documentDeleteUrl : 'http://127.0.0.1:3000/document-delete?documentId={documentId}',
                downloadUrl       : 'http://127.0.0.1:3000/getDocument?documentId={documentId}',
                width             : 350,
                maxSize           : '10mb',
                types             : {
                    png : 1,
                    jpg : 1,
                    xls : 1,
                    pdf : 1
                }
            }, {
                module            : _src_form_field_FileUpload_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                id                : 'my-upload-fail-test',
                uploadUrl         : 'http://127.0.0.1:3000/file-upload-test-fail',
                documentStatusUrl : 'http://127.0.0.1:3000/document-status?documentId={documentId}',
                documentDeleteUrl : 'http://127.0.0.1:3000/document-delete?documentId={documentId}',
                downloadUrl       : 'http://127.0.0.1:3000/getDocument?documentId={documentId}',
                width             : 350,
                maxSize           : '10mb',
                types             : {
                    png : 1,
                    jpg : 1,
                    xls : 1,
                    pdf : 1
                }
            }, {
                module            : _src_form_field_FileUpload_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                id                : 'my-scan-fail-test',
                uploadUrl         : 'http://127.0.0.1:3000/file-upload-test',
                documentStatusUrl : 'http://127.0.0.1:3000/document-status-fail?documentId={documentId}',
                documentDeleteUrl : 'http://127.0.0.1:3000/document-delete?documentId={documentId}',
                downloadUrl       : 'http://127.0.0.1:3000/getDocument?documentId={documentId}',
                width             : 350,
                maxSize           : '10mb',
                types             : {
                    png : 1,
                    jpg : 1,
                    xls : 1,
                    pdf : 1
                }
            }, {
                module            : _src_form_field_FileUpload_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                id                : 'my-existing-document-test',
                document          : {
                    id       : 2,
                    fileName : 'test.pdf',
                    size     : 10664885,
                    status   : 'AVAILABLE'
                },
                uploadUrl         : 'http://127.0.0.1:3000/file-upload-test',
                documentStatusUrl : 'http://127.0.0.1:3000/document-status-not-downloadable?documentId={documentId}',
                documentDeleteUrl : 'http://127.0.0.1:3000/document-delete?documentId={documentId}',
                downloadUrl       : 'http://127.0.0.1:3000/getDocument?documentId={documentId}',
                width             : 350,
                maxSize           : '10mb',
                types             : {
                    png : 1,
                    jpg : 1,
                    xls : 1,
                    pdf : 1
                }
            }, {
                module            : _src_form_field_FileUpload_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                id                : 'my-non-existing-document-test',
                document          : {
                    id       : 2,
                    fileName : 'test.pdf',
                    size     : 10664885,
                    status   : 'DELETED'
                },
                uploadUrl         : 'http://127.0.0.1:3000/file-upload-test',
                documentStatusUrl : 'http://127.0.0.1:3000/document-status-non-existent?documentId={documentId}',
                documentDeleteUrl : 'http://127.0.0.1:3000/document-delete?documentId={documentId}',
                downloadUrl       : 'http://127.0.0.1:3000/getDocument?documentId={documentId}',
                width             : 350,
                maxSize           : '10mb',
                types             : {
                    png : 1,
                    jpg : 1,
                    xls : 1,
                    pdf : 1
                }
            }, {
                module            : _src_form_field_FileUpload_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
                id                : 'my-failing-document-status-test',
                uploadUrl         : 'http://127.0.0.1:3000/file-upload-test',
                documentStatusUrl : 'http://127.0.0.1:3000/document-status-fails?documentId={documentId}',
                documentDeleteUrl : 'http://127.0.0.1:3000/document-delete?documentId={documentId}',
                downloadUrl       : 'http://127.0.0.1:3000/getDocument?documentId={documentId}',
                width             : 350,
                maxSize           : '10mb',
                types             : {
                    png : 1,
                    jpg : 1,
                    xls : 1,
                    pdf : 1
                }
            }]
        })
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(MainContainer));


/***/ },

/***/ "./examples/form/field/fileupload/app.mjs"
/*!************************************************!*\
  !*** ./examples/form/field/fileupload/app.mjs ***!
  \************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   onStart: () => (/* binding */ onStart)
/* harmony export */ });
/* harmony import */ var _MainContainer_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./MainContainer.mjs */ "./examples/form/field/fileupload/MainContainer.mjs");


const onStart = () => Neo.app({
    mainView: _MainContainer_mjs__WEBPACK_IMPORTED_MODULE_0__["default"],
    name    : 'Neo.examples.form.field.fileupload'
});


/***/ },

/***/ "./src/form/field/FileUpload.mjs"
/*!***************************************!*\
  !*** ./src/form/field/FileUpload.mjs ***!
  \***************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/form/field/Base.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/Array.mjs */ "./src/util/Array.mjs");



const
    sizeRE           = /^(\d+)(kb|mb|gb)?$/i,
    sizeMultiplier   = {
        unit : 1,
        kb   : 1000,
        mb   : 1000000,
        gb   : 1000000000
    },
    httpSuccessCodes = {
        2 : 1,
        4 : 1
    };

/**
 * An accessible file uploading widget which automatically commences an upload as soon as
 * a file is selected using the UI.
 *
 * The URL to which the file must be uploaded is specified in the {@link config#uploadUrl} property.
 * This service must return a JSON status response in the following form for successful uploads:
 *
 * ```json
 * {
 *     "success" : true,
 *     "documentId" : 1
 * }
 * ```
 *
 * And the following form for unsuccessful uploads:
 *
 * ```json
 * {
 *     "success" : false,
 *     "message" : "Why the upload was rejected"
 * }
 * ```
 *
 * The name of the `documentId` property is configured in {@link #member-documentIdParameter}.
 * It defaults to `'documentId'`.
 *
 * The `documentId` is used when requesting the document malware scan status, and when requesting
 * that the document be deleted, or downloaded.
 *
 * If the upload is successful, then the {@link #member-documentStatusUrl} is polled until the
 * malware scan. The document id returned from the upload is passed in the parameter named
 * by the {@link #member-documentIdParameter}. It defaults to `'documentId'`.
 *
 * This service must return a JSON status response in the following if the scan is still progressing:
 *
 * ```json
 * {
 *     "status" : "scanning"
 * }
 * ```
 *
 * And the following form is malware was detected:
 *
 * ```json
 * {
 *     "status" : "scan-failed"
 * }
 * ```
 *
 * After a successful scan, a document may or may not be downloadable.
 *
 * For a downloadable document, the response must be:
 *
 * ```json
 * {
 *     "status" : "downloadable"
 * }
 * ```
 *
 * For a non-downloadable document, the response must be:
 *
 * ```json
 * {
 *     "status" : "not-downloadable"
 * }
 * ```
 * @class Neo.form.field.FileUpload
 * @extends Neo.form.field.Base
 */
class FileUpload extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.form.field.FileUpload'
         * @protected
         */
        className: 'Neo.form.field.FileUpload',
        /**
         * @member {String} ntype='file-upload-field'
         * @protected
         */
        ntype: 'file-upload-field',
        /**
         * @member {String[]} baseCls=['neo-file-upload-field']
         * @protected
         */
        baseCls: ['neo-file-upload-field'],
        /**
         * @member {String[]} cls=['neo-field-empty']
         * @reactive
         */
        cls: ['neo-field-empty'],
        /**
         * @member {Object} _vdom
         */
        _vdom:
        {cn: [
            {tag: 'i', cls: 'neo-file-upload-state-icon'},
            {cls: 'neo-file-upload-body', cn: [
                {cls: 'neo-file-upload-filename'},
                {cls: 'neo-file-upload-state'}
            ]},
            {tag: 'button', cls: 'neo-file-upload-action-button'},
            {tag: 'input', cls: 'neo-file-upload-input', type: 'file'},
            {tag: 'label', cls: 'neo-file-upload-label'},
            {cls: 'neo-file-upload-error-message'}
        ]},

        /**
         * An Object containing a default set of headers to be passed to the server on every HTTP request.
         * @member {Object} headers
         */
        headers_: {},

        /**
         * An Object which allows the status text returned from the {@link #property-documentStatusUrl} to be
         * mapped to the corresponding next widget state.
         * @member {Object} documentStatusMap
         */
        documentStatusMap: {
            SCANNING         : 'scanning',

            // The server doing its own secondary upload to the final storage location may return this.
            // We enter the same state as scanning. A spinner shows for the duration of this state
            UPLOADING       : 'scanning',

            MALWARE_DETECTED: 'scan-failed',
            UN_DOWNLOADABLE : 'not-downloadable',
            AVAILABLE       : 'not-downloadable',
            DOWNLOADABLE    : 'downloadable',
            DELETED         : 'deleted',
            ERROR           : 'error'
        },

        /**
         * @member {String|null} document_=null
         * @reactive
         */
        document_: null,

        /**
         * If this widget should reference an existing document, configure the widget with a documentId
         * so that it can initialize in the correct "uploaded" state.
         *
         * If this is *not* configured, then this property will be set after a successful upload to
         * the id returned from the {@link #property-uploadUrl}.
         * @member {String|Number} documentId
         */
        documentId: null,

        /**
         * The URL of the file upload service to which the selected file is sent.
         *
         * This service must return a JSON response of the form:
         *
         * ```json
         * {
         *     "success"    : true,
         *     "message"    : "Only needed if the success property is false",
         *     "documentId" : 1
         * }
         * ```
         *
         * The document id is needed so that this widget can follow up and request the results of the
         * scan operation to see if the file was accepted, and whether it is to be subsequently downloadable.
         *
         * The document status request URL must be configured in {@link #member-documentStatusUrl}
         * @member {String|null} uploadUrl=null
         */
        uploadUrl: null,

        /**
         * The name of the JSON property in which the document id is returned in the upload response
         * JSON packet and the token string which is substituted for the document id when requesting
         * a malware scan and a document deletion.
         *
         * Defaults fro `documentId`
         *
         * @member {String} documentIdParameter='documentId'
         */
        documentIdParameter: 'documentId',

        /**
         * The URL from which the file may be downloaded after it has finished its scan.
         *
         * This must contain a substitution token named the same as the {@link #property-documentIdParameter}
         * which is used when creating a URL
         *
         * for example:
         *
         * ```json
         * {
         *     downloadUrl : '/getDocument/${documentId}'
         * }
         * ```
         *
         * The document id returned from the {@link #member-uploadUrl upload} is passed in the parameter named
         * by the {@link #member-documentIdParameter}. It defaults to `'documentId'`.
         *
         * @member {String|null} downloadUrl_=null
         * @reactive
         */
        downloadUrl_: null,

        /**
         * The URL of the file status reporting service.
         *
         * This must contain a substitution token named the same as the {@link #property-documentIdParameter}
         * which is used when creating a URL
         *
         * for example:
         *
         * ```json
         * {
         *     documentStatusUrl : '/getDocumentStatus/${documentId}'
         * }
         * ```
         *
         * This widget will use this service after a successful upload to determine its next
         * state.
         *
         * This service must return a JSON response of the form:
         *
         * ```json
         * {
         *     "status" : "scanning" or "scan-failed" or "downloadable or "not-downloadable"
         * }
         * ```
         *
         * @member {String|null} documentStatusUrl_=null
         * @reactive
         */
        documentStatusUrl_: null,

        /**
         * The polling interval *in milliseconds* to wait between asking the server how the document scan
         * is proceeding.
         *
         * Defaults to 2000ms
         *
         * @member {Number} statusScanInterval=2000
         */
        statusScanInterval: 2000,

        /**
         * The URL of the file deletion service.
         *
         * This must contain a substitution token named the same as the {@link #property-documentIdParameter}
         * which is used when creating a URL
         *
         * for example:
         *
         * ```json
         * {
         *     documentDeleteUrl : '/deleteDocument/${documentId}'
         * }
         * ```
         *
         * This widget will use this service after a successful upload to determine its next
         * state.
         *
         * If this service yields an HTTP 200 status, the deletion is taken to have been successful.
         *
         * @member {String|null} documentDeleteUrl_=null
         * @reactive
         */
        documentDeleteUrl_: null,

        /**
         * The HTTP method to use when requesting a document deletion using the {@link #member-documentDeleteUrl}.
         *
         * Defaults to `DELETE`.
         * @member {String} documentDeleteMethod='DELETE'
         */
        documentDeleteMethod: 'DELETE',

        /**
         * @member {String} state_=ready
         * @reactive
         */
        state_: 'ready',

        /**
         * @member {Object} types=null
         */
        types_: null,

        /**
         * @member {String|Number|null} maxSize=null
         */
        maxSize_: null,

        /**
         * The error text to show below the widget
         * @member {String|null} error_=null
         * @reactive
         */
        error_ : null,

        // UI strings which can be overridden for other languages
        chooseFile           : 'Choose file',
        documentText         : 'Document',
        invalidFileFormat    : 'invalid file format',
        pleaseUseTheseTypes  : 'Please use these file types {allowedFileTypes}',
        fileSizeMoreThan     : 'File size exceeds {allowedFileSize}',
        uploadError          : 'Please try again',
        documentDeleteError  : 'Document delete service error',
        isNoLongerAvailable  : 'is no longer available',
        documentStatusError  : 'Document status service error',
        uploadFailed         : 'Upload failed',
        scanning             : 'Scanning',
        uploading            : 'Uploading...',
        malwareFoundInFile   : 'Malware found in file',
        pleaseCheck          : 'Please check the file and try again',
        successfullyUploaded : 'Successfully uploaded',
        fileWasDeleted       : 'File was deleted',
        fileIsInAnErrorState : 'File is in an error state'
    }

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        const me = this;

        me.addDomListeners([
            { input : me.onInputValueChange, scope: me},
            { click : me.onActionButtonClick, delegate : '.neo-file-upload-action-button', scope : me}
        ]);
    }

    /**
     * @protected
     */
    ensureStableIds() {
        super.ensureStableIds();

        const inputElId = `${this.id}-input`;

        this.getInputEl().id = this.vdom.cn[4].for = inputElId
    }

    onConstructed() {
        super.onConstructed(...arguments);

        this.vdom.cn[4].text = this.chooseFile;
    }

    /**
     * @returns {Object}
     */
    getInputEl() {
        return this.vdom.cn[3];
    }

    async clear() {
        const
            me      = this,
            { cls } = me;

        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].add(cls, 'neo-field-empty');
        me.cls = cls;

        me.vdom.cn[3] = {
            id    : `${me.id}-input`,
            cls   : 'neo-file-upload-input',
            tag   : 'input',
            type  : 'file',
            value : ''
        };
        me.state = 'ready';
        me.error = '';
        me.file = me.document = null;

        // We have to wait for the DOM to have changed, and the input field to be visible
        await me.timeout(100);
        me.focus(me.getInputEl().id);
    }

    /**
     * @param {Object} data
     * @protected
     */
    onInputValueChange({ files }) {
        const
            me           = this,
            {cls, types} = me,
            body         = me.vdom.cn[1];

        if (files.length) {
            _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].remove(cls, 'neo-field-empty');
            me.cls = cls;

            const
                file     = files.item(0),
                pointPos = file.name.lastIndexOf('.'),
                type     = pointPos > -1 ? file.name.slice(pointPos + 1) : '';

            if (me.types && !types[type]) {
                body.cn[0].text = file.name;
                body.cn[1].text = `${me.invalidFileFormat} (.${type}) ${me.formatSize(file.size)}`;
                me.error = me.pleaseUseTheseTypes?.replace('{allowedFileTypes}', Object.keys(types).join(' .'))
            }
            else if (file.size > me.maxSize) {
                body.cn[0].text = file.name;
                body.cn[1].text = me.formatSize(file.size);
                me.error = me.fileSizeMoreThan?.replace('{allowedFileSize}', String(me._maxSize).toUpperCase());
            }
            // If it passes the type and maxSize check, upload it
            else {
                me.fileSize = me.formatSize(file.size);
                me.error = '';
                me.upload(file);
            }
        }
        // If cleared, we go back to ready state
        else {
            me.state = 'ready';
        }
    }

    async upload(file) {
        const
            me         = this,
            xhr        = me.xhr = new XMLHttpRequest(),
            { upload } = xhr,
            fileData   = new FormData(),
            headers    = { ...me.headers };

        // Show the action button
        me.file  = file;
        me.state = 'starting';

        // We have to wait for the DOM to have changed, and the action button to be visible
        await me.timeout(100);
        me.focus(me.vdom.cn[2].id);

        me.vdom.cn[1].cn[0].text = file.name;
        me.update();
        me.state = 'uploading';

        // This means no progress as opposed to zero, but still during a currently successful ongoing upload.
        // When it is NaN, the error display does not attempt to show progress.
        me.progress = NaN;

        fileData.append("file", file);

        // React to upload state changes
        upload.addEventListener('progress', me.onUploadProgress.bind(me));
        upload.addEventListener('error',    me.onUploadError.bind(me));
        upload.addEventListener('abort',    me.onUploadAbort.bind(me));
        xhr.addEventListener('loadend',     me.onUploadDone.bind(me));

        xhr.open("POST", me.uploadUrl, true);

        /**
         * This event fires before every HTTP request is sent to the server via any of the configured URLs.
         *
         * @event beforeRequest
         * @param {Object} event The event
         * @param {Object} event.headers An object containing the configured {@link #property-headers}
         * for this widget, into which new headers may be injected.
         * @returns {Object}
         */
        me.fire('beforeRequest', {
            headers
        });
        for (const header in headers) {
            xhr.setRequestHeader(header, headers[header]);
        }

        xhr.send(fileData);
    }

    onUploadProgress({ loaded, total }) {
        const
            progress = this.progress = loaded / total,
            { vdom } = this;

        (vdom.style || (vdom.style = {}))['--upload-progress'] = `${progress}turn`;

        vdom.cn[1].cn[1].text = `${this.uploading}... (${Math.round(progress * 100)}%)`;

        this.uploadSize = loaded;
        this.update()
    }

    onUploadAbort(e) {
        this.xhr = null;
        this.clear();
    }

    onUploadError(e) {
        this.xhr = null;
        this.state = 'upload-failed';
        this.error = `${this.uploadError}`;
    }

    onUploadDone({ loaded, target : xhr }) {
        const me = this;

        me.xhr = null;

        // Successful network request.
        // Check the resulting JSON packet for details and any error.
        if (httpSuccessCodes[String(xhr.status)[0]]) {
            if (loaded !== 0) {
                const response = JSON.parse(xhr.response);

                if (response.success) {
                    me.documentId = response[me.documentIdParameter];

                    // The status check phase is optional.
                    // If no URL specified, the file is taken to be downloadable.
                    if (me.documentStatusUrl) {
                        me.state = 'processing';

                        // Start polling the server to see when the scan has a result;
                        me.checkDocumentStatus();
                    }
                    else {
                        me.state = 'downloadable';
                    }
                }
                else {
                    me.error = response.message;
                    me.state = 'upload-failed';
                }
            }
        }
        // Failed network requests are handled in onUploadError
        // so no else condition necessary here
    }

    onActionButtonClick() {
        const
            me        = this,
            { state } = me;

        // When they click the action button, depending on which state we are in, we go to
        // different states.
        switch (state) {
            // During upload, its an abort
            case 'uploading':
                me.abortUpload();
                break;

            // While processing we just have to wait until it's succeeded or failed..
            case 'processing':
                break;

            // If the upload or the scan failed, the document will not have been
            // saved, so we just go back to ready state
            case 'upload-failed':
            case 'scan-failed':
            case 'error':
                me.clear();
                me.state = 'ready';
                break;

            // For stored documents, we need to tell the server the document
            // is not required.
            case 'downloadable':
            case 'not-downloadable':
                me.deleteDocument();
                break;
            case 'deleted':
                me.clear();
                me.state = 'ready';
                break;
            case 'ready':
                me.clear();
                break;
        }
    }

    abortUpload() {
        this.xhr?.abort();
    }

    async deleteDocument() {
        const
            me          = this,
            { headers } = me;

        me.fire('beforeRequest', {
            headers
        });

        // We ask the server to delete using our this.documentId
        const statusResponse = await fetch(me.documentDeleteUrl, {
            method : me.documentDeleteMethod,
            headers
        });

        // Success
        if (httpSuccessCodes[String(statusResponse.status)[0]]) {
            me.clear();
            me.state = 'ready';
        }
        else {
            me.error = `${me.documentDeleteError}: ${statusResponse.statusText}`;
        }
    }

    async checkDocumentStatus() {
        const
            me          = this,
            { headers } = me;

        if (me.state === 'processing') {
            me.fire('beforeRequest', {
                headers
            });

            const statusResponse = await fetch(me.documentStatusUrl, {
                headers
            });

            // Success
            if (httpSuccessCodes[String(statusResponse.status)[0]]) {
                const
                    serverJson   = await statusResponse.json(),
                    serverStatus = serverJson.status,
                    // Map the server's states codes to our own status codes
                    status       = me.documentStatusMap[serverStatus] || serverStatus;

                switch (status) {
                    case 'scanning':
                        me.timeout(me.statusScanInterval).then(() => {me.checkDocumentStatus()});
                        break;
                    case 'deleted':
                        me.error = `${me.documentText} ${me.documentId} ${isNoLongerAvailable}`;
                        me.state = 'ready';
                        break;
                    case 'error':
                        me.error = `${me.documentStatusError}: ${statusResponse.statusText || `Server error ${statusResponse.status}`}`;
                        me.state = 'deleted';
                        break;
                    default:
                        me.state = status;
                }
            }
            else {
                me.error = `${me.documentStatusError}: ${statusResponse.statusText || `Server error ${statusResponse.status}`}`;
                me.state = 'deleted';
            }
        }
    }

    afterSetDocument(document) {
        if (document) {
            const
                me    = this,
                {cls} = me;

            _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].remove(cls, 'neo-field-empty');
            me.cls = cls;

            me.documentId = document.id;
            me.fileSize = me.formatSize(document.size);
            me.vdom.cn[1].cn[0].text = document.fileName;
            me.state = me.documentStatusMap[document.status];
        }
    }

    /**
     * Triggered after the state config got changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetState(value, oldValue) {
        const
            me      = this,
            {
                vdom
            } = me,
            anchor  = vdom.cn[1].cn[0],
            status  = vdom.cn[1].cn[1];

        delete vdom.inert;

        let isChangeEventNeeded;

        switch (value) {
            case 'ready':
                anchor.tag = 'div';
                anchor.href = '';
                isChangeEventNeeded = true;
                break;
            case 'upload-failed':
                status.text = `${me.uploadFailed}${isNaN(me.progress) ? '' : `... (${Math.round(me.progress * 100)}%)`}`;
                isChangeEventNeeded = true;
                break;
            case 'processing':
                status.text = `${me.scanning}... (${me.formatSize(me.uploadSize)})`;
                vdom.inert = true;
                break;
            case 'scan-failed':
                status.text = `${me.malwareFoundInFile}. \u2022 ${me.fileSize}`;
                me.error = me.pleaseCheck;
                isChangeEventNeeded = true;
                break;
            case 'downloadable':
                anchor.tag = 'a';
                anchor.href = me.createUrl(me.downloadUrl, {
                    [me.documentIdParameter] : me.documentId
                });
                status.text = me.fileSize;
                isChangeEventNeeded = true;
                break;
            case 'not-downloadable':
                status.text = me.document ? me.fileSize : `${me.successfullyUploaded} \u2022 ${me.fileSize}`;
                isChangeEventNeeded = true;
                break;
            case 'deleted':
                status.text = me.fileWasDeleted;
                isChangeEventNeeded = true;
                break;
            case 'error':
                status.text = me.fileIsInAnErrorState;
                me.error = me.pleaseCheck;
                isChangeEventNeeded = true;
            }

        if (isChangeEventNeeded && oldValue !== undefined) {
            me.fireChangeEvent(me.file)
        }
        me.validate();
        me.update();

        // Processing above may mutate cls
        const { cls } = me;

        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].remove(cls, 'neo-file-upload-state-' + oldValue);
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].add(cls, 'neo-file-upload-state-' + value);
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"][me.file || me.document ? 'remove' : 'add', 'neo-field-empty'];
        me.cls = cls;
    }

    /**
     * Creates a URL substituting the passed parameter names in at the places where the name
     * occurs within `{}` in the pattern.
     * @param {String} urlPattern
     * @param {Object} params
     */
    createUrl(urlPattern, params) {
        for (const paramName in params) {
            urlPattern = urlPattern.replace(`{${paramName}}`, params[paramName]);
        }
        return urlPattern;
    }

    beforeGetHeaders(headers) {
        return { ...(headers || {}) }
    }

    beforeGetDocumentStatusUrl(documentStatusUrl) {
        const me = this;

        return typeof documentStatusUrl === 'function'? documentStatusUrl.call(me, me) : me.createUrl(documentStatusUrl, {
            [me.documentIdParameter] : me.documentId
        });
    }

    beforeGetDocumentDeleteUrl(documentDeleteUrl) {
        const me = this;

        return typeof documentDeleteUrl === 'function'? documentDeleteUrl.call(me, me) : me.createUrl(documentDeleteUrl, {
            [me.documentIdParameter] : me.documentId
        });
    }

    beforeGetDownloadUrl(downloadUrl) {
        const me = this;

        return typeof downloadUrl === 'function'? downloadUrl.call(me, me) : me.createUrl(downloadUrl, {
            [me.documentIdParameter] : me.documentId
        });
    }

    beforeGetMaxSize(maxSize) {
        // Not configured means no limit
        if (maxSize == null) {
            return Number.MAX_SAFE_INTEGER;
        }

        // Split eg "100mb" into the numeric and units parts
        const sizeParts = sizeRE.exec(maxSize);

        if (sizeParts) {
            // Convert mb to 1000000 etc
            const multiplier = sizeMultiplier[(sizeParts[2]||'unit').toLowerCase()];

            return parseInt(sizeParts[1]) * multiplier;
        }
    }

    afterSetError(text) {
        this.vdom.cn[5].cn = text ? [{vtype : 'text', text}] : [];
        this.validate();
        this.update();
    }

    formatSize(bytes, separator = '', postFix = '') {
        if (bytes) {
            const
                sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'],
                i     = Math.min(parseInt(Math.floor(Math.log(bytes) / Math.log(1000)).toString(), 10), sizes.length - 1);

            return `${(bytes / (1000 ** i)).toFixed(i ? 1 : 0)}${separator}${sizes[i]}${postFix}`;
        }
        return 'n/a';
    }

    /**
     * @returns {Boolean}
     */
    validate() {
        const
            { cls } = this,
            isValid = this.isValid();

        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].toggle(cls, 'neo-invalid', !isValid);
        this.cls = cls;

        return isValid;
    }

    isValid() {
        const me = this;

        return !me.error &&  !(me.state === 'ready' && me.required) ||
               (    (me.state === 'downloadable') ||
                    (me.state === 'not-downloadable')
               );
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(FileUpload));


/***/ }

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLWV4YW1wbGVzX2Zvcm1fZmllbGRfZmlsZXVwbG9hZF9hcHBfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXVFO0FBQ087QUFDSjtBQUNEOztBQUV6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixrRUFBcUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixrRUFBVztBQUNsQztBQUNBLHdCQUF3Qiw0Q0FBNEM7QUFDcEU7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGtCQUFrQjtBQUMxQztBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBLDBCQUEwQixnRUFBSztBQUMvQjtBQUNBO0FBQ0Esb0NBQW9DLHNFQUFlO0FBQ25EO0FBQ0E7QUFDQSxvR0FBb0csV0FBVztBQUMvRyx1RkFBdUYsV0FBVztBQUNsRyxtRkFBbUYsV0FBVztBQUM5RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLG9DQUFvQyxTQUFTO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixvQ0FBb0Msc0VBQWU7QUFDbkQ7QUFDQTtBQUNBLHdHQUF3RyxXQUFXO0FBQ25ILHVGQUF1RixXQUFXO0FBQ2xHLG1GQUFtRixXQUFXO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2Isb0NBQW9DLHNFQUFlO0FBQ25EO0FBQ0E7QUFDQSx1RkFBdUYsV0FBVztBQUNsRyx1RkFBdUYsV0FBVztBQUNsRyxtRkFBbUYsV0FBVztBQUM5RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLG9DQUFvQyxzRUFBZTtBQUNuRDtBQUNBO0FBQ0EsNEZBQTRGLFdBQVc7QUFDdkcsdUZBQXVGLFdBQVc7QUFDbEcsbUZBQW1GLFdBQVc7QUFDOUY7QUFD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OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnQkFBZ0IsTUFBTTs7QUFFdEIsUUFBUSx1REFBUTtBQUNoQixRQUFRLHVEQUFRO0FBQ2hCLFFBQVEsdURBQVE7QUFDaEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0EsOENBQThDLEVBQUUsV0FBVztBQUMzRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUIsaUJBQWlCO0FBQ2xDOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0Esc0NBQXNDLHFCQUFxQjtBQUMzRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxzQkFBc0IseUNBQXlDLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxRQUFRO0FBQ2hHO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxjQUFjLE1BQU07QUFDcEI7O0FBRUEsUUFBUSx1REFBUTtBQUNoQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLDBCQUEwQixFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvLm1qcy8uL2V4YW1wbGVzL2Zvcm0vZmllbGQvZmlsZXVwbG9hZC9NYWluQ29udGFpbmVyLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vZXhhbXBsZXMvZm9ybS9maWVsZC9maWxldXBsb2FkL2FwcC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9mb3JtL2ZpZWxkL0ZpbGVVcGxvYWQubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb25maWd1cmF0aW9uVmlld3BvcnQgZnJvbSAnLi4vLi4vLi4vQ29uZmlndXJhdGlvblZpZXdwb3J0Lm1qcyc7XG5pbXBvcnQgRmlsZVVwbG9hZEZpZWxkICAgICAgIGZyb20gJy4uLy4uLy4uLy4uL3NyYy9mb3JtL2ZpZWxkL0ZpbGVVcGxvYWQubWpzJztcbmltcG9ydCBOdW1iZXJGaWVsZCAgICAgICAgICAgZnJvbSAnLi4vLi4vLi4vLi4vc3JjL2Zvcm0vZmllbGQvTnVtYmVyLm1qcyc7XG5pbXBvcnQgUGFuZWwgICAgICAgICAgICAgICAgICBmcm9tICcuLi8uLi8uLi8uLi9zcmMvY29udGFpbmVyL1BhbmVsLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5leGFtcGxlcy5mb3JtLmZpZWxkLnRleHQuTWFpbkNvbnRhaW5lclxuICogQGV4dGVuZHMgTmVvLmV4YW1wbGVzLkNvbmZpZ3VyYXRpb25WaWV3cG9ydFxuICovXG5jbGFzcyBNYWluQ29udGFpbmVyIGV4dGVuZHMgQ29uZmlndXJhdGlvblZpZXdwb3J0IHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICBjbGFzc05hbWUgICAgICAgICAgIDogJ05lby5leGFtcGxlcy5mb3JtLmZpZWxkLnRleHQuTWFpbkNvbnRhaW5lcicsXG4gICAgICAgIGF1dG9Nb3VudCAgICAgICAgICAgOiB0cnVlLFxuICAgICAgICBjb25maWdJdGVtTGFiZWxXaWR0aDogMTYwLFxuICAgICAgICBsYXlvdXQgICAgICAgICAgICAgIDoge250eXBlOiAnaGJveCcsIGFsaWduOiAnc3RyZXRjaCd9XG4gICAgfVxuXG4gICAgY3JlYXRlQ29uZmlndXJhdGlvbkNvbXBvbmVudHMoKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIFt7XG4gICAgICAgICAgICBtb2R1bGUgICA6IE51bWJlckZpZWxkLFxuICAgICAgICAgICAgbGFiZWxUZXh0OiAnd2lkdGgnLFxuICAgICAgICAgICAgbGlzdGVuZXJzOiB7Y2hhbmdlOiBtZS5vbkNvbmZpZ0NoYW5nZS5iaW5kKG1lLCAnd2lkdGgnKX0sXG4gICAgICAgICAgICBtYXhWYWx1ZSA6IDM1MCxcbiAgICAgICAgICAgIG1pblZhbHVlIDogMjAwLFxuICAgICAgICAgICAgc3RlcFNpemUgOiA1LFxuICAgICAgICAgICAgc3R5bGUgICAgOiB7bWFyZ2luVG9wOiAnMTBweCd9LFxuICAgICAgICAgICAgdmFsdWUgICAgOiBtZS5leGFtcGxlQ29tcG9uZW50LndpZHRoXG4gICAgICAgIH1dXG4gICAgfVxuXG4gICAgY3JlYXRlRXhhbXBsZUNvbXBvbmVudCgpIHtcbiAgICAgICAgcmV0dXJuIE5lby5jcmVhdGUoUGFuZWwsIHtcbiAgICAgICAgICAgIHN0eWxlIDogJ3BhZGRpbmc6MWVtJyxcbiAgICAgICAgICAgIGl0ZW1zIDogW3tcbiAgICAgICAgICAgICAgICBtb2R1bGUgICAgICAgICAgICA6IEZpbGVVcGxvYWRGaWVsZCxcbiAgICAgICAgICAgICAgICBpZCAgICAgICAgICAgICAgICA6ICdteS1kb3dubG9hZGFibGUtdGVzdCcsXG4gICAgICAgICAgICAgICAgdXBsb2FkVXJsICAgICAgICAgOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2ZpbGUtdXBsb2FkLXRlc3QnLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50U3RhdHVzVXJsIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kb2N1bWVudC1zdGF0dXMtZG93bmxvYWRhYmxlP2RvY3VtZW50SWQ9e2RvY3VtZW50SWR9JyxcbiAgICAgICAgICAgICAgICBkb2N1bWVudERlbGV0ZVVybCA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZG9jdW1lbnQtZGVsZXRlP2RvY3VtZW50SWQ9e2RvY3VtZW50SWR9JyxcbiAgICAgICAgICAgICAgICBkb3dubG9hZFVybCAgICAgICA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZ2V0RG9jdW1lbnQ/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIHdpZHRoICAgICAgICAgICAgIDogMzUwLFxuICAgICAgICAgICAgICAgIG1heFNpemUgICAgICAgICAgIDogJzEwbWInLFxuICAgICAgICAgICAgICAgIHR5cGVzICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBwbmcgOiAxLFxuICAgICAgICAgICAgICAgICAgICBqcGcgOiAxLFxuICAgICAgICAgICAgICAgICAgICB4bHMgOiAxLFxuICAgICAgICAgICAgICAgICAgICBwZGYgOiAxXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsaXN0ZW5lcnMgOiB7XG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZVJlcXVlc3QoeyBoZWFkZXJzIH0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbJ1gtWFNSRi1UT0tFTiddID0gJ215LXhzcmYtdG9rZW4nXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbW9kdWxlICAgICAgICAgICAgOiBGaWxlVXBsb2FkRmllbGQsXG4gICAgICAgICAgICAgICAgaWQgICAgICAgICAgICAgICAgOiAnbXktbm90LWRvd25sb2FkYWJsZS10ZXN0JyxcbiAgICAgICAgICAgICAgICB1cGxvYWRVcmwgICAgICAgICA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZmlsZS11cGxvYWQtdGVzdCcsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTdGF0dXNVcmwgOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2RvY3VtZW50LXN0YXR1cy1ub3QtZG93bmxvYWRhYmxlP2RvY3VtZW50SWQ9e2RvY3VtZW50SWR9JyxcbiAgICAgICAgICAgICAgICBkb2N1bWVudERlbGV0ZVVybCA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZG9jdW1lbnQtZGVsZXRlP2RvY3VtZW50SWQ9e2RvY3VtZW50SWR9JyxcbiAgICAgICAgICAgICAgICBkb3dubG9hZFVybCAgICAgICA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZ2V0RG9jdW1lbnQ/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIHdpZHRoICAgICAgICAgICAgIDogMzUwLFxuICAgICAgICAgICAgICAgIG1heFNpemUgICAgICAgICAgIDogJzEwbWInLFxuICAgICAgICAgICAgICAgIHR5cGVzICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBwbmcgOiAxLFxuICAgICAgICAgICAgICAgICAgICBqcGcgOiAxLFxuICAgICAgICAgICAgICAgICAgICB4bHMgOiAxLFxuICAgICAgICAgICAgICAgICAgICBwZGYgOiAxXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIG1vZHVsZSAgICAgICAgICAgIDogRmlsZVVwbG9hZEZpZWxkLFxuICAgICAgICAgICAgICAgIGlkICAgICAgICAgICAgICAgIDogJ215LXVwbG9hZC1mYWlsLXRlc3QnLFxuICAgICAgICAgICAgICAgIHVwbG9hZFVybCAgICAgICAgIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9maWxlLXVwbG9hZC10ZXN0LWZhaWwnLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50U3RhdHVzVXJsIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kb2N1bWVudC1zdGF0dXM/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50RGVsZXRlVXJsIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kb2N1bWVudC1kZWxldGU/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIGRvd25sb2FkVXJsICAgICAgIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9nZXREb2N1bWVudD9kb2N1bWVudElkPXtkb2N1bWVudElkfScsXG4gICAgICAgICAgICAgICAgd2lkdGggICAgICAgICAgICAgOiAzNTAsXG4gICAgICAgICAgICAgICAgbWF4U2l6ZSAgICAgICAgICAgOiAnMTBtYicsXG4gICAgICAgICAgICAgICAgdHlwZXMgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIHBuZyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIGpwZyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIHhscyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIHBkZiA6IDFcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbW9kdWxlICAgICAgICAgICAgOiBGaWxlVXBsb2FkRmllbGQsXG4gICAgICAgICAgICAgICAgaWQgICAgICAgICAgICAgICAgOiAnbXktc2Nhbi1mYWlsLXRlc3QnLFxuICAgICAgICAgICAgICAgIHVwbG9hZFVybCAgICAgICAgIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9maWxlLXVwbG9hZC10ZXN0JyxcbiAgICAgICAgICAgICAgICBkb2N1bWVudFN0YXR1c1VybCA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZG9jdW1lbnQtc3RhdHVzLWZhaWw/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50RGVsZXRlVXJsIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kb2N1bWVudC1kZWxldGU/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIGRvd25sb2FkVXJsICAgICAgIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9nZXREb2N1bWVudD9kb2N1bWVudElkPXtkb2N1bWVudElkfScsXG4gICAgICAgICAgICAgICAgd2lkdGggICAgICAgICAgICAgOiAzNTAsXG4gICAgICAgICAgICAgICAgbWF4U2l6ZSAgICAgICAgICAgOiAnMTBtYicsXG4gICAgICAgICAgICAgICAgdHlwZXMgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIHBuZyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIGpwZyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIHhscyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIHBkZiA6IDFcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbW9kdWxlICAgICAgICAgICAgOiBGaWxlVXBsb2FkRmllbGQsXG4gICAgICAgICAgICAgICAgaWQgICAgICAgICAgICAgICAgOiAnbXktZXhpc3RpbmctZG9jdW1lbnQtdGVzdCcsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkICAgICAgIDogMixcbiAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUgOiAndGVzdC5wZGYnLFxuICAgICAgICAgICAgICAgICAgICBzaXplICAgICA6IDEwNjY0ODg1LFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXMgICA6ICdBVkFJTEFCTEUnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1cGxvYWRVcmwgICAgICAgICA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZmlsZS11cGxvYWQtdGVzdCcsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTdGF0dXNVcmwgOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2RvY3VtZW50LXN0YXR1cy1ub3QtZG93bmxvYWRhYmxlP2RvY3VtZW50SWQ9e2RvY3VtZW50SWR9JyxcbiAgICAgICAgICAgICAgICBkb2N1bWVudERlbGV0ZVVybCA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZG9jdW1lbnQtZGVsZXRlP2RvY3VtZW50SWQ9e2RvY3VtZW50SWR9JyxcbiAgICAgICAgICAgICAgICBkb3dubG9hZFVybCAgICAgICA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZ2V0RG9jdW1lbnQ/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIHdpZHRoICAgICAgICAgICAgIDogMzUwLFxuICAgICAgICAgICAgICAgIG1heFNpemUgICAgICAgICAgIDogJzEwbWInLFxuICAgICAgICAgICAgICAgIHR5cGVzICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBwbmcgOiAxLFxuICAgICAgICAgICAgICAgICAgICBqcGcgOiAxLFxuICAgICAgICAgICAgICAgICAgICB4bHMgOiAxLFxuICAgICAgICAgICAgICAgICAgICBwZGYgOiAxXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIG1vZHVsZSAgICAgICAgICAgIDogRmlsZVVwbG9hZEZpZWxkLFxuICAgICAgICAgICAgICAgIGlkICAgICAgICAgICAgICAgIDogJ215LW5vbi1leGlzdGluZy1kb2N1bWVudC10ZXN0JyxcbiAgICAgICAgICAgICAgICBkb2N1bWVudCAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQgICAgICAgOiAyLFxuICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZSA6ICd0ZXN0LnBkZicsXG4gICAgICAgICAgICAgICAgICAgIHNpemUgICAgIDogMTA2NjQ4ODUsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1cyAgIDogJ0RFTEVURUQnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1cGxvYWRVcmwgICAgICAgICA6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZmlsZS11cGxvYWQtdGVzdCcsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTdGF0dXNVcmwgOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2RvY3VtZW50LXN0YXR1cy1ub24tZXhpc3RlbnQ/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50RGVsZXRlVXJsIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kb2N1bWVudC1kZWxldGU/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIGRvd25sb2FkVXJsICAgICAgIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9nZXREb2N1bWVudD9kb2N1bWVudElkPXtkb2N1bWVudElkfScsXG4gICAgICAgICAgICAgICAgd2lkdGggICAgICAgICAgICAgOiAzNTAsXG4gICAgICAgICAgICAgICAgbWF4U2l6ZSAgICAgICAgICAgOiAnMTBtYicsXG4gICAgICAgICAgICAgICAgdHlwZXMgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIHBuZyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIGpwZyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIHhscyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIHBkZiA6IDFcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbW9kdWxlICAgICAgICAgICAgOiBGaWxlVXBsb2FkRmllbGQsXG4gICAgICAgICAgICAgICAgaWQgICAgICAgICAgICAgICAgOiAnbXktZmFpbGluZy1kb2N1bWVudC1zdGF0dXMtdGVzdCcsXG4gICAgICAgICAgICAgICAgdXBsb2FkVXJsICAgICAgICAgOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2ZpbGUtdXBsb2FkLXRlc3QnLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50U3RhdHVzVXJsIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kb2N1bWVudC1zdGF0dXMtZmFpbHM/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50RGVsZXRlVXJsIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kb2N1bWVudC1kZWxldGU/ZG9jdW1lbnRJZD17ZG9jdW1lbnRJZH0nLFxuICAgICAgICAgICAgICAgIGRvd25sb2FkVXJsICAgICAgIDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9nZXREb2N1bWVudD9kb2N1bWVudElkPXtkb2N1bWVudElkfScsXG4gICAgICAgICAgICAgICAgd2lkdGggICAgICAgICAgICAgOiAzNTAsXG4gICAgICAgICAgICAgICAgbWF4U2l6ZSAgICAgICAgICAgOiAnMTBtYicsXG4gICAgICAgICAgICAgICAgdHlwZXMgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIHBuZyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIGpwZyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIHhscyA6IDEsXG4gICAgICAgICAgICAgICAgICAgIHBkZiA6IDFcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XVxuICAgICAgICB9KVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoTWFpbkNvbnRhaW5lcik7XG4iLCJpbXBvcnQgTWFpbkNvbnRhaW5lciBmcm9tICcuL01haW5Db250YWluZXIubWpzJztcblxuZXhwb3J0IGNvbnN0IG9uU3RhcnQgPSAoKSA9PiBOZW8uYXBwKHtcbiAgICBtYWluVmlldzogTWFpbkNvbnRhaW5lcixcbiAgICBuYW1lICAgIDogJ05lby5leGFtcGxlcy5mb3JtLmZpZWxkLmZpbGV1cGxvYWQnXG59KTtcbiIsImltcG9ydCBGaWVsZCAgICBmcm9tICcuL0Jhc2UubWpzJztcbmltcG9ydCBOZW9BcnJheSBmcm9tICcuLi8uLi91dGlsL0FycmF5Lm1qcyc7XG5cbmNvbnN0XG4gICAgc2l6ZVJFICAgICAgICAgICA9IC9eKFxcZCspKGtifG1ifGdiKT8kL2ksXG4gICAgc2l6ZU11bHRpcGxpZXIgICA9IHtcbiAgICAgICAgdW5pdCA6IDEsXG4gICAgICAgIGtiICAgOiAxMDAwLFxuICAgICAgICBtYiAgIDogMTAwMDAwMCxcbiAgICAgICAgZ2IgICA6IDEwMDAwMDAwMDBcbiAgICB9LFxuICAgIGh0dHBTdWNjZXNzQ29kZXMgPSB7XG4gICAgICAgIDIgOiAxLFxuICAgICAgICA0IDogMVxuICAgIH07XG5cbi8qKlxuICogQW4gYWNjZXNzaWJsZSBmaWxlIHVwbG9hZGluZyB3aWRnZXQgd2hpY2ggYXV0b21hdGljYWxseSBjb21tZW5jZXMgYW4gdXBsb2FkIGFzIHNvb24gYXNcbiAqIGEgZmlsZSBpcyBzZWxlY3RlZCB1c2luZyB0aGUgVUkuXG4gKlxuICogVGhlIFVSTCB0byB3aGljaCB0aGUgZmlsZSBtdXN0IGJlIHVwbG9hZGVkIGlzIHNwZWNpZmllZCBpbiB0aGUge0BsaW5rIGNvbmZpZyN1cGxvYWRVcmx9IHByb3BlcnR5LlxuICogVGhpcyBzZXJ2aWNlIG11c3QgcmV0dXJuIGEgSlNPTiBzdGF0dXMgcmVzcG9uc2UgaW4gdGhlIGZvbGxvd2luZyBmb3JtIGZvciBzdWNjZXNzZnVsIHVwbG9hZHM6XG4gKlxuICogYGBganNvblxuICoge1xuICogICAgIFwic3VjY2Vzc1wiIDogdHJ1ZSxcbiAqICAgICBcImRvY3VtZW50SWRcIiA6IDFcbiAqIH1cbiAqIGBgYFxuICpcbiAqIEFuZCB0aGUgZm9sbG93aW5nIGZvcm0gZm9yIHVuc3VjY2Vzc2Z1bCB1cGxvYWRzOlxuICpcbiAqIGBgYGpzb25cbiAqIHtcbiAqICAgICBcInN1Y2Nlc3NcIiA6IGZhbHNlLFxuICogICAgIFwibWVzc2FnZVwiIDogXCJXaHkgdGhlIHVwbG9hZCB3YXMgcmVqZWN0ZWRcIlxuICogfVxuICogYGBgXG4gKlxuICogVGhlIG5hbWUgb2YgdGhlIGBkb2N1bWVudElkYCBwcm9wZXJ0eSBpcyBjb25maWd1cmVkIGluIHtAbGluayAjbWVtYmVyLWRvY3VtZW50SWRQYXJhbWV0ZXJ9LlxuICogSXQgZGVmYXVsdHMgdG8gYCdkb2N1bWVudElkJ2AuXG4gKlxuICogVGhlIGBkb2N1bWVudElkYCBpcyB1c2VkIHdoZW4gcmVxdWVzdGluZyB0aGUgZG9jdW1lbnQgbWFsd2FyZSBzY2FuIHN0YXR1cywgYW5kIHdoZW4gcmVxdWVzdGluZ1xuICogdGhhdCB0aGUgZG9jdW1lbnQgYmUgZGVsZXRlZCwgb3IgZG93bmxvYWRlZC5cbiAqXG4gKiBJZiB0aGUgdXBsb2FkIGlzIHN1Y2Nlc3NmdWwsIHRoZW4gdGhlIHtAbGluayAjbWVtYmVyLWRvY3VtZW50U3RhdHVzVXJsfSBpcyBwb2xsZWQgdW50aWwgdGhlXG4gKiBtYWx3YXJlIHNjYW4uIFRoZSBkb2N1bWVudCBpZCByZXR1cm5lZCBmcm9tIHRoZSB1cGxvYWQgaXMgcGFzc2VkIGluIHRoZSBwYXJhbWV0ZXIgbmFtZWRcbiAqIGJ5IHRoZSB7QGxpbmsgI21lbWJlci1kb2N1bWVudElkUGFyYW1ldGVyfS4gSXQgZGVmYXVsdHMgdG8gYCdkb2N1bWVudElkJ2AuXG4gKlxuICogVGhpcyBzZXJ2aWNlIG11c3QgcmV0dXJuIGEgSlNPTiBzdGF0dXMgcmVzcG9uc2UgaW4gdGhlIGZvbGxvd2luZyBpZiB0aGUgc2NhbiBpcyBzdGlsbCBwcm9ncmVzc2luZzpcbiAqXG4gKiBgYGBqc29uXG4gKiB7XG4gKiAgICAgXCJzdGF0dXNcIiA6IFwic2Nhbm5pbmdcIlxuICogfVxuICogYGBgXG4gKlxuICogQW5kIHRoZSBmb2xsb3dpbmcgZm9ybSBpcyBtYWx3YXJlIHdhcyBkZXRlY3RlZDpcbiAqXG4gKiBgYGBqc29uXG4gKiB7XG4gKiAgICAgXCJzdGF0dXNcIiA6IFwic2Nhbi1mYWlsZWRcIlxuICogfVxuICogYGBgXG4gKlxuICogQWZ0ZXIgYSBzdWNjZXNzZnVsIHNjYW4sIGEgZG9jdW1lbnQgbWF5IG9yIG1heSBub3QgYmUgZG93bmxvYWRhYmxlLlxuICpcbiAqIEZvciBhIGRvd25sb2FkYWJsZSBkb2N1bWVudCwgdGhlIHJlc3BvbnNlIG11c3QgYmU6XG4gKlxuICogYGBganNvblxuICoge1xuICogICAgIFwic3RhdHVzXCIgOiBcImRvd25sb2FkYWJsZVwiXG4gKiB9XG4gKiBgYGBcbiAqXG4gKiBGb3IgYSBub24tZG93bmxvYWRhYmxlIGRvY3VtZW50LCB0aGUgcmVzcG9uc2UgbXVzdCBiZTpcbiAqXG4gKiBgYGBqc29uXG4gKiB7XG4gKiAgICAgXCJzdGF0dXNcIiA6IFwibm90LWRvd25sb2FkYWJsZVwiXG4gKiB9XG4gKiBgYGBcbiAqIEBjbGFzcyBOZW8uZm9ybS5maWVsZC5GaWxlVXBsb2FkXG4gKiBAZXh0ZW5kcyBOZW8uZm9ybS5maWVsZC5CYXNlXG4gKi9cbmNsYXNzIEZpbGVVcGxvYWQgZXh0ZW5kcyBGaWVsZCB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8uZm9ybS5maWVsZC5GaWxlVXBsb2FkJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8uZm9ybS5maWVsZC5GaWxlVXBsb2FkJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gbnR5cGU9J2ZpbGUtdXBsb2FkLWZpZWxkJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ2ZpbGUtdXBsb2FkLWZpZWxkJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBiYXNlQ2xzPVsnbmVvLWZpbGUtdXBsb2FkLWZpZWxkJ11cbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgYmFzZUNsczogWyduZW8tZmlsZS11cGxvYWQtZmllbGQnXSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBjbHM9WyduZW8tZmllbGQtZW1wdHknXVxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIGNsczogWyduZW8tZmllbGQtZW1wdHknXSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdH0gX3Zkb21cbiAgICAgICAgICovXG4gICAgICAgIF92ZG9tOlxuICAgICAgICB7Y246IFtcbiAgICAgICAgICAgIHt0YWc6ICdpJywgY2xzOiAnbmVvLWZpbGUtdXBsb2FkLXN0YXRlLWljb24nfSxcbiAgICAgICAgICAgIHtjbHM6ICduZW8tZmlsZS11cGxvYWQtYm9keScsIGNuOiBbXG4gICAgICAgICAgICAgICAge2NsczogJ25lby1maWxlLXVwbG9hZC1maWxlbmFtZSd9LFxuICAgICAgICAgICAgICAgIHtjbHM6ICduZW8tZmlsZS11cGxvYWQtc3RhdGUnfVxuICAgICAgICAgICAgXX0sXG4gICAgICAgICAgICB7dGFnOiAnYnV0dG9uJywgY2xzOiAnbmVvLWZpbGUtdXBsb2FkLWFjdGlvbi1idXR0b24nfSxcbiAgICAgICAgICAgIHt0YWc6ICdpbnB1dCcsIGNsczogJ25lby1maWxlLXVwbG9hZC1pbnB1dCcsIHR5cGU6ICdmaWxlJ30sXG4gICAgICAgICAgICB7dGFnOiAnbGFiZWwnLCBjbHM6ICduZW8tZmlsZS11cGxvYWQtbGFiZWwnfSxcbiAgICAgICAgICAgIHtjbHM6ICduZW8tZmlsZS11cGxvYWQtZXJyb3ItbWVzc2FnZSd9XG4gICAgICAgIF19LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBPYmplY3QgY29udGFpbmluZyBhIGRlZmF1bHQgc2V0IG9mIGhlYWRlcnMgdG8gYmUgcGFzc2VkIHRvIHRoZSBzZXJ2ZXIgb24gZXZlcnkgSFRUUCByZXF1ZXN0LlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGhlYWRlcnNcbiAgICAgICAgICovXG4gICAgICAgIGhlYWRlcnNfOiB7fSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gT2JqZWN0IHdoaWNoIGFsbG93cyB0aGUgc3RhdHVzIHRleHQgcmV0dXJuZWQgZnJvbSB0aGUge0BsaW5rICNwcm9wZXJ0eS1kb2N1bWVudFN0YXR1c1VybH0gdG8gYmVcbiAgICAgICAgICogbWFwcGVkIHRvIHRoZSBjb3JyZXNwb25kaW5nIG5leHQgd2lkZ2V0IHN0YXRlLlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGRvY3VtZW50U3RhdHVzTWFwXG4gICAgICAgICAqL1xuICAgICAgICBkb2N1bWVudFN0YXR1c01hcDoge1xuICAgICAgICAgICAgU0NBTk5JTkcgICAgICAgICA6ICdzY2FubmluZycsXG5cbiAgICAgICAgICAgIC8vIFRoZSBzZXJ2ZXIgZG9pbmcgaXRzIG93biBzZWNvbmRhcnkgdXBsb2FkIHRvIHRoZSBmaW5hbCBzdG9yYWdlIGxvY2F0aW9uIG1heSByZXR1cm4gdGhpcy5cbiAgICAgICAgICAgIC8vIFdlIGVudGVyIHRoZSBzYW1lIHN0YXRlIGFzIHNjYW5uaW5nLiBBIHNwaW5uZXIgc2hvd3MgZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGlzIHN0YXRlXG4gICAgICAgICAgICBVUExPQURJTkcgICAgICAgOiAnc2Nhbm5pbmcnLFxuXG4gICAgICAgICAgICBNQUxXQVJFX0RFVEVDVEVEOiAnc2Nhbi1mYWlsZWQnLFxuICAgICAgICAgICAgVU5fRE9XTkxPQURBQkxFIDogJ25vdC1kb3dubG9hZGFibGUnLFxuICAgICAgICAgICAgQVZBSUxBQkxFICAgICAgIDogJ25vdC1kb3dubG9hZGFibGUnLFxuICAgICAgICAgICAgRE9XTkxPQURBQkxFICAgIDogJ2Rvd25sb2FkYWJsZScsXG4gICAgICAgICAgICBERUxFVEVEICAgICAgICAgOiAnZGVsZXRlZCcsXG4gICAgICAgICAgICBFUlJPUiAgICAgICAgICAgOiAnZXJyb3InXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBkb2N1bWVudF89bnVsbFxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIGRvY3VtZW50XzogbnVsbCxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSWYgdGhpcyB3aWRnZXQgc2hvdWxkIHJlZmVyZW5jZSBhbiBleGlzdGluZyBkb2N1bWVudCwgY29uZmlndXJlIHRoZSB3aWRnZXQgd2l0aCBhIGRvY3VtZW50SWRcbiAgICAgICAgICogc28gdGhhdCBpdCBjYW4gaW5pdGlhbGl6ZSBpbiB0aGUgY29ycmVjdCBcInVwbG9hZGVkXCIgc3RhdGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIElmIHRoaXMgaXMgKm5vdCogY29uZmlndXJlZCwgdGhlbiB0aGlzIHByb3BlcnR5IHdpbGwgYmUgc2V0IGFmdGVyIGEgc3VjY2Vzc2Z1bCB1cGxvYWQgdG9cbiAgICAgICAgICogdGhlIGlkIHJldHVybmVkIGZyb20gdGhlIHtAbGluayAjcHJvcGVydHktdXBsb2FkVXJsfS5cbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfE51bWJlcn0gZG9jdW1lbnRJZFxuICAgICAgICAgKi9cbiAgICAgICAgZG9jdW1lbnRJZDogbnVsbCxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIFVSTCBvZiB0aGUgZmlsZSB1cGxvYWQgc2VydmljZSB0byB3aGljaCB0aGUgc2VsZWN0ZWQgZmlsZSBpcyBzZW50LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGlzIHNlcnZpY2UgbXVzdCByZXR1cm4gYSBKU09OIHJlc3BvbnNlIG9mIHRoZSBmb3JtOlxuICAgICAgICAgKlxuICAgICAgICAgKiBgYGBqc29uXG4gICAgICAgICAqIHtcbiAgICAgICAgICogICAgIFwic3VjY2Vzc1wiICAgIDogdHJ1ZSxcbiAgICAgICAgICogICAgIFwibWVzc2FnZVwiICAgIDogXCJPbmx5IG5lZWRlZCBpZiB0aGUgc3VjY2VzcyBwcm9wZXJ0eSBpcyBmYWxzZVwiLFxuICAgICAgICAgKiAgICAgXCJkb2N1bWVudElkXCIgOiAxXG4gICAgICAgICAqIH1cbiAgICAgICAgICogYGBgXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZSBkb2N1bWVudCBpZCBpcyBuZWVkZWQgc28gdGhhdCB0aGlzIHdpZGdldCBjYW4gZm9sbG93IHVwIGFuZCByZXF1ZXN0IHRoZSByZXN1bHRzIG9mIHRoZVxuICAgICAgICAgKiBzY2FuIG9wZXJhdGlvbiB0byBzZWUgaWYgdGhlIGZpbGUgd2FzIGFjY2VwdGVkLCBhbmQgd2hldGhlciBpdCBpcyB0byBiZSBzdWJzZXF1ZW50bHkgZG93bmxvYWRhYmxlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGUgZG9jdW1lbnQgc3RhdHVzIHJlcXVlc3QgVVJMIG11c3QgYmUgY29uZmlndXJlZCBpbiB7QGxpbmsgI21lbWJlci1kb2N1bWVudFN0YXR1c1VybH1cbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IHVwbG9hZFVybD1udWxsXG4gICAgICAgICAqL1xuICAgICAgICB1cGxvYWRVcmw6IG51bGwsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYW1lIG9mIHRoZSBKU09OIHByb3BlcnR5IGluIHdoaWNoIHRoZSBkb2N1bWVudCBpZCBpcyByZXR1cm5lZCBpbiB0aGUgdXBsb2FkIHJlc3BvbnNlXG4gICAgICAgICAqIEpTT04gcGFja2V0IGFuZCB0aGUgdG9rZW4gc3RyaW5nIHdoaWNoIGlzIHN1YnN0aXR1dGVkIGZvciB0aGUgZG9jdW1lbnQgaWQgd2hlbiByZXF1ZXN0aW5nXG4gICAgICAgICAqIGEgbWFsd2FyZSBzY2FuIGFuZCBhIGRvY3VtZW50IGRlbGV0aW9uLlxuICAgICAgICAgKlxuICAgICAgICAgKiBEZWZhdWx0cyBmcm8gYGRvY3VtZW50SWRgXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gZG9jdW1lbnRJZFBhcmFtZXRlcj0nZG9jdW1lbnRJZCdcbiAgICAgICAgICovXG4gICAgICAgIGRvY3VtZW50SWRQYXJhbWV0ZXI6ICdkb2N1bWVudElkJyxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIFVSTCBmcm9tIHdoaWNoIHRoZSBmaWxlIG1heSBiZSBkb3dubG9hZGVkIGFmdGVyIGl0IGhhcyBmaW5pc2hlZCBpdHMgc2Nhbi5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhpcyBtdXN0IGNvbnRhaW4gYSBzdWJzdGl0dXRpb24gdG9rZW4gbmFtZWQgdGhlIHNhbWUgYXMgdGhlIHtAbGluayAjcHJvcGVydHktZG9jdW1lbnRJZFBhcmFtZXRlcn1cbiAgICAgICAgICogd2hpY2ggaXMgdXNlZCB3aGVuIGNyZWF0aW5nIGEgVVJMXG4gICAgICAgICAqXG4gICAgICAgICAqIGZvciBleGFtcGxlOlxuICAgICAgICAgKlxuICAgICAgICAgKiBgYGBqc29uXG4gICAgICAgICAqIHtcbiAgICAgICAgICogICAgIGRvd25sb2FkVXJsIDogJy9nZXREb2N1bWVudC8ke2RvY3VtZW50SWR9J1xuICAgICAgICAgKiB9XG4gICAgICAgICAqIGBgYFxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGUgZG9jdW1lbnQgaWQgcmV0dXJuZWQgZnJvbSB0aGUge0BsaW5rICNtZW1iZXItdXBsb2FkVXJsIHVwbG9hZH0gaXMgcGFzc2VkIGluIHRoZSBwYXJhbWV0ZXIgbmFtZWRcbiAgICAgICAgICogYnkgdGhlIHtAbGluayAjbWVtYmVyLWRvY3VtZW50SWRQYXJhbWV0ZXJ9LiBJdCBkZWZhdWx0cyB0byBgJ2RvY3VtZW50SWQnYC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IGRvd25sb2FkVXJsXz1udWxsXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgZG93bmxvYWRVcmxfOiBudWxsLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgVVJMIG9mIHRoZSBmaWxlIHN0YXR1cyByZXBvcnRpbmcgc2VydmljZS5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhpcyBtdXN0IGNvbnRhaW4gYSBzdWJzdGl0dXRpb24gdG9rZW4gbmFtZWQgdGhlIHNhbWUgYXMgdGhlIHtAbGluayAjcHJvcGVydHktZG9jdW1lbnRJZFBhcmFtZXRlcn1cbiAgICAgICAgICogd2hpY2ggaXMgdXNlZCB3aGVuIGNyZWF0aW5nIGEgVVJMXG4gICAgICAgICAqXG4gICAgICAgICAqIGZvciBleGFtcGxlOlxuICAgICAgICAgKlxuICAgICAgICAgKiBgYGBqc29uXG4gICAgICAgICAqIHtcbiAgICAgICAgICogICAgIGRvY3VtZW50U3RhdHVzVXJsIDogJy9nZXREb2N1bWVudFN0YXR1cy8ke2RvY3VtZW50SWR9J1xuICAgICAgICAgKiB9XG4gICAgICAgICAqIGBgYFxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGlzIHdpZGdldCB3aWxsIHVzZSB0aGlzIHNlcnZpY2UgYWZ0ZXIgYSBzdWNjZXNzZnVsIHVwbG9hZCB0byBkZXRlcm1pbmUgaXRzIG5leHRcbiAgICAgICAgICogc3RhdGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoaXMgc2VydmljZSBtdXN0IHJldHVybiBhIEpTT04gcmVzcG9uc2Ugb2YgdGhlIGZvcm06XG4gICAgICAgICAqXG4gICAgICAgICAqIGBgYGpzb25cbiAgICAgICAgICoge1xuICAgICAgICAgKiAgICAgXCJzdGF0dXNcIiA6IFwic2Nhbm5pbmdcIiBvciBcInNjYW4tZmFpbGVkXCIgb3IgXCJkb3dubG9hZGFibGUgb3IgXCJub3QtZG93bmxvYWRhYmxlXCJcbiAgICAgICAgICogfVxuICAgICAgICAgKiBgYGBcbiAgICAgICAgICpcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IGRvY3VtZW50U3RhdHVzVXJsXz1udWxsXG4gICAgICAgICAqIEByZWFjdGl2ZVxuICAgICAgICAgKi9cbiAgICAgICAgZG9jdW1lbnRTdGF0dXNVcmxfOiBudWxsLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcG9sbGluZyBpbnRlcnZhbCAqaW4gbWlsbGlzZWNvbmRzKiB0byB3YWl0IGJldHdlZW4gYXNraW5nIHRoZSBzZXJ2ZXIgaG93IHRoZSBkb2N1bWVudCBzY2FuXG4gICAgICAgICAqIGlzIHByb2NlZWRpbmcuXG4gICAgICAgICAqXG4gICAgICAgICAqIERlZmF1bHRzIHRvIDIwMDBtc1xuICAgICAgICAgKlxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IHN0YXR1c1NjYW5JbnRlcnZhbD0yMDAwXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0dXNTY2FuSW50ZXJ2YWw6IDIwMDAsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBVUkwgb2YgdGhlIGZpbGUgZGVsZXRpb24gc2VydmljZS5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhpcyBtdXN0IGNvbnRhaW4gYSBzdWJzdGl0dXRpb24gdG9rZW4gbmFtZWQgdGhlIHNhbWUgYXMgdGhlIHtAbGluayAjcHJvcGVydHktZG9jdW1lbnRJZFBhcmFtZXRlcn1cbiAgICAgICAgICogd2hpY2ggaXMgdXNlZCB3aGVuIGNyZWF0aW5nIGEgVVJMXG4gICAgICAgICAqXG4gICAgICAgICAqIGZvciBleGFtcGxlOlxuICAgICAgICAgKlxuICAgICAgICAgKiBgYGBqc29uXG4gICAgICAgICAqIHtcbiAgICAgICAgICogICAgIGRvY3VtZW50RGVsZXRlVXJsIDogJy9kZWxldGVEb2N1bWVudC8ke2RvY3VtZW50SWR9J1xuICAgICAgICAgKiB9XG4gICAgICAgICAqIGBgYFxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGlzIHdpZGdldCB3aWxsIHVzZSB0aGlzIHNlcnZpY2UgYWZ0ZXIgYSBzdWNjZXNzZnVsIHVwbG9hZCB0byBkZXRlcm1pbmUgaXRzIG5leHRcbiAgICAgICAgICogc3RhdGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIElmIHRoaXMgc2VydmljZSB5aWVsZHMgYW4gSFRUUCAyMDAgc3RhdHVzLCB0aGUgZGVsZXRpb24gaXMgdGFrZW4gdG8gaGF2ZSBiZWVuIHN1Y2Nlc3NmdWwuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBkb2N1bWVudERlbGV0ZVVybF89bnVsbFxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIGRvY3VtZW50RGVsZXRlVXJsXzogbnVsbCxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIEhUVFAgbWV0aG9kIHRvIHVzZSB3aGVuIHJlcXVlc3RpbmcgYSBkb2N1bWVudCBkZWxldGlvbiB1c2luZyB0aGUge0BsaW5rICNtZW1iZXItZG9jdW1lbnREZWxldGVVcmx9LlxuICAgICAgICAgKlxuICAgICAgICAgKiBEZWZhdWx0cyB0byBgREVMRVRFYC5cbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBkb2N1bWVudERlbGV0ZU1ldGhvZD0nREVMRVRFJ1xuICAgICAgICAgKi9cbiAgICAgICAgZG9jdW1lbnREZWxldGVNZXRob2Q6ICdERUxFVEUnLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IHN0YXRlXz1yZWFkeVxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIHN0YXRlXzogJ3JlYWR5JyxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSB0eXBlcz1udWxsXG4gICAgICAgICAqL1xuICAgICAgICB0eXBlc186IG51bGwsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xOdW1iZXJ8bnVsbH0gbWF4U2l6ZT1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBtYXhTaXplXzogbnVsbCxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGVycm9yIHRleHQgdG8gc2hvdyBiZWxvdyB0aGUgd2lkZ2V0XG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBlcnJvcl89bnVsbFxuICAgICAgICAgKiBAcmVhY3RpdmVcbiAgICAgICAgICovXG4gICAgICAgIGVycm9yXyA6IG51bGwsXG5cbiAgICAgICAgLy8gVUkgc3RyaW5ncyB3aGljaCBjYW4gYmUgb3ZlcnJpZGRlbiBmb3Igb3RoZXIgbGFuZ3VhZ2VzXG4gICAgICAgIGNob29zZUZpbGUgICAgICAgICAgIDogJ0Nob29zZSBmaWxlJyxcbiAgICAgICAgZG9jdW1lbnRUZXh0ICAgICAgICAgOiAnRG9jdW1lbnQnLFxuICAgICAgICBpbnZhbGlkRmlsZUZvcm1hdCAgICA6ICdpbnZhbGlkIGZpbGUgZm9ybWF0JyxcbiAgICAgICAgcGxlYXNlVXNlVGhlc2VUeXBlcyAgOiAnUGxlYXNlIHVzZSB0aGVzZSBmaWxlIHR5cGVzIHthbGxvd2VkRmlsZVR5cGVzfScsXG4gICAgICAgIGZpbGVTaXplTW9yZVRoYW4gICAgIDogJ0ZpbGUgc2l6ZSBleGNlZWRzIHthbGxvd2VkRmlsZVNpemV9JyxcbiAgICAgICAgdXBsb2FkRXJyb3IgICAgICAgICAgOiAnUGxlYXNlIHRyeSBhZ2FpbicsXG4gICAgICAgIGRvY3VtZW50RGVsZXRlRXJyb3IgIDogJ0RvY3VtZW50IGRlbGV0ZSBzZXJ2aWNlIGVycm9yJyxcbiAgICAgICAgaXNOb0xvbmdlckF2YWlsYWJsZSAgOiAnaXMgbm8gbG9uZ2VyIGF2YWlsYWJsZScsXG4gICAgICAgIGRvY3VtZW50U3RhdHVzRXJyb3IgIDogJ0RvY3VtZW50IHN0YXR1cyBzZXJ2aWNlIGVycm9yJyxcbiAgICAgICAgdXBsb2FkRmFpbGVkICAgICAgICAgOiAnVXBsb2FkIGZhaWxlZCcsXG4gICAgICAgIHNjYW5uaW5nICAgICAgICAgICAgIDogJ1NjYW5uaW5nJyxcbiAgICAgICAgdXBsb2FkaW5nICAgICAgICAgICAgOiAnVXBsb2FkaW5nLi4uJyxcbiAgICAgICAgbWFsd2FyZUZvdW5kSW5GaWxlICAgOiAnTWFsd2FyZSBmb3VuZCBpbiBmaWxlJyxcbiAgICAgICAgcGxlYXNlQ2hlY2sgICAgICAgICAgOiAnUGxlYXNlIGNoZWNrIHRoZSBmaWxlIGFuZCB0cnkgYWdhaW4nLFxuICAgICAgICBzdWNjZXNzZnVsbHlVcGxvYWRlZCA6ICdTdWNjZXNzZnVsbHkgdXBsb2FkZWQnLFxuICAgICAgICBmaWxlV2FzRGVsZXRlZCAgICAgICA6ICdGaWxlIHdhcyBkZWxldGVkJyxcbiAgICAgICAgZmlsZUlzSW5BbkVycm9yU3RhdGUgOiAnRmlsZSBpcyBpbiBhbiBlcnJvciBzdGF0ZSdcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0KGNvbmZpZykge1xuICAgICAgICBzdXBlci5jb25zdHJ1Y3QoY29uZmlnKTtcblxuICAgICAgICBjb25zdCBtZSA9IHRoaXM7XG5cbiAgICAgICAgbWUuYWRkRG9tTGlzdGVuZXJzKFtcbiAgICAgICAgICAgIHsgaW5wdXQgOiBtZS5vbklucHV0VmFsdWVDaGFuZ2UsIHNjb3BlOiBtZX0sXG4gICAgICAgICAgICB7IGNsaWNrIDogbWUub25BY3Rpb25CdXR0b25DbGljaywgZGVsZWdhdGUgOiAnLm5lby1maWxlLXVwbG9hZC1hY3Rpb24tYnV0dG9uJywgc2NvcGUgOiBtZX1cbiAgICAgICAgXSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGVuc3VyZVN0YWJsZUlkcygpIHtcbiAgICAgICAgc3VwZXIuZW5zdXJlU3RhYmxlSWRzKCk7XG5cbiAgICAgICAgY29uc3QgaW5wdXRFbElkID0gYCR7dGhpcy5pZH0taW5wdXRgO1xuXG4gICAgICAgIHRoaXMuZ2V0SW5wdXRFbCgpLmlkID0gdGhpcy52ZG9tLmNuWzRdLmZvciA9IGlucHV0RWxJZFxuICAgIH1cblxuICAgIG9uQ29uc3RydWN0ZWQoKSB7XG4gICAgICAgIHN1cGVyLm9uQ29uc3RydWN0ZWQoLi4uYXJndW1lbnRzKTtcblxuICAgICAgICB0aGlzLnZkb20uY25bNF0udGV4dCA9IHRoaXMuY2hvb3NlRmlsZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgICAqL1xuICAgIGdldElucHV0RWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZkb20uY25bM107XG4gICAgfVxuXG4gICAgYXN5bmMgY2xlYXIoKSB7XG4gICAgICAgIGNvbnN0XG4gICAgICAgICAgICBtZSAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHsgY2xzIH0gPSBtZTtcblxuICAgICAgICBOZW9BcnJheS5hZGQoY2xzLCAnbmVvLWZpZWxkLWVtcHR5Jyk7XG4gICAgICAgIG1lLmNscyA9IGNscztcblxuICAgICAgICBtZS52ZG9tLmNuWzNdID0ge1xuICAgICAgICAgICAgaWQgICAgOiBgJHttZS5pZH0taW5wdXRgLFxuICAgICAgICAgICAgY2xzICAgOiAnbmVvLWZpbGUtdXBsb2FkLWlucHV0JyxcbiAgICAgICAgICAgIHRhZyAgIDogJ2lucHV0JyxcbiAgICAgICAgICAgIHR5cGUgIDogJ2ZpbGUnLFxuICAgICAgICAgICAgdmFsdWUgOiAnJ1xuICAgICAgICB9O1xuICAgICAgICBtZS5zdGF0ZSA9ICdyZWFkeSc7XG4gICAgICAgIG1lLmVycm9yID0gJyc7XG4gICAgICAgIG1lLmZpbGUgPSBtZS5kb2N1bWVudCA9IG51bGw7XG5cbiAgICAgICAgLy8gV2UgaGF2ZSB0byB3YWl0IGZvciB0aGUgRE9NIHRvIGhhdmUgY2hhbmdlZCwgYW5kIHRoZSBpbnB1dCBmaWVsZCB0byBiZSB2aXNpYmxlXG4gICAgICAgIGF3YWl0IG1lLnRpbWVvdXQoMTAwKTtcbiAgICAgICAgbWUuZm9jdXMobWUuZ2V0SW5wdXRFbCgpLmlkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbklucHV0VmFsdWVDaGFuZ2UoeyBmaWxlcyB9KSB7XG4gICAgICAgIGNvbnN0XG4gICAgICAgICAgICBtZSAgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAge2NscywgdHlwZXN9ID0gbWUsXG4gICAgICAgICAgICBib2R5ICAgICAgICAgPSBtZS52ZG9tLmNuWzFdO1xuXG4gICAgICAgIGlmIChmaWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIE5lb0FycmF5LnJlbW92ZShjbHMsICduZW8tZmllbGQtZW1wdHknKTtcbiAgICAgICAgICAgIG1lLmNscyA9IGNscztcblxuICAgICAgICAgICAgY29uc3RcbiAgICAgICAgICAgICAgICBmaWxlICAgICA9IGZpbGVzLml0ZW0oMCksXG4gICAgICAgICAgICAgICAgcG9pbnRQb3MgPSBmaWxlLm5hbWUubGFzdEluZGV4T2YoJy4nKSxcbiAgICAgICAgICAgICAgICB0eXBlICAgICA9IHBvaW50UG9zID4gLTEgPyBmaWxlLm5hbWUuc2xpY2UocG9pbnRQb3MgKyAxKSA6ICcnO1xuXG4gICAgICAgICAgICBpZiAobWUudHlwZXMgJiYgIXR5cGVzW3R5cGVdKSB7XG4gICAgICAgICAgICAgICAgYm9keS5jblswXS50ZXh0ID0gZmlsZS5uYW1lO1xuICAgICAgICAgICAgICAgIGJvZHkuY25bMV0udGV4dCA9IGAke21lLmludmFsaWRGaWxlRm9ybWF0fSAoLiR7dHlwZX0pICR7bWUuZm9ybWF0U2l6ZShmaWxlLnNpemUpfWA7XG4gICAgICAgICAgICAgICAgbWUuZXJyb3IgPSBtZS5wbGVhc2VVc2VUaGVzZVR5cGVzPy5yZXBsYWNlKCd7YWxsb3dlZEZpbGVUeXBlc30nLCBPYmplY3Qua2V5cyh0eXBlcykuam9pbignIC4nKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZpbGUuc2l6ZSA+IG1lLm1heFNpemUpIHtcbiAgICAgICAgICAgICAgICBib2R5LmNuWzBdLnRleHQgPSBmaWxlLm5hbWU7XG4gICAgICAgICAgICAgICAgYm9keS5jblsxXS50ZXh0ID0gbWUuZm9ybWF0U2l6ZShmaWxlLnNpemUpO1xuICAgICAgICAgICAgICAgIG1lLmVycm9yID0gbWUuZmlsZVNpemVNb3JlVGhhbj8ucmVwbGFjZSgne2FsbG93ZWRGaWxlU2l6ZX0nLCBTdHJpbmcobWUuX21heFNpemUpLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgaXQgcGFzc2VzIHRoZSB0eXBlIGFuZCBtYXhTaXplIGNoZWNrLCB1cGxvYWQgaXRcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1lLmZpbGVTaXplID0gbWUuZm9ybWF0U2l6ZShmaWxlLnNpemUpO1xuICAgICAgICAgICAgICAgIG1lLmVycm9yID0gJyc7XG4gICAgICAgICAgICAgICAgbWUudXBsb2FkKGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIGNsZWFyZWQsIHdlIGdvIGJhY2sgdG8gcmVhZHkgc3RhdGVcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtZS5zdGF0ZSA9ICdyZWFkeSc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyB1cGxvYWQoZmlsZSkge1xuICAgICAgICBjb25zdFxuICAgICAgICAgICAgbWUgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB4aHIgICAgICAgID0gbWUueGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgICAgICAgICB7IHVwbG9hZCB9ID0geGhyLFxuICAgICAgICAgICAgZmlsZURhdGEgICA9IG5ldyBGb3JtRGF0YSgpLFxuICAgICAgICAgICAgaGVhZGVycyAgICA9IHsgLi4ubWUuaGVhZGVycyB9O1xuXG4gICAgICAgIC8vIFNob3cgdGhlIGFjdGlvbiBidXR0b25cbiAgICAgICAgbWUuZmlsZSAgPSBmaWxlO1xuICAgICAgICBtZS5zdGF0ZSA9ICdzdGFydGluZyc7XG5cbiAgICAgICAgLy8gV2UgaGF2ZSB0byB3YWl0IGZvciB0aGUgRE9NIHRvIGhhdmUgY2hhbmdlZCwgYW5kIHRoZSBhY3Rpb24gYnV0dG9uIHRvIGJlIHZpc2libGVcbiAgICAgICAgYXdhaXQgbWUudGltZW91dCgxMDApO1xuICAgICAgICBtZS5mb2N1cyhtZS52ZG9tLmNuWzJdLmlkKTtcblxuICAgICAgICBtZS52ZG9tLmNuWzFdLmNuWzBdLnRleHQgPSBmaWxlLm5hbWU7XG4gICAgICAgIG1lLnVwZGF0ZSgpO1xuICAgICAgICBtZS5zdGF0ZSA9ICd1cGxvYWRpbmcnO1xuXG4gICAgICAgIC8vIFRoaXMgbWVhbnMgbm8gcHJvZ3Jlc3MgYXMgb3Bwb3NlZCB0byB6ZXJvLCBidXQgc3RpbGwgZHVyaW5nIGEgY3VycmVudGx5IHN1Y2Nlc3NmdWwgb25nb2luZyB1cGxvYWQuXG4gICAgICAgIC8vIFdoZW4gaXQgaXMgTmFOLCB0aGUgZXJyb3IgZGlzcGxheSBkb2VzIG5vdCBhdHRlbXB0IHRvIHNob3cgcHJvZ3Jlc3MuXG4gICAgICAgIG1lLnByb2dyZXNzID0gTmFOO1xuXG4gICAgICAgIGZpbGVEYXRhLmFwcGVuZChcImZpbGVcIiwgZmlsZSk7XG5cbiAgICAgICAgLy8gUmVhY3QgdG8gdXBsb2FkIHN0YXRlIGNoYW5nZXNcbiAgICAgICAgdXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgbWUub25VcGxvYWRQcm9ncmVzcy5iaW5kKG1lKSk7XG4gICAgICAgIHVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICAgIG1lLm9uVXBsb2FkRXJyb3IuYmluZChtZSkpO1xuICAgICAgICB1cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCAgICBtZS5vblVwbG9hZEFib3J0LmJpbmQobWUpKTtcbiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlbmQnLCAgICAgbWUub25VcGxvYWREb25lLmJpbmQobWUpKTtcblxuICAgICAgICB4aHIub3BlbihcIlBPU1RcIiwgbWUudXBsb2FkVXJsLCB0cnVlKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBldmVudCBmaXJlcyBiZWZvcmUgZXZlcnkgSFRUUCByZXF1ZXN0IGlzIHNlbnQgdG8gdGhlIHNlcnZlciB2aWEgYW55IG9mIHRoZSBjb25maWd1cmVkIFVSTHMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBldmVudCBiZWZvcmVSZXF1ZXN0XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50LmhlYWRlcnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGNvbmZpZ3VyZWQge0BsaW5rICNwcm9wZXJ0eS1oZWFkZXJzfVxuICAgICAgICAgKiBmb3IgdGhpcyB3aWRnZXQsIGludG8gd2hpY2ggbmV3IGhlYWRlcnMgbWF5IGJlIGluamVjdGVkLlxuICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgbWUuZmlyZSgnYmVmb3JlUmVxdWVzdCcsIHtcbiAgICAgICAgICAgIGhlYWRlcnNcbiAgICAgICAgfSk7XG4gICAgICAgIGZvciAoY29uc3QgaGVhZGVyIGluIGhlYWRlcnMpIHtcbiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgaGVhZGVyc1toZWFkZXJdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHhoci5zZW5kKGZpbGVEYXRhKTtcbiAgICB9XG5cbiAgICBvblVwbG9hZFByb2dyZXNzKHsgbG9hZGVkLCB0b3RhbCB9KSB7XG4gICAgICAgIGNvbnN0XG4gICAgICAgICAgICBwcm9ncmVzcyA9IHRoaXMucHJvZ3Jlc3MgPSBsb2FkZWQgLyB0b3RhbCxcbiAgICAgICAgICAgIHsgdmRvbSB9ID0gdGhpcztcblxuICAgICAgICAodmRvbS5zdHlsZSB8fCAodmRvbS5zdHlsZSA9IHt9KSlbJy0tdXBsb2FkLXByb2dyZXNzJ10gPSBgJHtwcm9ncmVzc310dXJuYDtcblxuICAgICAgICB2ZG9tLmNuWzFdLmNuWzFdLnRleHQgPSBgJHt0aGlzLnVwbG9hZGluZ30uLi4gKCR7TWF0aC5yb3VuZChwcm9ncmVzcyAqIDEwMCl9JSlgO1xuXG4gICAgICAgIHRoaXMudXBsb2FkU2l6ZSA9IGxvYWRlZDtcbiAgICAgICAgdGhpcy51cGRhdGUoKVxuICAgIH1cblxuICAgIG9uVXBsb2FkQWJvcnQoZSkge1xuICAgICAgICB0aGlzLnhociA9IG51bGw7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBvblVwbG9hZEVycm9yKGUpIHtcbiAgICAgICAgdGhpcy54aHIgPSBudWxsO1xuICAgICAgICB0aGlzLnN0YXRlID0gJ3VwbG9hZC1mYWlsZWQnO1xuICAgICAgICB0aGlzLmVycm9yID0gYCR7dGhpcy51cGxvYWRFcnJvcn1gO1xuICAgIH1cblxuICAgIG9uVXBsb2FkRG9uZSh7IGxvYWRlZCwgdGFyZ2V0IDogeGhyIH0pIHtcbiAgICAgICAgY29uc3QgbWUgPSB0aGlzO1xuXG4gICAgICAgIG1lLnhociA9IG51bGw7XG5cbiAgICAgICAgLy8gU3VjY2Vzc2Z1bCBuZXR3b3JrIHJlcXVlc3QuXG4gICAgICAgIC8vIENoZWNrIHRoZSByZXN1bHRpbmcgSlNPTiBwYWNrZXQgZm9yIGRldGFpbHMgYW5kIGFueSBlcnJvci5cbiAgICAgICAgaWYgKGh0dHBTdWNjZXNzQ29kZXNbU3RyaW5nKHhoci5zdGF0dXMpWzBdXSkge1xuICAgICAgICAgICAgaWYgKGxvYWRlZCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbWUuZG9jdW1lbnRJZCA9IHJlc3BvbnNlW21lLmRvY3VtZW50SWRQYXJhbWV0ZXJdO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBzdGF0dXMgY2hlY2sgcGhhc2UgaXMgb3B0aW9uYWwuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIG5vIFVSTCBzcGVjaWZpZWQsIHRoZSBmaWxlIGlzIHRha2VuIHRvIGJlIGRvd25sb2FkYWJsZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lLmRvY3VtZW50U3RhdHVzVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5zdGF0ZSA9ICdwcm9jZXNzaW5nJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgcG9sbGluZyB0aGUgc2VydmVyIHRvIHNlZSB3aGVuIHRoZSBzY2FuIGhhcyBhIHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLmNoZWNrRG9jdW1lbnRTdGF0dXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLnN0YXRlID0gJ2Rvd25sb2FkYWJsZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1lLmVycm9yID0gcmVzcG9uc2UubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgbWUuc3RhdGUgPSAndXBsb2FkLWZhaWxlZCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEZhaWxlZCBuZXR3b3JrIHJlcXVlc3RzIGFyZSBoYW5kbGVkIGluIG9uVXBsb2FkRXJyb3JcbiAgICAgICAgLy8gc28gbm8gZWxzZSBjb25kaXRpb24gbmVjZXNzYXJ5IGhlcmVcbiAgICB9XG5cbiAgICBvbkFjdGlvbkJ1dHRvbkNsaWNrKCkge1xuICAgICAgICBjb25zdFxuICAgICAgICAgICAgbWUgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHsgc3RhdGUgfSA9IG1lO1xuXG4gICAgICAgIC8vIFdoZW4gdGhleSBjbGljayB0aGUgYWN0aW9uIGJ1dHRvbiwgZGVwZW5kaW5nIG9uIHdoaWNoIHN0YXRlIHdlIGFyZSBpbiwgd2UgZ28gdG9cbiAgICAgICAgLy8gZGlmZmVyZW50IHN0YXRlcy5cbiAgICAgICAgc3dpdGNoIChzdGF0ZSkge1xuICAgICAgICAgICAgLy8gRHVyaW5nIHVwbG9hZCwgaXRzIGFuIGFib3J0XG4gICAgICAgICAgICBjYXNlICd1cGxvYWRpbmcnOlxuICAgICAgICAgICAgICAgIG1lLmFib3J0VXBsb2FkKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFdoaWxlIHByb2Nlc3Npbmcgd2UganVzdCBoYXZlIHRvIHdhaXQgdW50aWwgaXQncyBzdWNjZWVkZWQgb3IgZmFpbGVkLi5cbiAgICAgICAgICAgIGNhc2UgJ3Byb2Nlc3NpbmcnOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAvLyBJZiB0aGUgdXBsb2FkIG9yIHRoZSBzY2FuIGZhaWxlZCwgdGhlIGRvY3VtZW50IHdpbGwgbm90IGhhdmUgYmVlblxuICAgICAgICAgICAgLy8gc2F2ZWQsIHNvIHdlIGp1c3QgZ28gYmFjayB0byByZWFkeSBzdGF0ZVxuICAgICAgICAgICAgY2FzZSAndXBsb2FkLWZhaWxlZCc6XG4gICAgICAgICAgICBjYXNlICdzY2FuLWZhaWxlZCc6XG4gICAgICAgICAgICBjYXNlICdlcnJvcic6XG4gICAgICAgICAgICAgICAgbWUuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICBtZS5zdGF0ZSA9ICdyZWFkeSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIEZvciBzdG9yZWQgZG9jdW1lbnRzLCB3ZSBuZWVkIHRvIHRlbGwgdGhlIHNlcnZlciB0aGUgZG9jdW1lbnRcbiAgICAgICAgICAgIC8vIGlzIG5vdCByZXF1aXJlZC5cbiAgICAgICAgICAgIGNhc2UgJ2Rvd25sb2FkYWJsZSc6XG4gICAgICAgICAgICBjYXNlICdub3QtZG93bmxvYWRhYmxlJzpcbiAgICAgICAgICAgICAgICBtZS5kZWxldGVEb2N1bWVudCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZGVsZXRlZCc6XG4gICAgICAgICAgICAgICAgbWUuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICBtZS5zdGF0ZSA9ICdyZWFkeSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyZWFkeSc6XG4gICAgICAgICAgICAgICAgbWUuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFib3J0VXBsb2FkKCkge1xuICAgICAgICB0aGlzLnhocj8uYWJvcnQoKTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWxldGVEb2N1bWVudCgpIHtcbiAgICAgICAgY29uc3RcbiAgICAgICAgICAgIG1lICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHsgaGVhZGVycyB9ID0gbWU7XG5cbiAgICAgICAgbWUuZmlyZSgnYmVmb3JlUmVxdWVzdCcsIHtcbiAgICAgICAgICAgIGhlYWRlcnNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV2UgYXNrIHRoZSBzZXJ2ZXIgdG8gZGVsZXRlIHVzaW5nIG91ciB0aGlzLmRvY3VtZW50SWRcbiAgICAgICAgY29uc3Qgc3RhdHVzUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChtZS5kb2N1bWVudERlbGV0ZVVybCwge1xuICAgICAgICAgICAgbWV0aG9kIDogbWUuZG9jdW1lbnREZWxldGVNZXRob2QsXG4gICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN1Y2Nlc3NcbiAgICAgICAgaWYgKGh0dHBTdWNjZXNzQ29kZXNbU3RyaW5nKHN0YXR1c1Jlc3BvbnNlLnN0YXR1cylbMF1dKSB7XG4gICAgICAgICAgICBtZS5jbGVhcigpO1xuICAgICAgICAgICAgbWUuc3RhdGUgPSAncmVhZHknO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbWUuZXJyb3IgPSBgJHttZS5kb2N1bWVudERlbGV0ZUVycm9yfTogJHtzdGF0dXNSZXNwb25zZS5zdGF0dXNUZXh0fWA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBjaGVja0RvY3VtZW50U3RhdHVzKCkge1xuICAgICAgICBjb25zdFxuICAgICAgICAgICAgbWUgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgeyBoZWFkZXJzIH0gPSBtZTtcblxuICAgICAgICBpZiAobWUuc3RhdGUgPT09ICdwcm9jZXNzaW5nJykge1xuICAgICAgICAgICAgbWUuZmlyZSgnYmVmb3JlUmVxdWVzdCcsIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3Qgc3RhdHVzUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChtZS5kb2N1bWVudFN0YXR1c1VybCwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnNcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBTdWNjZXNzXG4gICAgICAgICAgICBpZiAoaHR0cFN1Y2Nlc3NDb2Rlc1tTdHJpbmcoc3RhdHVzUmVzcG9uc2Uuc3RhdHVzKVswXV0pIHtcbiAgICAgICAgICAgICAgICBjb25zdFxuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJKc29uICAgPSBhd2FpdCBzdGF0dXNSZXNwb25zZS5qc29uKCksXG4gICAgICAgICAgICAgICAgICAgIHNlcnZlclN0YXR1cyA9IHNlcnZlckpzb24uc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAvLyBNYXAgdGhlIHNlcnZlcidzIHN0YXRlcyBjb2RlcyB0byBvdXIgb3duIHN0YXR1cyBjb2Rlc1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXMgICAgICAgPSBtZS5kb2N1bWVudFN0YXR1c01hcFtzZXJ2ZXJTdGF0dXNdIHx8IHNlcnZlclN0YXR1cztcblxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NjYW5uaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLnRpbWVvdXQobWUuc3RhdHVzU2NhbkludGVydmFsKS50aGVuKCgpID0+IHttZS5jaGVja0RvY3VtZW50U3RhdHVzKCl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdkZWxldGVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLmVycm9yID0gYCR7bWUuZG9jdW1lbnRUZXh0fSAke21lLmRvY3VtZW50SWR9ICR7aXNOb0xvbmdlckF2YWlsYWJsZX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWUuc3RhdGUgPSAncmVhZHknO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Vycm9yJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLmVycm9yID0gYCR7bWUuZG9jdW1lbnRTdGF0dXNFcnJvcn06ICR7c3RhdHVzUmVzcG9uc2Uuc3RhdHVzVGV4dCB8fCBgU2VydmVyIGVycm9yICR7c3RhdHVzUmVzcG9uc2Uuc3RhdHVzfWB9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLnN0YXRlID0gJ2RlbGV0ZWQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5zdGF0ZSA9IHN0YXR1cztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtZS5lcnJvciA9IGAke21lLmRvY3VtZW50U3RhdHVzRXJyb3J9OiAke3N0YXR1c1Jlc3BvbnNlLnN0YXR1c1RleHQgfHwgYFNlcnZlciBlcnJvciAke3N0YXR1c1Jlc3BvbnNlLnN0YXR1c31gfWA7XG4gICAgICAgICAgICAgICAgbWUuc3RhdGUgPSAnZGVsZXRlZCc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZnRlclNldERvY3VtZW50KGRvY3VtZW50KSB7XG4gICAgICAgIGlmIChkb2N1bWVudCkge1xuICAgICAgICAgICAgY29uc3RcbiAgICAgICAgICAgICAgICBtZSAgICA9IHRoaXMsXG4gICAgICAgICAgICAgICAge2Nsc30gPSBtZTtcblxuICAgICAgICAgICAgTmVvQXJyYXkucmVtb3ZlKGNscywgJ25lby1maWVsZC1lbXB0eScpO1xuICAgICAgICAgICAgbWUuY2xzID0gY2xzO1xuXG4gICAgICAgICAgICBtZS5kb2N1bWVudElkID0gZG9jdW1lbnQuaWQ7XG4gICAgICAgICAgICBtZS5maWxlU2l6ZSA9IG1lLmZvcm1hdFNpemUoZG9jdW1lbnQuc2l6ZSk7XG4gICAgICAgICAgICBtZS52ZG9tLmNuWzFdLmNuWzBdLnRleHQgPSBkb2N1bWVudC5maWxlTmFtZTtcbiAgICAgICAgICAgIG1lLnN0YXRlID0gbWUuZG9jdW1lbnRTdGF0dXNNYXBbZG9jdW1lbnQuc3RhdHVzXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgc3RhdGUgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0U3RhdGUodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGNvbnN0XG4gICAgICAgICAgICBtZSAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2ZG9tXG4gICAgICAgICAgICB9ID0gbWUsXG4gICAgICAgICAgICBhbmNob3IgID0gdmRvbS5jblsxXS5jblswXSxcbiAgICAgICAgICAgIHN0YXR1cyAgPSB2ZG9tLmNuWzFdLmNuWzFdO1xuXG4gICAgICAgIGRlbGV0ZSB2ZG9tLmluZXJ0O1xuXG4gICAgICAgIGxldCBpc0NoYW5nZUV2ZW50TmVlZGVkO1xuXG4gICAgICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3JlYWR5JzpcbiAgICAgICAgICAgICAgICBhbmNob3IudGFnID0gJ2Rpdic7XG4gICAgICAgICAgICAgICAgYW5jaG9yLmhyZWYgPSAnJztcbiAgICAgICAgICAgICAgICBpc0NoYW5nZUV2ZW50TmVlZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3VwbG9hZC1mYWlsZWQnOlxuICAgICAgICAgICAgICAgIHN0YXR1cy50ZXh0ID0gYCR7bWUudXBsb2FkRmFpbGVkfSR7aXNOYU4obWUucHJvZ3Jlc3MpID8gJycgOiBgLi4uICgke01hdGgucm91bmQobWUucHJvZ3Jlc3MgKiAxMDApfSUpYH1gO1xuICAgICAgICAgICAgICAgIGlzQ2hhbmdlRXZlbnROZWVkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAncHJvY2Vzc2luZyc6XG4gICAgICAgICAgICAgICAgc3RhdHVzLnRleHQgPSBgJHttZS5zY2FubmluZ30uLi4gKCR7bWUuZm9ybWF0U2l6ZShtZS51cGxvYWRTaXplKX0pYDtcbiAgICAgICAgICAgICAgICB2ZG9tLmluZXJ0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3NjYW4tZmFpbGVkJzpcbiAgICAgICAgICAgICAgICBzdGF0dXMudGV4dCA9IGAke21lLm1hbHdhcmVGb3VuZEluRmlsZX0uIFxcdTIwMjIgJHttZS5maWxlU2l6ZX1gO1xuICAgICAgICAgICAgICAgIG1lLmVycm9yID0gbWUucGxlYXNlQ2hlY2s7XG4gICAgICAgICAgICAgICAgaXNDaGFuZ2VFdmVudE5lZWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdkb3dubG9hZGFibGUnOlxuICAgICAgICAgICAgICAgIGFuY2hvci50YWcgPSAnYSc7XG4gICAgICAgICAgICAgICAgYW5jaG9yLmhyZWYgPSBtZS5jcmVhdGVVcmwobWUuZG93bmxvYWRVcmwsIHtcbiAgICAgICAgICAgICAgICAgICAgW21lLmRvY3VtZW50SWRQYXJhbWV0ZXJdIDogbWUuZG9jdW1lbnRJZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN0YXR1cy50ZXh0ID0gbWUuZmlsZVNpemU7XG4gICAgICAgICAgICAgICAgaXNDaGFuZ2VFdmVudE5lZWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdub3QtZG93bmxvYWRhYmxlJzpcbiAgICAgICAgICAgICAgICBzdGF0dXMudGV4dCA9IG1lLmRvY3VtZW50ID8gbWUuZmlsZVNpemUgOiBgJHttZS5zdWNjZXNzZnVsbHlVcGxvYWRlZH0gXFx1MjAyMiAke21lLmZpbGVTaXplfWA7XG4gICAgICAgICAgICAgICAgaXNDaGFuZ2VFdmVudE5lZWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdkZWxldGVkJzpcbiAgICAgICAgICAgICAgICBzdGF0dXMudGV4dCA9IG1lLmZpbGVXYXNEZWxldGVkO1xuICAgICAgICAgICAgICAgIGlzQ2hhbmdlRXZlbnROZWVkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICAgICAgICAgIHN0YXR1cy50ZXh0ID0gbWUuZmlsZUlzSW5BbkVycm9yU3RhdGU7XG4gICAgICAgICAgICAgICAgbWUuZXJyb3IgPSBtZS5wbGVhc2VDaGVjaztcbiAgICAgICAgICAgICAgICBpc0NoYW5nZUV2ZW50TmVlZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICBpZiAoaXNDaGFuZ2VFdmVudE5lZWRlZCAmJiBvbGRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtZS5maXJlQ2hhbmdlRXZlbnQobWUuZmlsZSlcbiAgICAgICAgfVxuICAgICAgICBtZS52YWxpZGF0ZSgpO1xuICAgICAgICBtZS51cGRhdGUoKTtcblxuICAgICAgICAvLyBQcm9jZXNzaW5nIGFib3ZlIG1heSBtdXRhdGUgY2xzXG4gICAgICAgIGNvbnN0IHsgY2xzIH0gPSBtZTtcblxuICAgICAgICBOZW9BcnJheS5yZW1vdmUoY2xzLCAnbmVvLWZpbGUtdXBsb2FkLXN0YXRlLScgKyBvbGRWYWx1ZSk7XG4gICAgICAgIE5lb0FycmF5LmFkZChjbHMsICduZW8tZmlsZS11cGxvYWQtc3RhdGUtJyArIHZhbHVlKTtcbiAgICAgICAgTmVvQXJyYXlbbWUuZmlsZSB8fCBtZS5kb2N1bWVudCA/ICdyZW1vdmUnIDogJ2FkZCcsICduZW8tZmllbGQtZW1wdHknXTtcbiAgICAgICAgbWUuY2xzID0gY2xzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBVUkwgc3Vic3RpdHV0aW5nIHRoZSBwYXNzZWQgcGFyYW1ldGVyIG5hbWVzIGluIGF0IHRoZSBwbGFjZXMgd2hlcmUgdGhlIG5hbWVcbiAgICAgKiBvY2N1cnMgd2l0aGluIGB7fWAgaW4gdGhlIHBhdHRlcm4uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHVybFBhdHRlcm5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zXG4gICAgICovXG4gICAgY3JlYXRlVXJsKHVybFBhdHRlcm4sIHBhcmFtcykge1xuICAgICAgICBmb3IgKGNvbnN0IHBhcmFtTmFtZSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICAgIHVybFBhdHRlcm4gPSB1cmxQYXR0ZXJuLnJlcGxhY2UoYHske3BhcmFtTmFtZX19YCwgcGFyYW1zW3BhcmFtTmFtZV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1cmxQYXR0ZXJuO1xuICAgIH1cblxuICAgIGJlZm9yZUdldEhlYWRlcnMoaGVhZGVycykge1xuICAgICAgICByZXR1cm4geyAuLi4oaGVhZGVycyB8fCB7fSkgfVxuICAgIH1cblxuICAgIGJlZm9yZUdldERvY3VtZW50U3RhdHVzVXJsKGRvY3VtZW50U3RhdHVzVXJsKSB7XG4gICAgICAgIGNvbnN0IG1lID0gdGhpcztcblxuICAgICAgICByZXR1cm4gdHlwZW9mIGRvY3VtZW50U3RhdHVzVXJsID09PSAnZnVuY3Rpb24nPyBkb2N1bWVudFN0YXR1c1VybC5jYWxsKG1lLCBtZSkgOiBtZS5jcmVhdGVVcmwoZG9jdW1lbnRTdGF0dXNVcmwsIHtcbiAgICAgICAgICAgIFttZS5kb2N1bWVudElkUGFyYW1ldGVyXSA6IG1lLmRvY3VtZW50SWRcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYmVmb3JlR2V0RG9jdW1lbnREZWxldGVVcmwoZG9jdW1lbnREZWxldGVVcmwpIHtcbiAgICAgICAgY29uc3QgbWUgPSB0aGlzO1xuXG4gICAgICAgIHJldHVybiB0eXBlb2YgZG9jdW1lbnREZWxldGVVcmwgPT09ICdmdW5jdGlvbic/IGRvY3VtZW50RGVsZXRlVXJsLmNhbGwobWUsIG1lKSA6IG1lLmNyZWF0ZVVybChkb2N1bWVudERlbGV0ZVVybCwge1xuICAgICAgICAgICAgW21lLmRvY3VtZW50SWRQYXJhbWV0ZXJdIDogbWUuZG9jdW1lbnRJZFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBiZWZvcmVHZXREb3dubG9hZFVybChkb3dubG9hZFVybCkge1xuICAgICAgICBjb25zdCBtZSA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIHR5cGVvZiBkb3dubG9hZFVybCA9PT0gJ2Z1bmN0aW9uJz8gZG93bmxvYWRVcmwuY2FsbChtZSwgbWUpIDogbWUuY3JlYXRlVXJsKGRvd25sb2FkVXJsLCB7XG4gICAgICAgICAgICBbbWUuZG9jdW1lbnRJZFBhcmFtZXRlcl0gOiBtZS5kb2N1bWVudElkXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGJlZm9yZUdldE1heFNpemUobWF4U2l6ZSkge1xuICAgICAgICAvLyBOb3QgY29uZmlndXJlZCBtZWFucyBubyBsaW1pdFxuICAgICAgICBpZiAobWF4U2l6ZSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTcGxpdCBlZyBcIjEwMG1iXCIgaW50byB0aGUgbnVtZXJpYyBhbmQgdW5pdHMgcGFydHNcbiAgICAgICAgY29uc3Qgc2l6ZVBhcnRzID0gc2l6ZVJFLmV4ZWMobWF4U2l6ZSk7XG5cbiAgICAgICAgaWYgKHNpemVQYXJ0cykge1xuICAgICAgICAgICAgLy8gQ29udmVydCBtYiB0byAxMDAwMDAwIGV0Y1xuICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IHNpemVNdWx0aXBsaWVyWyhzaXplUGFydHNbMl18fCd1bml0JykudG9Mb3dlckNhc2UoKV07XG5cbiAgICAgICAgICAgIHJldHVybiBwYXJzZUludChzaXplUGFydHNbMV0pICogbXVsdGlwbGllcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFmdGVyU2V0RXJyb3IodGV4dCkge1xuICAgICAgICB0aGlzLnZkb20uY25bNV0uY24gPSB0ZXh0ID8gW3t2dHlwZSA6ICd0ZXh0JywgdGV4dH1dIDogW107XG4gICAgICAgIHRoaXMudmFsaWRhdGUoKTtcbiAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICB9XG5cbiAgICBmb3JtYXRTaXplKGJ5dGVzLCBzZXBhcmF0b3IgPSAnJywgcG9zdEZpeCA9ICcnKSB7XG4gICAgICAgIGlmIChieXRlcykge1xuICAgICAgICAgICAgY29uc3RcbiAgICAgICAgICAgICAgICBzaXplcyA9IFsnQnl0ZXMnLCAnS0InLCAnTUInLCAnR0InLCAnVEInXSxcbiAgICAgICAgICAgICAgICBpICAgICA9IE1hdGgubWluKHBhcnNlSW50KE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coMTAwMCkpLnRvU3RyaW5nKCksIDEwKSwgc2l6ZXMubGVuZ3RoIC0gMSk7XG5cbiAgICAgICAgICAgIHJldHVybiBgJHsoYnl0ZXMgLyAoMTAwMCAqKiBpKSkudG9GaXhlZChpID8gMSA6IDApfSR7c2VwYXJhdG9yfSR7c2l6ZXNbaV19JHtwb3N0Rml4fWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICduL2EnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgICAqL1xuICAgIHZhbGlkYXRlKCkge1xuICAgICAgICBjb25zdFxuICAgICAgICAgICAgeyBjbHMgfSA9IHRoaXMsXG4gICAgICAgICAgICBpc1ZhbGlkID0gdGhpcy5pc1ZhbGlkKCk7XG5cbiAgICAgICAgTmVvQXJyYXkudG9nZ2xlKGNscywgJ25lby1pbnZhbGlkJywgIWlzVmFsaWQpO1xuICAgICAgICB0aGlzLmNscyA9IGNscztcblxuICAgICAgICByZXR1cm4gaXNWYWxpZDtcbiAgICB9XG5cbiAgICBpc1ZhbGlkKCkge1xuICAgICAgICBjb25zdCBtZSA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuICFtZS5lcnJvciAmJiAgIShtZS5zdGF0ZSA9PT0gJ3JlYWR5JyAmJiBtZS5yZXF1aXJlZCkgfHxcbiAgICAgICAgICAgICAgICggICAgKG1lLnN0YXRlID09PSAnZG93bmxvYWRhYmxlJykgfHxcbiAgICAgICAgICAgICAgICAgICAgKG1lLnN0YXRlID09PSAnbm90LWRvd25sb2FkYWJsZScpXG4gICAgICAgICAgICAgICApO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoRmlsZVVwbG9hZCk7XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9