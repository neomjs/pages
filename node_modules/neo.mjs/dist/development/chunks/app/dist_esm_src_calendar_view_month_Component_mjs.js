"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["dist_esm_src_calendar_view_month_Component_mjs"],{

/***/ "./dist/esm/src/calendar/view/month/Component.mjs":
/*!********************************************************!*\
  !*** ./dist/esm/src/calendar/view/month/Component.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../component/Base.mjs */ "./dist/esm/src/component/Base.mjs");
/* harmony import */ var _util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/Date.mjs */ "./dist/esm/src/util/Date.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/Array.mjs */ "./dist/esm/src/util/Array.mjs");
/* harmony import */ var _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/VDom.mjs */ "./dist/esm/src/util/VDom.mjs");
const a=new Date;a.getDate(),a.getMonth(),a.getFullYear();class r extends _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]{static config={className:"Neo.calendar.view.month.Component",baseCls:["neo-calendar-monthcomponent"],bind:{calendarStore:"stores.calendars",currentDate:e=>e.currentDate,eventBorder:e=>e.events.border,eventStore:"stores.events",locale:e=>e.locale,showWeekends:e=>e.showWeekends,weekStartDay:e=>e.weekStartDay},calendarStore_:null,currentDate_:null,dayNameFormat_:"short",eventBorder_:null,eventStore_:null,headerHeight:null,intlFormat_day:null,intlFormat_month:null,intlFormat_time:null,isScrolling:!1,locale_:Neo.config.locale,monthNameFormat_:"short",needsEventUpdate:!1,owner:null,scrollTaskId:null,showWeekends_:!0,timeFormat_:{hour:"2-digit",minute:"2-digit"},useScrollBoxShadows_:!0,vdom:{cn:[{cls:["neo-days-header"],cn:[{cls:["neo-static-header"],style:{},cn:[{tag:"span",cls:["neo-month-name"],flag:"month-name"},{vtype:"text"}]}]},{cls:["neo-c-m-scrollcontainer"]}]},weekStartDay_:0};construct(e){super.construct(e);let t=this;t.addDomListeners([{dblclick:t.onEventDoubleClick,delegate:"neo-event",scope:t},{wheel:t.onWheel,scope:t}]),t.calendarStore.getCount()>0&&t.eventStore.getCount()>0&&(t.needsEventUpdate=!0),t.needsEventUpdate&&t.createContent(!0),t.updateHeader(!0)}afterSetCalendarStore(e,t){let n=this,o={load:n.onCalendarStoreLoad,recordChange:n.onCalendarStoreRecordChange,scope:n};t?.un(o),e?.on(o)}afterSetCurrentDate(e,t){let n=this;n.isConstructed&&(n.createContent(!0),n.updateHeader(),n.afterSetMounted(!0,!1))}afterSetDayNameFormat(e,t){let n=this;n.intlFormat_day=new Intl.DateTimeFormat(n.locale,{weekday:e}),void 0!==t&&n.updateHeader()}afterSetEventBorder(e,t){let o=this.cls;t&&_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].remove(o,`neo-event-border-${t}`),e&&_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].add(o,`neo-event-border-${e}`),this.cls=o}afterSetEventStore(e,t){let n=this,o={load:n.onEventStoreLoad,recordChange:n.onEventStoreRecordChange,scope:n};t?.un(o),e?.on(o)}afterSetLocale(e,t){if(t){let t=this;t.intlFormat_day=new Intl.DateTimeFormat(e,{weekday:t.dayNameFormat}),t.intlFormat_month=new Intl.DateTimeFormat(e,{month:t.monthNameFormat}),t.intlFormat_time=new Intl.DateTimeFormat(e,t.timeFormat),t.updateMonthNames(!0),t.updateHeader()}}afterSetMonthNameFormat(e,t){let n=this;n.intlFormat_month=new Intl.DateTimeFormat(n.locale,{month:e}),void 0!==t&&n.updateMonthNames()}afterSetMounted(e,t){let n=this;e&&(n.needsEventUpdate&&(n.createContent(),n.needsEventUpdate=!1),n.timeout(100).then(()=>{n.getDomRect([n.vdom.cn[1].id,n.vdom.cn[0].id]).then(e=>{n.headerHeight=e[1].height,Neo.main.DomAccess.scrollTo({direction:"top",id:n.vdom.cn[1].id,value:e[0].height-e[1].height})})}))}afterSetShowWeekends(e,t){if(void 0!==t){let t,n,o=this,{vdom:a}=o;a.cn[1].cn.forEach(o=>{if(o.flag)for(t=0;t<7;t++)n=o.cn[t],n.cls.includes("neo-weekend")&&(e?delete n.removeDom:n.removeDom=!0)}),o.updateHeader()}}afterSetTimeFormat(e,t){this.intlFormat_time=new Intl.DateTimeFormat(this.locale,e)}afterSetUseScrollBoxShadows(e,t){_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"][e?"add":"remove"](this.vdom.cn[1].cls,"neo-scroll-shadows"),this.update()}afterSetWeekStartDay(e,t){void 0!==t&&(this.createContent(!0),this.updateHeader())}beforeSetDayNameFormat(e,n){return this.beforeSetEnumValue(e,n,"dayNameFormat",_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].prototype.dayNameFormats)}beforeSetMonthNameFormat(e,n){return this.beforeSetEnumValue(e,n,"monthNameFormat",_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].prototype.monthNameFormats)}createContent(e=!1){let n=this;if(n.mounted){let e,o,a=n.currentDate,{vdom:r}=n,l=0;for(r.cn[1].cn=[],e=_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].getFirstDayOffset(a,n.weekStartDay),a.setDate(1-e),a.setDate(a.getDate()-42);l<18;l++)o=n.createWeek(_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].clone(a)),o.header&&r.cn[1].cn.push(o.header),r.cn[1].cn.push(o.row),a.setDate(a.getDate()+7);n.update()}else n.needsEventUpdate=!0}createWeek(e){let n,o,a,r,l,d,c,s=this,m=0,{calendarStore:i,eventStore:h}=s,u=null,g=_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].convertToyyyymmdd(e);for(d={flag:g,cls:["neo-week"],cn:[],id:`${s.id}__week__${g}`};m<7;m++)o=e.getDate(),g=_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].convertToyyyymmdd(e),1===o&&(d.flag=g,u={cls:["neo-month-header"],cn:[{cls:["neo-month-header-content"],cn:[{tag:"span",cls:["neo-month-name"],flag:"month-name",html:s.intlFormat_month.format(e)},{vtype:"text",html:` ${e.getFullYear()}`}]}]}),a={cls:["neo-day"],id:`${s.id}__day__${g}`,cn:[{cls:["neo-day-number"],html:o,id:`${s.id}__day_number__${g}`}]},c=e.getDay(),0!==c&&6!==c||(a.cls.push("neo-weekend"),s.showWeekends||(a.removeDom=!0)),a.removeDom||(r=h.getDayRecords(e),r.forEach(e=>{l=e[h.keyProperty],n=i.get(e.calendarId),n.active&&a.cn.push({cls:["neo-event",`neo-${n.color}`],flag:l,id:s.id+"__"+l,tabIndex:-1,cn:[{cls:["neo-event-title"],html:e.title,id:s.id+"__title__"+l},{cls:["neo-event-time"],html:s.intlFormat_time.format(e.startDate),id:s.id+"__time__"+l}]})})),d.cn.push(a),e.setDate(e.getDate()+1);return{header:u,row:d}}onCalendarStoreLoad(e){this.eventStore.getCount()>0&&this.createContent()}onCalendarStoreRecordChange(e){this.createContent()}onEventDoubleClick(e){if(this.data.events.enableEdit){let t=this,{editEventContainer:n}=t.owner,{path:a}=e,r=a[0],l=a[2],d=a[3],c=_util_VDom_mjs__WEBPACK_IMPORTED_MODULE_3__["default"].find(t.vdom,r.id).vdom,s=t.eventStore.get(c.flag),m=n.style;Object.assign(m,{left:r.rect.right-l.rect.left+15+"px",top:r.rect.top-d.rect.top+d.scrollTop-12+"px"}),n.setSilent({parentId:a[1].id,record:s,style:m}),n.render(!0)}}onEventStoreLoad(e){this.calendarStore.getCount()>0&&this.createContent()}onEventStoreRecordChange(e){this.createContent()}onFocusChange(e){let{appName:t}=this,{oldPath:n,path:o}=e;n?.[0]?.cls.includes("neo-event")&&Neo.applyDeltas(t,{id:n[0].id,cls:{remove:["neo-focus"]}}),o?.[0]?.cls.includes("neo-event")&&Neo.applyDeltas(t,{id:o[0].id,cls:{add:["neo-focus"]}})}onWheel(e){if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){let o,a,r,l=this,d=l.vdom.cn[1],c=0;if(e.deltaY>0&&Math.round(e.scrollTop/(e.clientHeight-l.headerHeight)*6)>11){for(o=new Date(d.cn[d.cn.length-1].flag),o.setDate(o.getDate()-(o.getDay()-l.weekStartDay));c<6;c++)d.cn[1].cls.includes("neo-month-header")&&d.cn.splice(1,1),d.cn.shift(),o.setDate(o.getDate()+7),r=l.createWeek(_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].clone(o)),r.header&&d.cn.push(r.header),d.cn.push(r.row);l.update()}else if(e.deltaY<0&&Math.round(e.scrollTop/(e.clientHeight-l.headerHeight)*6)<1){for(o=d.cn[0].flag?new Date(d.cn[0].flag):new Date(d.cn[1].flag),o.setDate(o.getDate()-(o.getDay()-l.weekStartDay));c<6;c++)a=d.cn.length,d.cn[a-2].cls.includes("neo-month-header")&&d.cn.splice(a-2,1),d.cn.pop(),o.setDate(o.getDate()-7),r=l.createWeek(_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].clone(o)),d.cn.unshift(r.row),r.header&&d.cn.unshift(r.header);l.promiseUpdate().then(()=>{Neo.main.DomAccess.scrollTo({direction:"top",id:l.vdom.cn[1].id,value:e.clientHeight-l.headerHeight})})}l.isScrolling||(l.isScrolling=!0,_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].add(l.vdom.cn[1].cls,"neo-is-scrolling"),l.vdom.cn[0].cn[0].style.opacity=0,l.update()),l.scrollTaskId&&clearTimeout(l.scrollTaskId),l.scrollTaskId=setTimeout(l.onWheelEnd.bind(l),300)}}onWheelEnd(){let e,t,o=this,{vdom:a}=o,r=a.cn[0].cn[0],l=6;for(o.isScrolling=!1;l<12;l++)if(t=a.cn[1].cn[l].flag,t){e=new Date(t),e.setMonth(e.getMonth()+1),r.cn[0].html=o.intlFormat_month.format(e),r.cn[1].html=` ${e.getFullYear()}`;break}_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].remove(a.cn[1].cls,"neo-is-scrolling"),r.style.opacity=1,o.update()}updateHeader(e=!1){let t,n,o=this,a=o.currentDate,{vdom:r}=o,l=r.cn[0].cn[0],d=1;for(l.cn[0].html=o.intlFormat_month.format(a),l.cn[1].html=` ${a.getFullYear()}`,a.setDate(o.currentDate.getDate()-o.currentDate.getDay()+o.weekStartDay);d<8;d++)t=a.getDay(),e?(n={cls:["neo-day-name"],html:o.intlFormat_day.format(a)},o.showWeekends||0!==t&&6!==t||(n.removeDom=!0),r.cn[0].cn.push(n)):(n=r.cn[0].cn[d],n&&(n.html=o.intlFormat_day.format(a),o.showWeekends||0!==t&&6!==t?delete n.removeDom:n.removeDom=!0)),a.setDate(a.getDate()+1);o.update()}updateMonthNames(e=!1){let t=this,n=t.currentDate;_util_VDom_mjs__WEBPACK_IMPORTED_MODULE_3__["default"].getFlags(t.vdom,"month-name").forEach(e=>{e.html=t.intlFormat_month.format(n),n.setMonth(n.getMonth()+1)}),t.update()}}/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(r));

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC9kaXN0X2VzbV9zcmNfY2FsZW5kYXJfdmlld19tb250aF9Db21wb25lbnRfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQThKLGlCQUFpQix5Q0FBeUMsZ0JBQWdCLDJEQUFDLENBQUMsZUFBZSw0RkFBNEYseU1BQXlNLG1VQUFtVSxnQ0FBZ0MsK0JBQStCLEtBQUssNkJBQTZCLGtDQUFrQyxNQUFNLG9EQUFvRCxFQUFFLGFBQWEsRUFBRSxFQUFFLEVBQUUsZ0NBQWdDLEVBQUUsa0JBQWtCLGFBQWEsbUJBQW1CLFdBQVcsb0JBQW9CLDJEQUEyRCxFQUFFLHdCQUF3QiwrSUFBK0ksMkJBQTJCLGNBQWMsK0VBQStFLGtCQUFrQix5QkFBeUIsV0FBVyxpRkFBaUYsMkJBQTJCLFdBQVcsbURBQW1ELFVBQVUsK0JBQStCLHlCQUF5QixlQUFlLEdBQUcsdURBQUMsOEJBQThCLEVBQUUsTUFBTSx1REFBQywyQkFBMkIsRUFBRSxjQUFjLHdCQUF3QixjQUFjLHlFQUF5RSxrQkFBa0Isb0JBQW9CLE1BQU0sV0FBVyw0Q0FBNEMsd0JBQXdCLGdEQUFnRCx3QkFBd0IscUdBQXFHLDZCQUE2QixXQUFXLHFEQUFxRCxRQUFRLG1DQUFtQyxxQkFBcUIsV0FBVywyRkFBMkYseURBQXlELHdEQUF3RCxpRUFBaUUsRUFBRSxFQUFFLEdBQUcsMEJBQTBCLGVBQWUsZ0JBQWdCLE9BQU8sR0FBRyx1QkFBdUIsa0JBQWtCLElBQUksbUZBQW1GLG9CQUFvQix3QkFBd0IsNERBQTRELGlDQUFpQyx1REFBQywyRUFBMkUsMEJBQTBCLHlEQUF5RCw0QkFBNEIsbURBQW1ELHNEQUFDLDJCQUEyQiw4QkFBOEIscURBQXFELHNEQUFDLDZCQUE2QixvQkFBb0IsV0FBVyxjQUFjLHlCQUF5QixPQUFPLE9BQU8sb0JBQW9CLHNEQUFDLDhFQUE4RSxLQUFLLG1CQUFtQixzREFBQywrRkFBK0YsV0FBVywyQkFBMkIsY0FBYyw4QkFBOEIsNkJBQTZCLFlBQVksc0RBQUMsc0JBQXNCLE9BQU8sb0NBQW9DLEtBQUssVUFBVSxFQUFFLEdBQUcsSUFBSSxvQkFBb0Isc0RBQUMsMENBQTBDLDhCQUE4QixzQ0FBc0Msc0ZBQXNGLEVBQUUsc0JBQXNCLGdCQUFnQixFQUFFLEVBQUUsRUFBRSxLQUFLLHNCQUFzQixLQUFLLFNBQVMsRUFBRSxPQUFPLG9DQUFvQyxLQUFLLGdCQUFnQixFQUFFLEVBQUUsRUFBRSwwSUFBMEksOERBQThELHdCQUF3QixRQUFRLDBDQUEwQywyREFBMkQsRUFBRSx1RkFBdUYsRUFBRSxFQUFFLHlDQUF5QyxPQUFPLGdCQUFnQix1QkFBdUIsbURBQW1ELCtCQUErQixxQkFBcUIsc0JBQXNCLGdDQUFnQyxZQUFZLHFCQUFxQixVQUFVLE9BQU8sMEJBQTBCLHNEQUFDLDZEQUE2RCxpQkFBaUIsb0ZBQW9GLGVBQWUsa0NBQWtDLGdCQUFnQixvQkFBb0Isc0RBQXNELDRCQUE0QixxQkFBcUIsaUJBQWlCLElBQUksVUFBVSxPQUFPLGlCQUFpQixHQUFHLHNEQUFzRCxnQkFBZ0Isc0JBQXNCLHdEQUF3RCxnQkFBZ0IsbUJBQW1CLEVBQUUsV0FBVywwQ0FBMEMsb0NBQW9DLDZFQUE2RSw0RkFBNEYsSUFBSSxvSEFBb0gsc0RBQUMsMERBQTBELFdBQVcsaUZBQWlGLG9IQUFvSCxJQUFJLG9JQUFvSSxzREFBQyxnRUFBZ0UsNEJBQTRCLDZCQUE2Qix1RUFBdUUsRUFBRSxFQUFFLGlDQUFpQyx1REFBQywyTEFBMkwsYUFBYSxnQkFBZ0IsT0FBTyx1QkFBdUIscUJBQXFCLEtBQUssK0JBQStCLG9HQUFvRyxnQkFBZ0IsRUFBRSxNQUFNLHVEQUFDLHFFQUFxRSxtQkFBbUIsZ0NBQWdDLE9BQU8sdUJBQXVCLCtEQUErRCxnQkFBZ0IsMkVBQTJFLElBQUksdUJBQXVCLHFEQUFxRCxxTkFBcU4sV0FBVyx1QkFBdUIsMkJBQTJCLHNEQUFDLDJDQUEyQywrREFBK0QsY0FBYyxpRUFBZSxpQkFBaUIsRSIsInNvdXJjZXMiOlsid2VicGFjazovL25lby5tanMvLi9kaXN0L2VzbS9zcmMvY2FsZW5kYXIvdmlldy9tb250aC9Db21wb25lbnQubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBlIGZyb21cIi4uLy4uLy4uL2NvbXBvbmVudC9CYXNlLm1qc1wiO2ltcG9ydCB0IGZyb21cIi4uLy4uLy4uL3V0aWwvRGF0ZS5tanNcIjtpbXBvcnQgbiBmcm9tXCIuLi8uLi8uLi91dGlsL0FycmF5Lm1qc1wiO2ltcG9ydCBvIGZyb21cIi4uLy4uLy4uL3V0aWwvVkRvbS5tanNcIjtjb25zdCBhPW5ldyBEYXRlO2EuZ2V0RGF0ZSgpLGEuZ2V0TW9udGgoKSxhLmdldEZ1bGxZZWFyKCk7Y2xhc3MgciBleHRlbmRzIGV7c3RhdGljIGNvbmZpZz17Y2xhc3NOYW1lOlwiTmVvLmNhbGVuZGFyLnZpZXcubW9udGguQ29tcG9uZW50XCIsYmFzZUNsczpbXCJuZW8tY2FsZW5kYXItbW9udGhjb21wb25lbnRcIl0sYmluZDp7Y2FsZW5kYXJTdG9yZTpcInN0b3Jlcy5jYWxlbmRhcnNcIixjdXJyZW50RGF0ZTplPT5lLmN1cnJlbnREYXRlLGV2ZW50Qm9yZGVyOmU9PmUuZXZlbnRzLmJvcmRlcixldmVudFN0b3JlOlwic3RvcmVzLmV2ZW50c1wiLGxvY2FsZTplPT5lLmxvY2FsZSxzaG93V2Vla2VuZHM6ZT0+ZS5zaG93V2Vla2VuZHMsd2Vla1N0YXJ0RGF5OmU9PmUud2Vla1N0YXJ0RGF5fSxjYWxlbmRhclN0b3JlXzpudWxsLGN1cnJlbnREYXRlXzpudWxsLGRheU5hbWVGb3JtYXRfOlwic2hvcnRcIixldmVudEJvcmRlcl86bnVsbCxldmVudFN0b3JlXzpudWxsLGhlYWRlckhlaWdodDpudWxsLGludGxGb3JtYXRfZGF5Om51bGwsaW50bEZvcm1hdF9tb250aDpudWxsLGludGxGb3JtYXRfdGltZTpudWxsLGlzU2Nyb2xsaW5nOiExLGxvY2FsZV86TmVvLmNvbmZpZy5sb2NhbGUsbW9udGhOYW1lRm9ybWF0XzpcInNob3J0XCIsbmVlZHNFdmVudFVwZGF0ZTohMSxvd25lcjpudWxsLHNjcm9sbFRhc2tJZDpudWxsLHNob3dXZWVrZW5kc186ITAsdGltZUZvcm1hdF86e2hvdXI6XCIyLWRpZ2l0XCIsbWludXRlOlwiMi1kaWdpdFwifSx1c2VTY3JvbGxCb3hTaGFkb3dzXzohMCx2ZG9tOntjbjpbe2NsczpbXCJuZW8tZGF5cy1oZWFkZXJcIl0sY246W3tjbHM6W1wibmVvLXN0YXRpYy1oZWFkZXJcIl0sc3R5bGU6e30sY246W3t0YWc6XCJzcGFuXCIsY2xzOltcIm5lby1tb250aC1uYW1lXCJdLGZsYWc6XCJtb250aC1uYW1lXCJ9LHt2dHlwZTpcInRleHRcIn1dfV19LHtjbHM6W1wibmVvLWMtbS1zY3JvbGxjb250YWluZXJcIl19XX0sd2Vla1N0YXJ0RGF5XzowfTtjb25zdHJ1Y3QoZSl7c3VwZXIuY29uc3RydWN0KGUpO2xldCB0PXRoaXM7dC5hZGREb21MaXN0ZW5lcnMoW3tkYmxjbGljazp0Lm9uRXZlbnREb3VibGVDbGljayxkZWxlZ2F0ZTpcIm5lby1ldmVudFwiLHNjb3BlOnR9LHt3aGVlbDp0Lm9uV2hlZWwsc2NvcGU6dH1dKSx0LmNhbGVuZGFyU3RvcmUuZ2V0Q291bnQoKT4wJiZ0LmV2ZW50U3RvcmUuZ2V0Q291bnQoKT4wJiYodC5uZWVkc0V2ZW50VXBkYXRlPSEwKSx0Lm5lZWRzRXZlbnRVcGRhdGUmJnQuY3JlYXRlQ29udGVudCghMCksdC51cGRhdGVIZWFkZXIoITApfWFmdGVyU2V0Q2FsZW5kYXJTdG9yZShlLHQpe2xldCBuPXRoaXMsbz17bG9hZDpuLm9uQ2FsZW5kYXJTdG9yZUxvYWQscmVjb3JkQ2hhbmdlOm4ub25DYWxlbmRhclN0b3JlUmVjb3JkQ2hhbmdlLHNjb3BlOm59O3Q/LnVuKG8pLGU/Lm9uKG8pfWFmdGVyU2V0Q3VycmVudERhdGUoZSx0KXtsZXQgbj10aGlzO24uaXNDb25zdHJ1Y3RlZCYmKG4uY3JlYXRlQ29udGVudCghMCksbi51cGRhdGVIZWFkZXIoKSxuLmFmdGVyU2V0TW91bnRlZCghMCwhMSkpfWFmdGVyU2V0RGF5TmFtZUZvcm1hdChlLHQpe2xldCBuPXRoaXM7bi5pbnRsRm9ybWF0X2RheT1uZXcgSW50bC5EYXRlVGltZUZvcm1hdChuLmxvY2FsZSx7d2Vla2RheTplfSksdm9pZCAwIT09dCYmbi51cGRhdGVIZWFkZXIoKX1hZnRlclNldEV2ZW50Qm9yZGVyKGUsdCl7bGV0IG89dGhpcy5jbHM7dCYmbi5yZW1vdmUobyxgbmVvLWV2ZW50LWJvcmRlci0ke3R9YCksZSYmbi5hZGQobyxgbmVvLWV2ZW50LWJvcmRlci0ke2V9YCksdGhpcy5jbHM9b31hZnRlclNldEV2ZW50U3RvcmUoZSx0KXtsZXQgbj10aGlzLG89e2xvYWQ6bi5vbkV2ZW50U3RvcmVMb2FkLHJlY29yZENoYW5nZTpuLm9uRXZlbnRTdG9yZVJlY29yZENoYW5nZSxzY29wZTpufTt0Py51bihvKSxlPy5vbihvKX1hZnRlclNldExvY2FsZShlLHQpe2lmKHQpe2xldCB0PXRoaXM7dC5pbnRsRm9ybWF0X2RheT1uZXcgSW50bC5EYXRlVGltZUZvcm1hdChlLHt3ZWVrZGF5OnQuZGF5TmFtZUZvcm1hdH0pLHQuaW50bEZvcm1hdF9tb250aD1uZXcgSW50bC5EYXRlVGltZUZvcm1hdChlLHttb250aDp0Lm1vbnRoTmFtZUZvcm1hdH0pLHQuaW50bEZvcm1hdF90aW1lPW5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGUsdC50aW1lRm9ybWF0KSx0LnVwZGF0ZU1vbnRoTmFtZXMoITApLHQudXBkYXRlSGVhZGVyKCl9fWFmdGVyU2V0TW9udGhOYW1lRm9ybWF0KGUsdCl7bGV0IG49dGhpcztuLmludGxGb3JtYXRfbW9udGg9bmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobi5sb2NhbGUse21vbnRoOmV9KSx2b2lkIDAhPT10JiZuLnVwZGF0ZU1vbnRoTmFtZXMoKX1hZnRlclNldE1vdW50ZWQoZSx0KXtsZXQgbj10aGlzO2UmJihuLm5lZWRzRXZlbnRVcGRhdGUmJihuLmNyZWF0ZUNvbnRlbnQoKSxuLm5lZWRzRXZlbnRVcGRhdGU9ITEpLG4udGltZW91dCgxMDApLnRoZW4oKCk9PntuLmdldERvbVJlY3QoW24udmRvbS5jblsxXS5pZCxuLnZkb20uY25bMF0uaWRdKS50aGVuKGU9PntuLmhlYWRlckhlaWdodD1lWzFdLmhlaWdodCxOZW8ubWFpbi5Eb21BY2Nlc3Muc2Nyb2xsVG8oe2RpcmVjdGlvbjpcInRvcFwiLGlkOm4udmRvbS5jblsxXS5pZCx2YWx1ZTplWzBdLmhlaWdodC1lWzFdLmhlaWdodH0pfSl9KSl9YWZ0ZXJTZXRTaG93V2Vla2VuZHMoZSx0KXtpZih2b2lkIDAhPT10KXtsZXQgdCxuLG89dGhpcyx7dmRvbTphfT1vO2EuY25bMV0uY24uZm9yRWFjaChvPT57aWYoby5mbGFnKWZvcih0PTA7dDw3O3QrKyluPW8uY25bdF0sbi5jbHMuaW5jbHVkZXMoXCJuZW8td2Vla2VuZFwiKSYmKGU/ZGVsZXRlIG4ucmVtb3ZlRG9tOm4ucmVtb3ZlRG9tPSEwKX0pLG8udXBkYXRlSGVhZGVyKCl9fWFmdGVyU2V0VGltZUZvcm1hdChlLHQpe3RoaXMuaW50bEZvcm1hdF90aW1lPW5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KHRoaXMubG9jYWxlLGUpfWFmdGVyU2V0VXNlU2Nyb2xsQm94U2hhZG93cyhlLHQpe25bZT9cImFkZFwiOlwicmVtb3ZlXCJdKHRoaXMudmRvbS5jblsxXS5jbHMsXCJuZW8tc2Nyb2xsLXNoYWRvd3NcIiksdGhpcy51cGRhdGUoKX1hZnRlclNldFdlZWtTdGFydERheShlLHQpe3ZvaWQgMCE9PXQmJih0aGlzLmNyZWF0ZUNvbnRlbnQoITApLHRoaXMudXBkYXRlSGVhZGVyKCkpfWJlZm9yZVNldERheU5hbWVGb3JtYXQoZSxuKXtyZXR1cm4gdGhpcy5iZWZvcmVTZXRFbnVtVmFsdWUoZSxuLFwiZGF5TmFtZUZvcm1hdFwiLHQucHJvdG90eXBlLmRheU5hbWVGb3JtYXRzKX1iZWZvcmVTZXRNb250aE5hbWVGb3JtYXQoZSxuKXtyZXR1cm4gdGhpcy5iZWZvcmVTZXRFbnVtVmFsdWUoZSxuLFwibW9udGhOYW1lRm9ybWF0XCIsdC5wcm90b3R5cGUubW9udGhOYW1lRm9ybWF0cyl9Y3JlYXRlQ29udGVudChlPSExKXtsZXQgbj10aGlzO2lmKG4ubW91bnRlZCl7bGV0IGUsbyxhPW4uY3VycmVudERhdGUse3Zkb206cn09bixsPTA7Zm9yKHIuY25bMV0uY249W10sZT10LmdldEZpcnN0RGF5T2Zmc2V0KGEsbi53ZWVrU3RhcnREYXkpLGEuc2V0RGF0ZSgxLWUpLGEuc2V0RGF0ZShhLmdldERhdGUoKS00Mik7bDwxODtsKyspbz1uLmNyZWF0ZVdlZWsodC5jbG9uZShhKSksby5oZWFkZXImJnIuY25bMV0uY24ucHVzaChvLmhlYWRlciksci5jblsxXS5jbi5wdXNoKG8ucm93KSxhLnNldERhdGUoYS5nZXREYXRlKCkrNyk7bi51cGRhdGUoKX1lbHNlIG4ubmVlZHNFdmVudFVwZGF0ZT0hMH1jcmVhdGVXZWVrKGUpe2xldCBuLG8sYSxyLGwsZCxjLHM9dGhpcyxtPTAse2NhbGVuZGFyU3RvcmU6aSxldmVudFN0b3JlOmh9PXMsdT1udWxsLGc9dC5jb252ZXJ0VG95eXl5bW1kZChlKTtmb3IoZD17ZmxhZzpnLGNsczpbXCJuZW8td2Vla1wiXSxjbjpbXSxpZDpgJHtzLmlkfV9fd2Vla19fJHtnfWB9O208NzttKyspbz1lLmdldERhdGUoKSxnPXQuY29udmVydFRveXl5eW1tZGQoZSksMT09PW8mJihkLmZsYWc9Zyx1PXtjbHM6W1wibmVvLW1vbnRoLWhlYWRlclwiXSxjbjpbe2NsczpbXCJuZW8tbW9udGgtaGVhZGVyLWNvbnRlbnRcIl0sY246W3t0YWc6XCJzcGFuXCIsY2xzOltcIm5lby1tb250aC1uYW1lXCJdLGZsYWc6XCJtb250aC1uYW1lXCIsaHRtbDpzLmludGxGb3JtYXRfbW9udGguZm9ybWF0KGUpfSx7dnR5cGU6XCJ0ZXh0XCIsaHRtbDpgICR7ZS5nZXRGdWxsWWVhcigpfWB9XX1dfSksYT17Y2xzOltcIm5lby1kYXlcIl0saWQ6YCR7cy5pZH1fX2RheV9fJHtnfWAsY246W3tjbHM6W1wibmVvLWRheS1udW1iZXJcIl0saHRtbDpvLGlkOmAke3MuaWR9X19kYXlfbnVtYmVyX18ke2d9YH1dfSxjPWUuZ2V0RGF5KCksMCE9PWMmJjYhPT1jfHwoYS5jbHMucHVzaChcIm5lby13ZWVrZW5kXCIpLHMuc2hvd1dlZWtlbmRzfHwoYS5yZW1vdmVEb209ITApKSxhLnJlbW92ZURvbXx8KHI9aC5nZXREYXlSZWNvcmRzKGUpLHIuZm9yRWFjaChlPT57bD1lW2gua2V5UHJvcGVydHldLG49aS5nZXQoZS5jYWxlbmRhcklkKSxuLmFjdGl2ZSYmYS5jbi5wdXNoKHtjbHM6W1wibmVvLWV2ZW50XCIsYG5lby0ke24uY29sb3J9YF0sZmxhZzpsLGlkOnMuaWQrXCJfX1wiK2wsdGFiSW5kZXg6LTEsY246W3tjbHM6W1wibmVvLWV2ZW50LXRpdGxlXCJdLGh0bWw6ZS50aXRsZSxpZDpzLmlkK1wiX190aXRsZV9fXCIrbH0se2NsczpbXCJuZW8tZXZlbnQtdGltZVwiXSxodG1sOnMuaW50bEZvcm1hdF90aW1lLmZvcm1hdChlLnN0YXJ0RGF0ZSksaWQ6cy5pZCtcIl9fdGltZV9fXCIrbH1dfSl9KSksZC5jbi5wdXNoKGEpLGUuc2V0RGF0ZShlLmdldERhdGUoKSsxKTtyZXR1cm57aGVhZGVyOnUscm93OmR9fW9uQ2FsZW5kYXJTdG9yZUxvYWQoZSl7dGhpcy5ldmVudFN0b3JlLmdldENvdW50KCk+MCYmdGhpcy5jcmVhdGVDb250ZW50KCl9b25DYWxlbmRhclN0b3JlUmVjb3JkQ2hhbmdlKGUpe3RoaXMuY3JlYXRlQ29udGVudCgpfW9uRXZlbnREb3VibGVDbGljayhlKXtpZih0aGlzLmRhdGEuZXZlbnRzLmVuYWJsZUVkaXQpe2xldCB0PXRoaXMse2VkaXRFdmVudENvbnRhaW5lcjpufT10Lm93bmVyLHtwYXRoOmF9PWUscj1hWzBdLGw9YVsyXSxkPWFbM10sYz1vLmZpbmQodC52ZG9tLHIuaWQpLnZkb20scz10LmV2ZW50U3RvcmUuZ2V0KGMuZmxhZyksbT1uLnN0eWxlO09iamVjdC5hc3NpZ24obSx7bGVmdDpyLnJlY3QucmlnaHQtbC5yZWN0LmxlZnQrMTUrXCJweFwiLHRvcDpyLnJlY3QudG9wLWQucmVjdC50b3ArZC5zY3JvbGxUb3AtMTIrXCJweFwifSksbi5zZXRTaWxlbnQoe3BhcmVudElkOmFbMV0uaWQscmVjb3JkOnMsc3R5bGU6bX0pLG4ucmVuZGVyKCEwKX19b25FdmVudFN0b3JlTG9hZChlKXt0aGlzLmNhbGVuZGFyU3RvcmUuZ2V0Q291bnQoKT4wJiZ0aGlzLmNyZWF0ZUNvbnRlbnQoKX1vbkV2ZW50U3RvcmVSZWNvcmRDaGFuZ2UoZSl7dGhpcy5jcmVhdGVDb250ZW50KCl9b25Gb2N1c0NoYW5nZShlKXtsZXR7YXBwTmFtZTp0fT10aGlzLHtvbGRQYXRoOm4scGF0aDpvfT1lO24/LlswXT8uY2xzLmluY2x1ZGVzKFwibmVvLWV2ZW50XCIpJiZOZW8uYXBwbHlEZWx0YXModCx7aWQ6blswXS5pZCxjbHM6e3JlbW92ZTpbXCJuZW8tZm9jdXNcIl19fSksbz8uWzBdPy5jbHMuaW5jbHVkZXMoXCJuZW8tZXZlbnRcIikmJk5lby5hcHBseURlbHRhcyh0LHtpZDpvWzBdLmlkLGNsczp7YWRkOltcIm5lby1mb2N1c1wiXX19KX1vbldoZWVsKGUpe2lmKE1hdGguYWJzKGUuZGVsdGFZKT5NYXRoLmFicyhlLmRlbHRhWCkpe2xldCBvLGEscixsPXRoaXMsZD1sLnZkb20uY25bMV0sYz0wO2lmKGUuZGVsdGFZPjAmJk1hdGgucm91bmQoZS5zY3JvbGxUb3AvKGUuY2xpZW50SGVpZ2h0LWwuaGVhZGVySGVpZ2h0KSo2KT4xMSl7Zm9yKG89bmV3IERhdGUoZC5jbltkLmNuLmxlbmd0aC0xXS5mbGFnKSxvLnNldERhdGUoby5nZXREYXRlKCktKG8uZ2V0RGF5KCktbC53ZWVrU3RhcnREYXkpKTtjPDY7YysrKWQuY25bMV0uY2xzLmluY2x1ZGVzKFwibmVvLW1vbnRoLWhlYWRlclwiKSYmZC5jbi5zcGxpY2UoMSwxKSxkLmNuLnNoaWZ0KCksby5zZXREYXRlKG8uZ2V0RGF0ZSgpKzcpLHI9bC5jcmVhdGVXZWVrKHQuY2xvbmUobykpLHIuaGVhZGVyJiZkLmNuLnB1c2goci5oZWFkZXIpLGQuY24ucHVzaChyLnJvdyk7bC51cGRhdGUoKX1lbHNlIGlmKGUuZGVsdGFZPDAmJk1hdGgucm91bmQoZS5zY3JvbGxUb3AvKGUuY2xpZW50SGVpZ2h0LWwuaGVhZGVySGVpZ2h0KSo2KTwxKXtmb3Iobz1kLmNuWzBdLmZsYWc/bmV3IERhdGUoZC5jblswXS5mbGFnKTpuZXcgRGF0ZShkLmNuWzFdLmZsYWcpLG8uc2V0RGF0ZShvLmdldERhdGUoKS0oby5nZXREYXkoKS1sLndlZWtTdGFydERheSkpO2M8NjtjKyspYT1kLmNuLmxlbmd0aCxkLmNuW2EtMl0uY2xzLmluY2x1ZGVzKFwibmVvLW1vbnRoLWhlYWRlclwiKSYmZC5jbi5zcGxpY2UoYS0yLDEpLGQuY24ucG9wKCksby5zZXREYXRlKG8uZ2V0RGF0ZSgpLTcpLHI9bC5jcmVhdGVXZWVrKHQuY2xvbmUobykpLGQuY24udW5zaGlmdChyLnJvdyksci5oZWFkZXImJmQuY24udW5zaGlmdChyLmhlYWRlcik7bC5wcm9taXNlVXBkYXRlKCkudGhlbigoKT0+e05lby5tYWluLkRvbUFjY2Vzcy5zY3JvbGxUbyh7ZGlyZWN0aW9uOlwidG9wXCIsaWQ6bC52ZG9tLmNuWzFdLmlkLHZhbHVlOmUuY2xpZW50SGVpZ2h0LWwuaGVhZGVySGVpZ2h0fSl9KX1sLmlzU2Nyb2xsaW5nfHwobC5pc1Njcm9sbGluZz0hMCxuLmFkZChsLnZkb20uY25bMV0uY2xzLFwibmVvLWlzLXNjcm9sbGluZ1wiKSxsLnZkb20uY25bMF0uY25bMF0uc3R5bGUub3BhY2l0eT0wLGwudXBkYXRlKCkpLGwuc2Nyb2xsVGFza0lkJiZjbGVhclRpbWVvdXQobC5zY3JvbGxUYXNrSWQpLGwuc2Nyb2xsVGFza0lkPXNldFRpbWVvdXQobC5vbldoZWVsRW5kLmJpbmQobCksMzAwKX19b25XaGVlbEVuZCgpe2xldCBlLHQsbz10aGlzLHt2ZG9tOmF9PW8scj1hLmNuWzBdLmNuWzBdLGw9Njtmb3Ioby5pc1Njcm9sbGluZz0hMTtsPDEyO2wrKylpZih0PWEuY25bMV0uY25bbF0uZmxhZyx0KXtlPW5ldyBEYXRlKHQpLGUuc2V0TW9udGgoZS5nZXRNb250aCgpKzEpLHIuY25bMF0uaHRtbD1vLmludGxGb3JtYXRfbW9udGguZm9ybWF0KGUpLHIuY25bMV0uaHRtbD1gICR7ZS5nZXRGdWxsWWVhcigpfWA7YnJlYWt9bi5yZW1vdmUoYS5jblsxXS5jbHMsXCJuZW8taXMtc2Nyb2xsaW5nXCIpLHIuc3R5bGUub3BhY2l0eT0xLG8udXBkYXRlKCl9dXBkYXRlSGVhZGVyKGU9ITEpe2xldCB0LG4sbz10aGlzLGE9by5jdXJyZW50RGF0ZSx7dmRvbTpyfT1vLGw9ci5jblswXS5jblswXSxkPTE7Zm9yKGwuY25bMF0uaHRtbD1vLmludGxGb3JtYXRfbW9udGguZm9ybWF0KGEpLGwuY25bMV0uaHRtbD1gICR7YS5nZXRGdWxsWWVhcigpfWAsYS5zZXREYXRlKG8uY3VycmVudERhdGUuZ2V0RGF0ZSgpLW8uY3VycmVudERhdGUuZ2V0RGF5KCkrby53ZWVrU3RhcnREYXkpO2Q8ODtkKyspdD1hLmdldERheSgpLGU/KG49e2NsczpbXCJuZW8tZGF5LW5hbWVcIl0saHRtbDpvLmludGxGb3JtYXRfZGF5LmZvcm1hdChhKX0sby5zaG93V2Vla2VuZHN8fDAhPT10JiY2IT09dHx8KG4ucmVtb3ZlRG9tPSEwKSxyLmNuWzBdLmNuLnB1c2gobikpOihuPXIuY25bMF0uY25bZF0sbiYmKG4uaHRtbD1vLmludGxGb3JtYXRfZGF5LmZvcm1hdChhKSxvLnNob3dXZWVrZW5kc3x8MCE9PXQmJjYhPT10P2RlbGV0ZSBuLnJlbW92ZURvbTpuLnJlbW92ZURvbT0hMCkpLGEuc2V0RGF0ZShhLmdldERhdGUoKSsxKTtvLnVwZGF0ZSgpfXVwZGF0ZU1vbnRoTmFtZXMoZT0hMSl7bGV0IHQ9dGhpcyxuPXQuY3VycmVudERhdGU7by5nZXRGbGFncyh0LnZkb20sXCJtb250aC1uYW1lXCIpLmZvckVhY2goZT0+e2UuaHRtbD10LmludGxGb3JtYXRfbW9udGguZm9ybWF0KG4pLG4uc2V0TW9udGgobi5nZXRNb250aCgpKzEpfSksdC51cGRhdGUoKX19ZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3Mocik7Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9