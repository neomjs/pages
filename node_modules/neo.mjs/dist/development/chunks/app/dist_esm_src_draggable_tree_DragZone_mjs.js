"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["dist_esm_src_draggable_tree_DragZone_mjs"],{

/***/ "./dist/esm/src/draggable/DragProxyComponent.mjs":
/*!*******************************************************!*\
  !*** ./dist/esm/src/draggable/DragProxyComponent.mjs ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../component/Base.mjs */ "./dist/esm/src/component/Base.mjs");
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(class extends _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]{static config={className:"Neo.draggable.DragProxyComponent",ntype:"dragproxy",autoMount:!0,autoRender:!0,baseCls:["neo-dragproxy"],moveInMainThread:!0};afterSetMounted(e,a){if(super.afterSetMounted(e,a),e&&this.moveInMainThread){let{appName:e,id:a,windowId:o}=this;Neo.main.addon.DragDrop.setDragProxyElement({appName:e,id:a,windowId:o})}}}));

/***/ }),

/***/ "./dist/esm/src/draggable/DragZone.mjs":
/*!*********************************************!*\
  !*** ./dist/esm/src/draggable/DragZone.mjs ***!
  \*********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/Base.mjs */ "./dist/esm/src/core/Base.mjs");
/* harmony import */ var _DragProxyComponent_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./DragProxyComponent.mjs */ "./dist/esm/src/draggable/DragProxyComponent.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/Array.mjs */ "./dist/esm/src/util/Array.mjs");
/* harmony import */ var _core_Observable_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../core/Observable.mjs */ "./dist/esm/src/core/Observable.mjs");
/* harmony import */ var _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/VDom.mjs */ "./dist/esm/src/util/VDom.mjs");
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(class extends _core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]{static observable=!0;static config={className:"Neo.draggable.DragZone",ntype:"dragzone",addDragProxyCls:!0,alwaysFireDragMove:!1,appName_:null,bodyCursorStyle:null,boundaryContainerId:null,boundaryContainerRect:null,data:null,dragElement:null,dragElementRect:null,dragProxy:null,dragProxyConfig_:null,dragProxyCls:"neo-dragproxy",dropZoneIdentifier:null,moveHorizontal:!0,moveInMainThread:!0,moveVertical:!0,offsetX:0,offsetY:0,owner:null,proxyParentId_:"document.body",scrollContainerId:null,scrollFactorLeft:1,scrollFactorTop:1,useProxyWrapper:!0,windowId_:null};construct(e){super.construct(e),Neo.main.addon.DragDrop||console.error("You can not use Neo.draggable.DragZone without adding Neo.main.addon.DragDrop to the main thread addons",this.id)}afterSetWindowId(e,r){e&&Neo.currentWorker.insertThemeFiles(e,this.__proto__)}beforeGetDragProxyConfig(e){return Neo.clone(e,!0,!0)}async createDragProxy(e,t=!0){let n=this,l=Neo.getComponent(n.getDragElementRoot().id)||n.owner,d=n.dragElementRect,i=n.dragProxyConfig?.vdom,s=_util_VDom_mjs__WEBPACK_IMPORTED_MODULE_4__["default"].clone(i||n.dragElement),g={module:_DragProxyComponent_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],appName:n.appName,moveInMainThread:n.moveInMainThread,parentId:n.proxyParentId,windowId:n.windowId,...n.dragProxyConfig,vdom:n.useProxyWrapper?{cn:[s]}:s};return g.cls=g.cls||[],l&&g.cls.push(l.getTheme()),s.cls&&!n.useProxyWrapper&&g.cls.push(...s.cls),n.addDragProxyCls&&g.cls&&_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].add(g.cls,n.dragProxyCls),g.style=g.style||{},Object.assign(g.style,{height:`${e.height}px`,left:`${n.moveHorizontal?e.x:d.x}px`,top:`${n.moveVertical?e.y:d.y}px`,width:`${e.width}px`}),t?n.dragProxy=Neo.create(g):g}destroyDragProxy(){let e=this,r=e.dragProxy.id;e.timeout(e.moveInMainThread?0:30).then(()=>{Neo.currentWorker.promiseMessage("main",{action:"updateDom",appName:e.appName,deltas:[{action:"removeNode",id:r}]})}),e.dragProxy.destroy()}dragEnd(e){let r=this,{owner:t}=r,{cls:a}=t;_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].remove(a,"neo-is-dragging"),t.cls=a,r.dragProxy&&(r.destroyDragProxy(),r.dragProxy=null),Object.assign(r,{dragElementRect:null,offsetX:0,offsetY:0,scrollContainerId:null}),r.fire("dragEnd",e),r.resetData()}dragMove(e){let r,o=this;!o.moveInMainThread&&o.dragProxy&&(r=o.dragProxy.style,o.moveHorizontal&&(r.left=e.clientX-o.offsetX+"px"),o.moveVertical&&(r.top=e.clientY-o.offsetY+"px"),o.dragProxy.style=r),o.fire("dragMove",e)}async dragStart(e){let r,t,a,n=this,{appName:l,owner:d,windowId:i}=n,{cls:s}=d,g=n.getDragElementRect(e);n.setData(),r=await Neo.main.addon.DragDrop.setConfigs({appName:l,windowId:i,...n.getMainThreadConfigs()}),n.boundaryContainerRect=r.boundaryContainerRect,_util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].add(s,"neo-is-dragging"),d.cls=s,t=e.clientX-g.left,a=e.clientY-g.top,Object.assign(n,{dragElementRect:g,offsetX:t,offsetY:a}),await n.createDragProxy(g),n.fire("dragStart",{clientX:e.clientX,clientY:e.clientY,dragElementRect:g,eventData:e,id:n.id,offsetX:t,offsetY:a})}getDragElementRect(e){let r=this.getDragElementRoot().id;for(let o of e.path)if(o.id===r)return o.rect;for(let o of e.targetPath)if(o.id===r)return o.rect;return null}getDragElementRoot(){return this.dragElement}getMainThreadConfigs(){let e=this;return{alwaysFireDragMove:e.alwaysFireDragMove,bodyCursorStyle:e.bodyCursorStyle,boundaryContainerId:e.boundaryContainerId,dragElementRootId:e.getDragElementRoot().id,dragProxyCls:e.dragProxyCls,dragZoneId:e.id,dropZoneIdentifier:e.dropZoneIdentifier,moveHorizontal:e.moveHorizontal,moveVertical:e.moveVertical,scrollContainerId:e.scrollContainerId,scrollFactorLeft:e.scrollFactorLeft,scrollFactorTop:e.scrollFactorTop}}onDrop(e){this.fire("drop",e)}onDropEnter(e){this.fire("drop:enter",e)}onDropLeave(e){this.fire("drop:leave",e)}resetData(){this.timeout(50).then(()=>{this.data=null})}setData(e={}){let r=this;r.data={dragElement:r.getDragElementRoot(),dragZoneId:r.id,...e}}}));

/***/ }),

/***/ "./dist/esm/src/draggable/list/DragZone.mjs":
/*!**************************************************!*\
  !*** ./dist/esm/src/draggable/list/DragZone.mjs ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _draggable_DragZone_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../draggable/DragZone.mjs */ "./dist/esm/src/draggable/DragZone.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/Array.mjs */ "./dist/esm/src/util/Array.mjs");
/* harmony import */ var _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/VDom.mjs */ "./dist/esm/src/util/VDom.mjs");
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(class extends _draggable_DragZone_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]{static config={className:"Neo.draggable.list.DragZone",ntype:"list-dragzone",dragProxyConfig:{cls:["neo-list"]}};construct(t){super.construct(t);let e=this,{owner:o}=e,r={delegate:".neo-draggable",scope:e},{store:a}=o;o.addDomListeners([{"drag:end":e.onDragEnd,...r},{"drag:start":e.onDragStart,...r}]),a.on({load:e.onStoreLoad,scope:e}),a.getCount()>0&&e.onStoreLoad()}adjustListItemCls(t){let o,r=this,{owner:a}=r,{store:s}=a;s.items.forEach((a,s)=>{o=r.getItemVdom(a,s),o&&(o.cls=o.cls||[],_util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"][t?"add":"remove"](o.cls,"neo-draggable"))}),a.update()}getItemVdom(t,e){return this.owner.vdom.cn[e]}onDragEnd(t){if(this.owner.draggable){let t=this,o=t.dragProxy,r=o.cls||{},a=t.dragElementRect,s=o.wrapperStyle||{};_util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].add(r,"neo-animate"),o.cls=r,t.timeout(30).then(()=>{s.left=`${a.left}px`,s.top=`${a.top}px`,o.wrapperStyle=s,t.timeout(300).then(()=>{t.dragEnd()})})}}async onDragStart(t){let e=this;e.owner.draggable&&(e.dragElement=_util_VDom_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].find(e.owner.vdom,t.path[0].id).vdom,await e.dragStart(t))}onStoreLoad(){this.adjustListItemCls(!0)}setData(t={}){let{owner:e}=this,o=e.getItemRecordId(this.getDragElementRoot().id);t.record=e.store.get(o),super.setData(t)}}));

/***/ }),

/***/ "./dist/esm/src/draggable/tree/DragZone.mjs":
/*!**************************************************!*\
  !*** ./dist/esm/src/draggable/tree/DragZone.mjs ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _draggable_list_DragZone_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../draggable/list/DragZone.mjs */ "./dist/esm/src/draggable/list/DragZone.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/Array.mjs */ "./dist/esm/src/util/Array.mjs");
/* harmony import */ var _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/VDom.mjs */ "./dist/esm/src/util/VDom.mjs");
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(class extends _draggable_list_DragZone_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]{static config={className:"Neo.draggable.tree.DragZone",ntype:"tree-dragzone",dragProxyConfig:{cls:["neo-tree-list"]},leafNodesOnly_:!1};afterSetLeafNodesOnly(e,o){if(void 0!==o){let o,{owner:a}=this,{store:r}=a;r.items.forEach(r=>{r.isLeaf||(o=a.getVdomChild(a.getItemId(r.id),a.vdom),o.cls=o.cls||[],_util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"][e?"remove":"add"](o.cls,"neo-draggable"))}),a.update()}}getDragElementRoot(){return this.dragElement.cn[0]}getItemVdom(e,t){let{owner:o}=this;return!this.leafNodesOnly||e.isLeaf?o.getVdomChild(o.getItemId(e.id),o.vdom):null}async onDragStart(e){let t=this;t.owner.draggable&&(t.dragElement={tag:"ul",cls:["neo-list-container","neo-list"],cn:[_util_VDom_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].find(t.owner.vdom,e.path[0].id).vdom]},await t.dragStart(e))}}));

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC9kaXN0X2VzbV9zcmNfZHJhZ2dhYmxlX3RyZWVfRHJhZ1pvbmVfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXFDLGlFQUFlLDZCQUE2QiwyREFBQyxDQUFDLGVBQWUseUlBQXlJLHFCQUFxQix3REFBd0QsSUFBSSwwQkFBMEIsTUFBTSw2Q0FBNkMsMEJBQTBCLElBQUksQ0FBQyxFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDQXpQLGlFQUFlLDZCQUE2QixzREFBQyxDQUFDLHFCQUFxQixlQUFlLGloQkFBaWhCLGFBQWEsNktBQTZLLHNCQUFzQix3REFBd0QsNEJBQTRCLDBCQUEwQiw4QkFBOEIsa0hBQWtILHNEQUFDLDRCQUE0QixPQUFPLCtEQUFDLGlKQUFpSixPQUFPLElBQUksNkhBQTZILHVEQUFDLDhDQUE4Qyx3QkFBd0IsVUFBVSxTQUFTLFlBQVkseUJBQXlCLFdBQVcsdUJBQXVCLGFBQWEsUUFBUSxJQUFJLGdDQUFnQyxtQkFBbUIsNEJBQTRCLDZDQUE2Qyx5Q0FBeUMsOENBQThDLHlCQUF5QixFQUFFLEVBQUUsd0JBQXdCLFdBQVcsWUFBWSxRQUFRLElBQUksTUFBTSxHQUFHLHVEQUFDLDJHQUEyRyxnRUFBZ0Usb0NBQW9DLFlBQVksYUFBYSxzTUFBc00sbUJBQW1CLGtCQUFrQiw2QkFBNkIsSUFBSSxNQUFNLDZCQUE2Qix3REFBd0QsaURBQWlELGtEQUFrRCx1REFBQyx3RkFBd0Ysc0NBQXNDLGlEQUFpRCw4RkFBOEYsRUFBRSxzQkFBc0IsbUNBQW1DLDhDQUE4QyxvREFBb0QsWUFBWSxxQkFBcUIsd0JBQXdCLHVCQUF1QixXQUFXLE9BQU8sNlpBQTZaLFVBQVUsb0JBQW9CLGVBQWUsMEJBQTBCLGVBQWUsMEJBQTBCLFlBQVksMkJBQTJCLGVBQWUsRUFBRSxZQUFZLEVBQUUsV0FBVyxRQUFRLDBEQUEwRCxDQUFDLEU7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDQTF2SCxpRUFBZSw2QkFBNkIsK0RBQUMsQ0FBQyxlQUFlLCtFQUErRSxtQkFBbUIsYUFBYSxtQkFBbUIsWUFBWSxRQUFRLE1BQU0sa0NBQWtDLEVBQUUsUUFBUSxHQUFHLG9CQUFvQiw0QkFBNEIsRUFBRSxnQ0FBZ0MsU0FBUywyQkFBMkIsa0NBQWtDLHFCQUFxQixjQUFjLFFBQVEsSUFBSSxRQUFRLEdBQUcsd0JBQXdCLHlDQUF5Qyx1REFBQywyQ0FBMkMsYUFBYSxpQkFBaUIsNkJBQTZCLGFBQWEseUJBQXlCLG9DQUFvQywwQ0FBMEMsdURBQUMsc0RBQXNELFVBQVUsT0FBTyxhQUFhLE1BQU0sOENBQThDLFlBQVksRUFBRSxHQUFHLHFCQUFxQixXQUFXLGtDQUFrQyxzREFBQyw0REFBNEQsY0FBYywyQkFBMkIsWUFBWSxFQUFFLElBQUksUUFBUSx3REFBd0QsMENBQTBDLENBQUMsRTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNBaHJDLGlFQUFlLDZCQUE2QixvRUFBQyxDQUFDLGVBQWUsK0VBQStFLHNCQUFzQixvQkFBb0IsMkJBQTJCLGVBQWUsT0FBTyxRQUFRLE9BQU8sUUFBUSxHQUFHLG9CQUFvQixzRUFBc0UsdURBQUMsMkNBQTJDLGNBQWMscUJBQXFCLDhCQUE4QixpQkFBaUIsSUFBSSxRQUFRLE1BQU0sa0ZBQWtGLHFCQUFxQixXQUFXLG1DQUFtQyxtREFBbUQsc0RBQUMsdUNBQXVDLHdCQUF3QixDQUFDLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW8ubWpzLy4vZGlzdC9lc20vc3JjL2RyYWdnYWJsZS9EcmFnUHJveHlDb21wb25lbnQubWpzIiwid2VicGFjazovL25lby5tanMvLi9kaXN0L2VzbS9zcmMvZHJhZ2dhYmxlL0RyYWdab25lLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vZGlzdC9lc20vc3JjL2RyYWdnYWJsZS9saXN0L0RyYWdab25lLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vZGlzdC9lc20vc3JjL2RyYWdnYWJsZS90cmVlL0RyYWdab25lLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZSBmcm9tXCIuLi9jb21wb25lbnQvQmFzZS5tanNcIjtleHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhjbGFzcyBleHRlbmRzIGV7c3RhdGljIGNvbmZpZz17Y2xhc3NOYW1lOlwiTmVvLmRyYWdnYWJsZS5EcmFnUHJveHlDb21wb25lbnRcIixudHlwZTpcImRyYWdwcm94eVwiLGF1dG9Nb3VudDohMCxhdXRvUmVuZGVyOiEwLGJhc2VDbHM6W1wibmVvLWRyYWdwcm94eVwiXSxtb3ZlSW5NYWluVGhyZWFkOiEwfTthZnRlclNldE1vdW50ZWQoZSxhKXtpZihzdXBlci5hZnRlclNldE1vdW50ZWQoZSxhKSxlJiZ0aGlzLm1vdmVJbk1haW5UaHJlYWQpe2xldHthcHBOYW1lOmUsaWQ6YSx3aW5kb3dJZDpvfT10aGlzO05lby5tYWluLmFkZG9uLkRyYWdEcm9wLnNldERyYWdQcm94eUVsZW1lbnQoe2FwcE5hbWU6ZSxpZDphLHdpbmRvd0lkOm99KX19fSk7IiwiaW1wb3J0IGUgZnJvbVwiLi4vY29yZS9CYXNlLm1qc1wiO2ltcG9ydCByIGZyb21cIi4vRHJhZ1Byb3h5Q29tcG9uZW50Lm1qc1wiO2ltcG9ydCBvIGZyb21cIi4uL3V0aWwvQXJyYXkubWpzXCI7aW1wb3J0IHQgZnJvbVwiLi4vY29yZS9PYnNlcnZhYmxlLm1qc1wiO2ltcG9ydCBhIGZyb21cIi4uL3V0aWwvVkRvbS5tanNcIjtleHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhjbGFzcyBleHRlbmRzIGV7c3RhdGljIG9ic2VydmFibGU9ITA7c3RhdGljIGNvbmZpZz17Y2xhc3NOYW1lOlwiTmVvLmRyYWdnYWJsZS5EcmFnWm9uZVwiLG50eXBlOlwiZHJhZ3pvbmVcIixhZGREcmFnUHJveHlDbHM6ITAsYWx3YXlzRmlyZURyYWdNb3ZlOiExLGFwcE5hbWVfOm51bGwsYm9keUN1cnNvclN0eWxlOm51bGwsYm91bmRhcnlDb250YWluZXJJZDpudWxsLGJvdW5kYXJ5Q29udGFpbmVyUmVjdDpudWxsLGRhdGE6bnVsbCxkcmFnRWxlbWVudDpudWxsLGRyYWdFbGVtZW50UmVjdDpudWxsLGRyYWdQcm94eTpudWxsLGRyYWdQcm94eUNvbmZpZ186bnVsbCxkcmFnUHJveHlDbHM6XCJuZW8tZHJhZ3Byb3h5XCIsZHJvcFpvbmVJZGVudGlmaWVyOm51bGwsbW92ZUhvcml6b250YWw6ITAsbW92ZUluTWFpblRocmVhZDohMCxtb3ZlVmVydGljYWw6ITAsb2Zmc2V0WDowLG9mZnNldFk6MCxvd25lcjpudWxsLHByb3h5UGFyZW50SWRfOlwiZG9jdW1lbnQuYm9keVwiLHNjcm9sbENvbnRhaW5lcklkOm51bGwsc2Nyb2xsRmFjdG9yTGVmdDoxLHNjcm9sbEZhY3RvclRvcDoxLHVzZVByb3h5V3JhcHBlcjohMCx3aW5kb3dJZF86bnVsbH07Y29uc3RydWN0KGUpe3N1cGVyLmNvbnN0cnVjdChlKSxOZW8ubWFpbi5hZGRvbi5EcmFnRHJvcHx8Y29uc29sZS5lcnJvcihcIllvdSBjYW4gbm90IHVzZSBOZW8uZHJhZ2dhYmxlLkRyYWdab25lIHdpdGhvdXQgYWRkaW5nIE5lby5tYWluLmFkZG9uLkRyYWdEcm9wIHRvIHRoZSBtYWluIHRocmVhZCBhZGRvbnNcIix0aGlzLmlkKX1hZnRlclNldFdpbmRvd0lkKGUscil7ZSYmTmVvLmN1cnJlbnRXb3JrZXIuaW5zZXJ0VGhlbWVGaWxlcyhlLHRoaXMuX19wcm90b19fKX1iZWZvcmVHZXREcmFnUHJveHlDb25maWcoZSl7cmV0dXJuIE5lby5jbG9uZShlLCEwLCEwKX1hc3luYyBjcmVhdGVEcmFnUHJveHkoZSx0PSEwKXtsZXQgbj10aGlzLGw9TmVvLmdldENvbXBvbmVudChuLmdldERyYWdFbGVtZW50Um9vdCgpLmlkKXx8bi5vd25lcixkPW4uZHJhZ0VsZW1lbnRSZWN0LGk9bi5kcmFnUHJveHlDb25maWc/LnZkb20scz1hLmNsb25lKGl8fG4uZHJhZ0VsZW1lbnQpLGc9e21vZHVsZTpyLGFwcE5hbWU6bi5hcHBOYW1lLG1vdmVJbk1haW5UaHJlYWQ6bi5tb3ZlSW5NYWluVGhyZWFkLHBhcmVudElkOm4ucHJveHlQYXJlbnRJZCx3aW5kb3dJZDpuLndpbmRvd0lkLC4uLm4uZHJhZ1Byb3h5Q29uZmlnLHZkb206bi51c2VQcm94eVdyYXBwZXI/e2NuOltzXX06c307cmV0dXJuIGcuY2xzPWcuY2xzfHxbXSxsJiZnLmNscy5wdXNoKGwuZ2V0VGhlbWUoKSkscy5jbHMmJiFuLnVzZVByb3h5V3JhcHBlciYmZy5jbHMucHVzaCguLi5zLmNscyksbi5hZGREcmFnUHJveHlDbHMmJmcuY2xzJiZvLmFkZChnLmNscyxuLmRyYWdQcm94eUNscyksZy5zdHlsZT1nLnN0eWxlfHx7fSxPYmplY3QuYXNzaWduKGcuc3R5bGUse2hlaWdodDpgJHtlLmhlaWdodH1weGAsbGVmdDpgJHtuLm1vdmVIb3Jpem9udGFsP2UueDpkLnh9cHhgLHRvcDpgJHtuLm1vdmVWZXJ0aWNhbD9lLnk6ZC55fXB4YCx3aWR0aDpgJHtlLndpZHRofXB4YH0pLHQ/bi5kcmFnUHJveHk9TmVvLmNyZWF0ZShnKTpnfWRlc3Ryb3lEcmFnUHJveHkoKXtsZXQgZT10aGlzLHI9ZS5kcmFnUHJveHkuaWQ7ZS50aW1lb3V0KGUubW92ZUluTWFpblRocmVhZD8wOjMwKS50aGVuKCgpPT57TmVvLmN1cnJlbnRXb3JrZXIucHJvbWlzZU1lc3NhZ2UoXCJtYWluXCIse2FjdGlvbjpcInVwZGF0ZURvbVwiLGFwcE5hbWU6ZS5hcHBOYW1lLGRlbHRhczpbe2FjdGlvbjpcInJlbW92ZU5vZGVcIixpZDpyfV19KX0pLGUuZHJhZ1Byb3h5LmRlc3Ryb3koKX1kcmFnRW5kKGUpe2xldCByPXRoaXMse293bmVyOnR9PXIse2NsczphfT10O28ucmVtb3ZlKGEsXCJuZW8taXMtZHJhZ2dpbmdcIiksdC5jbHM9YSxyLmRyYWdQcm94eSYmKHIuZGVzdHJveURyYWdQcm94eSgpLHIuZHJhZ1Byb3h5PW51bGwpLE9iamVjdC5hc3NpZ24ocix7ZHJhZ0VsZW1lbnRSZWN0Om51bGwsb2Zmc2V0WDowLG9mZnNldFk6MCxzY3JvbGxDb250YWluZXJJZDpudWxsfSksci5maXJlKFwiZHJhZ0VuZFwiLGUpLHIucmVzZXREYXRhKCl9ZHJhZ01vdmUoZSl7bGV0IHIsbz10aGlzOyFvLm1vdmVJbk1haW5UaHJlYWQmJm8uZHJhZ1Byb3h5JiYocj1vLmRyYWdQcm94eS5zdHlsZSxvLm1vdmVIb3Jpem9udGFsJiYoci5sZWZ0PWUuY2xpZW50WC1vLm9mZnNldFgrXCJweFwiKSxvLm1vdmVWZXJ0aWNhbCYmKHIudG9wPWUuY2xpZW50WS1vLm9mZnNldFkrXCJweFwiKSxvLmRyYWdQcm94eS5zdHlsZT1yKSxvLmZpcmUoXCJkcmFnTW92ZVwiLGUpfWFzeW5jIGRyYWdTdGFydChlKXtsZXQgcix0LGEsbj10aGlzLHthcHBOYW1lOmwsb3duZXI6ZCx3aW5kb3dJZDppfT1uLHtjbHM6c309ZCxnPW4uZ2V0RHJhZ0VsZW1lbnRSZWN0KGUpO24uc2V0RGF0YSgpLHI9YXdhaXQgTmVvLm1haW4uYWRkb24uRHJhZ0Ryb3Auc2V0Q29uZmlncyh7YXBwTmFtZTpsLHdpbmRvd0lkOmksLi4ubi5nZXRNYWluVGhyZWFkQ29uZmlncygpfSksbi5ib3VuZGFyeUNvbnRhaW5lclJlY3Q9ci5ib3VuZGFyeUNvbnRhaW5lclJlY3Qsby5hZGQocyxcIm5lby1pcy1kcmFnZ2luZ1wiKSxkLmNscz1zLHQ9ZS5jbGllbnRYLWcubGVmdCxhPWUuY2xpZW50WS1nLnRvcCxPYmplY3QuYXNzaWduKG4se2RyYWdFbGVtZW50UmVjdDpnLG9mZnNldFg6dCxvZmZzZXRZOmF9KSxhd2FpdCBuLmNyZWF0ZURyYWdQcm94eShnKSxuLmZpcmUoXCJkcmFnU3RhcnRcIix7Y2xpZW50WDplLmNsaWVudFgsY2xpZW50WTplLmNsaWVudFksZHJhZ0VsZW1lbnRSZWN0OmcsZXZlbnREYXRhOmUsaWQ6bi5pZCxvZmZzZXRYOnQsb2Zmc2V0WTphfSl9Z2V0RHJhZ0VsZW1lbnRSZWN0KGUpe2xldCByPXRoaXMuZ2V0RHJhZ0VsZW1lbnRSb290KCkuaWQ7Zm9yKGxldCBvIG9mIGUucGF0aClpZihvLmlkPT09cilyZXR1cm4gby5yZWN0O2ZvcihsZXQgbyBvZiBlLnRhcmdldFBhdGgpaWYoby5pZD09PXIpcmV0dXJuIG8ucmVjdDtyZXR1cm4gbnVsbH1nZXREcmFnRWxlbWVudFJvb3QoKXtyZXR1cm4gdGhpcy5kcmFnRWxlbWVudH1nZXRNYWluVGhyZWFkQ29uZmlncygpe2xldCBlPXRoaXM7cmV0dXJue2Fsd2F5c0ZpcmVEcmFnTW92ZTplLmFsd2F5c0ZpcmVEcmFnTW92ZSxib2R5Q3Vyc29yU3R5bGU6ZS5ib2R5Q3Vyc29yU3R5bGUsYm91bmRhcnlDb250YWluZXJJZDplLmJvdW5kYXJ5Q29udGFpbmVySWQsZHJhZ0VsZW1lbnRSb290SWQ6ZS5nZXREcmFnRWxlbWVudFJvb3QoKS5pZCxkcmFnUHJveHlDbHM6ZS5kcmFnUHJveHlDbHMsZHJhZ1pvbmVJZDplLmlkLGRyb3Bab25lSWRlbnRpZmllcjplLmRyb3Bab25lSWRlbnRpZmllcixtb3ZlSG9yaXpvbnRhbDplLm1vdmVIb3Jpem9udGFsLG1vdmVWZXJ0aWNhbDplLm1vdmVWZXJ0aWNhbCxzY3JvbGxDb250YWluZXJJZDplLnNjcm9sbENvbnRhaW5lcklkLHNjcm9sbEZhY3RvckxlZnQ6ZS5zY3JvbGxGYWN0b3JMZWZ0LHNjcm9sbEZhY3RvclRvcDplLnNjcm9sbEZhY3RvclRvcH19b25Ecm9wKGUpe3RoaXMuZmlyZShcImRyb3BcIixlKX1vbkRyb3BFbnRlcihlKXt0aGlzLmZpcmUoXCJkcm9wOmVudGVyXCIsZSl9b25Ecm9wTGVhdmUoZSl7dGhpcy5maXJlKFwiZHJvcDpsZWF2ZVwiLGUpfXJlc2V0RGF0YSgpe3RoaXMudGltZW91dCg1MCkudGhlbigoKT0+e3RoaXMuZGF0YT1udWxsfSl9c2V0RGF0YShlPXt9KXtsZXQgcj10aGlzO3IuZGF0YT17ZHJhZ0VsZW1lbnQ6ci5nZXREcmFnRWxlbWVudFJvb3QoKSxkcmFnWm9uZUlkOnIuaWQsLi4uZX19fSk7IiwiaW1wb3J0IHQgZnJvbVwiLi4vLi4vZHJhZ2dhYmxlL0RyYWdab25lLm1qc1wiO2ltcG9ydCBlIGZyb21cIi4uLy4uL3V0aWwvQXJyYXkubWpzXCI7aW1wb3J0IG8gZnJvbVwiLi4vLi4vdXRpbC9WRG9tLm1qc1wiO2V4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKGNsYXNzIGV4dGVuZHMgdHtzdGF0aWMgY29uZmlnPXtjbGFzc05hbWU6XCJOZW8uZHJhZ2dhYmxlLmxpc3QuRHJhZ1pvbmVcIixudHlwZTpcImxpc3QtZHJhZ3pvbmVcIixkcmFnUHJveHlDb25maWc6e2NsczpbXCJuZW8tbGlzdFwiXX19O2NvbnN0cnVjdCh0KXtzdXBlci5jb25zdHJ1Y3QodCk7bGV0IGU9dGhpcyx7b3duZXI6b309ZSxyPXtkZWxlZ2F0ZTpcIi5uZW8tZHJhZ2dhYmxlXCIsc2NvcGU6ZX0se3N0b3JlOmF9PW87by5hZGREb21MaXN0ZW5lcnMoW3tcImRyYWc6ZW5kXCI6ZS5vbkRyYWdFbmQsLi4ucn0se1wiZHJhZzpzdGFydFwiOmUub25EcmFnU3RhcnQsLi4ucn1dKSxhLm9uKHtsb2FkOmUub25TdG9yZUxvYWQsc2NvcGU6ZX0pLGEuZ2V0Q291bnQoKT4wJiZlLm9uU3RvcmVMb2FkKCl9YWRqdXN0TGlzdEl0ZW1DbHModCl7bGV0IG8scj10aGlzLHtvd25lcjphfT1yLHtzdG9yZTpzfT1hO3MuaXRlbXMuZm9yRWFjaCgoYSxzKT0+e289ci5nZXRJdGVtVmRvbShhLHMpLG8mJihvLmNscz1vLmNsc3x8W10sZVt0P1wiYWRkXCI6XCJyZW1vdmVcIl0oby5jbHMsXCJuZW8tZHJhZ2dhYmxlXCIpKX0pLGEudXBkYXRlKCl9Z2V0SXRlbVZkb20odCxlKXtyZXR1cm4gdGhpcy5vd25lci52ZG9tLmNuW2VdfW9uRHJhZ0VuZCh0KXtpZih0aGlzLm93bmVyLmRyYWdnYWJsZSl7bGV0IHQ9dGhpcyxvPXQuZHJhZ1Byb3h5LHI9by5jbHN8fHt9LGE9dC5kcmFnRWxlbWVudFJlY3Qscz1vLndyYXBwZXJTdHlsZXx8e307ZS5hZGQocixcIm5lby1hbmltYXRlXCIpLG8uY2xzPXIsdC50aW1lb3V0KDMwKS50aGVuKCgpPT57cy5sZWZ0PWAke2EubGVmdH1weGAscy50b3A9YCR7YS50b3B9cHhgLG8ud3JhcHBlclN0eWxlPXMsdC50aW1lb3V0KDMwMCkudGhlbigoKT0+e3QuZHJhZ0VuZCgpfSl9KX19YXN5bmMgb25EcmFnU3RhcnQodCl7bGV0IGU9dGhpcztlLm93bmVyLmRyYWdnYWJsZSYmKGUuZHJhZ0VsZW1lbnQ9by5maW5kKGUub3duZXIudmRvbSx0LnBhdGhbMF0uaWQpLnZkb20sYXdhaXQgZS5kcmFnU3RhcnQodCkpfW9uU3RvcmVMb2FkKCl7dGhpcy5hZGp1c3RMaXN0SXRlbUNscyghMCl9c2V0RGF0YSh0PXt9KXtsZXR7b3duZXI6ZX09dGhpcyxvPWUuZ2V0SXRlbVJlY29yZElkKHRoaXMuZ2V0RHJhZ0VsZW1lbnRSb290KCkuaWQpO3QucmVjb3JkPWUuc3RvcmUuZ2V0KG8pLHN1cGVyLnNldERhdGEodCl9fSk7IiwiaW1wb3J0IGUgZnJvbVwiLi4vLi4vZHJhZ2dhYmxlL2xpc3QvRHJhZ1pvbmUubWpzXCI7aW1wb3J0IHQgZnJvbVwiLi4vLi4vdXRpbC9BcnJheS5tanNcIjtpbXBvcnQgbyBmcm9tXCIuLi8uLi91dGlsL1ZEb20ubWpzXCI7ZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoY2xhc3MgZXh0ZW5kcyBle3N0YXRpYyBjb25maWc9e2NsYXNzTmFtZTpcIk5lby5kcmFnZ2FibGUudHJlZS5EcmFnWm9uZVwiLG50eXBlOlwidHJlZS1kcmFnem9uZVwiLGRyYWdQcm94eUNvbmZpZzp7Y2xzOltcIm5lby10cmVlLWxpc3RcIl19LGxlYWZOb2Rlc09ubHlfOiExfTthZnRlclNldExlYWZOb2Rlc09ubHkoZSxvKXtpZih2b2lkIDAhPT1vKXtsZXQgbyx7b3duZXI6YX09dGhpcyx7c3RvcmU6cn09YTtyLml0ZW1zLmZvckVhY2gocj0+e3IuaXNMZWFmfHwobz1hLmdldFZkb21DaGlsZChhLmdldEl0ZW1JZChyLmlkKSxhLnZkb20pLG8uY2xzPW8uY2xzfHxbXSx0W2U/XCJyZW1vdmVcIjpcImFkZFwiXShvLmNscyxcIm5lby1kcmFnZ2FibGVcIikpfSksYS51cGRhdGUoKX19Z2V0RHJhZ0VsZW1lbnRSb290KCl7cmV0dXJuIHRoaXMuZHJhZ0VsZW1lbnQuY25bMF19Z2V0SXRlbVZkb20oZSx0KXtsZXR7b3duZXI6b309dGhpcztyZXR1cm4hdGhpcy5sZWFmTm9kZXNPbmx5fHxlLmlzTGVhZj9vLmdldFZkb21DaGlsZChvLmdldEl0ZW1JZChlLmlkKSxvLnZkb20pOm51bGx9YXN5bmMgb25EcmFnU3RhcnQoZSl7bGV0IHQ9dGhpczt0Lm93bmVyLmRyYWdnYWJsZSYmKHQuZHJhZ0VsZW1lbnQ9e3RhZzpcInVsXCIsY2xzOltcIm5lby1saXN0LWNvbnRhaW5lclwiLFwibmVvLWxpc3RcIl0sY246W28uZmluZCh0Lm93bmVyLnZkb20sZS5wYXRoWzBdLmlkKS52ZG9tXX0sYXdhaXQgdC5kcmFnU3RhcnQoZSkpfX0pOyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==