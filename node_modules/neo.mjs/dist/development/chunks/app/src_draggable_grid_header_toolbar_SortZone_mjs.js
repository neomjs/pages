"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["src_draggable_grid_header_toolbar_SortZone_mjs"],{

/***/ "./src/draggable/grid/header/toolbar/SortZone.mjs":
/*!********************************************************!*\
  !*** ./src/draggable/grid/header/toolbar/SortZone.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _toolbar_SortZone_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../toolbar/SortZone.mjs */ "./src/draggable/toolbar/SortZone.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/VDom.mjs */ "./src/util/VDom.mjs");




/**
 * @class Neo.draggable.grid.header.toolbar.SortZone
 * @extends Neo.draggable.toolbar.SortZone
 */
class SortZone extends _toolbar_SortZone_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.draggable.grid.header.toolbar.SortZone'
         * @protected
         */
        className: 'Neo.draggable.grid.header.toolbar.SortZone',
        /**
         * @member {String} ntype='grid-header-toolbar-sortzone'
         * @protected
         */
        ntype: 'grid-header-toolbar-sortzone',
        /**
         * @member {String|null} itemMargin='1px'
         * @protected
         */
        itemMargin: '1px',
        /**
         * @member {Boolean} moveColumnContent=true
         */
        moveColumnContent: true,
        /**
         * @member {Boolean} moveVertical=false
         */
        moveVertical: false
    }

    /**
     * @param {Neo.util.Rectangle} rect
     * @param {Neo.util.Rectangle} parentRect
     */
    adjustProxyRectToParent(rect, parentRect) {
        rect.x = rect.x - parentRect.x - 1;
        rect.y = rect.y - parentRect.y - 1
    }

    /**
     * @param {Object}  data
     * @param {Boolean} createComponent=true
     * @returns {Object|Neo.draggable.DragProxyComponent}
     */
    async createDragProxy(data, createComponent=true) {
        if (!this.moveColumnContent) {
            return await super.createDragProxy(data, createComponent)
        }

        let me            = this,
            grid          = me.owner.parent,
            {body}        = grid,
            bodyWrapperId = Neo.getId('grid-body-wrapper'),
            gridRows      = body.getVdomRoot().cn,
            columnIndex   = me.dragElement['aria-colindex'] - 1,
            {dataField}   = body.columnPositions.getAt(columnIndex),
            cells         = body.getColumnCells(dataField),
            rows          = [],
            config        = await super.createDragProxy(data, false),
            rect          = await grid.getDomRect(),
            row;

        config.cls = ['neo-grid-wrapper', me.owner.getTheme()];

        config.style.height = `${rect.height - 2}px`; // minus border-bottom & border-top

        cells.forEach((cell, index) => {
            row = _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].clone({ // clone to remove ids
                cls  : gridRows[index].cls,
                cn   : [cell],
                style: gridRows[index].style
            });

            delete row.cn[0].style.left;

            rows.push(row)
        });

        config.vdom =
        {cn: [
            {cls: ['neo-grid-container'], cn: [
                {...config.vdom, cls: ['neo-grid-header-toolbar', 'neo-toolbar']},
                {cls: ['neo-grid-body-wrapper'], id: bodyWrapperId, cn: [
                    {cls: ['neo-grid-body'], cn: rows},
                    {cls: ['neo-grid-scrollbar'], style: {height: body.vdom.cn[0].height}}
                ]}
            ]}
        ]};

        config.listeners = {
            mounted() {
                Neo.main.DomAccess.scrollTo({
                    id      : bodyWrapperId,
                    value   : body.scrollTop,
                    windowId: this.windowId
                })
            }
        };

        if (createComponent) {
            return me.dragProxy = Neo.create(config)
        }

        return config
    }

    /**
     * @param {Number} fromIndex
     * @param {Number} toIndex
     */
    moveTo(fromIndex, toIndex) {
        super.moveTo(fromIndex, toIndex);
        this.owner.parent.columns.move(fromIndex, toIndex)
    }

    /**
     * @param {Object} data
     */
    async onDragEnd(data) {
        await super.onDragEnd(data);

        let {owner} = this;

        owner.items.forEach((item, index) => {
            item.vdom['aria-colindex'] = index + 1; // 1 based
        });

        owner.updateDepth = 2;
        owner.update();

        await owner.passSizeToBody();

        await this.timeout(20);

        owner.parent.body.createViewData()
    }

    /**
     * @param {Object} data
     */
    async onDragStart(data) {
        await super.onDragStart(data);

        if (this.moveColumnContent) {
            let me             = this,
                {body}         = me.owner.parent,
                columnIndex    = me.dragElement['aria-colindex'] - 1,
                columnPosition = body.columnPositions.getAt(columnIndex),
                {dataField}    = columnPosition,
                cells          = body.getColumnCells(dataField);

            columnPosition.hidden = true;

            cells.forEach(cell => {
                cell.style.visibility = 'hidden'
            });

            body.update()
        }
    }

    /**
     * @param {Number} index1
     * @param {Number} index2
     */
    switchItems(index1, index2) {
        super.switchItems(index1, index2);

        if (this.moveColumnContent) {
            let me                = this,
                {itemRects}       = me,
                {body}            = me.owner.parent,
                {columnPositions} = body,
                column1Position   = columnPositions.getAt(index1),
                column2Position   = columnPositions.getAt(index2),
                column1Cells      = body.getColumnCells(column1Position.dataField),
                column2Cells      = body.getColumnCells(column2Position.dataField);

            Object.assign(column1Position, {
                width: itemRects[index2].width,
                x    : itemRects[index2].x + 1
            });

            Object.assign(column2Position, {
                width: itemRects[index1].width,
                x    : itemRects[index1].x + 1
            });

            columnPositions.move(index1, index2);

            column1Cells.forEach(node => {
                node.style.left  = column1Position.x     + 'px';
                node.style.width = column1Position.width + 'px'
            });

            column2Cells.forEach(node => {
                node.style.left  = column2Position.x     + 'px';
                node.style.width = column2Position.width + 'px'
            });

            body.update()
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(SortZone));


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC9zcmNfZHJhZ2dhYmxlX2dyaWRfaGVhZGVyX3Rvb2xiYXJfU29ydFpvbmVfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBeUQ7QUFDRjtBQUNEOztBQUV0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qiw2REFBWTtBQUNuQztBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxvQkFBb0I7QUFDbkMsZUFBZSxvQkFBb0I7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsU0FBUztBQUN4QixlQUFlLFNBQVM7QUFDeEIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWEsYUFBYTtBQUMxQjtBQUNBO0FBQ0E7QUFDQSxhQUFhLGFBQWE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxpQ0FBaUMsZ0JBQWdCLEtBQUs7O0FBRXREO0FBQ0Esa0JBQWtCLHNEQUFRLFNBQVM7QUFDbkM7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQSxTQUFTO0FBQ1QsYUFBYTtBQUNiLGlCQUFpQixnRUFBZ0U7QUFDakYsaUJBQWlCO0FBQ2pCLHFCQUFxQixpQ0FBaUM7QUFDdEQscUJBQXFCLHFDQUFxQztBQUMxRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBOztBQUVBLGFBQWEsT0FBTzs7QUFFcEI7QUFDQSxvREFBb0Q7QUFDcEQsU0FBUzs7QUFFVDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUIsY0FBYztBQUMvQjtBQUNBO0FBQ0EsaUJBQWlCLGNBQWM7QUFDL0I7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQixpQkFBaUI7QUFDbEMsaUJBQWlCLGlCQUFpQjtBQUNsQyxpQkFBaUIsaUJBQWlCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUVBQWUsd0JBQXdCLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL2RyYWdnYWJsZS9ncmlkL2hlYWRlci90b29sYmFyL1NvcnRab25lLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmFzZVNvcnRab25lIGZyb20gJy4uLy4uLy4uL3Rvb2xiYXIvU29ydFpvbmUubWpzJztcbmltcG9ydCBOZW9BcnJheSAgICAgZnJvbSAgJy4uLy4uLy4uLy4uL3V0aWwvQXJyYXkubWpzJztcbmltcG9ydCBWZG9tVXRpbCAgICAgZnJvbSAgJy4uLy4uLy4uLy4uL3V0aWwvVkRvbS5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8uZHJhZ2dhYmxlLmdyaWQuaGVhZGVyLnRvb2xiYXIuU29ydFpvbmVcbiAqIEBleHRlbmRzIE5lby5kcmFnZ2FibGUudG9vbGJhci5Tb3J0Wm9uZVxuICovXG5jbGFzcyBTb3J0Wm9uZSBleHRlbmRzIEJhc2VTb3J0Wm9uZSB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8uZHJhZ2dhYmxlLmdyaWQuaGVhZGVyLnRvb2xiYXIuU29ydFpvbmUnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5kcmFnZ2FibGUuZ3JpZC5oZWFkZXIudG9vbGJhci5Tb3J0Wm9uZScsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSdncmlkLWhlYWRlci10b29sYmFyLXNvcnR6b25lJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ2dyaWQtaGVhZGVyLXRvb2xiYXItc29ydHpvbmUnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IGl0ZW1NYXJnaW49JzFweCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgaXRlbU1hcmdpbjogJzFweCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBtb3ZlQ29sdW1uQ29udGVudD10cnVlXG4gICAgICAgICAqL1xuICAgICAgICBtb3ZlQ29sdW1uQ29udGVudDogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IG1vdmVWZXJ0aWNhbD1mYWxzZVxuICAgICAgICAgKi9cbiAgICAgICAgbW92ZVZlcnRpY2FsOiBmYWxzZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7TmVvLnV0aWwuUmVjdGFuZ2xlfSByZWN0XG4gICAgICogQHBhcmFtIHtOZW8udXRpbC5SZWN0YW5nbGV9IHBhcmVudFJlY3RcbiAgICAgKi9cbiAgICBhZGp1c3RQcm94eVJlY3RUb1BhcmVudChyZWN0LCBwYXJlbnRSZWN0KSB7XG4gICAgICAgIHJlY3QueCA9IHJlY3QueCAtIHBhcmVudFJlY3QueCAtIDE7XG4gICAgICAgIHJlY3QueSA9IHJlY3QueSAtIHBhcmVudFJlY3QueSAtIDFcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gIGRhdGFcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNyZWF0ZUNvbXBvbmVudD10cnVlXG4gICAgICogQHJldHVybnMge09iamVjdHxOZW8uZHJhZ2dhYmxlLkRyYWdQcm94eUNvbXBvbmVudH1cbiAgICAgKi9cbiAgICBhc3luYyBjcmVhdGVEcmFnUHJveHkoZGF0YSwgY3JlYXRlQ29tcG9uZW50PXRydWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1vdmVDb2x1bW5Db250ZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgc3VwZXIuY3JlYXRlRHJhZ1Byb3h5KGRhdGEsIGNyZWF0ZUNvbXBvbmVudClcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBtZSAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGdyaWQgICAgICAgICAgPSBtZS5vd25lci5wYXJlbnQsXG4gICAgICAgICAgICB7Ym9keX0gICAgICAgID0gZ3JpZCxcbiAgICAgICAgICAgIGJvZHlXcmFwcGVySWQgPSBOZW8uZ2V0SWQoJ2dyaWQtYm9keS13cmFwcGVyJyksXG4gICAgICAgICAgICBncmlkUm93cyAgICAgID0gYm9keS5nZXRWZG9tUm9vdCgpLmNuLFxuICAgICAgICAgICAgY29sdW1uSW5kZXggICA9IG1lLmRyYWdFbGVtZW50WydhcmlhLWNvbGluZGV4J10gLSAxLFxuICAgICAgICAgICAge2RhdGFGaWVsZH0gICA9IGJvZHkuY29sdW1uUG9zaXRpb25zLmdldEF0KGNvbHVtbkluZGV4KSxcbiAgICAgICAgICAgIGNlbGxzICAgICAgICAgPSBib2R5LmdldENvbHVtbkNlbGxzKGRhdGFGaWVsZCksXG4gICAgICAgICAgICByb3dzICAgICAgICAgID0gW10sXG4gICAgICAgICAgICBjb25maWcgICAgICAgID0gYXdhaXQgc3VwZXIuY3JlYXRlRHJhZ1Byb3h5KGRhdGEsIGZhbHNlKSxcbiAgICAgICAgICAgIHJlY3QgICAgICAgICAgPSBhd2FpdCBncmlkLmdldERvbVJlY3QoKSxcbiAgICAgICAgICAgIHJvdztcblxuICAgICAgICBjb25maWcuY2xzID0gWyduZW8tZ3JpZC13cmFwcGVyJywgbWUub3duZXIuZ2V0VGhlbWUoKV07XG5cbiAgICAgICAgY29uZmlnLnN0eWxlLmhlaWdodCA9IGAke3JlY3QuaGVpZ2h0IC0gMn1weGA7IC8vIG1pbnVzIGJvcmRlci1ib3R0b20gJiBib3JkZXItdG9wXG5cbiAgICAgICAgY2VsbHMuZm9yRWFjaCgoY2VsbCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHJvdyA9IFZkb21VdGlsLmNsb25lKHsgLy8gY2xvbmUgdG8gcmVtb3ZlIGlkc1xuICAgICAgICAgICAgICAgIGNscyAgOiBncmlkUm93c1tpbmRleF0uY2xzLFxuICAgICAgICAgICAgICAgIGNuICAgOiBbY2VsbF0sXG4gICAgICAgICAgICAgICAgc3R5bGU6IGdyaWRSb3dzW2luZGV4XS5zdHlsZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRlbGV0ZSByb3cuY25bMF0uc3R5bGUubGVmdDtcblxuICAgICAgICAgICAgcm93cy5wdXNoKHJvdylcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uZmlnLnZkb20gPVxuICAgICAgICB7Y246IFtcbiAgICAgICAgICAgIHtjbHM6IFsnbmVvLWdyaWQtY29udGFpbmVyJ10sIGNuOiBbXG4gICAgICAgICAgICAgICAgey4uLmNvbmZpZy52ZG9tLCBjbHM6IFsnbmVvLWdyaWQtaGVhZGVyLXRvb2xiYXInLCAnbmVvLXRvb2xiYXInXX0sXG4gICAgICAgICAgICAgICAge2NsczogWyduZW8tZ3JpZC1ib2R5LXdyYXBwZXInXSwgaWQ6IGJvZHlXcmFwcGVySWQsIGNuOiBbXG4gICAgICAgICAgICAgICAgICAgIHtjbHM6IFsnbmVvLWdyaWQtYm9keSddLCBjbjogcm93c30sXG4gICAgICAgICAgICAgICAgICAgIHtjbHM6IFsnbmVvLWdyaWQtc2Nyb2xsYmFyJ10sIHN0eWxlOiB7aGVpZ2h0OiBib2R5LnZkb20uY25bMF0uaGVpZ2h0fX1cbiAgICAgICAgICAgICAgICBdfVxuICAgICAgICAgICAgXX1cbiAgICAgICAgXX07XG5cbiAgICAgICAgY29uZmlnLmxpc3RlbmVycyA9IHtcbiAgICAgICAgICAgIG1vdW50ZWQoKSB7XG4gICAgICAgICAgICAgICAgTmVvLm1haW4uRG9tQWNjZXNzLnNjcm9sbFRvKHtcbiAgICAgICAgICAgICAgICAgICAgaWQgICAgICA6IGJvZHlXcmFwcGVySWQsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlICAgOiBib2R5LnNjcm9sbFRvcCxcbiAgICAgICAgICAgICAgICAgICAgd2luZG93SWQ6IHRoaXMud2luZG93SWRcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChjcmVhdGVDb21wb25lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBtZS5kcmFnUHJveHkgPSBOZW8uY3JlYXRlKGNvbmZpZylcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb25maWdcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZnJvbUluZGV4XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHRvSW5kZXhcbiAgICAgKi9cbiAgICBtb3ZlVG8oZnJvbUluZGV4LCB0b0luZGV4KSB7XG4gICAgICAgIHN1cGVyLm1vdmVUbyhmcm9tSW5kZXgsIHRvSW5kZXgpO1xuICAgICAgICB0aGlzLm93bmVyLnBhcmVudC5jb2x1bW5zLm1vdmUoZnJvbUluZGV4LCB0b0luZGV4KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgYXN5bmMgb25EcmFnRW5kKGRhdGEpIHtcbiAgICAgICAgYXdhaXQgc3VwZXIub25EcmFnRW5kKGRhdGEpO1xuXG4gICAgICAgIGxldCB7b3duZXJ9ID0gdGhpcztcblxuICAgICAgICBvd25lci5pdGVtcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaXRlbS52ZG9tWydhcmlhLWNvbGluZGV4J10gPSBpbmRleCArIDE7IC8vIDEgYmFzZWRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgb3duZXIudXBkYXRlRGVwdGggPSAyO1xuICAgICAgICBvd25lci51cGRhdGUoKTtcblxuICAgICAgICBhd2FpdCBvd25lci5wYXNzU2l6ZVRvQm9keSgpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMudGltZW91dCgyMCk7XG5cbiAgICAgICAgb3duZXIucGFyZW50LmJvZHkuY3JlYXRlVmlld0RhdGEoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgYXN5bmMgb25EcmFnU3RhcnQoZGF0YSkge1xuICAgICAgICBhd2FpdCBzdXBlci5vbkRyYWdTdGFydChkYXRhKTtcblxuICAgICAgICBpZiAodGhpcy5tb3ZlQ29sdW1uQ29udGVudCkge1xuICAgICAgICAgICAgbGV0IG1lICAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICB7Ym9keX0gICAgICAgICA9IG1lLm93bmVyLnBhcmVudCxcbiAgICAgICAgICAgICAgICBjb2x1bW5JbmRleCAgICA9IG1lLmRyYWdFbGVtZW50WydhcmlhLWNvbGluZGV4J10gLSAxLFxuICAgICAgICAgICAgICAgIGNvbHVtblBvc2l0aW9uID0gYm9keS5jb2x1bW5Qb3NpdGlvbnMuZ2V0QXQoY29sdW1uSW5kZXgpLFxuICAgICAgICAgICAgICAgIHtkYXRhRmllbGR9ICAgID0gY29sdW1uUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgY2VsbHMgICAgICAgICAgPSBib2R5LmdldENvbHVtbkNlbGxzKGRhdGFGaWVsZCk7XG5cbiAgICAgICAgICAgIGNvbHVtblBvc2l0aW9uLmhpZGRlbiA9IHRydWU7XG5cbiAgICAgICAgICAgIGNlbGxzLmZvckVhY2goY2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgY2VsbC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbidcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBib2R5LnVwZGF0ZSgpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXgxXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4MlxuICAgICAqL1xuICAgIHN3aXRjaEl0ZW1zKGluZGV4MSwgaW5kZXgyKSB7XG4gICAgICAgIHN1cGVyLnN3aXRjaEl0ZW1zKGluZGV4MSwgaW5kZXgyKTtcblxuICAgICAgICBpZiAodGhpcy5tb3ZlQ29sdW1uQ29udGVudCkge1xuICAgICAgICAgICAgbGV0IG1lICAgICAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICB7aXRlbVJlY3RzfSAgICAgICA9IG1lLFxuICAgICAgICAgICAgICAgIHtib2R5fSAgICAgICAgICAgID0gbWUub3duZXIucGFyZW50LFxuICAgICAgICAgICAgICAgIHtjb2x1bW5Qb3NpdGlvbnN9ID0gYm9keSxcbiAgICAgICAgICAgICAgICBjb2x1bW4xUG9zaXRpb24gICA9IGNvbHVtblBvc2l0aW9ucy5nZXRBdChpbmRleDEpLFxuICAgICAgICAgICAgICAgIGNvbHVtbjJQb3NpdGlvbiAgID0gY29sdW1uUG9zaXRpb25zLmdldEF0KGluZGV4MiksXG4gICAgICAgICAgICAgICAgY29sdW1uMUNlbGxzICAgICAgPSBib2R5LmdldENvbHVtbkNlbGxzKGNvbHVtbjFQb3NpdGlvbi5kYXRhRmllbGQpLFxuICAgICAgICAgICAgICAgIGNvbHVtbjJDZWxscyAgICAgID0gYm9keS5nZXRDb2x1bW5DZWxscyhjb2x1bW4yUG9zaXRpb24uZGF0YUZpZWxkKTtcblxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb2x1bW4xUG9zaXRpb24sIHtcbiAgICAgICAgICAgICAgICB3aWR0aDogaXRlbVJlY3RzW2luZGV4Ml0ud2lkdGgsXG4gICAgICAgICAgICAgICAgeCAgICA6IGl0ZW1SZWN0c1tpbmRleDJdLnggKyAxXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb2x1bW4yUG9zaXRpb24sIHtcbiAgICAgICAgICAgICAgICB3aWR0aDogaXRlbVJlY3RzW2luZGV4MV0ud2lkdGgsXG4gICAgICAgICAgICAgICAgeCAgICA6IGl0ZW1SZWN0c1tpbmRleDFdLnggKyAxXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29sdW1uUG9zaXRpb25zLm1vdmUoaW5kZXgxLCBpbmRleDIpO1xuXG4gICAgICAgICAgICBjb2x1bW4xQ2VsbHMuZm9yRWFjaChub2RlID0+IHtcbiAgICAgICAgICAgICAgICBub2RlLnN0eWxlLmxlZnQgID0gY29sdW1uMVBvc2l0aW9uLnggICAgICsgJ3B4JztcbiAgICAgICAgICAgICAgICBub2RlLnN0eWxlLndpZHRoID0gY29sdW1uMVBvc2l0aW9uLndpZHRoICsgJ3B4J1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbHVtbjJDZWxscy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUubGVmdCAgPSBjb2x1bW4yUG9zaXRpb24ueCAgICAgKyAncHgnO1xuICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUud2lkdGggPSBjb2x1bW4yUG9zaXRpb24ud2lkdGggKyAncHgnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYm9keS51cGRhdGUoKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhTb3J0Wm9uZSk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=