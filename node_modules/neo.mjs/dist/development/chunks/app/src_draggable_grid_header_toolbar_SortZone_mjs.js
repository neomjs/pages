"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["src_draggable_grid_header_toolbar_SortZone_mjs"],{

/***/ "./src/draggable/grid/header/toolbar/SortZone.mjs":
/*!********************************************************!*\
  !*** ./src/draggable/grid/header/toolbar/SortZone.mjs ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _toolbar_SortZone_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../toolbar/SortZone.mjs */ "./src/draggable/toolbar/SortZone.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/VDom.mjs */ "./src/util/VDom.mjs");




/**
 * @class Neo.draggable.grid.header.toolbar.SortZone
 * @extends Neo.draggable.toolbar.SortZone
 */
class SortZone extends _toolbar_SortZone_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.draggable.grid.header.toolbar.SortZone'
         * @protected
         */
        className: 'Neo.draggable.grid.header.toolbar.SortZone',
        /**
         * @member {String} ntype='grid-header-toolbar-sortzone'
         * @protected
         */
        ntype: 'grid-header-toolbar-sortzone',
        /**
         * @member {String|null} itemMargin='1px'
         * @protected
         */
        itemMargin: '1px',
        /**
         * @member {Boolean} moveColumnContent=true
         */
        moveColumnContent: true,
        /**
         * @member {Boolean} moveVertical=false
         */
        moveVertical: false
    }

    /**
     * @param {Neo.util.Rectangle} rect
     * @param {Neo.util.Rectangle} parentRect
     */
    adjustProxyRectToParent(rect, parentRect) {
        rect.x = rect.x - parentRect.x - 1;
        rect.y = rect.y - parentRect.y - 1
    }

    /**
     * @param {Object}  data
     * @param {Boolean} createComponent=true
     * @returns {Object|Neo.draggable.DragProxyComponent}
     */
    async createDragProxy(data, createComponent=true) {
        if (!this.moveColumnContent) {
            return await super.createDragProxy(data, createComponent)
        }

        let me            = this,
            grid          = me.owner.parent,
            {view}        = grid,
            gridRows      = view.getVdomRoot().cn,
            columnIndex   = me.dragElement['aria-colindex'] - 1,
            {dataField}   = view.columnPositions[columnIndex],
            cells         = view.getColumnCells(dataField),
            rows          = [],
            config        = await super.createDragProxy(data, false),
            rect          = await grid.getDomRect(),
            viewWrapperId = Neo.getId('grid-view-wrapper'),
            row;

        config.cls = ['neo-grid-wrapper', me.owner.getTheme()];

        config.style.height = `${rect.height - 2}px`; // minus border-bottom & border-top

        cells.forEach((cell, index) => {
            row = _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].clone({ // clone to remove ids
                cls  : gridRows[index].cls,
                cn   : [cell],
                style: gridRows[index].style
            });

            delete row.cn[0].style.left;

            rows.push(row)
        });

        config.vdom =
        {cn: [
            {cls: ['neo-grid-container'], cn: [
                {...config.vdom, cls: ['neo-grid-header-toolbar', 'neo-toolbar']},
                {cls: ['neo-grid-view-wrapper'], id: viewWrapperId, cn: [
                    {cls: ['neo-grid-view'], cn: rows},
                    {cls: ['neo-grid-scrollbar'], style: {height: view.vdom.cn[1].height}}
                ]}
            ]}
        ]};

        config.listeners = {
            mounted() {
                Neo.main.DomAccess.scrollTo({
                    direction: 'top',
                    id       : viewWrapperId,
                    value    : view.scrollPosition.y,
                    windowId : this.windowId
                })
            }
        };

        if (createComponent) {
            return me.dragProxy = Neo.create(config)
        }

        return config
    }

    /**
     * @param {Number} fromIndex
     * @param {Number} toIndex
     */
    moveTo(fromIndex, toIndex) {
        super.moveTo(fromIndex, toIndex);

        // It is crucial to use _columns to not get a shallow copy
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].move(this.owner.parent._columns, fromIndex, toIndex);
    }

    /**
     * @param {Object} data
     */
    async onDragEnd(data) {
        await super.onDragEnd(data);

        let {owner} = this;

        owner.items.forEach((item, index) => {
            item.vdom['aria-colindex'] = index + 1; // 1 based
        });

        owner.updateDepth = 2;
        owner.update();

        await owner.passSizeToView();

        await this.timeout(20);

        owner.parent.view.createViewData()
    }

    /**
     * @param {Object} data
     */
    async onDragStart(data) {
        await super.onDragStart(data);

        if (this.moveColumnContent) {
            let me          = this,
                {view}      = me.owner.parent,
                columnIndex = me.dragElement['aria-colindex'] - 1,
                {dataField} = view.columnPositions[columnIndex],
                cells       = view.getColumnCells(dataField);

            cells.forEach(cell => {
                cell.style.display = 'none'
            });

            view.update()
        }
    }

    /**
     * @param {Number} index1
     * @param {Number} index2
     */
    switchItems(index1, index2) {
        super.switchItems(index1, index2);

        if (this.moveColumnContent) {
            let me              = this,
                {itemRects}     = me,
                {view}          = me.owner.parent,
                columnPositions = view._columnPositions, // no clone
                column1Cells    = view.getColumnCells(columnPositions[index1].dataField),
                column2Cells    = view.getColumnCells(columnPositions[index2].dataField);

            Object.assign(columnPositions[index1], {
                width: itemRects[index2].width,
                x    : itemRects[index2].x + 1
            });

            Object.assign(columnPositions[index2], {
                width: itemRects[index1].width,
                x    : itemRects[index1].x + 1
            });

            _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].move(columnPositions, index1, index2);

            column1Cells.forEach(node => {
                node.style.left  = columnPositions[index2].x     + 'px';
                node.style.width = columnPositions[index2].width + 'px'
            });

            column2Cells.forEach(node => {
                node.style.left  = columnPositions[index1].x + 'px';
                node.style.width = columnPositions[index1].width + 'px'
            });

            view.update()
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(SortZone));


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC9zcmNfZHJhZ2dhYmxlX2dyaWRfaGVhZGVyX3Rvb2xiYXJfU29ydFpvbmVfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBeUQ7QUFDRjtBQUNEOztBQUV0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qiw2REFBWTtBQUNuQztBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxvQkFBb0I7QUFDbkMsZUFBZSxvQkFBb0I7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsU0FBUztBQUN4QixlQUFlLFNBQVM7QUFDeEIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWEsYUFBYTtBQUMxQjtBQUNBO0FBQ0EsYUFBYSxhQUFhO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxpQ0FBaUMsZ0JBQWdCLEtBQUs7O0FBRXREO0FBQ0Esa0JBQWtCLHNEQUFRLFNBQVM7QUFDbkM7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQSxTQUFTO0FBQ1QsYUFBYTtBQUNiLGlCQUFpQixnRUFBZ0U7QUFDakYsaUJBQWlCO0FBQ2pCLHFCQUFxQixpQ0FBaUM7QUFDdEQscUJBQXFCLHFDQUFxQztBQUMxRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBOztBQUVBO0FBQ0EsUUFBUSx1REFBUTtBQUNoQjs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7O0FBRUEsYUFBYSxPQUFPOztBQUVwQjtBQUNBLG9EQUFvRDtBQUNwRCxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQixXQUFXO0FBQzVCO0FBQ0EsaUJBQWlCLFdBQVc7QUFDNUI7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQixlQUFlO0FBQ2hDLGlCQUFpQixlQUFlO0FBQ2hDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWIsWUFBWSx1REFBUTs7QUFFcEI7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLHdCQUF3QixFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9kcmFnZ2FibGUvZ3JpZC9oZWFkZXIvdG9vbGJhci9Tb3J0Wm9uZS5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJhc2VTb3J0Wm9uZSBmcm9tICcuLi8uLi8uLi90b29sYmFyL1NvcnRab25lLm1qcyc7XG5pbXBvcnQgTmVvQXJyYXkgICAgIGZyb20gICcuLi8uLi8uLi8uLi91dGlsL0FycmF5Lm1qcyc7XG5pbXBvcnQgVmRvbVV0aWwgICAgIGZyb20gICcuLi8uLi8uLi8uLi91dGlsL1ZEb20ubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTmVvLmRyYWdnYWJsZS5ncmlkLmhlYWRlci50b29sYmFyLlNvcnRab25lXG4gKiBAZXh0ZW5kcyBOZW8uZHJhZ2dhYmxlLnRvb2xiYXIuU29ydFpvbmVcbiAqL1xuY2xhc3MgU29ydFpvbmUgZXh0ZW5kcyBCYXNlU29ydFpvbmUge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLmRyYWdnYWJsZS5ncmlkLmhlYWRlci50b29sYmFyLlNvcnRab25lJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8uZHJhZ2dhYmxlLmdyaWQuaGVhZGVyLnRvb2xiYXIuU29ydFpvbmUnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBudHlwZT0nZ3JpZC1oZWFkZXItdG9vbGJhci1zb3J0em9uZSdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgbnR5cGU6ICdncmlkLWhlYWRlci10b29sYmFyLXNvcnR6b25lJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBpdGVtTWFyZ2luPScxcHgnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGl0ZW1NYXJnaW46ICcxcHgnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gbW92ZUNvbHVtbkNvbnRlbnQ9dHJ1ZVxuICAgICAgICAgKi9cbiAgICAgICAgbW92ZUNvbHVtbkNvbnRlbnQ6IHRydWUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBtb3ZlVmVydGljYWw9ZmFsc2VcbiAgICAgICAgICovXG4gICAgICAgIG1vdmVWZXJ0aWNhbDogZmFsc2VcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge05lby51dGlsLlJlY3RhbmdsZX0gcmVjdFxuICAgICAqIEBwYXJhbSB7TmVvLnV0aWwuUmVjdGFuZ2xlfSBwYXJlbnRSZWN0XG4gICAgICovXG4gICAgYWRqdXN0UHJveHlSZWN0VG9QYXJlbnQocmVjdCwgcGFyZW50UmVjdCkge1xuICAgICAgICByZWN0LnggPSByZWN0LnggLSBwYXJlbnRSZWN0LnggLSAxO1xuICAgICAgICByZWN0LnkgPSByZWN0LnkgLSBwYXJlbnRSZWN0LnkgLSAxXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9ICBkYXRhXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBjcmVhdGVDb21wb25lbnQ9dHJ1ZVxuICAgICAqIEByZXR1cm5zIHtPYmplY3R8TmVvLmRyYWdnYWJsZS5EcmFnUHJveHlDb21wb25lbnR9XG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlRHJhZ1Byb3h5KGRhdGEsIGNyZWF0ZUNvbXBvbmVudD10cnVlKSB7XG4gICAgICAgIGlmICghdGhpcy5tb3ZlQ29sdW1uQ29udGVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHN1cGVyLmNyZWF0ZURyYWdQcm94eShkYXRhLCBjcmVhdGVDb21wb25lbnQpXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbWUgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBncmlkICAgICAgICAgID0gbWUub3duZXIucGFyZW50LFxuICAgICAgICAgICAge3ZpZXd9ICAgICAgICA9IGdyaWQsXG4gICAgICAgICAgICBncmlkUm93cyAgICAgID0gdmlldy5nZXRWZG9tUm9vdCgpLmNuLFxuICAgICAgICAgICAgY29sdW1uSW5kZXggICA9IG1lLmRyYWdFbGVtZW50WydhcmlhLWNvbGluZGV4J10gLSAxLFxuICAgICAgICAgICAge2RhdGFGaWVsZH0gICA9IHZpZXcuY29sdW1uUG9zaXRpb25zW2NvbHVtbkluZGV4XSxcbiAgICAgICAgICAgIGNlbGxzICAgICAgICAgPSB2aWV3LmdldENvbHVtbkNlbGxzKGRhdGFGaWVsZCksXG4gICAgICAgICAgICByb3dzICAgICAgICAgID0gW10sXG4gICAgICAgICAgICBjb25maWcgICAgICAgID0gYXdhaXQgc3VwZXIuY3JlYXRlRHJhZ1Byb3h5KGRhdGEsIGZhbHNlKSxcbiAgICAgICAgICAgIHJlY3QgICAgICAgICAgPSBhd2FpdCBncmlkLmdldERvbVJlY3QoKSxcbiAgICAgICAgICAgIHZpZXdXcmFwcGVySWQgPSBOZW8uZ2V0SWQoJ2dyaWQtdmlldy13cmFwcGVyJyksXG4gICAgICAgICAgICByb3c7XG5cbiAgICAgICAgY29uZmlnLmNscyA9IFsnbmVvLWdyaWQtd3JhcHBlcicsIG1lLm93bmVyLmdldFRoZW1lKCldO1xuXG4gICAgICAgIGNvbmZpZy5zdHlsZS5oZWlnaHQgPSBgJHtyZWN0LmhlaWdodCAtIDJ9cHhgOyAvLyBtaW51cyBib3JkZXItYm90dG9tICYgYm9yZGVyLXRvcFxuXG4gICAgICAgIGNlbGxzLmZvckVhY2goKGNlbGwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICByb3cgPSBWZG9tVXRpbC5jbG9uZSh7IC8vIGNsb25lIHRvIHJlbW92ZSBpZHNcbiAgICAgICAgICAgICAgICBjbHMgIDogZ3JpZFJvd3NbaW5kZXhdLmNscyxcbiAgICAgICAgICAgICAgICBjbiAgIDogW2NlbGxdLFxuICAgICAgICAgICAgICAgIHN0eWxlOiBncmlkUm93c1tpbmRleF0uc3R5bGVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkZWxldGUgcm93LmNuWzBdLnN0eWxlLmxlZnQ7XG5cbiAgICAgICAgICAgIHJvd3MucHVzaChyb3cpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbmZpZy52ZG9tID1cbiAgICAgICAge2NuOiBbXG4gICAgICAgICAgICB7Y2xzOiBbJ25lby1ncmlkLWNvbnRhaW5lciddLCBjbjogW1xuICAgICAgICAgICAgICAgIHsuLi5jb25maWcudmRvbSwgY2xzOiBbJ25lby1ncmlkLWhlYWRlci10b29sYmFyJywgJ25lby10b29sYmFyJ119LFxuICAgICAgICAgICAgICAgIHtjbHM6IFsnbmVvLWdyaWQtdmlldy13cmFwcGVyJ10sIGlkOiB2aWV3V3JhcHBlcklkLCBjbjogW1xuICAgICAgICAgICAgICAgICAgICB7Y2xzOiBbJ25lby1ncmlkLXZpZXcnXSwgY246IHJvd3N9LFxuICAgICAgICAgICAgICAgICAgICB7Y2xzOiBbJ25lby1ncmlkLXNjcm9sbGJhciddLCBzdHlsZToge2hlaWdodDogdmlldy52ZG9tLmNuWzFdLmhlaWdodH19XG4gICAgICAgICAgICAgICAgXX1cbiAgICAgICAgICAgIF19XG4gICAgICAgIF19O1xuXG4gICAgICAgIGNvbmZpZy5saXN0ZW5lcnMgPSB7XG4gICAgICAgICAgICBtb3VudGVkKCkge1xuICAgICAgICAgICAgICAgIE5lby5tYWluLkRvbUFjY2Vzcy5zY3JvbGxUbyh7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ3RvcCcsXG4gICAgICAgICAgICAgICAgICAgIGlkICAgICAgIDogdmlld1dyYXBwZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgICAgOiB2aWV3LnNjcm9sbFBvc2l0aW9uLnksXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvd0lkIDogdGhpcy53aW5kb3dJZFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGNyZWF0ZUNvbXBvbmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIG1lLmRyYWdQcm94eSA9IE5lby5jcmVhdGUoY29uZmlnKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvbmZpZ1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBmcm9tSW5kZXhcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdG9JbmRleFxuICAgICAqL1xuICAgIG1vdmVUbyhmcm9tSW5kZXgsIHRvSW5kZXgpIHtcbiAgICAgICAgc3VwZXIubW92ZVRvKGZyb21JbmRleCwgdG9JbmRleCk7XG5cbiAgICAgICAgLy8gSXQgaXMgY3J1Y2lhbCB0byB1c2UgX2NvbHVtbnMgdG8gbm90IGdldCBhIHNoYWxsb3cgY29weVxuICAgICAgICBOZW9BcnJheS5tb3ZlKHRoaXMub3duZXIucGFyZW50Ll9jb2x1bW5zLCBmcm9tSW5kZXgsIHRvSW5kZXgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgYXN5bmMgb25EcmFnRW5kKGRhdGEpIHtcbiAgICAgICAgYXdhaXQgc3VwZXIub25EcmFnRW5kKGRhdGEpO1xuXG4gICAgICAgIGxldCB7b3duZXJ9ID0gdGhpcztcblxuICAgICAgICBvd25lci5pdGVtcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaXRlbS52ZG9tWydhcmlhLWNvbGluZGV4J10gPSBpbmRleCArIDE7IC8vIDEgYmFzZWRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgb3duZXIudXBkYXRlRGVwdGggPSAyO1xuICAgICAgICBvd25lci51cGRhdGUoKTtcblxuICAgICAgICBhd2FpdCBvd25lci5wYXNzU2l6ZVRvVmlldygpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMudGltZW91dCgyMCk7XG5cbiAgICAgICAgb3duZXIucGFyZW50LnZpZXcuY3JlYXRlVmlld0RhdGEoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgYXN5bmMgb25EcmFnU3RhcnQoZGF0YSkge1xuICAgICAgICBhd2FpdCBzdXBlci5vbkRyYWdTdGFydChkYXRhKTtcblxuICAgICAgICBpZiAodGhpcy5tb3ZlQ29sdW1uQ29udGVudCkge1xuICAgICAgICAgICAgbGV0IG1lICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICB7dmlld30gICAgICA9IG1lLm93bmVyLnBhcmVudCxcbiAgICAgICAgICAgICAgICBjb2x1bW5JbmRleCA9IG1lLmRyYWdFbGVtZW50WydhcmlhLWNvbGluZGV4J10gLSAxLFxuICAgICAgICAgICAgICAgIHtkYXRhRmllbGR9ID0gdmlldy5jb2x1bW5Qb3NpdGlvbnNbY29sdW1uSW5kZXhdLFxuICAgICAgICAgICAgICAgIGNlbGxzICAgICAgID0gdmlldy5nZXRDb2x1bW5DZWxscyhkYXRhRmllbGQpO1xuXG4gICAgICAgICAgICBjZWxscy5mb3JFYWNoKGNlbGwgPT4ge1xuICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZpZXcudXBkYXRlKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleDFcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXgyXG4gICAgICovXG4gICAgc3dpdGNoSXRlbXMoaW5kZXgxLCBpbmRleDIpIHtcbiAgICAgICAgc3VwZXIuc3dpdGNoSXRlbXMoaW5kZXgxLCBpbmRleDIpO1xuXG4gICAgICAgIGlmICh0aGlzLm1vdmVDb2x1bW5Db250ZW50KSB7XG4gICAgICAgICAgICBsZXQgbWUgICAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICB7aXRlbVJlY3RzfSAgICAgPSBtZSxcbiAgICAgICAgICAgICAgICB7dmlld30gICAgICAgICAgPSBtZS5vd25lci5wYXJlbnQsXG4gICAgICAgICAgICAgICAgY29sdW1uUG9zaXRpb25zID0gdmlldy5fY29sdW1uUG9zaXRpb25zLCAvLyBubyBjbG9uZVxuICAgICAgICAgICAgICAgIGNvbHVtbjFDZWxscyAgICA9IHZpZXcuZ2V0Q29sdW1uQ2VsbHMoY29sdW1uUG9zaXRpb25zW2luZGV4MV0uZGF0YUZpZWxkKSxcbiAgICAgICAgICAgICAgICBjb2x1bW4yQ2VsbHMgICAgPSB2aWV3LmdldENvbHVtbkNlbGxzKGNvbHVtblBvc2l0aW9uc1tpbmRleDJdLmRhdGFGaWVsZCk7XG5cbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29sdW1uUG9zaXRpb25zW2luZGV4MV0sIHtcbiAgICAgICAgICAgICAgICB3aWR0aDogaXRlbVJlY3RzW2luZGV4Ml0ud2lkdGgsXG4gICAgICAgICAgICAgICAgeCAgICA6IGl0ZW1SZWN0c1tpbmRleDJdLnggKyAxXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb2x1bW5Qb3NpdGlvbnNbaW5kZXgyXSwge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBpdGVtUmVjdHNbaW5kZXgxXS53aWR0aCxcbiAgICAgICAgICAgICAgICB4ICAgIDogaXRlbVJlY3RzW2luZGV4MV0ueCArIDFcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBOZW9BcnJheS5tb3ZlKGNvbHVtblBvc2l0aW9ucywgaW5kZXgxLCBpbmRleDIpO1xuXG4gICAgICAgICAgICBjb2x1bW4xQ2VsbHMuZm9yRWFjaChub2RlID0+IHtcbiAgICAgICAgICAgICAgICBub2RlLnN0eWxlLmxlZnQgID0gY29sdW1uUG9zaXRpb25zW2luZGV4Ml0ueCAgICAgKyAncHgnO1xuICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUud2lkdGggPSBjb2x1bW5Qb3NpdGlvbnNbaW5kZXgyXS53aWR0aCArICdweCdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb2x1bW4yQ2VsbHMuZm9yRWFjaChub2RlID0+IHtcbiAgICAgICAgICAgICAgICBub2RlLnN0eWxlLmxlZnQgID0gY29sdW1uUG9zaXRpb25zW2luZGV4MV0ueCArICdweCc7XG4gICAgICAgICAgICAgICAgbm9kZS5zdHlsZS53aWR0aCA9IGNvbHVtblBvc2l0aW9uc1tpbmRleDFdLndpZHRoICsgJ3B4J1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZpZXcudXBkYXRlKClcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoU29ydFpvbmUpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9