{"classData":[{"comment":"/**\n * @summary Monitors and validates the ChromaDB dependency for the Knowledge Base MCP server.\n *\n * Monitors and validates the ChromaDB dependency for the Knowledge Base MCP server.\n *\n * This service acts as a gatekeeper, ensuring that ChromaDB is properly running,\n * accessible, and contains the expected collection before any knowledge base operations proceed.\n *\n * Key responsibilities:\n * - Connectivity validation: Ensures ChromaDB is reachable via heartbeat\n * - Collection verification: Confirms the knowledge base collection exists\n * - Intelligent caching: Reduces overhead by caching health status for 5 minutes\n * - Graceful degradation: Provides clear, actionable error messages when dependencies are missing\n * - Recovery detection: Automatically detects when issues are resolved (e.g., after starting ChromaDB)\n *\n * The service is designed to be non-blocking at startup, allowing the server to run even\n * when ChromaDB is not available, while failing gracefully at the tool-call level with helpful\n * error messages to guide users toward resolution.\n *\n * @class Neo.ai.mcp.server.knowledge-base.services.HealthService\n * @extends Neo.core.Base\n * @singleton\n */","meta":{"filename":"HealthService.mjs","lineno":7,"columnno":0,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"summary":"Monitors and validates the ChromaDB dependency for the Knowledge Base MCP server.\n\nMonitors and validates the ChromaDB dependency for the Knowledge Base MCP server.\n\nThis service acts as a gatekeeper, ensuring that ChromaDB is properly running,\naccessible, and contains the expected collection before any knowledge base operations proceed.\n\nKey responsibilities:\n- Connectivity validation: Ensures ChromaDB is reachable via heartbeat\n- Collection verification: Confirms the knowledge base collection exists\n- Intelligent caching: Reduces overhead by caching health status for 5 minutes\n- Graceful degradation: Provides clear, actionable error messages when dependencies are missing\n- Recovery detection: Automatically detects when issues are resolved (e.g., after starting ChromaDB)\n\nThe service is designed to be non-blocking at startup, allowing the server to run even\nwhen ChromaDB is not available, while failing gracefully at the tool-call level with helpful\nerror messages to guide users toward resolution.","kind":"class","name":"HealthService","augments":["Neo.core.Base"],"tags":[{"originalTitle":"singleton","title":"singleton","text":""}],"memberof":"Neo.ai.mcp.server.knowledge-base.services","longname":"Neo.ai.mcp.server.knowledge-base.services.HealthService","scope":"static","$longname":"Neo.ai.mcp.server.knowledge-base.services.HealthService","$kind":"class","id":6303,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n         * @member {String} className='Neo.ai.mcp.server.knowledge-base.services.HealthService'\n         * @protected\n         */","meta":{"filename":"HealthService.mjs","lineno":36,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"kind":"member","name":"className","type":{"names":["String"]},"defaultvalue":"'Neo.ai.mcp.server.knowledge-base.services.HealthService'","access":"protected","longname":"className","scope":"global","$longname":"className","$kind":"property","id":6304,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n         * @member {Boolean} singleton=true\n         * @protected\n         */","meta":{"filename":"HealthService.mjs","lineno":41,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"kind":"member","name":"singleton","type":{"names":["Boolean"]},"defaultvalue":true,"access":"protected","longname":"singleton","scope":"global","$longname":"singleton","$kind":"property","id":6305,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n     * Cached result of the most recent health check.\n     * Used to avoid redundant ChromaDB calls within the cache TTL window.\n     * @member {Object|null} #cachedHealth\n     * @private\n     */","meta":{"filename":"HealthService.mjs","lineno":50,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"description":"<p>Cached result of the most recent health check.\nUsed to avoid redundant ChromaDB calls within the cache TTL window.</p>\n","kind":"member","name":"#cachedHealth","type":{"names":["Object","null"]},"access":"private","longname":"#cachedHealth","scope":"global","$longname":"#cachedHealth","$kind":"property","id":6306,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n     * Timestamp (in milliseconds) of when the health check cache was last populated.\n     * @member {number|null} #lastCheckTime\n     * @private\n     */","meta":{"filename":"HealthService.mjs","lineno":57,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"description":"<p>Timestamp (in milliseconds) of when the health check cache was last populated.</p>\n","kind":"member","name":"#lastCheckTime","type":{"names":["number","null"]},"access":"private","longname":"#lastCheckTime","scope":"global","$longname":"#lastCheckTime","$kind":"property","id":6307,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n     * Promise of the currently executing health check.\n     * Used for request deduplication to prevent \"thundering herd\" of health checks.\n     * @member {Promise<Object>|null} #healthCheckPromise\n     * @private\n     */","meta":{"filename":"HealthService.mjs","lineno":65,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"description":"<p>Promise of the currently executing health check.\nUsed for request deduplication to prevent &quot;thundering herd&quot; of health checks.</p>\n","kind":"member","name":"#healthCheckPromise","type":{"names":["Promise.<Object>","null"]},"access":"private","longname":"#healthCheckPromise","scope":"global","$longname":"#healthCheckPromise","$kind":"property","id":6308,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n     * Duration (in milliseconds) for which cached HEALTHY results remain valid.\n     * Set to 5 minutes to balance freshness with performance.\n     * Unhealthy results are never cached to allow immediate recovery detection.\n     * @member {number} #cacheDuration\n     * @private\n     */","meta":{"filename":"HealthService.mjs","lineno":74,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"description":"<p>Duration (in milliseconds) for which cached HEALTHY results remain valid.\nSet to 5 minutes to balance freshness with performance.\nUnhealthy results are never cached to allow immediate recovery detection.</p>\n","kind":"member","name":"#cacheDuration","type":{"names":["number"]},"access":"private","longname":"#cacheDuration","scope":"global","$longname":"#cacheDuration","$kind":"property","id":6309,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n     * The status from the previous health check, used to detect state transitions\n     * (e.g., recovery from 'unhealthy' to 'healthy') and log meaningful messages.\n     * @member {string|null} #previousStatus\n     * @private\n     */","meta":{"filename":"HealthService.mjs","lineno":82,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{}},"description":"<p>The status from the previous health check, used to detect state transitions\n(e.g., recovery from &#39;unhealthy&#39; to &#39;healthy&#39;) and log meaningful messages.</p>\n","kind":"member","name":"#previousStatus","type":{"names":["string","null"]},"access":"private","longname":"#previousStatus","scope":"global","$longname":"#previousStatus","$kind":"property","id":6310,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n     * Public API: Checks the health of the Knowledge Base with intelligent caching.\n     *\n     * Intent: This is the primary entry point for all health checks. It uses a\n     * 5-minute cache to avoid hammering ChromaDB with redundant heartbeat calls,\n     * which is especially important when:\n     * - The MCP server is handling multiple concurrent tool requests\n     * - Agents are debugging issues and repeatedly calling healthcheck\n     * - The startup sequence is running automatic summarization\n     *\n     * IMPORTANT: Only 'healthy' results are cached. Unhealthy/degraded results are\n     * always fresh, allowing immediate recovery detection when users fix issues\n     * (e.g., by starting ChromaDB or setting GEMINI_API_KEY). This ensures good UX -\n     * users don't have to wait 5 minutes to retry after fixing a problem.\n     *\n     * Recovery detection: If the status changes between checks (e.g., from 'unhealthy'\n     * to 'healthy'), we log a clear message so users know their fix worked.\n     *\n     * @returns {Promise<object>} A health status payload\n     */","meta":{"range":[10076,12858],"filename":"HealthService.mjs","lineno":266,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100027111","name":"HealthService#healthcheck","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>Public API: Checks the health of the Knowledge Base with intelligent caching.</p>\n<p>Intent: This is the primary entry point for all health checks. It uses a\n5-minute cache to avoid hammering ChromaDB with redundant heartbeat calls,\nwhich is especially important when:</p>\n<ul>\n<li>The MCP server is handling multiple concurrent tool requests</li>\n<li>Agents are debugging issues and repeatedly calling healthcheck</li>\n<li>The startup sequence is running automatic summarization</li>\n</ul>\n<p>IMPORTANT: Only &#39;healthy&#39; results are cached. Unhealthy/degraded results are\nalways fresh, allowing immediate recovery detection when users fix issues\n(e.g., by starting ChromaDB or setting GEMINI_API_KEY). This ensures good UX -\nusers don&#39;t have to wait 5 minutes to retry after fixing a problem.</p>\n<p>Recovery detection: If the status changes between checks (e.g., from &#39;unhealthy&#39;\nto &#39;healthy&#39;), we log a clear message so users know their fix worked.</p>\n","returns":[{"type":{"names":["Promise.<object>"]},"description":"A health status payload"}],"name":"healthcheck","longname":"HealthService#healthcheck","kind":"function","memberof":"HealthService","scope":"instance","params":[],"async":true,"$longname":"HealthService#healthcheck","$kind":"method","id":6311,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n     * Ensures the Knowledge Base is healthy before allowing an operation to proceed.\n     *\n     * Intent: This is the \"gatekeeper\" method used by tool handlers to fail-fast\n     * with a clear error message if dependencies are not available.\n     *\n     * By throwing an exception, we ensure that:\n     * 1. The operation doesn't attempt to use ChromaDB/Gemini and get cryptic errors\n     * 2. The agent receives a clear, actionable error message via the MCP protocol\n     * 3. Users understand exactly what needs to be fixed\n     *\n     * This method leverages the cached health check, so calling it frequently\n     * (e.g., before each tool invocation) has minimal performance impact.\n     *\n     * Note: Both ChromaDB and GEMINI_API_KEY are required for all knowledge base operations,\n     * since adding/querying knowledge requires text embeddings via the Gemini API.\n     * Only database lifecycle operations (start/stop) can work in degraded state.\n     *\n     * @throws {Error} If the Knowledge Base is not fully healthy, with a detailed message\n     * @returns {Promise<void>}\n     */","meta":{"range":[13967,14422],"filename":"HealthService.mjs","lineno":344,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100027360","name":"HealthService#ensureHealthy","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>Ensures the Knowledge Base is healthy before allowing an operation to proceed.</p>\n<p>Intent: This is the &quot;gatekeeper&quot; method used by tool handlers to fail-fast\nwith a clear error message if dependencies are not available.</p>\n<p>By throwing an exception, we ensure that:</p>\n<ol>\n<li>The operation doesn&#39;t attempt to use ChromaDB/Gemini and get cryptic errors</li>\n<li>The agent receives a clear, actionable error message via the MCP protocol</li>\n<li>Users understand exactly what needs to be fixed</li>\n</ol>\n<p>This method leverages the cached health check, so calling it frequently\n(e.g., before each tool invocation) has minimal performance impact.</p>\n<p>Note: Both ChromaDB and GEMINI_API_KEY are required for all knowledge base operations,\nsince adding/querying knowledge requires text embeddings via the Gemini API.\nOnly database lifecycle operations (start/stop) can work in degraded state.</p>\n","exceptions":[{"type":{"names":["Error"]},"description":"If the Knowledge Base is not fully healthy, with a detailed message"}],"returns":[{"type":{"names":["Promise.<void>"]}}],"name":"ensureHealthy","longname":"HealthService#ensureHealthy","kind":"function","memberof":"HealthService","scope":"instance","params":[],"async":true,"$longname":"HealthService#ensureHealthy","$kind":"method","id":6312,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"},{"comment":"/**\n     * Clears the health check cache, forcing the next call to perform a fresh check.\n     *\n     * Intent: This is primarily useful for testing and debugging scenarios where\n     * you need to immediately verify a fix (e.g., after starting ChromaDB)\n     * without waiting for the 5-minute cache to expire.\n     */","meta":{"range":[14752,14932],"filename":"HealthService.mjs","lineno":362,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/ai/mcp/server/knowledge-base/services","code":{"id":"astnode100027409","name":"HealthService#clearCache","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>Clears the health check cache, forcing the next call to perform a fresh check.</p>\n<p>Intent: This is primarily useful for testing and debugging scenarios where\nyou need to immediately verify a fix (e.g., after starting ChromaDB)\nwithout waiting for the 5-minute cache to expire.</p>\n","name":"clearCache","longname":"HealthService#clearCache","kind":"function","memberof":"HealthService","scope":"instance","params":[],"$longname":"HealthService#clearCache","$kind":"method","id":6313,"neoClassName":"Neo.ai.mcp.server.knowledge-base.services.HealthService"}]}