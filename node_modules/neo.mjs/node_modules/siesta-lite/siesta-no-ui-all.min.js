/*

Siesta 5.3.2
Copyright(c) 2009-2020 Bryntum AB
https://bryntum.com/contact
https://bryntum.com/products/siesta/license

*/
var JSON;"undefined"==typeof Joose&&function(){var Joose={};Joose.C="undefined"!=typeof JOOSE_CFG?JOOSE_CFG:{},Joose.is_IE=!1,Joose.is_NodeJS=Boolean("undefined"!=typeof process&&process.pid),Joose.top=Joose.is_NodeJS&&global||this,Joose.stub=function(){return function(){throw new Error("Modules can not be instantiated")}},Joose.VERSION="3.50.1","undefined"!=typeof module&&(module.exports=Joose),(this.Joose=Joose).A={each:function(array,func,scope){scope=scope||this;for(var i=0,len=array.length;i<len;i++)if(!1===func.call(scope,array[i],i))return!1},eachR:function(array,func,scope){scope=scope||this;for(var i=array.length-1;0<=i;i--)if(!1===func.call(scope,array[i],i))return!1},exists:function(array,value){for(var i=0,len=array.length;i<len;i++)if(array[i]==value)return!0;return!1},map:function(array,func,scope){scope=scope||this;for(var res=[],i=0,len=array.length;i<len;i++)res.push(func.call(scope,array[i],i));return res},grep:function(array,func){var a=[];return Joose.A.each(array,function(t){func(t)&&a.push(t)}),a},remove:function(array,removeEle){var a=[];return Joose.A.each(array,function(t){t!==removeEle&&a.push(t)}),a}},Joose.S={saneSplit:function(str,delimeter){var res=(str||"").split(delimeter);return 1!=res.length||res[0]||res.shift(),res},uppercaseFirst:function(string){return string.substr(0,1).toUpperCase()+string.substr(1,string.length-1)},strToClass:function(name,top){var current=top||Joose.top;return Joose.A.each(name.split("."),function(segment){if(!current)return!1;current=current[segment]}),current}};function baseFunc(){}var enumProps=["hasOwnProperty","valueOf","toString","constructor"],manualEnum=!0;for(var i in{toString:1})manualEnum=!1;Joose.O={each:function(object,func,scope){for(var i in scope=scope||this,object)if(!1===func.call(scope,object[i],i))return!1;if(manualEnum)return Joose.A.each(enumProps,function(el){if(object.hasOwnProperty(el))return func.call(scope,object[el],el)})},eachOwn:function(object,func,scope){return scope=scope||this,Joose.O.each(object,function(value,name){if(object.hasOwnProperty(name))return func.call(scope,value,name)},scope)},copy:function(source,target){return target=target||{},Joose.O.each(source,function(value,name){target[name]=value}),target},copyOwn:function(source,target){return target=target||{},Joose.O.eachOwn(source,function(value,name){target[name]=value}),target},getMutableCopy:function(object){return baseFunc.prototype=object,new baseFunc},extend:function(target,source){return Joose.O.copy(source,target)},isEmpty:function(object){for(var i in object)if(object.hasOwnProperty(i))return!1;return!0},isInstance:function(obj){return obj&&obj.meta&&obj.constructor==obj.meta.c},isClass:function(obj){return obj&&obj.meta&&obj.meta.c==obj},wantArray:function(obj){return obj instanceof Array?obj:[obj]},isFunction:function(obj){return"function"==typeof obj&&obj.constructor!=/ /.constructor}},Joose.I={Array:function(){return[]},Object:function(){return{}},Function:function(){return arguments.callee},Now:function(){return new Date}},Joose.Proto=Joose.stub(),Joose.Proto.Empty=Joose.stub(),Joose.Proto.Empty.meta={},function(){Joose.Proto.Object=Joose.stub();var SUPER=function(){var self=SUPER.caller;if(self==SUPERARG&&(self=self.caller),!self.SUPER)throw"Invalid call to SUPER";return self.SUPER[self.methodName].apply(this,arguments)},SUPERARG=function(){return this.SUPER.apply(this,arguments[0])};Joose.Proto.Object.prototype={SUPERARG:SUPERARG,SUPER:SUPER,INNER:function(){throw"Invalid call to INNER"},BUILD:function(config){return 1==arguments.length&&"object"==typeof config&&config||{}},initialize:function(){},toString:function(){return"a "+this.meta.name}},Joose.Proto.Object.meta={constructor:Joose.Proto.Object,methods:Joose.O.copy(Joose.Proto.Object.prototype),attributes:{}},Joose.Proto.Object.prototype.meta=Joose.Proto.Object.meta}(),function(){Joose.Proto.Class=function(){return this.initialize(this.BUILD.apply(this,arguments))||this};var bootstrap={VERSION:null,AUTHORITY:null,constructor:Joose.Proto.Class,superClass:null,name:null,attributes:null,methods:null,meta:null,c:null,defaultSuperClass:Joose.Proto.Object,BUILD:function(name,extend){return this.name=name,{__extend__:extend||{}}},initialize:function(props){var extend=props.__extend__;this.VERSION=extend.VERSION,this.AUTHORITY=extend.AUTHORITY,delete extend.VERSION,delete extend.AUTHORITY,this.c=this.extractConstructor(extend),this.adaptConstructor(this.c),extend.constructorOnly?delete extend.constructorOnly:this.construct(extend)},construct:function(extend){if(this.prepareProps(extend)){var superClass=this.superClass=this.extractSuperClass(extend);this.processSuperClass(superClass),this.adaptPrototype(this.c.prototype),this.finalize(extend)}},finalize:function(extend){this.processStem(extend),this.extend(extend)},prepareProps:function(extend){return!0},extractConstructor:function(extend){var res=extend.hasOwnProperty("constructor")?extend.constructor:this.defaultConstructor();return delete extend.constructor,res},extractSuperClass:function(extend){if(extend.hasOwnProperty("isa")&&!extend.isa)throw new Error("Attempt to inherit from undefined superclass ["+this.name+"]");var res=extend.isa||this.defaultSuperClass;return delete extend.isa,res},processStem:function(){var superMeta=this.superClass.meta;this.methods=Joose.O.getMutableCopy(superMeta.methods||{}),this.attributes=Joose.O.getMutableCopy(superMeta.attributes||{})},initInstance:function(instance,props){Joose.O.copyOwn(props,instance)},defaultConstructor:function(){return function(arg){var BUILD=this.BUILD,args=BUILD&&BUILD.apply(this,arguments)||arg||{},thisMeta=this.meta;return thisMeta.initInstance(this,args),thisMeta.hasMethod("initialize")&&this.initialize(args)||this}},processSuperClass:function(superClass){var superProto=superClass.prototype;if(!superClass.meta){var extend=Joose.O.copy(superProto);extend.isa=Joose.Proto.Empty,delete extend.constructor;var meta=new this.defaultSuperClass.meta.constructor(null,extend);superClass.meta=superProto.meta=meta,meta.c=superClass}this.c.prototype=Joose.O.getMutableCopy(superProto),this.c.superClass=superProto},adaptConstructor:function(c){c.meta=this,c.hasOwnProperty("toString")||(c.toString=function(){return this.meta.name})},adaptPrototype:function(proto){proto.constructor=this.c,proto.meta=this},addMethod:function(name,func){func.SUPER=this.superClass.prototype,func.methodName=name,this.methods[name]=func,this.c.prototype[name]=func},addAttribute:function(name,init){this.attributes[name]=init,this.c.prototype[name]=init},removeMethod:function(name){delete this.methods[name],delete this.c.prototype[name]},removeAttribute:function(name){delete this.attributes[name],delete this.c.prototype[name]},hasMethod:function(name){return Boolean(this.methods[name])},hasAttribute:function(name){return void 0!==this.attributes[name]},hasOwnMethod:function(name){return this.hasMethod(name)&&this.methods.hasOwnProperty(name)},hasOwnAttribute:function(name){return this.hasAttribute(name)&&this.attributes.hasOwnProperty(name)},extend:function(props){Joose.O.eachOwn(props,function(value,name){"meta"!=name&&"constructor"!=name&&(Joose.O.isFunction(value)&&!value.meta?this.addMethod(name,value):this.addAttribute(name,value))},this)},subClassOf:function(classObject,extend){return this.subClass(extend,null,classObject)},subClass:function(extend,name,classObject){return(extend=extend||{}).isa=classObject||this.c,new this.constructor(name,extend).c},instantiate:function(){function f(){}f.prototype=this.c.prototype;var obj=new f;return this.c.apply(obj,arguments)||obj}};Joose.Proto.Class.prototype=Joose.O.getMutableCopy(Joose.Proto.Object.prototype),Joose.O.extend(Joose.Proto.Class.prototype,bootstrap),Joose.Proto.Class.prototype.meta=new Joose.Proto.Class("Joose.Proto.Class",bootstrap),Joose.Proto.Class.meta.addMethod("isa",function(someClass){function f(){}return f.prototype=this.c.prototype,new f instanceof someClass})}(),Joose.Managed=Joose.stub(),Joose.Managed.Property=new Joose.Proto.Class("Joose.Managed.Property",{name:null,init:null,value:null,definedIn:null,initialize:function(props){Joose.Managed.Property.superClass.initialize.call(this,props),this.computeValue()},computeValue:function(){this.value=this.init},preApply:function(targetClass){},postUnApply:function(targetClass){},apply:function(target){target[this.name]=this.value},isAppliedTo:function(target){return target[this.name]==this.value},unapply:function(from){if(!this.isAppliedTo(from))throw"Unapply of property ["+this.name+"] from ["+from+"] failed";delete from[this.name]},cloneProps:function(){return{name:this.name,init:this.init,definedIn:this.definedIn}},clone:function(name){var props=this.cloneProps();return props.name=name||props.name,new this.constructor(props)}}).c,Joose.Managed.Property.ConflictMarker=new Joose.Proto.Class("Joose.Managed.Property.ConflictMarker",{isa:Joose.Managed.Property,apply:function(target){throw new Error("Attempt to apply ConflictMarker ["+this.name+"] to ["+target+"]")}}).c,Joose.Managed.Property.Requirement=new Joose.Proto.Class("Joose.Managed.Property.Requirement",{isa:Joose.Managed.Property,apply:function(target){if(!target.meta.hasMethod(this.name))throw new Error("Requirement ["+this.name+"], defined in ["+this.definedIn.definedIn.name+"] is not satisfied for class ["+target+"]")},unapply:function(from){}}).c,Joose.Managed.Property.Attribute=new Joose.Proto.Class("Joose.Managed.Property.Attribute",{isa:Joose.Managed.Property,slot:null,initialize:function(){Joose.Managed.Property.Attribute.superClass.initialize.apply(this,arguments),this.slot=this.name},apply:function(target){target.prototype[this.slot]=this.value},isAppliedTo:function(target){return target.prototype[this.slot]==this.value},unapply:function(from){if(!this.isAppliedTo(from))throw"Unapply of property ["+this.name+"] from ["+from+"] failed";delete from.prototype[this.slot]},clearValue:function(instance){delete instance[this.slot]},hasValue:function(instance){return instance.hasOwnProperty(this.slot)},getRawValueFrom:function(instance){return instance[this.slot]},setRawValueTo:function(instance,value){return instance[this.slot]=value,this}}).c,Joose.Managed.Property.MethodModifier=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier",{isa:Joose.Managed.Property,prepareWrapper:function(){throw"Abstract method [prepareWrapper] of "+this+" was called"},apply:function(target){var name=this.name,targetProto=target.prototype,isOwn=targetProto.hasOwnProperty(name),original=targetProto[name],superProto=target.meta.superClass.prototype,originalCall=isOwn?original:function(){return superProto[name].apply(this,arguments)},methodWrapper=this.prepareWrapper({name:name,modifier:this.value,isOwn:isOwn,originalCall:originalCall,superProto:superProto,target:target});isOwn&&(methodWrapper.__ORIGINAL__=original),methodWrapper.__CONTAIN__=this.value,(methodWrapper.__METHOD__=this).value.displayName=this.getDisplayName(target),methodWrapper.displayName="internal wrapper",targetProto[name]=methodWrapper},getDisplayName:function(target){return target.meta.name+"["+this.name+"]"},isAppliedTo:function(target){var targetCont=target.prototype[this.name];return targetCont&&targetCont.__CONTAIN__==this.value},unapply:function(from){var name=this.name,fromProto=from.prototype,original=fromProto[name].__ORIGINAL__;if(!this.isAppliedTo(from))throw"Unapply of method ["+name+"] from class ["+from+"] failed";original?fromProto[name]=original:delete fromProto[name]}}).c,Joose.Managed.Property.MethodModifier.Override=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Override",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(params){var modifier=params.modifier,originalCall=params.originalCall,superProto=params.superProto,superMetaConst=superProto.meta.constructor,isCallToProto=!(superMetaConst!=Joose.Proto.Class&&superMetaConst!=Joose.Proto.Object||params.isOwn&&originalCall.IS_OVERRIDE),original=originalCall;isCallToProto&&(original=function(){var beforeSUPER=this.SUPER;this.SUPER=superProto.SUPER;var res=originalCall.apply(this,arguments);return this.SUPER=beforeSUPER,res});function override(){var beforeSUPER=this.SUPER;this.SUPER=original;var res=modifier.apply(this,arguments);return this.SUPER=beforeSUPER,res}return override.IS_OVERRIDE=!0,override},getDisplayName:function(target){return target.meta.name+"[override "+this.name+"]"}}).c,Joose.Managed.Property.MethodModifier.Put=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Put",{isa:Joose.Managed.Property.MethodModifier.Override,prepareWrapper:function(params){if(params.isOwn)throw"Method ["+params.name+"] is applying over something ["+params.originalCall+"] in class ["+params.target+"]";return Joose.Managed.Property.MethodModifier.Put.superClass.prepareWrapper.call(this,params)},getDisplayName:function(target){return target.meta.name+"["+this.name+"]"}}).c,Joose.Managed.Property.MethodModifier.After=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.After",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(params){var modifier=params.modifier,originalCall=params.originalCall;return function(){var res=originalCall.apply(this,arguments);return modifier.apply(this,arguments),res}},getDisplayName:function(target){return target.meta.name+"[after "+this.name+"]"}}).c,Joose.Managed.Property.MethodModifier.Before=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Before",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(params){var modifier=params.modifier,originalCall=params.originalCall;return function(){return modifier.apply(this,arguments),originalCall.apply(this,arguments)}},getDisplayName:function(target){return target.meta.name+"[before "+this.name+"]"}}).c,Joose.Managed.Property.MethodModifier.Around=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Around",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(params){function bound(){return originalCall.apply(me,arguments)}var me,modifier=params.modifier,originalCall=params.originalCall;return function(){me=this;var boundArr=[bound];return boundArr.push.apply(boundArr,arguments),modifier.apply(this,boundArr)}},getDisplayName:function(target){return target.meta.name+"[around "+this.name+"]"}}).c,Joose.Managed.Property.MethodModifier.Augment=new Joose.Proto.Class("Joose.Managed.Property.MethodModifier.Augment",{isa:Joose.Managed.Property.MethodModifier,prepareWrapper:function(params){var AUGMENT=function(){for(var callstack=[],self=AUGMENT;callstack.push(self.IS_AUGMENT?self.__CONTAIN__:self),self=self.IS_AUGMENT&&(self.__ORIGINAL__||self.SUPER[self.methodName]););var beforeINNER=this.INNER;this.INNER=function(){var innerCall=callstack.pop();return innerCall?innerCall.apply(this,arguments):void 0};var res=this.INNER.apply(this,arguments);return this.INNER=beforeINNER,res};return AUGMENT.methodName=params.name,AUGMENT.SUPER=params.superProto,AUGMENT.IS_AUGMENT=!0,AUGMENT},getDisplayName:function(target){return target.meta.name+"[augment "+this.name+"]"}}).c,Joose.Managed.PropertySet=new Joose.Proto.Class("Joose.Managed.PropertySet",{isa:Joose.Managed.Property,properties:null,propertyMetaClass:Joose.Managed.Property,initialize:function(props){Joose.Managed.PropertySet.superClass.initialize.call(this,props),this.properties=props.properties||{}},addProperty:function(name,props){var metaClass=props.meta||this.propertyMetaClass;return delete props.meta,props.definedIn=this,props.name=name,this.properties[name]=new metaClass(props)},addPropertyObject:function(object){return this.properties[object.name]=object},removeProperty:function(name){var prop=this.properties[name];return delete this.properties[name],prop},haveProperty:function(name){return null!=this.properties[name]},haveOwnProperty:function(name){return this.haveProperty(name)&&this.properties.hasOwnProperty(name)},getProperty:function(name){return this.properties[name]},each:function(func,scope){Joose.O.each(this.properties,func,scope||this)},eachOwn:function(func,scope){Joose.O.eachOwn(this.properties,func,scope||this)},eachAll:function(func,scope){this.each(func,scope)},cloneProps:function(){var props=Joose.Managed.PropertySet.superClass.cloneProps.call(this);return props.propertyMetaClass=this.propertyMetaClass,props},clone:function(name){var clone=this.cleanClone(name);return clone.properties=Joose.O.copyOwn(this.properties),clone},cleanClone:function(name){var props=this.cloneProps();return props.name=name||props.name,new this.constructor(props)},alias:function(what){var props=this.properties;Joose.O.each(what,function(aliasName,originalName){var original=props[originalName];original&&this.addPropertyObject(original.clone(aliasName))},this)},exclude:function(what){var props=this.properties;Joose.A.each(what,function(name){delete props[name]})},beforeConsumedBy:function(){},flattenTo:function(target){var targetProps=target.properties;this.eachOwn(function(property,name){var targetProperty=targetProps[name];targetProperty instanceof Joose.Managed.Property.ConflictMarker||(targetProps.hasOwnProperty(name)&&null!=targetProperty?targetProperty!=property&&(target.removeProperty(name),target.addProperty(name,{meta:Joose.Managed.Property.ConflictMarker})):target.addPropertyObject(property))},this)},composeTo:function(target){this.eachOwn(function(property,name){target.haveOwnProperty(name)||target.addPropertyObject(property)})},composeFrom:function(){if(arguments.length){var flattening=this.cleanClone();Joose.A.each(arguments,function(arg){var isDescriptor=!(arg instanceof Joose.Managed.PropertySet),propSet=isDescriptor?arg.propertySet:arg;propSet.beforeConsumedBy(this,flattening),isDescriptor&&((arg.alias||arg.exclude)&&(propSet=propSet.clone()),arg.alias&&propSet.alias(arg.alias),arg.exclude&&propSet.exclude(arg.exclude)),propSet.flattenTo(flattening)},this),flattening.composeTo(this)}},preApply:function(target){this.eachOwn(function(property){property.preApply(target)})},apply:function(target){this.eachOwn(function(property){property.apply(target)})},unapply:function(from){this.eachOwn(function(property){property.unapply(from)})},postUnApply:function(target){this.eachOwn(function(property){property.postUnApply(target)})}}).c;var __ID__=1;Joose.Managed.PropertySet.Mutable=new Joose.Proto.Class("Joose.Managed.PropertySet.Mutable",{isa:Joose.Managed.PropertySet,ID:null,derivatives:null,opened:null,composedFrom:null,initialize:function(props){Joose.Managed.PropertySet.Mutable.superClass.initialize.call(this,props),this.opened=1,this.derivatives={},this.ID=__ID__++,this.composedFrom=[]},addComposeInfo:function(){this.ensureOpen(),Joose.A.each(arguments,function(arg){this.composedFrom.push(arg),(arg instanceof Joose.Managed.PropertySet?arg:arg.propertySet).derivatives[this.ID]=this},this)},removeComposeInfo:function(){this.ensureOpen(),Joose.A.each(arguments,function(arg){for(var i=0;i<this.composedFrom.length;){var propSet=this.composedFrom[i];arg==(propSet=propSet instanceof Joose.Managed.PropertySet?propSet:propSet.propertySet)?(delete propSet.derivatives[this.ID],this.composedFrom.splice(i,1)):i++}},this)},ensureOpen:function(){if(!this.opened)throw"Mutation of closed property set: ["+this.name+"]"},addProperty:function(name,props){return this.ensureOpen(),Joose.Managed.PropertySet.Mutable.superClass.addProperty.call(this,name,props)},addPropertyObject:function(object){return this.ensureOpen(),Joose.Managed.PropertySet.Mutable.superClass.addPropertyObject.call(this,object)},removeProperty:function(name){return this.ensureOpen(),Joose.Managed.PropertySet.Mutable.superClass.removeProperty.call(this,name)},composeFrom:function(){return this.ensureOpen(),Joose.Managed.PropertySet.Mutable.superClass.composeFrom.apply(this,this.composedFrom)},open:function(){this.opened++,1==this.opened&&(Joose.O.each(this.derivatives,function(propSet){propSet.open()}),this.deCompose())},close:function(){if(!this.opened)throw"Unmatched 'close' operation on property set: ["+this.name+"]";1==this.opened&&(this.reCompose(),Joose.O.each(this.derivatives,function(propSet){propSet.close()})),this.opened--},reCompose:function(){this.composeFrom()},deCompose:function(){this.eachOwn(function(property,name){property.definedIn!=this&&this.removeProperty(name)},this)}}).c,Joose.Managed.StemElement=function(){throw"Modules may not be instantiated."},Joose.Managed.StemElement.Attributes=new Joose.Proto.Class("Joose.Managed.StemElement.Attributes",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:Joose.Managed.Property.Attribute}).c,Joose.Managed.StemElement.Methods=new Joose.Proto.Class("Joose.Managed.StemElement.Methods",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:Joose.Managed.Property.MethodModifier.Put,preApply:function(){},postUnApply:function(){}}).c,Joose.Managed.StemElement.Requirements=new Joose.Proto.Class("Joose.Managed.StemElement.Requirements",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:Joose.Managed.Property.Requirement,alias:function(){},exclude:function(){},flattenTo:function(target){this.each(function(property,name){target.haveProperty(name)||target.addPropertyObject(property)})},composeTo:function(target){this.flattenTo(target)},preApply:function(){},postUnApply:function(){}}).c,Joose.Managed.StemElement.MethodModifiers=new Joose.Proto.Class("Joose.Managed.StemElement.MethodModifiers",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:null,addProperty:function(name,props){var metaClass=props.meta;delete props.meta,props.definedIn=this,props.name=name;var modifier=new metaClass(props),properties=this.properties;return properties[name]||(properties[name]=[]),properties[name].push(modifier),modifier},addPropertyObject:function(object){var name=object.name,properties=this.properties;return properties[name]||(properties[name]=[]),properties[name].push(object),object},removeProperty:function(name){if(this.haveProperty(name)){var properties=this.properties,modifier=properties[name].pop();return properties[name].length||Joose.Managed.StemElement.MethodModifiers.superClass.removeProperty.call(this,name),modifier}},alias:function(){},exclude:function(){},flattenTo:function(target){var targetProps=target.properties;this.each(function(modifiersArr,name){var targetModifiersArr=targetProps[name];null==targetModifiersArr&&(targetModifiersArr=targetProps[name]=[]),Joose.A.each(modifiersArr,function(modifier){Joose.A.exists(targetModifiersArr,modifier)||targetModifiersArr.push(modifier)})})},composeTo:function(target){this.flattenTo(target)},deCompose:function(){this.each(function(modifiersArr,name){for(var i=0;i<modifiersArr.length;)modifiersArr[i].definedIn!=this?modifiersArr.splice(i,1):i++})},preApply:function(target){},postUnApply:function(target){},apply:function(target){this.each(function(modifiersArr,name){Joose.A.each(modifiersArr,function(modifier){modifier.apply(target)})})},unapply:function(from){this.each(function(modifiersArr,name){for(var i=modifiersArr.length-1;0<=i;i--)modifiersArr[i].unapply(from)})}}).c,Joose.Managed.PropertySet.Composition=new Joose.Proto.Class("Joose.Managed.PropertySet.Composition",{isa:Joose.Managed.PropertySet.Mutable,propertyMetaClass:Joose.Managed.PropertySet.Mutable,processOrder:null,each:function(func,scope){var props=this.properties;scope=scope||this;Joose.A.each(this.processOrder,function(name){func.call(scope,props[name],name)})},eachR:function(func,scope){var props=this.properties;scope=scope||this;Joose.A.eachR(this.processOrder,function(name){func.call(scope,props[name],name)})},clone:function(name){var clone=this.cleanClone(name);return this.each(function(property){clone.addPropertyObject(property.clone())}),clone},alias:function(what){this.each(function(property){property.alias(what)})},exclude:function(what){this.each(function(property){property.exclude(what)})},flattenTo:function(target){var targetProps=target.properties;this.each(function(property,name){var subTarget=targetProps[name]||target.addProperty(name,{meta:property.constructor});property.flattenTo(subTarget)})},composeTo:function(target){var targetProps=target.properties;this.each(function(property,name){var subTarget=targetProps[name]||target.addProperty(name,{meta:property.constructor});property.composeTo(subTarget)})},deCompose:function(){this.eachR(function(property){property.open()}),Joose.Managed.PropertySet.Composition.superClass.deCompose.call(this)},reCompose:function(){Joose.Managed.PropertySet.Composition.superClass.reCompose.call(this),this.each(function(property){property.close()})},unapply:function(from){this.eachR(function(property){property.unapply(from)})}}).c,Joose.Managed.Stem=new Joose.Proto.Class("Joose.Managed.Stem",{isa:Joose.Managed.PropertySet.Composition,targetMeta:null,attributesMC:Joose.Managed.StemElement.Attributes,methodsMC:Joose.Managed.StemElement.Methods,requirementsMC:Joose.Managed.StemElement.Requirements,methodsModifiersMC:Joose.Managed.StemElement.MethodModifiers,processOrder:["attributes","methods","requirements","methodsModifiers"],initialize:function(props){Joose.Managed.Stem.superClass.initialize.call(this,props);var targetMeta=this.targetMeta;this.addProperty("attributes",{meta:this.attributesMC,properties:targetMeta?targetMeta.attributes:{}}),this.addProperty("methods",{meta:this.methodsMC,properties:targetMeta?targetMeta.methods:{}}),this.addProperty("requirements",{meta:this.requirementsMC}),this.addProperty("methodsModifiers",{meta:this.methodsModifiersMC})},reCompose:function(){var c=this.targetMeta.c;this.preApply(c),Joose.Managed.Stem.superClass.reCompose.call(this),this.apply(c)},deCompose:function(){var c=this.targetMeta.c;this.unapply(c),Joose.Managed.Stem.superClass.deCompose.call(this),this.postUnApply(c)}}).c,Joose.Managed.Builder=new Joose.Proto.Class("Joose.Managed.Builder",{targetMeta:null,_buildStart:function(targetMeta,props){targetMeta.stem.open(),Joose.A.each(["trait","traits","removeTrait","removeTraits","does","doesnot","doesnt"],function(builder){props[builder]&&(this[builder](targetMeta,props[builder]),delete props[builder])},this)},_extend:function(props){if(!Joose.O.isEmpty(props)){var targetMeta=this.targetMeta;this._buildStart(targetMeta,props),Joose.O.eachOwn(props,function(value,name){var handler=this[name];if(!handler)throw new Error("Unknown builder ["+name+"] was used during extending of ["+targetMeta.c+"]");handler.call(this,targetMeta,value)},this),this._buildComplete(targetMeta,props)}},_buildComplete:function(targetMeta,props){targetMeta.stem.close()},methods:function(targetMeta,info){Joose.O.eachOwn(info,function(value,name){targetMeta.addMethod(name,value)})},removeMethods:function(targetMeta,info){Joose.A.each(info,function(name){targetMeta.removeMethod(name)})},have:function(targetMeta,info){Joose.O.eachOwn(info,function(value,name){targetMeta.addAttribute(name,value)})},havenot:function(targetMeta,info){Joose.A.each(info,function(name){targetMeta.removeAttribute(name)})},havent:function(targetMeta,info){this.havenot(targetMeta,info)},after:function(targetMeta,info){Joose.O.each(info,function(value,name){targetMeta.addMethodModifier(name,value,Joose.Managed.Property.MethodModifier.After)})},before:function(targetMeta,info){Joose.O.each(info,function(value,name){targetMeta.addMethodModifier(name,value,Joose.Managed.Property.MethodModifier.Before)})},override:function(targetMeta,info){Joose.O.each(info,function(value,name){targetMeta.addMethodModifier(name,value,Joose.Managed.Property.MethodModifier.Override)})},around:function(targetMeta,info){Joose.O.each(info,function(value,name){targetMeta.addMethodModifier(name,value,Joose.Managed.Property.MethodModifier.Around)})},augment:function(targetMeta,info){Joose.O.each(info,function(value,name){targetMeta.addMethodModifier(name,value,Joose.Managed.Property.MethodModifier.Augment)})},removeModifier:function(targetMeta,info){Joose.A.each(info,function(name){targetMeta.removeMethodModifier(name)})},does:function(targetMeta,info){Joose.A.each(Joose.O.wantArray(info),function(desc){targetMeta.addRole(desc)})},doesnot:function(targetMeta,info){Joose.A.each(Joose.O.wantArray(info),function(desc){targetMeta.removeRole(desc)})},doesnt:function(targetMeta,info){this.doesnot(targetMeta,info)},trait:function(){this.traits.apply(this,arguments)},traits:function(targetMeta,info){if(!targetMeta.firstPass){if(!targetMeta.meta.isDetached)throw"Can't apply trait to not detached class";targetMeta.meta.extend({does:info})}},removeTrait:function(){this.removeTraits.apply(this,arguments)},removeTraits:function(targetMeta,info){if(!targetMeta.meta.isDetached)throw"Can't remove trait from not detached class";targetMeta.meta.extend({doesnot:info})},name:function(targetMeta,name){targetMeta.name=name}}).c,Joose.Managed.Class=new Joose.Proto.Class("Joose.Managed.Class",{isa:Joose.Proto.Class,stem:null,stemClass:Joose.Managed.Stem,stemClassCreated:!1,builder:null,builderClass:Joose.Managed.Builder,builderClassCreated:!1,isDetached:!1,firstPass:!0,skipTraitsAnchor:{},BUILD:function(){var sup=Joose.Managed.Class.superClass.BUILD.apply(this,arguments),props=sup.__extend__,traits=Joose.O.wantArray(props.trait||props.traits||[]);return delete props.trait,delete props.traits,Joose.A.each(Joose.O.wantArray(props.does||[]),function(arg){var role=arg.meta instanceof Joose.Managed.Class?arg:arg.role;role.meta.meta.isDetached&&traits.push(role.meta.constructor)}),traits.length&&(props.traits=traits),sup},initInstance:function(instance,props){Joose.O.each(this.attributes,function(attribute,name){attribute instanceof Joose.Managed.Attribute?attribute.initFromConfig(instance,props):props.hasOwnProperty(name)&&(instance[name]=props[name])})},defaultConstructor:function(){return function(skipTraitsAnchor,params){var thisMeta=this.meta,skipTraits=skipTraitsAnchor==thisMeta.skipTraitsAnchor,BUILD=this.BUILD,props=BUILD&&BUILD.apply(this,skipTraits?params:arguments)||(skipTraits?params[0]:skipTraitsAnchor)||{},extend=props.__extend__||props,traits=extend.trait||extend.traits;if(!traits&&!extend.detached||(delete extend.trait,delete extend.traits,delete extend.detached,skipTraits))return thisMeta.initInstance(this,props),thisMeta.hasMethod("initialize")&&this.initialize(props)||this;var meta=thisMeta.subClass({does:traits||[]},thisMeta.name).meta;return meta.isDetached=!0,meta.instantiate(thisMeta.skipTraitsAnchor,arguments)}},finalize:function(extend){Joose.Managed.Class.superClass.finalize.call(this,extend),this.stem.close(),this.afterMutate()},processStem:function(){Joose.Managed.Class.superClass.processStem.call(this),this.builder=new this.builderClass({targetMeta:this}),this.stem=new this.stemClass({name:this.name,targetMeta:this});var builderClass=this.getClassInAttribute("builderClass");builderClass&&(this.builderClassCreated=!0,this.addAttribute("builderClass",this.subClassOf(builderClass)));var stemClass=this.getClassInAttribute("stemClass");stemClass&&(this.stemClassCreated=!0,this.addAttribute("stemClass",this.subClassOf(stemClass)))},extend:function(props){props.builder&&(this.getBuilderTarget().meta.extend(props.builder),delete props.builder),props.stem&&(this.getStemTarget().meta.extend(props.stem),delete props.stem),this.builder._extend(props),this.firstPass=!1,this.stem.opened||this.afterMutate()},getBuilderTarget:function(){var builderClass=this.getClassInAttribute("builderClass");if(!builderClass)throw"Attempt to extend a builder on non-meta class";return builderClass},getStemTarget:function(){var stemClass=this.getClassInAttribute("stemClass");if(!stemClass)throw"Attempt to extend a stem on non-meta class";return stemClass},getClassInAttribute:function(attributeName){var attrClass=this.getAttribute(attributeName);return attrClass instanceof Joose.Managed.Property.Attribute&&(attrClass=attrClass.value),attrClass},addMethodModifier:function(name,func,type){var props={};return props.init=func,props.meta=type,this.stem.properties.methodsModifiers.addProperty(name,props)},removeMethodModifier:function(name){return this.stem.properties.methodsModifiers.removeProperty(name)},addMethod:function(name,func,props){return(props=props||{}).init=func,this.stem.properties.methods.addProperty(name,props)},addAttribute:function(name,init,props){return(props=props||{}).init=init,this.stem.properties.attributes.addProperty(name,props)},removeMethod:function(name){return this.stem.properties.methods.removeProperty(name)},removeAttribute:function(name){return this.stem.properties.attributes.removeProperty(name)},hasMethod:function(name){return this.stem.properties.methods.haveProperty(name)},hasAttribute:function(name){return this.stem.properties.attributes.haveProperty(name)},hasMethodModifiersFor:function(name){return this.stem.properties.methodsModifiers.haveProperty(name)},hasOwnMethod:function(name){return this.stem.properties.methods.haveOwnProperty(name)},hasOwnAttribute:function(name){return this.stem.properties.attributes.haveOwnProperty(name)},getMethod:function(name){return this.stem.properties.methods.getProperty(name)},getAttribute:function(name){return this.stem.properties.attributes.getProperty(name)},eachRole:function(roles,func,scope){Joose.A.each(roles,function(arg,index){var role=arg.meta instanceof Joose.Managed.Class?arg:arg.role;func.call(scope||this,arg,role,index)},this)},addRole:function(){this.eachRole(arguments,function(arg,role){this.beforeRoleAdd(role);var desc=arg;role!=arg?(desc.propertySet=role.meta.stem,delete desc.role):desc=desc.meta.stem,this.stem.addComposeInfo(desc)},this)},beforeRoleAdd:function(role){var roleMeta=role.meta;roleMeta.builderClassCreated&&this.getBuilderTarget().meta.extend({does:[roleMeta.getBuilderTarget()]}),roleMeta.stemClassCreated&&this.getStemTarget().meta.extend({does:[roleMeta.getStemTarget()]}),roleMeta.meta.isDetached&&!this.firstPass&&this.builder.traits(this,roleMeta.constructor)},beforeRoleRemove:function(role){var roleMeta=role.meta;roleMeta.builderClassCreated&&this.getBuilderTarget().meta.extend({doesnt:[roleMeta.getBuilderTarget()]}),roleMeta.stemClassCreated&&this.getStemTarget().meta.extend({doesnt:[roleMeta.getStemTarget()]}),roleMeta.meta.isDetached&&!this.firstPass&&this.builder.removeTraits(this,roleMeta.constructor)},removeRole:function(){this.eachRole(arguments,function(arg,role){this.beforeRoleRemove(role),this.stem.removeComposeInfo(role.meta.stem)},this)},getRoles:function(){return Joose.A.map(this.stem.composedFrom,function(composeDesc){return composeDesc instanceof Joose.Managed.PropertySet?composeDesc.targetMeta.c:composeDesc.propertySet})},does:function(role){for(var myRoles=this.getRoles(),i=0;i<myRoles.length;i++)if(role==myRoles[i])return!0;for(i=0;i<myRoles.length;i++)if(myRoles[i].meta.does(role))return!0;var superMeta=this.superClass.meta;return!!(this.superClass!=Joose.Proto.Empty&&superMeta&&superMeta.meta&&superMeta.meta.hasMethod("does"))&&superMeta.does(role)},getMethods:function(){return this.stem.properties.methods},getAttributes:function(){return this.stem.properties.attributes},afterMutate:function(){},getCurrentMethod:function(){for(var wrapper=arguments.callee.caller,count=0;wrapper&&count<5;wrapper=wrapper.caller,count++)if(wrapper.__METHOD__)return wrapper.__METHOD__;return null}}).c,Joose.Managed.Role=new Joose.Managed.Class("Joose.Managed.Role",{isa:Joose.Managed.Class,have:{defaultSuperClass:Joose.Proto.Empty,builderRole:null,stemRole:null},methods:{defaultConstructor:function(){return function(){throw new Error("Roles cant be instantiated")}},processSuperClass:function(){if(this.superClass!=this.defaultSuperClass)throw new Error("Roles can't inherit from anything")},getBuilderTarget:function(){return this.builderRole||(this.builderRole=(new this.constructor).c,this.builderClassCreated=!0),this.builderRole},getStemTarget:function(){return this.stemRole||(this.stemRole=(new this.constructor).c,this.stemClassCreated=!0),this.stemRole},addRequirement:function(methodName){this.stem.properties.requirements.addProperty(methodName,{})}},stem:{methods:{apply:function(){},unapply:function(){}}},builder:{methods:{requires:function(targetClassMeta,info){Joose.A.each(Joose.O.wantArray(info),function(methodName){targetClassMeta.addRequirement(methodName)},this)}}}}).c,Joose.Managed.Attribute=new Joose.Managed.Class("Joose.Managed.Attribute",{isa:Joose.Managed.Property.Attribute,have:{is:null,builder:null,isPrivate:!1,role:null,publicName:null,setterName:null,getterName:null,readable:!1,writeable:!1,hasGetter:!1,hasSetter:!1,required:!1,canInlineSetRaw:!0,canInlineGetRaw:!0},after:{initialize:function(){var name=this.name;this.publicName=name.replace(/^_+/,""),this.slot=this.isPrivate?"$"+name:name,this.setterName=this.setterName||this.getSetterName(),this.getterName=this.getterName||this.getGetterName(),this.readable=this.hasGetter=/^r/i.test(this.is),this.writeable=this.hasSetter=/^.w/i.test(this.is)}},override:{computeValue:function(){var init=this.init;!Joose.O.isClass(init)&&Joose.O.isFunction(init)||this.SUPER()},preApply:function(targetClass){targetClass.meta.extend({methods:this.getAccessorsFor(targetClass)})},postUnApply:function(from){from.meta.extend({removeMethods:this.getAccessorsFrom(from)})}},methods:{getAccessorsFor:function(targetClass){var targetMeta=targetClass.meta,setterName=this.setterName,getterName=this.getterName,methods={};return this.hasSetter&&!targetMeta.hasMethod(setterName)&&(methods[setterName]=this.getSetter(),methods[setterName].ACCESSOR_FROM=this),this.hasGetter&&!targetMeta.hasMethod(getterName)&&(methods[getterName]=this.getGetter(),methods[getterName].ACCESSOR_FROM=this),methods},getAccessorsFrom:function(from){var targetMeta=from.meta,setterName=this.setterName,getterName=this.getterName,setter=this.hasSetter&&targetMeta.getMethod(setterName),getter=this.hasGetter&&targetMeta.getMethod(getterName),removeMethods=[];return setter&&setter.value.ACCESSOR_FROM==this&&removeMethods.push(setterName),getter&&getter.value.ACCESSOR_FROM==this&&removeMethods.push(getterName),removeMethods},getGetterName:function(){return"get"+Joose.S.uppercaseFirst(this.publicName)},getSetterName:function(){return"set"+Joose.S.uppercaseFirst(this.publicName)},getSetter:function(){var me=this,slot=me.slot;return me.canInlineSetRaw?function(value){return this[slot]=value,this}:function(){return me.setRawValueTo.apply(this,arguments)}},getGetter:function(){var me=this,slot=me.slot;return me.canInlineGetRaw?function(value){return this[slot]}:function(){return me.getRawValueFrom.apply(this,arguments)}},getValueFrom:function(instance){var getterName=this.getterName;return this.readable&&instance.meta.hasMethod(getterName)?instance[getterName]():this.getRawValueFrom(instance)},setValueTo:function(instance,value){var setterName=this.setterName;this.writeable&&instance.meta.hasMethod(setterName)?instance[setterName](value):this.setRawValueTo(instance,value)},initFromConfig:function(instance,config){var value,name=this.name,isSet=!1;if(config.hasOwnProperty(name))value=config[name],isSet=!0;else{var init=this.init;Joose.O.isFunction(init)&&!Joose.O.isClass(init)?(value=init.call(instance,config,name),isSet=!0):this.builder&&(value=instance[this.builder.replace(/^this\./,"")](config,name),isSet=!0)}if(isSet)this.setRawValueTo(instance,value);else if(this.required)throw new Error("Required attribute ["+name+"] is missed during initialization of "+instance)}}}).c,Joose.Managed.Attribute.Builder=new Joose.Managed.Role("Joose.Managed.Attribute.Builder",{have:{defaultAttributeClass:Joose.Managed.Attribute},builder:{methods:{has:function(targetClassMeta,info){Joose.O.eachOwn(info,function(props,name){"object"==typeof props&&null!=props&&props.constructor!=/ /.constructor||(props={init:props}),props.meta=props.meta||targetClassMeta.defaultAttributeClass,/^__/.test(name)&&(name=name.replace(/^_+/,""),props.isPrivate=!0),targetClassMeta.addAttribute(name,props.init,props)},this)},hasnot:function(targetClassMeta,info){this.havenot(targetClassMeta,info)},hasnt:function(targetClassMeta,info){this.hasnot(targetClassMeta,info)}}}}).c,Joose.Managed.My=new Joose.Managed.Role("Joose.Managed.My",{have:{myClass:null,needToReAlias:!1},methods:{createMy:function(extend){this.meta;var isRole=this instanceof Joose.Managed.Role,myExtend=extend.my||{};delete extend.my;var superClassMy=this.superClass.meta.myClass;isRole||myExtend.isa||!superClassMy||(myExtend.isa=superClassMy),myExtend.meta||myExtend.isa||(myExtend.meta=this.constructor),myExtend.name=this.name+".my";var createdClass=this.myClass=Class(myExtend),c=this.c;c.prototype.my=c.my=isRole?createdClass:new createdClass({HOST:c}),this.needToReAlias=!0},aliasStaticMethods:function(){this.needToReAlias=!1;var c=this.c,myProto=this.myClass.prototype;Joose.O.eachOwn(c,function(property,name){property.IS_ALIAS&&delete c[name]}),this.myClass.meta.stem.properties.methods.each(function(method,name){c[name]||((c[name]=function(){return myProto[name].apply(c.my,arguments)}).IS_ALIAS=!0)})}},override:{extend:function(props){var myClass=this.myClass;!myClass&&this.superClass.meta.myClass&&this.createMy(props),props.my&&(myClass?(this.needToReAlias=!0,myClass.meta.extend(props.my),delete props.my):this.createMy(props)),this.SUPER(props),!this.needToReAlias||this instanceof Joose.Managed.Role||this.aliasStaticMethods()}},before:{addRole:function(){var myStem;Joose.A.each(arguments,function(arg){if(!arg)throw new Error("Attempt to consume an undefined Role into ["+this.name+"]");var role=arg.meta instanceof Joose.Managed.Class?arg:arg.role;if(role.meta.meta.hasAttribute("myClass")&&role.meta.myClass){if(!this.myClass)return void this.createMy({my:{does:role.meta.myClass}});(myStem=this.myClass.meta.stem).opened||myStem.open(),myStem.addComposeInfo(role.my.meta.stem)}},this),myStem&&(myStem.close(),this.needToReAlias=!0)},removeRole:function(){if(this.myClass){var myStem=this.myClass.meta.stem;myStem.open(),Joose.A.each(arguments,function(role){role.meta.meta.hasAttribute("myClass")&&role.meta.myClass&&(myStem.removeComposeInfo(role.my.meta.stem),this.needToReAlias=!0)},this),myStem.close()}}}}).c,Joose.Namespace=Joose.stub(),Joose.Namespace.Able=new Joose.Managed.Role("Joose.Namespace.Able",{have:{bodyFunc:null},before:{extend:function(extend){extend.body&&(this.bodyFunc=extend.body,delete extend.body)}},after:{afterMutate:function(){var bodyFunc=this.bodyFunc;delete this.bodyFunc,bodyFunc&&Joose.Namespace.Manager.my.executeIn(this.c,bodyFunc)}}}).c,Joose.Managed.Bootstrap=new Joose.Managed.Role("Joose.Managed.Bootstrap",{does:[Joose.Namespace.Able,Joose.Managed.My,Joose.Managed.Attribute.Builder]}).c,Joose.Meta=Joose.stub(),Joose.Meta.Object=new Joose.Proto.Class("Joose.Meta.Object",{isa:Joose.Proto.Object}).c,Joose.Meta.Class=new Joose.Managed.Class("Joose.Meta.Class",{isa:Joose.Managed.Class,does:Joose.Managed.Bootstrap,have:{defaultSuperClass:Joose.Meta.Object}}).c,Joose.Meta.Role=new Joose.Meta.Class("Joose.Meta.Role",{isa:Joose.Managed.Role,does:Joose.Managed.Bootstrap}).c,Joose.Namespace.Keeper=new Joose.Meta.Class("Joose.Namespace.Keeper",{isa:Joose.Meta.Class,have:{externalConstructor:null},methods:{defaultConstructor:function(){return function(){var thisMeta=arguments.callee.meta;if(thisMeta instanceof Joose.Namespace.Keeper)throw new Error("Module ["+thisMeta.c+"] may not be instantiated. Forgot to 'use' the class with the same name?");var externalConstructor=thisMeta.externalConstructor;if("function"==typeof externalConstructor)return externalConstructor.meta=thisMeta,externalConstructor.apply(this,arguments);throw"NamespaceKeeper of ["+thisMeta.name+"] was planted incorrectly."}},plant:function(withClass){var keeper=this.c;keeper.meta=withClass.meta,(keeper.meta.c=keeper).meta.externalConstructor=withClass}}}).c,Joose.Namespace.Manager=new Joose.Managed.Class("Joose.Namespace.Manager",{have:{current:null},methods:{initialize:function(){this.current=[Joose.top]},getCurrent:function(){return this.current[0]},executeIn:function(ns,func){var current=this.current;current.unshift(ns);var res=func.call(ns,ns);return current.shift(),res},earlyCreate:function(name,metaClass,props){return props.constructorOnly=!0,new metaClass(name,props).c},create:function(nsName,metaClass,extend){if(!nsName)return new metaClass(nsName,extend).c;var me=this;if(/^\./.test(nsName))return this.executeIn(Joose.top,function(){return me.create(nsName.replace(/^\./,""),metaClass,extend)});for(var props=extend||{},parts=Joose.S.saneSplit(nsName,"."),object=this.getCurrent(),soFar=object==Joose.top?[]:Joose.S.saneSplit(object.meta.name,"."),i=0;i<parts.length;i++){var part=parts[i],isLast=i==parts.length-1;if("meta"==part||"my"==part||!part)throw"Module name ["+nsName+"] may not include a part called 'meta' or 'my' or empty part.";var cur=object[part];soFar.push(part);var nsKeeper,soFarName=soFar.join("."),needFinalize=!1;if(void 0===cur)isLast?(nsKeeper=this.earlyCreate(soFarName,metaClass,props),needFinalize=!0):nsKeeper=new Joose.Namespace.Keeper(soFarName).c,cur=object[part]=nsKeeper;else if(isLast&&cur&&cur.meta){var currentMeta=cur.meta;if(metaClass==Joose.Namespace.Keeper)currentMeta.extend(props);else if(currentMeta instanceof Joose.Namespace.Keeper)currentMeta.plant(this.earlyCreate(soFarName,metaClass,props)),needFinalize=!0;else if(!Joose.C.ignoreRepeatedDeclarations)throw new Error("Double declaration of ["+soFarName+"]")}else if(isLast&&!(cur&&cur.meta&&cur.meta.meta))throw"Trying to setup module "+soFarName+" failed. There is already something: "+cur;isLast&&this.prepareMeta(cur.meta),needFinalize&&cur.meta.construct(props),object=cur}return object},prepareMeta:function(){},prepareProperties:function(name,props,defaultMeta,callback){var meta;return name&&"string"!=typeof name&&(props=name,name=null),props&&props.meta&&(meta=props.meta,delete props.meta),meta=meta||(props&&"function"==typeof props.isa&&props.isa.meta?props.isa.meta.constructor:defaultMeta),callback.call(this,name,meta,props)},getDefaultHelperFor:function(metaClass){var me=this;return function(name,props){return me.prepareProperties(name,props,metaClass,function(name,meta,props){return me.create(name,meta,props)})}},register:function(helperName,metaClass,func){var me=this;if(this.meta.hasMethod(helperName)){function helper(){return me[helperName].apply(me,arguments)}Joose.top[helperName]||(Joose.top[helperName]=helper),Joose[helperName]||(Joose[helperName]=helper),Joose.is_NodeJS&&"undefined"!=typeof exports&&(exports[helperName]=helper)}else{var methods={};methods[helperName]=func||this.getDefaultHelperFor(metaClass),this.meta.extend({methods:methods}),this.register(helperName)}},Module:function(name,props){return this.prepareProperties(name,props,Joose.Namespace.Keeper,function(name,meta,props){return"function"==typeof props&&(props={body:props}),this.create(name,meta,props)})}}}).c,Joose.Namespace.Manager.my=new Joose.Namespace.Manager,Joose.Namespace.Manager.my.register("Class",Joose.Meta.Class),Joose.Namespace.Manager.my.register("Role",Joose.Meta.Role),Joose.Namespace.Manager.my.register("Module");var Class=Joose.Class,Role=Joose.Role;Role("Joose.Attribute.Delegate",{have:{handles:null},override:{eachDelegate:function(handles,func,scope){return"string"==typeof handles?func.call(scope,handles,handles):handles instanceof Array?Joose.A.each(handles,function(delegateTo){func.call(scope,delegateTo,delegateTo)}):void(handles===Object(handles)&&Joose.O.eachOwn(handles,function(delegateTo,handleAs){func.call(scope,handleAs,delegateTo)}))},getAccessorsFor:function(targetClass){var targetMeta=targetClass.meta,methods=this.SUPER(targetClass),me=this;return this.eachDelegate(this.handles,function(handleAs,delegateTo){targetMeta.hasMethod(handleAs)||((methods[handleAs]=function(){var attrValue=me.getValueFrom(this);return attrValue[delegateTo].apply(attrValue,arguments)}).ACCESSOR_FROM=me)}),methods},getAccessorsFrom:function(from){var methods=this.SUPER(from),me=this,targetMeta=from.meta;return this.eachDelegate(this.handles,function(handleAs){var handler=targetMeta.getMethod(handleAs);handler&&handler.value.ACCESSOR_FROM==me&&methods.push(handleAs)}),methods}}}),Role("Joose.Attribute.Trigger",{have:{trigger:null},after:{initialize:function(){if(this.trigger){if(!this.writeable)throw new Error("Can't use `trigger` for read-only attributes");this.hasSetter=!0}}},override:{getSetter:function(){var original=this.SUPER(),trigger=this.trigger;if(!trigger)return original;var me=this,init=Joose.O.isFunction(me.init)?null:me.init;return function(){var oldValue=me.hasValue(this)?me.getValueFrom(this):init,res=original.apply(this,arguments);return trigger.call(this,me.getValueFrom(this),oldValue),res}}}}),Role("Joose.Attribute.Lazy",{have:{lazy:null},before:{computeValue:function(){"function"==typeof this.init&&this.lazy&&(this.lazy=this.init,delete this.init)}},after:{initialize:function(){this.lazy&&(this.readable=this.hasGetter=!0)}},override:{getGetter:function(){var original=this.SUPER(),lazy=this.lazy;if(!lazy)return original;var me=this;return function(){if(!me.hasValue(this)){var initializer="function"==typeof lazy?lazy:this[lazy.replace(/^this\./,"")];me.setValueTo(this,initializer.apply(this,arguments))}return original.call(this)}}}}),Role("Joose.Attribute.Accessor.Combined",{have:{isCombined:!1},after:{initialize:function(){this.isCombined=this.isCombined||/..c/i.test(this.is),this.isCombined&&(this.slot="$$"+this.name,this.hasGetter=!0,this.hasSetter=!1,this.setterName=this.getterName=this.publicName)}},override:{getGetter:function(){var getter=this.SUPER();if(!this.isCombined)return getter;var setter=this.getSetter(),me=this;return function(){if(!arguments.length){if(me.readable)return getter.call(this);throw new Error("Call to getter of unreadable attribute: ["+me.name+"]")}if(me.writeable)return setter.apply(this,arguments);throw new Error("Call to setter of read-only attribute: ["+me.name+"]")}}}}),Joose.Managed.Attribute.meta.extend({does:[Joose.Attribute.Delegate,Joose.Attribute.Trigger,Joose.Attribute.Lazy,Joose.Attribute.Accessor.Combined]}),Role("Joose.Meta.Singleton",{has:{forceInstance:Joose.I.Object,instance:null},override:{defaultConstructor:function(){var meta=this,previous=this.SUPER();return this.adaptConstructor(previous),function(forceInstance,params){if(forceInstance==meta.forceInstance)return previous.apply(this,params)||this;var instance=meta.instance;return instance=instance||(meta.instance=new meta.c(meta.forceInstance,arguments)),meta.hasMethod("configure")&&instance.configure.apply(instance,arguments),instance}}}}),Joose.Namespace.Manager.my.register("Singleton",Class({isa:Joose.Meta.Class,meta:Joose.Meta.Class,does:Joose.Meta.Singleton}))}(),Joose.C.ignoreRepeatedDeclarations=!0,Class("JooseX.Observable.Event",{has:{name:{required:!0},args:{required:!0},source:{required:!0},splat:null,current:null,bubbling:!0},methods:{stopPropagation:function(){this.bubbling=!1}}}),Class("JooseX.Observable.Listener",{has:{channel:{required:!0},eventName:{required:!0},func:{required:!0},scope:null,single:!1,buffer:null,bufferMax:null,bufferStartedAt:null,bufferTimeout:null,delayTimeout:null,delay:null},methods:{activate:function(event,args){var me=this;if(null!=me.buffer){if(null!=me.bufferMax)if(me.bufferStartedAt){if(new Date-me.bufferStartedAt>me.bufferMax)return}else me.bufferStartedAt=new Date;return me.bufferTimeout&&clearTimeout(me.bufferTimeout),void(me.bufferTimeout=setTimeout(function(){delete me.bufferStartedAt,delete me.bufferTimeout,me.doActivate(event,args)},me.buffer))}if(null==me.delay)return me.doActivate(event,args);me.delayTimeout=setTimeout(function(){delete me.delayTimeout,me.doActivate(event,args)},me.delay)},doActivate:function(event,args){return this.single&&this.remove(),!1!==this.func.apply(this.scope||event.source,[event].concat(args))},cancel:function(){this.buffer&&(clearTimeout(this.bufferTimeout),delete this.bufferTimeout,delete this.bufferStartedAt),this.delay&&clearTimeout(this.delayTimeout)},remove:function(){this.channel.removeListener(this)}}}),Class("JooseX.Observable.Channel",{has:{channels:Joose.I.Object,listeners:Joose.I.Object},methods:{destroy:function(){Joose.O.each(this.channels,function(channel,name){channel.purgeListeners()}),this.channels=null,Joose.O.each(this.listeners,function(value,name){this.listeners[name]=null},this),this.listeners=null},getListenersFor:function(segments,name,activators){var listeners=this.listeners;if(listeners["**"]){var splat=segments.concat(name);Joose.A.each(listeners["**"],function(listener){activators.push({listener:listener,splat:splat})})}if(segments.length){var next=this.getSingleChannel(segments.shift(),!0);next&&next.getListenersFor(segments,name,activators)}else listeners["*"]&&Joose.A.each(listeners["*"],function(listener){activators.push({listener:listener,splat:name})}),listeners[name]&&Joose.A.each(listeners[name],function(listener){activators.push({listener:listener})})},hasListenerFor:function(segments,name){var listeners=this.listeners;if(listeners["**"]&&listeners["**"].length)return!0;if(segments.length){var next=this.getSingleChannel(segments.shift(),!0);if(next)return next.hasListenerFor(segments,name)}else{if(listeners["*"]&&listeners["*"].length)return!0;if(listeners[name]&&listeners[name].length)return!0}return!1},addListener:function(listener){var eventName=listener.eventName,listeners=this.listeners;listeners[eventName]=listeners[eventName]||[],listeners[eventName].push(listener)},removeListener:function(listenerToRemove){if(this.listeners){var eventListeners=this.listeners[listenerToRemove.eventName];eventListeners&&Joose.A.each(eventListeners,function(listener,index){if(listener==listenerToRemove)return eventListeners.splice(index,1),!1})}},removeListenerByHandler:function(eventName,func,scope){var eventListeners=this.listeners[eventName];eventListeners&&Joose.A.each(eventListeners,function(listener,index){if(listener.func==func&&listener.scope==scope)return eventListeners.splice(index,1),!1})},getSingleChannel:function(name,doNotCreate){var channels=this.channels;return channels[name]?channels[name]:doNotCreate?null:channels[name]=new JooseX.Observable.Channel},getChannel:function(segments,doNotCreate){if(!segments.length)return this;var next=this.getSingleChannel(segments.shift(),doNotCreate);return doNotCreate&&!next?null:next.getChannel(segments,doNotCreate)}}}),Role("JooseX.Observable",{VERSION:.04,has:{rootChannel:{is:"rw",init:function(){return new JooseX.Observable.Channel}},suspendCounter:0},methods:{getBubbleTarget:function(){},parseEventPath:function(path){var channels=path.split("/"),eventName=channels.pop();return channels.length&&!channels[0]&&channels.shift(),{channels:channels,eventName:eventName}},on:function(path,func,scope,options){if(!func)throw"Not valid listener function provided when subsribing on event: "+path;var parsed=this.parseEventPath(path),channel=this.getRootChannel().getChannel(parsed.channels),listener=new JooseX.Observable.Listener(Joose.O.extend(options||{},{channel:channel,eventName:parsed.eventName,func:func,scope:scope}));return channel.addListener(listener),listener},un:function(path,func,scope){if(path instanceof JooseX.Observable.Listener)path.remove();else{var parsed=this.parseEventPath(path),channel=this.getRootChannel().getChannel(parsed.channels,!0);channel&&channel.removeListenerByHandler(parsed.eventName,func,scope)}},emit:function(){return this.fireEvent.apply(this,arguments)},fireEvent:function(path){if(!this.suspendCounter){var args=Array.prototype.slice.call(arguments,1),event=new JooseX.Observable.Event({name:path,args:args,source:this});return this.propagateEvent(event,path,args)}},propagateEvent:function(event,path,args){if(!this.suspendCounter){var parsed=this.parseEventPath(path),eventName=parsed.eventName;if("*"==!eventName||"**"==eventName)throw new Error("Can't fire an empty event or event with `*`, `**` names ");var activators=[];this.getRootChannel().getListenersFor(parsed.channels,eventName,activators);var res=!0;if(event.current=this,activators.length&&Joose.A.each(activators,function(activator){event.splat=activator.splat,res=!1!==activator.listener.activate(event,args)&&res}),event.bubbling){var further=this.getBubbleTarget();further&&(res=!1!==further.propagateEvent(event,path,args)&&res)}return res}},hasListenerFor:function(path){var parsed=this.parseEventPath(path);return this.getRootChannel().hasListenerFor(parsed.channels,parsed.eventName)},purgeListeners:function(){this.rootChannel.destroy(),this.rootChannel=new JooseX.Observable.Channel},suspendEvents:function(){this.suspendCounter++},resumeEvents:function(){this.suspendCounter--,this.suspendCounter<0&&(this.suspendCounter=0)}}}),Class("JooseX.Namespace.Depended.Manager",{my:{have:{INC:["lib","/jsan"],disableCaching:!0,resources:{},resourceTypes:{},ANONYMOUS_RESOURCE_COUNTER:0},methods:{getMyResource:function(type,token,me){var resource=this.getResource({type:type,token:token});if(resource.attachedTo&&resource.attachedTo!=me)throw resource+" is already attached to ["+resource.attachedTo+"]";return resource.attachedTo=me,resource.loaded=!0,resource.loading=!1,resource},getResource:function(descriptor){if("object"==typeof descriptor){var type=descriptor.type=descriptor.type||"javascript",token=descriptor.token,requiredVersion=descriptor.version;delete descriptor.version}else if("string"==typeof descriptor){var match=/^(\w+):\/\/(.+)/.exec(descriptor);match?(type=match[1],token=match[2],"http"!=type&&"https"!=type||(token=type+"://"+token,type="javascript")):type=/\//.test(token=descriptor)||/\.js$/.test(token)?"javascript":"joose"}token||(token="__ANONYMOUS_RESOURCE__"+this.ANONYMOUS_RESOURCE_COUNTER++,descriptor=void 0);var id=type+"://"+token,resource=this.resources[id];if(!resource){var resourceClass=this.resourceTypes[type];if(!resourceClass)throw new Error("Unknown resource type: ["+type+"]");resource=this.resources[id]=new resourceClass("object"==typeof descriptor?descriptor:{token:token,type:type})}return resource.setRequiredVersion(requiredVersion),resource},registerResourceClass:function(typeName,resourceClass){this.resourceTypes[typeName]=resourceClass},use:function(dependenciesInfo,callback,scope){Class({use:dependenciesInfo,body:function(){callback&&Joose.Namespace.Manager.my.executeIn(Joose.top,function(ns){callback.call(scope||this,ns)})}})},getINC:function(){var INC=this.INC,original=use.__ORIGINAL__,paths=use.paths;if(INC==original&&paths!=original)return paths;if(INC!=original&&paths==original)return INC;if(INC!=original&&paths!=original)throw"Both INC sources has been modified";return INC}}}}),use=function(dependenciesInfo,callback,scope){JooseX.Namespace.Depended.Manager.my.use(dependenciesInfo,callback,scope)},use.paths=use.__ORIGINAL__=JooseX.Namespace.Depended.Manager.my.INC,Joose.I.FutureClass=function(className){return function(){return eval(className)}},Class("JooseX.Namespace.Depended.Resource",{has:{attachedTo:null,type:null,token:null,id:null,loading:!1,loaded:!1,ready:!1,presence:null,readyness:null,loadedFromURL:null,readyListeners:Joose.I.Array,dependencies:Joose.I.Object,onBeforeReady:{is:"rw",init:null},readyDelegated:!1,version:{is:"rw",init:null},requiredVersion:{is:"rw",init:null},hasReadyCheckScheduled:!1},after:{initialize:function(){this.id||(this.id=this.type+"://"+this.token)}},methods:{setOnBeforeReady:function(func){if(this.onBeforeReady)throw"Can't redefine 'onBeforeReady' for "+this;this.onBeforeReady=func},setVersion:function(version){if(version){if(this.version&&this.version!=version)throw new Error("Cant redefine version of "+this);var requiredVersion=this.requiredVersion;if(requiredVersion&&version<requiredVersion)throw new Error("Versions conflict on "+this+" required ["+requiredVersion+"], got ["+version+"]");this.version=version}},setRequiredVersion:function(version){if(version){var requiredVersion=this.requiredVersion;if(!requiredVersion||requiredVersion<version){if(this.isLoaded()||this.loading)throw"Cant increase required version - "+this+" is already loaded";this.requiredVersion=version}}},toString:function(){return"Resource: id=["+this.id+"], type=["+this.meta.name+"]"},addDescriptor:function(descriptor){var resource=JooseX.Namespace.Depended.Manager.my.getResource(descriptor),dependencies=this.dependencies,resourceID=resource.id;if(!dependencies[resourceID]&&!resource.isReady()){var me=this;resource.readyListeners.push(function(){delete dependencies[resourceID],me.checkReady()}),dependencies[resourceID]=resource,this.ready=!1}},handleDependencies:function(){Joose.O.eachOwn(this.dependencies||{},function(resource){resource.handleLoad()}),this.checkReady()},checkReady:function(){if(Joose.O.isEmpty(this.dependencies)&&!this.hasReadyCheckScheduled)if(this.onBeforeReady){if(!this.readyDelegated){this.readyDelegated=!0;var me=this;this.onBeforeReady(function(){me.fireReady()},me)}}else this.fireReady()},fireReady:function(){this.ready=!0;var listeners=this.readyListeners;this.readyListeners=[],Joose.A.each(listeners,function(listener){listener()})},isReady:function(){if(!this.isLoaded())return!1;var isReady=!1;try{isReady=this.readyness()}catch(e){}return isReady||this.ready},isLoaded:function(){var isPresent=!1;try{isPresent=this.presence()}catch(e){}return isPresent||this.loaded},handleLoad:function(){if(this.isLoaded())this.checkReady();else if(!this.loading){this.loading=!0;var urls=Joose.O.wantArray(this.getUrls()),me=this;me.hasReadyCheckScheduled=!0;function onsuccess(resourceBlob,url){me.loaded=!0,me.loading=!1,me.loadedFromURL=url,Joose.Namespace.Manager.my.executeIn(Joose.top,function(){me.materialize(resourceBlob,url)}),me.hasReadyCheckScheduled=!1,me.handleDependencies()}var onerror=function(e){if(!urls.length)throw new Error(me+" not found");me.load(urls.shift(),onsuccess,onerror)};this.load(urls.shift(),onsuccess,onerror)}},getUrls:function(){throw"Abstract resource method 'getUrls' was called"},load:function(url,onsuccess,onerror){throw"Abstract resource method 'load' was called"},materialize:function(resourceBlob){throw"Abstract resource method 'materialize' was called"}}}),Role("JooseX.Namespace.Depended.Materialize.Eval",{requires:["handleLoad"],methods:{materialize:function(resourceBlob){(window.execScript||window.eval)(resourceBlob)}}}),Class("JooseX.Namespace.Depended.Resource.JavaScript",{isa:JooseX.Namespace.Depended.Resource,has:{hasDirectUrl:!1},after:{initialize:function(){var me=this;"nonjoose"==this.type&&(this.type="javascript");var presence=this.presence;"string"==typeof presence&&(this.presence=function(){return eval(presence)}),presence||(this.presence=function(){return eval(me.token)}),this.readyness||(this.readyness=this.presence)}},methods:{BUILD:function(config){var token=config.token,match=/^=(.*)/.exec(token);return match&&(this.hasDirectUrl=!0,token=match[1]),/^http/.test(token)&&(this.hasDirectUrl=!0,config.trait=JooseX.Namespace.Depended.Transport.ScriptTag),/^\//.test(token)&&(this.hasDirectUrl=!0),config},getUrls:function(){var url=this.token;if(this.hasDirectUrl)return[url];var manager=JooseX.Namespace.Depended.Manager.my;return Joose.A.map(manager.getINC(),function(libroot){return[libroot=libroot.replace(/\/$/,"")].concat(url).join("/")+(manager.disableCaching?"?disableCaching="+(new Date).getTime():"")})}}}),JooseX.Namespace.Depended.Manager.my.registerResourceClass("javascript",JooseX.Namespace.Depended.Resource.JavaScript),JooseX.Namespace.Depended.Manager.my.registerResourceClass("nonjoose",JooseX.Namespace.Depended.Resource.JavaScript),Class("JooseX.Namespace.Depended.Resource.JooseClass",{isa:JooseX.Namespace.Depended.Resource.JavaScript,after:{initialize:function(){var me=this;this.presence=function(){var c=Joose.S.strToClass(me.token);return c&&c.meta.resource},this.readyness=function(){var c=eval(me.token);return c&&c.meta.resource.ready}}},methods:{addDescriptor:function(descriptor){"object"!=typeof descriptor||descriptor.token?this.SUPER(descriptor):Joose.O.eachOwn(descriptor,function(version,name){this.addDescriptor({type:"joose",token:name,version:version})},this)},getUrls:function(){var className=this.token.split("."),manager=JooseX.Namespace.Depended.Manager.my;return Joose.A.map(manager.getINC(),function(libroot){return[libroot=libroot.replace(/\/$/,"")].concat(className).join("/")+".js"+(manager.disableCaching?"?disableCaching="+(new Date).getTime():"")})}}}),JooseX.Namespace.Depended.Manager.my.registerResourceClass("joose",JooseX.Namespace.Depended.Resource.JooseClass),"undefined"==typeof JooseX||JooseX.SimpleRequest||Class("JooseX.SimpleRequest",{have:{req:null},methods:{initialize:function(){window.XMLHttpRequest?this.req=new XMLHttpRequest:this.req=new ActiveXObject("Microsoft.XMLHTTP")},getText:function(urlOrOptions,async,callback,scope){var headers,url,req=this.req;"string"!=typeof urlOrOptions?(headers=urlOrOptions.headers,url=urlOrOptions.url,async=async||urlOrOptions.async,callback=callback||urlOrOptions.callback,scope=scope||urlOrOptions.scope):url=urlOrOptions,req.open("GET",url,async||!1),headers&&Joose.O.eachOwn(headers,function(value,name){req.setRequestHeader(name,value)});try{req.onreadystatechange=function(event){async&&4==req.readyState&&(200==req.status||0==req.status&&0<req.responseText.length?callback.call(scope||this,!0,req.responseText):callback.call(scope||this,!1,"File not found: "+url))},req.send(null)}catch(e){throw"File not found: "+url}if(async)return null;if(200==req.status||0==req.status&&0<req.responseText.length)return req.responseText;throw"File not found: "+url}}}),Role("JooseX.Namespace.Depended.Materialize.ScriptTag",{requires:["handleLoad"],methods:{materialize:function(resourceBlob){var loaderNode=document.createElement("script");loaderNode.text=resourceBlob,document.body.appendChild(loaderNode)}}}),Role("JooseX.Namespace.Depended.Transport.XHRAsync",{requires:["handleLoad"],override:{load:function(url,onsuccess,onerror){var req=new JooseX.SimpleRequest;try{req.getText(url,!0,function(success,text){success?onsuccess(text,url):onerror(this+" not found")})}catch(e){onerror(e)}}}}),Role("JooseX.Namespace.Depended.Transport.ScriptTag",{requires:["handleLoad"],methods:{getScriptTag:function(){}},override:{load:function(url,onsuccess,onerror){var scriptNode=document.createElement("script");if(scriptNode.type="text/javascript",scriptNode.src=url,scriptNode.async=!0,Joose.is_IE){var timeout=setTimeout(function(){onerror(url+" load failed.")},1e4);scriptNode.onreadystatechange=function(){var readyState=scriptNode.readyState;"complete"!=readyState&&"loaded"!=readyState||(clearTimeout(timeout),onsuccess(null,url))}}else scriptNode.onload=function(){onsuccess(scriptNode.text,url)},scriptNode.onerror=function(){onerror(url+" load failed.")};(document.getElementsByTagName("head")[0]||document.body).appendChild(scriptNode)},materialize:function(blob,url){}}}),Role("JooseX.Namespace.Depended.Transport.NodeJS",{requires:["handleLoad"],override:{load:function(url,onsuccess,onerror){var fs=require("fs");try{var content=fs.readFileSync(url,"utf8")}catch(e){return void onerror(e)}onsuccess(content,url)}}}),Role("JooseX.Namespace.Depended.Materialize.NodeJS",{requires:["handleLoad"],methods:{materialize:function(resourceBlob,url){}}}),Class("JooseX.Namespace.Depended.Resource.Require",{isa:JooseX.Namespace.Depended.Resource,methods:{getUrls:function(){return[this.token]},load:function(url,onsuccess,onerror){},materialize:function(){}}}),JooseX.Namespace.Depended.Manager.my.registerResourceClass("require",JooseX.Namespace.Depended.Resource.Require),Role("JooseX.Namespace.Depended",{meta:Joose.Managed.Role,requires:["prepareProperties"],have:{containResources:["use","meta","isa","does","trait","traits"]},override:{prepareProperties:function(name,extend,defaultMeta,callback){name&&"string"!=typeof name&&(extend=name,name=null),extend=extend||{};var summaredDeps=this.collectAllDeps(extend),currentModule=this.getCurrent(),resource=JooseX.Namespace.Depended.Manager.my.getResource({type:"joose",token:currentModule==Joose.top?name:currentModule.meta.name+"."+name});if(extend.VERSION&&resource.setVersion(extend.VERSION),extend.BEGIN&&(resource.setOnBeforeReady(extend.BEGIN),delete extend.BEGIN),Joose.A.each(summaredDeps,function(descriptor){resource.addDescriptor(descriptor)}),Joose.O.isEmpty(resource.dependencies)){this.inlineAllDeps(extend);var res=this.SUPER(name,extend,defaultMeta,callback);return resource.checkReady(),res}var me=this,SUPER=this.SUPER;return resource.readyListeners.unshift(function(){me.inlineAllDeps(extend),Joose.Namespace.Manager.my.executeIn(currentModule,function(){SUPER.call(me,name,extend,defaultMeta,callback)})}),resource.hasReadyCheckScheduled||(Joose.is_NodeJS?resource.handleDependencies():setTimeout(function(){resource.handleDependencies()},0)),this.create(name,Joose.Namespace.Keeper,{})},prepareMeta:function(meta){meta.resource=meta.resource||JooseX.Namespace.Depended.Manager.my.getMyResource("joose",meta.name,meta.c)}},methods:{alsoDependsFrom:function(extend,summaredDeps){},collectAllDeps:function(extend){var summaredDeps=[],me=this;this.collectClassDeps(extend,summaredDeps);var extendMy=extend.my;return this.collectClassDeps(extendMy,summaredDeps),extend.has&&Joose.O.each(extend.has,function(attr,name){Joose.O.isClass(attr)||me.collectClassDeps(attr,summaredDeps)}),extendMy&&extendMy.has&&Joose.O.each(extendMy.has,function(attr,name){Joose.O.isClass(attr)||me.collectClassDeps(attr,summaredDeps)}),this.alsoDependsFrom(extend,summaredDeps),summaredDeps},collectClassDeps:function(from,to){from&&Joose.A.each(this.containResources,function(propName){this.collectDependencies(from[propName],to,from,propName)},this)},collectDependencies:function(from,to,extend,propName){from&&Joose.A.each(Joose.O.wantArray(from),function(descriptor){descriptor&&"function"!=typeof descriptor&&to.push(descriptor)})},inlineAllDeps:function(extend){var me=this;this.inlineDeps(extend);var extendMy=extend.my;extendMy&&this.inlineDeps(extendMy),extend.has&&Joose.O.each(extend.has,function(attr,name){attr&&"object"==typeof attr&&me.inlineDeps(attr)}),extendMy&&extendMy.has&&Joose.O.each(extendMy.has,function(attr,name){attr&&"object"==typeof attr&&me.inlineDeps(attr)})},inlineDeps:function(extend){delete extend.use,Joose.A.each(this.containResources,function(propName){if(extend[propName]){var descriptors=[];if(Joose.A.each(Joose.O.wantArray(extend[propName]),function(descriptor,index){var descType=typeof descriptor;if("function"==descType)descriptors.push(descriptor.meta?descriptor:"isa"!=propName?descriptor():null);else if("object"==descType)descriptor.token?descriptors.push(eval(descriptor.token)):Joose.O.each(descriptor,function(version,name){descriptors.push(eval(name))});else{if("string"!=descType)throw new Error("Wrong dependency descriptor format: "+descriptor);descriptors.push(eval(descriptor))}}),"isa"!=propName&&"meta"!=propName)extend[propName]=descriptors;else{if(1<descriptors.length)throw"Cant specify several super- or meta- classes";descriptors[0]&&(extend[propName]=descriptors[0])}}})}}}),Joose.Namespace.Manager.meta.extend({does:JooseX.Namespace.Depended}),Joose.is_NodeJS?(JooseX.Namespace.Depended.Resource.JavaScript.meta.extend({does:[JooseX.Namespace.Depended.Transport.NodeJS,JooseX.Namespace.Depended.Materialize.NodeJS]}),JooseX.Namespace.Depended.Manager.my.disableCaching=!1,Joose.Namespace.Manager.my.containResources.unshift("require"),JooseX.Namespace.Depended.meta.extend({override:{collectDependencies:function(from,to,extend,propName){if("require"!=propName)return this.SUPERARG(arguments);from&&(Joose.A.each(Joose.O.wantArray(from),function(url){to.push({type:"require",token:url})}),delete extend.require)}}})):JooseX.Namespace.Depended.Resource.JavaScript.meta.extend({does:[JooseX.Namespace.Depended.Transport.XHRAsync,JooseX.Namespace.Depended.Materialize.Eval]}),Class("Scope.Provider",{has:{name:null,launchId:null,scope:null,seedingCode:null,seedingScript:null,seedingScriptIsEcmaModule:!1,preload:{is:"ro",init:Joose.I.Array},cleanupCallback:null,beforeCleanupCallback:null},methods:{isCSS:function(url){return/\.css(\?.*)?$/i.test(url)},isAlreadySetUp:function(){return Boolean(this.scope)},addPreload:function(preloadDesc){if(this.isAlreadySetUp())throw new Error("Can't use `addPreload` - scope is already setup. Use `runCode/runScript` instead");if("string"==typeof preloadDesc?preloadDesc=this.isCSS(preloadDesc)?{type:"css",url:preloadDesc}:{type:"js",url:preloadDesc}:preloadDesc.text&&(preloadDesc={type:"js",content:preloadDesc.text}),!preloadDesc.type)throw new Error("Preload descriptor must have the `type` property");this.preload.push(preloadDesc)},addOnErrorHandler:function(handler,callback){throw"Abstract method `addOnErrorHandler` of Scope.Provider called"},create:function(){throw"Abstract method `create` of Scope.Provider called"},setup:function(callback){throw"Abstract method `setup` of Scope.Provider called"},cleanup:function(callback){throw"Abstract method `cleanup` of Scope.Provider called"},runCode:function(text,callback){throw"Abstract method `runCode` of Scope.Provider called"},runScript:function(url,callback){throw"Abstract method `runScript` of Scope.Provider called"}}}),Scope.Provider.__ONLOAD__={},Scope.Provider.__ONERROR__={},Scope.Provider.__FAILED_PRELOAD__={},Role("Scope.Provider.Role.WithDOM",{requires:["getDocument","create","getPreload","isAlreadySetUp","setViewportSize"],has:{useStrictMode:!0,sourceURL:null,crossOriginFailed:!1,innerHtmlHead:null,innerHtmlBody:null,minViewportSize:null,parentWindow:function(){return window},scopeId:function(){return Math.round(1e10*Math.random())},failOnResourceLoadError:!1,failOnPromiseRejection:!0,attachToOnError:function(){return function(window,scopeId,handler,preventDefault,failOnResourceLoadError,failOnPromiseRejection){if(handler=(window.opener||window.parent).Scope.Provider.__ONERROR__[scopeId],failOnResourceLoadError&&"ErrorEvent"in window)window.addEventListener("error",handler,!0);else{var prevHandler=window.onerror;if(prevHandler&&prevHandler.__SP_MANAGED__)return;window.onerror=function(message,url,lineNumber){if(!handler.__CALLING__)return handler.__CALLING__=!0,prevHandler&&prevHandler.apply(this,arguments),handler.apply(this,arguments),(handler.__CALLING__=!1)!==preventDefault?!window.WebKitPoint:void 0},window.onerror.__SP_MANAGED__=!0}failOnPromiseRejection&&window.Promise&&"onunhandledrejection"in window&&window.addEventListener("unhandledrejection",function(e){handler.apply(this,[null,null,null,null,null,e])},!0)}},cachedOnError:null},override:{cleanup:function(){var onErrorHandler=this.cachedOnError;this.cachedOnError=null;try{var scope=this.scope;scope.ErrorEvent&&scope.removeEventListener("error",onErrorHandler),scope.onerror=null}catch(e){}this.SUPERARG(arguments),this.scope=null}},methods:{cleanupHandlers:function(){var scopeProvider=this.parentWindow.Scope.Provider,scopeId=this.scopeId;delete scopeProvider.__ONLOAD__[scopeId],delete scopeProvider.__ONERROR__[scopeId],delete scopeProvider.__FAILED_PRELOAD__[scopeId]},getHead:function(){return this.getDocument().getElementsByTagName("head")[0]},installOnErrorHandler:function(handler){if(!this.crossOriginFailed){if(!this.isAlreadySetUp())throw"Scope should be already set up";this.attachToOnError(this.scope,this.scopeId,handler,!1,this.failOnResourceLoadError,this.failOnPromiseRejection)}},addOnErrorHandler:function(handler,preventDefault){if(!this.crossOriginFailed){handler.__SP_MANAGED__=!0,this.cachedOnError=handler;var scopeId=this.scopeId;this.parentWindow.Scope.Provider.__ONERROR__[scopeId]=handler;var attachToOnError=";("+this.attachToOnError.toString()+")(window, "+scopeId+", (window.opener || window.parent).Scope.Provider.__ONERROR__[ "+scopeId+" ], "+preventDefault+", "+this.failOnResourceLoadError+", "+this.failOnPromiseRejection+");";this.isAlreadySetUp()?this.runCode(attachToOnError):this.getPreload().unshift({type:"js",content:attachToOnError,unordered:!0})}},addSeedingToPreload:function(){var preload=this.getPreload();this.seedingCode&&preload.unshift({type:"js",content:this.seedingCode}),this.seedingScript&&preload.push({type:"js",url:this.seedingScript,isEcmaModule:this.seedingScriptIsEcmaModule})},setup:function(callback){var isIE=Boolean(this.parentWindow.msWriteProfilerMark),hasInlineScript=!1;Joose.A.each(this.getPreload(),function(preloadDesc){if("js"==preloadDesc.type&&preloadDesc.content&&!preloadDesc.unordered)return!(hasInlineScript=!0)});function cont(e){callback&&callback(me,me.parentWindow.Scope.Provider.__FAILED_PRELOAD__[me.scopeId],e)}var me=this;this.parentWindow.Scope.Provider.__FAILED_PRELOAD__[this.scopeId]={},this.sourceURL||isIE&&hasInlineScript?(this.addSeedingToPreload(),this.setupIncrementally(cont)):(isIE||this.addSeedingToPreload(),this.setupWithDocWrite(cont,isIE))},setupWithDocWrite:function(callback,needToSeed){var html=[],me=this;Joose.A.each(this.getPreload(),function(preloadDesc){if("js"==preloadDesc.type)html.push(me.getScriptTagString(preloadDesc.url,preloadDesc.content,preloadDesc.isEcmaModule));else{if("css"!=preloadDesc.type)throw"Incorrect preload descriptor "+preloadDesc;html.push(me.getLinkTagString(preloadDesc.url,preloadDesc.content))}}),this.create();var scopeId=this.scopeId;this.parentWindow.Scope.Provider.__ONLOAD__[scopeId]=function(){function cont(){callback&&callback()}needToSeed?(me.seedingCode&&me.runCode(me.seedingCode,null),me.seedingScript?me.runScript(me.seedingScript,cont,me.seedingScriptIsEcmaModule):cont()):cont()};var doc=this.getDocument();doc.open(),doc.write([this.useStrictMode?"<!DOCTYPE html>":"",'<html style="width: 100%; height: 100%; margin : 0; padding : 0;">',"<head>",this.innerHtmlHead||"",html.join(""),"</head>",'<body style="margin : 0; padding : 0; width: 100%; height: 100%" onload="setTimeout(function () { (window.opener || window.parent).Scope.Provider.__ONLOAD__['+scopeId+']() }, 0)">',this.innerHtmlBody||"","</body>","</html>"].join("")),doc.close(),me.cachedOnError&&me.installOnErrorHandler(me.cachedOnError)},setupIncrementally:function(callback){this.create(function(me,e){if(e)callback&&callback(e);else{if(!me.sourceURL){var doc=me.getDocument();if(me.innerHtmlHead){var head=me.getHead();try{head.innerHTML=me.innerHtmlHead}catch(e){var div=doc.createElement("div");div.innerHTML=me.innerHtmlHead;for(var i=0;i<div.children.length;i++)head.appendChild(div.children[i])}}me.innerHtmlBody&&(doc.body.innerHTML=me.innerHtmlBody)}var loadScripts=function(preloads,callback){function cont(){me.scope&&loadScripts(preloads,callback)}if(preloads.length){var preloadDesc=preloads.shift();preloadDesc.url?me.runScript(preloadDesc.url,cont,preloadDesc.isEcmaModule):"js"==preloadDesc.type?me.runCode(preloadDesc.content,cont,preloadDesc.isEcmaModule):(me.addStyleTag(preloadDesc.content),cont())}else callback&&callback()};me.scope&&loadScripts(me.getPreload().slice(),callback)}})},getScriptTagString:function(url,text,isEcmaModule){var res='<script type="'+(isEcmaModule?"module":"text/javascript")+'"'+(isEcmaModule?' crossorigin="anonymous"':""),onerror="(window.opener || window.parent).Scope.Provider.__FAILED_PRELOAD__[ scopeId ][ url ] = true";return onerror=onerror.replace(/scopeId/,"'"+this.scopeId+"'").replace(/url/,"'"+url+"'"),res+=url?' src="'+url+'" onerror="'+onerror+'"><\/script>':">"+text.replace(/<\/script>/gi,"\\x3C/script>")+"<\/script>"},getLinkTagString:function(url,text){return url?'<link href="'+url+'" rel="stylesheet" type="text/css" />':text?"<style>"+text+"</style>":void 0},loadCSS:function(url,callback){var doc=this.getDocument(),link=doc.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=url;var hasOnLoad=!1;if("onload"in link&&(hasOnLoad=!0,link.onload=function(){link.onload=null,callback&&callback(),link=callback=null}),this.getHead().appendChild(link),!hasOnLoad){function cont(){hasContinued||(hasContinued=!0,clearTimeout(forcedTimeout),callback&&callback(),doc.body.removeChild(img))}var hasContinued=!1,forcedTimeout=setTimeout(cont,3e4),img=doc.createElement("img");img.onerror=cont,doc.body.appendChild(img),img.src=url}},runCode:function(text,callback,isEcmaModule){this.crossOriginFailed||this.getHead().appendChild(this.createScriptTag(text,null,null,null,isEcmaModule)),callback&&callback()},runScript:function(url,callback,isEcmaModule){if(this.crossOriginFailed)callback&&callback();else{var scopeId=this.scopeId;if(this.isCSS(url))this.loadCSS(url,callback);else{this.getHead().appendChild(this.createScriptTag(null,url,callback,function(){this.onerror=null;var doc=this.ownerDocument,win=doc.defaultView||doc.parentWindow;(win.opener||win.parent).Scope.Provider.__FAILED_PRELOAD__[scopeId][url]=!0,callback()},isEcmaModule))}}},createScriptTag:function(text,url,callback,errback,isEcmaModule){var node=this.getDocument().createElement("script");return node.setAttribute("type",isEcmaModule?"module":"text/javascript"),isEcmaModule&&node.setAttribute("crossorigin","anonymous"),url&&node.setAttribute("src",url),text&&(node.text=text),callback&&(node.onload=node.onreadystatechange=function(){node.readyState&&"loaded"!=node.readyState&&"complete"!=node.readyState&&(4!=node.readyState||200!=node.status)||(node.onload=node.onreadystatechange=null,callback())}),errback&&(node.onerror=errback),node},addStyleTag:function(text){var document=this.getDocument(),node=document.createElement("style");node.setAttribute("type","text/css"),document.getElementsByTagName("head")[0].appendChild(node),node.styleSheet?node.styleSheet.cssText=text:node.appendChild(document.createTextNode(text))}}}),Class("Scope.Provider.IFrame",{isa:Scope.Provider,does:Scope.Provider.Role.WithDOM,have:{iframe:null,cls:null,performWrap:!1,wrapCls:null,wrapper:null,iframeParentEl:null,parentEl:null,cleanupDelay:1e3},methods:{getDocument:function(){return this.iframe.contentWindow.document},setViewportSize:function(width,height){var iframe=this.iframe;iframe&&(iframe.style.width=width+"px",iframe.style.height=height+"px")},create:function(onLoadCallback){var me=this,doc=this.parentWindow.document,iframe=this.iframe=doc.createElement("iframe"),minViewportSize=this.minViewportSize;iframe.className=this.cls||"",iframe.style.width=(minViewportSize&&minViewportSize.width||1024)+"px",iframe.style.height=(minViewportSize&&minViewportSize.height||768)+"px",iframe.setAttribute("frameborder",0),this.name&&iframe.setAttribute("name",this.name);var ignoreOnLoad=!1,callback=function(){if(!ignoreOnLoad){iframe.detachEvent?iframe.detachEvent("onload",callback):iframe.onload=null;try{me.getHead().innerHTML;onLoadCallback&&onLoadCallback(me)}catch(e){me.crossOriginFailed=!0,onLoadCallback&&onLoadCallback(me,e)}}};if(iframe.attachEvent?iframe.attachEvent("onload",callback):iframe.onload=callback,iframe.src=this.sourceURL||"about:blank",this.performWrap){var wrapper=this.wrapper;wrapper||((wrapper=this.wrapper=doc.createElement("div")).className=this.wrapCls||""),(this.iframeParentEl||wrapper).appendChild(iframe),this.iframeParentEl=null}(this.parentEl||doc.body).appendChild(wrapper||iframe);var scope=this.scope=iframe.contentWindow;if(Boolean(this.parentWindow.msWriteProfilerMark)){try{var scopeDoc=this.getDocument();this.sourceURL&&(ignoreOnLoad=!0),scopeDoc.open(),scopeDoc.write([this.useStrictMode?"<!DOCTYPE html>":"",'<html style="width: 100%; height: 100%; margin : 0; padding : 0;">',"<head>","</head>",'<body style="margin : 0; padding : 0; width: 100%; height: 100%">',"</body>","</html>"].join("")),scopeDoc.close(),ignoreOnLoad=!1}catch(e){me.crossOriginFailed=!0}iframe.onreadystatechange=function(){"complete"==iframe.readyState&&(iframe.onreadystatechange=null),me.cachedOnError&&!me.crossOriginFailed&&me.attachToOnError(scope,me.scopeId,me.cachedOnError)},this.sourceURL&&(iframe.src=this.sourceURL)}me.cachedOnError&&me.installOnErrorHandler(me.cachedOnError)},cleanup:function(){var wrapper=this.wrapper||this.iframe,iframe=this.iframe,me=this;iframe.onreadystatechange=null,wrapper.style.display="none";this.runCode(";("+function(){window.onunload||(window.onunload=function(){return"something"})}.toString()+")();"),this.iframe=null,this.scope=null,this.wrapper=null,me.beforeCleanupCallback&&me.beforeCleanupCallback(),me.beforeCleanupCallback=null,me.crossOriginFailed||(iframe.src="javascript:false"),setTimeout(function(){(me.parentEl||me.parentWindow.document.body).removeChild(wrapper),iframe=wrapper=null,me.parentEl=null,me.cleanupHandlers(),me.cleanupCallback&&me.cleanupCallback(),me.cleanupCallback=null},me.cleanupDelay)}}}),Class("Scope.Provider.Window",{isa:Scope.Provider,does:Scope.Provider.Role.WithDOM,has:{popupWindow:null},methods:{setViewportSize:function(width,height){var popupWindow=this.popupWindow;popupWindow&&popupWindow.resizeTo(width,height)},create:function(onLoadCallback){var minViewportSize=this.minViewportSize,width=minViewportSize&&minViewportSize.width||1024,height=minViewportSize&&minViewportSize.height||768,popup=this.scope=this.popupWindow=this.parentWindow.open(this.sourceURL||"about:blank","_blank","left=10,top=10,width="+width+",height="+height);if(!popup)throw alert("Please enable popups for the host with this test suite running: "+this.parentWindow.location.host),"Please enable popups for the host with this test suite running: "+this.parentWindow.location.host;if(Boolean(this.parentWindow.msWriteProfilerMark)&&!this.sourceURL){var doc=this.getDocument();doc.open(),doc.write(""),doc.close()}this.cachedOnError&&this.installOnErrorHandler(this.cachedOnError);function contentLoaded(win,fn){var done=!1,top=!0,doc=win.document,root=doc.documentElement,add=doc.addEventListener?"addEventListener":"attachEvent",rem=doc.addEventListener?"removeEventListener":"detachEvent",pre=doc.addEventListener?"":"on",init=function(e){"readystatechange"==e.type&&"complete"!=doc.readyState||(("load"==e.type?win:doc)[rem](pre+e.type,init,!1),!done&&(done=!0)&&fn.call(win,me))},poll=function(){try{root.doScroll("left")}catch(e){return void setTimeout(poll,50)}init("poll")};if("complete"==doc.readyState)fn.call(win,me);else{if(doc.createEventObject&&root.doScroll){try{top=!win.frameElement}catch(e){}top&&poll()}doc[add](pre+"DOMContentLoaded",init,!1),doc[add](pre+"readystatechange",init,!1),win[add](pre+"load",init,!1)}}var me=this;this.sourceURL?setTimeout(function(){contentLoaded(popup,onLoadCallback||function(){})},10):contentLoaded(popup,onLoadCallback||function(){})},getDocument:function(){return this.popupWindow.document},cleanup:function(){this.beforeCleanupCallback&&this.beforeCleanupCallback(),this.beforeCleanupCallback=null,this.popupWindow.close(),this.popupWindow=null,this.cleanupHandlers(),this.cleanupCallback&&this.cleanupCallback(),this.cleanupCallback=null}}}),Class("Scope.Provider.NodeJS",{isa:Scope.Provider,has:{sourceURL:null,requireFunc:null,errorHandlerBorrowed:null,onErrorHandler:null},methods:{runInContext:function(code,scope,options){return require("vm").runInContext(code,scope,options)},addOnErrorHandler:function(handler,preventDefault){var me=this;if(me.eventHandlerBorrowed)throw new Error("Exclusive resource borrowing failed");return me.onErrorHandler=handler,process.on("uncaughtException",exceptionHandler=function(e){handler(e.message,null,null,null,e)}),process.on("unhandledRejection",rejectHandler=function(reason){handler(null,null,null,null,null,{reason:reason})}),me.eventHandlerBorrowed=function(){process.removeListener("uncaughtException",exceptionHandler),process.removeListener("unhandledRejection",rejectHandler),me.eventHandlerBorrowed=null,me.onErrorHandler=null}},create:function(callback){var vm=require("vm"),sandbox={};Joose.O.extend(sandbox,{process:process,console:console,global:sandbox,setImmediate:setImmediate,clearImmediate:clearImmediate,setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval});this.scope=vm.createContext(sandbox);callback&&callback()},setup:function(callback){this.create();var me=this;this.seedingCode&&this.runCode(this.seedingCode),Joose.A.each(this.getPreload(),function(preloadDesc){"js"==preloadDesc.type&&(preloadDesc.url?me.runScript(preloadDesc.url):me.runCode(preloadDesc.content))}),this.seedingScript&&this.runScript(this.seedingScript),callback&&callback(me)},stripBom:function(content){return 65279===content.charCodeAt(0)&&(content=content.slice(1)),content},fileNameToModuleId:function(url){var path=require("path");return path.isAbsolute(url)?url:path.resolve("./",url)},runCode:function(text,callback){var res=require("vm").runInContext(this.stripBom(text),this.scope);return callback&&callback(res),res},runScript:function(url,callback){return/mjs(\?.*)?$/.test(url)?this.importEcmaModule(url,callback):this.requireCjsModule(url,callback)},requireCjsModule:function(url,callback){var vm=require("vm"),old=vm.runInThisContext,scope=this.scope;vm.runInThisContext=function(code,options){return vm.runInContext(code,scope,options)};try{var res=this.requireFunc(this.fileNameToModuleId(url))}catch(e){this.onErrorHandler&&this.onErrorHandler(e.message,null,null,null,e)}return vm.runInThisContext=old,callback&&callback(res),res},importEcmaModule:function(url,callback){throw new Error("Ecma module for different context - implement me?")},cleanup:function(){this.beforeCleanupCallback&&this.beforeCleanupCallback(),this.cleanupCallback&&this.cleanupCallback()}}}),Class("Scope.Provider.NodeJsEmbed",{isa:Scope.Provider.NodeJS,methods:{runCode:function(text,callback){var res=require("vm").runInThisContext(this.stripBom(text),{filename:"/"});return callback&&callback(res),res},requireCjsModule:function(url,callback){try{var res=this.requireFunc(this.fileNameToModuleId(url))}catch(e){this.onErrorHandler&&this.onErrorHandler(e.message,null,null,null,e)}return callback&&callback(res),res},importEcmaModule:function(url,callback){this.runCode("import('"+this.fileNameToModuleId(url)+"')").then(function(res){callback&&callback(res)},function(){})},create:function(callback){this.scope=SCOPE,callback&&callback()}}}),JSON=JSON||{},function(){"use strict";function f(n){return n<10?"0"+n:n}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;i<length;i+=1)"string"==typeof rep[i]&&(v=str(k=rep[i],value))&&partial.push(quote(k)+(gap?": ":":")+v);else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(value,replacer,space){var i;if(indent=gap="","number"==typeof space)for(i=0;i<space;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if((rep=replacer)&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(void 0!==(v=walk(value,k))?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){var REF=1;Class("Data.Visitor2",{has:{seenPlaceholder:{init:{}},outOfDepthPlaceholder:{init:{}},seen:Joose.I.Object,maxDepth:null},methods:{getClassNameFor:function(object){return Joose.O.isInstance(object)?object.meta.name:Object.prototype.toString.call(object).replace(/^\[object /,"").replace(/\]$/,"")},getRefAdr:function(){return REF++},assignRefAdrTo:function(object){return object.__REFADR__||(Object.defineProperty?Object.defineProperty(object,"__REFADR__",{value:REF++}):object.__REFADR__=REF++),object.__REFADR__},isSeen:function(object){return object.__REFADR__&&this.seen.hasOwnProperty(object.__REFADR__)},markSeenAs:function(object,result){return this.seen[object.__REFADR__]=result},hasSeenResultFor:function(object){var ref=object.__REFADR__;return this.seen.hasOwnProperty(ref)&&this.seen[ref]!=this.seenPlaceholder},visit:function(value,depth){return depth>this.maxDepth?this.visitOutOfDepthValue(value,depth+1):Object(value)===value?this.isSeen(value)?this.visitSeen(value,depth+1):this.visitNotSeen(value,depth+1):this.visitValue(value,depth+1)},visitOutOfDepthValue:function(value,depth){return this.outOfDepthPlaceholder},visitValue:function(value,depth){return value},visitSeen:function(value,depth){return this.seen[value.__REFADR__]},getInitialSeenMarker:function(object,depth){return this.seenPlaceholder},visitNotSeen:function(object,depth){if(this.assignRefAdrTo(object),this.markSeenAs(object,this.getInitialSeenMarker(object,depth)),Joose.O.isInstance(object))return this.markSeenAs(object,this.visitJooseInstance(object,depth));var methodName="visit"+this.getClassNameFor(object);return this.meta.hasMethod(methodName)||(methodName="visitObject"),this.markSeenAs(object,this[methodName](object,depth))},visitArray:function(array,depth){return Joose.A.each(array,function(value,index){this.visitArrayEntry(value,index,array,depth)},this),array},visitArrayEntry:function(entry,index,array,depth){return this.visit(entry,depth)},visitObject:function(object,depth){return Joose.O.eachOwn(object,function(value,key){"__REFADR__"!=key&&(this.visitObjectKey(key,value,object,depth),this.visitObjectValue(value,key,object,depth))},this),object},visitJooseInstance:function(value,depth){return this.visitObject(value,depth)},visitObjectKey:function(key,value,object,depth){return this.visitValue(key,depth)},visitObjectValue:function(value,key,object,depth){return this.visit(value,depth)}},my:{has:{HOST:null},methods:{visit:function(value,maxDepth){return new this.HOST({maxDepth:maxDepth||1/0}).visit(value,0)}}}})}(),Class("Siesta.Util.Serializer",{isa:Data.Visitor2,has:{result:Joose.I.Array,manualEnum:function(){for(var i in{toString:1})return!1;return!0}},methods:{assignRefAdrTo:function(object){try{return this.SUPER(object)}catch(e){object.__REFADR__||(object.__REFADR__=this.getRefAdr())}return object.__REFADR__},write:function(str){this.result.push(str)},visitOutOfDepthValue:function(value,depth){this.write("...")},visitSymbol:function(value){this.write(value.toString())},visitValue:function(value){null==value?this.write(value+""):"symbol"==typeof value?this.write(value.toString()):this.write("string"==typeof value?'"'+value.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':value+"")},visitObjectKey:function(key,value,object){this.write('"'+key+'": ')},getClassNameFor:function(object){return null!=object.nodeType&&null!=object.nodeName&&object.tagName?"DOMElement":null!=object.document&&null!=object.location&&null!=object.location.href?"Window":this.SUPER(object)},visitSeen:function(value,depth){this.write("[Circular]")},visitRegExp:function(value,depth){this.write(value+"")},visitFunction:function(value,depth){this.write("function "+(value.name||"")+"() { ... }")},visitDate:function(value,depth){this.write('"'+value+'"')},visitObject:function(object,depth){for(var key in object)if("__REFADR__"!=key&&(!object.hasOwnProperty||object.hasOwnProperty(key))){var value=object[key];this.visitObjectKey(key,value,object,depth),this.visitObjectValue(value,key,object,depth)}var me=this;return this.manualEnum&&Joose.A.each(["hasOwnProperty","valueOf","toString","constructor"],function(key){if(object.hasOwnProperty&&object.hasOwnProperty(key)){var value=object[key];me.visitObjectKey(key,value,object,depth),me.visitObjectValue(value,key,object,depth)}}),object},visitJooseInstance:function(value,depth){return value.meta.hasMethod("toString")?(this.write(value.toString()),value):this.SUPERARG(arguments)},visitDOMElement:function(object,depth){var output="&lt;"+object.tagName;object.id&&(output+=' id="'+object.id+'"'),object.className&&(output+=' class="'+object.className+'"'),this.write(output+"&gt;")},visitDOMStringMap:function(){this.write("[DOMStringMap]")},visitWindow:function(){this.write("[window]")},visitLocation:function(){this.write("[window.location]")},visitMap:function(map){this.write("Map("+map.size+"){");for(var iterator=map.entries(),entry=iterator.next();!entry.done;entry=iterator.next())this.visit(entry.value[0]),this.write("=>"),this.visit(entry.value[1]),this.write(", ");0<map.size&&this.result.pop(),this.write("}")}},before:{visitObject:function(){this.write("{")},visitArray:function(){this.write("[")}},after:{visitObject:function(){var result=this.result;", "==result[result.length-1]&&result.pop(),this.write("}")},visitArray:function(){var result=this.result;", "==result[result.length-1]&&result.pop(),this.write("]")},visitObjectValue:function(){this.write(", ")},visitArrayEntry:function(){this.write(", ")}},my:{has:{HOST:null},methods:{stringify:function(value,maxDepth){try{null!=value&&value.foobar&&(visitor=null)}catch(e){if(value)return"Value from cross-domain context"}var visitor=new this.HOST({maxDepth:maxDepth||4});return visitor.visit(value,0),visitor.result.join("")}}}}),Role("Siesta.Util.Role.CanFormatStrings",{has:{serializeFormatingPlaceholders:!0},methods:{formatString:function(string,data){if(!data)return string;for(var match,variables=[],isRaw=[],regexp=/\{(\!)?((?:\w|-|_)+?)\}/g;match=regexp.exec(string);)isRaw.push(match[1]),variables.push(match[2]);var result=string;return Joose.A.each(variables,function(variable,index){var varIsRaw=isRaw[index];result=result.replace(new RegExp("\\{"+(varIsRaw?"!":"")+variable+"\\}","g"),data.hasOwnProperty(variable)?varIsRaw||!this.serializeFormatingPlaceholders?data[variable]+"":Siesta.Util.Serializer.stringify(data[variable]):"")},this),result},extractKeysAndSpecialKeys:function(string){var KeyCodes=Siesta.Test.UserAgent.KeyCodes().keys,me=this,res=[],tokens=string.match(/(\[\[(?:\w|-){1,11}\]\])|(\[(?:\w|-){1,11}\])|([\s\S])/g)||[];return Joose.A.each(tokens,function(token,index){if(1<token.length){var isDouble=/\[\[/.test(token),specialKey=token.substring(isDouble?2:1,token.length-(isDouble?2:1)),normalText=void 0===KeyCodes[specialKey.toUpperCase()];normalText||isDouble?(res.push("["),normalText&&isDouble&&res.push("["),res.push.apply(res,me.extractKeysAndSpecialKeys(specialKey)),res.push("]"),normalText&&isDouble&&res.push("]")):res.push(token)}else res.push(token)}),res}}}),Role("Siesta.Util.Role.CanGetType",{methods:{typeOf:function(object){return Object.prototype.toString.call(object).slice(8,-1)}}}),Role("Siesta.Util.Role.CanCompareObjects",{does:[Siesta.Util.Role.CanGetType],methods:{countKeys:function(object){var counter=0;return Joose.O.eachOwn(object,function(){counter++}),counter},compareObjects:function(obj1,obj2,strict,onlyPrimitives,asObjects){var obj1IsPlaceholder=Joose.O.isInstance(obj1)&&obj1.meta.does(Siesta.Test.Role.Placeholder),obj2IsPlaceholder=Joose.O.isInstance(obj2)&&obj2.meta.does(Siesta.Test.Role.Placeholder);if(strict){if(obj1===obj2)return!0}else if(obj1==obj2)return!0;if(obj1IsPlaceholder&&obj2IsPlaceholder)return obj1.equalsTo(obj2);if(obj2IsPlaceholder)return obj2.equalsTo(obj1);if(obj1IsPlaceholder)return obj1.equalsTo(obj2);if(onlyPrimitives)return!1;var type1=this.typeOf(obj1);if(type1!=this.typeOf(obj2))return!1;var me=this;if("Set"==type1){if(obj1.size!=obj2.size)return!1;for(var entry=(iterator=obj1.entries()).next();!entry.done;entry=iterator.next()){var key=entry.value[0];if(!obj2.has(key))return!1}for(entry=(iterator=obj2.entries()).next();!entry.done;entry=iterator.next()){key=entry.value[0];if(!obj1.has(key))return!1}return!0}if("Map"==type1){if(obj1.size!=obj2.size)return!1;for(entry=(iterator=obj1.entries()).next();!entry.done;entry=iterator.next()){key=entry.value[0];var value=entry.value[1];if(!obj2.has(key)||!me.compareObjects(value,obj2.get(key),strict))return!1}var iterator;for(entry=(iterator=obj2.entries()).next();!entry.done;entry=iterator.next()){key=entry.value[0],value=entry.value[1];if(!obj1.has(key)||!me.compareObjects(value,obj1.get(key),strict))return!1}return!0}if("Object"==type1||asObjects)return this.countKeys(obj1)==this.countKeys(obj2)&&!1!==Joose.O.eachOwn(obj1,function(value,name){if(!me.compareObjects(value,obj2[name],strict))return!1});if("Array"!=type1)return"Function"==type1?obj1.toString()==obj2.toString()&&(!strict||this.compareObjects(obj1,obj2,strict,!1,!0)):"RegExp"==type1?obj1.source==obj2.source&&obj1.global==obj2.global&&obj1.ignoreCase==obj2.ignoreCase&&obj1.multiline==obj2.multiline&&(!strict||this.compareObjects(obj1,obj2,strict,!1,!0)):"Date"==type1&&(!Boolean(obj1-obj2)&&(!strict||this.compareObjects(obj1,obj2,strict,!1,!0)));if(obj1.length!=obj2.length)return!1;for(var i=0;i<obj1.length;i++)if(!this.compareObjects(obj1[i],obj2[i],strict))return!1;return!0}}}),Role("Siesta.Util.Role.CanEscapeRegExp",{methods:{escapeRegExp:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}}}),function(){var id=1;Role("Siesta.Util.Role.HasUniqueGeneratedId",{has:{id:{is:"ro",init:function(){return id++}}}})}(),Class("Siesta.Util.Queue",{has:{steps:Joose.I.Array,interval:100,callbackDelay:0,deferer:{required:!0},deferClearer:null,processor:null,processorScope:null,currentTimeout:null,callback:null,scope:null,isAborted:!1,observeTest:null,currentDelayStepId:null,isDestroyed:!1},methods:{addStep:function(stepData){this.addSyncStep(stepData)},addSyncStep:function(stepData){this.steps.push(stepData)},addAsyncStep:function(stepData){stepData.isAsync=!0,this.steps.push(stepData)},addDelayStep:function(delayMs){var origSetTimeout=this.deferer,me=this;this.addAsyncStep({processor:function(data){me.currentDelayStepId=origSetTimeout(data.next,delayMs||500)}})},run:function(callback,scope){this.callback=callback,this.scope=scope,this.observeTest&&this.observeTest.on("teststop",function(){this.abort(!0)},this,{single:!0}),this.doSteps(this.steps.slice(),callback,scope)},abort:function(ignoreCallback){if(!this.isDestroyed){this.isAborted=!0;var deferClearer=this.deferClearer;if(!deferClearer)throw"Need `deferClearer` to be able to `abort` the queue";deferClearer(this.currentDelayStepId),deferClearer(this.currentTimeout),ignoreCallback||this.callback.call(this.scope||this),this.destroy()}},doSteps:function(steps,callback,scope){this.currentTimeout=null;var me=this,deferer=this.deferer,step=steps.shift();if(!this.isAborted)if(step)for(;this.doOneStep(step,steps,callback,scope)&&!this.isAborted;){if(!steps.length){this.doSteps(steps,callback,scope);break}step=steps.shift()}else callback&&(this.callbackDelay?deferer(function(){me.isAborted||(callback.call(scope||this),me.destroy())},this.callbackDelay):(callback.call(scope||this),me.destroy()))},doOneStep:function(step,steps,callback,scope){var me=this,deferer=this.deferer,processor=step.processor||this.processor,processorScope=step.processorScope||this.processorScope,index=this.steps.length-steps.length-1;if(!processor)throw new Error("No process function found for step: "+index);if(step.isAsync){var stepHasCompletedSynchronously=!1,processorHasCompleted=!1,next=step.next=function(){processorHasCompleted?me.doSteps(steps,callback,scope):stepHasCompletedSynchronously=!0};if(processor.call(processorScope||me,step,index,this,next),processorHasCompleted=!0,stepHasCompletedSynchronously)return!0}else{if(processor.call(processorScope||me,step,index,this),this.isAborted)return;var interval=step.hasOwnProperty("interval")?step.interval:me.interval;interval?this.currentTimeout=deferer(function(){me.doSteps(steps,callback,scope)},interval):me.doSteps(steps,callback,scope)}},destroy:function(){if(!this.isDestroyed){this.callback=this.observeTest=this.deferer=this.deferClearer=null,this.processor=this.processorScope=null;for(var i=0;i<this.steps.length;i++)this.steps[i].next=null;this.steps=null,this.isDestroyed=!0}}}}),Class("Siesta.Util.XMLNode",{has:{children:Joose.I.Array,tag:{required:!0},attributes:Joose.I.Object,textContent:null,escapeTable:{init:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}}},methods:{escapeXml:function(s){var me=this;return"string"!=typeof s?s:s.replace(/[&<>"]/g,function(match){return me.escapeTable[match]})},toString:function(){var me=this,childrenContent=[];Joose.A.each(this.children,function(child){childrenContent.push(child.toString())});var attributesContent=[];return Joose.O.each(this.attributes,function(value,name){attributesContent.push(name+'="'+me.escapeXml(value)+'"')}),attributesContent.sort(),attributesContent.unshift(this.tag),"<"+attributesContent.join(" ")+">"+(null!=this.textContent?this.escapeXml(this.textContent):"")+childrenContent.join("")+"</"+this.tag+">"},appendChild:function(child){return child instanceof Siesta.Util.XMLNode?child.parent=this:child=new Siesta.Util.XMLNode(Joose.O.extend(child,{parent:this})),this.children.push(child),child},setAttribute:function(name,value){this.attributes[name]=value}}}),Class("Siesta.Util.Rect",{has:{left:null,top:null,width:null,height:null,right:null,bottom:null},methods:{initialize:function(){var left=this.left,width=this.width,right=this.right;null==right&&null!=left&&null!=width&&(this.right=left+width-1),null==width&&null!=left&&null!=right&&(this.width=right-left+1);var top=this.top,height=this.height,bottom=this.bottom;null==bottom&&null!=top&&null!=height&&(this.bottom=top+height-1),null==height&&null!=top&&null!=bottom&&(this.height=bottom-top+1)},isEmpty:function(){return null==this.left},intersect:function(rect){return rect.isEmpty()||this.isEmpty()||rect.left>this.right||rect.right<this.left||rect.top>this.bottom||rect.bottom<this.top?this.my.getEmpty():new this.constructor({left:Math.max(this.left,rect.left),right:Math.min(this.right,rect.right),top:Math.max(this.top,rect.top),bottom:Math.min(this.bottom,rect.bottom)})},contains:function(left,top){return this.left<=left&&left<=this.right&&this.top<=top&&top<=this.bottom},cropLeftRight:function(rect){return this.intersect(new this.constructor({left:rect.left,right:rect.right,top:this.top,bottom:this.bottom}))},cropTopBottom:function(rect){return this.intersect(new this.constructor({left:this.left,right:this.right,top:rect.top,bottom:rect.bottom}))},equalsTo:function(rect){return this.left==rect.left&&this.right==rect.right&&this.top==rect.top&&this.bottom==rect.bottom}},my:{has:{HOST:null},methods:{getEmpty:function(){return new this.HOST}}}}),Class("Siesta.Content.Resource",{has:{url:null,content:null},methods:{asHTML:function(){throw"Abstract method called"},asDescriptor:function(){throw"Abstract method called"},canCache:function(){}}}),Class("Siesta.Content.Resource.CSS",{isa:Siesta.Content.Resource,has:{},methods:{asHTML:function(){},asDescriptor:function(){var res={type:"css"};return this.url&&(res.url=this.url),this.content&&(res.content=this.content),res}}}),Class("Siesta.Content.Resource.JavaScript",{isa:Siesta.Content.Resource,has:{instrument:!1,isEcmaModule:!1},methods:{asHTML:function(){},asDescriptor:function(){var res={type:"js"};return this.url&&(res.url=this.url),this.content&&(res.content=this.content),this.isEcmaModule&&(res.isEcmaModule=this.isEcmaModule),res}}}),Class("Siesta.Content.Preset",{has:{preload:Joose.I.Array,resources:Joose.I.Array},methods:{initialize:function(){var me=this;Joose.A.each(this.preload,function(preloadDesc){me.addResource(preloadDesc)})},isCSS:function(url){return/\.css(\?.*)?$/i.test(url)},getResourceFromDescriptor:function(desc){var constructor,config;if("string"==typeof desc)constructor=this.isCSS(desc)?Siesta.Content.Resource.CSS:Siesta.Content.Resource.JavaScript,config={url:desc};else if(desc.text)constructor=Siesta.Content.Resource.JavaScript,config={content:desc.text};else{if(!desc.url&&!desc.content)throw"Incorrect preload descriptor:"+desc;constructor=desc.type&&"css"==desc.type||this.isCSS(desc.url)?Siesta.Content.Resource.CSS:Siesta.Content.Resource.JavaScript,config={},desc.url&&(config.url=desc.url),desc.content&&(config.content=desc.content),desc.instrument&&(config.instrument=desc.instrument),desc.isEcmaModule&&(config.isEcmaModule=desc.isEcmaModule)}return new constructor(config)},addResource:function(desc){var resource=desc instanceof Siesta.Content.Resource&&desc||this.getResourceFromDescriptor(desc);return this.resources.push(resource),resource},eachResource:function(func,scope){return Joose.A.each(this.resources,func,scope||this)},prepareScope:function(scopeProvider,contentManager){this.eachResource(function(resource){contentManager.hasContentOf(resource)?scopeProvider.addPreload({type:resource instanceof Siesta.Content.Resource.CSS?"css":"js",content:contentManager.getContentOf(resource)}):scopeProvider.addPreload(resource.asDescriptor())})}}}),Class("Siesta.Content.Manager",{has:{disabled:!1,presets:{required:!0},urls:Joose.I.Object,maxLoads:5,project:null},methods:{cache:function(callback,errback,ignoreErrors){if(this.disabled)callback&&callback();else{var urls=this.urls,me=this;Joose.A.each(this.presets,function(preset){preset.eachResource(function(resource){resource.url&&(urls[resource.url]=null)})});var loadCount=0,errorCount=0,urlsArray=[];Joose.O.each(urls,function(value,url){me.hasContentOf(url)||urlsArray.push(url)});var total=urlsArray.length;if(total)for(var loadSingle=function(){if(urlsArray.length){var url=urlsArray.shift();me.load(url,function(content){errorCount||(urls[url]=content,++loadCount==total?callback&&callback():loadSingle())},ignoreErrors?function(){++loadCount==total?callback&&callback():loadSingle()}:function(){errorCount++,errback&&errback(url)})}},i=0;i<this.maxLoads;i++)loadSingle();else callback&&callback()}},load:function(url,callback,errback){throw"abstract method `load` called"},addContent:function(url,content){this.urls[url]=content},hasContentOf:function(url){return url instanceof Siesta.Content.Resource&&(url=url.url),"string"==typeof this.urls[url]},getContentOf:function(url){return url instanceof Siesta.Content.Resource&&(url=url.url),this.urls[url]}}}),Class("Siesta",{VERSION:"5.3.2",my:{has:{config:null,activeHarness:null,license:"%LICENSE%"},methods:{getConfigForTestScript:function(text){try{return eval(text),this.config}catch(e){return null}},StartTest:function(arg1,arg2){this.config="object"==typeof arg1?arg1:"object"==typeof arg2?arg2:null}}}}),"undefined"==typeof StartTest&&(StartTest=Siesta.StartTest),"undefined"==typeof startTest&&(startTest=Siesta.StartTest),"undefined"==typeof describe&&(describe=Siesta.StartTest),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function fNOP(){}function fBound(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this;return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound}),Siesta.CurrentLocale=Siesta.CurrentLocale||{"Siesta.Project":{preloadHasFailed:"Preload of {url} has failed",preloadHasFailedForTest:"Preload of {url} has failed for test {test}",staticDeprecationWarning:"You are calling static method `{methodName}` of the project class {projectClass}. Such usage is deprecated now, please switch to creation of the project class instance: `var project = new {projectClass}()`",resourceFailedToLoad:"Loading of a {nodeName} resource failed",crossOriginFailed:"Failed to access cross-origin page: {url}. \nIn general tests should reside on the same domain as the app itself,\nbut you can try to disable web security:\nhttps://www.bryntum.com/blog/testing-x-domain-websites-with-siesta-in-chrome/"},"Siesta.Project.Browser.UI.AboutWindow":{upgradeText:"Upgrade to Siesta Standard",closeText:"Close",titleText:"ABOUT SIESTA (v{VERSION})",bodyText:'<img height="35" src="https://www.bryntum.com/bryntum-logo.png"/><p>Siesta is a JavaScript unit and functional test tool made by <a target="_blank" href="https://www.bryntum.com">Bryntum</a>. You can test any web page or JavaScript code, including Ext JS, jQuery or NodeJS. Siesta comes in two versions: <strong>Lite</strong> and <strong>Standard</strong>. With Lite, you can launch your tests in the browser UI. With the Standard version, you can also automate your tests and use the automation scripts together with tools like Puppeteer or Selenium WebDriver. </p>Siesta would not be possible without these awesome products & libraries: <br><ul style="padding:0 0 0 30px"><li><a href="http://sencha.com/extjs">Ext JS</a></li><li><a href="http://jquery.com">jQuery</a></li><li><a href="http://http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a></li><li><a href="http://joose.it/">Joose</a></li><li><a href="https://github.com/gotwarlost/istanbul">Istanbul</a></li></ul>'},"Siesta.Project.Browser.UI.AssertionGrid":{initializingText:"Initializing test..."},"Siesta.Project.Browser.UI.CoverageReport":{closeText:"Close",showText:"Show: ",lowText:"Low",mediumText:"Med",highText:"High",statementsText:"Statements",branchesText:"Branches",functionsText:"Functions",linesText:"Lines",loadingText:"Loading coverage data...",loadingErrorText:"Loading error",loadingErrorMessageText:"Could not load the report data from this url: ",globalNamespaceText:"[Global namespace]"},"Siesta.Project.Browser.UI.DomContainer":{title:"DOM Panel",viewDocsText:"View documentation for ",docsUrlText:"http://docs.sencha.com/{0}/apidocs/#!/api/{1}"},"Siesta.Project.Browser.UI.ResultPanel":{rerunText:"Run test",toggleDomVisibleText:"Toggle DOM visible",viewSourceText:"View source",showFailedOnlyText:"Show failed only",componentInspectorText:"Toggle Ext Component Inspector",eventRecorderText:"Event Recorder",closeText:"Close"},"Siesta.Project.Browser.UI.TestGrid":{mouseSimulation:"Mouse simulation",title:"Test list",nameText:"Name",filterTestsText:"Filter tests",expandCollapseAllText:"Expand / Collapse all",runCheckedText:"Run checked",runFailedText:"Run failed",runAllText:"Run all",observerModeText:"Observer mode",observerModeTooltip:"Sets the `forceDOMVisible` and `runCore=sequential` globally",passText:"Pass",failText:"Fail",optionsText:"Options...",todoPassedText:"todo assertion(s) passed",todoFailedText:"todo assertion(s) failed",viewDomText:"View DOM",transparentExText:"Transparent exceptions",transparentExTooltip:"Disable internal try/catch for any exceptions from tests. Useful for debugging.",cachePreloadsText:"Cache preloads",autoLaunchText:"Auto launch",autoLaunchTooltip:"Launch the test suite immediately after project page load.",speedRunText:"Fast (still accurate)",speedRunTooltip:"Reduce mouse cursor visualization quality to run tests faster",turboMode:"Very fast, but inaccurate",turboModeTooltip:"Sets the `mouseMovePrecision` option to `Infinity`. Read the docs before using.",breakOnFailText:"Break on fail",breakOnFailTooltip:"Stop the test suite on first failed assertion",debuggerOnFailText:"Debugger on fail",debuggerOnFailTooltip:"Issue a `debugger` statement on any failed assertion. Useful for debugging",aboutText:"About Siesta",documentationText:"Siesta Documentation",siestaDocsUrl:"https://bryntum.com/docs/siesta",filterFieldTooltip:["Supported patterns for tests filtering:\n","WORD - any word, will match with the test file name (no directory part)\n","WORD | WORD - any of the alternative patterns\n","GROUP > TEST - first match GROUP with the group name, then TEST with tests inside that group\n","GROUP1 | GROUP2 > TEST1 | TEST2 - alternation support for groups too\n"].join(""),landscape:"Landscape"},"Siesta.Project.Browser.UI.VersionUpdateButton":{newUpdateText:"New Update Available...",updateWindowTitleText:"New version available for download! Current version: ",cancelText:"Cancel",changelogLoadFailedText:"Bummer! Failed to fetch changelog.",downloadText:"Download ",liteText:" (Lite)",standardText:" (Standard)",loadingChangelogText:"Loading changelog..."},"Siesta.Project.Browser.UI.Viewport":{apiLinkText:"API Documentation",apiLinkUrl:"https://bryntum.com/docs/siesta",uncheckOthersText:"Uncheck others (and check this)",uncheckAllText:"Uncheck all",checkAllText:"Check all",runThisText:"Run this",expandAll:"Expand all",collapseAll:"Collapse all",filterToCurrentGroup:"Filter to current group",filterToFailed:"Filter to failed",httpWarningTitle:"You must use a web server",httpWarningDesc:"You must run Siesta in a web server context, and not using the file:/// protocol",viewSource:"View source"},"Siesta.Project.Browser":{codeCoverageWarningText:"Can not enable code coverage - did you forget to include the `siesta-coverage-all.js` on the project page?",noJasmine:"No `jasmine` object found on spec runner page",noJasmineSiestaReporter:"Can't find SiestaReporter in Jasmine. \nDid you add the `siesta/bin/jasmine-siesta-reporter.js` file to your spec runner page?"},"Siesta.Result.Assertion":{todoText:"TODO: ",passText:"ok",failText:"fail"},"Siesta.Role.ConsoleReporter":{passText:"PASS",failText:"FAIL",warnText:"WARN",errorText:"ERROR",missingFileText:"Test file [{URL}] not found.",allTestsPassedText:"All tests passed",failuresFoundText:"There are failures"},"Siesta.Test.Action.Drag":{byOrToMissingText:'Either "to" or "by" configuration option is required for "drag" step',byAndToDefinedText:'Exactly one of "to" or "by" configuration options is required for "drag" step, not both'},"Siesta.Test.Action.Eval":{invalidMethodNameText:"Invalid method name: ",wrongFormatText:"Wrong format of the action string: ",parseErrorText:"Can't parse arguments: "},"Siesta.Test.Action.Wait":{missingMethodText:"Could not find a waitFor method named "},"Siesta.Test.BDD.Expectation":{expectText:"Expect",needNotText:"Need not",needText:"Need",needMatchingText:"Need matching",needNotMatchingText:"Need not matching",needStringNotContainingText:"Need string not containing",needStringContainingText:"Need string containing",needArrayNotContainingText:"Need array not containing",needArrayContainingText:"Need array containing",needGreaterEqualThanText:"Need value greater or equal than",needGreaterThanText:"Need value greater than",needLessThanText:"Need value less than",needLessEqualThanText:"Need value less or equal than",needValueNotCloseToText:"Need value not close to",needValueCloseToText:"Need value close to",toBeText:"to be",toBeDefinedText:"to be defined",toBeUndefinedText:"to be undefined",toBeEqualToText:"to be equal to",toBeTruthyText:"to be truthy",toBeFalsyText:"to be falsy",toMatchText:"to match",toContainText:"to contain",toBeLessThanText:"to be less than",toBeGreaterThanText:"to be greater than",toBeCloseToText:"to be close to",toThrowText:"to throw exception",thresholdIsText:"Threshold is ",exactMatchText:"Exact match text",thrownExceptionText:"Thrown exception",noExceptionThrownText:"No exception thrown",wrongSpy:"Incorrect spy instance",toHaveBeenCalledDescTpl:"Expect method {methodName} to have been called {!need} times",actualNbrOfCalls:"Actual number of calls",expectedNbrOfCalls:"Expected number of calls",toHaveBeenCalledWithDescTpl:"Expect method {methodName} to have been called at least once with the specified arguments"},"Siesta.Test.ExtJS.Ajax":{ajaxIsLoading:"An Ajax call is currently loading",allAjaxRequestsToComplete:"all ajax requests to complete",ajaxRequest:"ajax request",toComplete:"to complete"},"Siesta.Test.ExtJS.Component":{badInputText:"Expected an Ext.Component, got",toBeVisible:"to be visible",toNotBeVisible:"to not be visible",component:"component",Component:"Component",componentQuery:"componentQuery",compositeQuery:"composite query",toReturnEmptyArray:"to return an empty array",toReturnEmpty:"to return empty",toReturnAVisibleComponent:"to return a visible component",toReturnHiddenCmp:"to return a hidden/missing component",invalidDestroysOkInput:"No components provided, or component query returned empty result",exception:"Exception",exceptionAnnotation:'Exception thrown while calling "destroy" method of',destroyFailed:"was not destroyed (probably destroy was canceled in the `beforedestroy` listener)",destroyPassed:"All passed components were destroyed ok"},"Siesta.Test.ExtJS.DataView":{view:"view",toRender:"to render"},"Siesta.Test.ExtJS.Element":{top:"top",left:"left",bottom:"bottom",right:"right"},"Siesta.Test.ExtJS.Grid":{waitForRowsVisible:"rows to show for panel with id",waitForCellEmpty:"cell to be empty"},"Siesta.Test.ExtJS.Observable":{hasListenerInvalid:"1st argument for `t.hasListener` should be an observable instance",hasListenerPass:"Observable has listener for {eventName}",hasListenerFail:"Provided observable has no listeners for event",isFiredWithSignatureNotFired:"event was not fired during the test",observableFired:"Observable fired",correctSignature:"with correct signature",incorrectSignature:"with incorrect signature"},"Siesta.Test.ExtJS.Store":{storesToLoad:"stores to load",failedToLoadStore:"Failed to load the store",URL:"URL"},"Siesta.Test.Action":{missingTestAction:"Action [{0}] requires `{1}` method in your test class"},"Siesta.Test.BDD":{codeBodyMissing:"Code body is not provided for",codeBodyOf:"Code body of",missingFirstArg:"does not declare a test instance as 1st argument",iitFound:"t.iit should only be used during debugging",noObject:"No object to spy on"},"Siesta.Test.BDD.Spy":{spyingNotOnFunction:"Trying to create a spy over a non-function property"},"Siesta.Test.Browser":{popupsDisabled:"Failed to open the popup for url: {url}. Enable the popups in the browser settings.",noDomElementFound:"No DOM element found for CSS selector",noActionTargetFound:"No action target found for",waitForEvent:"observable to fire its",event:"event",wrongFormat:"Wrong format for expected number of events",unrecognizedSignature:"Unrecognized signature for `firesOk`",observableFired:"Observable fired",observableFiredOk:"Observable fired expected number of",actualNbrEvents:"Actual number of events",expectedNbrEvents:"Expected number of events",events:"events",noElementFound:"Could not find any element at",targetElementOfAction:"Target element of action",targetElementOfSomeAction:"Target element of some action",isNotVisible:"is not visible or not reachable",text:"text",toBePresent:"to be present",toNotBePresent:"to not be present",target:"target",toAppear:"to appear",targetMoved:"Moving target detected, retargeting initiated",alertMethodNotCalled:"Expected a call to alert()",focusLostWarning:"Focus has left the test window {url}",focusLostWarningLauncher:"Focus has left the test window {url}, it will be restarted. This behavior is controled with the --restart-on-blur option."},"Siesta.Test.Date":{isEqualTo:"is equal to",Got:"Got"},"Siesta.Test.Element":{elementContent:"element content",toAppear:"to appear",toDisappear:"to disappear",toAppearAt:"to appear at",monkeyException:"Monkey testing action did not complete properly - probably an exception was thrown",monkeyNoExceptions:"No exceptions thrown during monkey test",monkeyActionLog:"Monkey action log",elementHasClass:"Element has the CSS class",elementHasNoClass:"Element has no CSS class",elementClasses:"Classes of element",needClass:"Need CSS class",hasStyleDescTpl:"Element has correct {value} for CSS style {property}",elementStyles:"Styles of element",needStyle:"Need style",hasNotStyleDescTpl:"Element does not have: {value} for CSS style {property}",hasTheStyle:"Element has the style",element:"element",toBeTopEl:"to be the top element at its position",toNotBeTopEl:"to not be the top element at its position",selector:"selector",selectors:"selectors",noCssSelector:"A CSS selector must be supplied",waitForSelectorsBadInput:"An array of CSS selectors must be supplied",Position:"Position",noElementAtPosition:"No element found at the specified position",elementIsAtDescTpl:"DOM element or its child is at [ {x}, {y} ] coordinates",topElement:"Top element",elementIsAtPassTpl:"DOM element is at [ {x}, {y} ] coordinates",allowChildrenDesc:"Need exactly this or its child",allowChildrenAnnotation:"Passed element is not the top-most one and not the child of one",shouldBe:"Should be",noChildrenFailAnnotation:"Passed element is not the top-most one",topLeft:"(t-l)",bottomLeft:"(b-l)",topRight:"(t-r)",bottomRight:"(b-r)",elementIsNotTopElementPassTpl:"Element is not the top element on the screen",selectorIsAtPassTpl:"Found element matching CSS selector {selector} at [ {xy} ]",elementMatching:"Element matching",selectorIsAtFailAnnotation:"Passed selector does not match any selector at",selectorExistsFailTpl:"No element matching the passed selector found",selectorExistsPassTpl:"Found DOM element(s) matching CSS selector {selector}",selectorNotExistsFailTpl:"Elements found matching the passed selector",selectorNotExistsPassTpl:"Did not find any DOM element(s) matching CSS selector {selector}",toChangeForElement:"to change for element",selectorCountIsPassTpl:"Found exactly {count} elements matching {selector}",selectorCountIsFailTpl:"Found {got} elements matching the selector {selector}, expected {need}",isInViewPassTpl:"Passed element is within the visible viewport",toAppearInTheViewport:"to appear in the viewport",elementIsEmptyPassTpl:"Passed element is empty",elementIsNotEmptyPassTpl:"Passed element is not empty",elementToBeEmpty:"element to be empty",elementToNotBeEmpty:"element to not be empty"},"Siesta.Test.ExtJS":{bundleUrlNotFound:"Cannot find Ext JS bundle url",assertNoGlobalExtOverridesInvalid:"Was not able to find the Ext JS bundle URL in the `assertNoGlobalExtOverrides` assertion",assertNoGlobalExtOverridesPassTpl:"No global Ext overrides found",assertNoGlobalExtOverridesGotDesc:"Number of overrides found",foundOverridesFor:"Found overrides for",animationsToFinalize:"animations to finalize",extOverridesInvalid:"Was not able to find the ExtJS bundle URL in the `assertMaxNumberOfGlobalExtOverrides` assertion)",foundLessOrEqualThan:"Found less or equal than",nbrOverridesFound:"Number of overrides found",globalOverrides:"Ext JS global overrides"},"Siesta.Test.ExtJSCore":{waitedForRequires:"Waiting for required classes took too long - \nCheck the `Net` tab in Firebug and the `loaderPath` config",waitedForExt:"Waiting for Ext.onReady took too long - probably some dependency could not be loaded. \nCheck the `Net` tab in Firebug and the `loaderPath` config",waitedForApp:"Waiting for MVC application launch took too long - no MVC application on test page? \nYou may need to disable the `waitForAppReady` config option",noComponentMatch:'Your component query: "{component}" returned no components',multipleComponentMatch:'Your component query: "{component}" returned more than 1 component',noComponentFound:"No component found for CQ",knownBugIn:"Known bug in",Class:"Class",wasLoaded:"was loaded",wasNotLoaded:"was not loaded",invalidCompositeQuery:"Invalid composite query selector",ComponentQuery:"ComponentQuery",CompositeQuery:"CompositeQuery",matchedNoCmp:"matched no Ext.Component",messageBoxVisible:"Message box is visible",messageBoxHidden:"Message box is hidden",waitedForComponentQuery:"Waiting too long for Ext.ComponentQuery"},"Siesta.Test.Function":{Need:"need",atLeast:"at least",exactly:"exactly",methodCalledExactly:"method was called exactly {n} times",exceptionEvalutingClass:"Exception [{e}] caught while evaluating the class name"},"Siesta.Test.More":{isGreaterPassTpl:"`{value1}` is greater than `{value2}`",isLessPassTpl:"`{value1}` is less than `{value2}`",isGreaterEqualPassTpl:"`{value1}` is greater or equal to`{value2}`",isLessEqualPassTpl:"`{value1}` is less or equal to`{value2}`",isApproxToPassTpl:"`{value1}` is approximately equal to `{value2}`",needGreaterThan:"Need greater than",needGreaterEqualTo:"Need greater or equal to",needLessThan:"Need less than",needLessEqualTo:"Need less or equal to",exactMatch:"Exact match",withinThreshold:"Match within treshhold",needApprox:"Need approx",thresholdIs:"Threshold is",stringMatchesRe:"`{string}` matches regexp {regex}",stringNotMatchesRe:"`{string}` does not match regexp {regex}",needStringMatching:"Need string matching",needStringNotMatching:"Need string not matching",needStringContaining:"Need string containing",needStringNotContaining:"Need string not containing",stringHasSubstring:"`{string}` has a substring: `{regex}`",stringHasNoSubstring:"`{string}` does not have a substring: `{regex}`",throwsOkInvalid:"throws_ok accepts a function as 1st argument",didntThrow:"Function did not throw an exception",exMatchesRe:"Function throws exception matching to {expected}",exceptionStringifiesTo:"Exception stringifies to",exContainsSubstring:"Function throws exception containing a substring: {expected}",fnDoesntThrow:"Function does not throw any exceptions",fnThrew:"Function threw an exception",isInstanceOfPass:"Object is an instance of the specified class",needInstanceOf:"Need instance of",isAString:"{value} is a string",aStringValue:"AStringValue",isAnObject:"{value} is an object",anObject:"An object value",isAnArray:"{value} is an array",anArrayValue:"An array value",isANumber:"{value} is a number",aNumberValue:"a number value",isABoolean:"{value} is a boolean",aBooleanValue:"a number value",isADate:"{value} is a date",aDateValue:"a date value",isARe:"{value} is a regular expression",aReValue:"a regular expression",isAFunction:"{value} is a function",aFunctionValue:"a function",isDeeplyPassTpl:"{obj1} is deeply equal to {obj2}",isDeeplyStrictPassTpl:"{obj1} is strictly deeply equal to {obj2}",globalCheckNotSupported:"Testing leakage of global variables is not supported on this platform",globalVariables:"Global Variables",noGlobalsFound:"No unexpected global variables found",globalFound:"Unexpected global found",globalName:"Global name",value:"value",conditionToBeFulfilled:"condition to be fulfilled",pageToLoad:"page to load",ms:"ms",waitingFor:"Waiting for",waitedTooLong:"Waited too long for",conditionNotFulfilled:"Condition was not fullfilled during",waitingAborted:"Waiting aborted",Waited:"Waited",checkerException:"checker threw an exception",Exception:"Exception",msFor:"ms for",forcedWaitFinalization:"Forced finalization of waiting for",chainStepNotCompleted:"The step in `t.chain()` call did not complete within required timeframe, chain can not proceed",stepNumber:"Step number",oneBased:"(1-based)",atLine:"At line",chainStepEx:"Chain step threw an exception",stepFn:"Step function",notUsingNext:'does not use the provided "next" function anywhere',calledMoreThanOnce:"The `next` callback of {num} step (1-based) of `t.chain()` call at line {line} is called more than once.",tooManyDifferences:"Showing {num} of {total} differences"},"Siesta.Test.SenchaTouch":{STSetupFailed:"Waiting for Ext.setup took too long - some dependency could not be loaded? Check the `Net` tab in Firebug",invalidSwipeDir:"Invalid swipe direction",moveFingerByInvalidInput:"Trying to call moveFingerBy without relative distances",scrollUntilFailed:"scrollUntil failed to achieve its mission",scrollUntilElementVisibleInvalid:"scrollUntilElementVisible: target or scrollable not provided",scrollerReachPos:"scroller to reach position"},"Siesta.Test":{noCodeProvidedToTest:"No code provided to test",addingAssertionsAfterDone:"Adding assertions after the test has finished",testFailedAndAborted:"Assertion failed, test execution aborted",atLine:"at line",of:"of",character:"character",isTruthy:'`{value}` is a "truthy" value',needTruthy:'Need "truthy" value',isFalsy:'`{value}` is a "falsy" value',needFalsy:'Need "falsy" value',isEqualTo:"`{got}` is equal to `{expected}`",isNotEqualTo:"`{got}` is not equal to `{expected}`",needNot:"Need not",isStrictlyEqual:"`{got}` is strictly equal to `{expected}`",needStrictly:"Need strictly",isStrictlyNotEqual:"`{got}` is strictly not equal to `{expected}`",needStrictlyNot:"Need strictly not",alreadyWaiting:"Already waiting with title",noOngoingWait:"There is no ongoing `wait` action with title",noMatchingEndAsync:"No matching `endAsync` call within {time}ms",endAsyncMisuse:"Calls to endAsync without argument should only be performed if you have single beginAsync statement",codeBodyMissingForSubTest:"Code body is not provided for sub test [{name}]",codeBodyMissingTestArg:"Code body of sub test [{name}] does not declare a test instance as 1st argument",Subtest:"Subtest",Test:"Test",failedToFinishWithin:"Subtest {name} failed to finish within {timeout}ms",threwException:"threw an exception",testAlreadyStarted:"Test has already been started",setupTookTooLong:"`setup` method took too long to complete",errorBeforeTestStarted:"Error happened before the test started",testStillRunning:"Your test is still considered to be running, if this is unexpected please see console for more information",testNotFinalized:'Your test [{url}] has not finalized, most likely since a timer (setTimeout) is still active. If this is the expected behavior, try setting "overrideSetTimeout : false" on your Harness configuration.',missingDoneCall:"Test has completed, but there was no `t.done()` call. Add it at the bottom, or use `t.beginAsync()` for asynchronous code",allTestsPassed:"All tests passed","Snoozed until":"Snoozed until",testTearDownTimeout:"Test's tear down process has timeout out"},"Siesta.Recorder.UI.Editor.Code":{invalidSyntax:"Invalid syntax"},"Siesta.Recorder.UI.Editor.DragTarget":{targetLabel:"Target",toLabel:"To",byLabel:"By",cancelButtonText:"Cancel",saveButtonText:"Save",dragVariantTitle:"Edit `drag` action",moveCursorVariantTitle:"Edit `moveCursor` action"},"Siesta.Recorder.UI.RecorderPanel":{actionColumnHeader:"Action",offsetColumnHeader:"Offset",queryMatchesNothing:"Query matches no DOM elements or components",queryMatchesMultiple:"Query matches multiple components",noVisibleElsFound:"No visible elements found for target",noTestDetected:"No test detected",noTestStarted:"You need to run a test first, or provide a Page URL",recordTooltip:"Record",stopTooltip:"Stop",playTooltip:"Play",clearTooltip:"Clear all",codeWindowTitle:"Code",addNewTooltip:"Add a new step",removeAllPromptTitle:"Remove all?",removeAllPromptMessage:"Do you want to clear the recorded events?",Error:"Error",showSource:"Show source",showSourceInNewWindow:"Show source in new window",newRecording:"New recording...",pageUrl:"Page URL"},"Siesta.Recorder.UI.TargetColumn":{headerText:"Target / Value",by:"by",to:"to",coordinateTargetWarning:"Siesta was unable to find a stable selector for this target. Using coordinates as locator is not recommended."}},Siesta.Resource=function(){var cacheByNamespace={},Resource=Class({does:Siesta.Util.Role.CanFormatStrings,has:{dict:null},methods:{get:function(key,data){var text=this.dict[key];return text?this.formatString(text,data):(window.console&&console.error&&window.top.console.error("TEXT_NOT_DEFINED: "+key),"TEXT_NOT_DEFINED: "+key)}}});return function(namespace,key,data){var dictionary=Siesta.CurrentLocale[namespace];if(!dictionary)throw"Missing dictionary for namespace: "+namespace;var resource=cacheByNamespace[namespace];return resource=resource||(cacheByNamespace[namespace]=new Resource({dict:dictionary,serializeFormatingPlaceholders:!1})),key?resource.get(key,data):resource}}(),function(){var ID=0;Class("Siesta.Result",{has:{description:null,children:Joose.I.Array,length:0,id:function(){return++ID},parent:null},methods:{itemAt:function(i){return this.children[i]},push:function(result){this.children.push(result),(result.parent=this).length=this.children.length},each:function(func,scope){var children=this.children;if(!1===func.call(scope||this,this))return!1;for(var i=0;i<children.length;i++)if(!1===children[i].each(func,scope))return!1},eachChild:function(func,scope){for(var children=this.children,i=0;i<children.length;i++)if(!1===func.call(scope,children[i]))return!1},toString:function(){return this.description},toJSON:function(){return{type:this.meta.name,description:this.description}},findChildById:function(id){var child;return this.each(function(node){if(node.id==id)return child=node,!1}),child}},my:{methods:{seedID:function(value){ID=value}}}})}(),Class("Siesta.Result.Diagnostic",{isa:Siesta.Result,has:{isWarning:!1},methods:{toString:function(){return"# "+this.description},toJSON:function(){var info={parentId:this.parent.id,type:this.meta.name,description:this.description};return this.isWarning&&(info.isWarning=!0),info}}}),Class("Siesta.Result.Summary",{isa:Siesta.Result,has:{isFailed:!1},methods:{getTest:function(){return this.parent.test},toString:function(){}}}),Class("Siesta.Result.Assertion",{isa:Siesta.Result,has:{name:null,passed:null,annotation:null,index:null,sourceLine:null,isTodo:!1,isException:!1,exceptionType:null,isWaitFor:!1,completed:!1},methods:{isPassed:function(raw){return raw?this.passed:!!this.isTodo||(!(!this.isWaitFor||this.completed)||this.passed)},toString:function(){var R=Siesta.Resource("Siesta.Result.Assertion"),text=(this.isTodo?R.get("todoText"):"")+(this.passed?R.get("passText"):R.get("failText"))+" "+this.index+" - "+this.description;return this.annotation&&(text+="\n"+this.annotation),text},toJSON:function(){var me=this,info={parentId:this.parent.id,type:this.meta.name,passed:this.passed,index:this.index,description:String(this.description)||"No description"};return this.annotation&&(info.annotation=String(this.annotation)),Joose.A.each(["isTodo","isWaitFor","isException","sourceLine","name"],function(name){me[name]&&(info[name]=me[name])}),this.isException&&(info.exceptionType=this.exceptionType),info}}}),Class("Siesta.Result.SubTest",{isa:Siesta.Result,has:{test:null},methods:{isWorking:function(){return!this.test.isFinished()},toJSON:function(){var test=this.test,isCrossContext=!(test instanceof Object),report={id:this.id,parentId:test.parent?test.parent.getResults().id:null,type:this.meta.name,name:test.name,startDate:test.startDate,endDate:test.endDate||+new Date,passed:isCrossContext?null:test.isPassed()};test.parent||(report.automationElementId=test.automationElementId,report.url=test.url,report.jUnitClass=test.getJUnitClass(),report.groups=test.groups),test.specType&&(report.bddSpecType=test.specType),test.isTodo&&(report.isTodo=!0);var isFailed=!1,assertions=[];return Joose.A.each(this.children,function(result){if(result instanceof Siesta.Result.Assertion||result instanceof Siesta.Result.Diagnostic||result instanceof Siesta.Result.SubTest){var assertion=result.toJSON();assertion.passed||assertion.isTodo||(isFailed=!0),assertions.push(assertion)}}),report.assertions=assertions,isCrossContext&&(report.passed=!(isFailed||test.failed||!test.endDate)),report}}}),Role("Siesta.Test.Function",{methods:{isCalled:function(fn,obj,desc){this.isCalledNTimes(fn,obj,1,desc,!0)},isCalledOnce:function(fn,obj,desc){this.isCalledNTimes(fn,obj,1,desc,!1)},isCalledNTimes:function(fn,obj,n,desc,isGreaterEqual){var me=this,prop="string"==typeof fn?fn:me.getPropertyName(obj,fn),counter=0,original=obj[prop];obj[prop]=function(){return counter++,original.apply(this,arguments)},desc=desc?desc+" ":"",this.on("beforetestfinalizeearly",function(){var R=Siesta.Resource("Siesta.Test.Function");counter===n||isGreaterEqual&&n<counter?me.pass(desc||prop+" "+R.get("methodCalledExactly").replace("{n}",n)):me.fail(desc||prop,{assertionName:"isCalledNTimes "+prop,got:counter,need:n,needDesc:R.get("Need")+" "+(isGreaterEqual?R.get("atLeast"):R.get("exactly"))+" "}),obj[prop]=original})},isntCalled:function(fn,obj,desc){this.isCalledNTimes(fn,obj,0,desc)},getPropertyName:function(host,obj){for(var o in host)if(host[o]===obj)return o},methodIsCalledNTimes:function(fn,className,n,desc,isGreaterEqual){var me=this,counter=0,R=Siesta.Resource("Siesta.Test.Function");desc=desc?desc+" ":"";try{"String"==me.typeOf(className)&&(className=me.global.eval(className))}catch(e){return void me.fail(desc,{assertionName:"isMethodCalled",annotation:R.get("exceptionEvalutingClass").replace("{e}",e)+"["+className+"]"})}var prototype=className.prototype,prop="string"==typeof fn?fn:me.getPropertyName(prototype,fn);me.on("beforetestfinalizeearly",function(){counter===n||isGreaterEqual&&n<counter?me.pass(desc||prop+" "+R.get("methodCalledExactly").replace("{n}",n)):me.fail(desc||prop,{assertionName:"methodIsCalledNTimes "+prop,got:counter,need:n,needDesc:R.get("Need")+" "+(isGreaterEqual?R.get("atLeast"):R.get("exactly"))+" "})}),fn=prototype[prop],prototype[prop]=function(){return counter++,fn.apply(this,arguments)}},methodIsCalled:function(fn,className,desc){this.methodIsCalledNTimes(fn,className,1,desc,!0)},methodIsntCalled:function(fn,className,desc){this.methodIsCalledNTimes(fn,className,0,desc)}}}),Role("Siesta.Test.Date",{methods:{isDateEq:function(got,expectedDate,description){this.isDateEqual.apply(this,arguments)},isDateEqual:function(got,expectedDate,description){var R=Siesta.Resource("Siesta.Test.Date");got-expectedDate==0?this.pass(description,{descTpl:"{got} "+R.get("isEqualTo")+" {expectedDate}",got:got,expectedDate:expectedDate}):this.fail(description,{assertionName:"isDateEqual",got:got?got.toString():"",gotDesc:R.get("Got"),need:expectedDate.toString()})}}}),Role("Siesta.Test.More",{requires:["isFailed","typeOf","on"],has:{autoCheckGlobals:!1,expectedGlobals:Joose.I.Array,disableGlobalsCheck:!1,browserGlobals:{init:["console","getInterface","ExtBox1","__IE_DEVTOOLBAR_CONSOLE_COMMAND_LINE",/__BROWSERTOOLS/,"seleniumAlert","onload","onerror","StartTest","startTest","__loaderInstrumentationHookInstalled__","describe","setTimeout","clearTimeout","requestAnimationFrame","cancelAnimationFrame","__coverage__",/cov_\w+/]},waitForTimeout:1e4,waitForPollInterval:100,suppressPassedWaitForAssertion:!1},methods:{isGreater:function(value1,value2,desc){var R=Siesta.Resource("Siesta.Test.More");value2<value1?this.pass(desc,{descTpl:R.get("isGreaterPassTpl"),value1:value1,value2:value2}):this.fail(desc,{assertionName:"isGreater",got:value1,need:value2,needDesc:R.get("needGreaterThan")})},isLess:function(value1,value2,desc){var R=Siesta.Resource("Siesta.Test.More");value1<value2?this.pass(desc,{descTpl:R.get("isLessPassTpl"),value1:value1,value2:value2}):this.fail(desc,{assertionName:"isLess",got:value1,need:value2,needDesc:R.get("needLessThan")})},isGE:function(){this.isGreaterOrEqual.apply(this,arguments)},isGreaterOrEqual:function(value1,value2,desc){var R=Siesta.Resource("Siesta.Test.More");value2<=value1?this.pass(desc,{descTpl:R.get("isGreaterEqualPassTpl"),value1:value1,value2:value2}):this.fail(desc,{assertionName:"isGreaterOrEqual",got:value1,need:value2,needDesc:R.get("needGreaterEqualTo")})},isLE:function(){this.isLessOrEqual.apply(this,arguments)},isLessOrEqual:function(value1,value2,desc){var R=Siesta.Resource("Siesta.Test.More");value1<=value2?this.pass(desc,{descTpl:R.get("isLessEqualPassTpl"),value1:value1,value2:value2}):this.fail(desc,{assertionName:"isLessOrEqual",got:value1,need:value2,needDesc:R.get("needLessEqualTo")})},isApprox:function(value1,value2,threshold,desc){var R=Siesta.Resource("Siesta.Test.More");2==arguments.length&&(threshold=Math.abs(.05*value1)),3==arguments.length&&"String"==this.typeOf(threshold)&&(desc=threshold,threshold=Math.abs(.05*value1));Math.abs(function(value1,value2){function fractionalLength(v){var afterPointPart=(v+"").split(".")[1];return afterPointPart&&afterPointPart.length||0}var maxLength=Math.max(fractionalLength(value1),fractionalLength(value2)),k=Math.pow(10,maxLength);return(value1*k-value2*k)/k}(value2,value1))<=threshold?this.pass(desc,{descTpl:R.get("isApproxToPassTpl"),value1:value1,value2:value2,annotation:value2==value1?R.get("exactMatch"):R.get("withinThreshold")+": "+threshold}):this.fail(desc,{assertionName:"isApprox",got:value1,need:value2,needDesc:R.get("needApprox"),annotation:R.get("thresholdIs")+": "+threshold})},like:function(string,regex,desc){var R=Siesta.Resource("Siesta.Test.More");"RegExp"==this.typeOf(regex)?string.match(regex)?this.pass(desc,{descTpl:R.get("stringMatchesRe"),string:string,regex:regex}):this.fail(desc,{assertionName:"like",got:string,need:regex,needDesc:R.get("needStringMatching")}):-1!=string.indexOf(regex)?this.pass(desc,{descTpl:R.get("stringHasSubstring"),string:string,regex:regex}):this.fail(desc,{assertionName:"like",got:string,need:regex,needDesc:R.get("needStringContaining")})},unlike:function(string,regex,desc){var R=Siesta.Resource("Siesta.Test.More");"RegExp"==this.typeOf(regex)?string.match(regex)?this.fail(desc,{assertionName:"unlike",got:string,need:regex,needDesc:R.get("needStringNotMatching")}):this.pass(desc,{descTpl:R.get("stringNotMatchesRe"),string:string,regex:regex}):-1==string.indexOf(regex)?this.pass(desc,{descTpl:R.get("stringHasNoSubstring"),string:string,regex:regex}):this.fail(desc,{assertionName:"unlike",got:string,need:regex,needDesc:R.get("needStringNotContaining")})},throws:function(){this.throwsOk.apply(this,arguments)},throws_ok:function(){this.throwsOk.apply(this,arguments)},throwsOk:function(func,expected,desc){var R=Siesta.Resource("Siesta.Test.More");if("Function"!=this.typeOf(func))throw new Error(R.get("throwsOkInvalid"));var e=this.getExceptionCatcher()(func);void 0!==e?(e instanceof this.getTestErrorClass()&&(e=e.message||e.description),e=""+e,"RegExp"==this.typeOf(expected)?e.match(expected)?this.pass(desc,{descTpl:R.get("exMatchesRe"),expected:expected}):this.fail(desc,{assertionName:"throws_ok",got:e,gotDesc:R.get("exceptionStringifiesTo"),need:expected,needDesc:R.get("needStringMatching")}):-1!=e.indexOf(expected)?this.pass(desc,{descTpl:R.get("exContainsSubstring"),expected:expected}):this.fail(desc,{assertionName:"throws_ok",got:e,gotDesc:R.get("exceptionStringifiesTo"),need:expected,needDesc:R.get("needStringContaining")})):this.fail(desc,{assertionName:"throws_ok",annotation:R.get("didntThrow")})},lives_ok:function(){this.livesOk.apply(this,arguments)},lives:function(){this.livesOk.apply(this,arguments)},livesOk:function(func,desc){"Function"!=this.typeOf(func)&&(func=[desc,desc=func][0]);var R=Siesta.Resource("Siesta.Test.More"),e=this.getExceptionCatcher()(func);void 0===e?this.pass(desc,{descTpl:R.get("fnDoesntThrow")}):this.fail(desc,{assertionName:"lives_ok",annotation:R.get("fnThrew")+": "+e})},isa_ok:function(value,className,desc){this.isInstanceOf(value,className,desc)},isaOk:function(value,className,desc){this.isInstanceOf(value,className,desc)},isInstanceOf:function(value,className,desc){var R=Siesta.Resource("Siesta.Test.More");try{"String"==this.typeOf(className)&&(className=this.global.eval(className))}catch(e){return void this.fail(desc,{assertionName:"isa_ok",annotation:Siesta.Resource("Siesta.Test.Function","exceptionEvalutingClass")})}value instanceof className?this.pass(desc,{descTpl:R.get("isInstanceOfPass")}):this.fail(desc,{assertionName:"isa_ok",got:value,need:String(className),needDesc:R.get("needInstanceOf")})},isString:function(value,desc){var R=Siesta.Resource("Siesta.Test.More");"String"==this.typeOf(value)?this.pass(desc,{descTpl:R.get("isAString"),value:value}):this.fail(desc,{got:value,need:R.get("aStringValue")})},isObject:function(value,desc){var R=Siesta.Resource("Siesta.Test.More");"Object"==this.typeOf(value)?this.pass(desc,{descTpl:R.get("isAnObject"),value:value}):this.fail(desc,{got:value,need:R.get("anObject")})},isArray:function(value,desc){var R=Siesta.Resource("Siesta.Test.More");"Array"==this.typeOf(value)?this.pass(desc,{descTpl:R.get("isAnArray"),value:value}):this.fail(desc,{got:value,need:R.get("anArrayValue")})},isNumber:function(value,desc){var R=Siesta.Resource("Siesta.Test.More");"Number"==this.typeOf(value)?this.pass(desc,{descTpl:R.get("isANumber"),value:value}):this.fail(desc,{got:value,need:R.get("aNumberValue")})},isBoolean:function(value,desc){var R=Siesta.Resource("Siesta.Test.More");"Boolean"==this.typeOf(value)?this.pass(desc,{descTpl:R.get("isABoolean"),value:value}):this.fail(desc,{got:value,need:R.get("aBooleanValue")})},isDate:function(value,desc){var R=Siesta.Resource("Siesta.Test.More");"Date"==this.typeOf(value)?this.pass(desc,{descTpl:R.get("isADate"),value:value}):this.fail(desc,{got:value,need:R.get("aDateValue")})},isRegExp:function(value,desc){var R=Siesta.Resource("Siesta.Test.More");"RegExp"==this.typeOf(value)?this.pass(desc,{descTpl:R.get("isARe"),value:value}):this.fail(desc,{got:value,need:R.get("aReValue")})},isFunction:function(value,desc){var R=Siesta.Resource("Siesta.Test.More");"Function"==this.typeOf(value)||"AsyncFunction"==this.typeOf(value)?this.pass(desc,{descTpl:R.get("isAFunction"),value:value}):this.fail(desc,{got:value,need:R.get("aFunctionValue")})},is_deeply:function(obj1,obj2,desc){this.isDeeply.apply(this,arguments)},isDeeply:function(obj1,obj2,desc){var diff,R=Siesta.Resource("Siesta.Test.More");if(this.typeOf(obj1)===this.typeOf(obj2)&&this.compareObjects(obj1,obj2))this.pass(desc,{descTpl:R.get("isDeeplyPassTpl"),obj1:obj1,obj2:obj2});else if("undefined"!=typeof DeepDiff&&(diff=DeepDiff(obj1,obj2))){5<diff.length&&this.diag(R.get("tooManyDifferences",{num:5,total:diff.length}));for(var i=0;i<Math.min(diff.length,5);i++){var diffItem=diff[i],path=(diffItem.path||[]).join("."),saw=path?path+": "+diffItem.lhs:obj1,expected=path?path+": "+diffItem.rhs:obj2;this.fail(desc,{assertionName:"isDeeply",got:saw,need:expected}),window.console&&console.log("DIFF RESULT:",diffItem)}}else this.fail(desc,{assertionName:"isDeeply",got:obj1,need:obj2})},isDeeplyStrict:function(obj1,obj2,desc){if(this.typeOf(obj1)===this.typeOf(obj2)&&this.compareObjects(obj1,obj2,!0)){var R=Siesta.Resource("Siesta.Test.More");this.pass(desc,{descTpl:R.get("isDeeplyStrictPassTpl"),obj1:obj1,obj2:obj2})}else this.fail(desc,{assertionName:"isDeeplyStrict",got:obj1,need:obj2})},expectGlobal:function(){this.expectGlobals.apply(this,arguments)},expectGlobals:function(){this.expectedGlobals.push.apply(this.expectedGlobals,arguments)},isGlobalExpected:function(name,index){var me=this;if(index&&(!index||index.expectedStrings)||(index=index||{},Joose.O.extend(index,{expectedStrings:{},expectedRegExps:[]}),Joose.A.each(this.expectedGlobals.concat(this.browserGlobals),function(value){"RegExp"==me.typeOf(value)?index.expectedRegExps.push(value):index.expectedStrings[value]=!0})),index.expectedStrings[name])return!0;if(Siesta.Project.Browser.FeatureSupport().supports.imageWithIdCreatesGlobalEnumerable){var domEl=this.global.document.getElementById(name);if(domEl&&"img"==domEl.tagName.toLowerCase())return!0}for(var i=0;i<index.expectedRegExps.length;i++)if(index.expectedRegExps[i].test(name))return!0;return!1},forEachUnexpectedGlobal:function(func,scope){scope=scope||this;var index={};for(var name in this.global)if(!this.isGlobalExpected(name,index)&&!1===func.call(scope,name))break},verifyGlobals:function(){var R=Siesta.Resource("Siesta.Test.More");if(this.disableGlobalsCheck)this.diag(R.get("globalCheckNotSupported"));else{this.expectGlobals.apply(this,arguments),this.diag(R.get("globalVariables"));var failed=!1,i=0;this.forEachUnexpectedGlobal(function(name){return this.fail(R.get("globalFound"),R.get("globalName")+": "+name+", "+R.get("value")+": "+Siesta.Util.Serializer.stringify(this.global[name])),failed=!0,i++<50}),failed||this.pass(R.get("noGlobalsFound"))}},startWaiting:function(description,sourceLine){var result=new Siesta.Result.Assertion({description:description,isWaitFor:!0,sourceLine:sourceLine});return this.fireEvent("testupdate",this,result,this.getResults()),result},finalizeWaiting:function(result,passed,desc,annotation,errback,suppressPassedWaitForAssertion){result.completed=!0,passed?this.suppressPassedWaitForAssertion||suppressPassedWaitForAssertion?this.fireEvent("assertiondiscard",this,result):this.pass(desc,annotation,result):(this.fail(desc,annotation,result),errback&&errback())},waitFor:function(method,callback,scope,timeout,interval){var errback,suppressAssertion,R=Siesta.Resource("Siesta.Test.More"),description=" "+R.get("conditionToBeFulfilled"),assertionName="waitFor",me=this,sourceLine=me.getSourceLine(),originalSetTimeout=me.originalSetTimeout,originalClearTimeout=me.originalClearTimeout;if(1===arguments.length&&"Object"==this.typeOf(method)){var options=method;method=options.method,callback=options.callback,scope=options.scope,timeout=options.timeout,interval=options.interval,description=options.description||description,assertionName=options.assertionName||assertionName,suppressAssertion=options.suppressAssertion,errback=options.errback}else options={};var pollTimeout,isWaitingForTime="Number"==this.typeOf(method);callback=callback||function(){},description=isWaitingForTime?method+" "+R.get("ms"):description;var resolve,waitAssertion=me.startWaiting(R.get("waitingFor")+" "+description,sourceLine);interval=interval||this.waitForPollInterval,timeout=timeout||this.waitForTimeout;var res=new Promise(function(resolution){resolve=resolution}),async=this.beginAsync((isWaitingForTime?method:timeout)+3*interval,function(){return isDone=!0,originalClearTimeout(pollTimeout),me.finalizeWaiting(waitAssertion,!1,R.get("waitedTooLong")+": "+description,{assertionName:assertionName,annotation:"Function"===me.typeOf(options.annotation)?options.annotation():R.get("conditionNotFulfilled")+" "+timeout+R.get("ms")+". \n\n [code]"+method.toString()+"[/code]"},errback,suppressAssertion),resolve(),!0}),isDone=!1;if(this.on("beforetestfinalize",function(){isDone||(isDone=!0,me.finalizeWaiting(waitAssertion,!1,R.get("waitingAborted"),null,null,suppressAssertion),me.endAsync(async),originalClearTimeout(pollTimeout))},null,{single:!0}),isWaitingForTime){if(method<0)throw new Error("Cannot wait for a negative amount of time");pollTimeout=originalSetTimeout(function(){isDone=!0,me.finalizeWaiting(waitAssertion,!0,R.get("Waited")+" "+method+" "+R.get("ms"),null,null,suppressAssertion||0===method),me.endAsync(async),me.processCallbackFromTest(callback,[],scope||me),resolve()},method)}else{var result,startDate=new Date,pollFunc=function(){var time=new Date-startDate;if(timeout<time)return me.endAsync(async),me.finalizeWaiting(waitAssertion,!1,R.get("waitedTooLong")+": "+description,{assertionName:assertionName,annotation:"Function"===me.typeOf(options.annotation)?options.annotation():R.get("conditionNotFulfilled")+" "+timeout+R.get("ms")+". \n\n [code]"+method.toString()+"[/code]"},errback,suppressAssertion),isDone=!0,void resolve();try{result=method.call(scope||me)}catch(e){return me.endAsync(async),me.finalizeWaiting(waitAssertion,!1,assertionName+" "+R.get("checkerException"),{assertionName:assertionName,got:e.toString(),gotDesc:R.get("Exception")},errback,suppressAssertion),isDone=!0,void resolve()}null!=result&&!1!==result?(me.endAsync(async),isDone=!0,me.finalizeWaiting(waitAssertion,!0,R.get("Waited")+" "+time+" "+R.get("msFor")+" "+description,"Function"===me.typeOf(options.annotation)?options.annotation():null,null,(suppressAssertion||0==time)&&!options.description),me.processCallbackFromTest(callback,[result],scope||me),resolve(result)):pollTimeout=originalSetTimeout(pollFunc,interval)};pollFunc()}return res.force=function(){isDone||(isDone=!0,originalClearTimeout(pollTimeout),me.endAsync(async),me.finalizeWaiting(waitAssertion,!0,R.get("forcedWaitFinalization")+" "+description,null,null,suppressAssertion),me.processCallbackFromTest(callback,[],scope||me),resolve())},res},waitForMs:function(){return this.waitFor.apply(this,arguments)},waitForFn:function(){return this.waitFor.apply(this,arguments)},analyzeChainStep:function(func){var firstArg,sources=func.toString(),isArrow=!sources.match(/^function/);return!!(firstArg=isArrow?sources.match(/^\(/)?sources.match(/\(\s*(.*?)\s*(?:,|\))/)[1]:sources.match(/(.*?)\s*=>/)[1]:sources.match(/function\s*[^(]*\(\s*(.*?)\s*(?:,|\))/)[1])&&-1!=(isArrow?sources.match(/=>\s*([\s\S]*)/)[1]:sources.match(/\{([\s\S]*)\}/)[1]).indexOf(firstArg)},stringifyChainStep:function(step){return this.typeOf(step).match(/^(Async)?Function$/)?step.toString():Siesta.Util.Serializer.stringify(step)},chain:function(){var steps=this.flattenArray(arguments),R=Siesta.Resource("Siesta.Test.More"),nonEmpty=[];Joose.A.each(steps,function(step){step&&nonEmpty.push(step)});var len=(steps=nonEmpty).length;if(len){var me=this,self=arguments.callee,queue=new Siesta.Util.Queue({deferer:this.originalSetTimeout,deferClearer:this.originalClearTimeout,interval:self.hasOwnProperty("actionDelay")?self.actionDelay:this.simulator?this.simulator.actionDelay:1,observeTest:this});delete self.actionDelay;var sourceLine=me.getSourceLine(),args=[];Joose.A.each(steps,function(step,index){var isLast=index==len-1;queue.addAsyncStep({processor:function(data){function initStep(stepHasOwnAsyncFrame){if(!stepHasOwnAsyncFrame)var timeout=step.timeout||me.defaultTimeout,async=me.beginAsync(timeout+100,function(){return me.fail(R.get("chainStepNotCompleted"),{sourceLine:sourceLine,annotation:R.get("stepNumber")+": "+(index+1)+" "+R.get("oneBased")+(sourceLine?"\n"+R.get("atLine")+": "+sourceLine:"")+"\nStep source: "+me.stringifyChainStep(step),ownTextOnly:!0}),!0});return{next:function(){var self=arguments.callee;self.__CALLED__&&me.fail(R.get("calledMoreThanOnce",{num:index+1,line:sourceLine})),self.__CALLED__=!0,stepHasOwnAsyncFrame||me.endAsync(async),args=Array.prototype.slice.call(arguments),step.desc&&me.pass(step.desc),data.next()},async:async}}if(step instanceof Siesta.Test)me.launchSubTest(step,initStep(!0).next);else if(me.typeOf(step).match(/^(Async)?Function$/)||me.typeOf(step.action).match(/^(Async)?Function$/)){var result,func=me.typeOf(step).match(/^(Async)?Function$/)?step:step.action,stepInitData=initStep(!1),next=isLast?function(){}:stepInitData.next;if(args.unshift(next),me.transparentEx)result=func.apply(me,args);else{var e=me.getExceptionCatcher()(function(){result=func.apply(me,args)});void 0!==e&&(isLast||me.endAsync(stepInitData.async),me.failWithException(e,R.get("chainStepEx")))}result||isLast||me.analyzeChainStep(func)||me.fail(R.get("stepFn")+" ["+func.toString()+"] "+R.get("notUsingNext")),result&&me.handleReturnedPromise(result,next,me.formatString("The promise returned from the chain step ["+me.stringifyChainStep(step)+"] did not resolve within {time}ms",{time:me.defaultTimeout})),isLast&&(me.endAsync(stepInitData.async),step.desc&&me.pass(step.desc))}else if("String"==me.typeOf(step)){new Siesta.Test.Action.Eval({actionString:step,next:initStep(!1).next,test:me}).process()}else{Siesta.Test.ActionRegistry().create(step,me,args,initStep).process()}}})}),queue.run()}},chainForArray:function(array,generator,callback,reverse){var me=this,steps=[];Joose.A[reverse?"eachR":"each"](array,function(el,index){var res=generator.call(me,el,index);"Array"==me.typeOf(res)?steps.push.apply(steps,res):res&&steps.push(res)}),callback&&steps.push(function(){me.processCallbackFromTest(callback)}),this.chain(steps)},verifyExpectedNumber:function(actual,expected){var operator="==";if("String"==this.typeOf(expected)){var match=/([<>=]=?)\s*(\d+)/.exec(expected),R=Siesta.Resource("Siesta.Test.Browser");if(!match)throw new Error(R.get("wrongFormat")+": "+expected);operator=match[1],expected=Number(match[2])}switch(operator){case"==":return actual==expected;case"<=":return actual<=expected;case">=":return expected<=actual;case"<":return actual<expected;case">":return expected<actual}},getMaximalTimeout:function(){return Math.max(this.waitForTimeout,this.defaultTimeout,this.subTestTimeout,this.timeout||0,this.isReadyTimeout)}},after:{onBeforeTestFinalize:function(){!this.autoCheckGlobals||this.isFailed()||this.parent||this.verifyGlobals()}}}),Role("Siesta.Test.Role.Placeholder",{requires:["equalsTo"]}),Class("Siesta.Test.BDD.Spy",{does:[Siesta.Util.Role.CanGetType],has:{name:null,processor:{lazy:"this.buildProcessor"},hostObject:null,propertyName:null,hasOwnOriginalValue:!1,originalValue:null,strategy:"callThrough",returnValueObj:void 0,fakeFunc:null,throwErrorObj:null,callsLog:Joose.I.Array,calls:null,t:null,and:function(){return this}},methods:{initialize:function(){var me=this;this.calls={any:function(){return 0<me.callsLog.length},count:function(){return me.callsLog.length},argsFor:function(i){return me.callsLog[i].args},allArgs:function(i){return Joose.A.map(me.callsLog,function(call){return call.args})},all:function(){return me.callsLog},mostRecent:function(){return me.callsLog[me.callsLog.length-1]},first:function(){return me.callsLog[0]},reset:function(){me.reset()}};var R=Siesta.Resource("Siesta.Test.BDD.Spy"),hostObject=this.hostObject,propertyName=this.propertyName;if(hostObject){var originalValue=hostObject[propertyName];if(!/Function/.test(this.typeOf(originalValue)))throw R.get("spyingNotOnFunction");originalValue.__SIESTA_SPY__&&originalValue.__SIESTA_SPY__.remove(),this.originalValue=hostObject[propertyName],this.hasOwnOriginalValue=hostObject.hasOwnProperty(propertyName),hostObject[propertyName]=this.getProcessor()}this.t&&this.t.spies.push(this)},buildProcessor:function(){function processor(){var args=Array.prototype.slice.call(arguments),log={object:this,args:args};return me.callsLog.push(log),log.returnValue=me[me.strategy+"Strategy"](this,args)}var me=this;return processor.__SIESTA_SPY__=processor.and=me,processor.calls=me.calls,processor},returnValueStrategy:function(obj,args){return this.returnValueObj},callThroughStrategy:function(obj,args){return this.originalValue.apply(obj,args)},callFakeStrategy:function(obj,args){return this.fakeFunc.apply(obj,args)},throwErrorStrategy:function(obj,args){var error=this.throwErrorObj,ERROR=this.t&&this.t.global?this.t.global.Error:Error;throw error instanceof ERROR||(error=new ERROR(error)),error},callThrough:function(){if(!this.hostObject)throw"Need the host object to call through to original method";return this.strategy="callThrough",this},stub:function(){return this.returnValue(),this},returnValue:function(value){return this.strategy="returnValue",this.returnValueObj=value,this},callFake:function(func){return this.strategy="callFake",this.fakeFunc=func,this},throwError:function(error){return this.strategy="throwError",this.throwErrorObj=error,this},remove:function(){var hostObject=this.hostObject;hostObject&&(this.hasOwnOriginalValue?hostObject[this.propertyName]=this.originalValue:delete hostObject[this.propertyName]),this.originalValue=this.hostObject=hostObject=null,this.callsLog=[],this.returnValueObj=this.fakeFunc=this.throwErrorObj=null;var processor=this.getProcessor();processor&&(processor.and=processor.calls=processor.__SIESTA_SPY__=null),this.processor=null},reset:function(){this.callsLog=[]}}}),Class("Siesta.Test.BDD.Placeholder",{does:Siesta.Test.Role.Placeholder,has:{clsConstructor:{required:!0},t:null,context:null,globals:{init:["String","Boolean","Number","Date","RegExp","Function","Array","Object"]}},methods:{getClassName:function(onlyGlobals){var clsName,clsConstructor=this.getClassConstructor(),context=this.context;return Joose.A.each(this.globals,function(property){if(clsConstructor==context[property])return clsName=property,!1}),onlyGlobals?clsName:clsName||(clsConstructor?clsConstructor+"":"")},getClassConstructor:function(){return this.clsConstructor},equalsTo:function(value){var clsConstructor=this.getClassConstructor();if(!clsConstructor)return!0;if(value instanceof Siesta.Test.BDD.Placeholder){var ownClassName=this.getClassName(!0);return"Object"!=value.getClassName(!0)||"Date"!=ownClassName&&"RegExp"!=ownClassName&&"Function"!=ownClassName&&"Array"!=ownClassName?clsConstructor==value.getClassConstructor():!0}var isEqual=!1,globalCls=this.getClassName(!0);return globalCls&&(isEqual=this.t.typeOf(value)==globalCls||value instanceof this.context[globalCls]),isEqual||value instanceof clsConstructor},toString:function(){return"any "+(this.getClassName()||"value")}}}),Class("Siesta.Test.BDD.NumberPlaceholder",{does:Siesta.Test.Role.Placeholder,has:{value:{required:!0},threshold:null},methods:{initialize:function(){null==this.threshold&&(this.threshold=.05*this.value)},equalsTo:function(value){return Math.abs(value-this.value)<=this.threshold},toString:function(){return"any number approximately equal to "+this.value}}}),Class("Siesta.Test.BDD.StringPlaceholder",{does:[Siesta.Util.Role.CanGetType,Siesta.Test.Role.Placeholder],has:{value:{required:!0}},methods:{equalsTo:function(string){return"RegExp"==this.typeOf(this.value)?this.value.test(string):-1<String(string).indexOf(this.value)},toString:function(){return"RegExp"==this.typeOf(this.value)?"any string matching: "+this.value:"any string containing: "+this.value}}}),Class("Siesta.Test.BDD.Expectation",{does:[Siesta.Util.Role.CanGetType],has:{value:null,isNot:!1,not:null,t:null},methods:{initialize:function(){this.isNot||(this.not=new this.constructor({isNot:!0,t:this.t,value:this.value}))},process:function(passed,config){var isNot=this.isNot;(config=config||{}).not=config.not||isNot?"not ":"",config.got=config.hasOwnProperty("got")?config.got:this.value,config.noGot&&delete config.got;var assertionName=config.assertionName;assertionName&&isNot&&(config.assertionName=assertionName.replace(/^(expect\(.+?\)\.)/,"$1not.")),passed=isNot?!passed:passed,this.t[passed?"pass":"fail"](null,config)},toBe:function(expectedValue){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.t.compareObjects(this.value,expectedValue,!0,!0),{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeText")+" {need}",assertionName:"expect(got).toBe(need)",need:expectedValue,needDesc:this.isNot?R.get("needNotText"):R.get("needText")})},toEqual:function(expectedValue){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.t.compareObjects(this.value,expectedValue,!0),{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeEqualToText")+" {need}",assertionName:"expect(got).toEqual(need)",need:expectedValue,needDesc:this.isNot?R.get("needNotText"):R.get("needText")})},toBeNull:function(){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.t.compareObjects(this.value,null,!0,!0),{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeText")+" null",assertionName:"expect(got).toBeNull()",need:null,needDesc:this.isNot?R.get("needNotText"):R.get("needText")})},toBeNaN:function(){var value=this.value,R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process("Number"==this.t.typeOf(value)&&value!=value,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeText")+" NaN",assertionName:"expect(got).toBeNaN()",need:NaN,needDesc:this.isNot?R.get("needNotText"):R.get("needText")})},toBeDefined:function(){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(void 0!==this.value,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeDefinedText"),assertionName:"expect(got).toBeDefined()"})},toBeUndefined:function(value){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(void 0===this.value,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeUndefinedText"),assertionName:"expect(got).toBeUndefined()"})},toBeTruthy:function(){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.value,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeTruthyText"),assertionName:"expect(got).toBeTruthy()"})},toBeFalsy:function(){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(!this.value,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeFalsyText"),assertionName:"expect(got).toBeFalsy()"})},toMatch:function(regexp){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");if("RegExp"!=this.t.typeOf(regexp))throw new Error("`expect().toMatch()` matcher expects a regular expression");this.process(new RegExp(regexp).test(this.value),{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toMatchText")+" {need}",assertionName:"expect(got).toMatch(need)",need:regexp,needDesc:this.isNot?R.get("needNotMatchingText"):R.get("needMatchingText")})},toContain:function(element){var value=this.value,t=this.t,R=Siesta.Resource("Siesta.Test.BDD.Expectation"),passed=!1;if("String"==t.typeOf(value))this.process(0<=value.indexOf(element),{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toContainText")+" {need}",assertionName:"expect(got).toContain(need)",need:element,needDesc:this.isNot?R.get("needStringNotContainingText"):R.get("needStringContainingText")});else{value=Array.prototype.slice.call(value);for(var i=0;i<value.length;i++)if(t.compareObjects(element,value[i],!0)){passed=!0;break}this.process(passed,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toContainText")+" {need}",assertionName:"expect(got).toContain(need)",need:element,needDesc:this.isNot?R.get("needArrayNotContainingText"):R.get("needArrayContainingText")})}},toBeLessThan:function(expectedValue){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.value<expectedValue,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeLessThanText")+" {need}",assertionName:"expect(got).toBeLessThan(need)",need:expectedValue,needDesc:this.isNot?R.get("needGreaterEqualThanText"):R.get("needLessThanText")})},toBeGreaterThan:function(expectedValue){var R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.value>expectedValue,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeGreaterThanText")+" {need}",assertionName:"expect(got).toBeGreaterThan(need)",need:expectedValue,needDesc:this.isNot?R.get("needLessEqualThanText"):R.get("needGreaterThanText")})},toBeCloseTo:function(expectedValue,precision){precision=null!=precision?precision:2;var threshold=Math.pow(10,-precision)/2,delta=Math.abs(this.value-expectedValue),R=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(delta<threshold,{descTpl:R.get("expectText")+" {got} {!not}"+R.get("toBeCloseToText")+" {need}",assertionName:"expect(got).toBeCloseTo(need)",need:expectedValue,needDesc:this.isNot?R.get("needValueNotCloseToText"):R.get("needValueCloseToText"),annotation:delta?R.get("thresholdIsText")+threshold:R.get("exactMatchText")})},toThrow:function(){var func=this.value,t=this.t,R=Siesta.Resource("Siesta.Test.BDD.Expectation");if("Function"!=t.typeOf(func))throw new Error("`expect().toMatch()` matcher expects a function");var e=t.getExceptionCatcher()(func);e instanceof t.getTestErrorClass()&&(e=e.message||e.description),this.process(void 0!==e,{descTpl:R.get("expectText")+" function {!not}"+R.get("toThrowText"),assertionName:"expect(func).toThrow()",annotation:e?R.get("thrownExceptionText")+": "+Siesta.Util.Serializer.stringify(e):R.get("noExceptionThrownText"),noGot:!0})},toHaveBeenCalled:function(expectedNumber){expectedNumber=null!=expectedNumber?expectedNumber:">=1";var spy=this.value,t=this.t,R=Siesta.Resource("Siesta.Test.BDD.Expectation");if("Function"==this.typeOf(spy)){if(!spy.__SIESTA_SPY__)throw new Error(R.get("wrongSpy"));spy=spy.__SIESTA_SPY__}if(!(spy instanceof Siesta.Test.BDD.Spy))throw new Error(R.get("wrongSpy"));this.process(t.verifyExpectedNumber(spy.callsLog.length,expectedNumber),{descTpl:R.get("toHaveBeenCalledDescTpl"),assertionName:"expect(func).toHaveBeenCalled()",methodName:spy.propertyName||"[function]",got:spy.callsLog.length,gotDesc:R.get("actualNbrOfCalls"),need:(this.isNot?"not ":"")+expectedNumber,needDesc:R.get("expectedNbrOfCalls")})},toHaveBeenCalledWith:function(){var spy=this.value,t=this.t,R=Siesta.Resource("Siesta.Test.BDD.Expectation");if("Function"==this.typeOf(spy)){if(!spy.__SIESTA_SPY__)throw new Error(R.get("wrongSpy"));spy=spy.__SIESTA_SPY__}if(!(spy instanceof Siesta.Test.BDD.Spy))throw new Error(R.get("wrongSpy"));var args=Array.prototype.slice.call(arguments),foundCallWithMatchingArgs=!1;Joose.A.each(spy.callsLog,function(call){if(t.compareObjects(call.args,args))return!(foundCallWithMatchingArgs=!0)}),this.process(foundCallWithMatchingArgs,{descTpl:R.get("toHaveBeenCalledWithDescTpl"),assertionName:"expect(func).toHaveBeenCalledWith()",methodName:spy.propertyName,noGot:!0})}}}),Role("Siesta.Test.BDD",{requires:["getSubTest","chain"],has:{specType:null,beforeEachHooks:Joose.I.Array,afterEachHooks:Joose.I.Array,sequentialSubTests:Joose.I.Array,codeProcessed:!1,launchTimeout:null,expectationClass:Siesta.Test.BDD.Expectation,failOnExclusiveSpecsWhenAutomated:!1,spies:Joose.I.Array},methods:{checkSpecFunction:function(func,type,name){if(!func)throw new Error(Siesta.Resource("Siesta.Test.BDD","codeBodyMissing")+" "+("describe"==type?"suite":"spec")+" ["+name+"]");if(!func.length)throw new Error(Siesta.Resource("Siesta.Test.BDD","codeBodyOf")+" "+("describe"==type?"suite":"spec")+" ["+name+"] "+Siesta.Resource("Siesta.Test.BDD","missingFirstArg"))},ddescribe:function(name,code,timeout){this.describe(name,code,timeout,!0)},xdescribe:function(){},describe:function(name,code,timeout,isExclusive){this.checkSpecFunction(code,"describe",name);var subTest=this.getSubTest({name:name,run:code,isExclusive:isExclusive,specType:"describe",timeout:timeout});this.codeProcessed&&this.scheduleSpecsLaunch(),this.sequentialSubTests.push(subTest)},iit:function(name,code,timeout){this.project.isAutomated&&this.failOnExclusiveSpecsWhenAutomated&&this.fail(Siesta.Resource("Siesta.Test.BDD","iitFound")),this.it(name,code,timeout,!0)},xit:function(){},it:function(name,code,timeout,isExclusive,isTodo){this.checkSpecFunction(code,"it",name);var subTest=this.getSubTest({name:name,run:code,isExclusive:isExclusive,isTodo:Boolean(isTodo)||this.isTodo,specType:"it",timeout:timeout});this.codeProcessed&&this.scheduleSpecsLaunch(),this.sequentialSubTests.push(subTest)},expect:function(value){return new this.expectationClass({t:this,value:value})},any:function(clsConstructor){return new Siesta.Test.BDD.Placeholder({clsConstructor:clsConstructor,t:this,context:this.global})},anyNumberApprox:function(value,threshold){return new Siesta.Test.BDD.NumberPlaceholder({value:value,threshold:threshold})},anyStringLike:function(value){return new Siesta.Test.BDD.StringPlaceholder({value:value})},scheduleSpecsLaunch:function(){if(!this.launchTimeout){var async=this.beginAsync(),originalSetTimeout=this.originalSetTimeout,me=this;this.launchTimeout=originalSetTimeout(function(){me.endAsync(async),me.launchTimeout=null,me.launchSpecs()},0)}},runBeforeSpecHooks:function(sourceTest,done){function runOwnHooks(done){me.chainForArray(me.beforeEachHooks,function(hook){return function(next){var code=hook.code;if("AsyncFunction"===me.typeOf(code))return code(sourceTest,function(){});hook.isAsync?code(sourceTest,next):(code(sourceTest),next())}},done)}var me=this;this.parent?this.parent.runBeforeSpecHooks(sourceTest,function(){runOwnHooks(done)}):runOwnHooks(done)},runAfterSpecHooks:function(sourceTest,done){var me=this;me.chainForArray(this.afterEachHooks,function(hook){return function(next){var code=hook.code;if("AsyncFunction"===me.typeOf(code))return code(sourceTest,function(){});hook.isAsync?code(sourceTest,next):(code(sourceTest),next())}},function(){me.parent?me.parent.runAfterSpecHooks(sourceTest,done):done()},!0)},launchSpecs:function(){var me=this,sequentialSubTests=this.sequentialSubTests;this.sequentialSubTests=[],this.chain.actionDelay=0;var exclusiveSubTests=[];Joose.A.each(sequentialSubTests,function(subTest){subTest.isExclusive&&exclusiveSubTests.push(subTest)}),this.chainForArray(exclusiveSubTests.length?exclusiveSubTests:sequentialSubTests,function(subTest){return["it"==subTest.specType?function(next){me.runBeforeSpecHooks(subTest,next)}:null,subTest,"it"==subTest.specType?function(next){me.runAfterSpecHooks(subTest,next)}:null]})},beforeEach:function(code,isAsync){this.beforeEachHooks.push({code:code,isAsync:isAsync||2==code.length})},afterEach:function(code,isAsync){this.afterEachHooks.push({code:code,isAsync:isAsync||2==code.length})},spyOn:function(object,propertyName){var R=Siesta.Resource("Siesta.Test.BDD");if(object)return new Siesta.Test.BDD.Spy({name:propertyName,t:this,hostObject:object,propertyName:propertyName});this.warn(R.get("noObject"))},createSpy:function(spyName){return new Siesta.Test.BDD.Spy({name:spyName||"James Bond",t:this}).stub().getProcessor()},createSpyObj:function(spyName,properties){1==arguments.length&&(properties=spyName,spyName=null),spyName=spyName||"spyObject";var me=this,obj={};return Joose.A.each(properties,function(propertyName){obj[propertyName]=me.createSpy(spyName)}),obj}},override:{cleanup:function(){this.beforeEachHooks=this.afterEachHooks=null,this.SUPER()},onTestFinalize:function(){Joose.A.each(this.spies,function(spy){spy.remove()}),this.spies=null,this.SUPER()},afterLaunch:function(){this.codeProcessed=!0,this.launchSpecs(),this.SUPERARG(arguments)}}}),Role("Siesta.Test.Sub",{has:{isExclusive:!1,parent:{required:!0}},methods:{getExceptionCatcher:function(){return this.parent.getExceptionCatcher()},getTestErrorClass:function(){return this.parent.getTestErrorClass()},getStartTestAnchor:function(){return this.parent.getStartTestAnchor()},expectGlobals:function(){return this.parent.expectGlobals.apply(this.parent,arguments)}}}),Class("Siesta.Test",{does:[Siesta.Util.Role.CanFormatStrings,Siesta.Util.Role.CanGetType,Siesta.Util.Role.CanCompareObjects,Siesta.Util.Role.CanEscapeRegExp,Siesta.Test.More,Siesta.Test.Date,Siesta.Test.Function,Siesta.Test.BDD,JooseX.Observable,Siesta.Util.Role.HasUniqueGeneratedId],has:{name:null,uniqueId:function(){var holder=Siesta.Test;return holder.__UNIQUE_ID_GEN__=holder.__UNIQUE_ID_GEN__||0,++holder.__UNIQUE_ID_GEN__},url:{required:!0},urlExtractRegex:{is:"rwc",lazy:function(){return new RegExp(this.url.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")+":(\\d+)")}},referenceUrl:null,assertPlanned:null,assertCount:0,isTodo:!1,results:{lazy:function(){return new Siesta.Result.SubTest({description:this.name||"Root",test:this})}},run:null,startTestAnchor:null,exceptionCatcher:null,testErrorClass:null,generation:function(){return Math.random()},launchId:null,parent:null,project:null,harness:null,isReadyTimeout:1e4,failed:!1,failedException:null,failedExceptionType:null,startDate:null,endDate:null,lastActivityDate:null,contentManager:null,scopeProvider:null,global:null,reusingSandbox:!1,sandboxCleanup:!0,sharedSandboxState:null,scriptScopeProvider:null,transparentEx:!1,needDone:!1,isDone:!1,defaultTimeout:15e3,subTestTimeout:null,timeout:null,timeoutsCount:function(){return{counter:1}},timeoutIds:Joose.I.Object,idsToIndex:Joose.I.Object,waitTitles:Joose.I.Object,processed:!1,finalizationStarted:!1,callback:null,nbrExceptions:0,testEndReported:!1,needToCleanup:!0,overrideSetTimeout:!1,overrideForSetTimeout:null,overrideForClearTimeout:null,originalSetTimeout:null,originalClearTimeout:null,sourceLineForAllAssertions:!1,$passCount:null,$failCount:null,actionableMethods:{lazy:"buildActionableMethods"},jUnitClass:null,groups:null,automationElementId:null,snoozeUntil:null,config:null},methods:{initialize:function(){this.harness=this.project=this.project||this.harness,this.on("teststart",function(event){this.parent&&event.stopPropagation()}),this.on("testfinalize",function(event){this.parent&&event.stopPropagation()}),this.on("teststop",function(event){this.parent&&event.stopPropagation()}),this.on("beforetestfinalize",function(event){this.parent&&event.stopPropagation()}),this.on("beforetestfinalizeearly",function(event){this.parent&&event.stopPropagation()}),this.subTestTimeout=this.subTestTimeout||2*this.defaultTimeout,this.snoozeUntil&&(this.snoozeUntil=new Date(this.snoozeUntil),isNaN(+this.snoozeUntil)&&(this.snoozeUntil=null)),this.snoozeUntil&&new Date<this.snoozeUntil&&(this.isTodo=!0),this.config&&Joose.O.extend(this,this.config)},isReady:function(){var R=Siesta.Resource("Siesta.Test");return this.run=this.run||this.getStartTestAnchor().args&&this.getStartTestAnchor().args[0],{ready:"Function"==this.typeOf(this.run)||"AsyncFunction"==this.typeOf(this.run),reason:R.get("noCodeProvidedToTest")}},isFromTheSameGeneration:function(test2){return this.generation==test2.generation},toString:function(){return this.url},plan:function(value){if(null!=this.assertPlanned)throw new Error("Test plan can't be changed");this.assertPlanned=value},addResult:function(result){var isAssertion=result instanceof Siesta.Result.Assertion;if(isAssertion&&(result.isTodo=this.isTodo),isAssertion&&(this.isDone||this.isFinished())&&!result.isTodo&&!this.testEndReported){this.testEndReported=!0;var R=Siesta.Resource("Siesta.Test");this.fail(R.get("addingAssertionsAfterDone"))}return isAssertion&&!result.index&&(result.index=++this.assertCount),this.getResults().push(result),this.$passCount=this.$failCount=null,this.fireEvent("testupdate",this,result,this.getResults()),this.lastActivityDate=new Date,result},diag:function(desc,callback){this.addResult(new Siesta.Result.Diagnostic({description:String(desc||"")})),callback&&callback()},pass:function(desc,annotation,result){annotation&&"String"!=this.typeOf(annotation)&&(!desc&&annotation.descTpl&&(desc=this.formatString(annotation.descTpl,annotation)),annotation=annotation.annotation),result&&(result.passed=!0,result.description=String(desc||""),result.annotation=annotation),this.addResult(result||new Siesta.Result.Assertion({passed:!0,annotation:String(annotation||""),description:String(desc||""),sourceLine:result&&result.sourceLine||annotation&&annotation.sourceLine||this.sourceLineForAllAssertions&&this.getSourceLine()||null}))},fail:function(desc,annotation,result){var sourceLine=result&&result.sourceLine||annotation&&annotation.sourceLine||this.getSourceLine(),assertionName="";if(annotation&&"String"!=this.typeOf(annotation)){!desc&&annotation.descTpl&&(desc=this.formatString(annotation.descTpl,annotation));var strings=[],params=annotation,hasGot=params.hasOwnProperty("got"),hasNeed=params.hasOwnProperty("need"),gotDesc=params.gotDesc||"Got",needDesc=params.needDesc||"Need";if(assertionName=params.assertionName,annotation=params.annotation,params.ownTextOnly||!assertionName&&!sourceLine||strings.push("Failed assertion "+(assertionName?"`"+assertionName+"` ":"")+this.formatSourceLine(sourceLine)),hasGot&&hasNeed){var max=Math.max(gotDesc.length,needDesc.length);gotDesc=this.appendSpaces(gotDesc,max-gotDesc.length+1),needDesc=this.appendSpaces(needDesc,max-needDesc.length+1)}hasGot&&strings.push(gotDesc+": "+Siesta.Util.Serializer.stringify(params.got)),hasNeed&&strings.push(needDesc+": "+Siesta.Util.Serializer.stringify(params.need)),annotation&&strings.push(annotation),annotation=strings.join("\n")}result&&(result.name=assertionName,result.passed=!1,result.annotation=annotation,result.description=desc),this.addResult(result||new Siesta.Result.Assertion({name:assertionName,passed:!1,sourceLine:sourceLine,annotation:String(annotation||""),description:String(desc||"")})),this.onFailedAssertion()},onFailedAssertion:function(noNeedToExit){this.isTodo||(this.project.debuggerOnFail&&eval("debugger"),this.project.breakOnFail&&!this.__STOPPED__&&(this.__STOPPED__=!0,this.project.stopCurrentLaunch(this),noNeedToExit||this.exit()))},exit:function(desc,annotation){throw 0<arguments.length&&this.fail(desc,annotation),this.finalize(!0),"__SIESTA_TEST_EXIT_EXCEPTION__"},getSource:function(){return this.contentManager.getContentOf(this.url)},getSourceLine:function(){var stack=(new Error).stack;if(!stack)try{throw new Error}catch(e){stack=e.stack}if(stack){var match=stack.match(this.urlExtractRegex());if(match)return match[1]}return null},getStartTestAnchor:function(){return this.startTestAnchor},getExceptionCatcher:function(){return this.exceptionCatcher},getTestErrorClass:function(){return this.testErrorClass},processCallbackFromTest:function(callback,args,scope){var me=this;if(!callback)return!0;if(this.transparentEx)callback.apply(scope||this.global,args||[]);else{var e=this.getExceptionCatcher()(function(){callback.apply(scope||me.global,args||[])});if(e)return this.failWithException(e),!1}return!0},getStackTrace:function(e){if(Object(e)!==e)return null;if(!e.stack)return null;for(var stackLines=(e.stack+"").split("\n"),message=e+"",result=(Siesta.Resource("Siesta.Test"),[]),i=0;i<stackLines.length;i++){var line=stackLines[i];if(line){if(!i){if(line==message){result.push(line);continue}result.push(message)}result.push(line)}}return result.length?result:null},formatSourceLine:function(sourceLine){var R=Siesta.Resource("Siesta.Test");return sourceLine?R.get("atLine")+" "+sourceLine+" "+R.get("of")+" "+this.url:""},appendSpaces:function(str,num){for(var spaces="";num--;)spaces+=" ";return str+spaces},eachAssertion:function(func,scope){scope=scope||this,this.getResults().each(function(result){result instanceof Siesta.Result.Assertion&&func.call(scope,result)})},eachSubTest:function(func,scope){scope=scope||this,this.getResults().each(function(result){if(result instanceof Siesta.Result.SubTest&&!1===func.call(scope,result.test))return!1})},eachChildTest:function(func,scope){scope=scope||this,this.getResults().eachChild(function(result){if(result instanceof Siesta.Result.SubTest&&!1===func.call(scope,result.test))return!1})},ok:function(value,desc){var R=Siesta.Resource("Siesta.Test");value?this.pass(desc,{descTpl:R.get("isTruthy"),value:value}):this.fail(desc,{assertionName:"ok",got:value,annotation:R.get("needTruthy")})},notok:function(){this.notOk.apply(this,arguments)},notOk:function(value,desc){var R=Siesta.Resource("Siesta.Test");value?this.fail(desc,{assertionName:"notOk",got:value,annotation:R.get("needFalsy")}):this.pass(desc,{descTpl:R.get("isFalsy"),value:value})},is:function(got,expected,desc){var R=Siesta.Resource("Siesta.Test");expected&&got instanceof this.global.Date?this.isDateEqual(got,expected,desc):this.compareObjects(got,expected,!1,!0)?this.pass(desc,{descTpl:R.get("isEqualTo"),got:got,expected:expected}):this.fail(desc,{assertionName:"is",got:got,need:expected})},isnot:function(){this.isNot.apply(this,arguments)},isnt:function(){this.isNot.apply(this,arguments)},isNot:function(got,expected,desc){var R=Siesta.Resource("Siesta.Test");this.compareObjects(got,expected,!1,!0)?this.fail(desc,{assertionName:"isnt",got:got,need:expected,needDesc:R.get("needNot")}):this.pass(desc,{descTpl:R.get("isNotEqualTo"),got:got,expected:expected})},exact:function(got,expected,desc){var R=Siesta.Resource("Siesta.Test");this.compareObjects(got,expected,!0,!0)?this.pass(desc,{descTpl:R.get("isStrictlyEqual"),got:got,expected:expected}):this.fail(desc,{assertionName:"isStrict",got:got,need:expected,needDesc:R.get("needStrictly")})},isStrict:function(got,expected,desc){var R=Siesta.Resource("Siesta.Test");this.compareObjects(got,expected,!0,!0)?this.pass(desc,{descTpl:R.get("isStrictlyEqual"),got:got,expected:expected}):this.fail(desc,{assertionName:"isStrict",got:got,need:expected,needDesc:R.get("needStrictly")})},isntStrict:function(){this.isNotStrict.apply(this,arguments)},isNotStrict:function(got,expected,desc){var R=Siesta.Resource("Siesta.Test");this.compareObjects(got,expected,!0,!0)?this.fail(desc,{assertionName:"isntStrict",got:got,need:expected,needDesc:R.get("needStrictlyNot")}):this.pass(desc,{descTpl:R.get("isStrictlyNotEqual"),got:got,expected:expected})},wait:function(title,howLong){var R=Siesta.Resource("Siesta.Test");if(this.waitTitles.hasOwnProperty(title))throw new Error(R.get("alreadyWaiting")+" ["+title+"]");return this.waitTitles[title]=this.beginAsync(howLong)},endWait:function(title){var R=Siesta.Resource("Siesta.Test");if(!this.waitTitles.hasOwnProperty(title))throw new Error(R.get("noOngoingWait")+" ["+title+"]");this.endAsync(this.waitTitles[title]),delete this.waitTitles[title]},beginAsync:function(time,errback){(time=time||this.defaultTimeout)>this.getMaximalTimeout()&&this.fireEvent("maxtimeoutchanged",time);var R=Siesta.Resource("Siesta.Test"),me=this,originalSetTimeout=this.originalSetTimeout,index=this.timeoutsCount.counter++,timeoutId=originalSetTimeout(function(){me.hasAsyncFrame(index)&&(errback&&errback.call(me,me)||me.fail(R.get("noMatchingEndAsync",{time:time})),me.endAsync(index))},time);return this.timeoutIds[index]=timeoutId,index},timeoutIdToIndex:function(id){return"object"==typeof id?id.__index:this.idsToIndex[id]},hasAsyncFrame:function(index){return this.timeoutIds.hasOwnProperty(index)},hasAsyncFrameByTimeoutId:function(id){return this.timeoutIds.hasOwnProperty(this.timeoutIdToIndex(id))},endAsync:function(index){var originalSetTimeout=this.originalSetTimeout,originalClearTimeout=this.originalClearTimeout||this.global.clearTimeout,counter=0,R=Siesta.Resource("Siesta.Test");null==index&&Joose.O.each(this.timeoutIds,function(timeoutId,indx){if(index=indx,counter++)throw new Error(R.get("endAsyncMisuse"))}),originalClearTimeout(this.timeoutIds[index]),delete this.timeoutIds[index];var me=this;this.processed&&!this.isFinished()&&originalSetTimeout(function(){me.finalize()},1)},clearTimeouts:function(){var originalClearTimeout=this.originalClearTimeout;Joose.O.each(this.timeoutIds,function(value,id){originalClearTimeout(value)}),this.timeoutIds={}},processSubTestConfig:function(config){return Joose.O.extend({parent:this,isTodo:this.isTodo,transparentEx:this.transparentEx,waitForTimeout:this.waitForTimeout,waitForPollInterval:this.waitForPollInterval,defaultTimeout:this.defaultTimeout,timeout:this.subTestTimeout,subTestTimeout:this.subTestTimeout,global:this.global,url:this.url,scopeProvider:this.scopeProvider,project:this.project,generation:this.generation,launchId:this.launchId,overrideSetTimeout:this.overrideSetTimeout,originalSetTimeout:this.originalSetTimeout,originalClearTimeout:this.originalClearTimeout,timeoutsCount:this.timeoutsCount,autoCheckGlobals:!1,needToCleanup:!1},config)},getSubTest:function(arg1,arg2,arg3){var config,R=Siesta.Resource("Siesta.Test");2==arguments.length||3==arguments.length?config={name:arg1,run:arg2,timeout:arg3}:1==arguments.length&&"Function"==this.typeOf(arg1)&&(config={name:"Sub test",run:arg1}),null==(config=config||arg1||{}).timeout&&delete config.timeout;var name=config.name;if(!config.run)throw this.failWithException(R.get("codeBodyMissingForSubTest",{name:name})),new Error(R.get("codeBodyMissingForSubTest",{name:name}));if(!config.run.length)throw this.failWithException(R.get("codeBodyMissingTestArg",{name:name})),new Error(R.get("codeBodyMissingTestArg",{name:name}));var constructor=config.meta||this.meta.c,cls=constructor,cfg=this.processSubTestConfig(config);constructor.__WITHSUB__?cls=constructor.__WITHSUB__:this.parent||(cfg.trait=Siesta.Test.Sub);var subTest=new cls(cfg);return this.parent||constructor.__WITHSUB__||(constructor.__WITHSUB__=subTest.meta.c),subTest},launchSubTest:function(subTest,callback){var me=this,R=Siesta.Resource("Siesta.Test"),timeout=subTest.timeout||this.subTestTimeout,async=this.beginAsync(timeout,function(){return me.fail(R.get("failedToFinishWithin",{name:subTest.name?"["+subTest.name+"]":"",timeout:timeout})),me.restoreTimeoutOverrides(),testEndListener.remove(),subTest.finalize(!0),callback&&callback(subTest),!0}),testEndListener=subTest.on("testfinalize",function(){me.endAsync(async),me.restoreTimeoutOverrides(),callback&&callback(subTest)});this.addResult(subTest.getResults()),subTest.start()},todo:function(why,code,callback){"Function"==this.typeOf(why)&&(why=[code,code=why][0]);var todo=this.getSubTest({name:why,run:code,isTodo:!0,transparentEx:!1});this.launchSubTest(todo,callback)},snooze:function(snoozeUntilDate,fn,reason){var R=Siesta.Resource("Siesta.Test"),snoozeDate=new Date(snoozeUntilDate);new Date>snoozeDate?this.it("Unsnoozed",fn,null,!1,!1):this.it(R.get("Snoozed until")+" "+snoozeDate+": "+(reason||""),fn,null,!1,!0)},subTest:function(desc,code,callback,timeout){var subTest=this.getSubTest({name:desc||Siesta.Resource("Siesta.Test","Subtest"),timeout:timeout,run:code});return this.launchSubTest(subTest,callback),subTest},stringifyException:function(e,stackTrace){var stringified=e+"",annotation="string"==typeof stackTrace?stackTrace:(stackTrace||this.getStackTrace(e)||[]).join("\n");return-1==annotation.indexOf(stringified)&&(annotation=stringified+"\n"+annotation),annotation},failWithException:function(e,description,useDoFinalize){var R=Siesta.Resource("Siesta.Test");this.failed=!0,this.failedException=e+"",this.failedExceptionType=this.typeOf(e);var stackTrace=this.getStackTrace(e);this.addResult(new Siesta.Result.Assertion({isException:!0,exceptionType:this.failedExceptionType,passed:!1,description:description||(this.parent?R.get("Subtest")+" `"+this.name+"`":R.get("Test")+" ")+" "+R.get("threwException"),annotation:this.stringifyException(e,stackTrace)})),this.fireEvent("testfailedwithexception",this,e,stackTrace),this.onFailedAssertion(!0),useDoFinalize?this.doFinalize():this.finalize(!0)},restoreTimeoutOverrides:function(){this.overrideSetTimeout&&(this.global.setTimeout=this.overrideForSetTimeout,this.global.clearTimeout=this.overrideForClearTimeout)},start:function(preloadErrors){var me=this,R=Siesta.Resource("Siesta.Test");if(this.startDate)throw R.get("testAlreadyStarted");if(this.startDate=+new Date,this.fireEvent("teststart",this),preloadErrors&&preloadErrors.length)return Joose.A.each(preloadErrors,function(error){if(error.isException)return me.failWithException(error.message,"",!0),!1;me.fail(error.message)}),me.doFinalize(),!0;this.doStart()},doStart:function(){var me=this,R=Siesta.Resource("Siesta.Test");if(me.onTestStart(),me.parent||me.reusingSandbox)me.launch();else{function cont(isReadyError){var hasTimedOut=!1,setupTimeout=setTimeout(function(){hasTimedOut=!0,me.launch(R.get("setupTookTooLong"))},me.isReadyTimeout);me.setup(function(){hasTimedOut||(clearTimeout(setupTimeout),me.launch(isReadyError))},function(setupError){hasTimedOut||(clearTimeout(setupTimeout),me.launch(isReadyError||setupError))})}var errorMessage,readyRes=me.isReady();if(readyRes.ready)cont();else var timeout=setTimeout(function(){clearInterval(interval),cont(errorMessage)},me.isReadyTimeout),interval=setInterval(function(){(readyRes=me.isReady()).ready?(clearInterval(interval),clearTimeout(timeout),cont()):errorMessage=readyRes.reason||errorMessage},100)}},setup:function(callback,errback){callback.call(this)},tearDown:function(callback,errback){callback.call(this)},earlySetup:function(callback,errback){callback.call(this)},cleanupContextBeforeStart:function(){var global=this.global;this.forEachUnexpectedGlobal(function(name){try{delete global[name]}catch(e){}})},clearAsyncFrameGlobally:function(id){for(var topTest=this;topTest.parent;)topTest=topTest.parent;topTest.eachSubTest(function(subTest){if(subTest.hasAsyncFrameByTimeoutId(id))return subTest.overrideForClearTimeout(id),!1})},launch:function(errorMessage){if(errorMessage){var R=Siesta.Resource("Siesta.Test");this.fail(R.get("errorBeforeTestStarted"),{annotation:errorMessage})}var me=this,global=this.global,scopeProvider=this.scopeProvider,originalSetTimeout=this.originalSetTimeout,originalClearTimeout=this.originalClearTimeout,result;this.overrideSetTimeout&&(this.reusingSandbox||this.parent||scopeProvider.runCode("var setTimeout, clearTimeout;"),global.setTimeout=this.overrideForSetTimeout=function(func,delay){var index=me.timeoutsCount.counter++,timeoutId=originalSetTimeout(function(){originalClearTimeout(timeoutId),delete me.timeoutIds[index],me.processed&&!me.isFinished()&&originalSetTimeout(function(){me.finalize()},1),func()},delay);return"object"==typeof timeoutId?timeoutId.__index=index:me.idsToIndex[timeoutId]=index,me.timeoutIds[index]=timeoutId},global.clearTimeout=this.overrideForClearTimeout=function(id){if(null!=id)if(me.hasAsyncFrameByTimeoutId(id)){originalClearTimeout(id);var index=me.timeoutIdToIndex(id);null!=index&&delete me.timeoutIds[index],me.processed&&!me.isFinished()&&originalSetTimeout(function(){me.finalize()},1)}else me.clearAsyncFrameGlobally(id)}),this.needToCleanup&&(scopeProvider.beforeCleanupCallback=function(){me.isFinished()||me.finalize(!0),me.overrideSetTimeout&&(global.setTimeout=originalSetTimeout,global.clearTimeout=originalClearTimeout),originalSetTimeout=originalClearTimeout=null,global=null,me.eachSubTest(function(subTest){subTest.cleanup()})}),this.reusingSandbox&&this.sandboxCleanup&&!this.parent&&this.cleanupContextBeforeStart();var run=this.run,e;this.transparentEx?(me.project.debuggerOnStart&&!me.parent&&eval("debugger"),result=run(me)):e=this.getExceptionCatcher()(function(){me.project.debuggerOnStart&&!me.parent&&eval("debugger"),result=run(me)}),result&&this.handleReturnedPromise(result,null,this.formatString("The promise returned from the sub-test ["+me.name+"] did not resolve within {time}ms",{time:me.defaultTimeout})),this.afterLaunch(e)},handleReturnedPromise:function(promise,callback,message){var global=this.global,Promise=global.Promise||global.Ext&&global.Ext.Promise;if(Promise&&promise instanceof Promise){var me=this,async=this.beginAsync(this.defaultTimeout,function(){return me.fail(message),!0});promise.then(function(value){me.endAsync(async),callback&&callback(value)},function(e){me.endAsync(async),e&&(me.failWithException(e,"Unhandled promise rejection during the test: ["+me.name+"]"),me.transparentEx&&"undefined"!=typeof console&&console.error(e))})}},cleanup:function(){this.overrideForSetTimeout=this.overrideForClearTimeout=null,this.originalSetTimeout=this.originalClearTimeout=null,this.global=this._global=this.run=null,this.exceptionCatcher=this.testErrorClass=null,this.startTestAnchor=null,this.scopeProvider=null,this.purgeListeners()},afterLaunch:function(e){e?this.failWithException(e):this.finalize()},finalize:function(force){var me=this,R=Siesta.Resource("Siesta.Test");if(!me.finalizationStarted&&!me.isFinished())if(me.processed=!0,force&&(me.clearTimeouts(),me.eachChildTest(function(childTest){childTest.finalize(!0)})),Joose.O.isEmpty(me.timeoutIds)){try{if(!me.isDone&&!1===me.doDone(force))return}catch(e){me.fail("Exception during test finalization"+e.stack),"undefined"!=typeof console&&console.log("Exception during test finalization",e.stack)}me.finalizationStarted=!0,me.fireEvent("teststop",me);function finalizationCode(tearDownError){finalizationCodeStarted||(finalizationCodeStarted=!0,tearDownError&&me.fail(tearDownError),me.doFinalize())}var finalizationCodeStarted=!1;if(me.parent||me.reusingSandbox)finalizationCode();else{var originalSetTimeout=me.originalSetTimeout,originalClearTimeout=me.originalClearTimeout,timeout=originalSetTimeout(function(){finalizationCode(R.get("testTearDownTimeout"))},me.isReadyTimeout);try{me.tearDown(function(){originalClearTimeout(timeout),finalizationCode()},function(error){originalClearTimeout(timeout),finalizationCode(error)})}catch(e){finalizationCode(e+"")}}}else!me.__timeoutWarning&&me.overrideSetTimeout&&me.lastActivityDate&&new Date-me.lastActivityDate>2*me.defaultTimeout&&(me.diag(R.get("testStillRunning")),me.warn(R.get("testNotFinalized",{url:me.url})),me.__timeoutWarning=!0)},doFinalize:function(){var me=this;if(!me.endDate){me.endDate=+new Date,me.parent||me.addResult(new Siesta.Result.Summary({isFailed:me.isFailed(),description:me.getSummaryMessage()}));try{me.onTestFinalize()}catch(e){"undefined"!=typeof console&&console.log(e)}me.fireEvent("testfinalize",me),me.fireEvent("testendbubbling",me),me.callback&&me.callback(),me.callback=null}},onBeforeTestFinalize:function(){},onTestFinalize:function(){},onTestStart:function(){},getSummaryMessage:function(lineBreaks){var res=[],passCount=this.getPassCount(),failCount=this.getFailCount(),assertPlanned=this.assertPlanned,total=failCount+passCount;if(res.push("Passed: "+passCount),res.push("Failed: "+failCount),!this.failed)if(null!=assertPlanned)total<assertPlanned&&res.push("Looks like you planned "+assertPlanned+" tests, but ran only "+total),assertPlanned<total&&res.push("Looks like you planned "+assertPlanned+" tests, but ran "+(total-assertPlanned)+" extra tests, "+total+" total."),total!=assertPlanned||failCount||res.push("All tests passed");else{var R=Siesta.Resource("Siesta.Test");this.isDoneCorrectly()||res.push(R.get("missingDoneCall")),this.isDoneCorrectly()&&!failCount&&res.push(R.get("allTestsPassed"))}return lineBreaks?res.join(lineBreaks):res},done:function(delay){var me=this;if(delay){var async=this.beginAsync();(0,this.originalSetTimeout)(function(){me.endAsync(async),me.done()},delay)}else this.doDone(!1),this.processed&&this.finalize()},doDone:function(force){var me=this;if(me.fireEvent("beforetestfinalizeearly",me),!Joose.O.isEmpty(me.timeoutIds)){if(!force)return!1;me.clearTimeouts()}me.onBeforeTestFinalize(),me.fireEvent("beforetestfinalize",me),this.isDone=!0},isDoneCorrectly:function(){return!this.needDone||this.isDone},getAssertionCount:function(excludeTodo){var count=0;return this.eachAssertion(function(assertion){excludeTodo&&assertion.isTodo||count++}),count},getPassCount:function(includeTodo){if(null!=this.$passCount&&!includeTodo)return this.$passCount;var passCount=0;return this.eachAssertion(function(assertion){!assertion.passed||!includeTodo&&assertion.isTodo||passCount++}),includeTodo?passCount:this.$passCount=passCount},getTodoPassCount:function(){var todoCount=0;return this.eachAssertion(function(assertion){assertion.isTodo&&assertion.passed&&todoCount++}),todoCount},getTodoFailCount:function(){var todoCount=0;return this.eachAssertion(function(assertion){assertion.isTodo&&!assertion.passed&&todoCount++}),todoCount},getFailCount:function(includeTodo){if(null!=this.$failCount&&!includeTodo)return this.$failCount;var failCount=0;return this.eachAssertion(function(assertion){assertion.passed||!includeTodo&&assertion.isTodo||failCount++}),includeTodo?failCount:this.$failCount=failCount},getFailedAssertions:function(){var failed=[];return this.eachAssertion(function(assertion){assertion.isPassed()||failed.push(assertion)}),failed},isPassed:function(){var passCount=this.getPassCount(),failCount=this.getFailCount(),assertPlanned=this.assertPlanned;return this.isFinished()&&(!this.failed||this.isTodo)&&!failCount&&(null!=assertPlanned&&passCount==assertPlanned||null==assertPlanned&&this.isDoneCorrectly())},isFailed:function(){var passCount=this.getPassCount(),failCount=this.getFailCount(),assertPlanned=this.assertPlanned;return this.failed||failCount||this.isFinished()&&(null!=assertPlanned&&passCount!=assertPlanned||null==assertPlanned&&!this.isDoneCorrectly())},isFailedWithException:function(){return this.failed},isStarted:function(){return null!=this.startDate},isFinished:function(){return null!=this.endDate},getDuration:function(){return this.endDate-this.startDate},getBubbleTarget:function(){return this.parent||this.project},warn:function(message){this.addResult(new Siesta.Result.Diagnostic({description:message,isWarning:!0}))},flattenArray:function(array,stripEmpty){var me=this,result=[];return Joose.A.each(array,function(el){"Array"==me.typeOf(el)?result.push.apply(result,me.flattenArray(el,stripEmpty)):stripEmpty&&!el||result.push(el)}),result},trimString:function(string){return String(string).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},buildActionableMethods:function(){var methods={};return this.meta.getMethods().each(function(method,name){methods[name.toLowerCase()]=name}),methods},getJUnitClass:function(){return this.jUnitClass||this.meta.name||"Siesta.Test"},resource:function(){return Siesta.Resource.apply(Siesta.Resource,arguments)},getRootTest:function(){for(var root=this;root.parent;)root=root.parent;return root},onException:function(){}}}),Singleton("Siesta.Test.ActionRegistry",{has:{actionClasses:Joose.I.Object},methods:{registerAction:function(name,constructor){this.actionClasses[name.toLowerCase()]=constructor},getActionClass:function(name){return this.actionClasses[name.toLowerCase()]},create:function(obj,test,defaultArgs,initStep){if(obj!==Object(obj))throw"Action configuration should be an Object instance";if(!(obj=Joose.O.copy(obj)).action){var actionClasses=this.actionClasses,methods={};test&&(methods=test.getActionableMethods()),Joose.O.eachOwn(obj,function(value,key){var shortcut=key.toLowerCase();if(actionClasses[shortcut]){switch(obj.action=shortcut){case"setvalue":case"waitfor":break;case"type":obj.text=value;break;default:obj.target=value}return!1}if(methods[shortcut])return shortcut.match(/^waitFor/i)?(obj.action="wait",obj.waitFor=methods[shortcut]):(obj.action="methodCall",obj.methodName=methods[shortcut]),obj.args=value||[],!1})}if(!obj.action)throw"Need to include `action` property or shortcut property in the step config: "+Siesta.Util.Serializer.stringify(obj,2);"wait"!=obj.action&&"waitfor"!=obj.action&&"delay"!=obj.action&&"methodCall"!=obj.action&&!obj.args&&defaultArgs&&(obj.args=defaultArgs);var actionClass=this.getActionClass(obj.action);return obj.next&&!initStep||(obj.next=initStep(actionClass.prototype.hasOwnAsyncFrame).next),obj.test&&!test||(obj.test=test),new actionClass(obj)}}}),Class("Siesta.Test.Action",{has:{args:null,desc:null,test:{required:!0},next:{required:!0},requiredTestMethod:null},methods:{initialize:function(){var requiredTestMethod=this.requiredTestMethod;if(requiredTestMethod&&!this.test[requiredTestMethod])throw new Error(Siesta.Resource("Siesta.Test.Action","missingTestAction").replace("{0}",this.meta.name).replace("{1}",requiredTestMethod))},process:function(){this.next()}}}),Class("Siesta.Test.Action.Done",{isa:Siesta.Test.Action,has:{delay:null},methods:{process:function(){this.test.done(this.delay),this.next()}}}),Siesta.Test.ActionRegistry().registerAction("done",Siesta.Test.Action.Done),Class("Siesta.Test.Action.Wait",{isa:Siesta.Test.Action,has:{delay:1e3,timeout:null,interval:null,args:Joose.I.Array,waitFor:null,trigger:null,hasOwnAsyncFrame:!0,description:""},methods:{process:function(){var waitFor=this.waitFor,test=this.test;"Number"!==test.typeOf(waitFor)&&"Function"!==test.typeOf(waitFor)||(this.args=[waitFor],waitFor=""),null==waitFor&&(this.args=[this.delay],waitFor=""),"Function"===test.typeOf(this.args)&&"waitForFn"!=waitFor&&(this.args=this.args.call(test,this)),"Array"!==test.typeOf(this.args)&&(this.args=[this.args]),waitFor=waitFor.replace(/^waitFor/,"");var methodName="waitFor"+Joose.S.uppercaseFirst(waitFor);if(!test[methodName])throw Siesta.Resource("Siesta.Test.Action.Wait","missingMethodText")+methodName;"waitFor"==methodName?test.waitFor({method:this.args[0],callback:this.next,scope:test,timeout:this.timeout||test.waitForTimeout,interval:this.interval,description:this.description||this.desc||""}):test[methodName].apply(test,this.args.concat(this.next,test,this.timeout||test.waitForTimeout));var trigger=this.trigger;trigger&&("Function"==test.typeOf(trigger)?trigger.call(test,test):(trigger instanceof Siesta.Test.Action||(trigger.next=function(){},trigger.test=this.test,trigger=Siesta.Test.ActionRegistry().create(trigger,test)),trigger.process()))}}}),Joose.A.each(["wait","waitFor","delay"],function(name){Siesta.Test.ActionRegistry().registerAction(name,Siesta.Test.Action.Wait)}),Class("Siesta.Test.Action.Eval",{isa:Siesta.Test.Action,has:{actionString:null},methods:{process:function(){var test=this.test,parsed=this.parseActionString(this.actionString);if(parsed.error)return test.fail(parsed.error),void this.next();var methodName=parsed.methodName;if(!methodName||"Function"!=test.typeOf(test[methodName]))return test.fail(Siesta.Resource("Siesta.Test.Action.Eval","invalidMethodNameText")+methodName),void this.next();parsed.params.push(this.next),test[methodName].apply(test,parsed.params)},parseActionString:function(actionString){var match=/^\s*(.+?)\(\s*(.*)\s*\)\s*$/.exec(actionString);if(!match)return{error:Siesta.Resource("Siesta.Test.Action.Eval","wrongFormatText")+actionString};var methodName=match[1].replace(/^t\./,"");try{var params=JSON.parse("["+match[2]+"]")}catch(e){return{error:Siesta.Resource("Siesta.Test.Action.Eval","parseErrorText")+match[2]}}return{methodName:methodName,params:params}}}}),Class("Siesta.Test.Action.MethodCall",{isa:Siesta.Test.Action,has:{methodName:null,args:null,callbackIndex:null},methods:{process:function(){var test=this.test,methodName=this.methodName,args=this.args;"Function"==test.typeOf(args)&&(args=args.call(test,this)),args="Array"==test.typeOf(args)?args.slice():[args],null!=this.callbackIndex?args.splice(this.callbackIndex,0,this.next):args.push(this.next),test[methodName].apply(test,args)}}}),Siesta.Test.ActionRegistry().registerAction("methodCall",Siesta.Test.Action.MethodCall),Class("Siesta.Util.TreeStoreFilterer",{has:{idProp:{required:!0},childNodesProp:{required:!0},parentNodeProp:{required:!0},isLeaf:{required:!0}},does:[Siesta.Util.Role.CanEscapeRegExp],methods:{parseFilterValue:function(filterValue){var parts=filterValue.split(/\s*\>\s*/),groupFilter=1<parts.length?parts[0]:"",leafFilter=1<parts.length?parts[1]:parts[0];return{testFilterRegexps:this.splitTermByPipe(leafFilter),groupFilterRegexps:groupFilter?this.splitTermByPipe(groupFilter):null}},checkCommonFilter:function(node,getTitle,testFilterRegexps,groupFilterRegexps){if(groupFilterRegexps){for(var currentNode=node,isInGroup=!1;currentNode&&currentNode[this.parentNodeProp];){var parent=currentNode[this.parentNodeProp];if(this.matchAnyOfRegExps(getTitle(parent),groupFilterRegexps)){isInGroup=!0;break}currentNode=parent}if(!isInGroup)return!1}return!!this.matchAnyOfRegExps(getTitle(node),testFilterRegexps)||!testFilterRegexps.length},splitTermByPipe:function(term){for(var parts=term.split(/\s*\|\s*/),regexps=[],me=this,i=0;i<parts.length;i++)parts[i]&&regexps.push(Joose.A.map(parts[i].split(/\s+/),function(token){return new RegExp(me.escapeRegExp(token),"i")}));return regexps},matchAnyOfRegExps:function(string,regexps){for(var p=0;p<regexps.length;p++){for(var groupMatch=!0,len=regexps[p].length,i=0;i<len;i++)if(!regexps[p][i].test(string)){groupMatch=!1;break}if(groupMatch)return!0}return!1},collectNodes:function(root,params){var filter=params.filter,scope=params.scope||this,shallowScan=params.shallow,checkParents=params.checkParents||shallowScan,fullMatchingParents=params.fullMatchingParents,onlyParents=params.onlyParents||fullMatchingParents;if(onlyParents&&checkParents)throw new Error("Can't combine `onlyParents` and `checkParents` options");function includeNodeInResults(node){visibleNodes[node[idProp]]=!0;for(var parent=node[parentNodeProp];parent&&!visibleNodes[parent[idProp]];)visibleNodes[parent[idProp]]=!0,parent=parent[parentNodeProp]}var idProp=this.idProp,parentNodeProp=this.parentNodeProp,childNodesProp=this.childNodesProp,isLeaf=this.isLeaf,rootVisible=params.rootVisible,visibleNodes={},cascadeNode=function(node,func){func(node);for(var childNodes=node[childNodesProp],length=childNodes.length,k=0;k<length;k++)isLeaf(node)?func(node):cascadeNode(childNodes[k],func)};rootVisible&&(visibleNodes[root[idProp]]=!0);var collectNodes=function(node){var nodeMatches,childNodes,length,k;if(!node.hidden)if(isLeaf(node))filter.call(scope,node,visibleNodes)&&includeNodeInResults(node);else if(onlyParents){if((nodeMatches=filter.call(scope,node))&&(includeNodeInResults(node),fullMatchingParents))return void cascadeNode(node,function(currentNode){visibleNodes[currentNode[idProp]]=!0});for(length=(childNodes=node[childNodesProp]).length,k=0;k<length;k++)nodeMatches&&isLeaf(childNodes[k])?visibleNodes[childNodes[k][idProp]]=!0:isLeaf(childNodes[k])||collectNodes(childNodes[k])}else if(checkParents&&(nodeMatches=filter.call(scope,node,visibleNodes))&&includeNodeInResults(node),!checkParents||!shallowScan||shallowScan&&(nodeMatches||node==root&&!rootVisible))for(length=(childNodes=node[childNodesProp]).length,k=0;k<length;k++)collectNodes(childNodes[k])};return collectNodes(root),visibleNodes}}}),Role("Siesta.Util.Role.CanDetectES6",{has:{supportsArrowFunctions:function(){return this.canEvaluate("x => x")}},methods:{canEvaluate:function(str){try{return eval(str),!0}catch(e){return!1}}}}),Class("Siesta.Project",{does:[JooseX.Observable,Siesta.Util.Role.CanGetType,Siesta.Util.Role.CanDetectES6],has:{title:null,desc:null,testClass:Siesta.Test,contentManagerClass:Siesta.Content.Manager,descriptors:Joose.I.Array,descriptorsById:Joose.I.Object,launchCounter:0,launches:Joose.I.Object,scopesByURL:Joose.I.Object,testsByURL:Joose.I.Object,transparentEx:!1,scopeProviderConfig:null,scopeProvider:null,runCore:"parallel",maxThreads:4,autoCheckGlobals:!1,disableGlobalsCheck:!1,expectedGlobals:Joose.I.Array,cleanScopeGlobals:Joose.I.Array,preload:Joose.I.Array,cachePreload:!1,mainPreset:null,emptyPreset:null,keepNLastResults:2,lastResultsURLs:Joose.I.Array,lastResultsByURL:Joose.I.Object,breakOnFail:!1,overrideSetTimeout:!1,needDone:!1,increaseTimeoutThreshold:8,startDate:null,endDate:null,waitForTimeout:1e4,defaultTimeout:15e3,subTestTimeout:null,isReadyTimeout:1e4,pauseBetweenTests:10,failOnExclusiveSpecsWhenAutomated:!1,snooze:null,referenceUrl:null,suppressPassedWaitForAssertion:!1,isEcmaModule:null,setupDone:!1,sourceLineForAllAssertions:!1,currentLaunchId:null,isAutomated:!1,autoLaunchTests:!0,configSynonyms:function(){return this.processConfigSynonyms(this.buildConfigSynonyms())},uniqueCounter:0,valueToHashIndicies:Joose.I.Object,sandboxHashStructure:{lazy:"this.buildSandboxHashStructure"},sandbox:!0,sandboxBoundaryByGroup:!0,sandboxCleanup:!0,debuggerOnFail:!1,debuggerOnStart:!1},methods:{initialize:function(){var me=this;me.on("testupdate",function(event,test,result,parentResult){me.onTestUpdate(test,result,parentResult)}),me.on("testfailedwithexception",function(event,test,exception,stack){me.onTestFail(test,exception,stack)}),me.on("teststart",function(event,test){me.onTestStart(test)}),me.on("testfinalize",function(event,test){me.onTestEnd(test)})},buildConfigSynonyms:function(){return{}},processConfigSynonyms:function(synonyms){var result={};return Joose.O.each(synonyms,function(synonymsList,mainName){synonymsList instanceof Array?synonymsList.unshift(mainName):synonymsList=[mainName,synonymsList],Joose.A.each(synonymsList,function(synonym){result[synonym]=synonymsList})}),result},onTestUpdate:function(test,result,parentResult){},onTestFail:function(test,exception,stack){},onTestStart:function(test){},onTestEnd:function(test){},onTestSuiteStart:function(descriptors,contentManager,launchState){this.startDate=new Date,this.fireEvent("testsuitestart",this,launchState)},onTestSuiteEnd:function(descriptors,contentManager,launchState){this.endDate=new Date,this.fireEvent("testsuiteend",this,launchState)},onBeforeScopePreload:function(scopeProvider,url){this.fireEvent("beforescopepreload",scopeProvider,url)},onAfterScopePreload:function(scopeProvider,url){this.fireEvent("afterscopepreload",scopeProvider,url)},onCachingError:function(descriptors,contentManager){},configure:function(config){Joose.O.copy(config,this);var me=this;config.listeners&&Joose.O.each(config.listeners,function(value,name){"scope"!=name&&me.on(name,value,config.scope||me)})},processPreloadArray:function(preload){var me=this;return preload=this.flattenArray(preload,!0),Joose.A.each(preload,function(obj,index){Object(obj)===obj?obj.url&&(obj.url=me.normalizeURL(obj.url)):preload[index]=me.normalizeURL(obj)}),preload},populateCleanScopeGlobals:function(scopeProvider,callback){var scopeProviderClass=eval(scopeProvider),cleanScope=new scopeProviderClass,cleanScopeGlobals=this.cleanScopeGlobals;cleanScope.setup(function(){for(var name in cleanScope.scope)cleanScopeGlobals.push(name);callback(),setTimeout(function(){cleanScope.cleanup()},0)})},startSingle:function(desc,callback){var me=this;this.__counter__=this.__counter__||0;function startSingle(){me.launch([me.normalizeDescriptor(desc,me,me.__counter__++)],callback)}me.setupDone?startSingle():this.setup(startSingle)},setup:function(callback){this.mainPreset=new Siesta.Content.Preset({preload:this.processPreloadArray(this.preload)}),this.emptyPreset=new Siesta.Content.Preset,this.descriptors.push({isSystemDescriptor:!0,url:"/"}),this.normalizeDescriptors(this.descriptors),this.populateCleanScopeGlobals(this.scopeProvider,callback)},plan:function(){var descriptors=this.flattenArray(arguments);this.descriptors.push.apply(this.descriptors,descriptors)},start:function(){var me=Siesta.my.activeHarness=this;me.plan(this.flattenArray(arguments)),this.setup(function(){me.setupDone=!0,me.fireEvent("setupdone"),me.autoLaunchTests&&me.launch(me.descriptors)})},startFromUrl:function(url){var contentManager=new this.contentManagerClass({project:this,presets:[new Siesta.Content.Preset({preload:[url]})]}),me=this;contentManager.cache(function(){var content=contentManager.getContentOf(url);try{var descriptors=JSON.parse(content)}catch(e){return void alert("The content of: "+url+" is not a valid JSON")}"Array"==me.typeOf(descriptors)?me.start(descriptors):alert("The content of: "+url+" is not an array")},function(){alert("Can not load the content of: "+url)})},normalizeDescriptors:function(descArray){var me=this,descriptors=[];Joose.A.each(descArray,function(desc,index){desc&&descriptors.push(me.normalizeDescriptor(desc,me,index))}),me.descriptors=descriptors},launch:function(descriptors,callback,errback){var launchId=this.currentLaunchId=++this.launchCounter,me=this,flattenDescriptors=this.flattenDescriptors(descriptors),testScriptsPreset=new Siesta.Content.Preset,presets=[testScriptsPreset,this.mainPreset],notLaunchedByAutomationId={};Joose.A.each(flattenDescriptors,function(desc){desc.preset!=me.mainPreset&&desc.preset!=me.emptyPreset&&presets.push(desc.preset),desc.testCode||testScriptsPreset.addResource(desc.url),me.deleteTestByURL(desc.url),notLaunchedByAutomationId[desc.automationElementId]=1});var contentManager=new this.contentManagerClass({project:this,presets:[testScriptsPreset].concat(this.cachePreload?presets:[])}),launchState=this.launches[launchId]={launchId:launchId,increaseTimeout:"parallel"==this.runCore&&flattenDescriptors.length>this.increaseTimeoutThreshold,descriptors:flattenDescriptors,contentManager:contentManager,needToStop:!1,notLaunchedByAutomationId:notLaunchedByAutomationId};me.onTestSuiteStart(descriptors,contentManager,launchState),contentManager.cache(function(){Joose.A.each(flattenDescriptors,function(desc){var url=desc.url;if(contentManager.hasContentOf(url)){var testConfig=desc.testConfig=Siesta.getConfigForTestScript(contentManager.getContentOf(url));testConfig&&(testConfig.preload||testConfig.alsoPreload)&&(desc.preset=me.getDescriptorPreset(desc))}else desc.testCode||me.markMissingFile(desc);me.normalizeScopeProvider(desc)}),me.fireEvent("testsuitelaunch",descriptors,contentManager,launchState),me.runCoreGeneral(flattenDescriptors,contentManager,launchState,launchState.callback=function(){me.onTestSuiteEnd(descriptors,contentManager,launchState),callback&&callback(descriptors),launchState.needToStop=!0,delete me.launches[launchId]})},function(){},!0)},markMissingFile:function(desc){desc.isMissing=!0},flattenDescriptors:function(descriptors,includeFolders){var flatten=[],me=this;return Joose.A.each(descriptors,function(descriptor){descriptor.group?(includeFolders&&flatten.push(descriptor),flatten.push.apply(flatten,me.flattenDescriptors(descriptor.items,includeFolders))):descriptor.isSystemDescriptor||flatten.push(descriptor)}),flatten},forEachDescriptor:function(descriptors,includeFolders,func,scope){var me=this;return Joose.A.each(descriptors,function(descriptor){return descriptor.group?(!includeFolders||!1!==func.call(scope||me,descriptor))&&me.forEachDescriptor(descriptor.items,includeFolders,func,scope):!(!descriptor.isSystemDescriptor&&!1===func.call(scope||me,descriptor))&&void 0})},lookUpValueInDescriptorTree:function(descriptor,configName,doNotLookAtRoot){if(this.descriptorHasOwnValueFor(descriptor,configName))return this.getConfigValueFromDescriptor(descriptor,configName);var parent=descriptor.parent;return parent?parent==this?doNotLookAtRoot?void 0:this.getConfigValueFromDescriptor(this,configName):this.lookUpValueInDescriptorTree(parent,configName,doNotLookAtRoot):void 0},descriptorHasOwnValueFor:function(descriptor,configName){var testConfig=descriptor.testConfig;if(testConfig&&testConfig.hasOwnProperty(configName)||descriptor.hasOwnProperty(configName))return!0;var synonymList=this.configSynonyms[configName],result=!1;return synonymList&&Joose.A.each(synonymList,function(synonym){if(synonym!=configName&&(testConfig&&testConfig.hasOwnProperty(synonym)||descriptor.hasOwnProperty(synonym)))return!(result=!0)}),result},getConfigValueFromDescriptor:function(descriptor,configName,allowInherited){if(descriptor==this){var foundOwnValue,synonymList=this.configSynonyms[configName]||[configName];return Joose.A.each(synonymList,function(synonym){if(descriptor.hasOwnProperty(synonym))return result=descriptor[synonym],!(foundOwnValue=!0)}),foundOwnValue?result:this[configName]}var result,testConfig=descriptor.testConfig;return testConfig&&testConfig.hasOwnProperty(configName)?testConfig[configName]:descriptor.hasOwnProperty(configName)?descriptor[configName]:((synonymList=this.configSynonyms[configName])&&Joose.A.each(synonymList,function(synonym){if(synonym!=configName&&(testConfig&&testConfig.hasOwnProperty(synonym)||descriptor.hasOwnProperty(synonym)))return result=testConfig&&testConfig.hasOwnProperty(synonym)?testConfig[synonym]:descriptor[synonym],!1}),result)},getDescriptorConfig:function(descriptor,configName,doNotLookAtRoot){return this.lookUpValueInDescriptorTree(descriptor,configName,doNotLookAtRoot)},getDescriptorPreset:function(desc){var preload=this.getDescriptorConfig(desc,"preload",!0),alsoPreload=this.getDescriptorConfig(desc,"alsoPreload",!0);if(preload||alsoPreload){var totalPreload=(preload||this.preload||[]).concat(alsoPreload||[]);return totalPreload.length?new Siesta.Content.Preset({preload:this.processPreloadArray(totalPreload)}):this.emptyPreset}return this.mainPreset},normalizeScopeProvider:function(desc){var match,scopeProvider=this.getDescriptorConfig(desc,"scopeProvider");scopeProvider=scopeProvider&&((match=/^=(.+)/.exec(scopeProvider))?match[1]:scopeProvider.replace(/^(Scope\.Provider\.)?/,"Scope.Provider."));desc.scopeProvider=scopeProvider,desc.scopeProviderConfig=this.getDescriptorConfig(desc,"scopeProviderConfig")},normalizeDescriptor:function(desc,parent,index,level){if(desc.normalized)return desc;"string"==typeof desc&&(desc={url:desc}),level=level||0;var me=this;if(desc.parent=parent,desc.group){desc.id=parent==this?"testFolder-"+level+"-"+index:parent.id+"/"+level+"-"+index;var items=[];Joose.A.each(desc.items||[],function(subDesc,index){subDesc&&items.push(me.normalizeDescriptor(subDesc,desc,index,level+1))}),desc.items=items}else desc.id=desc.url,desc.preset=this.getDescriptorPreset(desc),desc.name=desc.name||desc.url.replace(/(?:.*\/)?([^/]+)$/,"$1");return(this.descriptorsById[desc.id]=desc).normalized=!0,desc},runCoreGeneral:function(descriptors,contentManager,launchState,callback){var runCoreMethod="runCore"+Joose.S.uppercaseFirst(this.runCore);if("function"!=typeof this[runCoreMethod])throw new Error("Invalid `runCore` specified: ["+this.runCore+"]");this[runCoreMethod](descriptors,contentManager,launchState,callback)},runCoreParallel:function(descriptors,contentManager,launchState,callback){var me=this,processedNum=0,count=descriptors.length;count||callback();function doProcessURL(desc){me.processURL(desc,desc.index,contentManager,launchState,function(){processedNum++,launchState.needToStop?hasExited||(hasExited=!0,callback()):processedNum==count?callback():launchThread(descriptors)})}for(var hasExited=!1,hasLaunchedAllThreads=!1,launchThread=function(descriptors){var desc=descriptors.shift();desc&&(hasLaunchedAllThreads?setTimeout(function(){doProcessURL(desc)},me.pauseBetweenTests):doProcessURL(desc))},i=1;i<=this.maxThreads;i++)launchThread(descriptors);hasLaunchedAllThreads=!0},runCoreSequential:function(descriptors,contentManager,launchState,callback){if(descriptors.length&&!launchState.needToStop){var desc=descriptors.shift(),me=this;this.processURL(desc,desc.index,contentManager,launchState,function(){descriptors.length&&!launchState.needToStop?setTimeout(function(){me.runCoreSequential(descriptors,contentManager,launchState,callback)},me.pauseBetweenTests):callback()})}else callback()},stopCurrentLaunch:function(sourceTest){var launchState=this.launches[sourceTest?sourceTest.launchId:this.currentLaunchId];if(launchState&&!launchState.needToStop){launchState.needToStop=!0;var me=this;return Joose.A.each(launchState.descriptors,function(desc){var test=me.testsByURL[desc.url];if(test)try{test.finalize(!0)}catch(e){}}),!0}},getSeedingCode:function(desc,launchId){return";("+function(descId,launchId){StartTest=startTest=function(){arguments.callee.args=arguments},describe=function(){if(describe.called)throw new Error("`describe()` used as global function instead of test method `t.describe()`");describe.called=!0,StartTest.apply(this,arguments)},StartTest.launchId=launchId,StartTest.id=descId,StartTest.exceptionCatcher=function(func){var ex;try{func()}catch(e){ex=e}return"__SIESTA_TEST_EXIT_EXCEPTION__"==ex?void 0:ex},StartTest.testErrorClass=Error}.toString()+")("+JSON.stringify(desc.id)+", "+launchId+")"},getScopeProviderConfigFor:function(desc,launchId){var config=Joose.O.copy(desc.scopeProviderConfig||{});return config.seedingCode=this.getSeedingCode(desc,launchId),config.launchId=launchId,config},keepTestResult:function(url){if(this.lastResultsByURL[url]){var indexOf=-1;return Joose.A.each(this.lastResultsURLs,function(resultUrl,i){if(resultUrl==url)return indexOf=i,!1}),this.lastResultsURLs.splice(indexOf,1),void this.lastResultsURLs.push(url)}this.lastResultsURLs.push(url),this.lastResultsByURL[url]=!0,this.lastResultsURLs.length>this.keepNLastResults&&this.releaseTestResult()},releaseTestResult:function(){if(!(this.lastResultsURLs.length<=this.keepNLastResults)){var url=this.lastResultsURLs.shift();delete this.lastResultsByURL[url];var test=this.getTestByURL(url);test&&test.isFinished()&&this.cleanupScopeForURL(url)}},isKeepingResultForURL:function(url){return this.lastResultsByURL[url]},setupScope:function(desc,launchId){var url=desc.url,alreadyExisting=this.scopesByURL[url],isOutdatedRequest=alreadyExisting&&alreadyExisting.launchId>launchId,scopeProviderClass=eval(desc.scopeProvider),newProvider=new scopeProviderClass(this.getScopeProviderConfigFor(desc,launchId));return isOutdatedRequest?newProvider:(this.cleanupScopeForURL(url),this.keepTestResult(url),this.scopesByURL[url]=newProvider)},cleanupScopeForURL:function(url){var scopeProvider=this.scopesByURL[url];scopeProvider&&(delete this.scopesByURL[url],scopeProvider.cleanup())},prepareScopeSeeding:function(scopeProvider,desc,contentManager){var isEcmaModule=this.getDescriptorConfig(desc,"isEcmaModule");desc.testCode||this.cachePreload&&contentManager.hasContentOf(desc.url)?scopeProvider.addPreload({type:"js",content:desc.testCode||contentManager.getContentOf(desc.url)+"\n//# sourceURL="+desc.url,isEcmaModule:isEcmaModule}):(scopeProvider.seedingScript=this.resolveURL(desc.url,scopeProvider,desc),scopeProvider.seedingScriptIsEcmaModule=isEcmaModule)},normalizeURL:function(url){return url},resolveURL:function(url,scopeProvider,desc){return url},canUseCachedContent:function(resource,desc){return this.cachePreload&&resource instanceof Siesta.Content.Resource.JavaScript},addCachedResourceToPreloads:function(scopeProvider,contentManager,resource,desc){scopeProvider.addPreload({type:"js",content:contentManager.getContentOf(resource)})},getOnErrorHandler:function(testHolder,preloadErrors){var R=Siesta.Resource("Siesta.Project");return function(msg,url,lineNumber,col,error,promiseRejectionEvent){var test=testHolder.test;if(promiseRejectionEvent&&(msg=promiseRejectionEvent.reason||"",url=lineNumber=col="",error=test.global&&promiseRejectionEvent.reason instanceof test.global.Error?promiseRejectionEvent.reason:null),1===arguments.length){var event=msg;if(error=event.error,event.target&&event.target.tagName&&!error)return msg=R.get("resourceFailedToLoad",{nodeName:event.target?event.target.nodeName.toUpperCase():""}),url=event.srcElement?event.srcElement.href||event.srcElement.src:"",lineNumber="",void test.fail(msg+" "+(event.target?event.target.outerHTML:url));msg=event.message,url="",lineNumber=0}/__SIESTA_TEST_EXIT_EXCEPTION__|ResizeObserver loop limit exceeded/.test(msg)||test&&!0===test.onException(msg,url,lineNumber,col,error)||(test&&test.isStarted()?(test.nbrExceptions++,test.failWithException(error||msg+" "+url+" "+lineNumber,promiseRejectionEvent?"Unhandled promise rejection in test "+(test.name||test.url):null)):preloadErrors&&preloadErrors.push({isException:!0,message:error&&error.stack?test.stringifyException(error,error.stack):msg+" "+url+" "+lineNumber}))}},processURL:function(desc,index,contentManager,launchState,callback,noCleanup,sharedSandboxState){var me=this,url=desc.url;if(desc.isMissing)callback();else{delete launchState.notLaunchedByAutomationId[desc.automationElementId];var testHolder={},preloadErrors=[],onErrorHandler=this.getOnErrorHandler(testHolder,preloadErrors),scopeProvider=this.setupScope(desc,launchState.launchId),transparentEx=this.getDescriptorConfig(desc,"transparentEx"),onErrorHandlerBorrowing=scopeProvider.addOnErrorHandler(onErrorHandler,!transparentEx);desc.preset.eachResource(function(resource){if(contentManager.hasContentOf(resource)&&me.canUseCachedContent(resource,desc))me.addCachedResourceToPreloads(scopeProvider,contentManager,resource,desc);else{var resourceDesc=resource.asDescriptor();resourceDesc.url&&(resourceDesc.url=me.resolveURL(resourceDesc.url,scopeProvider,desc)),scopeProvider.addPreload(resourceDesc)}}),me.prepareScopeSeeding(scopeProvider,desc,contentManager);var testClass=me.getDescriptorConfig(desc,"testClass");"String"==me.typeOf(testClass)&&(testClass=Joose.S.strToClass(testClass));var testConfig=me.getNewTestConfiguration(desc,scopeProvider,contentManager,launchState,sharedSandboxState),test=testHolder.test=new testClass(testConfig);this.onBeforeScopePreload(scopeProvider,url,test),test.earlySetup(function(){cont()},function(errorMessage){preloadErrors.push({isException:!1,message:errorMessage}),cont()})}function cont(){var R=Siesta.Resource("Siesta.Project");scopeProvider.setup(function(scopeProvider,failedPreloads,crossOriginFailed){me.onAfterScopePreload(scopeProvider,url,test,failedPreloads),failedPreloads&&Joose.O.each(failedPreloads,function(value,url){preloadErrors.unshift({isException:!1,message:R.get("preloadHasFailed",{url:url})})}),crossOriginFailed&&preloadErrors.push({isException:!0,message:R.get("crossOriginFailed",{url:scopeProvider.sourceURL})}),scopeProvider.scope?me.launchTest({testHolder:testHolder,desc:desc,scopeProvider:scopeProvider,contentManager:contentManager,launchState:launchState,preloadErrors:preloadErrors,onErrorHandler:onErrorHandler,onErrorHandlerBorrowing:onErrorHandlerBorrowing,startTestAnchor:crossOriginFailed?null:scopeProvider.scope.StartTest,noCleanup:noCleanup,reusingSandbox:!1},callback):callback()})}},launchTest:function(options,callback){var scopeProvider=options.scopeProvider,desc=options.desc,me=this,url=desc.url,testHolder=options.testHolder,noCleanup=options.noCleanup,cleanupUrl=options.cleanupUrl,test=testHolder.test;if(test.callback=function(){noCleanup||me.isKeepingResultForURL(url)||me.cleanupScopeForURL(cleanupUrl||url),callback&&callback(testHolder),testHolder=null},scopeProvider.crossOriginFailed)return test.isFinished()||test.start(options.preloadErrors),void(test=options=null);var startTestAnchor=options.startTestAnchor,args=startTestAnchor&&startTestAnchor.args,global=scopeProvider.scope;Joose.O.extend(test,{startTestAnchor:startTestAnchor,exceptionCatcher:startTestAnchor.exceptionCatcher,testErrorClass:startTestAnchor.testErrorClass,global:global,originalSetTimeout:options.originalSetTimeout||global.setTimeout,originalClearTimeout:options.originalClearTimeout||global.clearTimeout,run:args&&("function"==typeof args[0]?args[0]:args[1]),reusingSandbox:options.reusingSandbox}),options.onErrorHandler&&(options.onErrorHandlerBorrowing&&options.onErrorHandlerBorrowing(),options.onErrorHandlerBorrowing=scopeProvider.addOnErrorHandler(options.onErrorHandler,!this.getDescriptorConfig(desc,"transparentEx"))),this.saveTestWithURL(url,test);function doLaunch(){scopeProvider.scope?(me.fireEvent("beforeteststart",test),test.isFinished()||test.start(options.preloadErrors),test=options=null):callback()}options.reusingSandbox?doLaunch():scopeProvider instanceof Scope.Provider.IFrame?global.setTimeout(doLaunch,10):setTimeout(doLaunch,50)},getNewTestConfiguration:function(desc,scopeProvider,contentManager,launchState,sharedSandboxState){for(var groups=[],currentDesc=desc.parent;currentDesc;)currentDesc.parent&&groups.unshift(String(currentDesc.group)),currentDesc=currentDesc.parent;return{url:desc.url,name:desc.name,referenceUrl:this.getDescriptorConfig(desc,"referenceUrl"),launchId:launchState.launchId,automationElementId:desc.automationElementId,groups:groups,jUnitClass:this.getDescriptorConfig(desc,"jUnitClass"),project:this,expectedGlobals:this.cleanScopeGlobals.concat(this.getDescriptorConfig(desc,"expectedGlobals")),autoCheckGlobals:this.getDescriptorConfig(desc,"autoCheckGlobals"),disableGlobalsCheck:this.disableGlobalsCheck,scopeProvider:scopeProvider,contentManager:contentManager,transparentEx:this.getDescriptorConfig(desc,"transparentEx"),needDone:this.getDescriptorConfig(desc,"needDone"),overrideSetTimeout:this.getDescriptorConfig(desc,"overrideSetTimeout"),defaultTimeout:this.getDescriptorConfig(desc,"defaultTimeout")*(launchState.increaseTimeout?2:1),subTestTimeout:this.getDescriptorConfig(desc,"subTestTimeout")*(launchState.increaseTimeout?2:1),waitForTimeout:this.getDescriptorConfig(desc,"waitForTimeout")*(launchState.increaseTimeout?3:1),isReadyTimeout:this.getDescriptorConfig(desc,"isReadyTimeout"),sourceLineForAllAssertions:this.sourceLineForAllAssertions,sandboxCleanup:this.getDescriptorConfig(desc,"sandboxCleanup"),sharedSandboxState:sharedSandboxState,config:this.getDescriptorConfig(desc,"config"),failOnExclusiveSpecsWhenAutomated:this.getDescriptorConfig(desc,"failOnExclusiveSpecsWhenAutomated"),snoozeUntil:this.getDescriptorConfig(desc,"snooze"),suppressPassedWaitForAssertion:this.getDescriptorConfig(desc,"suppressPassedWaitForAssertion")}},getScriptDescriptor:function(id){return this.descriptorsById[id]},getDescById:function(id){return this.descriptorsById[id]},getTestByURL:function(url){return this.testsByURL[url]},saveTestWithURL:function(url,test){this.testsByURL[url]=test},deleteTestByURL:function(url){var test=this.testsByURL[url];if(test){try{test.finalize(!0)}catch(e){}this.cleanupScopeForURL(url)}delete this.testsByURL[url]},allPassed:function(){var allPassed=!0,me=this;return Joose.A.each(this.flattenDescriptors(this.descriptors),function(descriptor){if(descriptor.isMissing)return allPassed=!1;var test=me.getTestByURL(descriptor.url);return(!test||!!(allPassed=allPassed&&test.isPassed()))&&void 0}),allPassed},flattenArray:function(array,stripEmpty){var me=this,result=[];return Joose.A.each(array,function(el){"Array"==me.typeOf(el)?result.push.apply(result,me.flattenArray(el,stripEmpty)):stripEmpty&&!el||result.push(el)}),result},buildSandboxHashStructure:function(){return["preload","alsoPreload","hostPageUrl","pageUrl","useStrictMode","overrideSetTimeout"]},assignUniqueTag:function(value,configName){if(null==value)return"";if(value===Object(value))return value.__UNIQUE__?value.__UNIQUE__:value.__UNIQUE__=(this.uniqueCounter++).toString(36);value+="";var configIndex=this.valueToHashIndicies[configName];return(configIndex=configIndex||(this.valueToHashIndicies[configName]={}))[value]?configIndex[value]:configIndex[value]=(this.uniqueCounter++).toString(36)},calculateSharedContextGroupHash:function(desc){var me=this,structure=this.getSandboxHashStructure(),hash="";return Joose.A.each(structure,function(configName){hash+=me.assignUniqueTag(me.getDescriptorConfig(desc,configName),configName)}),this.sandboxBoundaryByGroup&&(hash+=this.assignUniqueTag(desc.parent)),hash},sortDescriptors:function(descriptors,forcedRunCore,idsOnly){var me=this,canRunParallel=[],mustRunSequential=[],sharedContextGroups=[],groupsByHash={};return Joose.A.each(descriptors,function(desc){if(me.getDescriptorConfig(desc,"sandbox")){"sequential"==(forcedRunCore||me.getDescriptorConfig(desc,"runCore"))||me.testMustRunSequential(desc)?mustRunSequential.push(idsOnly?desc.id:desc):canRunParallel.push(idsOnly?desc.id:desc)}else{var hash=me.calculateSharedContextGroupHash(desc),group=groupsByHash[hash];group||(group=groupsByHash[hash]={groupHash:hash,items:[]},sharedContextGroups.push(group)),group.items.push(idsOnly?desc.id:desc)}}),{sharedContextGroups:sharedContextGroups,mustRunSequential:mustRunSequential,canRunParallel:canRunParallel}},hasDescriptorWithNativeEventsSimulation:function(descriptors){return!1}},my:{has:{HOST:null,instance:null},methods:{staticDeprecationWarning:function(methodName){var message=Siesta.Resource("Siesta.Project","staticDeprecationWarning",{methodName:methodName,projectClass:this.HOST+""});"undefined"!=typeof console&&console.warn(message)},configure:function(config){return this.staticDeprecationWarning("configure"),(this.instance=new this.HOST).configure(config)},start:function(){return this.staticDeprecationWarning("start"),this.instance.start.apply(this.instance,arguments)},on:function(){return this.staticDeprecationWarning("on"),this.instance.on.apply(this.instance,arguments)}}}}),Siesta.Harness=Siesta.Project,Role("Siesta.Util.Role.CanStyleOutput",{has:{disableColoring:!1,style:{is:"rwc",lazy:"this.buildStyle"},styles:{init:{bold:[1,22],italic:[3,23],underline:[4,24],"black ":[30,39],yellow:[33,39],cyan:[36,39],white:[37,39],green:[32,39],red:[31,39],grey:[90,39],blue:[34,39],magenta:[35,39],"bgblack ":[40,49],bgyellow:[43,49],bgcyan:[46,49],bgwhite:[47,49],bggreen:[42,49],bgred:[41,49],bggrey:[100,49],bgblue:[44,49],bgmagenta:[45,49],inverse:[7,27]}}},methods:{buildStyle:function(){var me=this,style={};return Joose.O.each(this.styles,function(value,name){style[name]=function(text){return me.styled(text,name)}}),style},styled:function(text,style){if(this.disableColoring)return text;var styles=this.styles;return"["+styles[style][0]+"m"+text+"["+styles[style][1]+"m"}}}),Role("Siesta.Util.Role.CanParseBrowser",{methods:{parseBrowser:function(uaString){var match,browser="unknown",version="";return(match=/Firefox\/((?:\d+\.?)+)/.exec(uaString))&&(browser="Firefox",version=match[1]),(match=/Chrome\/((?:\d+\.?)+)/.exec(uaString))&&(browser="Chrome",version=match[1]),(match=/MSIE\s*((?:\d+\.?)+)/.exec(uaString))&&(browser="IE",version=match[1]),uaString.match(/trident/i)&&(match=/rv.(\d\d\.?\d?)/.exec(uaString))&&(browser="IE",version=match[1]),(match=/chrome.+? edge\/(\d+(\.\d+)?)/i.exec(uaString))&&(browser="Edge",version=match[1]),(match=/Apple.*Version\/((?:\d+\.?)+)\s*(?=Safari\/((?:\d+\.?)+))/.exec(uaString))&&(browser="Safari",version=match[1]+" ("+match[2]+")"),(match=/PhantomJS\/(\d+\.\d+\.\d+)/.exec(uaString))&&(browser="PhantomJS",version=match[1]),(match=/SlimerJS\/(\d+\.\d+\.\d+)/.exec(uaString))&&(browser="SlimerJS",version=match[1]),(match=/NodeJS\/(.+)/.exec(uaString))&&(browser="NodeJS",version=match[1]),{name:browser,version:version}}}}),"undefined"==typeof Promise&&function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.ES6Promise=factory()}(this,function(){"use strict";function isFunction(x){return"function"==typeof x}var isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)},len=0,vertxNext=void 0,customSchedulerFn=void 0,asap=function(callback,arg){queue[len]=callback,queue[len+1]=arg,2===(len+=2)&&(customSchedulerFn?customSchedulerFn(flush):scheduleFlush())};var browserWindow="undefined"!=typeof window?window:void 0,browserGlobal=browserWindow||{},BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,isNode="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1e3);function flush(){for(var i=0;i<len;i+=2){(0,queue[i])(queue[i+1]),queue[i]=void 0,queue[i+1]=void 0}len=0}var channel,iterations,observer,node,scheduleFlush=void 0;function then(onFulfillment,onRejection){var parent=this,child=new this.constructor(noop);void 0===child[PROMISE_ID]&&makePromise(child);var _state=parent._state;if(_state){var callback=arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})}else subscribe(parent,child,onFulfillment,onRejection);return child}function resolve$1(object){if(object&&"object"==typeof object&&object.constructor===this)return object;var promise=new this(noop);return resolve(promise,object),promise}scheduleFlush=isNode?function(){return process.nextTick(flush)}:BrowserMutationObserver?(iterations=0,observer=new BrowserMutationObserver(flush),node=document.createTextNode(""),observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}):isWorker?((channel=new MessageChannel).port1.onmessage=flush,function(){return channel.port2.postMessage(0)}):(void 0===browserWindow&&"function"==typeof require?function(){try{var vertx=Function("return this")().require("vertx");return void 0!==(vertxNext=vertx.runOnLoop||vertx.runOnContext)?function(){vertxNext(flush)}:useSetTimeout()}catch(e){return useSetTimeout()}}:useSetTimeout)();var PROMISE_ID=Math.random().toString(36).substring(2);function noop(){}var PENDING=void 0,FULFILLED=1,REJECTED=2,TRY_CATCH_ERROR={error:null};function getThen(promise){try{return promise.then}catch(error){return TRY_CATCH_ERROR.error=error,TRY_CATCH_ERROR}}function handleForeignThenable(promise,thenable,then$$1){asap(function(promise){var sealed=!1,error=function(then$$1,value,fulfillmentHandler,rejectionHandler){try{then$$1.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}(then$$1,thenable,function(value){sealed||(sealed=!0,(thenable!==value?resolve:fulfill)(promise,value))},function(reason){sealed||(sealed=!0,reject(promise,reason))},promise._label);!sealed&&error&&(sealed=!0,reject(promise,error))},promise)}function handleMaybeThenable(promise,maybeThenable,then$$1){maybeThenable.constructor===promise.constructor&&then$$1===then&&maybeThenable.constructor.resolve===resolve$1?function(promise,thenable){thenable._state===FULFILLED?fulfill(promise,thenable._result):thenable._state===REJECTED?reject(promise,thenable._result):subscribe(thenable,void 0,function(value){return resolve(promise,value)},function(reason){return reject(promise,reason)})}(promise,maybeThenable):then$$1===TRY_CATCH_ERROR?(reject(promise,TRY_CATCH_ERROR.error),TRY_CATCH_ERROR.error=null):void 0!==then$$1&&isFunction(then$$1)?handleForeignThenable(promise,maybeThenable,then$$1):fulfill(promise,maybeThenable)}function resolve(promise,value){var x,type;promise===value?reject(promise,new TypeError("You cannot resolve a promise with itself")):(type=typeof(x=value),null===x||"object"!=type&&"function"!=type?fulfill(promise,value):handleMaybeThenable(promise,value,getThen(value)))}function publishRejection(promise){promise._onerror&&promise._onerror(promise._result),publish(promise)}function fulfill(promise,value){promise._state===PENDING&&(promise._result=value,promise._state=FULFILLED,0!==promise._subscribers.length&&asap(publish,promise))}function reject(promise,reason){promise._state===PENDING&&(promise._state=REJECTED,promise._result=reason,asap(publishRejection,promise))}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers,length=_subscribers.length;parent._onerror=null,_subscribers[length]=child,_subscribers[length+FULFILLED]=onFulfillment,_subscribers[length+REJECTED]=onRejection,0===length&&parent._state&&asap(publish,parent)}function publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child=void 0,callback=void 0,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=void 0,error=void 0,succeeded=void 0,failed=void 0;if(hasCallback){if((value=function(callback,detail){try{return callback(detail)}catch(e){return TRY_CATCH_ERROR.error=e,TRY_CATCH_ERROR}}(callback,detail))===TRY_CATCH_ERROR?(failed=!0,error=value.error,value.error=null):succeeded=!0,promise===value)return void reject(promise,new TypeError("A promises callback cannot return that same promise."))}else value=detail,succeeded=!0;promise._state!==PENDING||(hasCallback&&succeeded?resolve(promise,value):failed?reject(promise,error):settled===FULFILLED?fulfill(promise,value):settled===REJECTED&&reject(promise,value))}var id=0;function makePromise(promise){promise[PROMISE_ID]=id++,promise._state=void 0,promise._result=void 0,promise._subscribers=[]}var Enumerator=function(){function Enumerator(Constructor,input){this._instanceConstructor=Constructor,this.promise=new Constructor(noop),this.promise[PROMISE_ID]||makePromise(this.promise),isArray(input)?(this.length=input.length,this._remaining=input.length,this._result=new Array(this.length),0===this.length?fulfill(this.promise,this._result):(this.length=this.length||0,this._enumerate(input),0===this._remaining&&fulfill(this.promise,this._result))):reject(this.promise,new Error("Array Methods must be provided an Array"))}return Enumerator.prototype._enumerate=function(input){for(var i=0;this._state===PENDING&&i<input.length;i++)this._eachEntry(input[i],i)},Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor,resolve$$1=c.resolve;if(resolve$$1===resolve$1){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING)this._settledAt(entry._state,i,entry._result);else if("function"!=typeof _then)this._remaining--,this._result[i]=entry;else if(c===Promise$2){var promise=new c(noop);handleMaybeThenable(promise,entry,_then),this._willSettleAt(promise,i)}else this._willSettleAt(new c(function(resolve$$1){return resolve$$1(entry)}),i)}else this._willSettleAt(resolve$$1(entry),i)},Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;promise._state===PENDING&&(this._remaining--,state===REJECTED?reject(promise,value):this._result[i]=value),0===this._remaining&&fulfill(promise,this._result)},Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,void 0,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})},Enumerator}();var Promise$2=(Promise.prototype.catch=function(onRejection){return this.then(null,onRejection)},Promise.prototype.finally=function(callback){var constructor=this.constructor;return this.then(function(value){return constructor.resolve(callback()).then(function(){return value})},function(reason){return constructor.resolve(callback()).then(function(){throw reason})})},Promise);function Promise(resolver){this[PROMISE_ID]=id++,this._result=this._state=void 0,this._subscribers=[],noop!==resolver&&("function"!=typeof resolver&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof Promise?function(promise,resolver){try{resolver(function(value){resolve(promise,value)},function(reason){reject(promise,reason)})}catch(e){reject(promise,e)}}(this,resolver):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return Promise$2.prototype.then=then,Promise$2.all=function(entries){return new Enumerator(this,entries).promise},Promise$2.race=function(entries){var Constructor=this;return isArray(entries)?new Constructor(function(resolve,reject){for(var length=entries.length,i=0;i<length;i++)Constructor.resolve(entries[i]).then(resolve,reject)}):new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))})},Promise$2.resolve=resolve$1,Promise$2.reject=function(reason){var promise=new this(noop);return reject(promise,reason),promise},Promise$2._setScheduler=function(scheduleFn){customSchedulerFn=scheduleFn},Promise$2._setAsap=function(asapFn){asap=asapFn},Promise$2._asap=asap,Promise$2.polyfill=function(){var local=void 0;if("undefined"!=typeof global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if("[object Promise]"===promiseToString&&!P.cast)return}local.Promise=Promise$2},(Promise$2.Promise=Promise$2).polyfill(),Promise$2}),function(root){var t,bowser;function detect(ua){function getFirstMatch(regex){var match=ua.match(regex);return match&&1<match.length&&match[1]||""}var result,regex,match,iosdevice=getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase(),android=!/like android/i.test(ua)&&/android/i.test(ua),nexusMobile=/nexus\s*[0-6]\s*/i.test(ua),nexusTablet=!nexusMobile&&/nexus\s*[0-9]+/i.test(ua),chromeos=/CrOS/.test(ua),silk=/silk/i.test(ua),sailfish=/sailfish/i.test(ua),tizen=/tizen/i.test(ua),webos=/(web|hpw)os/i.test(ua),windowsphone=/windows phone/i.test(ua),windows=(/SamsungBrowser/i.test(ua),!windowsphone&&/windows/i.test(ua)),mac=!iosdevice&&!silk&&/macintosh/i.test(ua),linux=!android&&!sailfish&&!tizen&&!webos&&/linux/i.test(ua),edgeVersion=getFirstMatch(/edge\/(\d+(\.\d+)?)/i),versionIdentifier=getFirstMatch(/version\/(\d+(\.\d+)?)/i),tablet=/tablet/i.test(ua),mobile=!tablet&&/[^-]mobi/i.test(ua),xbox=/xbox/i.test(ua);/opera/i.test(ua)?result={name:"Opera",opera:t,version:versionIdentifier||getFirstMatch(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(ua)?result={name:"Opera",opera:t,version:getFirstMatch(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||versionIdentifier}:/SamsungBrowser/i.test(ua)?result={name:"Samsung Internet for Android",samsungBrowser:t,version:versionIdentifier||getFirstMatch(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(ua)?result={name:"Opera Coast",coast:t,version:versionIdentifier||getFirstMatch(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(ua)?result={name:"Yandex Browser",yandexbrowser:t,version:versionIdentifier||getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(ua)?result={name:"UC Browser",ucbrowser:t,version:getFirstMatch(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(ua)?result={name:"Maxthon",maxthon:t,version:getFirstMatch(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(ua)?result={name:"Epiphany",epiphany:t,version:getFirstMatch(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(ua)?result={name:"Puffin",puffin:t,version:getFirstMatch(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(ua)?result={name:"Sleipnir",sleipnir:t,version:getFirstMatch(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(ua)?result={name:"K-Meleon",kMeleon:t,version:getFirstMatch(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:windowsphone?(result={name:"Windows Phone",windowsphone:t},edgeVersion?(result.msedge=t,result.version=edgeVersion):(result.msie=t,result.version=getFirstMatch(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(ua)?result={name:"Internet Explorer",msie:t,version:getFirstMatch(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:chromeos?result={name:"Chrome",chromeos:t,chromeBook:t,chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(ua)?result={name:"Microsoft Edge",msedge:t,version:edgeVersion}:/vivaldi/i.test(ua)?result={name:"Vivaldi",vivaldi:t,version:getFirstMatch(/vivaldi\/(\d+(\.\d+)?)/i)||versionIdentifier}:sailfish?result={name:"Sailfish",sailfish:t,version:getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(ua)?result={name:"SeaMonkey",seamonkey:t,version:getFirstMatch(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(ua)?(result={name:"Firefox",firefox:t,version:getFirstMatch(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(ua)&&(result.firefoxos=t)):silk?result={name:"Amazon Silk",silk:t,version:getFirstMatch(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(ua)?result={name:"PhantomJS",phantom:t,version:getFirstMatch(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(ua)?result={name:"SlimerJS",slimer:t,version:getFirstMatch(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(ua)||/rim\stablet/i.test(ua)?result={name:"BlackBerry",blackberry:t,version:versionIdentifier||getFirstMatch(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:webos?(result={name:"WebOS",webos:t,version:versionIdentifier||getFirstMatch(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(ua)&&(result.touchpad=t)):/bada/i.test(ua)?result={name:"Bada",bada:t,version:getFirstMatch(/dolfin\/(\d+(\.\d+)?)/i)}:tizen?result={name:"Tizen",tizen:t,version:getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||versionIdentifier}:/qupzilla/i.test(ua)?result={name:"QupZilla",qupzilla:t,version:getFirstMatch(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||versionIdentifier}:/chromium/i.test(ua)?result={name:"Chromium",chromium:t,version:getFirstMatch(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||versionIdentifier}:/chrome|crios|crmo/i.test(ua)?result={name:"Chrome",chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:android?result={name:"Android",version:versionIdentifier}:/safari|applewebkit/i.test(ua)?(result={name:"Safari",safari:t},versionIdentifier&&(result.version=versionIdentifier)):iosdevice?(result={name:"iphone"==iosdevice?"iPhone":"ipad"==iosdevice?"iPad":"iPod"},versionIdentifier&&(result.version=versionIdentifier)):result=/googlebot/i.test(ua)?{name:"Googlebot",googlebot:t,version:getFirstMatch(/googlebot\/(\d+(\.\d+))/i)||versionIdentifier}:{name:getFirstMatch(/^(.*)\/(.*) /),version:(regex=/^(.*)\/(.*) /,(match=ua.match(regex))&&1<match.length&&match[2]||"")},!result.msedge&&/(apple)?webkit/i.test(ua)?(/(apple)?webkit\/537\.36/i.test(ua)?(result.name=result.name||"Blink",result.blink=t):(result.name=result.name||"Webkit",result.webkit=t),!result.version&&versionIdentifier&&(result.version=versionIdentifier)):!result.opera&&/gecko\//i.test(ua)&&(result.name=result.name||"Gecko",result.gecko=t,result.version=result.version||getFirstMatch(/gecko\/(\d+(\.\d+)?)/i)),result.windowsphone||result.msedge||!android&&!result.silk?result.windowsphone||result.msedge||!iosdevice?mac?result.mac=t:xbox?result.xbox=t:windows?result.windows=t:linux&&(result.linux=t):(result[iosdevice]=t,result.ios=t):result.android=t;var osVersion="";result.windowsphone?osVersion=getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):iosdevice?osVersion=(osVersion=getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):android?osVersion=getFirstMatch(/android[ \/-](\d+(\.\d+)*)/i):result.webos?osVersion=getFirstMatch(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):result.blackberry?osVersion=getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i):result.bada?osVersion=getFirstMatch(/bada\/(\d+(\.\d+)*)/i):result.tizen&&(osVersion=getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i)),osVersion&&(result.osversion=osVersion);var osMajorVersion=osVersion.split(".")[0];return tablet||nexusTablet||"ipad"==iosdevice||android&&(3==osMajorVersion||4<=osMajorVersion&&!mobile)||result.silk?result.tablet=t:(mobile||"iphone"==iosdevice||"ipod"==iosdevice||android||nexusMobile||result.blackberry||result.webos||result.bada)&&(result.mobile=t),result.msedge||result.msie&&10<=result.version||result.yandexbrowser&&15<=result.version||result.vivaldi&&1<=result.version||result.chrome&&20<=result.version||result.samsungBrowser&&4<=result.version||result.firefox&&20<=result.version||result.safari&&6<=result.version||result.opera&&10<=result.version||result.ios&&result.osversion&&6<=result.osversion.split(".")[0]||result.blackberry&&10.1<=result.version||result.chromium&&20<=result.version?result.a=t:result.msie&&result.version<10||result.chrome&&result.version<20||result.firefox&&result.version<20||result.safari&&result.version<6||result.opera&&result.version<10||result.ios&&result.osversion&&result.osversion.split(".")[0]<6||result.chromium&&result.version<20?result.c=t:result.x=t,result}function getVersionPrecision(version){return version.split(".").length}function map(arr,iterator){var i,result=[];if(Array.prototype.map)return Array.prototype.map.call(arr,iterator);for(i=0;i<arr.length;i++)result.push(iterator(arr[i]));return result}function compareVersions(versions){for(var precision=Math.max(getVersionPrecision(versions[0]),getVersionPrecision(versions[1])),chunks=map(versions,function(version){var delta=precision-getVersionPrecision(version);return map((version+=new Array(1+delta).join(".0")).split("."),function(chunk){return new Array(20-chunk.length).join("0")+chunk}).reverse()});0<=--precision;){if(chunks[0][precision]>chunks[1][precision])return 1;if(chunks[0][precision]!==chunks[1][precision])return-1;if(0===precision)return 0}}function isUnsupportedBrowser(minVersions,strictMode,ua){var _bowser=bowser;"string"==typeof strictMode&&(ua=strictMode,strictMode=void 0),void 0===strictMode&&(strictMode=!1),ua&&(_bowser=detect(ua));var version=""+_bowser.version;for(var browser in minVersions)if(minVersions.hasOwnProperty(browser)&&_bowser[browser]){if("string"!=typeof minVersions[browser])throw new Error("Browser version in the minVersion map should be a string: "+browser+": "+String(minVersions));return compareVersions([version,minVersions[browser]])<0}return strictMode}("undefined"!=typeof window?window:root).bowser=(t=!0,(bowser=detect("undefined"!=typeof navigator&&navigator.userAgent||"")).test=function(browserList){for(var i=0;i<browserList.length;++i){var browserItem=browserList[i];if("string"==typeof browserItem&&browserItem in bowser)return!0}return!1},bowser.isUnsupportedBrowser=isUnsupportedBrowser,bowser.compareVersions=compareVersions,bowser.check=function(minVersions,strictMode,ua){return!isUnsupportedBrowser(minVersions,strictMode,ua)},bowser._detect=detect,bowser)}(this),function(window,undefined){var document=window.document,navigator=window.navigator,location=window.location,jQuery=function(){function fcamelCase(all,letter){return letter.toUpperCase()}var rootjQuery,browserMatch,readyList,DOMContentLoaded,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},_jQuery=window.jQuery,_$=window.$,quickExpr=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rnotwhite=/\S/,trimLeft=/^\s+/,trimRight=/\s+$/,rdigit=/\d/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rwebkit=/(webkit)[ \/]([\w.]+)/,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rmsie=/(msie) ([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/,rdashAlpha=/-([a-z])/gi,userAgent=navigator.userAgent,toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty,push=Array.prototype.push,slice=Array.prototype.slice,trim=String.prototype.trim,indexOf=Array.prototype.indexOf,class2type={};function doScrollCheck(){if(!jQuery.isReady){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(doScrollCheck,1)}jQuery.ready()}}return jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector)return this;if(selector.nodeType)return this.context=this[0]=selector,this.length=1,this;if("body"===selector&&!context&&document.body)return this.context=document,this[0]=document.body,this.selector=selector,this.length=1,this;if("string"!=typeof selector)return jQuery.isFunction(selector)?rootjQuery.ready(selector):(selector.selector!==undefined&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this));if(!(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&3<=selector.length?[null,selector,null]:quickExpr.exec(selector))||!match[1]&&context)return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector);if(match[1])return doc=(context=context instanceof jQuery?context[0]:context)?context.ownerDocument||context:document,(ret=rsingleTag.exec(selector))?jQuery.isPlainObject(context)?(selector=[document.createElement(ret[1])],jQuery.fn.attr.call(selector,context,!0)):selector=[doc.createElement(ret[1])]:selector=((ret=jQuery.buildFragment([match[1]],[doc])).cacheable?jQuery.clone(ret.fragment):ret.fragment).childNodes,jQuery.merge(this,selector);if((elem=document.getElementById(match[2]))&&elem.parentNode){if(elem.id!==match[2])return rootjQuery.find(selector);this.length=1,this[0]=elem}return this.context=document,this.selector=selector,this},selector:"",jquery:"1.6.2",length:0,size:function(){return this.length},toArray:function(){return slice.call(this,0)},get:function(num){return null==num?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems,name,selector){var ret=this.constructor();return jQuery.isArray(elems)?push.apply(ret,elems):jQuery.merge(ret,elems),ret.prevObject=this,ret.context=this.context,"find"===name?ret.selector=this.selector+(this.selector?" ":"")+selector:name&&(ret.selector=this.selector+"."+name+"("+selector+")"),ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){return jQuery.bindReady(),readyList.done(fn),this},eq:function(i){return-1===i?this.slice(i):this.slice(i,+i+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(slice.apply(this,arguments),"slice",slice.call(arguments).join(","))},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||jQuery.isFunction(target)||(target={}),length===i&&(target=this,--i);i<length;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],target!==(copy=options[name])&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(clone=copyIsArray?(copyIsArray=!1,src&&jQuery.isArray(src)?src:[]):src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy));return target},jQuery.extend({noConflict:function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){if(!0===wait&&!--jQuery.readyWait||!0!==wait&&!jQuery.isReady){if(!document.body)return setTimeout(jQuery.ready,1);if((jQuery.isReady=!0)!==wait&&0<--jQuery.readyWait)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").unbind("ready")}},bindReady:function(){if(!readyList){if(readyList=jQuery._Deferred(),"complete"===document.readyState)return setTimeout(jQuery.ready,1);if(document.addEventListener)document.addEventListener("DOMContentLoaded",DOMContentLoaded,!1),window.addEventListener("load",jQuery.ready,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded),window.attachEvent("onload",jQuery.ready);var toplevel=!1;try{toplevel=null==window.frameElement}catch(e){}document.documentElement.doScroll&&toplevel&&doScrollCheck()}}},isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray||function(obj){return"array"===jQuery.type(obj)},isWindow:function(obj){return obj&&"object"==typeof obj&&"setInterval"in obj},isNaN:function(obj){return null==obj||!rdigit.test(obj)||isNaN(obj)},type:function(obj){return null==obj?String(obj):class2type[toString.call(obj)]||"object"},isPlainObject:function(obj){if(!obj||"object"!==jQuery.type(obj)||obj.nodeType||jQuery.isWindow(obj))return!1;if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1;var key;for(key in obj);return key===undefined||hasOwn.call(obj,key)},isEmptyObject:function(obj){for(var name in obj)return!1;return!0},error:function(msg){throw msg},parseJSON:function(data){return"string"==typeof data&&data?(data=jQuery.trim(data),window.JSON&&window.JSON.parse?window.JSON.parse(data):rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))?new Function("return "+data)():void jQuery.error("Invalid JSON: "+data)):null},parseXML:function(data,xml,tmp){return window.DOMParser?xml=(tmp=new DOMParser).parseFromString(data,"text/xml"):((xml=new ActiveXObject("Microsoft.XMLDOM")).async="false",xml.loadXML(data)),(tmp=xml.documentElement)&&tmp.nodeName&&"parsererror"!==tmp.nodeName||jQuery.error("Invalid XML: "+data),xml},noop:function(){},globalEval:function(data){data&&rnotwhite.test(data)&&(window.execScript||function(data){window.eval.call(window,data)})(data)},camelCase:function(string){return string.replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()===name.toUpperCase()},each:function(object,callback,args){var name,i=0,length=object.length,isObj=length===undefined||jQuery.isFunction(object);if(args)if(isObj){for(name in object)if(!1===callback.apply(object[name],args))break}else for(;i<length&&!1!==callback.apply(object[i++],args););else if(isObj){for(name in object)if(!1===callback.call(object[name],name,object[name]))break}else for(;i<length&&!1!==callback.call(object[i],i,object[i++]););return object},trim:trim?function(text){return null==text?"":trim.call(text)}:function(text){return null==text?"":text.toString().replace(trimLeft,"").replace(trimRight,"")},makeArray:function(array,results){var ret=results||[];if(null!=array){var type=jQuery.type(array);null==array.length||"string"===type||"function"===type||"regexp"===type||jQuery.isWindow(array)?push.call(ret,array):jQuery.merge(ret,array)}return ret},inArray:function(elem,array){if(indexOf)return indexOf.call(array,elem);for(var i=0,length=array.length;i<length;i++)if(array[i]===elem)return i;return-1},merge:function(first,second){var i=first.length,j=0;if("number"==typeof second.length)for(var l=second.length;j<l;j++)first[i++]=second[j];else for(;second[j]!==undefined;)first[i++]=second[j++];return first.length=i,first},grep:function(elems,callback,inv){var ret=[];inv=!!inv;for(var i=0,length=elems.length;i<length;i++)inv!==!!callback(elems[i],i)&&ret.push(elems[i]);return ret},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length;if(elems instanceof jQuery||length!==undefined&&"number"==typeof length&&(0<length&&elems[0]&&elems[length-1]||0===length||jQuery.isArray(elems)))for(;i<length;i++)null!=(value=callback(elems[i],i,arg))&&(ret[ret.length]=value);else for(key in elems)null!=(value=callback(elems[key],key,arg))&&(ret[ret.length]=value);return ret.concat.apply([],ret)},guid:1,proxy:function(fn,context){if("string"==typeof context){var tmp=fn[context];context=fn,fn=tmp}if(!jQuery.isFunction(fn))return undefined;function proxy(){return fn.apply(context,args.concat(slice.call(arguments)))}var args=slice.call(arguments,2);return proxy.guid=fn.guid=fn.guid||proxy.guid||jQuery.guid++,proxy},access:function(elems,key,value,exec,fn,pass){var length=elems.length;if("object"==typeof key){for(var k in key)jQuery.access(elems,k,key[k],exec,fn,value);return elems}if(value===undefined)return length?fn(elems[0],key):undefined;exec=!pass&&exec&&jQuery.isFunction(value);for(var i=0;i<length;i++)fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass);return elems},now:function(){return(new Date).getTime()},uaMatch:function(ua){if((ua=ua.toLowerCase()).match(/trident/i)&&ua.match(/rv.\d\d/))return{browser:"msie",version:"11.0"};var match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}},sub:function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context)}jQuery.extend(!0,jQuerySub,this),jQuerySub.superclass=this,((jQuerySub.fn=jQuerySub.prototype=this()).constructor=jQuerySub).sub=this.sub,jQuerySub.fn.init=function(selector,context){return context&&context instanceof jQuery&&!(context instanceof jQuerySub)&&(context=jQuerySub(context)),jQuery.fn.init.call(this,selector,context,rootjQuerySub)},jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub},browser:{}}),jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()}),(browserMatch=jQuery.uaMatch(userAgent)).browser&&(jQuery.browser[browserMatch.browser]=!0,jQuery.browser.version=browserMatch.version),jQuery.browser.webkit&&(jQuery.browser.safari=/safari/i.test(userAgent)&&!/chrome/i.test(userAgent)),rnotwhite.test(" ")&&(trimLeft=/^[\s\xA0]+/,trimRight=/[\s\xA0]+$/),rootjQuery=jQuery(document),document.addEventListener?DOMContentLoaded=function(){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,!1),jQuery.ready()}:document.attachEvent&&(DOMContentLoaded=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",DOMContentLoaded),jQuery.ready())}),jQuery}(),promiseMethods="done fail isResolved isRejected promise then always pipe".split(" "),sliceDeferred=[].slice;jQuery.extend({_Deferred:function(){var fired,firing,cancelled,callbacks=[],deferred={done:function(){if(!cancelled){var i,length,elem,type,_fired,args=arguments;for(fired&&(_fired=fired,fired=0),i=0,length=args.length;i<length;i++)elem=args[i],"array"===(type=jQuery.type(elem))?deferred.done.apply(deferred,elem):"function"===type&&callbacks.push(elem);_fired&&deferred.resolveWith(_fired[0],_fired[1])}return this},resolveWith:function(context,args){if(!cancelled&&!fired&&!firing){args=args||[],firing=1;try{for(;callbacks[0];)callbacks.shift().apply(context,args)}finally{fired=[context,args],firing=0}}return this},resolve:function(){return deferred.resolveWith(this,arguments),this},isResolved:function(){return!(!firing&&!fired)},cancel:function(){return cancelled=1,callbacks=[],this}};return deferred},Deferred:function(func){var promise,deferred=jQuery._Deferred(),failDeferred=jQuery._Deferred();return jQuery.extend(deferred,{then:function(doneCallbacks,failCallbacks){return deferred.done(doneCallbacks).fail(failCallbacks),this},always:function(){return deferred.done.apply(deferred,arguments).fail.apply(this,arguments)},fail:failDeferred.done,rejectWith:failDeferred.resolveWith,reject:failDeferred.resolve,isRejected:failDeferred.isResolved,pipe:function(fnDone,fnFail){return jQuery.Deferred(function(newDefer){jQuery.each({done:[fnDone,"resolve"],fail:[fnFail,"reject"]},function(handler,data){var returned,fn=data[0],action=data[1];jQuery.isFunction(fn)?deferred[handler](function(){(returned=fn.apply(this,arguments))&&jQuery.isFunction(returned.promise)?returned.promise().then(newDefer.resolve,newDefer.reject):newDefer[action](returned)}):deferred[handler](newDefer[action])})}).promise()},promise:function(obj){if(null==obj){if(promise)return promise;promise=obj={}}for(var i=promiseMethods.length;i--;)obj[promiseMethods[i]]=deferred[promiseMethods[i]];return obj}}),deferred.done(failDeferred.cancel).fail(deferred.cancel),delete deferred.cancel,func&&func.call(deferred,deferred),deferred},when:function(firstParam){var args=arguments,i=0,length=args.length,count=length,deferred=length<=1&&firstParam&&jQuery.isFunction(firstParam.promise)?firstParam:jQuery.Deferred();function resolveFunc(i){return function(value){args[i]=1<arguments.length?sliceDeferred.call(arguments,0):value,--count||deferred.resolveWith(deferred,sliceDeferred.call(args,0))}}if(1<length){for(;i<length;i++)args[i]&&jQuery.isFunction(args[i].promise)?args[i].promise().then(resolveFunc(i),deferred.reject):--count;count||deferred.resolveWith(deferred,args)}else deferred!==firstParam&&deferred.resolveWith(deferred,length?[firstParam]:[]);return deferred.promise()}}),jQuery.support=function(){var all,a,select,opt,input,marginDiv,support,fragment,body,testElementParent,testElement,testElementStyle,tds,eventName,i,isSupported,div=document.createElement("div"),documentElement=document.documentElement;if(div.setAttribute("className","t"),div.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",all=div.getElementsByTagName("*"),a=div.getElementsByTagName("a")[0],!all||!all.length||!a)return{};opt=(select=document.createElement("select")).appendChild(document.createElement("option")),input=div.getElementsByTagName("input")[0],support={leadingWhitespace:3===div.firstChild.nodeType,tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:"/a"===a.getAttribute("href"),opacity:/^0.55$/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:"on"===input.value,optSelected:opt.selected,getSetAttribute:"t"!==div.className,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},input.checked=!0,support.noCloneChecked=input.cloneNode(!0).checked,select.disabled=!0,support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=!1}for(i in!div.addEventListener&&div.attachEvent&&div.fireEvent&&(div.attachEvent("onclick",function(){support.noCloneEvent=!1}),div.cloneNode(!0).fireEvent("onclick")),(input=document.createElement("input")).value="t",input.setAttribute("type","radio"),support.radioValue="t"===input.value,input.setAttribute("checked","checked"),div.appendChild(input),(fragment=document.createDocumentFragment()).appendChild(div.firstChild),support.checkClone=fragment.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML="",div.style.width=div.style.paddingLeft="1px",body=document.getElementsByTagName("body")[0],testElement=document.createElement(body?"div":"body"),testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0},body&&jQuery.extend(testElementStyle,{position:"absolute",left:-1e3,top:-1e3}),testElementStyle)testElement.style[i]=testElementStyle[i];if(testElement.appendChild(div),(testElementParent=body||documentElement).insertBefore(testElement,testElementParent.firstChild),support.appendChecked=input.checked,support.boxModel=2===div.offsetWidth,"zoom"in div.style&&(div.style.display="inline",div.style.zoom=1,support.inlineBlockNeedsLayout=2===div.offsetWidth,div.style.display="",div.innerHTML="<div style='width:4px;'></div>",support.shrinkWrapBlocks=2!==div.offsetWidth),div.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",isSupported=0===(tds=div.getElementsByTagName("td"))[0].offsetHeight,tds[0].style.display="",tds[1].style.display="none",support.reliableHiddenOffsets=isSupported&&0===tds[0].offsetHeight,div.innerHTML="",document.defaultView&&document.defaultView.getComputedStyle&&((marginDiv=document.createElement("div")).style.width="0",marginDiv.style.marginRight="0",div.appendChild(marginDiv),support.reliableMarginRight=0===(parseInt((document.defaultView.getComputedStyle(marginDiv,null)||{marginRight:0}).marginRight,10)||0)),testElement.innerHTML="",testElementParent.removeChild(testElement),div.attachEvent)for(i in{submit:1,change:1,focusin:1})(isSupported=(eventName="on"+i)in div)||(div.setAttribute(eventName,"return;"),isSupported="function"==typeof div[eventName]),support[i+"Bubbles"]=isSupported;return testElement=fragment=select=opt=body=marginDiv=div=input=null,support}(),jQuery.boxModel=jQuery.support.boxModel;var rbrace=/^(?:\{.*\}|\[.*\])$/,rmultiDash=/([a-z])([A-Z])/g;function dataAttr(elem,key,data){if(data===undefined&&1===elem.nodeType){var name="data-"+key.replace(rmultiDash,"$1-$2").toLowerCase();if("string"==typeof(data=elem.getAttribute(name))){try{data="true"===data||"false"!==data&&("null"===data?null:jQuery.isNaN(data)?rbrace.test(data)?jQuery.parseJSON(data):data:parseFloat(data))}catch(e){}jQuery.data(elem,key,data)}else data=undefined}return data}function isEmptyDataObject(obj){for(var name in obj)if("toJSON"!==name)return;return 1}function handleQueueMarkDefer(elem,type,src){var deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",defer=jQuery.data(elem,deferDataKey,undefined,!0);!defer||"queue"!==src&&jQuery.data(elem,queueDataKey,undefined,!0)||"mark"!==src&&jQuery.data(elem,markDataKey,undefined,!0)||setTimeout(function(){jQuery.data(elem,queueDataKey,undefined,!0)||jQuery.data(elem,markDataKey,undefined,!0)||(jQuery.removeData(elem,deferDataKey,!0),defer.resolve())},0)}jQuery.extend({cache:{},uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(elem){return!!(elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando])&&!isEmptyDataObject(elem)},data:function(elem,name,data,pvt){if(jQuery.acceptData(elem)){var thisCache,internalKey=jQuery.expando,getByName="string"==typeof name,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:elem[jQuery.expando]&&jQuery.expando;if(id&&(!pvt||!id||cache[id][internalKey])||!getByName||data!==undefined)return id||(isNode?elem[jQuery.expando]=id=++jQuery.uuid:id=jQuery.expando),cache[id]||(cache[id]={},isNode||(cache[id].toJSON=jQuery.noop)),"object"!=typeof name&&"function"!=typeof name||(pvt?cache[id][internalKey]=jQuery.extend(cache[id][internalKey],name):cache[id]=jQuery.extend(cache[id],name)),thisCache=cache[id],pvt&&(thisCache[internalKey]||(thisCache[internalKey]={}),thisCache=thisCache[internalKey]),data!==undefined&&(thisCache[jQuery.camelCase(name)]=data),"events"!==name||thisCache[name]?getByName?thisCache[jQuery.camelCase(name)]||thisCache[name]:thisCache:thisCache[internalKey]&&thisCache[internalKey].events}},removeData:function(elem,name,pvt){if(jQuery.acceptData(elem)){var internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(cache[id]){if(name){var thisCache=pvt?cache[id][internalKey]:cache[id];if(thisCache&&(delete thisCache[name],!isEmptyDataObject(thisCache)))return}if(!pvt||(delete cache[id][internalKey],isEmptyDataObject(cache[id]))){var internalCache=cache[id][internalKey];jQuery.support.deleteExpando||cache!=window?delete cache[id]:cache[id]=null,internalCache?(cache[id]={},isNode||(cache[id].toJSON=jQuery.noop),cache[id][internalKey]=internalCache):isNode&&(jQuery.support.deleteExpando?delete elem[jQuery.expando]:elem.removeAttribute?elem.removeAttribute(jQuery.expando):elem[jQuery.expando]=null)}}}},_data:function(elem,name,data){return jQuery.data(elem,name,data,!0)},acceptData:function(elem){if(elem.nodeName){var match=jQuery.noData[elem.nodeName.toLowerCase()];if(match)return!(!0===match||elem.getAttribute("classid")!==match)}return!0}}),jQuery.fn.extend({data:function(key,value){var data=null;if(void 0===key){if(this.length&&(data=jQuery.data(this[0]),1===this[0].nodeType))for(var name,attr=this[0].attributes,i=0,l=attr.length;i<l;i++)0===(name=attr[i].name).indexOf("data-")&&(name=jQuery.camelCase(name.substring(5)),dataAttr(this[0],name,data[name]));return data}if("object"==typeof key)return this.each(function(){jQuery.data(this,key)});var parts=key.split(".");return parts[1]=parts[1]?"."+parts[1]:"",value===undefined?((data=this.triggerHandler("getData"+parts[1]+"!",[parts[0]]))===undefined&&this.length&&(data=jQuery.data(this[0],key),data=dataAttr(this[0],key,data)),data===undefined&&parts[1]?this.data(parts[0]):data):this.each(function(){var $this=jQuery(this),args=[parts[0],value];$this.triggerHandler("setData"+parts[1]+"!",args),jQuery.data(this,key,value),$this.triggerHandler("changeData"+parts[1]+"!",args)})},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}}),jQuery.extend({_mark:function(elem,type){elem&&(type=(type||"fx")+"mark",jQuery.data(elem,type,(jQuery.data(elem,type,undefined,!0)||0)+1,!0))},_unmark:function(force,elem,type){if(!0!==force&&(type=elem,elem=force,force=!1),elem){var key=(type=type||"fx")+"mark",count=force?0:(jQuery.data(elem,key,undefined,!0)||1)-1;count?jQuery.data(elem,key,count,!0):(jQuery.removeData(elem,key,!0),handleQueueMarkDefer(elem,type,"mark"))}},queue:function(elem,type,data){if(elem){type=(type||"fx")+"queue";var q=jQuery.data(elem,type,undefined,!0);return data&&(!q||jQuery.isArray(data)?q=jQuery.data(elem,type,jQuery.makeArray(data),!0):q.push(data)),q||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),fn=queue.shift();"inprogress"===fn&&(fn=queue.shift()),fn&&("fx"===type&&queue.unshift("inprogress"),fn.call(elem,function(){jQuery.dequeue(elem,type)})),queue.length||(jQuery.removeData(elem,type+"queue",!0),handleQueueMarkDefer(elem,type,"queue"))}}),jQuery.fn.extend({queue:function(type,data){return"string"!=typeof type&&(data=type,type="fx"),data===undefined?jQuery.queue(this[0],type):this.each(function(){var queue=jQuery.queue(this,type,data);"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){return time=jQuery.fx&&jQuery.fx.speeds[time]||time,type=type||"fx",this.queue(type,function(){var elem=this;setTimeout(function(){jQuery.dequeue(elem,type)},time)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,object){"string"!=typeof type&&(type=undefined),type=type||"fx";var tmp,defer=jQuery.Deferred(),elements=this,i=elements.length,count=1,deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark";function resolve(){--count||defer.resolveWith(elements,[elements])}for(;i--;)(tmp=jQuery.data(elements[i],deferDataKey,undefined,!0)||(jQuery.data(elements[i],queueDataKey,undefined,!0)||jQuery.data(elements[i],markDataKey,undefined,!0))&&jQuery.data(elements[i],deferDataKey,jQuery._Deferred(),!0))&&(count++,tmp.done(resolve));return resolve(),defer.promise()}});var formHook,boolHook,rclass=/[\n\t\r]/g,rspace=/\s+/,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea)?$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,rinvalidChar=/\:|^on/;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,name,value,!0,jQuery.attr)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,name,value,!0,jQuery.prop)},removeProp:function(name){return name=jQuery.propFix[name]||name,this.each(function(){try{this[name]=undefined,delete this[name]}catch(e){}})},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(value&&"string"==typeof value)for(classNames=value.split(rspace),i=0,l=this.length;i<l;i++)if(1===(elem=this[i]).nodeType)if(elem.className||1!==classNames.length){for(setClass=" "+elem.className+" ",c=0,cl=classNames.length;c<cl;c++)~setClass.indexOf(" "+classNames[c]+" ")||(setClass+=classNames[c]+" ");elem.className=jQuery.trim(setClass)}else elem.className=value;return this},removeClass:function(value){var classNames,i,l,elem,className,c,cl;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});if(value&&"string"==typeof value||value===undefined)for(classNames=(value||"").split(rspace),i=0,l=this.length;i<l;i++)if(1===(elem=this[i]).nodeType&&elem.className)if(value){for(className=(" "+elem.className+" ").replace(rclass," "),c=0,cl=classNames.length;c<cl;c++)className=className.replace(" "+classNames[c]+" "," ");elem.className=jQuery.trim(className)}else elem.className="";return this},toggleClass:function(value,stateVal){var type=typeof value,isBool="boolean"==typeof stateVal;return jQuery.isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}):this.each(function(){if("string"==type)for(var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(rspace);className=classNames[i++];)state=isBool?state:!self.hasClass(className),self[state?"addClass":"removeClass"](className);else"undefined"!=type&&"boolean"!=type||(this.className&&jQuery._data(this,"__className__",this.className),this.className=!this.className&&!1!==value&&jQuery._data(this,"__className__")||"")})},hasClass:function(selector){for(var className=" "+selector+" ",i=0,l=this.length;i<l;i++)if(-1<(" "+this[i].className+" ").replace(rclass," ").indexOf(className))return!0;return!1},val:function(value){var hooks,ret,elem=this[0];if(!arguments.length)return elem?(hooks=jQuery.valHooks[elem.nodeName.toLowerCase()]||jQuery.valHooks[elem.type])&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined?ret:"string"==typeof(ret=elem.value)?ret.replace(rreturn,""):null==ret?"":ret:undefined;var isFunction=jQuery.isFunction(value);return this.each(function(i){var val,self=jQuery(this);1===this.nodeType&&(null==(val=isFunction?value.call(this,i,self.val()):value)?val="":"number"==typeof val?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),(hooks=jQuery.valHooks[this.nodeName.toLowerCase()]||jQuery.valHooks[this.type])&&"set"in hooks&&hooks.set(this,val,"value")!==undefined||(this.value=val))})}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,index=elem.selectedIndex,values=[],options=elem.options,one="select-one"===elem.type;if(index<0)return null;for(var i=one?index:0,max=one?index+1:options.length;i<max;i++){var option=options[i];if(option.selected&&(jQuery.support.optDisabled?!option.disabled:null===option.getAttribute("disabled"))&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}}return one&&!values.length&&options.length?jQuery(options[index]).val():values},set:function(elem,value){var values=jQuery.makeArray(value);return jQuery(elem).find("option").each(function(){this.selected=0<=jQuery.inArray(jQuery(this).val(),values)}),values.length||(elem.selectedIndex=-1),values}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attrFix:{tabindex:"tabIndex"},attr:function(elem,name,value,pass){var nType=elem.nodeType;if(!elem||3===nType||8===nType||2===nType)return undefined;if(pass&&name in jQuery.attrFn)return jQuery(elem)[name](value);if(!("getAttribute"in elem))return jQuery.prop(elem,name,value);var ret,hooks,notxml=1!==nType||!jQuery.isXMLDoc(elem);return notxml&&(name=jQuery.attrFix[name]||name,(hooks=jQuery.attrHooks[name])||(rboolean.test(name)?hooks=boolHook:formHook&&"className"!==name&&(jQuery.nodeName(elem,"form")||rinvalidChar.test(name))&&(hooks=formHook))),value!==undefined?null===value?(jQuery.removeAttr(elem,name),undefined):hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined?ret:(elem.setAttribute(name,""+value),value):!(hooks&&"get"in hooks&&notxml&&null!==(ret=hooks.get(elem,name)))&&null===(ret=elem.getAttribute(name))?undefined:ret},removeAttr:function(elem,name){var propName;1===elem.nodeType&&(name=jQuery.attrFix[name]||name,jQuery.support.getSetAttribute?elem.removeAttribute(name):(jQuery.attr(elem,name,""),elem.removeAttributeNode(elem.getAttributeNode(name))),rboolean.test(name)&&(propName=jQuery.propFix[name]||name)in elem&&(elem[propName]=!1))},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode)jQuery.error("type property can't be changed");else if(!jQuery.support.radioValue&&"radio"===value&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}},tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabIndex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined}},value:{get:function(elem,name){return formHook&&jQuery.nodeName(elem,"button")?formHook.get(elem,name):name in elem?elem.value:null},set:function(elem,value,name){if(formHook&&jQuery.nodeName(elem,"button"))return formHook.set(elem,value,name);elem.value=value}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;return elem&&3!==nType&&8!==nType&&2!==nType?((1!==nType||!jQuery.isXMLDoc(elem))&&(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),value!==undefined?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value:hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==undefined?ret:elem[name]):undefined},propHooks:{}}),boolHook={get:function(elem,name){return jQuery.prop(elem,name)?name.toLowerCase():undefined},set:function(elem,value,name){var propName;return!1===value?jQuery.removeAttr(elem,name):((propName=jQuery.propFix[name]||name)in elem&&(elem[propName]=!0),elem.setAttribute(name,name.toLowerCase())),name}},jQuery.support.getSetAttribute||(jQuery.attrFix=jQuery.propFix,formHook=jQuery.attrHooks.name=jQuery.attrHooks.title=jQuery.valHooks.button={get:function(elem,name){var ret;return(ret=elem.getAttributeNode(name))&&""!==ret.nodeValue?ret.nodeValue:undefined},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(ret)return ret.nodeValue=value}},jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(""===value)return elem.setAttribute(name,"auto"),value}})})),jQuery.support.hrefNormalized||jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return null===ret?undefined:ret}})}),jQuery.support.style||(jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined},set:function(elem,value){return elem.style.cssText=""+value}}),jQuery.support.optSelected||(jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex)}})),jQuery.support.checkOn||jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return null===elem.getAttribute("value")?"on":elem.value}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value))return elem.checked=0<=jQuery.inArray(jQuery(elem).val(),value)}})});function fcleanup(nm){return nm.replace(rescape,"\\$&")}var rnamespaces=/\.(.*)$/,rformElems=/^(?:textarea|input|select)$/i,rperiod=/\./g,rspaces=/ /g,rescape=/[^\w\s.|`]/g;function returnFalse(){return!1}function returnTrue(){return!0}jQuery.event={add:function(elem,types,handler,data){if(3!==elem.nodeType&&8!==elem.nodeType){if(!1===handler)handler=returnFalse;else if(!handler)return;var handleObjIn,handleObj;handler.handler&&(handler=(handleObjIn=handler).handler),handler.guid||(handler.guid=jQuery.guid++);var elemData=jQuery._data(elem);if(elemData){var events=elemData.events,eventHandle=elemData.handle;events||(elemData.events=events={}),eventHandle||(elemData.handle=eventHandle=function(e){return void 0===jQuery||e&&jQuery.event.triggered===e.type?undefined:jQuery.event.handle.apply(eventHandle.elem,arguments)}),eventHandle.elem=elem,types=types.split(" ");for(var type,namespaces,i=0;type=types[i++];){handleObj=handleObjIn?jQuery.extend({},handleObjIn):{handler:handler,data:data},-1<type.indexOf(".")?(type=(namespaces=type.split(".")).shift(),handleObj.namespace=namespaces.slice(0).sort().join(".")):(namespaces=[],handleObj.namespace=""),handleObj.type=type,handleObj.guid||(handleObj.guid=handler.guid);var handlers=events[type],special=jQuery.event.special[type]||{};handlers||(handlers=events[type]=[],special.setup&&!1!==special.setup.call(elem,data,namespaces,eventHandle)||(elem.addEventListener?elem.addEventListener(type,eventHandle,!1):elem.attachEvent&&elem.attachEvent("on"+type,eventHandle))),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),handlers.push(handleObj),jQuery.event.global[type]=!0}elem=null}}},global:{},remove:function(elem,types,handler,pos){if(3!==elem.nodeType&&8!==elem.nodeType){!1===handler&&(handler=returnFalse);var type,j,all,namespaces,namespace,special,eventType,handleObj,origType,i=0,elemData=jQuery.hasData(elem)&&jQuery._data(elem),events=elemData&&elemData.events;if(elemData&&events)if(types&&types.type&&(handler=types.handler,types=types.type),!types||"string"==typeof types&&"."===types.charAt(0))for(type in types=types||"",events)jQuery.event.remove(elem,type+types);else{for(types=types.split(" ");type=types[i++];)if(handleObj=null,namespaces=[],(all=(origType=type).indexOf(".")<0)||(type=(namespaces=type.split(".")).shift(),namespace=new RegExp("(^|\\.)"+jQuery.map(namespaces.slice(0).sort(),fcleanup).join("\\.(?:.*\\.)?")+"(\\.|$)")),eventType=events[type])if(handler){for(special=jQuery.event.special[type]||{},j=pos||0;j<eventType.length&&(handleObj=eventType[j],handler.guid!==handleObj.guid||((all||namespace.test(handleObj.namespace))&&(null==pos&&eventType.splice(j--,1),special.remove&&special.remove.call(elem,handleObj)),null==pos));j++);(0===eventType.length||null!=pos&&1===eventType.length)&&(special.teardown&&!1!==special.teardown.call(elem,namespaces)||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(j=0;j<eventType.length;j++)handleObj=eventType[j],(all||namespace.test(handleObj.namespace))&&(jQuery.event.remove(elem,origType,handleObj.handler,j),eventType.splice(j--,1));if(jQuery.isEmptyObject(events)){var handle=elemData.handle;handle&&(handle.elem=null),delete elemData.events,delete elemData.handle,jQuery.isEmptyObject(elemData)&&jQuery.removeData(elem,undefined,!0)}}}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(event,data,elem,onlyHandlers){var exclusive,type=event.type||event,namespaces=[];if(0<=type.indexOf("!")&&(type=type.slice(0,-1),exclusive=!0),0<=type.indexOf(".")&&(type=(namespaces=type.split(".")).shift(),namespaces.sort()),elem&&!jQuery.event.customEvent[type]||jQuery.event.global[type])if((event="object"==typeof event?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type)).type=type,event.exclusive=exclusive,event.namespace=namespaces.join("."),event.namespace_re=new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.)?")+"(\\.|$)"),!onlyHandlers&&elem||(event.preventDefault(),event.stopPropagation()),elem){if(3!==elem.nodeType&&8!==elem.nodeType){event.result=undefined,event.target=elem,(data=null!=data?jQuery.makeArray(data):[]).unshift(event);var cur=elem,ontype=type.indexOf(":")<0?"on"+type:"";do{var handle=jQuery._data(cur,"handle");event.currentTarget=cur,handle&&handle.apply(cur,data),ontype&&jQuery.acceptData(cur)&&cur[ontype]&&!1===cur[ontype].apply(cur,data)&&(event.result=!1,event.preventDefault()),cur=cur.parentNode||cur.ownerDocument||cur===event.target.ownerDocument&&window}while(cur&&!event.isPropagationStopped());if(!event.isDefaultPrevented()){var old,special=jQuery.event.special[type]||{};if((!special._default||!1===special._default.call(elem.ownerDocument,event))&&("click"!==type||!jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){try{ontype&&elem[type]&&((old=elem[ontype])&&(elem[ontype]=null),elem[jQuery.event.triggered=type]())}catch(ieError){}old&&(elem[ontype]=old),jQuery.event.triggered=undefined}}return event.result}}else jQuery.each(jQuery.cache,function(){var internalCache=this[jQuery.expando];internalCache&&internalCache.events&&internalCache.events[type]&&jQuery.event.trigger(event,data,internalCache.handle.elem)})},handle:function(event){event=jQuery.event.fix(event||window.event);var handlers=((jQuery._data(this,"events")||{})[event.type]||[]).slice(0),run_all=!event.exclusive&&!event.namespace,args=Array.prototype.slice.call(arguments,0);(args[0]=event).currentTarget=this;for(var j=0,l=handlers.length;j<l;j++){var handleObj=handlers[j];if(run_all||event.namespace_re.test(handleObj.namespace)){event.handler=handleObj.handler,event.data=handleObj.data;var ret=(event.handleObj=handleObj).handler.apply(this,args);if(ret!==undefined&&!1===(event.result=ret)&&(event.preventDefault(),event.stopPropagation()),event.isImmediatePropagationStopped())break}}return event.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(event){if(event[jQuery.expando])return event;var originalEvent=event;event=jQuery.Event(originalEvent);for(var prop,i=this.props.length;i;)event[prop=this.props[--i]]=originalEvent[prop];if(event.target||(event.target=event.srcElement||document),3===event.target.nodeType&&(event.target=event.target.parentNode),!event.relatedTarget&&event.fromElement&&(event.relatedTarget=event.fromElement===event.target?event.toElement:event.fromElement),null==event.pageX&&null!=event.clientX){var eventDocument=event.target.ownerDocument||document,doc=eventDocument.documentElement,body=eventDocument.body;event.pageX=event.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=event.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}return null!=event.which||null==event.charCode&&null==event.keyCode||(event.which=null!=event.charCode?event.charCode:event.keyCode),!event.metaKey&&event.ctrlKey&&(event.metaKey=event.ctrlKey),event.which||event.button===undefined||(event.which=1&event.button?1:2&event.button?3:4&event.button?2:0),event},guid:1e8,proxy:jQuery.proxy,special:{ready:{setup:jQuery.bindReady,teardown:jQuery.noop},live:{add:function(handleObj){jQuery.event.add(this,liveConvert(handleObj.origType,handleObj.selector),jQuery.extend({},handleObj,{handler:liveHandler,guid:handleObj.handler.guid}))},remove:function(handleObj){jQuery.event.remove(this,liveConvert(handleObj.origType,handleObj.selector),handleObj)}},beforeunload:{setup:function(data,namespaces,eventHandle){jQuery.isWindow(this)&&(this.onbeforeunload=eventHandle)},teardown:function(namespaces,eventHandle){this.onbeforeunload===eventHandle&&(this.onbeforeunload=null)}}}},jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)}:function(elem,type,handle){elem.detachEvent&&elem.detachEvent("on"+type,handle)},jQuery.Event=function(src,props){if(!this.preventDefault)return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||!1===src.returnValue||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};function withinElement(event){var related=event.relatedTarget,inside=!1,eventType=event.type;event.type=event.data,related!==this&&(related&&(inside=jQuery.contains(this,related)),inside||(jQuery.event.handle.apply(this,arguments),event.type=eventType))}function delegate(event){event.type=event.data,jQuery.event.handle.apply(this,arguments)}if(jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={setup:function(data){jQuery.event.add(this,fix,data&&data.selector?delegate:withinElement,orig)},teardown:function(data){jQuery.event.remove(this,fix,data&&data.selector?delegate:withinElement)}}}),jQuery.support.submitBubbles||(jQuery.event.special.submit={setup:function(data,namespaces){if(jQuery.nodeName(this,"form"))return!1;jQuery.event.add(this,"click.specialSubmit",function(e){var elem=e.target,type=elem.type;"submit"!==type&&"image"!==type||!jQuery(elem).closest("form").length||trigger("submit",this,arguments)}),jQuery.event.add(this,"keypress.specialSubmit",function(e){var elem=e.target,type=elem.type;"text"!==type&&"password"!==type||!jQuery(elem).closest("form").length||13!==e.keyCode||trigger("submit",this,arguments)})},teardown:function(namespaces){jQuery.event.remove(this,".specialSubmit")}}),!jQuery.support.changeBubbles){function getVal(elem){var type=elem.type,val=elem.value;return"radio"===type||"checkbox"===type?val=elem.checked:"select-multiple"===type?val=-1<elem.selectedIndex?jQuery.map(elem.options,function(elem){return elem.selected}).join("-"):"":jQuery.nodeName(elem,"select")&&(val=elem.selectedIndex),val}var changeFilters,testChange=function(e,argument_1){var data,val,elem=e.target;rformElems.test(elem.nodeName)&&!elem.readOnly&&(data=jQuery._data(elem,"_change_data"),val=getVal(elem),"focusout"===e.type&&"radio"===elem.type||jQuery._data(elem,"_change_data",val),data!==undefined&&val!==data&&(null==data&&!val||(e.type="change",e.liveFired=undefined,jQuery.event.trigger(e,argument_1,elem))))};jQuery.event.special.change={filters:{focusout:testChange,beforedeactivate:testChange,click:function(e){var elem=e.target,type=jQuery.nodeName(elem,"input")?elem.type:"";"radio"!==type&&"checkbox"!==type&&!jQuery.nodeName(elem,"select")||testChange.call(this,e)},keydown:function(e){var elem=e.target,type=jQuery.nodeName(elem,"input")?elem.type:"";(13!==e.keyCode||jQuery.nodeName(elem,"textarea"))&&(32!==e.keyCode||"checkbox"!==type&&"radio"!==type)&&"select-multiple"!==type||testChange.call(this,e)},beforeactivate:function(e){var elem=e.target;jQuery._data(elem,"_change_data",getVal(elem))}},setup:function(data,namespaces){if("file"===this.type)return!1;for(var type in changeFilters)jQuery.event.add(this,type+".specialChange",changeFilters[type]);return rformElems.test(this.nodeName)},teardown:function(namespaces){return jQuery.event.remove(this,".specialChange"),rformElems.test(this.nodeName)}},(changeFilters=jQuery.event.special.change.filters).focus=changeFilters.beforeactivate}function trigger(type,elem,args){var event=jQuery.extend({},args[0]);event.type=type,event.originalEvent={},event.liveFired=undefined,jQuery.event.handle.call(elem,event),event.isDefaultPrevented()&&args[0].preventDefault()}jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0;function handler(donor){var e=jQuery.event.fix(donor);e.type=fix,e.originalEvent={},jQuery.event.trigger(e,null,e.target),e.isDefaultPrevented()&&donor.preventDefault()}jQuery.event.special[fix]={setup:function(){0==attaches++&&document.addEventListener(orig,handler,!0)},teardown:function(){0==--attaches&&document.removeEventListener(orig,handler,!0)}}}),jQuery.each(["bind","one"],function(i,name){jQuery.fn[name]=function(type,data,fn){var handler;if("object"==typeof type){for(var key in type)this[name](key,data,type[key],fn);return this}if(2!==arguments.length&&!1!==data||(fn=data,data=undefined),"one"===name?(handler=function(event){return jQuery(this).unbind(event,handler),fn.apply(this,arguments)}).guid=fn.guid||jQuery.guid++:handler=fn,"unload"===type&&"one"!==name)this.one(type,data,fn);else for(var i=0,l=this.length;i<l;i++)jQuery.event.add(this[i],type,handler,data);return this}}),jQuery.fn.extend({unbind:function(type,fn){if("object"!=typeof type||type.preventDefault)for(var i=0,l=this.length;i<l;i++)jQuery.event.remove(this[i],type,fn);else for(var key in type)this.unbind(key,type[key]);return this},delegate:function(selector,types,data,fn){return this.live(types,data,fn,selector)},undelegate:function(selector,types,fn){return 0===arguments.length?this.unbind("live"):this.die(types,null,fn,selector)},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){if(this[0])return jQuery.event.trigger(type,data,this[0],!0)},toggle:function(fn){function toggler(event){var lastToggle=(jQuery.data(this,"lastToggle"+fn.guid)||0)%i;return jQuery.data(this,"lastToggle"+fn.guid,1+lastToggle),event.preventDefault(),args[lastToggle].apply(this,arguments)||!1}var args=arguments,guid=fn.guid||jQuery.guid++,i=0;for(toggler.guid=guid;i<args.length;)args[i++].guid=guid;return this.click(toggler)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}});var liveMap={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};function liveHandler(event){var stop,maxLevel,related,match,handleObj,elem,j,i,l,close,namespace,ret,elems=[],selectors=[],events=jQuery._data(this,"events");if(event.liveFired!==this&&events&&events.live&&!event.target.disabled&&(!event.button||"click"!==event.type)){event.namespace&&(namespace=new RegExp("(^|\\.)"+event.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")),event.liveFired=this;var live=events.live.slice(0);for(j=0;j<live.length;j++)(handleObj=live[j]).origType.replace(rnamespaces,"")===event.type?selectors.push(handleObj.selector):live.splice(j--,1);for(i=0,l=(match=jQuery(event.target).closest(selectors,event.currentTarget)).length;i<l;i++)for(close=match[i],j=0;j<live.length;j++)handleObj=live[j],close.selector!==handleObj.selector||namespace&&!namespace.test(handleObj.namespace)||close.elem.disabled||(elem=close.elem,related=null,"mouseenter"!==handleObj.preType&&"mouseleave"!==handleObj.preType||(event.type=handleObj.preType,(related=jQuery(event.relatedTarget).closest(handleObj.selector)[0])&&jQuery.contains(elem,related)&&(related=elem)),related&&related===elem||elems.push({elem:elem,handleObj:handleObj,level:close.level}));for(i=0,l=elems.length;i<l&&(match=elems[i],!(maxLevel&&match.level>maxLevel))&&(event.currentTarget=match.elem,event.data=match.handleObj.data,event.handleObj=match.handleObj,!1!==(ret=match.handleObj.origHandler.apply(match.elem,arguments))&&!event.isPropagationStopped()||(maxLevel=match.level,!1===ret&&(stop=!1),!event.isImmediatePropagationStopped()));i++);return stop}}function liveConvert(type,selector){return(type&&"*"!==type?type+".":"")+selector.replace(rperiod,"`").replace(rspaces,"&")}jQuery.each(["live","die"],function(i,name){jQuery.fn[name]=function(types,data,fn,origSelector){var type,match,namespaces,preType,i=0,selector=origSelector||this.selector,context=origSelector?this:jQuery(this.context);if("object"==typeof types&&!types.preventDefault){for(var key in types)context[name](key,data,types[key],selector);return this}if("die"===name&&!types&&origSelector&&"."===origSelector.charAt(0))return context.unbind(origSelector),this;for(!1!==data&&!jQuery.isFunction(data)||(fn=data||returnFalse,data=undefined),types=(types||"").split(" ");null!=(type=types[i++]);)if(namespaces="",(match=rnamespaces.exec(type))&&(namespaces=match[0],type=type.replace(rnamespaces,"")),"hover"!==type)if(liveMap[preType=type]?(types.push(liveMap[type]+namespaces),type+=namespaces):type=(liveMap[type]||type)+namespaces,"live"===name)for(var j=0,l=context.length;j<l;j++)jQuery.event.add(context[j],"live."+liveConvert(type,selector),{data:data,selector:selector,handler:fn,origType:type,origHandler:fn,preType:preType});else context.unbind("live."+liveConvert(type,selector),fn);else types.push("mouseenter"+namespaces,"mouseleave"+namespaces);return this}}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return null==fn&&(fn=data,data=null),0<arguments.length?this.bind(name,data,fn):this.trigger(name)},jQuery.attrFn&&(jQuery.attrFn[name]=!0)}),function(){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,done=0,toString=Object.prototype.toString,hasDuplicate=!1,baseHasDuplicate=!0,rBackslash=/\\/g,rNonWord=/\W/;[0,0].sort(function(){return baseHasDuplicate=!1,0});var Sizzle=function(selector,context,results,seed){results=results||[];var origContext=context=context||document;if(1!==context.nodeType&&9!==context.nodeType)return[];if(!selector||"string"!=typeof selector)return results;var m,set,checkSet,extra,ret,cur,pop,i,prune=!0,contextXML=Sizzle.isXML(context),parts=[],soFar=selector;do{if(chunker.exec(""),(m=chunker.exec(soFar))&&(soFar=m[3],parts.push(m[1]),m[2])){extra=m[3];break}}while(m);if(1<parts.length&&origPOS.exec(selector))if(2===parts.length&&Expr.relative[parts[0]])set=posProcess(parts[0]+parts[1],context);else for(set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);parts.length;)selector=parts.shift(),Expr.relative[selector]&&(selector+=parts.shift()),set=posProcess(selector,set);else if(!seed&&1<parts.length&&9===context.nodeType&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])&&(context=(ret=Sizzle.find(parts.shift(),context,contextXML)).expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0]),context)for(set=(ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),1!==parts.length||"~"!==parts[0]&&"+"!==parts[0]||!context.parentNode?context:context.parentNode,contextXML)).expr?Sizzle.filter(ret.expr,ret.set):ret.set,0<parts.length?checkSet=makeArray(set):prune=!1;parts.length;)pop=cur=parts.pop(),Expr.relative[cur]?pop=parts.pop():cur="",null==pop&&(pop=context),Expr.relative[cur](checkSet,pop,contextXML);else checkSet=parts=[];if((checkSet=checkSet||set)||Sizzle.error(cur||selector),"[object Array]"===toString.call(checkSet))if(prune)if(context&&1===context.nodeType)for(i=0;null!=checkSet[i];i++)checkSet[i]&&(!0===checkSet[i]||1===checkSet[i].nodeType&&Sizzle.contains(context,checkSet[i]))&&results.push(set[i]);else for(i=0;null!=checkSet[i];i++)checkSet[i]&&1===checkSet[i].nodeType&&results.push(set[i]);else results.push.apply(results,checkSet);else makeArray(checkSet,results);return extra&&(Sizzle(extra,origContext,results,seed),Sizzle.uniqueSort(results)),results};Sizzle.uniqueSort=function(results){if(sortOrder&&(hasDuplicate=baseHasDuplicate,results.sort(sortOrder),hasDuplicate))for(var i=1;i<results.length;i++)results[i]===results[i-1]&&results.splice(i--,1);return results},Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set)},Sizzle.matchesSelector=function(node,expr){return 0<Sizzle(expr,null,null,[node]).length},Sizzle.find=function(expr,context,isXML){var set;if(!expr)return[];for(var i=0,l=Expr.order.length;i<l;i++){var match,type=Expr.order[i];if(match=Expr.leftMatch[type].exec(expr)){var left=match[1];if(match.splice(1,1),"\\"!==left.substr(left.length-1)&&(match[1]=(match[1]||"").replace(rBackslash,""),null!=(set=Expr.find[type](match,context,isXML)))){expr=expr.replace(Expr.match[type],"");break}}}return{set:set=set||(void 0!==context.getElementsByTagName?context.getElementsByTagName("*"):[]),expr:expr}},Sizzle.filter=function(expr,set,inplace,not){for(var match,anyFound,old=expr,result=[],curLoop=set,isXMLFilter=set&&set[0]&&Sizzle.isXML(set[0]);expr&&set.length;){for(var type in Expr.filter)if(null!=(match=Expr.leftMatch[type].exec(expr))&&match[2]){var found,item,filter=Expr.filter[type],left=match[1];if(anyFound=!1,match.splice(1,1),"\\"===left.substr(left.length-1))continue;if(curLoop===result&&(result=[]),Expr.preFilter[type])if(match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter)){if(!0===match)continue}else anyFound=found=!0;if(match)for(var i=0;null!=(item=curLoop[i]);i++)if(item){var pass=not^!!(found=filter(item,match,i,curLoop));inplace&&null!=found?pass?anyFound=!0:curLoop[i]=!1:pass&&(result.push(item),anyFound=!0)}if(found!==undefined){if(inplace||(curLoop=result),expr=expr.replace(Expr.match[type],""),!anyFound)return[];break}}if(expr===old){if(null!=anyFound)break;Sizzle.error(expr)}old=expr}return curLoop},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};function fescape(all,num){return"\\"+(+num+1)}var Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href")},type:function(elem){return elem.getAttribute("type")}},relative:{"+":function(checkSet,part){var isPartStr="string"==typeof part,isTag=isPartStr&&!rNonWord.test(part),isPartStrNotTag=isPartStr&&!isTag;isTag&&(part=part.toLowerCase());for(var elem,i=0,l=checkSet.length;i<l;i++)if(elem=checkSet[i]){for(;(elem=elem.previousSibling)&&1!==elem.nodeType;);checkSet[i]=isPartStrNotTag||elem&&elem.nodeName.toLowerCase()===part?elem||!1:elem===part}isPartStrNotTag&&Sizzle.filter(part,checkSet,!0)},">":function(checkSet,part){var elem,isPartStr="string"==typeof part,i=0,l=checkSet.length;if(isPartStr&&!rNonWord.test(part)){for(part=part.toLowerCase();i<l;i++)if(elem=checkSet[i]){var parent=elem.parentNode;checkSet[i]=parent.nodeName.toLowerCase()===part&&parent}}else{for(;i<l;i++)(elem=checkSet[i])&&(checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part);isPartStr&&Sizzle.filter(part,checkSet,!0)}},"":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;"string"!=typeof part||rNonWord.test(part)||(nodeCheck=part=part.toLowerCase(),checkFn=dirNodeCheck),checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML)},"~":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;"string"!=typeof part||rNonWord.test(part)||(nodeCheck=part=part.toLowerCase(),checkFn=dirNodeCheck),checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML)}},find:{ID:function(match,context,isXML){if(void 0!==context.getElementById&&!isXML){var m=context.getElementById(match[1]);return m&&m.parentNode?[m]:[]}},NAME:function(match,context){if(void 0!==context.getElementsByName){for(var ret=[],results=context.getElementsByName(match[1]),i=0,l=results.length;i<l;i++)results[i].getAttribute("name")===match[1]&&ret.push(results[i]);return 0===ret.length?null:ret}},TAG:function(match,context){if(void 0!==context.getElementsByTagName)return context.getElementsByTagName(match[1])}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){if(match=" "+match[1].replace(rBackslash,"")+" ",isXML)return match;for(var elem,i=0;null!=(elem=curLoop[i]);i++)elem&&(not^(elem.className&&0<=(" "+elem.className+" ").replace(/[\t\n\r]/g," ").indexOf(match))?inplace||result.push(elem):inplace&&(curLoop[i]=!1));return!1},ID:function(match){return match[1].replace(rBackslash,"")},TAG:function(match,curLoop){return match[1].replace(rBackslash,"").toLowerCase()},CHILD:function(match){if("nth"===match[1]){match[2]||Sizzle.error(match[0]),match[2]=match[2].replace(/^\+|\s*/g,"");var test=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(("even"===match[2]?"2n":"odd"===match[2]&&"2n+1")||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=+(test[1]+(test[2]||1)),match[3]=+test[3]}else match[2]&&Sizzle.error(match[0]);return match[0]=done++,match},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1]=match[1].replace(rBackslash,"");return!isXML&&Expr.attrMap[name]&&(match[1]=Expr.attrMap[name]),match[4]=(match[4]||match[5]||"").replace(rBackslash,""),"~="===match[2]&&(match[4]=" "+match[4]+" "),match},PSEUDO:function(match,curLoop,inplace,result,not){if("not"===match[1]){if(!(1<(chunker.exec(match[3])||"").length||/^\w/.test(match[3]))){var ret=Sizzle.filter(match[3],curLoop,inplace,!0^not);return inplace||result.push.apply(result,ret),!1}match[3]=Sizzle(match[3],null,null,curLoop)}else if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0]))return!0;return match},POS:function(match){return match.unshift(!0),match}},filters:{enabled:function(elem){return!1===elem.disabled&&"hidden"!==elem.type},disabled:function(elem){return!0===elem.disabled},checked:function(elem){return!0===elem.checked},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},parent:function(elem){return!!elem.firstChild},empty:function(elem){return!elem.firstChild},has:function(elem,i,match){return!!Sizzle(match[3],elem).length},header:function(elem){return/h\d/i.test(elem.nodeName)},text:function(elem){var attr=elem.getAttribute("type"),type=elem.type;return"input"===elem.nodeName.toLowerCase()&&"text"===type&&(attr===type||null===attr)},radio:function(elem){return"input"===elem.nodeName.toLowerCase()&&"radio"===elem.type},checkbox:function(elem){return"input"===elem.nodeName.toLowerCase()&&"checkbox"===elem.type},file:function(elem){return"input"===elem.nodeName.toLowerCase()&&"file"===elem.type},password:function(elem){return"input"===elem.nodeName.toLowerCase()&&"password"===elem.type},submit:function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&"submit"===elem.type},image:function(elem){return"input"===elem.nodeName.toLowerCase()&&"image"===elem.type},reset:function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&"reset"===elem.type},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},input:function(elem){return/input|select|textarea|button/i.test(elem.nodeName)},focus:function(elem){return elem===elem.ownerDocument.activeElement}},setFilters:{first:function(elem,i){return 0===i},last:function(elem,i,match,array){return i===array.length-1},even:function(elem,i){return i%2==0},odd:function(elem,i){return i%2==1},lt:function(elem,i,match){return i<+match[3]},gt:function(elem,i,match){return i>+match[3]},nth:function(elem,i,match){return+match[3]===i},eq:function(elem,i,match){return+match[3]===i}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter)return filter(elem,i,match,array);if("contains"===name)return 0<=(elem.textContent||elem.innerText||Sizzle.getText([elem])||"").indexOf(match[3]);if("not"===name){for(var not=match[3],j=0,l=not.length;j<l;j++)if(not[j]===elem)return!1;return!0}Sizzle.error(name)},CHILD:function(elem,match){var type=match[1],node=elem;switch(type){case"only":case"first":for(;node=node.previousSibling;)if(1===node.nodeType)return!1;if("first"===type)return!0;node=elem;case"last":for(;node=node.nextSibling;)if(1===node.nodeType)return!1;return!0;case"nth":var first=match[2],last=match[3];if(1===first&&0===last)return!0;var doneName=match[0],parent=elem.parentNode;if(parent&&(parent.sizcache!==doneName||!elem.nodeIndex)){var count=0;for(node=parent.firstChild;node;node=node.nextSibling)1===node.nodeType&&(node.nodeIndex=++count);parent.sizcache=doneName}var diff=elem.nodeIndex-last;return 0===first?0==diff:diff%first==0&&0<=diff/first}},ID:function(elem,match){return 1===elem.nodeType&&elem.getAttribute("id")===match},TAG:function(elem,match){return"*"===match&&1===elem.nodeType||elem.nodeName.toLowerCase()===match},CLASS:function(elem,match){return-1<(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)},ATTR:function(elem,match){var name=match[1],result=Expr.attrHandle[name]?Expr.attrHandle[name](elem):null!=elem[name]?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return null==result?"!="===type:"="===type?value===check:"*="===type?0<=value.indexOf(check):"~="===type?0<=(" "+value+" ").indexOf(check):check?"!="===type?value!==check:"^="===type?0===value.indexOf(check):"$="===type?value.substr(value.length-check.length)===check:"|="===type&&(value===check||value.substr(0,check.length+1)===check+"-"):value&&!1!==result},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter)return filter(elem,i,match,array)}}},origPOS=Expr.match.POS;for(var type in Expr.match)Expr.match[type]=new RegExp(Expr.match[type].source+/(?![^\[]*\])(?![^\(]*\))/.source),Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source.replace(/\\(\d+)/g,fescape));var sortOrder,siblingCheck,form,id,root,div,makeArray=function(array,results){return array=Array.prototype.slice.call(array,0),results?(results.push.apply(results,array),results):array};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(e){makeArray=function(array,results){var i=0,ret=results||[];if("[object Array]"===toString.call(array))Array.prototype.push.apply(ret,array);else if("number"==typeof array.length)for(var l=array.length;i<l;i++)ret.push(array[i]);else for(;array[i];i++)ret.push(array[i]);return ret}}function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=!1;for(elem=elem[dir];elem;){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(1!==elem.nodeType||isXML||(elem.sizcache=doneName,elem.sizset=i),elem.nodeName.toLowerCase()===cur){match=elem;break}elem=elem[dir]}checkSet[i]=match}}}function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=!1;for(elem=elem[dir];elem;){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(1===elem.nodeType)if(isXML||(elem.sizcache=doneName,elem.sizset=i),"string"!=typeof cur){if(elem===cur){match=!0;break}}else if(0<Sizzle.filter(cur,[elem]).length){match=elem;break}elem=elem[dir]}checkSet[i]=match}}}document.documentElement.compareDocumentPosition?sortOrder=function(a,b){return a===b?(hasDuplicate=!0,0):a.compareDocumentPosition&&b.compareDocumentPosition?4&a.compareDocumentPosition(b)?-1:1:a.compareDocumentPosition?-1:1}:(sortOrder=function(a,b){if(a===b)return hasDuplicate=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup)return siblingCheck(a,b);if(!aup)return-1;if(!bup)return 1;for(;cur;)ap.unshift(cur),cur=cur.parentNode;for(cur=bup;cur;)bp.unshift(cur),cur=cur.parentNode;al=ap.length,bl=bp.length;for(var i=0;i<al&&i<bl;i++)if(ap[i]!==bp[i])return siblingCheck(ap[i],bp[i]);return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1)},siblingCheck=function(a,b,ret){if(a===b)return ret;for(var cur=a.nextSibling;cur;){if(cur===b)return-1;cur=cur.nextSibling}return 1}),Sizzle.getText=function(elems){for(var elem,ret="",i=0;elems[i];i++)3===(elem=elems[i]).nodeType||4===elem.nodeType?ret+=elem.nodeValue:8!==elem.nodeType&&(ret+=Sizzle.getText(elem.childNodes));return ret},form=document.createElement("div"),id="script"+(new Date).getTime(),root=document.documentElement,form.innerHTML="<a name='"+id+"'/>",root.insertBefore(form,root.firstChild),document.getElementById(id)&&(Expr.find.ID=function(match,context,isXML){if(void 0!==context.getElementById&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||void 0!==m.getAttributeNode&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[]}},Expr.filter.ID=function(elem,match){var node=void 0!==elem.getAttributeNode&&elem.getAttributeNode("id");return 1===elem.nodeType&&node&&node.nodeValue===match}),root.removeChild(form),root=form=null,(div=document.createElement("div")).appendChild(document.createComment("")),0<div.getElementsByTagName("*").length&&(Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if("*"===match[1]){for(var tmp=[],i=0;results[i];i++)1===results[i].nodeType&&tmp.push(results[i]);results=tmp}return results}),div.innerHTML="<a href='#'></a>",div.firstChild&&void 0!==div.firstChild.getAttribute&&"#"!==div.firstChild.getAttribute("href")&&(Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2)}),div=null,document.querySelectorAll&&function(){var oldSizzle=Sizzle,div=document.createElement("div");if(div.innerHTML="<p class='TEST'></p>",!div.querySelectorAll||0!==div.querySelectorAll(".TEST").length){for(var prop in Sizzle=function(query,context,extra,seed){if(context=context||document,!seed&&!Sizzle.isXML(context)){var match=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(query);if(match&&(1===context.nodeType||9===context.nodeType)){if(match[1])return makeArray(context.getElementsByTagName(query),extra);if(match[2]&&Expr.find.CLASS&&context.getElementsByClassName)return makeArray(context.getElementsByClassName(match[2]),extra)}if(9===context.nodeType){if("body"===query&&context.body)return makeArray([context.body],extra);if(match&&match[3]){var elem=context.getElementById(match[3]);if(!elem||!elem.parentNode)return makeArray([],extra);if(elem.id===match[3])return makeArray([elem],extra)}try{return makeArray(context.querySelectorAll(query),extra)}catch(qsaError){}}else if(1===context.nodeType&&"object"!==context.nodeName.toLowerCase()){var oldContext=context,old=context.getAttribute("id"),nid=old||"__sizzle__",hasParent=context.parentNode,relativeHierarchySelector=/^\s*[+~]/.test(query);old?nid=nid.replace(/'/g,"\\$&"):context.setAttribute("id",nid),relativeHierarchySelector&&hasParent&&(context=context.parentNode);try{if(!relativeHierarchySelector||hasParent)return makeArray(context.querySelectorAll("[id='"+nid+"'] "+query),extra)}catch(pseudoError){}finally{old||oldContext.removeAttribute("id")}}}return oldSizzle(query,context,extra,seed)},oldSizzle)Sizzle[prop]=oldSizzle[prop];div=null}}(),function(){var html=document.documentElement,matches=html.matchesSelector||html.mozMatchesSelector||html.webkitMatchesSelector||html.msMatchesSelector;if(matches){var disconnectedMatch=!matches.call(document.createElement("div"),"div"),pseudoWorks=!1;try{matches.call(document.documentElement,"[test!='']:sizzle")}catch(pseudoError){pseudoWorks=!0}Sizzle.matchesSelector=function(node,expr){if(expr=expr.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!Sizzle.isXML(node))try{if(pseudoWorks||!Expr.match.PSEUDO.test(expr)&&!/!=/.test(expr)){var ret=matches.call(node,expr);if(ret||!disconnectedMatch||node.document&&11!==node.document.nodeType)return ret}}catch(e){}return 0<Sizzle(expr,null,null,[node]).length}}}(),function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>",div.getElementsByClassName&&0!==div.getElementsByClassName("e").length&&(div.lastChild.className="e",1!==div.getElementsByClassName("e").length&&(Expr.order.splice(1,0,"CLASS"),Expr.find.CLASS=function(match,context,isXML){if(void 0!==context.getElementsByClassName&&!isXML)return context.getElementsByClassName(match[1])},div=null))}(),document.documentElement.contains?Sizzle.contains=function(a,b){return a!==b&&(!a.contains||a.contains(b))}:document.documentElement.compareDocumentPosition?Sizzle.contains=function(a,b){return!!(16&a.compareDocumentPosition(b))}:Sizzle.contains=function(){return!1},Sizzle.isXML=function(elem){var documentElement=(elem?elem.ownerDocument||elem:0).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName};var posProcess=function(selector,context){for(var match,tmpSet=[],later="",root=context.nodeType?[context]:context;match=Expr.match.PSEUDO.exec(selector);)later+=match[0],selector=selector.replace(Expr.match.PSEUDO,"");selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++)Sizzle(selector,root[i],tmpSet);return Sizzle.filter(later,tmpSet)};jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.filters,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains}();var runtil=/Until$/,rparentsprev=/^(?:parents|prevUntil|prevAll)/,rmultiselector=/,/,isSimple=/^.[^:#\[\.,]*$/,slice=Array.prototype.slice,POS=jQuery.expr.match.POS,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};function isDisconnected(node){return!node||!node.parentNode||11===node.parentNode.nodeType}function winnow(elements,qualifier,keep){if(qualifier=qualifier||0,jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)===keep});if(qualifier.nodeType)return jQuery.grep(elements,function(elem,i){return elem===qualifier===keep});if("string"==typeof qualifier){var filtered=jQuery.grep(elements,function(elem){return 1===elem.nodeType});if(isSimple.test(qualifier))return jQuery.filter(qualifier,filtered,!keep);qualifier=jQuery.filter(qualifier,filtered)}return jQuery.grep(elements,function(elem,i){return 0<=jQuery.inArray(elem,qualifier)===keep})}jQuery.fn.extend({find:function(selector){var i,l,self=this;if("string"!=typeof selector)return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++)if(jQuery.contains(self[i],this))return!0});var length,n,r,ret=this.pushStack("","find",selector);for(i=0,l=this.length;i<l;i++)if(length=ret.length,jQuery.find(selector,this[i],ret),0<i)for(n=length;n<ret.length;n++)for(r=0;r<length;r++)if(ret[r]===ret[n]){ret.splice(n--,1);break}return ret},has:function(target){var targets=jQuery(target);return this.filter(function(){for(var i=0,l=targets.length;i<l;i++)if(jQuery.contains(this,targets[i]))return!0})},not:function(selector){return this.pushStack(winnow(this,selector,!1),"not",selector)},filter:function(selector){return this.pushStack(winnow(this,selector,!0),"filter",selector)},is:function(selector){return!!selector&&("string"==typeof selector?0<jQuery.filter(selector,this).length:0<this.filter(selector).length)},closest:function(selectors,context){var i,l,ret=[],cur=this[0];if(jQuery.isArray(selectors)){var match,selector,matches={},level=1;if(cur&&selectors.length){for(i=0,l=selectors.length;i<l;i++)matches[selector=selectors[i]]||(matches[selector]=POS.test(selector)?jQuery(selector,context||this.context):selector);for(;cur&&cur.ownerDocument&&cur!==context;){for(selector in matches)((match=matches[selector]).jquery?-1<match.index(cur):jQuery(cur).is(match))&&ret.push({selector:selector,elem:cur,level:level});cur=cur.parentNode,level++}}return ret}var pos=POS.test(selectors)||"string"!=typeof selectors?jQuery(selectors,context||this.context):0;for(i=0,l=this.length;i<l;i++)for(cur=this[i];cur;){if(pos?-1<pos.index(cur):jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break}if(!(cur=cur.parentNode)||!cur.ownerDocument||cur===context||11===cur.nodeType)break}return ret=1<ret.length?jQuery.unique(ret):ret,this.pushStack(ret,"closest",selectors)},index:function(elem){return elem&&"string"!=typeof elem?jQuery.inArray(elem.jquery?elem[0]:elem,this):jQuery.inArray(this[0],elem?jQuery(elem):this.parent().children())},add:function(selector,context){var set="string"==typeof selector?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all))},andSelf:function(){return this.add(this.prevObject)}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return jQuery.nth(elem,2,"nextSibling")},prev:function(elem){return jQuery.nth(elem,2,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling(elem.parentNode.firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.makeArray(elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until),args=slice.call(arguments);return runtil.test(name)||(selector=until),selector&&"string"==typeof selector&&(ret=jQuery.filter(selector,ret)),ret=1<this.length&&!guaranteedUnique[name]?jQuery.unique(ret):ret,(1<this.length||rmultiselector.test(selector))&&rparentsprev.test(name)&&(ret=ret.reverse()),this.pushStack(ret,name,args.join(","))}}),jQuery.extend({filter:function(expr,elems,not){return not&&(expr=":not("+expr+")"),1===elems.length?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems)},dir:function(elem,dir,until){for(var matched=[],cur=elem[dir];cur&&9!==cur.nodeType&&(until===undefined||1!==cur.nodeType||!jQuery(cur).is(until));)1===cur.nodeType&&matched.push(cur),cur=cur[dir];return matched},nth:function(cur,result,dir,elem){result=result||1;for(var num=0;cur&&(1!==cur.nodeType||++num!==result);cur=cur[dir]);return cur},sibling:function(n,elem){for(var r=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&r.push(n);return r}});var rinlinejQuery=/ jQuery\d+="(?:\d+|null)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnocache=/<(?:script|object|embed|option|style)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)/,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};function cloneCopyEvent(src,dest){if(1===dest.nodeType&&jQuery.hasData(src)){var internalKey=jQuery.expando,oldData=jQuery.data(src),curData=jQuery.data(dest,oldData);if(oldData=oldData[internalKey]){var events=oldData.events;if(curData=curData[internalKey]=jQuery.extend({},oldData),events)for(var type in delete curData.handle,curData.events={},events)for(var i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type+(events[type][i].namespace?".":"")+events[type][i].namespace,events[type][i],events[type][i].data)}}}function cloneFixAttributes(src,dest){var nodeName;1===dest.nodeType&&(dest.clearAttributes&&dest.clearAttributes(),dest.mergeAttributes&&dest.mergeAttributes(src),"object"===(nodeName=dest.nodeName.toLowerCase())?dest.outerHTML=src.outerHTML:"input"!==nodeName||"checkbox"!==src.type&&"radio"!==src.type?"option"===nodeName?dest.selected=src.defaultSelected:"input"!==nodeName&&"textarea"!==nodeName||(dest.defaultValue=src.defaultValue):(src.checked&&(dest.defaultChecked=dest.checked=src.checked),dest.value!==src.value&&(dest.value=src.value)),dest.removeAttribute(jQuery.expando))}function getAll(elem){return"getElementsByTagName"in elem?elem.getElementsByTagName("*"):"querySelectorAll"in elem?elem.querySelectorAll("*"):[]}function fixDefaultChecked(elem){"checkbox"!==elem.type&&"radio"!==elem.type||(elem.defaultChecked=elem.checked)}function findInputs(elem){jQuery.nodeName(elem,"input")?fixDefaultChecked(elem):"getElementsByTagName"in elem&&jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked)}function evalScript(i,elem){elem.src?jQuery.ajax({url:elem.src,async:!1,dataType:"script"}):jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,"/*$0*/")),elem.parentNode&&elem.parentNode.removeChild(elem)}wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.support.htmlSerialize||(wrapMap._default=[1,"div<div>","</div>"]),jQuery.fn.extend({text:function(text){return jQuery.isFunction(text)?this.each(function(i){var self=jQuery(this);self.text(text.call(this,i,self.text()))}):"object"!=typeof text&&text!==undefined?this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(text)):jQuery.text(this)},wrapAll:function(html){if(jQuery.isFunction(html))return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))});if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstChild&&1===elem.firstChild.nodeType;)elem=elem.firstChild;return elem}).append(this)}return this},wrapInner:function(html){return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){return this.each(function(){jQuery(this).wrapAll(html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(elem){1===this.nodeType&&this.appendChild(elem)})},prepend:function(){return this.domManip(arguments,!0,function(elem){1===this.nodeType&&this.insertBefore(elem,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(elem){this.parentNode.insertBefore(elem,this)});if(arguments.length){var set=jQuery(arguments[0]);return set.push.apply(set,this.toArray()),this.pushStack(set,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)});if(arguments.length){var set=this.pushStack(this,"after",arguments);return set.push.apply(set,jQuery(arguments[0]).toArray()),set}},remove:function(selector,keepData){for(var elem,i=0;null!=(elem=this[i]);i++)selector&&!jQuery.filter(selector,[elem]).length||(keepData||1!==elem.nodeType||(jQuery.cleanData(elem.getElementsByTagName("*")),jQuery.cleanData([elem])),elem.parentNode&&elem.parentNode.removeChild(elem));return this},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)for(1===elem.nodeType&&jQuery.cleanData(elem.getElementsByTagName("*"));elem.firstChild;)elem.removeChild(elem.firstChild);return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null!=dataAndEvents&&dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){if(value===undefined)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(rinlinejQuery,""):null;if("string"!=typeof value||rnocache.test(value)||!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(value)||wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()])jQuery.isFunction(value)?this.each(function(i){var self=jQuery(this);self.html(value.call(this,i,self.html()))}):this.empty().append(value);else{value=value.replace(rxhtmlTag,"<$1></$2>");try{for(var i=0,l=this.length;i<l;i++)1===this[i].nodeType&&(jQuery.cleanData(this[i].getElementsByTagName("*")),this[i].innerHTML=value)}catch(e){this.empty().append(value)}}return this},replaceWith:function(value){return this[0]&&this[0].parentNode?jQuery.isFunction(value)?this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old))}):("string"!=typeof value&&(value=jQuery(value).detach()),this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove(),next?jQuery(next).before(value):jQuery(parent).append(value)})):this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,table,callback){var results,first,fragment,parent,elem,value=args[0],scripts=[];if(!jQuery.support.checkClone&&3===arguments.length&&"string"==typeof value&&rchecked.test(value))return this.each(function(){jQuery(this).domManip(args,table,callback,!0)});if(jQuery.isFunction(value))return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined),self.domManip(args,table,callback)});if(this[0]){if(parent=value&&value.parentNode,first=1===(fragment=(results=jQuery.support.parentNode&&parent&&11===parent.nodeType&&parent.childNodes.length===this.length?{fragment:parent}:jQuery.buildFragment(args,this,scripts)).fragment).childNodes.length?fragment=fragment.firstChild:fragment.firstChild){table=table&&jQuery.nodeName(first,"tr");for(var i=0,l=this.length,lastIndex=l-1;i<l;i++)callback.call(table?(elem=this[i],jQuery.nodeName(elem,"table")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem):this[i],results.cacheable||1<l&&i<lastIndex?jQuery.clone(fragment,!0,!0):fragment)}scripts.length&&jQuery.each(scripts,evalScript)}return this}}),jQuery.buildFragment=function(args,nodes,scripts){var fragment,cacheable,cacheresults,doc;return nodes&&nodes[0]&&(doc=nodes[0].ownerDocument||nodes[0]),doc.createDocumentFragment||(doc=document),1===args.length&&"string"==typeof args[0]&&args[0].length<512&&doc===document&&"<"===args[0].charAt(0)&&!rnocache.test(args[0])&&(jQuery.support.checkClone||!rchecked.test(args[0]))&&(cacheable=!0,(cacheresults=jQuery.fragments[args[0]])&&1!==cacheresults&&(fragment=cacheresults)),fragment||(fragment=doc.createDocumentFragment(),jQuery.clean(args,doc,fragment,scripts)),cacheable&&(jQuery.fragments[args[0]]=cacheresults?fragment:1),{fragment:fragment,cacheable:cacheable}},jQuery.fragments={},jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var ret=[],insert=jQuery(selector),parent=1===this.length&&this[0].parentNode;if(parent&&11===parent.nodeType&&1===parent.childNodes.length&&1===insert.length)return insert[original](this[0]),this;for(var i=0,l=insert.length;i<l;i++){var elems=(0<i?this.clone(!0):this).get();jQuery(insert[i])[original](elems),ret=ret.concat(elems)}return this.pushStack(ret,name,insert.selector)}}),jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone=elem.cloneNode(!0);if(!(jQuery.support.noCloneEvent&&jQuery.support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(cloneFixAttributes(elem,clone),srcElements=getAll(elem),destElements=getAll(clone),i=0;srcElements[i];++i)cloneFixAttributes(srcElements[i],destElements[i]);if(dataAndEvents&&(cloneCopyEvent(elem,clone),deepDataAndEvents))for(srcElements=getAll(elem),destElements=getAll(clone),i=0;srcElements[i];++i)cloneCopyEvent(srcElements[i],destElements[i]);return srcElements=destElements=null,clone},clean:function(elems,context,fragment,scripts){var checkScriptType;void 0===(context=context||document).createElement&&(context=context.ownerDocument||context[0]&&context[0].ownerDocument||document);for(var j,elem,ret=[],i=0;null!=(elem=elems[i]);i++)if("number"==typeof elem&&(elem+=""),elem){if("string"==typeof elem)if(rhtml.test(elem)){elem=elem.replace(rxhtmlTag,"<$1></$2>");var tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,depth=wrap[0],div=context.createElement("div");for(div.innerHTML=wrap[1]+elem+wrap[2];depth--;)div=div.lastChild;if(!jQuery.support.tbody){var hasBody=rtbody.test(elem),tbody="table"!==tag||hasBody?"<table>"!==wrap[1]||hasBody?[]:div.childNodes:div.firstChild&&div.firstChild.childNodes;for(j=tbody.length-1;0<=j;--j)jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length&&tbody[j].parentNode.removeChild(tbody[j])}!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)&&div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild),elem=div.childNodes}else elem=context.createTextNode(elem);var len;if(!jQuery.support.appendChecked)if(elem[0]&&"number"==typeof(len=elem.length))for(j=0;j<len;j++)findInputs(elem[j]);else findInputs(elem);elem.nodeType?ret.push(elem):ret=jQuery.merge(ret,elem)}if(fragment)for(checkScriptType=function(elem){return!elem.type||rscriptType.test(elem.type)},i=0;ret[i];i++)if(!scripts||!jQuery.nodeName(ret[i],"script")||ret[i].type&&"text/javascript"!==ret[i].type.toLowerCase()){if(1===ret[i].nodeType){var jsTags=jQuery.grep(ret[i].getElementsByTagName("script"),checkScriptType);ret.splice.apply(ret,[i+1,0].concat(jsTags))}fragment.appendChild(ret[i])}else scripts.push(ret[i].parentNode?ret[i].parentNode.removeChild(ret[i]):ret[i]);return ret},cleanData:function(elems){for(var data,id,elem,cache=jQuery.cache,internalKey=jQuery.expando,special=jQuery.event.special,deleteExpando=jQuery.support.deleteExpando,i=0;null!=(elem=elems[i]);i++)if((!elem.nodeName||!jQuery.noData[elem.nodeName.toLowerCase()])&&(id=elem[jQuery.expando])){if((data=cache[id]&&cache[id][internalKey])&&data.events){for(var type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);data.handle&&(data.handle.elem=null)}deleteExpando?delete elem[jQuery.expando]:elem.removeAttribute&&elem.removeAttribute(jQuery.expando),delete cache[id]}}});var curCSS,getComputedStyle,currentStyle,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rupper=/([A-Z]|^ms)/g,rnumpx=/^-?\d+(?:px)?$/i,rnum=/^-?\d/,rrelNum=/^[+\-]=/,rrelNumFilter=/[^+\-\.\de]+/g,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssWidth=["Left","Right"],cssHeight=["Top","Bottom"];function getWH(elem,name,extra){var val="width"===name?elem.offsetWidth:elem.offsetHeight,which="width"===name?cssWidth:cssHeight;return 0<val?"border"!==extra&&jQuery.each(which,function(){extra||(val-=parseFloat(jQuery.css(elem,"padding"+this))||0),"margin"===extra?val+=parseFloat(jQuery.css(elem,extra+this))||0:val-=parseFloat(jQuery.css(elem,"border"+this+"Width"))||0}):(((val=curCSS(elem,name,name))<0||null==val)&&(val=elem.style[name]||0),val=parseFloat(val)||0,extra&&jQuery.each(which,function(){val+=parseFloat(jQuery.css(elem,"padding"+this))||0,"padding"!==extra&&(val+=parseFloat(jQuery.css(elem,"border"+this+"Width"))||0),"margin"===extra&&(val+=parseFloat(jQuery.css(elem,extra+this))||0)})),val+"px"}jQuery.fn.css=function(name,value){return 2===arguments.length&&value===undefined?this:jQuery.access(this,name,value,!0,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)})},jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity","opacity");return""===ret?"1":ret}return elem.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,origName=jQuery.camelCase(name),style=elem.style,hooks=jQuery.cssHooks[origName];if(name=jQuery.cssProps[origName]||origName,value===undefined)return hooks&&"get"in hooks&&(ret=hooks.get(elem,!1,extra))!==undefined?ret:style[name];if(!("number"===(type=typeof value)&&isNaN(value)||null==value||("string"===type&&rrelNum.test(value)&&(value=+value.replace(rrelNumFilter,"")+parseFloat(jQuery.css(elem,name)),type="number"),"number"!==type||jQuery.cssNumber[origName]||(value+="px"),hooks&&"set"in hooks&&(value=hooks.set(elem,value))===undefined)))try{style[name]=value}catch(e){}}},css:function(elem,name,extra){var ret,hooks;return name=jQuery.camelCase(name),hooks=jQuery.cssHooks[name],"cssFloat"===(name=jQuery.cssProps[name]||name)&&(name="float"),hooks&&"get"in hooks&&(ret=hooks.get(elem,!0,extra))!==undefined?ret:curCSS?curCSS(elem,name):void 0},swap:function(elem,options,callback){var old={};for(var name in options)old[name]=elem.style[name],elem.style[name]=options[name];for(name in callback.call(elem),options)elem.style[name]=old[name]}}),jQuery.curCSS=jQuery.css,jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){var val;if(computed)return 0!==elem.offsetWidth?getWH(elem,name,extra):(jQuery.swap(elem,cssShow,function(){val=getWH(elem,name,extra)}),val)},set:function(elem,value){return rnumpx.test(value)?0<=(value=parseFloat(value))?value+"px":void 0:value}}}),jQuery.support.opacity||(jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?parseFloat(RegExp.$1)/100+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle;style.zoom=1;var opacity=jQuery.isNaN(value)?"":"alpha(opacity="+100*value+")",filter=currentStyle&&currentStyle.filter||style.filter||"";style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(elem,computed){var ret;return jQuery.swap(elem,{display:"inline-block"},function(){ret=computed?curCSS(elem,"margin-right","marginRight"):elem.style.marginRight}),ret}})}),document.defaultView&&document.defaultView.getComputedStyle&&(getComputedStyle=function(elem,name){var ret,defaultView,computedStyle;return name=name.replace(rupper,"-$1").toLowerCase(),(defaultView=elem.ownerDocument.defaultView)?((computedStyle=defaultView.getComputedStyle(elem,null))&&(""!==(ret=computedStyle.getPropertyValue(name))||jQuery.contains(elem.ownerDocument.documentElement,elem)||(ret=jQuery.style(elem,name))),ret):undefined}),document.documentElement.currentStyle&&(currentStyle=function(elem,name){var left,ret=elem.currentStyle&&elem.currentStyle[name],rsLeft=elem.runtimeStyle&&elem.runtimeStyle[name],style=elem.style;return!rnumpx.test(ret)&&rnum.test(ret)&&(left=style.left,rsLeft&&(elem.runtimeStyle.left=elem.currentStyle.left),style.left="fontSize"===name?"1em":ret||0,ret=style.pixelLeft+"px",style.left=left,rsLeft&&(elem.runtimeStyle.left=rsLeft)),""===ret?"auto":ret}),curCSS=getComputedStyle||currentStyle,jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(elem){var width=elem.offsetWidth,height=elem.offsetHeight;return 0===width&&0===height||!jQuery.support.reliableHiddenOffsets&&"none"===(elem.style.display||jQuery.css(elem,"display"))},jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)});var ajaxLocation,ajaxLocParts,r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rinput=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rselectTextarea=/^(?:select|textarea)/i,rspacesAjax=/\s+/,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,_load=jQuery.fn.load,prefilters={},transports={};try{ajaxLocation=location.href}catch(e){(ajaxLocation=document.createElement("a")).href="",ajaxLocation=ajaxLocation.href}function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if("string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*"),jQuery.isFunction(func))for(var dataType,placeBefore,dataTypes=dataTypeExpression.toLowerCase().split(rspacesAjax),i=0,length=dataTypes.length;i<length;i++)dataType=dataTypes[i],(placeBefore=/^\+/.test(dataType))&&(dataType=dataType.substr(1)||"*"),(structure[dataType]=structure[dataType]||[])[placeBefore?"unshift":"push"](func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){(inspected=inspected||{})[dataType=dataType||options.dataTypes[0]]=!0;for(var selection,list=structure[dataType],i=0,length=list?list.length:0,executeOnly=structure===prefilters;i<length&&(executeOnly||!selection);i++)"string"==typeof(selection=list[i](options,originalOptions,jqXHR))&&(selection=!executeOnly||inspected[selection]?undefined:(options.dataTypes.unshift(selection),inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected)));return!executeOnly&&selection||inspected["*"]||(selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected)),selection}function buildParams(prefix,obj,traditional,add){if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v||jQuery.isArray(v)?i:"")+"]",v,traditional,add)});else if(traditional||null==obj||"object"!=typeof obj)add(prefix,obj);else for(var name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.extend({load:function(url,params,callback){if("string"!=typeof url&&_load)return _load.apply(this,arguments);if(!this.length)return this;var off=url.indexOf(" ");if(0<=off){var selector=url.slice(off,url.length);url=url.slice(0,off)}var type="GET";params&&(jQuery.isFunction(params)?(callback=params,params=undefined):"object"==typeof params&&(params=jQuery.param(params,jQuery.ajaxSettings.traditional),type="POST"));var self=this;return jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status,responseText){responseText=jqXHR.responseText,jqXHR.isResolved()&&(jqXHR.done(function(r){responseText=r}),self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText)),callback&&self.each(callback,[responseText,status,jqXHR])}}),this},serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.bind(o,f)}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=undefined),jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type})}}),jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},ajaxSetup:function(target,settings){for(var field in settings?jQuery.extend(!0,target,jQuery.ajaxSettings,settings):(settings=target,target=jQuery.extend(!0,jQuery.ajaxSettings,settings)),{context:1,url:1})field in settings?target[field]=settings[field]:field in jQuery.ajaxSettings&&(target[field]=jQuery.ajaxSettings[field]);return target},ajaxSettings:{url:ajaxLocation,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(ajaxLocParts[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){"object"==typeof url&&(options=url,url=undefined),options=options||{};var ifModifiedKey,responseHeadersString,responseHeaders,transport,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery._Deferred(),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value}return this},getAllResponseHeaders:function(){return 2===state?responseHeadersString:null},getResponseHeader:function(key){var match;if(2===state){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return match===undefined?null:match},overrideMimeType:function(type){return state||(s.mimeType=type),this},abort:function(statusText){return statusText=statusText||"abort",transport&&transport.abort(statusText),done(0,statusText),this}};function done(status,statusText,responses,headers){if(2!==state){state=2,timeoutTimer&&clearTimeout(timeoutTimer),transport=undefined,responseHeadersString=headers||"",jqXHR.readyState=status?4:0;var isSuccess,success,error,lastModified,etag,response=responses?function(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields;for(type in responseFields)type in responses&&(jqXHR[responseFields[type]]=responses[type]);for(;"*"===dataTypes[0];)dataTypes.shift(),ct===undefined&&(ct=s.mimeType||jqXHR.getResponseHeader("content-type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType=firstDataType||type}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}(s,jqXHR,responses):undefined;if(200<=status&&status<300||304===status)if(s.ifModified&&((lastModified=jqXHR.getResponseHeader("Last-Modified"))&&(jQuery.lastModified[ifModifiedKey]=lastModified),(etag=jqXHR.getResponseHeader("Etag"))&&(jQuery.etag[ifModifiedKey]=etag)),304===status)statusText="notmodified",isSuccess=!0;else try{success=function(s,response){s.dataFilter&&(response=s.dataFilter(response,s.dataType));var i,key,tmp,prev,conversion,conv,conv1,conv2,dataTypes=s.dataTypes,converters={},length=dataTypes.length,current=dataTypes[0];for(i=1;i<length;i++){if(1===i)for(key in s.converters)"string"==typeof key&&(converters[key.toLowerCase()]=s.converters[key]);if(prev=current,"*"===(current=dataTypes[i]))current=prev;else if("*"!==prev&&prev!==current){if(!(conv=converters[conversion=prev+" "+current]||converters["* "+current]))for(conv1 in conv2=undefined,converters)if(((tmp=conv1.split(" "))[0]===prev||"*"===tmp[0])&&(conv2=converters[tmp[1]+" "+current])){!0===(conv1=converters[conv1])?conv=conv2:!0===conv2&&(conv=conv1);break}conv||conv2||jQuery.error("No conversion from "+conversion.replace(" "," to ")),!0!==conv&&(response=conv?conv(response):conv2(conv1(response)))}}return response}(s,response),statusText="success",isSuccess=!0}catch(e){statusText="parsererror",error=e}else(error=statusText)&&!status||(statusText="error",status<0&&(status=0));jqXHR.status=status,jqXHR.statusText=statusText,isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=undefined,fireGlobals&&globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error]),completeDeferred.resolveWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}}if(deferred.promise(jqXHR),jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,jqXHR.complete=completeDeferred.done,jqXHR.statusCode=function(map){var tmp;if(map)if(state<2)for(tmp in map)statusCode[tmp]=[statusCode[tmp],map[tmp]];else tmp=map[jqXHR.status],jqXHR.then(tmp,tmp);return this},s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(rspacesAjax),null==s.crossDomain&&(parts=rurl.exec(s.url.toLowerCase()),s.crossDomain=!(!parts||parts[1]==ajaxLocParts[1]&&parts[2]==ajaxLocParts[2]&&(parts[3]||("http:"===parts[1]?80:443))==(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?80:443)))),s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),2===state)return!1;if(fireGlobals=s.global,s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),fireGlobals&&0==jQuery.active++&&jQuery.event.trigger("ajaxStart"),!s.hasContent&&(s.data&&(s.url+=(rquery.test(s.url)?"&":"?")+s.data),ifModifiedKey=s.url,!1===s.cache)){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+(ret===s.url?(rquery.test(s.url)?"&":"?")+"_="+ts:"")}for(i in(s.data&&s.hasContent&&!1!==s.contentType||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),s.ifModified&&(ifModifiedKey=ifModifiedKey||s.url,jQuery.lastModified[ifModifiedKey]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey]),jQuery.etag[ifModifiedKey]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey])),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", */*; q=0.01":""):s.accepts["*"]),s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(!1===s.beforeSend.call(callbackContext,jqXHR,s)||2===state))return jqXHR.abort(),!1;for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);if(transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),s.async&&0<s.timeout&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){status<2?done(-1,e):jQuery.error(e)}}else done(-1,"No Transport");return jqXHR},param:function(a,traditional){function add(key,value){value=jQuery.isFunction(value)?value():value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)}var s=[];if(traditional===undefined&&(traditional=jQuery.ajaxSettings.traditional),jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(var prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")}}),jQuery.extend({active:0,lastModified:{},etag:{}});var jsc=jQuery.now(),jsre=/(\=)\?(&|$)|\?\?/i;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return jQuery.expando+"_"+jsc++}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var inspectData="application/x-www-form-urlencoded"===s.contentType&&"string"==typeof s.data;if("jsonp"===s.dataTypes[0]||!1!==s.jsonp&&(jsre.test(s.url)||inspectData&&jsre.test(s.data))){var responseContainer,jsonpCallback=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,previous=window[jsonpCallback],url=s.url,data=s.data,replace="$1"+jsonpCallback+"$2";return!1!==s.jsonp&&(url=url.replace(jsre,replace),s.url===url&&(inspectData&&(data=data.replace(jsre,replace)),s.data===data&&(url+=(/\?/.test(url)?"&":"?")+s.jsonp+"="+jsonpCallback))),s.url=url,s.data=data,window[jsonpCallback]=function(response){responseContainer=[response]},jqXHR.always(function(){window[jsonpCallback]=previous,responseContainer&&jQuery.isFunction(previous)&&window[jsonpCallback](responseContainer[0])}),s.converters["script json"]=function(){return responseContainer||jQuery.error(jsonpCallback+" was not called"),responseContainer[0]},s.dataTypes[0]="json","script"}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){s.cache===undefined&&(s.cache=!1),s.crossDomain&&(s.type="GET",s.global=!1)}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){(script=document.createElement("script")).async="async",s.scriptCharset&&(script.charset=s.scriptCharset),script.src=s.url,script.onload=script.onreadystatechange=function(_,isAbort){!isAbort&&script.readyState&&!/loaded|complete/.test(script.readyState)||(script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script),script=undefined,isAbort||callback(200,"success"))},head.insertBefore(script,head.firstChild)},abort:function(){script&&script.onload(0,1)}}}});var xhrCallbacks,xhr,xhrOnUnloadAbort=!!window.ActiveXObject&&function(){for(var key in xhrCallbacks)xhrCallbacks[key](0,1)},xhrId=0;function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:createStandardXHR,xhr=jQuery.ajaxSettings.xhr(),jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&"withCredentials"in xhr}),jQuery.support.ajax&&jQuery.ajaxTransport(function(s){var callback;if(!s.crossDomain||jQuery.support.cors)return{send:function(headers,complete){var handle,i,xhr=s.xhr();if(s.username?xhr.open(s.type,s.url,s.async,s.username,s.password):xhr.open(s.type,s.url,s.async),s.xhrFields)for(i in s.xhrFields)xhr[i]=s.xhrFields[i];s.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(s.mimeType),s.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest");try{for(i in headers)xhr.setRequestHeader(i,headers[i])}catch(_){}xhr.send(s.hasContent&&s.data||null),callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||4===xhr.readyState))if(callback=undefined,handle&&(xhr.onreadystatechange=jQuery.noop,xhrOnUnloadAbort&&delete xhrCallbacks[handle]),isAbort)4!==xhr.readyState&&xhr.abort();else{status=xhr.status,responseHeaders=xhr.getAllResponseHeaders(),responses={},(xml=xhr.responseXML)&&xml.documentElement&&(responses.xml=xml),responses.text=xhr.responseText;try{statusText=xhr.statusText}catch(e){statusText=""}status||!s.isLocal||s.crossDomain?1223===status&&(status=204):status=responses.text?200:404}}catch(firefoxAccessException){isAbort||complete(-1,firefoxAccessException)}responses&&complete(status,statusText,responses,responseHeaders)},s.async&&4!==xhr.readyState?(handle=++xhrId,xhrOnUnloadAbort&&(xhrCallbacks||(xhrCallbacks={},jQuery(window).unload(xhrOnUnloadAbort)),xhrCallbacks[handle]=callback),xhr.onreadystatechange=callback):callback()},abort:function(){callback&&callback(0,1)}}});var iframe,iframeDoc,timerId,fxNow,elemdisplay={},rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,fxAttrs=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame;function createFxNow(){return setTimeout(clearFxNow,0),fxNow=jQuery.now()}function clearFxNow(){fxNow=undefined}function genFx(type,num){var obj={};return jQuery.each(fxAttrs.concat.apply([],fxAttrs.slice(0,num)),function(){obj[this]=type}),obj}function defaultDisplay(nodeName){if(!elemdisplay[nodeName]){var body=document.body,elem=jQuery("<"+nodeName+">").appendTo(body),display=elem.css("display");elem.remove(),"none"!==display&&""!==display||(iframe||((iframe=document.createElement("iframe")).frameBorder=iframe.width=iframe.height=0),body.appendChild(iframe),iframeDoc&&iframe.createElement||((iframeDoc=(iframe.contentWindow||iframe.contentDocument).document).write(("CSS1Compat"===document.compatMode?"<!doctype html>":"")+"<html><body>"),iframeDoc.close()),elem=iframeDoc.createElement(nodeName),iframeDoc.body.appendChild(elem),display=jQuery.css(elem,"display"),body.removeChild(iframe)),elemdisplay[nodeName]=display}return elemdisplay[nodeName]}jQuery.fn.extend({show:function(speed,easing,callback){var elem,display;if(speed||0===speed)return this.animate(genFx("show",3),speed,easing,callback);for(var i=0,j=this.length;i<j;i++)(elem=this[i]).style&&(display=elem.style.display,jQuery._data(elem,"olddisplay")||"none"!==display||(display=elem.style.display=""),""===display&&"none"===jQuery.css(elem,"display")&&jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName)));for(i=0;i<j;i++)(elem=this[i]).style&&(""!==(display=elem.style.display)&&"none"!==display||(elem.style.display=jQuery._data(elem,"olddisplay")||""));return this},hide:function(speed,easing,callback){if(speed||0===speed)return this.animate(genFx("hide",3),speed,easing,callback);for(var i=0,j=this.length;i<j;i++)if(this[i].style){var display=jQuery.css(this[i],"display");"none"===display||jQuery._data(this[i],"olddisplay")||jQuery._data(this[i],"olddisplay",display)}for(i=0;i<j;i++)this[i].style&&(this[i].style.display="none");return this},_toggle:jQuery.fn.toggle,toggle:function(fn,fn2,callback){var bool="boolean"==typeof fn;return jQuery.isFunction(fn)&&jQuery.isFunction(fn2)?this._toggle.apply(this,arguments):null==fn||bool?this.each(function(){var state=bool?fn:jQuery(this).is(":hidden");jQuery(this)[state?"show":"hide"]()}):this.animate(genFx("toggle",3),fn,fn2,callback),this},fadeTo:function(speed,to,easing,callback){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var optall=jQuery.speed(speed,easing,callback);return jQuery.isEmptyObject(prop)?this.each(optall.complete,[!1]):(prop=jQuery.extend({},prop),this[!1===optall.queue?"each":"queue"](function(){!1===optall.queue&&jQuery._mark(this);var name,val,p,e,parts,start,end,unit,opt=jQuery.extend({},optall),isElement=1===this.nodeType,hidden=isElement&&jQuery(this).is(":hidden");for(p in opt.animatedProperties={},prop){if(p!==(name=jQuery.camelCase(p))&&(prop[name]=prop[p],delete prop[p]),val=prop[name],jQuery.isArray(val)?(opt.animatedProperties[name]=val[1],val=prop[name]=val[0]):opt.animatedProperties[name]=opt.specialEasing&&opt.specialEasing[name]||opt.easing||"swing","hide"===val&&hidden||"show"===val&&!hidden)return opt.complete.call(this);!isElement||"height"!==name&&"width"!==name||(opt.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===jQuery.css(this,"display")&&"none"===jQuery.css(this,"float")&&(!jQuery.support.inlineBlockNeedsLayout||"inline"===defaultDisplay(this.nodeName)?this.style.display="inline-block":(this.style.display="inline",this.style.zoom=1)))}for(p in null!=opt.overflow&&(this.style.overflow="hidden"),prop)e=new jQuery.fx(this,opt,p),val=prop[p],rfxtypes.test(val)?e["toggle"===val?hidden?"show":"hide":val]():(parts=rfxnum.exec(val),start=e.cur(),parts?(end=parseFloat(parts[2]),"px"!==(unit=parts[3]||(jQuery.cssNumber[p]?"":"px"))&&(jQuery.style(this,p,(end||1)+unit),start=(end||1)/e.cur()*start,jQuery.style(this,p,start+unit)),parts[1]&&(end=("-="===parts[1]?-1:1)*end+start),e.custom(start,end,unit)):e.custom(start,val,""));return!0}))},stop:function(clearQueue,gotoEnd){return clearQueue&&this.queue([]),this.each(function(){var timers=jQuery.timers,i=timers.length;for(gotoEnd||jQuery._unmark(!0,this);i--;)timers[i].elem===this&&(gotoEnd&&timers[i](!0),timers.splice(i,1))}),gotoEnd||this.dequeue(),this}}),jQuery.each({slideDown:genFx("show",1),slideUp:genFx("hide",1),slideToggle:genFx("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.extend({speed:function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};return opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default,opt.old=opt.complete,opt.complete=function(noUnmark){jQuery.isFunction(opt.old)&&opt.old.call(this),!1!==opt.queue?jQuery.dequeue(this):!1!==noUnmark&&jQuery._unmark(this)},opt},easing:{linear:function(p,n,firstNum,diff){return firstNum+diff*p},swing:function(p,n,firstNum,diff){return(-Math.cos(p*Math.PI)/2+.5)*diff+firstNum}},timers:[],fx:function(elem,options,prop){this.options=options,this.elem=elem,this.prop=prop,options.orig=options.orig||{}}}),jQuery.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(jQuery.fx.step[this.prop]||jQuery.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var parsed,r=jQuery.css(this.elem,this.prop);return isNaN(parsed=parseFloat(r))?r&&"auto"!==r?r:0:parsed},custom:function(from,to,unit){var raf,self=this,fx=jQuery.fx;function t(gotoEnd){return self.step(gotoEnd)}this.startTime=fxNow||createFxNow(),this.start=from,this.end=to,this.unit=unit||this.unit||(jQuery.cssNumber[this.prop]?"":"px"),this.now=this.start,this.pos=this.state=0,t.elem=this.elem,t()&&jQuery.timers.push(t)&&!timerId&&(requestAnimationFrame?(timerId=!0,raf=function(){timerId&&(requestAnimationFrame(raf),fx.tick())},requestAnimationFrame(raf)):timerId=setInterval(fx.tick,fx.interval))},show:function(){this.options.orig[this.prop]=jQuery.style(this.elem,this.prop),this.options.show=!0,this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),jQuery(this.elem).show()},hide:function(){this.options.orig[this.prop]=jQuery.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(gotoEnd){var i,n,t=fxNow||createFxNow(),done=!0,elem=this.elem,options=this.options;if(gotoEnd||t>=options.duration+this.startTime){for(i in this.now=this.end,this.pos=this.state=1,this.update(),options.animatedProperties[this.prop]=!0,options.animatedProperties)!0!==options.animatedProperties[i]&&(done=!1);if(done){if(null==options.overflow||jQuery.support.shrinkWrapBlocks||jQuery.each(["","X","Y"],function(index,value){elem.style["overflow"+value]=options.overflow[index]}),options.hide&&jQuery(elem).hide(),options.hide||options.show)for(var p in options.animatedProperties)jQuery.style(elem,p,options.orig[p]);options.complete.call(elem)}return!1}return options.duration==1/0?this.now=t:(n=t-this.startTime,this.state=n/options.duration,this.pos=jQuery.easing[options.animatedProperties[this.prop]](this.state,n,0,1,options.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},jQuery.extend(jQuery.fx,{tick:function(){for(var timers=jQuery.timers,i=0;i<timers.length;++i)timers[i]()||timers.splice(i--,1);timers.length||jQuery.fx.stop()},interval:13,stop:function(){clearInterval(timerId),timerId=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(fx){jQuery.style(fx.elem,"opacity",fx.now)},_default:function(fx){fx.elem.style&&null!=fx.elem.style[fx.prop]?fx.elem.style[fx.prop]=("width"===fx.prop||"height"===fx.prop?Math.max(0,fx.now):fx.now)+fx.unit:fx.elem[fx.prop]=fx.now}}}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length});var rtable=/^t(?:able|d|h)$/i,rroot=/^(?:body|html)$/i;function getWindow(elem){return jQuery.isWindow(elem)?elem:9===elem.nodeType&&(elem.defaultView||elem.parentWindow)}"getBoundingClientRect"in document.documentElement?jQuery.fn.offset=function(options){var box,elem=this[0];if(options)return this.each(function(i){jQuery.offset.setOffset(this,options,i)});if(!elem||!elem.ownerDocument)return null;if(elem===elem.ownerDocument.body)return jQuery.offset.bodyOffset(elem);try{box=Siesta.Util.Role.Dom.meta.methods.getBoundingClientRect.value(elem)}catch(e){}var doc=elem.ownerDocument,docElem=doc.documentElement;if(!box||!jQuery.contains(docElem,elem))return box?{top:box.top,left:box.left}:{top:0,left:0};var body=doc.body,win=getWindow(doc),clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||jQuery.support.boxModel&&docElem.scrollTop||body.scrollTop,scrollLeft=win.pageXOffset||jQuery.support.boxModel&&docElem.scrollLeft||body.scrollLeft;return{top:Math.floor(box.top)+scrollTop-clientTop,left:Math.floor(box.left)+scrollLeft-clientLeft}}:jQuery.fn.offset=function(options){var elem=this[0];if(options)return this.each(function(i){jQuery.offset.setOffset(this,options,i)});if(!elem||!elem.ownerDocument)return null;if(elem===elem.ownerDocument.body)return jQuery.offset.bodyOffset(elem);jQuery.offset.initialize();for(var computedStyle,offsetParent=elem.offsetParent,doc=elem.ownerDocument,docElem=doc.documentElement,body=doc.body,defaultView=doc.defaultView,prevComputedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle,top=elem.offsetTop,left=elem.offsetLeft;(elem=elem.parentNode)&&elem!==body&&elem!==docElem&&(!jQuery.offset.supportsFixedPosition||"fixed"!==prevComputedStyle.position);)computedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle,top-=elem.scrollTop,left-=elem.scrollLeft,elem===offsetParent&&(top+=elem.offsetTop,left+=elem.offsetLeft,!jQuery.offset.doesNotAddBorder||jQuery.offset.doesAddBorderForTableAndCells&&rtable.test(elem.nodeName)||(top+=parseFloat(computedStyle.borderTopWidth)||0,left+=parseFloat(computedStyle.borderLeftWidth)||0),offsetParent=elem.offsetParent),jQuery.offset.subtractsBorderForOverflowNotVisible&&"visible"!==computedStyle.overflow&&(top+=parseFloat(computedStyle.borderTopWidth)||0,left+=parseFloat(computedStyle.borderLeftWidth)||0),prevComputedStyle=computedStyle;return"relative"!==prevComputedStyle.position&&"static"!==prevComputedStyle.position||(top+=body.offsetTop,left+=body.offsetLeft),jQuery.offset.supportsFixedPosition&&"fixed"===prevComputedStyle.position&&(top+=Math.max(docElem.scrollTop,body.scrollTop),left+=Math.max(docElem.scrollLeft,body.scrollLeft)),{top:top,left:left}},jQuery.offset={initialize:function(){var innerDiv,checkDiv,td,body=document.body,container=document.createElement("div"),bodyMarginTop=parseFloat(jQuery.css(body,"marginTop"))||0;jQuery.extend(container.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),container.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",body.insertBefore(container,body.firstChild),checkDiv=(innerDiv=container.firstChild).firstChild,td=innerDiv.nextSibling.firstChild.firstChild,this.doesNotAddBorder=5!==checkDiv.offsetTop,this.doesAddBorderForTableAndCells=5===td.offsetTop,checkDiv.style.position="fixed",checkDiv.style.top="20px",this.supportsFixedPosition=20===checkDiv.offsetTop||15===checkDiv.offsetTop,checkDiv.style.position=checkDiv.style.top="",innerDiv.style.overflow="hidden",innerDiv.style.position="relative",this.subtractsBorderForOverflowNotVisible=-5===checkDiv.offsetTop,this.doesNotIncludeMarginInBodyOffset=body.offsetTop!==bodyMarginTop,body.removeChild(container),jQuery.offset.initialize=jQuery.noop},bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;return jQuery.offset.initialize(),jQuery.offset.doesNotIncludeMarginInBodyOffset&&(top+=parseFloat(jQuery.css(body,"marginTop"))||0,left+=parseFloat(jQuery.css(body,"marginLeft"))||0),{top:top,left:left}},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");"static"===position&&(elem.style.position="relative");var curTop,curLeft,curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),props={},curPosition={};curLeft=("absolute"===position||"fixed"===position)&&-1<jQuery.inArray("auto",[curCSSTop,curCSSLeft])?(curTop=(curPosition=curElem.position()).top,curPosition.left):(curTop=parseFloat(curCSSTop)||0,parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset)),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({position:function(){if(!this[0])return null;var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();return offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0,offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0,parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0,parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0,{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent||document.body;offsetParent&&!rroot.test(offsetParent.nodeName)&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent})}}),jQuery.each(["Left","Top"],function(i,name){var method="scroll"+name;jQuery.fn[method]=function(val){var elem,win;return val===undefined?(elem=this[0])?(win=getWindow(elem))?win[i?"pageYOffset":"pageXOffset"]||jQuery.support.boxModel&&win.document.documentElement[method]||win.document.body[method]:elem[method]:null:this.each(function(){(win=getWindow(this))?win.scrollTo(i?jQuery(win).scrollLeft():val,i?val:jQuery(win).scrollTop()):this[method]=val})}}),jQuery.each(["Height","Width"],function(i,name){var type=name.toLowerCase();jQuery.fn["inner"+name]=function(){var elem=this[0];return elem&&elem.style?parseFloat(jQuery.css(elem,type,"padding")):null},jQuery.fn["outer"+name]=function(margin){var elem=this[0];return elem&&elem.style?parseFloat(jQuery.css(elem,type,margin?"margin":"border")):null},jQuery.fn[type]=function(size){var elem=this[0];if(!elem)return null==size?null:this;if(jQuery.isFunction(size))return this.each(function(i){var self=jQuery(this);self[type](size.call(this,i,self[type]()))});if(jQuery.isWindow(elem)){var docElemProp=elem.document.documentElement["client"+name];return"CSS1Compat"===elem.document.compatMode&&docElemProp||elem.document.body["client"+name]||docElemProp}if(9===elem.nodeType)return Math.max(elem.documentElement["client"+name],elem.body["scroll"+name],elem.documentElement["scroll"+name],elem.body["offset"+name],elem.documentElement["offset"+name]);if(size!==undefined)return this.css(type,"string"==typeof size?size:size+"px");var orig=jQuery.css(elem,type),ret=parseFloat(orig);return jQuery.isNaN(ret)?orig:ret}}),window.jQuery=window.$=jQuery,window.jQuery.siesta=!0,window.$.rebindWindowContext=function(win){return document=(window=win).document,rootjQuery=$(document),function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)}}}(window),jQuery.fn.center=function(){return this.css("position","absolute"),this.css("top",Math.max(0,($(window).height()-this.outerHeight())/2+$(window).scrollTop())+"px"),this.css("left",Math.max(0,($(window).width()-this.outerWidth())/2+$(window).scrollLeft())+"px"),this},function(window){function funescape(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(65536+high):String.fromCharCode(high>>10|55296,1023&high|56320)}function unloadHandler(){setDocument()}var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+ +new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;i<len;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,fcssescape=function(ch,asCodePoint){return asCodePoint?"\0"===ch?"�":ch.slice(0,-1)+"\\"+ch.charCodeAt(ch.length-1).toString(16)+" ":"\\"+ch},inDisabledFieldset=addCombinator(function(elem){return!0===elem.disabled&&"fieldset"===elem.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;if(results=results||[],"string"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,documentIsHTML)){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m)))return results;if(elem.id===m)return results.push(elem),results}else if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(1!==nodeType)newContext=context,newSelector=selector;else if("object"!==context.nodeName.toLowerCase()){for((nid=context.getAttribute("id"))?nid=nid.replace(rcssescape,fcssescape):context.setAttribute("id",nid=expando),i=(groups=tokenize(selector)).length;i--;)groups[i]="#"+nid+" "+toSelector(groups[i]);newSelector=groups.join(","),newContext=rsibling.test(selector)&&testContext(context.parentNode)||context}if(newSelector)try{if(!bowser.msie&&!bowser.msedge||!/:nth-of-type\(\d/i.test(newSelector))return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{nid===expando&&context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var el=document.createElement("fieldset");try{return!!fn(el)}catch(e){return!1}finally{el.parentNode&&el.parentNode.removeChild(el),el=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=arr.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createDisabledPseudo(disabled){return function(elem){return"form"in elem?elem.parentNode&&!1===elem.disabled?"label"in elem?"label"in elem.parentNode?elem.parentNode.disabled===disabled:elem.disabled===disabled:elem.isDisabled===disabled||elem.isDisabled!==!disabled&&inDisabledFieldset(elem)===disabled:elem.disabled===disabled:"label"in elem&&elem.disabled===disabled}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}for(i in support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,subWindow,doc=node?node.ownerDocument||node:preferredDoc;return doc!==document&&9===doc.nodeType&&doc.documentElement&&(docElem=(document=doc).documentElement,documentIsHTML=!isXML(document),preferredDoc!==document&&(subWindow=document.defaultView)&&subWindow.top!==subWindow&&(subWindow.addEventListener?subWindow.addEventListener("unload",unloadHandler,!1):subWindow.attachEvent&&subWindow.attachEvent("onunload",unloadHandler)),support.attributes=assert(function(el){return el.className="i",!el.getAttribute("className")}),support.getElementsByTagName=assert(function(el){return el.appendChild(document.createComment("")),!el.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(document.getElementsByClassName),support.getById=assert(function(el){return docElem.appendChild(el).id=expando,!document.getElementsByName||!document.getElementsByName(expando).length}),support.getById?(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var elem=context.getElementById(id);return elem?[elem]:[]}}):(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=void 0!==elem.getAttributeNode&&elem.getAttributeNode("id");return node&&node.value===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var node,i,elems,elem=context.getElementById(id);if(elem){if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem];for(elems=context.getElementsByName(id),i=0;elem=elems[i++];)if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem]}return[]}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return void 0!==context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"!==tag)return results;for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(void 0!==context.getElementsByClassName&&documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(document.querySelectorAll))&&(assert(function(el){docElem.appendChild(el).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>",el.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),el.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),el.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),el.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),el.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]")}),assert(function(el){el.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var input=document.createElement("input");input.setAttribute("type","hidden"),el.appendChild(input).setAttribute("name","D"),el.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),2!==el.querySelectorAll(":enabled").length&&rbuggyQSA.push(":enabled",":disabled"),docElem.appendChild(el).disabled=!0,2!==el.querySelectorAll(":disabled").length&&rbuggyQSA.push(":enabled",":disabled"),el.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(el){support.disconnectedMatch=matches.call(el,"*"),matches.call(el,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0}),document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return 0<Sizzle(expr,document,null,[elem]).length},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.escape=function(sel){return(sel+"").replace(rcssescape,fcssescape)},Sizzle.unescape=function(sel){return(sel+"").replace(runescape,funescape)},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&-1<result.indexOf(check):"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?-1<(" "+result.replace(rwhitespace," ")+" ").indexOf(check):"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!=forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=!1;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(diff=(nodeIndex=(cache=(uniqueCache=(outerCache=(node=parent)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1])&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(diff=nodeIndex=(cache=(uniqueCache=(outerCache=(node=elem)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1]),!1===diff)for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((uniqueCache=(outerCache=node[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&0<=diff/first}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):1<fn.length?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return 0<Sizzle(selector,elem).length}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return-1<(elem.textContent||elem.innerText||getText(elem)).indexOf(text)}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:createDisabledPseudo(!1),disabled:createDisabledPseudo(!0),checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;0<=--i;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,skip=combinator.next,key=skip||dir,checkNonElements=base&&"parentNode"===key,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml);return!1}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)if(uniqueCache=(outerCache=elem[expando]||(elem[expando]={}))[elem.uniqueID]||(outerCache[elem.uniqueID]={}),skip&&skip===elem.nodeName.toLowerCase())elem=elem[dir]||elem;else{if((oldCache=uniqueCache[key])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if((uniqueCache[key]=newCache)[2]=matcher(elem,context,xml))return!0}return!1}}function elementMatcher(matchers){return 1<matchers.length?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&-1<(temp=postFinder?indexOf(seed,elem):preMap[i])&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return-1<indexOf(checkContext,elem)},implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext:matchAnyContext)(elem,context,xml);return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(1<i&&elementMatcher(matchers),1<i&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){function superMatcher(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context===document||context||outermost);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0,context||elem.ownerDocument===document||(setDocument(elem),xml=!documentIsHTML);matcher=elementMatchers[j++];)if(matcher(elem,context||document,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(0<matchedCount)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&0<setMatched.length&&1<matchedCount+setMatchers.length&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched}var bySet=0<setMatchers.length,byElement=0<elementMatchers.length;return bySet?markFunction(superMatcher):superMatcher}setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(i=(match=match||tokenize(selector)).length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(2<(tokens=match[0]=match[0].slice(0)).length&&"ID"===(token=tokens[0]).type&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(el){return 1&el.compareDocumentPosition(document.createElement("fieldset"))}),assert(function(el){return el.innerHTML="<a href='#'></a>","#"===el.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(el){return el.innerHTML="<input/>",el.firstChild.setAttribute("value",""),""===el.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(el){return null==el.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null});var _sizzle=window.Sizzle;if(Sizzle.noConflict=function(){return window.Sizzle===Sizzle&&(window.Sizzle=_sizzle),Sizzle},"function"==typeof define&&define.amd?define(function(){return Sizzle}):"undefined"!=typeof module&&module.exports?module.exports=Sizzle:window.Sizzle=Sizzle,(window.Sizzle=Sizzle).siesta=!0,Sizzle.selectors.pseudos.textEquals=function(el,i,m){var searchText=Sizzle.unescape(m[3]);return Sizzle.getText([el]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")===searchText},window.jQuery&&window.jQuery.siesta){var oldExpr=jQuery.expr;jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.filters,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains,jQuery.expr.filters.hidden=oldExpr.filters.hidden,jQuery.expr.filters.visible=oldExpr.filters.visible}}(window),Siesta.Sizzle=Sizzle,Sizzle.noConflict(),Object.create&&function(root,factory){"use strict";"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?module.exports=factory():root.DeepDiff=factory()}(this,function(undefined){"use strict";var $scope,conflict,conflictResolution=[];function inherits(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}function Diff(kind,path){Object.defineProperty(this,"kind",{value:kind,enumerable:!0}),path&&path.length&&Object.defineProperty(this,"path",{value:path,enumerable:!0})}function DiffEdit(path,origin,value){DiffEdit.super_.call(this,"E",path),Object.defineProperty(this,"lhs",{value:origin,enumerable:!0}),Object.defineProperty(this,"rhs",{value:value,enumerable:!0})}function DiffNew(path,value){DiffNew.super_.call(this,"N",path),Object.defineProperty(this,"rhs",{value:value,enumerable:!0})}function DiffDeleted(path,value){DiffDeleted.super_.call(this,"D",path),Object.defineProperty(this,"lhs",{value:value,enumerable:!0})}function DiffArray(path,index,item){DiffArray.super_.call(this,"A",path),Object.defineProperty(this,"index",{value:index,enumerable:!0}),Object.defineProperty(this,"item",{value:item,enumerable:!0})}function arrayRemove(arr,from,to){var rest=arr.slice((to||from)+1||arr.length);return arr.length=from<0?arr.length+from:from,arr.push.apply(arr,rest),arr}function realTypeOf(subject){var type=typeof subject;return"object"!=type?type:subject===Math?"math":null===subject?"null":Array.isArray(subject)?"array":"[object Date]"===Object.prototype.toString.call(subject)?"date":/^\/.*\//.test(subject.toString())?"regexp":"object"}function deepDiff(lhs,rhs,changes,prefilter,path,key,stack){var currentPath=(path=path||[]).slice(0);if(void 0!==key){if(prefilter&&prefilter(currentPath,key,{lhs:lhs,rhs:rhs}))return;currentPath.push(key)}"regexp"===realTypeOf(lhs)&&"regexp"===realTypeOf(rhs)&&(lhs=lhs.toString(),rhs=rhs.toString());var ltype=typeof lhs,rtype=typeof rhs;if("undefined"==ltype)"undefined"!=rtype&&changes(new DiffNew(currentPath,rhs));else if("undefined"==rtype)changes(new DiffDeleted(currentPath,lhs));else if(realTypeOf(lhs)!==realTypeOf(rhs))changes(new DiffEdit(currentPath,lhs,rhs));else if("[object Date]"===Object.prototype.toString.call(lhs)&&"[object Date]"===Object.prototype.toString.call(rhs)&&lhs-rhs!=0)changes(new DiffEdit(currentPath,lhs,rhs));else if("object"==ltype&&null!==lhs&&null!==rhs&&lhs!==rhs){if((stack=stack||[]).indexOf(lhs)<0){if(stack.push(lhs),Array.isArray(lhs)){var i;lhs.length;for(i=0;i<lhs.length;i++)i>=rhs.length?changes(new DiffArray(currentPath,i,new DiffDeleted(undefined,lhs[i]))):deepDiff(lhs[i],rhs[i],changes,prefilter,currentPath,i,stack);for(;i<rhs.length;)changes(new DiffArray(currentPath,i,new DiffNew(undefined,rhs[i++])))}else{var akeys=Object.keys(lhs),pkeys=Object.keys(rhs);akeys.forEach(function(k,i){var other=pkeys.indexOf(k);0<=other?(deepDiff(lhs[k],rhs[k],changes,prefilter,currentPath,k,stack),pkeys=arrayRemove(pkeys,other)):changes(new DiffDeleted(currentPath,k))}),pkeys.forEach(function(k){changes(new DiffNew(currentPath,rhs[k]))})}stack.length=stack.length-1}}else lhs!==rhs&&("number"==ltype&&isNaN(lhs)&&isNaN(rhs)||changes(new DiffEdit(currentPath,lhs,rhs)))}function accumulateDiff(lhs,rhs,prefilter,accum){return accum=accum||[],deepDiff(lhs,rhs,function(diff){diff&&accum.push(diff)},prefilter),accum.length?accum:undefined}function applyChange(target,source,change){if(target&&source&&change&&change.kind){for(var it=target,i=-1,last=change.path?change.path.length-1:0;++i<last;)void 0===it[change.path[i]]&&(it[change.path[i]]="number"==typeof change.path[i]?[]:{}),it=it[change.path[i]];switch(change.kind){case"A":!function applyArrayChange(arr,index,change){if(change.path&&change.path.length){var i,it=arr[index],u=change.path.length-1;for(i=0;i<u;i++)it=it[change.path[i]];switch(change.kind){case"A":applyArrayChange(it[change.path[i]],change.index,change.item);break;case"D":delete it[change.path[i]];break;case"E":case"N":it[change.path[i]]=change.rhs}}else switch(change.kind){case"A":applyArrayChange(arr[index],change.index,change.item);break;case"D":arr=arrayRemove(arr,index);break;case"E":case"N":arr[index]=change.rhs}return arr}(change.path?it[change.path[i]]:it,change.index,change.item);break;case"D":delete it[change.path[i]];break;case"E":case"N":it[change.path[i]]=change.rhs}}}return $scope="object"==typeof global&&global?global:"undefined"!=typeof window?window:{},(conflict=$scope.DeepDiff)&&conflictResolution.push(function(){void 0!==conflict&&$scope.DeepDiff===accumulateDiff&&($scope.DeepDiff=conflict,conflict=undefined)}),inherits(DiffEdit,Diff),inherits(DiffNew,Diff),inherits(DiffDeleted,Diff),inherits(DiffArray,Diff),Object.defineProperties(accumulateDiff,{diff:{value:accumulateDiff,enumerable:!0},observableDiff:{value:deepDiff,enumerable:!0},applyDiff:{value:function(target,source,filter){if(target&&source){deepDiff(target,source,function(change){filter&&!filter(target,source,change)||applyChange(target,source,change)})}},enumerable:!0},applyChange:{value:applyChange,enumerable:!0},revertChange:{value:function(target,source,change){if(target&&source&&change&&change.kind){var i,u,it=target;for(u=change.path.length-1,i=0;i<u;i++)void 0===it[change.path[i]]&&(it[change.path[i]]={}),it=it[change.path[i]];switch(change.kind){case"A":!function revertArrayChange(arr,index,change){if(change.path&&change.path.length){var i,it=arr[index],u=change.path.length-1;for(i=0;i<u;i++)it=it[change.path[i]];switch(change.kind){case"A":revertArrayChange(it[change.path[i]],change.index,change.item);break;case"D":case"E":it[change.path[i]]=change.lhs;break;case"N":delete it[change.path[i]]}}else switch(change.kind){case"A":revertArrayChange(arr[index],change.index,change.item);break;case"D":case"E":arr[index]=change.lhs;break;case"N":arr=arrayRemove(arr,index)}return arr}(it[change.path[i]],change.index,change.item);break;case"D":case"E":it[change.path[i]]=change.lhs;break;case"N":delete it[change.path[i]]}}},enumerable:!0},isConflict:{value:function(){return void 0!==conflict},enumerable:!0},noConflict:{value:function(){return conflictResolution&&(conflictResolution.forEach(function(it){it()}),conflictResolution=null),accumulateDiff},enumerable:!0}}),accumulateDiff}),function(f){function d(h){var k,j=f(window),i=e.test(h[0].nodeName);return{border:i?{top:0,left:0,bottom:0,right:0}:function(k,j){j=j||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(k,null):k.currentStyle);var i=!(!document.defaultView||!document.defaultView.getComputedStyle),h={top:parseFloat(i?j.borderTopWidth:f.css(k,"borderTopWidth"))||0,left:parseFloat(i?j.borderLeftWidth:f.css(k,"borderLeftWidth"))||0,bottom:parseFloat(i?j.borderBottomWidth:f.css(k,"borderBottomWidth"))||0,right:parseFloat(i?j.borderRightWidth:f.css(k,"borderRightWidth"))||0};return{top:h.top,left:h.left,bottom:h.bottom,right:h.right,vertical:h.top+h.bottom,horizontal:h.left+h.right}}(h[0]),scroll:{top:(i?j:h).scrollTop(),left:(i?j:h).scrollLeft()},scrollbar:{right:i?0:h.innerWidth()-h[0].clientWidth,bottom:i?0:h.innerHeight()-h[0].clientHeight},rect:(k=h[0].getBoundingClientRect(),{top:i?0:k.top,left:i?0:k.left,bottom:i?h[0].clientHeight:k.bottom,right:i?h[0].clientWidth:k.right})}}var c={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}},b={duration:"fast",direction:"both"},e=/^(?:html)$/i;f.fn.extend({scrollintoview:function(j){(j=f.extend({},b,j)).direction=c["string"==typeof j.direction&&j.direction.toLowerCase()]||c.both;var n="";!0===j.direction.x&&(n="horizontal"),!0===j.direction.y&&(n=n?"both":"vertical");var l=this.eq(0),i=l.closest(":scrollable("+n+")");if(0<i.length){i=i.eq(0);var m_e=d(l),m_s=d(i),h={top:m_e.rect.top-(m_s.rect.top+m_s.border.top),bottom:m_s.rect.bottom-m_s.border.bottom-m_s.scrollbar.bottom-m_e.rect.bottom,left:m_e.rect.left-(m_s.rect.left+m_s.border.left),right:m_s.rect.right-m_s.border.right-m_s.scrollbar.right-m_e.rect.right},k={};!0===j.direction.y&&(h.top<0?k.scrollTop=m_s.scroll.top+h.top:0<h.top&&h.bottom<0&&(k.scrollTop=m_s.scroll.top+Math.min(h.top,-h.bottom))),!0===j.direction.x&&(h.left<0?k.scrollLeft=m_s.scroll.left+h.left:0<h.left&&h.right<0&&(k.scrollLeft=m_s.scroll.left+Math.min(h.left,-h.right))),f.isEmptyObject(k)?f.isFunction(j.complete)&&j.complete.call(i[0]):(e.test(i[0].nodeName)&&(i=f("html,body")),i.animate(k,j.duration).eq(0).queue(function(o){f.isFunction(j.complete)&&j.complete.call(i[0]),o()}))}return this}});var a={auto:!0,scroll:!0,visible:!1,hidden:!1};f.extend(f.expr[":"],{scrollable:function(k,i,n,h){var m=c["string"==typeof n[3]&&n[3].toLowerCase()]||c.both,l=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(k,null):k.currentStyle,o={x:a[l.overflowX.toLowerCase()]||!1,y:a[l.overflowY.toLowerCase()]||!1,isRoot:e.test(k.nodeName)};if(!o.x&&!o.y&&!o.isRoot)return!1;var j={height:{scroll:k.scrollHeight,client:k.clientHeight},width:{scroll:k.scrollWidth,client:k.clientWidth},scrollableX:function(){return(o.x||o.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(o.y||o.isRoot)&&this.height.scroll>this.height.client}};return m.y&&j.scrollableY()||m.x&&j.scrollableX()}})}(jQuery),"undefined"==typeof JooseX||JooseX.SimpleRequest||Class("JooseX.SimpleRequest",{have:{req:null},methods:{initialize:function(){window.XMLHttpRequest?this.req=new XMLHttpRequest:this.req=new ActiveXObject("Microsoft.XMLHTTP")},getText:function(urlOrOptions,async,callback,scope){var headers,url,req=this.req;"string"!=typeof urlOrOptions?(headers=urlOrOptions.headers,url=urlOrOptions.url,async=async||urlOrOptions.async,callback=callback||urlOrOptions.callback,scope=scope||urlOrOptions.scope):url=urlOrOptions,req.open("GET",url,async||!1),headers&&Joose.O.eachOwn(headers,function(value,name){req.setRequestHeader(name,value)});try{req.onreadystatechange=function(event){async&&4==req.readyState&&(200==req.status||0==req.status&&0<req.responseText.length?callback.call(scope||this,!0,req.responseText):callback.call(scope||this,!1,"File not found: "+url))},req.send(null)}catch(e){throw"File not found: "+url}if(async)return null;if(200==req.status||0==req.status&&0<req.responseText.length)return req.responseText;throw"File not found: "+url}}}),Role("Siesta.Util.Role.CanCalculatePageScroll",{methods:{getElForPageScroll:function(win){var doc=(win=win||this.global).document;return doc.scrollingElement||(bowser.webkit||bowser.blink||bowser.msedge?doc.body:doc.documentElement)},getPageScrollX:function(win){(win=win||this.global).document;if(null!=window.pageXOffset)return win.pageXOffset;var scrollEl=this.getElForPageScroll();return scrollEl?scrollEl.scrollLeft:0},getPageScrollY:function(win){(win=win||this.global).document;if(null!=window.pageYOffset)return win.pageYOffset;var scrollEl=this.getElForPageScroll();return scrollEl?scrollEl.scrollTop:0},viewportXtoPageX:function(x,win){var docEl=(win=win||this.global).document.documentElement;return x+this.getPageScrollX(win)-docEl.clientLeft},viewportYtoPageY:function(y,win){var docEl=(win=win||this.global).document.documentElement;return y+this.getPageScrollY(win)-docEl.clientTop},pageXtoViewportX:function(x,win){var docEl=(win=win||this.global).document.documentElement;return x-this.getPageScrollX(win)+docEl.clientLeft},pageYtoViewportY:function(y,win){var docEl=(win=win||this.global).document.documentElement;return y-this.getPageScrollY(win)+docEl.clientTop},maintainScrollPositionDuring:function(func,scope){var parent=window.parent,isEmbedded=Boolean(parent),scrollLeftBefore=isEmbedded&&this.getPageScrollX(parent),scrollTopBefore=isEmbedded&&this.getPageScrollY(parent);if(func.call(scope||this),isEmbedded){var scrollEl=this.getElForPageScroll(parent);scrollLeftBefore!==this.getPageScrollX(parent)&&(scrollEl.scrollLeft=scrollLeftBefore),scrollTopBefore!==this.getPageScrollY(parent)&&(scrollEl.scrollTop=scrollTopBefore)}}}}),Role("Siesta.Util.Role.CanInstallCQRootPseudo",{methods:{installRootPseudoCQ:function(Ext){if(Ext){var CQ=Ext.ComponentQuery;if(CQ){var pseudos=CQ.pseudos;if(!pseudos.root||!pseudos.root.__IS_ROOT_PSEUDO_OVERRIDE__){function rootPseudo(items,value){var c,i=0,l=items.length,result=[],findAllRoots=void 0===value;for(findAllRoots||(value=Number(value)-1);i<l;i++){(c=items[i].up())&&c.contains&&c.contains(items[i])||result.push(items[i])}return findAllRoots||(result=result[value]?[result[value]]:[]),result}rootPseudo.__IS_ROOT_PSEUDO_OVERRIDE__=!0,pseudos.root=rootPseudo}pseudos["ariadne-nth-child"]||(pseudos["ariadne-nth-child"]=function(items,selector){for(var result=[],pos=Number(selector)-1,len=items.length,i=0;i<len;i++){var cmp=items[i],parentCt=cmp.getRefOwner&&cmp.getRefOwner()||cmp.ownerCt,parentCtItems=parentCt&&parentCt.items;if(parentCtItems&&parentCtItems.getCount)if(pos<parentCtItems.getCount())parentCtItems.getAt(pos)===cmp&&result.push(cmp);else parentCt.getRefItems()[pos]===cmp&&result.push(cmp)}return result});var version=Ext.getVersion&&Ext.getVersion("ext");if(version&&4==version.major&&!CQ.__CQ4_PATCHED__){Ext.dom.Query.operators["="]=function(a,b){return a==Siesta.Sizzle.unescape(b)};var prevQuery=CQ.query;CQ.query=function(query,root){return/\\,/.test(query)?prevQuery.call(this,{split:function(){return[query]}},root):prevQuery.call(this,query,root)},CQ.__CQ4_PATCHED__=!0}}}}}}),Role("Siesta.Test.Browser.Role.CanGetElementFromPoint",{requires:["$"],does:[Siesta.Util.Role.CanCalculatePageScroll],has:{},methods:{elementFromPoint:function(viewportX,viewportY,shallow,fallbackEl,fullInfo){var document=this.global.document,el=document.elementFromPoint(viewportX,viewportY),localX=viewportX,localY=viewportY;if((el=(el=el||document.elementFromPoint(viewportX,viewportY))||fallbackEl||document.body)&&"IFRAME"==el.nodeName.toUpperCase()&&!shallow)try{var iframeDoc=el.contentWindow.document,offsetsToTop=this.$(el).offset();localX=viewportX-this.pageXtoViewportX(offsetsToTop.left),localY=viewportY-this.pageYtoViewportY(offsetsToTop.top);var resolvedEl=iframeDoc.elementFromPoint(localX,localY);"HTML"===(resolvedEl=(resolvedEl=resolvedEl||iframeDoc.elementFromPoint(localX,localY))||iframeDoc.body).nodeName.toUpperCase()&&(resolvedEl=iframeDoc.body),el=resolvedEl}catch(e){localX=viewportX,localY=viewportY}return fullInfo?{el:el,localXY:[localX,localY],globalXY:[viewportX,viewportY]}:el}}}),Role("Siesta.Test.Browser.Role.CanWorkWithKeyboard",{has:{},methods:{isTextInput:function(node){var name=node.nodeName&&node.nodeName.toLowerCase();if("textarea"===name)return!0;if("input"!==name)return!1;var type=String(node.type).toLowerCase();return"password"===type||"number"===type||"search"===type||"text"===type||"url"===type||"tel"===type||"month"===type||"time"===type||"date"===type||"datetime"===type||"week"===type||"email"===type},isEditableNode:function(node){return"on"===node.ownerDocument.designMode.toLowerCase()||node.isContentEditable},isReadableKey:function(keyCode){var KC=Siesta.Test.UserAgent.KeyCodes();return!KC.isNav(keyCode)&&!KC.isSpecial(keyCode)},activeElement:function(notAllowBody,fallbackEl,elOrDoc){var doc=elOrDoc?elOrDoc.ownerDocument||elOrDoc:this.global.document,focusedEl=doc.activeElement;if(focusedEl&&focusedEl.nodeName&&focusedEl.tagName&&(focusedEl!==doc.body||!notAllowBody)||(focusedEl=fallbackEl),focusedEl&&"iframe"==String(focusedEl.tagName).toLowerCase())try{focusedEl.contentDocument&&focusedEl.contentDocument.body&&(focusedEl=this.activeElement(notAllowBody,fallbackEl,focusedEl.contentDocument))}catch(e){}return focusedEl||doc.body}}}),Role("Siesta.Test.Browser.Role.CanRebindJQueryContext",{methods:{$:function(){return $.rebindWindowContext(this.global).apply(this.global,arguments)}}}),Role("Siesta.Util.Role.Dom",{does:[Siesta.Util.Role.CanCalculatePageScroll],has:{doesNotIncludeMarginInBodyOffset:!1},methods:{isCrossOriginWindow:function(win){try{var doc=win.document}catch(e){return!0}return!doc},closest:function(elem,selector,maxLevels){maxLevels=maxLevels||Number.MAX_VALUE;for(var docEl=elem.ownerDocument.documentElement,i=0;i<maxLevels&&elem&&elem!==docEl;elem=elem.parentNode){if(Siesta.Sizzle.matchesSelector(elem,selector))return elem;i++}return!1},contains:function(parentEl,childEl){if(!parentEl)return!1;if(parentEl.contains)return parentEl.contains(childEl);if(parentEl.compareDocumentPosition)return parentEl===childEl||Boolean(16&parentEl.compareDocumentPosition(childEl));throw new Error("Can't determine `contains` status")},matches:function(node,selector){return Siesta.Sizzle.matchesSelector(node,selector)},offset:function(elem){if(!elem)return null;var doc=elem.ownerDocument;if(!doc)return null;if(elem===doc.body)return this.bodyOffset(elem);var box=this.getBoundingClientRect(elem),win=doc.defaultView||doc.parentWindow;return box?{left:this.viewportXtoPageX(Math.floor(box.left),win),top:this.viewportYtoPageY(Math.floor(box.top),win)}:{left:0,top:0}},bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(this.initializeOffset(),this.doesNotIncludeMarginInBodyOffset){var style=getComputedStyle(body);top+=parseFloat(style.marginTop)||0,left+=parseFloat(style.marginLeft)||0}return{top:top,left:left}},initializeOffset:function(){var body=document.body,container=document.createElement("div"),bodyMarginTop=parseFloat(getComputedStyle(body).marginTop)||0,styles={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(var o in styles)container.style[o]=styles[o];container.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",body.insertBefore(container,body.firstChild);var innerDiv=container.firstChild,checkDiv=innerDiv.firstChild;innerDiv.nextSibling.firstChild.firstChild;checkDiv.style.position="fixed",checkDiv.style.top="20px",checkDiv.style.position=checkDiv.style.top="",innerDiv.style.overflow="hidden",innerDiv.style.position="relative",this.doesNotIncludeMarginInBodyOffset=body.offsetTop!==bodyMarginTop,body.removeChild(container),this.initializeOffset=function(){}},getElementWidth:function(el){return this.getBoundingClientRect(el).width},getElementHeight:function(el){return this.getBoundingClientRect(el).height},getWindowSize:function(win){var doc=win.document;return{width:win.innerWidth||doc.documentElement.clientWidth||doc.body.clientWidth,height:win.innerHeight||doc.documentElement.clientHeight||doc.body.clientHeight}},isPointWithinElement:function(x,y,el){var rect=this.getBoundingClientRect(el);return x>=rect.left&&x<=rect.right&&y>=rect.top&&y<=rect.bottom},isElementReachableAt:function(el,pageX,pageY,allowChild){allowChild=!1!==allowChild;var doc=el.ownerDocument,win=doc.defaultView||doc.parentWindow,foundEl=doc.elementFromPoint(this.pageXtoViewportX(pageX,win),this.pageYtoViewportY(pageY,win));return foundEl&&(foundEl===el||allowChild&&this.contains(el,foundEl))},isElementReachableAtCenter:function(el,allowChild){allowChild=!1!==allowChild;var offsets=this.offset(el);return this.isElementReachableAt(el,offsets.left+this.getElementWidth(el)/2,offsets.top+this.getElementHeight(el)/2,allowChild)},getBoundingClientRect:function(el){var svgEl=el.ownerSVGElement;if(svgEl&&(bowser.msie||bowser.msedge||bowser.gecko)){var elBox=el.getBBox(),svgRect=svgEl.getBoundingClientRect(),left=svgRect.left+elBox.x,top=svgRect.top+elBox.y;elBox.width;return{x:left,y:top,left:left,top:top,bottom:top+elBox.height,height:elBox.height,width:elBox.width}}return el.getBoundingClientRect()},nodeIsUnloaded:function(el){try{el&&el.tagName;var doc=el.ownerDocument,win=doc&&(doc.defaultView||doc.parentWindow);return!Boolean(win)}catch(e){return!(el=null)}},nodeIsOrphan:function(el){var doc=el.ownerDocument;return!(doc&&doc.body&&el.parentNode&&(el===doc.body||$.contains(doc.body,el)))},getNodeParents:function(node){node.ownerDocument;for(var nodes=[];node&&node.parentNode;node=node.parentNode)nodes.unshift(node);return nodes},getCommonAncestor:function(node1,node2){var parents1=this.getNodeParents(node1),parents2=this.getNodeParents(node2);if(parents1[0]!=parents2[0])return null;for(var i=0;i<parents1.length;i++)if(parents1[i]!==parents2[i])return parents1[i-1]}}}),Role("Siesta.Test.Action.Role.HasTarget",{has:{target:{required:!1},normalizedTarget:null,cachedTarget:null,passTargetToNext:!0,options:null,offset:null,waitForTarget:!0},after:{initialize:function(){if(this.passTargetToNext){var me=this,prevNext=this.next;this.next=function(){prevNext.call(this,me.normalizedTarget)}}}},methods:{BUILD:function(config){return config.el&&!config.target&&(config.target=config.el),config},getTarget:function(){if(this.cachedTarget)return this.cachedTarget;var test=this.test,target=this.target||test.getCursorPagePosition();return"Function"===test.typeOf(target)&&(target=target.call(test,this)),this.normalizedTarget=test.normalizeActionTarget(target,!0),this.cachedTarget=target}}}),Class("Siesta.Test.Action.Swipe",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"swipe",direction:"left"},methods:{process:function(){this.test.swipe(this.getTarget(),this.direction,this.next)}}}),Siesta.Test.ActionRegistry().registerAction("swipe",Siesta.Test.Action.Swipe),Class("Siesta.Test.Action.Pinch",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"pinch",scale:2,target2:null,offset2:null,cachedTarget2:null},methods:{process:function(){this.test.pinch(this.getTarget(),this.getTarget2(),this.scale,this.next,null,this.options,this.offset,this.offset2)},getTarget2:function(){if(this.cachedTarget2)return this.cachedTarget2;var test=this.test,target2=this.target2;return"Function"===test.typeOf(target2)&&(target2=target2.call(test,this)),this.cachedTarget2=target2}}}),Siesta.Test.ActionRegistry().registerAction("pinch",Siesta.Test.Action.Pinch),Class("Siesta.Test.Action.LongPress",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"longPress"},methods:{process:function(){this.test.longpress(this.getTarget(),this.next,null,this.options,this.offset)}}}),Siesta.Test.ActionRegistry().registerAction("longpress",Siesta.Test.Action.LongPress),Class("Siesta.Test.Action.Tap",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"tap"},methods:{process:function(){this.test.tap(this.getTarget(),this.next,null,this.options,this.offset)}}}),Siesta.Test.ActionRegistry().registerAction("tap",Siesta.Test.Action.Tap),Class("Siesta.Test.Action.DoubleTap",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"doubleTap"},methods:{process:function(){this.test.doubleTap(this.getTarget(),this.next,null,this.options,this.offset,this.waitForTarget)}}}),Siesta.Test.ActionRegistry().registerAction("doubletap",Siesta.Test.Action.DoubleTap),Class("Siesta.Test.Action.TouchDrag",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"touchDragTo",to:null,fromOffset:null,toOffset:null,by:null,dragOnly:!1,byOrToMissingText:'Either "to" or "by" configuration option is required for "drag" step',byAndToDefinedText:'Exactly one of "to" or "by" configuration options is required for "drag" step, not both'},override:{BUILD:function(config){return config.source&&!config.target&&(config.target=config.source),this.SUPER(config)}},methods:{initialize:function(){if(this.SUPER(),!this.to&&!this.by)throw this.byOrToMissingText;if(this.to&&this.by)throw this.byAndToDefinedText},getTo:function(){return"Function"==this.test.typeOf(this.to)?this.to.call(this.test,this):this.to},getBy:function(){return"Function"==this.test.typeOf(this.by)?this.by.call(this.test,this):this.by},process:function(){var next=this.next,test=this.test,target=this.getTarget(),normalizedTarget=test.normalizeActionTarget(target,!0);this.to?test.touchDragTo(target,this.getTo(),function(){next(normalizedTarget||test.normalizeActionTarget(target))},null,this.options,this.dragOnly,this.fromOffset||this.offset,this.toOffset):test.touchDragBy(target,this.getBy(),function(){next(normalizedTarget||test.normalizeActionTarget(target))},null,this.options,this.dragOnly,this.fromOffset||this.offset)}}}),Siesta.Test.ActionRegistry().registerAction("touchdrag",Siesta.Test.Action.TouchDrag),Class("Siesta.Test.Action.MouseDown",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"mouseDown"},methods:{process:function(){this.test.mouseDown(this.getTarget(),this.options,this.offset,this.next,this,this.waitForTarget)}}}),Siesta.Test.ActionRegistry().registerAction("mouseDown",Siesta.Test.Action.MouseDown),Siesta.Test.ActionRegistry().registerAction("fingerDown",Siesta.Test.Action.MouseDown),Class("Siesta.Test.Action.MouseUp",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"mouseUp"},methods:{process:function(){this.test.mouseUp(this.getTarget(),this.options,this.offset,this.next)}}}),Siesta.Test.ActionRegistry().registerAction("mouseUp",Siesta.Test.Action.MouseUp),Siesta.Test.ActionRegistry().registerAction("fingerUp",Siesta.Test.Action.MouseUp),Class("Siesta.Test.Action.Click",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"click"},methods:{process:function(){this.test.click(this.getTarget(),this.next,null,this.options,this.offset,this.waitForTarget)}}}),Siesta.Test.ActionRegistry().registerAction("click",Siesta.Test.Action.Click),Class("Siesta.Test.Action.DoubleClick",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"doubleClick"},methods:{process:function(){this.test.doubleClick(this.getTarget(),this.next,null,this.options,this.offset,this.waitForTarget)}}}),Siesta.Test.ActionRegistry().registerAction("doubleclick",Siesta.Test.Action.DoubleClick),Siesta.Test.ActionRegistry().registerAction("dblclick",Siesta.Test.Action.DoubleClick),Class("Siesta.Test.Action.RightClick",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"rightClick"},methods:{process:function(){this.test.rightClick(this.getTarget(),this.next,null,this.options,this.offset,this.waitForTarget)}}}),Siesta.Test.ActionRegistry().registerAction("rightclick",Siesta.Test.Action.RightClick),Siesta.Test.ActionRegistry().registerAction("contextmenu",Siesta.Test.Action.RightClick),Class("Siesta.Test.Action.Wheel",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"wheel"},methods:{process:function(){this.test.wheel(this.getTarget(),this.next,null,this.options,this.offset,this.waitForTarget)}}}),Siesta.Test.ActionRegistry().registerAction("wheel",Siesta.Test.Action.Wheel),Class("Siesta.Test.Action.Type",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"type",text:"",options:null,clearExisting:!1},methods:{process:function(){var waitForTarget=this.waitForTarget||!!this.target;this.target=this.target||this.test.activeElement(),this.test.type(this.getTarget(),this.text,this.next,null,this.options,this.clearExisting,waitForTarget)}}}),Siesta.Test.ActionRegistry().registerAction("type",Siesta.Test.Action.Type),Class("Siesta.Test.Action.Drag",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"dragTo",to:null,fromOffset:null,toOffset:null,by:null,dragOnly:!1,byOrToMissingText:'Either "to" or "by" configuration option is required for "drag" step',byAndToDefinedText:'Exactly one of "to" or "by" configuration options is required for "drag" step, not both'},override:{BUILD:function(config){return config.source&&!config.target&&(config.target=config.source),this.SUPER(config)}},methods:{initialize:function(){if(this.SUPER(),!this.to&&!this.by)throw this.byOrToMissingText;if(this.to&&this.by)throw this.byAndToDefinedText},getTo:function(){return"Function"===this.test.typeOf(this.to)?this.to.call(this.test,this):this.to},getBy:function(){return"Function"===this.test.typeOf(this.by)?this.by.call(this.test,this):this.by},process:function(){var next=this.next,test=this.test,target=this.getTarget(),normalizedTarget=test.normalizeActionTarget(target,!0);this.to?test.dragTo(target,this.getTo(),function(){next(normalizedTarget||test.normalizeActionTarget(target,!0))},null,this.options,this.dragOnly,this.fromOffset||this.offset,this.toOffset,this.waitForTarget):test.dragBy(target,this.getBy(),function(){next(normalizedTarget||test.normalizeActionTarget(target,!0))},null,this.options,this.dragOnly,this.fromOffset||this.offset,this.waitForTarget)}}}),Siesta.Test.ActionRegistry().registerAction("drag",Siesta.Test.Action.Drag),Class("Siesta.Test.Action.MonkeyTest",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"monkeyTest",nbrInteractions:10,skipTargets:null,hasOwnAsyncFrame:!0},methods:{process:function(){this.test.monkeyTest({target:this.getTarget(),nbrInteractions:this.nbrInteractions,skipTargets:this.skipTargets,callback:this.next})}}}),Siesta.Test.ActionRegistry().registerAction("monkeyTest",Siesta.Test.Action.MonkeyTest),Siesta.Test.ActionRegistry().registerAction("monkey",Siesta.Test.Action.MonkeyTest),Class("Siesta.Test.Action.MoveCursor",{isa:Siesta.Test.Action,has:{requiredTestMethod:"moveMouseTo",to:null,by:null,offset:null},methods:{getTo:function(){return"Function"==this.test.typeOf(this.to)?this.to.call(this.test,this):this.to},getBy:function(){return"Function"==this.test.typeOf(this.by)?this.by.call(this.test,this):this.by},process:function(){var test=this.test,next=this.next;if(this.to){var to=this.getTo(),normalizedTarget=test.normalizeActionTarget(to,!1);test.moveMouseTo(to,function(){next(normalizedTarget)},null,this.offset)}else{var by=this.getBy(),currentXY=test.getCursorPagePosition();normalizedTarget=test.normalizeActionTarget([currentXY[0]+by[0],currentXY[1]+by[1]]);test.moveMouseBy(by,function(){next(normalizedTarget)})}}}}),Siesta.Test.ActionRegistry().registerAction("moveCursor",Siesta.Test.Action.MoveCursor),Siesta.Test.ActionRegistry().registerAction("moveMouse",Siesta.Test.Action.MoveCursor),Siesta.Test.ActionRegistry().registerAction("moveFinger",Siesta.Test.Action.MoveCursor),Class("Siesta.Test.Action.MoveCursorTo",{isa:Siesta.Test.Action,does:Siesta.Test.Action.Role.HasTarget,has:{requiredTestMethod:"moveMouseTo",target:{required:!0}},methods:{process:function(){this.test.moveMouseTo(this.getTarget(),this.next,null,this.offset,this.waitForTarget,this.options)}}}),Siesta.Test.ActionRegistry().registerAction("moveCursorTo",Siesta.Test.Action.MoveCursorTo),Siesta.Test.ActionRegistry().registerAction("moveMouseTo",Siesta.Test.Action.MoveCursorTo),Siesta.Test.ActionRegistry().registerAction("moveFingerTo",Siesta.Test.Action.MoveCursorTo),Class("Siesta.Test.Action.MoveCursorBy",{isa:Siesta.Test.Action,does:[Siesta.Test.Action.Role.HasTarget,Siesta.Util.Role.CanGetType],has:{requiredTestMethod:"moveMouseBy"},methods:{process:function(){var test=this.test;this.next;this.target&&"Array"===this.typeOf(this.target)&&"Array"===this.typeOf(this.target[0])&&(this.target=this.target[0]),test.moveMouseBy(this.getTarget(),this.next,this,this.options)}}}),Siesta.Test.ActionRegistry().registerAction("moveMouseBy",Siesta.Test.Action.MoveCursorBy),Siesta.Test.ActionRegistry().registerAction("moveCursorBy",Siesta.Test.Action.MoveCursorBy),Siesta.Test.ActionRegistry().registerAction("moveFingerBy",Siesta.Test.Action.MoveCursorBy),Class("Siesta.Test.Action.SetUrl",{isa:Siesta.Test.Action,has:{value:null,setUrl:null,requiredTestMethod:"setUrl"},methods:{process:function(){var value=this.setUrl||this.value;this.test.setUrl(value,this.next)}}}),Siesta.Test.ActionRegistry().registerAction("setUrl",Siesta.Test.Action.SetUrl),Class("Siesta.Test.Action.SetValue",{isa:Siesta.Test.Action,has:{target:null,setValue:null,requiredTestMethod:"setValue"},methods:{process:function(){var target=this.target,test=this.test;"Function"===test.typeOf(target)&&(target=target.call(test,this)),test.setValue(target,this.setValue,this.next,null)}}}),Siesta.Test.ActionRegistry().registerAction("setValue",Siesta.Test.Action.SetValue),Role("Siesta.Test.Simulate.Mouse",{requires:["simulateEvent","getSimulateEventsWith","$"],does:[Siesta.Util.Role.Dom,Siesta.Util.Role.CanCalculatePageScroll,Siesta.Test.Browser.Role.CanGetElementFromPoint],has:{currentPosition:{init:function(){return[0,0]}},dragDelay:25,pathBatchSize:bowser.msie?10:5,mouseMovePrecision:1,mouseDragPrecision:1,enableUnreachableClickWarning:!0,overEls:Joose.I.Array,lastMouseOverEl:null,mouseState:"up",lastMouseDownEl:null,pointerEventNamesMap:{lazy:function(){return window.PointerEvent?{pointerdown:"pointerdown",pointerup:"pointerup",pointerover:"pointerover",pointerout:"pointerout",pointerenter:"pointerenter",pointerleave:"pointerleave",pointermove:"pointermove"}:window.MSPointerEvent?{pointerdown:"MSPointerDown",pointerup:"MSPointerUp",pointerover:"MSPointerOver",pointerout:"MSPointerOut",pointerenter:"MSPointerEnter",pointerleave:"MSPointerLeave",pointermove:"MSPointerMove"}:{}}}},after:{cleanup:function(){this.overEls=null,this.lastMouseDownEl=null,this.lastMouseOverEl=null}},override:{normalizeEventName:function(eventName){return this.getPointerEventNamesMap()[eventName]||this.SUPERARG(arguments)},simulateEvent:function(el,eventName){var supportsPointerEvents=Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric;(supportsPointerEvents?/pointerdown$/i.test(eventName):"mousedown"==eventName)&&(this.mouseState="down",this.lastMouseDownEl=el),(supportsPointerEvents?/pointerup$/i.test(eventName):"mouseup"==eventName)&&(this.mouseState="up",this.lastMouseUpEl=el);var event=this.SUPERARG(arguments);return/pointerdown$/i.test(eventName)&&(this.lastPointerDownPrevented=this.isEventPrevented(event)),this.test&&this.test.mouseVisualizer&&event&&this.test.mouseVisualizer.onEventSimulated(event,this.currentPosition),event}},methods:{createMouseEvent:function(type,options,el){var event,global=this.global,doc=el.ownerDocument,isPointer=type.match(/^(ms)?pointer/i);if(options=this.prepareMouseEventOptions(type,options,el),!bowser.msie&&global.MouseEvent)event="wheel"===type?new global.WheelEvent(type,options):isPointer?("pointermove"===type&&(options.button=-1),new global.PointerEvent(type,options)):new global.MouseEvent(type,options);else if(doc.createEvent&&"dispatchEvent"==this.getSimulateEventsWith())if("wheel"===type){var modifiersArg="";options.ctrlKey&&(modifiersArg="Control"),options.altKey&&(modifiersArg+=" Alt"),options.shiftKey&&(modifiersArg+=" Shift"),(event=doc.createEvent("WheelEvent")).initWheelEvent(type,options.bubbles,options.cancelable,options.view,options.detail,options.screenX,options.screenY,options.clientX,options.clientY,options.button,options.relatedTarget||doc.documentElement,modifiersArg,options.deltaX||0,options.deltaY||0,options.deltaZ||0,options.deltaMode||0)}else(event=doc.createEvent(isPointer?(isPointer[1]?"MS":"")+"PointerEvent":"MouseEvents"))[isPointer?"initPointerEvent":"initMouseEvent"](type,options.bubbles,options.cancelable,options.view,options.detail,options.screenX,options.screenY,options.clientX,options.clientY,options.ctrlKey,options.altKey,options.shiftKey,options.metaKey,options.button,options.relatedTarget||doc.documentElement,null,null,null,null,null,null,null,null,options.pointerId,options.pointerType,null,null);else doc.createEventObject&&(event=doc.createEventObject(),$.extend(event,options),event.button={0:1,1:4,2:2}[event.button]||event.button);if(this.bowser.msedge&&(global.Object.defineProperty(event,"pageX",{value:options.pageX}),global.Object.defineProperty(event,"pageY",{value:options.pageY})),!/(mouse|pointer)over$/.test(type)&&!/(mouse|pointer)out$/.test(type)){var elWindow=doc.defaultView||doc.parentWindow,cursorX=options.clientX,cursorY=options.clientY;if(elWindow!==global){var offsets=this.$(elWindow.frameElement).offset();cursorX+=offsets.left,cursorY+=offsets.top}options.doNotUpdateCurrentPosition||(this.currentPosition[0]=cursorX,this.currentPosition[1]=cursorY)}return event},prepareMouseEventOptions:function(type,options,el){var global=this.global;if(!("clientX"in(options=$.extend({bubbles:!/(ms)?(mouse|pointer)enter/i.test(type)&&!/(ms)?(mouse|pointer)leave/i.test(type),cancelable:!/(ms)?(mouse|pointer)move/i.test(type),view:global,detail:0,screenX:0,screenY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,buttons:0,relatedTarget:void 0,pointerType:bowser.msie?4:"mouse"},options))&&"clientY"in options)){var center=this.test.findCenter(el);options.clientX=center[0],options.clientY=center[1]}return options.clientX=Math.round(options.clientX),options.clientY=Math.round(options.clientY),!this.bowser.msedge||"pageX"in options&&"pageY"in options||(options.pageX=this.viewportXtoPageX(options.clientX),options.pageY=this.viewportYtoPageY(options.clientY)),"screenX"in window&&(options.screenX=Math.round(global.screenX+options.clientX),options.screenY=Math.round(global.screenY+options.clientY)),options},simulateMouseMove:function(x,y,options,params){var me=this,pathBatchSize=(params=params||{}).pathBatchSize,async=params.async,mouseMovePrecision=params.mouseMovePrecision;return"instant"==params.moveKind&&(mouseMovePrecision=pathBatchSize=1e4),this.movePointerTemplate({xy:this.currentPosition,xy2:[x,y],options:options,overEls:this.overEls,interval:!1!==async?this.dragDelay:0,callbackDelay:!1!==async?50:0,pathBatchSize:pathBatchSize||me.pathBatchSize,mouseMovePrecision:mouseMovePrecision||me.mouseMovePrecision,onVoidOverEls:function(){return me.overEls=[]},onPointerEnter:function(el,options){me.onPointerEnter(el,options)},onPointerLeave:function(el,options){me.onPointerLeave(el,options)},onPointerOver:function(el,options){me.onPointerOver(el,options)},onPointerOut:function(el,options){me.onPointerOut(el,options)},onPointerMove:function(el,options){me.onPointerMove(el,options)}})},movePointerTemplate:function(args){this.global.document;var me=this,overEls=args.overEls,lastOverEl=overEls[overEls.length-1];lastOverEl&&this.nodeIsUnloaded(lastOverEl)&&(lastOverEl=null,overEls=args.onVoidOverEls());var mouseMovePrecision="down"==me.mouseState?me.mouseDragPrecision:args.mouseMovePrecision||me.mouseMovePrecision,pathBatchSize=Math.max(args.pathBatchSize,mouseMovePrecision),options=args.options||{},path=(Siesta.Project.Browser.FeatureSupport().supports,this.getPathBetweenPoints(args.xy,args.xy2)),queue=new Siesta.Util.Queue({deferer:this.test.originalSetTimeout,deferClearer:this.test.originalClearTimeout,interval:args.interval,callbackDelay:args.callbackDelay,observeTest:this.test,processor:function(data,index){function visitPoint(point){var targetEl=(info=me.elementFromPoint(point[0],point[1],!1,null,!0)).el;targetEl&&(x=info.localXY[0],y=info.localXY[1],targetEl!==lastOverEl&&(me.onElementAtCursorChanged(targetEl,lastOverEl,x,y,options),lastOverEl=targetEl),args.onPointerMove(targetEl,$.extend({clientX:x,clientY:y},options),j<toIndex))}for(var info,x,y,fromIndex=data.sourceIndex,toIndex=data.targetIndex,delta=Math.min(toIndex-fromIndex,mouseMovePrecision)||1,j=fromIndex;j<=toIndex;j+=delta){var point=path[j];visitPoint(point)}j>=path.length&&point!==path[path.length-1]&&(point=visitPoint(path[path.length-1])),point&&(info=me.elementFromPoint(point[0],point[1],!1,null,!0)).el&&info.el!==lastOverEl&&me.onElementAtCursorChanged(info.el,lastOverEl,x,y,options)}}),pathLength=path.length;if(pathLength<=pathBatchSize&&pathBatchSize<=mouseMovePrecision)queue.addStep({sourceIndex:0,targetIndex:Math.min(1,pathLength-1)}),3<=pathLength&&queue.addStep({sourceIndex:pathLength-2,targetIndex:pathLength-1});else for(var i=0,l=pathLength;i<l;i+=pathBatchSize)queue.addStep({sourceIndex:i,targetIndex:Math.min(i+pathBatchSize-1,pathLength-1)});return queue.addStep({processor:function(){me.afterMouseInteraction()}}),new Promise(function(resolve,reject){queue.run(resolve)})},onPointerEnter:function(el,options){Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric&&this.simulateEvent(el,"pointerenter",options),this.simulateEvent(el,"mouseenter",options)},onPointerLeave:function(el,options){Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric&&this.simulateEvent(el,"pointerleave",options),this.simulateEvent(el,"mouseleave",options)},onPointerOver:function(el,options){Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric&&this.simulateEvent(el,"pointerover",options),this.simulateEvent(el,"mouseover",options)},onPointerOut:function(el,options){Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric&&this.simulateEvent(el,"pointerout",options),this.simulateEvent(el,"mouseout",options)},onPointerMove:function(el,options){var supportsPointerEvents=Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric;options.buttons="up"==this.mouseState?0:1,supportsPointerEvents&&this.simulateEvent(el,"pointermove",options),this.simulateEvent(el,"mousemove",options)},onElementAtCursorChanged:function(targetEl,lastOverEl,clientX,clientY,options){var me=this,supports=Siesta.Project.Browser.FeatureSupport().supports,overEls=me.overEls;!lastOverEl||me.nodeIsOrphan(lastOverEl)||me.nodeIsUnloaded(lastOverEl)||me.onPointerOut(lastOverEl,$.extend({clientX:clientX,clientY:clientY,relatedTarget:targetEl},options));for(var i=overEls.length-1;0<=i;i--){var el=overEls[i];me.nodeIsUnloaded(el)||me.nodeIsOrphan(el)?overEls.splice(i,1):el!==targetEl&&0===me.$(el).has(targetEl).length&&(supports.mouseEnterLeave&&me.onPointerLeave(el,$.extend({clientX:clientX,clientY:clientY,relatedTarget:targetEl},options)),overEls.splice(i,1))}if(me.onPointerOver(targetEl,$.extend({clientX:clientX,clientY:clientY,relatedTarget:lastOverEl},options)),supports.mouseEnterLeave&&-1==jQuery.inArray(targetEl,overEls)){for(var els=[],docEl=targetEl.ownerDocument.documentElement,mouseEnterEl=targetEl;mouseEnterEl&&mouseEnterEl!=docEl;)els.unshift(mouseEnterEl),mouseEnterEl=mouseEnterEl.parentNode;for(i=0;i<els.length;i++)-1==jQuery.inArray(els[i],overEls)&&(me.onPointerEnter(els[i],$.extend({clientX:clientX,clientY:clientY,relatedTarget:lastOverEl},options)),overEls.push(els[i]))}},afterMouseInteraction:function(){},simulateMouseDown:function(clickInfo,options){var supportsPointerEvents=Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric;return this.processMouseActionSteps(clickInfo,options,[supportsPointerEvents?{event:"pointerdown",interval:0}:null,{event:"mousedown",focus:!0}])},simulateMouseUp:function(clickInfo,options){var el=clickInfo.el,shouldFireClick=!(this.lastMouseDownEl&&el!==this.lastMouseDownEl&&!($.contains(el,this.lastMouseDownEl)||$.contains(this.lastMouseDownEl,el)))||!(this.bowser.safari||this.bowser.gecko),supportsPointerEvents=Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric;return this.processMouseActionSteps(clickInfo,options,[supportsPointerEvents?{event:"pointerup",interval:0}:null,{event:"mouseup"}].concat(shouldFireClick?[{event:"click"}]:[]))},mouseOver:function(el,options){var info=this.test.getNormalizedTopElementInfo(el,!0);info&&((options=options||{}).clientX=null!=options.clientX?options.clientX:info.localXY[0],options.clientY=null!=options.clientY?options.clientY:info.localXY[1],Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric&&this.simulateEvent(el,"pointerover",options),this.simulateEvent(el,"mouseover",options))},mouseOut:function(el,options){var info=this.test.getNormalizedTopElementInfo(el,!0);info&&((options=options||{}).clientX=null!=options.clientX?options.clientX:info.localXY[0],options.clientY=null!=options.clientY?options.clientY:info.localXY[1],Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric&&this.simulateEvent(el,"pointerout",options),this.simulateEvent(el,"mouseout",options))},processMouseActionSteps:function(clickInfo,options,steps){clickInfo.originalEl&&this.enableUnreachableClickWarning&&this.test.getNormalizedTopElementInfo(clickInfo.originalEl,!1,clickInfo.method,clickInfo.offset);var me=this,x=clickInfo.globalXY[0],y=clickInfo.globalXY[1],isOption="option"===clickInfo.el.nodeName.toLowerCase(),doc=me.global.document,prevScrollTop=this.getPageScrollY(),target=isOption?clickInfo.el:me.elementFromPoint(x,y,!1,clickInfo.el),targetParent=target.parentNode,targetHasChanged=!1,queue=new Siesta.Util.Queue({deferer:this.test.originalSetTimeout,deferClearer:this.test.originalClearTimeout,interval:10,callbackDelay:me.afterActionDelay,observeTest:this.test,processor:function(data){if(!me.lastPointerDownPrevented||!/mouse/i.test(data.event)){var delta=doc.body?me.getPageScrollY()-prevScrollTop:0,elAtCursor=isOption?target:me.elementFromPoint(x,y-delta,!1,target),fireEl=elAtCursor;if(!isOption&&data.recaptureTarget&&(target=elAtCursor,targetHasChanged=!1),isOption||elAtCursor===target||$.contains(elAtCursor,target)||$.contains(target,elAtCursor)||(targetHasChanged=!0),!isOption&&"click"===data.event){var mouseDownUpTargetsChanged;if(elAtCursor===target&&elAtCursor.parentNode!==targetParent||me.nodeIsOrphan(target)||me.lastMouseDownEl&&me.nodeIsOrphan(me.lastMouseDownEl))return;if(!me.lastMouseDownEl||elAtCursor===me.lastMouseDownEl||$.contains(elAtCursor,me.lastMouseDownEl)||$.contains(me.lastMouseDownEl,elAtCursor)?me.lastMouseUpEl&&me.lastMouseUpEl!==elAtCursor&&!$.contains(elAtCursor,me.lastMouseUpEl)&&(mouseDownUpTargetsChanged=!0,fireEl=me.getCommonAncestor(elAtCursor,me.lastMouseUpEl)):(mouseDownUpTargetsChanged=!0,fireEl=me.getCommonAncestor(elAtCursor,me.lastMouseDownEl)),mouseDownUpTargetsChanged){if(me.bowser.gecko||me.bowser.safari)return;if(!fireEl)return}}if(!targetHasChanged||!data.cancelIfTargetChanged){var event=me.simulateEvent(fireEl,data.event,options);if(!me.lastPointerDownPrevented&&data.focus&&me.mimicFocusOnMouseDown(elAtCursor,event),!isOption){var elementAtPoint=me.elementFromPoint(x,y-delta,!1,target);elementAtPoint!==elAtCursor&&me.onElementAtCursorChanged(elementAtPoint,elAtCursor,x,y-delta,options)}}}}});return Joose.A.each(steps,function(step){step&&queue.addStep(step)}),new Promise(function(resolve,reject){queue.run(function(){me.afterMouseInteraction(),resolve()})})},simulateMouseClick:function(clickInfo,options){var supportsPointerEvents=Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric;return this.processMouseActionSteps(clickInfo,options,[supportsPointerEvents?{event:"pointerdown",interval:0}:null,{event:"mousedown",focus:!0},supportsPointerEvents?{event:"pointerup",interval:0}:null,{event:"mouseup",interval:0},{event:"click",cancelIfTargetChanged:!0}])},simulateRightClick:function(clickInfo,options){var isMac=-1<navigator.platform.indexOf("Mac"),supportsPointerEvents=Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric;return(options=options||{}).button=options.buttons=2,this.processMouseActionSteps(clickInfo,options,[supportsPointerEvents?{event:"pointerdown",interval:0}:null,{event:"mousedown",focus:!0}].concat(isMac?[]:[supportsPointerEvents?{event:"pointerup",interval:0}:null,{event:"mouseup",interval:0}]).concat([{event:"contextmenu"}]))},simulateDoubleClick:function(clickInfo,options){var supportsPointerEvents=Siesta.Project.Browser.FeatureSupport().supports.PointerEventsGeneric;return this.processMouseActionSteps(clickInfo,options,[supportsPointerEvents?{event:"pointerdown",interval:0}:null,{event:"mousedown",focus:!0},supportsPointerEvents?{event:"pointerup",interval:0}:null,{event:"mouseup",interval:0},{event:"click",cancelIfTargetChanged:!0},supportsPointerEvents?{event:"pointerdown",interval:0}:null,{event:"mousedown",recaptureTarget:!0,focus:!0},supportsPointerEvents?{event:"pointerup",interval:0}:null,{event:"mouseup",interval:0},{event:"click",cancelIfTargetChanged:!0,interval:0},{event:"dblclick",cancelIfTargetChanged:!0}])},mimicFocusOnMouseDown:function(el,mouseDownEvent){if(!this.isEventPrevented(mouseDownEvent)){var test=this.test;if(test.isElementFocusable(el))test.focus(el,!0);else{var doc=el.ownerDocument,body=(doc.defaultView||doc.parentWindow,doc.body);if(body){for(;el&&el!=body&&el!=doc;){if(bowser.msie&&"on"==el.getAttribute("unselectable"))return;if(test.isElementFocusable(el))return void test.focus(el,!0);el=el.parentNode}test.focus(body||doc.documentElement,!0)}}}},simulateMouseWheel:function(targetInfo,options){var eventName="wheel";return targetInfo.el.ownerDocument.createEvent&&"dispatchEvent"===this.getSimulateEventsWith()||(eventName="mousewheel"),this.processMouseActionSteps(targetInfo,options,[{event:eventName}])},getPathBetweenPoints:function(from,to){if("number"!=typeof from[0]||"number"!=typeof from[1]||"number"!=typeof to[0]||"number"!=typeof to[1]||isNaN(from[0])||isNaN(from[1])||isNaN(to[0])||isNaN(to[1]))throw new Error("Incorrect arguments passed to getPathBetweenPoints: "+from+", "+to);var sx,sy,err,e2,stops=[],x0=Math.floor(from[0]),x1=Math.floor(to[0]),y0=Math.floor(from[1]),y1=Math.floor(to[1]),dx=Math.abs(x1-x0),dy=Math.abs(y1-y0);for(sx=x0<x1?1:-1,sy=y0<y1?1:-1,err=dx-dy;x0!==x1||y0!==y1;)-dy<(e2=2*err)&&(err-=dy,x0+=sx),e2<dx&&(err+=dx,y0+=sy),stops.push([x0,y0]);var last=stops[stops.length-1];return 0<stops.length&&(last[0]!==to[0]||last[1]!==to[1])&&stops.push(to.slice()),stops}}}),Singleton("Siesta.Test.UserAgent.KeyCodes",{methods:{isNav:function(k){var keys=this.keys;return 33<=k&&k<=40||k==keys.RETURN||k==keys.TAB||k==keys.ESCAPE},isSpecial:function(k){return k===this.keys.BACKSPACE||16<=k&&k<=20||44<=k&&k<=46||112<=k&&k<=123||91===k},isModifier:function(k){return k===this.keys.SHIFT||k===this.keys.CTRL||k===this.keys.ALT||k===this.keys.CMD},fromCharCode:function(code,readableForm){var keys=this.keys;for(var key in keys)if(keys[key]===code&&(!readableForm||1<key.length))return key}},has:{keys:{init:{"\b":8,BACKSPACE:8,"\t":9,TAB:9,"\r":13,RETURN:13,ENTER:13,SPACE:32,SHIFT:16,CTRL:17,ALT:18,CMD:91,"PAUSE-BREAK":19,CAPS:20,ESCAPE:27,ESC:27,"NUM-LOCK":144,"SCROLL-LOCK":145,PRINT:44,"PAGE-UP":33,PAGEUP:33,"PAGE-DOWN":34,PAGEDOWN:34,END:35,HOME:36,LEFT:37,ARROWLEFT:37,UP:38,ARROWUP:38,RIGHT:39,ARROWRIGHT:39,DOWN:40,ARROWDOWN:40,INSERT:45,DELETE:46," ":32,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUM0:96,NUM1:97,NUM2:98,NUM3:99,NUM4:100,NUM5:101,NUM6:102,NUM7:103,NUM8:104,NUM9:105,"*":106,"+":107,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123}},keyNameMap:{init:{8:"Backspace",9:"Tab",13:"Enter",32:"Space",16:"Shift",17:"Control",18:"Alt",91:"Meta",20:"CapsLock",27:"Escape",144:"NumLock",145:"ScrollLock",44:"Print",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",106:"Multiply",107:"Add",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12"}}}}),Role("Siesta.Test.Simulate.Keyboard",{requires:["$","simulateEvent","isEventPrevented"],does:[Siesta.Util.Role.CanFormatStrings,Siesta.Test.Browser.Role.CanWorkWithKeyboard],has:{keyboardEventName:"KeyboardEvent"in window&&bowser.gecko?"KeyboardEvent":"KeyEvent"in window?"KeyEvents":null},methods:{createKeyboardEvent:function(type,options,el){var event,doc=el.ownerDocument;this.global;if(options=$.extend({bubbles:!0,cancelable:!0,view:this.global,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:0,key:options.key||""},options),doc.createEvent&&"dispatchEvent"==this.getSimulateEventsWith()){try{"KeyboardEvent"===this.keyboardEventName&&(event=new KeyboardEvent(type,options))}catch(err){event=null}event||((event=doc.createEvent("Events")).initEvent(type,options.bubbles,options.cancelable),$.extend(event,{view:options.view,ctrlKey:options.ctrlKey,altKey:options.altKey,shiftKey:options.shiftKey,metaKey:options.metaKey,keyCode:options.keyCode,charCode:options.charCode,key:options.key||"",code:options.code}))}else doc.createEventObject&&(event=doc.createEventObject(),$.extend(event,options));return(bowser.msie||bowser.opera)&&(event.keyCode=0<options.charCode?options.charCode:options.keyCode,event.charCode=void 0),event},createTextEvent:function(type,options,el){var doc=el.ownerDocument,event=null;if(doc.createEvent)try{if((event=doc.createEvent("TextEvent"))&&event.initTextEvent)return event.initTextEvent(type,!0,!0,this.global,options.text,0,window.navigator.userLanguage||window.navigator.language),event}catch(e){}return null},findNextFocusable:function(el,offset){var selector,$el=this.$(el),$focusable=this.$(":focus, :input, a[href], [tabindex], body",el.ownerDocument).not(":disabled").not(":hidden").not("a[href]:empty"),isRadio=!1;"INPUT"===el.tagName&&"radio"===el.type&&""!==el.name&&(isRadio=!0,selector="input[type=radio][name="+el.name.replace(/(!"#$%&'\(\)\*\+,\.\/:;<=>\?@\[\]^`\{\|\}~)/g,"\\\\$1")+"]");for(var processed=[],i=0;i<$focusable.length;i++){var currEl=$focusable[i];currEl!=el&&-1==currEl.getAttribute("tabIndex")||isRadio&&$(currEl).is(selector)||processed.push(currEl)}function getTabIndex(dom){return(dom!=el||-1!=currentTabIndex)&&dom!=body&&dom.getAttribute("tabIndex")||0}var body=el.ownerDocument.body,currentTabIndex=el.getAttribute("tabIndex");processed.sort(function(a,b){var aIndex=getTabIndex(a),bIndex=getTabIndex(b);return aIndex<bIndex?-1:bIndex<aIndex||a==body?1:b==body?-1:0});var currentIndex=$(processed).index($el);return-1==currentIndex?null:processed[(currentIndex+offset)%processed.length]},emulateTab:function(el,offset){var next=this.findNextFocusable(el,offset||1);return next?this.test.focus(next):el.blur(),next},simulateType:function(text,options,params){if(null==text)throw"Must supply a string to type";var me=this,el=params.el;if(el.disabled)return Promise.resolve();"value"in el&&el.setAttribute("__lastValue",el.value);var keys=this.extractKeysAndSpecialKeys(text+""),queue=new Siesta.Util.Queue({deferer:this.test.originalSetTimeout,deferClearer:this.test.originalClearTimeout,interval:this.actionDelay,callbackDelay:0,observeTest:this.test,processor:function(data,index){var focusedEl=me.activeElement(!0,el,el);me.simulateKeyPress(focusedEl,data.key,options)}});if(params.focus&&(queue.addStep({processor:function(){me.nodeIsOrphan(el)||me.focus(el)}}),bowser.msie&&queue.addStep({processor:function(){me.nodeIsOrphan(el)||me.focus(el)}})),Joose.A.each(keys,function(key,index){key=1==key.length?key:key.substring(1,key.length-1),keys[index]=key,queue.addStep({key:key})}),!el.readOnly&&keys.length){var firstKeyCode=Siesta.Test.UserAgent.KeyCodes().keys[keys[0].toUpperCase()];if(this.isReadableKey(firstKeyCode)){var selText=this.test.getSelectedText(el);if(selText&&"value"in el&&"selectionStart"in el){var caretPos;try{caretPos=el.selectionStart}catch(e){}null!=caretPos&&(this.silentSetValue(el,el.value.substr(0,caretPos)+el.value.substr(caretPos+selText.length),"value"),this.test.setCaretPosition(el,caretPos))}}}return new Promise(function(resolve,reject){queue.run(resolve)})},simulateKeyPress:function(el,key,options){var isMac=bowser.mac,KeyCodes=Siesta.Test.UserAgent.KeyCodes().keys,keyNameMap=Siesta.Test.UserAgent.KeyCodes().keyNameMap,keyCode=KeyCodes[key.toUpperCase()]||0,keyDownEl=el=this.test.normalizeElement(el);(options=options||{}).readableKey=key;var suppressKeyPress=isMac&&options.metaKey||!isMac&&options.ctrlKey,isReadableKey=this.isReadableKey(keyCode),charCode=isReadableKey&&!suppressKeyPress?key.charCodeAt(0):0;options.key=isReadableKey?key:keyNameMap[keyCode]||"",options.code=keyNameMap[keyCode];var me=this,isTextInput=me.isTextInput(el),isEditableNode=me.isEditableNode(el),acceptsTextInput=isTextInput||isEditableNode,textValueProp="value"in el?"value":"innerHTML",originalLength=el[textValueProp].length,keyDownEvent=me.simulateEvent(el,"keydown",Joose.O.extend({charCode:0,keyCode:keyCode},options)),keyDownPrevented=this.isEventPrevented(keyDownEvent);if(!(acceptsTextInput&&this.mimicTextSelection(keyDownEvent,el))){var keyPressPrevented=!1,supports=Siesta.Project.Browser.FeatureSupport().supports;if(el=me.activeElement(!0,el,el),!suppressKeyPress&&!keyDownPrevented){var event=me.simulateEvent(el,"keypress",Joose.O.extend({charCode:charCode,keyCode:isReadableKey?0:keyCode},options));(keyPressPrevented=this.isEventPrevented(event))||keyCode!==KeyCodes.TAB||(el=this.emulateTab(el,options.shiftKey?-1:1)||el)}if(!keyDownPrevented&&acceptsTextInput&&keyCode!=KeyCodes.TAB){var innerHTML;if(!isReadableKey||suppressKeyPress||keyPressPrevented)me.mimicCaretMovement(el,keyCode);else isEditableNode&&bowser.msie&&(0===(innerHTML=el.innerHTML).indexOf("&nbsp;")?(el.innerHTML=innerHTML.substring(6),originalLength=el.innerHTML.length):0===innerHTML.indexOf("<br>")&&(el.innerHTML=innerHTML.substring(4),originalLength=el.innerHTML.length)),isEditableNode&&!bowser.msie?(8203===(innerHTML=el.innerHTML).charCodeAt(innerHTML.length-1)&&(el.innerHTML=innerHTML.substring(0,innerHTML.length-1)),el.ownerDocument.execCommand("insertText",!1,options.readableKey)):me.simulateEvent(el,bowser.msie?"textinput":"textInput",{text:options.readableKey}),me.mimicCharacterInsertion(el,key,options,originalLength);(keyCode===KeyCodes.BACKSPACE||keyCode===KeyCodes.DELETE)&&!supports.canSimulateBackspace&&0<el[textValueProp].length&&this.mimicCharacterDeletion(el,keyCode,options),"value"!=textValueProp||keyCode!==KeyCodes.ENTER||keyPressPrevented||(isTextInput&&this.maybeMimicChangeEvent(keyDownEl),supports.enterSubmitsForm||this.mimicFormSubmit(el))}}return this.mimicClickOnEnter(el,keyCode),me.simulateEvent(el,"keyup",$.extend({charCode:0,keyCode:keyCode},options)),Promise.resolve()},mimicCharacterInsertion:function(el,readableKey,options,originalLength){var textValueProp="value"in el?"value":"innerHTML",maxLength=el.getAttribute("maxlength")||1/0,isTextInput=this.isTextInput(el),supports=Siesta.Project.Browser.FeatureSupport().supports;if(null!=maxLength&&(maxLength=Number(maxLength)),!el.readOnly&&(isTextInput||bowser.msie)&&!supports.canSimulateKeyCharacters&&originalLength===el[textValueProp].length&&originalLength<maxLength){var val=el[textValueProp],caretPos=this.test.getCaretPosition(el);null==caretPos&&(caretPos=val.length),this.silentSetValue(el,val.substr(0,caretPos)+readableKey+val.substr(caretPos),textValueProp),this.test.setCaretPosition(el,caretPos+1),this.simulateEvent(el,"input",options)}},silentSetValue:function(el,newValue,propetyName){var Object=this.global.Object;Object.getOwnPropertyDescriptor&&"value"==propetyName?Object.getOwnPropertyDescriptor(el.constructor.prototype,propetyName).set.call(el,newValue):el[propetyName]=newValue},mimicTextSelection:function(keyDownEvent,el){var isMac=bowser.mac,KC=Siesta.Test.UserAgent.KeyCodes().keys,retVal=!1,ctrlKey=!isMac&&keyDownEvent.ctrlKey||keyDownEvent.metaKey&&isMac;switch(keyDownEvent.keyCode){case KC.A:ctrlKey&&(this.test.selectText(el),retVal=!0);break;case KC.LEFT:case KC.HOME:keyDownEvent.shiftKey&&(this.test.selectText(el,0,this.test.getCaretPosition(el)),retVal=!0);break;case KC.RIGHT:case KC.END:keyDownEvent.shiftKey&&(this.test.selectText(el,this.test.getCaretPosition(el)),retVal=!0)}return retVal},mimicClickOnEnter:function(el,keyCode){var nodeName=el.nodeName&&el.nodeName.toLowerCase(),supports=Siesta.Project.Browser.FeatureSupport().supports,KeyCodes=Siesta.Test.UserAgent.KeyCodes().keys;"a"!=nodeName&&"button"!=nodeName||keyCode!==KeyCodes.ENTER||supports.enterOnAnchorTriggersClick||this.simulateEvent(el,"click",{doNotUpdateCurrentPosition:!0})},mimicCaretMovement:function(el,keyCode){var nodeName=el.nodeName&&el.nodeName.toLowerCase();if("input"==nodeName||"textarea"==nodeName){var KeyCodes=Siesta.Test.UserAgent.KeyCodes().keys;switch(keyCode){case KeyCodes.HOME:this.test.setCaretPosition(el,0);break;case KeyCodes.LEFT:if(selText=this.test.getSelectedText(el)){var caretPos=this.test.getCaretPosition(el);this.test.selectText(el,caretPos,caretPos)}else this.test.moveCaretPosition(el,-1);break;case KeyCodes.RIGHT:var selText;if(selText=this.test.getSelectedText(el)){caretPos=this.test.getCaretPosition(el);this.test.selectText(el,caretPos+selText.length,caretPos+selText.length)}else this.test.moveCaretPosition(el,1);break;case KeyCodes.END:this.test.setCaretPosition(el,el.value.length)}}},mimicFormSubmit:function(el){var form=this.$(el).closest("form");if(form.length){var submitButton=form.find(":submit")[0],hasOneInput=1===form.find("input").length;if(submitButton)submitButton.click();else if(hasOneInput){this.isEventPrevented(this.simulateEvent(form[0],"submit",{}))||form[0].submit()}}},mimicCharacterDeletion:function(el,keyCode,options){var isTextInput=this.isTextInput(el);if(!el.readOnly)if(isTextInput||bowser.msie){var textValueProp="value"in el?"value":"innerHTML",text=el[textValueProp],selText=this.test.getSelectedText(el)||"",caretPosition=this.test.getCaretPosition(el),inputChanged=!1;if(null!=caretPosition&&selText)this.silentSetValue(el,text.substring(0,caretPosition)+text.substring(caretPosition+selText.length),textValueProp),inputChanged=!0;else{var KeyCodes=Siesta.Test.UserAgent.KeyCodes().keys;caretPosition=null==caretPosition?text.length:caretPosition,keyCode===KeyCodes.BACKSPACE?0<caretPosition&&(inputChanged=!0,this.silentSetValue(el,text.substring(0,caretPosition-1)+text.substring(caretPosition),textValueProp),--caretPosition):(caretPosition<text.length&&(inputChanged=!0),this.silentSetValue(el,(0<caretPosition?text.substring(0,caretPosition+1):"")+text.substring(caretPosition+1),textValueProp))}this.test.setCaretPosition(el,caretPosition),inputChanged&&this.simulateEvent(el,"input",options)}else el.ownerDocument.execCommand("delete")},maybeMimicChangeEvent:function(el){el.getAttribute("__lastValue")!==el.value&&(this.simulateEvent(el,"change"),el.setAttribute("__lastValue",el.value))}}}),Role("Siesta.Test.Simulate.Event",{does:[JooseX.Observable],requires:["$","typeOf","createTextEvent","createMouseEvent","createKeyboardEvent"],has:{bowser:function(){return bowser},browser:function(){return bowser},actionDelay:100,afterActionDelay:100,simulateEventsWith:{is:"rw",lazy:function(){return"dispatchEvent"}}},methods:{normalizeEventName:function(eventName){return eventName},simulateEvent:function(el,type,options){this.global;options=options||{},"Array"==this.typeOf(el)&&(0==el.length&&(el=this.currentPosition.slice()),"clientX"in options||(options.clientX=el[0]),"clientY"in options||(options.clientY=el[1])),el=this.test.normalizeElement(el),type=this.normalizeEventName(type);var evt=this.createEvent(type,options,el);return evt&&this.maintainScrollPositionDuring(function(){evt.synthetic=!0,this.mimicBrowserBehaviorBefore(evt,type,el),this.dispatchEvent(el,type,evt),this.isEventPrevented(evt)||this.mimicBrowserBehaviorAfter(evt,type,el)}),this.fireEvent("eventsimulated",evt,el,type,options),evt},createEvent:function(type,options,el){var event;if((event=/^textinput$/i.test(type)?this.createTextEvent(type,options,el):/^mouse(over|out|down|up|move|enter|leave)|contextmenu|wheel|(dbl)?click$/.test(type)||/^(ms)?pointer/i.test(type)?this.createMouseEvent(type,options,el):/^key(up|down|press)$/.test(type)?this.createKeyboardEvent(type,options,el):/^change$|^input$|^submit/.test(type)?this.createGenericEvent(type,options,el):this.createHtmlEvent(type,options,el))&&bowser.msie&&9<=bowser.version){var prev=event.preventDefault;event.preventDefault=function(){return arguments.callee.$prevented=!0,this.returnValue=!1,prev&&prev.apply(this,arguments)}}return event},isEventPrevented:function(event){return event.preventDefault&&"Boolean"==this.typeOf(event.preventDefault.$prevented)?event.preventDefault.$prevented:"Boolean"==this.typeOf(event.defaultPrevented)?event.defaultPrevented:!1===event.returnValue},createGenericEvent:function(type,options,el){var doc=el.ownerDocument;if(doc.createEvent&&"dispatchEvent"==this.getSimulateEventsWith()){var evt=doc.createEvent("Events");return evt.initEvent(type,!0,!0),evt}if(doc.createEventObject){var event=doc.createEventObject();return event.srcElement=el,event.bubbles=options.bubbles,event.cancelBubble=!options.bubbles,event.type=type,event}},createHtmlEvent:function(type,options,el){var doc=el.ownerDocument;if(doc.createEvent&&"dispatchEvent"==this.getSimulateEventsWith()){var evt=doc.createEvent("HTMLEvents");return evt.initEvent(type,!1,!1),evt}if(doc.createEventObject)return doc.createEventObject()},dispatchEvent:function(el,type,evt){if(el.dispatchEvent&&"dispatchEvent"==this.getSimulateEventsWith())el.dispatchEvent(evt);else{if(!el.fireEvent)throw"Can't dispatch event: "+type;try{var doc=this.global.document.documentElement,body=this.global.document.body;doc&&doc.scrollLeft||body&&body.scrollLeft;el.fireEvent("on"+type.toLowerCase(),evt)}catch(e){}}return evt},mimicBrowserBehaviorBefore:function(event,type,target){},mimicBrowserBehaviorAfter:function(event,type,target){var tagName=target.tagName.toLowerCase();switch(type){case"mousedown":this.isTextInput(target)&&this.mimicClearTextSelection(target);break;case"click":bowser.msie&&bowser.version<11&&"a"===tagName&&target.getAttribute("href")?this.mimicHashUpdate(target):"option"!==tagName||target.getAttribute("disabled")||this.mimicOptionSelect(target);break;case"dblclick":this.isTextInput(target)&&this.mimicDblClickTextSelection(target);break;case"keydown":var KeyCodes=Siesta.Test.UserAgent.KeyCodes().keys;event.keyCode===KeyCodes.BACKSPACE&&this.mimicHistoryChangeAfterBackspace(event,target)}},mimicClearTextSelection:function(target){var extVersion=this.global.Ext&&this.global.Ext.versions,isExtJS51=extVersion&&extVersion.extjs&&extVersion.extjs.equals("5.1.0.107");bowser.msie&&isExtJS51&&!(9<bowser.version)||(this.test.selectText(target,target.value.length-1,target.value.length),this.test.setCaretPosition(target,target.value.length))},mimicDblClickTextSelection:function(target){this.test.selectText(target)},mimicHashUpdate:function(el){var href=el.getAttribute("href").match(/#(.*)/);href&&(this.global.location.hash=href[1])},mimicHistoryChangeAfterBackspace:function(event,target){if(!bowser.webkit&&!bowser.blink){var doc=target.ownerDocument;if(!target.isContentEditable&&"on"!==doc.designMode.toLowerCase()&&!this.isTextInput(target)){var elWindow=target.ownerDocument.defaultView||target.ownerDocument.parentWindow;event.shiftKey?this.mimicNextHistory(elWindow):this.mimicPreviousHistory(elWindow)}}},mimicPreviousHistory:function(global){global.history.back()},mimicNextHistory:function(global){global.history.forward()},mimicOptionSelect:function(optionNode){var select=this.$(optionNode).closest("select")[0],oldValue=select.value;select.value=optionNode.value,oldValue!==optionNode.value&&this.simulateEvent(select,"change")}}}),Role("Siesta.Test.Simulate.Touch",{requires:[],has:{touchEventNamesMap:{lazy:"this.buildTouchEventNamesMap"},currentTouchId:1,activeTouches:Joose.I.Object,longPressDelay:{init:1500,is:"rw"},forceTouchEvents:bowser.chrome},methods:{simulateTap:function(context,options){var id,queue=new Siesta.Util.Queue({deferer:this.test.originalSetTimeout,deferClearer:this.test.originalClearTimeout,interval:30,observeTest:this.test}),me=this;return queue.addStep({processor:function(){id=me.touchStart(null,null,options,context)}}),queue.addStep({processor:function(){me.touchEnd(id,options)}}),new Promise(function(resolve,reject){queue.run(resolve)})},simulateDoubleTap:function(context,options){var id,queue=new Siesta.Util.Queue({deferer:this.test.originalSetTimeout,deferClearer:this.test.originalClearTimeout,interval:30,observeTest:this.test}),me=this;return queue.addStep({processor:function(){id=me.touchStart(null,null,options,context)}}),queue.addStep({processor:function(){me.touchEnd(id,options)}}),queue.addStep({processor:function(){id=me.touchStart(null,null,options,context)}}),queue.addStep({processor:function(){me.touchEnd(id,options)}}),new Promise(function(resolve,reject){queue.run(resolve)})},simulateLongPress:function(context,options){var id,queue=new Siesta.Util.Queue({deferer:this.test.originalSetTimeout,deferClearer:this.test.originalClearTimeout,interval:30,observeTest:this.test}),me=this;return queue.addStep({processor:function(){id=me.touchStart(null,null,options,context)}}),queue.addDelayStep(this.getLongPressDelay()),queue.addStep({processor:function(){me.touchEnd(id,options)}}),new Promise(function(resolve,reject){queue.run(resolve)})},simulatePinch:function(context1,context2,options){var id1,id2,queue=new Siesta.Util.Queue({deferer:this.test.originalSetTimeout,deferClearer:this.test.originalClearTimeout,interval:30,observeTest:this.test}),dx=context1.localXY[0]-context2.localXY[0],dy=context1.localXY[1]-context2.localXY[1],distance=Math.sqrt(dx*dx+dy*dy);distance<1&&(distance=1);var delta=(distance*scale-distance)/2,angle=Math.atan(dy/dx),x1=Math.round(context1.localXY[0]-delta*Math.cos(angle)),y1=Math.round(context1.localXY[1]-delta*Math.sin(angle)),x2=Math.round(context2.localXY[0]+delta*Math.cos(angle)),y2=Math.round(context2.localXY[1]+delta*Math.sin(angle)),options2=Joose.O.extend({},options);return queue.addStep({processor:function(){id1=me.touchStart(null,null,options,context1),id2=me.touchStart(null,null,options2,context2)}}),queue.addAsyncStep({processor:function(data){var move1Done=!1,move2Done=!1;me.touchMove(id1,x1,y1,function(){(move1Done=!0)&&move2Done&&data.next()},null,options),me.touchMove(id2,x2,y2,function(){move2Done=!0,move1Done&&move2Done&&data.next()},null,options2)}}),queue.addStep({processor:function(){me.touchEnd(id1,options),me.touchEnd(id2,options2)}}),new Promise(function(resolve,reject){queue.run(resolve)})},simulateTouchDrag:function(sourceXY,targetXY,options,dragOnly){var me=this;options=options||{};me.elementFromPoint(sourceXY[0],sourceXY[1],!0),me.elementFromPoint(targetXY[0],targetXY[1],!0);var id,queue=new Siesta.Util.Queue({deferer:this.test.originalSetTimeout,deferClearer:this.test.originalClearTimeout,interval:me.dragDelay,callbackDelay:me.afterActionDelay,observeTest:this.test});return queue.addStep({processor:function(){id=me.touchStart(sourceXY,null,options)}}),queue.addAsyncStep({processor:function(data){me.touchMove(id,targetXY[0],targetXY[1],options).then(data.next)}}),queue.addStep({processor:function(){dragOnly||me.touchEnd(id,options)}}),new Promise(function(resolve,reject){queue.run(function(){dragOnly?resolve(id):resolve()})})},touchStart:function(target,offset,options,context){context=context||this.test.getNormalizedTopElementInfo(target,!0,"touchStart",offset),options=Joose.O.extend({clientX:context.localXY[0],clientY:context.localXY[1]},options||{});var event=this.simulateTouchEventGeneric(context.el,"start",options);return event.pointerId||event.changedTouches[0].identifier},touchEnd:function(touchId,options){var touch=this.activeTouches[touchId];if(!touch)throw"Can't find active touch: "+touchId;options=Joose.O.extend({clientX:touch.clientX,clientY:touch.clientY},options||{});var target=touch.target;this.test.isInDom(target)||(touch.target=this.global.document.body),this.simulateTouchEventGeneric(touch.currentEl||touch.target,"end",options,{touchId:touchId})},touchMove:function(touchId,toX,toY,options){var touch=this.activeTouches[touchId];if(!touch)throw"Can't find active touch: "+touchId;var me=this,overEls=[];return this.movePointerTemplate({xy:[touch.clientX,touch.clientY],xy2:[toX,toY],options:options||{},overEls:overEls,interval:me.dragDelay,callbackDelay:me.afterActionDelay,pathBatchSize:me.pathBatchSize,onVoidOverEls:function(){return overEls=[]},onPointerEnter:function(el,options){},onPointerLeave:function(el,options){},onPointerOver:function(el,options){},onPointerOut:function(el,options){},onPointerMove:function(el,options){touch.clientX=options.clientX,touch.clientY=options.clientY,touch.pageX=me.viewportXtoPageX(options.clientX),touch.pageY=me.viewportYtoPageY(options.clientY),touch.currentEl=el,me.simulateTouchEventGeneric(el,"move",options,{touchId:touchId})}})},touchCancel:function(touchId,options){var touch=this.activeTouches[touchId];if(!touch)throw"Can't find active touch: "+touchId;this.simulateTouchEventGeneric(touch.currentEl||touch.target,"cancel",options,{touchId:touchId})},simulatePointerEventModern:function(target,type,options,simOptions){if(!(target=this.test.normalizeElement(target)))return!1;Siesta.Project.Browser.FeatureSupport().supports;if(options=options||{},/pointerdown$/i.test(type)&&(!("clientX"in options)||!("clientY"in options))){var center=this.test.findCenter(target);options=Joose.O.extend({clientX:center[0],clientY:center[1]},options)}var doc=this.global.document,event=new PointerEvent(type,{bubbles:!0,cancelable:!0,view:this.global,detail:options.detail,screenX:options.screenX,screenY:options.screenY,clientX:options.clientX,clientY:options.clientY,ctrlKey:options.ctrlKey||!1,altKey:options.altKey||!1,shiftKey:options.shiftKey||!1,metaKey:options.metaKey||!1,button:options.button,relatedTarget:options.relatedTarget||doc.documentElement,pointerId:simOptions.touchId||this.currentTouchId++,pointerType:4});return target.dispatchEvent(event),event},simulatePointerEvent:function(target,type,options,simOptions){var supports=Siesta.Project.Browser.FeatureSupport().supports;if(supports.PointerEvents&&this.bowser.chrome)return this.simulatePointerEventModern(target,type,options,simOptions);if(!(target=this.test.normalizeElement(target)))return!1;options=options||{};var doc=this.global.document,event=doc.createEvent(supports.PointerEvents?"PointerEvent":supports.MSPointerEvents?"MSPointerEvent":"MouseEvents");if(/pointerdown$/i.test(type)&&(!("clientX"in options)||!("clientY"in options))){var center=this.test.findCenter(target);options=Joose.O.extend({clientX:center[0],clientY:center[1]},options)}return event[supports.MSPointerEvents||supports.PointerEvents?"initPointerEvent":"initMouseEvent"](type,!0,!0,this.global,options.detail,options.screenX,options.screenY,options.clientX,options.clientY,options.ctrlKey||!1,options.altKey||!1,options.shiftKey||!1,options.metaKey||!1,options.button,options.relatedTarget||doc.documentElement,null,null,null,null,null,null,null,null,simOptions.touchId||this.currentTouchId++,4,null,null),supports.MSPointerEvents||supports.PointerEvents||(event.pointerId=simOptions.touchId||this.currentTouchId++),target.dispatchEvent(event),event},simulateTouchEvent:function(target,type,options,simOptions){options=options||{};var global=this.global,event=(global.document,new global.CustomEvent(type,{bubbles:!0,cancelable:!0}));target=this.test.normalizeElement(target);if("clientX"in options&&"clientY"in options)options.clientX,options.clientY;else{var center=this.test.findCenter(target);center[0],center[1]}var activeTouches=this.activeTouches,touch=simOptions.touch,touches=[],targetTouches=[];for(var id in activeTouches){var currentTouch=activeTouches[id];touches.push(currentTouch),currentTouch.target==target&&targetTouches.push(currentTouch)}return Joose.O.extend(event,{target:target,changedTouches:this.createTouchList([touch]),touches:this.createTouchList(touches),targetTouches:this.createTouchList(targetTouches),altKey:options.altKey,metaKey:options.metaKey,ctrlKey:options.ctrlKey,shiftKey:options.shiftKey}),target.dispatchEvent(event),event},createTouchList:function(touchList){var doc=this.global.document;if(doc.createTouch){for(var touches=[],i=0;i<touchList.length;i++){var touchCfg=touchList[i];touches.push(doc.createTouch(doc.defaultView||doc.parentWindow,touchCfg.target,touchCfg.identifier||this.currentTouchId++,touchCfg.pageX,touchCfg.pageY,touchCfg.screenX||touchCfg.pageX,touchCfg.screenY||touchCfg.pageY,touchCfg.clientX,touchCfg.clientY))}return doc.createTouchList.apply(doc,touches)}return touchList},createTouch:function(target,clientX,clientY){return{identifier:this.currentTouchId++,target:target,clientX:clientX,clientY:clientY,screenX:0,screenY:0,pageX:clientX,pageY:clientY}},buildTouchEventNamesMap:function(){var supports=Siesta.Project.Browser.FeatureSupport().supports;return supports.PointerEvents&&!this.forceTouchEvents?{start:"pointerdown",move:"pointermove",end:"pointerup",cancel:"pointercancel"}:supports.MSPointerEvents?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp",cancel:"MSPointerCancel"}:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}},simulateTouchEventGeneric:function(target,type,options,simOptions){simOptions=simOptions||{};var clientX,clientY;target=this.test.normalizeElement(target);if("clientX"in options&&"clientY"in options)clientX=options.clientX,clientY=options.clientY;else{var center=this.test.findCenter(target);clientX=center[0],clientY=center[1]}var touch,activeTouches=this.activeTouches;if("end"===type||"cancel"===type?(target=(touch=activeTouches[simOptions.touchId]).currentEl||touch.target,delete activeTouches[simOptions.touchId]):"start"==type?activeTouches[(touch=this.createTouch(target,clientX,clientY)).identifier]=touch:"move"==type&&((touch=activeTouches[simOptions.touchId]).clientX=options.clientX,touch.clientY=options.clientY),!touch)throw"Can't find active touch"+(simOptions.touchId?": "+simOptions.touchId:"");simOptions.touchId||(simOptions.touchId=touch.identifier),simOptions.touch=touch;var eventType=this.getTouchEventNamesMap()[type],supports=Siesta.Project.Browser.FeatureSupport().supports;return!supports.PointerEvents&&!supports.MSPointerEvents||this.forceTouchEvents?this.simulateTouchEvent(target,eventType,options,simOptions):this.simulatePointerEvent(target,eventType,options,simOptions)}}}),Class("Siesta.Test.Simulator",{does:[Siesta.Util.Role.CanGetType,Siesta.Test.Browser.Role.CanRebindJQueryContext,Siesta.Test.Simulate.Event,Siesta.Test.Simulate.Mouse,Siesta.Test.Simulate.Keyboard,Siesta.Test.Simulate.Touch],has:{type:"synthetic",test:null,global:null},methods:{initialize:function(){this.SUPER(),this.onBlur=this.onBlur.bind(this)},onTestLaunch:function(test){var me=this;me.test=test,me.global=test.global,"synthetic"===me.type&&(Siesta.Project.Browser.FeatureSupport().supports.inputFiresChangeAfterLosingFocus||me.global.document.documentElement.addEventListener("blur",me.onBlur,!0))},onBlur:function(e){e.target&&this.test.isTextInput(e.target)&&this.maybeMimicChangeEvent(e.target)},cleanup:function(){this.global&&this.global.document.documentElement.removeEventListener("blur",this.onBlur,!0),this.test=null,this.global=null},setSpeed:function(name){Joose.O.extend(this,Siesta.Test.Simulator.speedPresets[name])}}}),Siesta.Test.Simulator.speedPresets={slow:{actionDelay:100,afterActionDelay:100,dragDelay:25,pathBatchSize:5,mouseMovePrecision:1,mouseDragPrecision:1},speedRun:{actionDelay:1,afterActionDelay:100,dragDelay:10,pathBatchSize:30,mouseMovePrecision:1,mouseDragPrecision:1},turboMode:{actionDelay:1,afterActionDelay:1,dragDelay:0,pathBatchSize:100,mouseMovePrecision:1/0,mouseDragPrecision:1/0}},Class("Siesta.Test.SimulatorExtJS",{isa:Siesta.Test.Simulator,has:{simulateEventsWith:{is:"rw",lazy:function(){var isIE9=navigator.userAgent.match(/MSIE 9.0;/),Ext=this.global.Ext;if(!Ext||!Ext.getVersion)return"dispatchEvent";var extVersion=Ext.getVersion("extjs"),isBelowExt421=Boolean(extVersion&&extVersion.isLessThan&&extVersion.isLessThan("4.2.1.883"));return document.createElement("div").attachEvent&&(isIE9||isBelowExt421)?"fireEvent":"dispatchEvent"}}},methods:{simulateMouseClick:function(clickInfo,options){var me=this,el=clickInfo.el,Ext=this.global.Ext,isExt5=Ext&&Ext.getVersion&&Ext.getVersion("extjs")&&5==Ext.getVersion("extjs").major;if("fireEvent"!==this.getSimulateEventsWith()&&!isExt5||"checkbox"!==el.type&&"radio"!==el.type||el.disabled||el.readOnly)return this.SUPERARG(arguments);var oldState=el.checked;return this.SUPER(clickInfo,options).then(function(){if(el.checked===oldState){el.checked=!oldState;var optionsWithBubble=Joose.O.copy(options);optionsWithBubble.bubbles=!0,me.simulateEvent(el,"change",optionsWithBubble)}})}}}),Role("Siesta.Test.UserAgent.Mouse",{requires:[],has:{currentPosition:null,moveCursorBetweenPoints:!0,enableUnreachableClickWarning:!0,autoScrollElementsIntoView:!0,delayAfterScrollIntoView:200},methods:{setCursorPosition:function(x,y,callback){this.doMouseMove(this.simulator.currentPosition,[x,y],callback,null,null,{moveKind:"instant"})},moveMouseAlongPath:function(){return this.moveCursorAlongPath.apply(this,arguments)},moveCursorAlongPath:function(pathArray,callback){var me=this,queue=new Siesta.Util.Queue({deferer:this.originalSetTimeout,deferClearer:this.originalClearTimeout,interval:0,processor:function(data){var target,offset,isDelta,pathPoint=data.pathPoint;"Array"==me.typeOf(pathPoint)?"Array"==me.typeOf(pathPoint[0])?target=pathPoint[0]:"String"==me.typeOf(pathPoint[0])?(target=pathPoint[0],offset=3==pathPoint.length?[pathPoint[1],pathPoint[2]]:null):(isDelta=!0,target=pathPoint):pathPoint.by?(isDelta=!0,target=pathPoint.by):(target=pathPoint.t||pathPoint.target,offset=pathPoint.o||pathPoint.offset),isDelta?me.moveMouseBy(target,data.next,me):me.moveMouseTo(target,data.next,me,offset)}});return Joose.A.each(pathArray,function(pathPoint){queue.addStep({isAsync:!0,pathPoint:pathPoint})}),new Promise(function(resolve,_reject){queue.run(function(){me.processCallbackFromTest(callback,null,me),resolve()})})},moveMouseTo:function(target,callback,scope,offset,waitForTarget,options){if(!target)throw new Error("Trying to call `moveMouseTo` without a target");if(!1!==waitForTarget)return this.waitForTargetAndSyncMousePosition(target,offset,function(){callback.call(scope||this)},[],!1,void 0,options);var me=this;return new Promise(function(resolve,_reject){var data=me.getNormalizedTopElementInfo(target,!0,"moveMouseTo",offset);data?me.syncCursor(data.globalXY,function(){callback&&callback.call(scope||me),resolve()},options):(callback&&callback.call(scope||me),resolve())})},moveCursorTo:function(target,callback,scope,offset){this.moveMouseTo.apply(this,arguments)},moveMouseBy:function(delta,callback,scope,options){this.moveCursorBy.apply(this,arguments)},moveCursorBy:function(delta,callback,scope,options){if(!delta)throw"Trying to call moveCursorBy without relative distances";var target=[this.simulator.currentPosition[0]+delta[0],this.simulator.currentPosition[1]+delta[1]];return this.doMouseMove(this.simulator.currentPosition,target,callback,scope,void 0,options)},doMouseMove:function(xy,xy2,callback,scope,params,options){var promise=this.simulator.simulateMouseMove(xy2[0],xy2[1],options,params);return this.runPromiseAsync(promise,"mousemove",callback,scope)},syncCursor:function(toXY,callback,options){var fromXY=this.simulator.currentPosition;toXY[0]!==fromXY[0]||toXY[1]!==fromXY[1]?this.doMouseMove(fromXY,toXY,callback,this,void 0,options):callback&&callback()},runPromiseAsync:function(promise,actionDesc,callback,callbackScope,errback){var me=this,async=this.beginAsync(null,function(){return me.fail(me.formatString("Action `{actionDesc}` failed to complete within {time}ms",{actionDesc:actionDesc,time:this.defaultTimeout})),!0});return promise.then(function(result){me.endAsync(async),me.processCallbackFromTest(callback,void 0!==result?[result]:[],callbackScope||me)},function(exception){me.endAsync(async),errback?errback(exception):me.isFinished()||(me.fail("Command failed: "+exception),me.processCallbackFromTest(callback,[],callbackScope||me))})},waitForTargetAndSyncMousePosition:function(target,offset,method,args,waitForTargetTop,syncMousePosition,options){var originalXY,targetIsNotAPoint="Array"!=this.typeOf(target),oldSuppressPassedWaitForAssertion=this.suppressPassedWaitForAssertion;this.suppressPassedWaitForAssertion=!0;var me=this;return new Promise(function(resolve,reject){me.chain({waitForAnimations:[]},targetIsNotAPoint&&{waitForElementVisible:target},me.autoScrollElementsIntoView?function(next){!0===me.scrollTargetIntoView(target,offset)?me.waitFor(me.delayAfterScrollIntoView,next):next()}:null,function(next){var data=me.getNormalizedTopElementInfo(target,!0,method.toString(),offset);data?(originalXY=data.globalXY,me.moveCursorBetweenPoints&&!1!==syncMousePosition?me.syncCursor(originalXY,next,options):next()):me.waitForTarget(target,function(){var data=me.getNormalizedTopElementInfo(target,!0,method.toString(),offset);originalXY=data.globalXY,me.moveCursorBetweenPoints&&!1!==syncMousePosition?me.syncCursor(originalXY,next,options):next()})},!1!==waitForTargetTop&&targetIsNotAPoint&&function(next){me.waitForTarget(target,next,me,null,offset)},function(_next){var data=me.getNormalizedTopElementInfo(target,!0,method.toString(),offset),newXY=data&&data.globalXY;!targetIsNotAPoint||data&&originalXY[0]===newXY[0]&&originalXY[1]===newXY[1]?(me.suppressPassedWaitForAssertion=oldSuppressPassedWaitForAssertion,method&&method.apply&&method.apply(me,args),resolve()):(me.diag(Siesta.Resource("Siesta.Test.Browser","targetMoved")),me.waitFor(100,function(){me.waitForTargetAndSyncMousePosition(target,offset,method,args,waitForTargetTop,syncMousePosition).then(resolve,reject)}))})})},getCursorPagePosition:function(){return[this.viewportXtoPageX(this.simulator.currentPosition[0]),this.viewportYtoPageY(this.simulator.currentPosition[1])]},genericMouseAction:function(el,callback,scope,options,actionName,offset,waitForTargetAndSyncMousePosition){var me=this;"Function"==this.typeOf(el)&&(scope=callback,callback=el,el=null),waitForTargetAndSyncMousePosition=waitForTargetAndSyncMousePosition&&Boolean(el),el=el||this.getCursorPagePosition();var targetCheckPromise=!1!==waitForTargetAndSyncMousePosition?this.waitForTargetAndSyncMousePosition(el,offset,actionName,void 0,void 0,void 0,options):Promise.resolve();return me.runPromiseAsync(targetCheckPromise.then(function(){options=options?Joose.O.copy(options):{};var data=me.getNormalizedTopElementInfo(el,!0,actionName,offset);if(data)return data.originalEl=el,data.method=actionName,data.offset=offset,options.clientX=null!=options.clientX?options.clientX:data.localXY[0],options.clientY=null!=options.clientY?options.clientY:data.localXY[1],options.testUniqueId=me.uniqueId,me.simulator[actionName](data,options)}),"generic click",callback,scope)},click:function(el,callback,scope,options,offset,waitForTarget){return this.genericMouseAction(el,callback,scope,options,"simulateMouseClick",offset,waitForTarget)},rightClick:function(el,callback,scope,options,offset,waitForTarget){return this.genericMouseAction(el,callback,scope,options,"simulateRightClick",offset,waitForTarget)},doubleClick:function(el,callback,scope,options,offset,waitForTarget){return this.genericMouseAction(el,callback,scope,options,"simulateDoubleClick",offset,waitForTarget)},mouseDown:function(el,options,offset,callback,scope,performTargetCheck){return this.genericMouseAction(el,callback,scope,options,"simulateMouseDown",offset,performTargetCheck)},mouseUp:function(el,options,offset,callback,scope){return this.genericMouseAction(el,callback,scope,options,"simulateMouseUp",offset,!0)},dragTo:function(source,target,callback,scope,options,dragOnly,sourceOffset,targetOffset){var me=this;if(!target)throw new Error("No drag target defined");return source=source||me.getCursorPagePosition(),new Promise(function(resolve,reject){me.chain({mouseDown:source,offset:sourceOffset,options:options},function(next){var data=me.getNormalizedTopElementInfo(target,!0,"dragTo",targetOffset);target=data.globalXY,next()},{moveCursorTo:function(){return target},options:options},dragOnly?null:{mouseUp:null,options:options},function(){me.processCallbackFromTest(callback,null,scope||me),resolve()})})},dragBy:function(source,delta,callback,scope,options,dragOnly,offset){var me=this;if(!delta)throw new Error("No drag delta defined");return source=source||this.getCursorPagePosition(),new Promise(function(resolve,reject){me.chain({mouseDown:source,offset:offset,options:options},{moveCursorBy:delta,options:options},dragOnly?null:{mouseUp:null,options:options},function(){me.processCallbackFromTest(callback,null,scope||me),resolve()})})},wheel:function(el,callback,scope,options,offset,waitForTarget){return this.genericMouseAction(el,callback,scope,options,"simulateMouseWheel",offset,waitForTarget)}}}),Role("Siesta.Test.UserAgent.Keyboard",{requires:["normalizeElement","runPromiseAsync","activeElement"],does:[Siesta.Util.Role.CanFormatStrings,Siesta.Test.Browser.Role.CanWorkWithKeyboard],has:{},methods:{type:function(el,text,callback,scope,options,clearExisting,performTargetCheck){if(null==text)throw"Must supply a string to type";el||(performTargetCheck=!1),el=el||this.activeElement();var targetCheckPromise=!1!==performTargetCheck?this.waitForTargetAndSyncMousePosition(el,null,"Type: "+text,[],!1,!1):Promise.resolve(),me=this;return me.runPromiseAsync(targetCheckPromise.then(function(){if((el=me.normalizeElement(el))&&!el.disabled){clearExisting&&(el.value="");var queue=new Siesta.Util.Queue({deferer:me.originalSetTimeout,deferClearer:me.originalClearTimeout,interval:me.simulator.actionDelay,callbackDelay:me.simulator.afterActionDelay,observeTest:me});return queue.addStep({processor:function(){me.focus(el)}}),bowser.msie&&queue.addStep({processor:function(){me.focus(el)}}),queue.addStep({isAsync:!0,processor:function(stepData){var promise=me.simulator.simulateType(text,options,{el:el});me.runPromiseAsync(promise,"",stepData.next)}}),new Promise(function(resolve,reject){queue.run(function(){resolve()})})}}),"type : `"+text+"`",callback,scope)},keyPress:function(el,key,options,callback,scope){return"function"==typeof options&&(callback=options,options=void 0),this.type(el,key,callback,scope,options)}}}),Role("Siesta.Test.UserAgent.Touch",{requires:["normalizeElement"],has:{notSupportedWarned:!1},methods:{checkTouchEventsSupport:function(){var supports=Siesta.Project.Browser.FeatureSupport().supports,root=this.getRootTest();supports.TouchEvents||supports.PointerEvents||supports.MSPointerEvents||root.notSupportedWarned||(root.notSupportedWarned=!0,this.warn("Touch events are not supported by browser. For Chrome, you can enable them, by launching it with: --args --touch-events"))},tap:function(target,callback,scope,options,offset,performTargetCheck){if(this.checkTouchEventsSupport(),target=target||this.getCursorPagePosition(),!1!==performTargetCheck&&callback)this.waitForTargetAndSyncMousePosition(target,offset,this.tap,[target,callback,scope,options,offset,!1]);else{var context=this.getNormalizedTopElementInfo(target,!0,"tap",offset);context?this.runPromiseAsync(this.simulator.simulateTap(context,options),"tap",callback,scope):callback&&callback.call(scope||this)}},doubleTap:function(target,callback,scope,options,offset,performTargetCheck){if(this.checkTouchEventsSupport(),target=target||this.getCursorPagePosition(),!1!==performTargetCheck&&callback)this.waitForTargetAndSyncMousePosition(target,offset,this.doubleTap,[target,callback,scope,options,offset,!1]);else{var context=this.getNormalizedTopElementInfo(target,!0,"doubleTap",offset);context?this.runPromiseAsync(this.simulator.simulateDoubleTap(context,options),"doubleTap",callback,scope):callback&&callback.call(scope||this)}},longpress:function(){return this.longPress.apply(this,arguments)},longPress:function(target,callback,scope,options,offset,performTargetCheck){if(this.checkTouchEventsSupport(),target=target||this.getCursorPagePosition(),!1!==performTargetCheck&&callback)this.waitForTargetAndSyncMousePosition(target,offset,this.longPress,[target,callback,scope,options,offset,!1]);else{var context=this.getNormalizedTopElementInfo(target,!0,"longPress",offset);context?this.runPromiseAsync(this.simulator.simulateLongPress(context,options),"longPress",callback,scope):callback&&callback.call(scope||this)}},pinch:function(target1,target2,scale,callback,scope,options,offset1,offset2){this.checkTouchEventsSupport();var me=this;"Number"==this.typeOf(target2)&&(offset2=offset1,offset1=options,options=scope,scope=callback,callback=scale,scale=target2,target2=target1),null==target2&&(target2=target1),target1!=target2||offset1||offset2||(offset1=["25%","50%"],offset2=["75%","50%"]);var context1=this.getNormalizedTopElementInfo(target1,!0,"pinch: target1",offset1),context2=this.getNormalizedTopElementInfo(target2,!0,"pinch: target2",offset2);if(context1&&context2)this.runPromiseAsync(this.simulator.simulatePinch(context1,context2,options),"pinch",callback,scope);else{var R=Siesta.Resource("Siesta.Test.Browser");this.waitFor({method:function(){var el1=me.normalizeElement(target1,!0),el2=me.normalizeElement(target2,!0);return el1&&me.elementIsTop(el1,!0,offset)&&el2&&me.elementIsTop(el2,!0,offset)},callback:function(){me.pinch(target1,target2,scope,callback,scope,options,offset1,offset2)},assertionName:"waitForTarget",description:" "+R.get("target")+' "'+target1+'" and "'+target2+'" '+R.get("toAppear")})}},touchDragTo:function(source,target,callback,scope,options,dragOnly,sourceOffset,targetOffset){var me=this,context1=this.getNormalizedTopElementInfo(source,!0,"touchDragTo: source",sourceOffset),context2=this.getNormalizedTopElementInfo(target,!0,"touchDragTo: target",targetOffset);if(context1&&context2)this.runPromiseAsync(this.simulator.simulateTouchDrag(context1.localXY,context2.localXY,options,dragOnly),"touchDragTo",callback,scope);else{var R=Siesta.Resource("Siesta.Test.Browser");this.waitFor({method:function(){var el1=me.normalizeElement(source,!0),el2=me.normalizeElement(target,!0);return el1&&me.elementIsTop(el1,!0,sourceOffset)&&el2&&me.elementIsTop(el2,!0,targetOffset)},callback:function(){me.touchDragTo(source,target,callback,scope,options,dragOnly,sourceOffset,targetOffset)},assertionName:"waitForTarget",description:" "+R.get("target")+' "'+source+'" and "'+target+'" '+R.get("toAppear")})}},touchDragBy:function(source,delta,callback,scope,options,dragOnly,offset){var context=this.getNormalizedTopElementInfo(source,!0,"touchDragBy",offset);if(context){var sourceXY=context.globalXY,targetXY=[sourceXY[0]+delta[0],sourceXY[1]+delta[1]];this.runPromiseAsync(this.simulator.simulateTouchDrag(sourceXY,targetXY,options,dragOnly),"touchDragBy",callback,scope)}else this.waitForTarget(source,function(){this.touchDragBy(source,delta,callback,scope,options,dragOnly,offset)},this,null,offset)},swipe:function(target,direction,callback,scope,options,performTargetCheck){if(this.checkTouchEventsSupport(),target=target||this.getCursorPagePosition(),!1!==performTargetCheck&&callback)this.waitForTargetAndSyncMousePosition(target,null,this.swipe,[target,direction,callback,scope,options,!1]);else{var context=this.getNormalizedTopElementInfo(target,!0,"swipe");if(context){var start,end,Ext=this.Ext(),R=Siesta.Resource("Siesta.Test.SenchaTouch"),box=Ext.fly(context.el).getBox(),x=box.x,y=box.y,width=box.width,height=box.height,centerX=x+width/2,centerY=y+height/2;switch(direction){case"u":case"up":start=[centerX,y+.9*height],(end=[centerX,y+.1*height])[1]=Math.min(start[1]-100,end[1]);break;case"d":case"down":start=[centerX,y+.1*height],(end=[centerX,y+.9*height])[1]=Math.max(start[1]+100,end[1]);break;case"r":case"right":start=[x+.1*width,centerY],(end=[x+.9*width,centerY])[0]=Math.max(start[0]+100,end[0]);break;case"l":case"left":start=[x+.9*width,centerY],(end=[x+.1*width,centerY])[0]=Math.min(start[0]-100,end[0]);break;default:throw R.get("invalidSwipeDir")+": "+direction}this.touchDragTo(start,end,callback,scope,options)}else callback&&callback.call(scope||this)}}}}),Role("Siesta.Test.TextSelection",{methods:{getSelectedText:function(el){if("selectionStart"in(el=this.normalizeElement(el)))try{return el.value.substring(el.selectionStart,el.selectionEnd)}catch(e){}var win=this.global,doc=win.document;return win.getSelection?win.getSelection().toString():doc.getSelection?doc.getSelection():doc.selection?doc.selection.createRange().text:void 0},selectText:function(el,start,end,callback){if((el=this.normalizeElement(el,!0))&&this.elementSupportsSelection(el)){var v=el.value||el.innerHTML,doFocus=!0;if(0<v.length){if(start=void 0===start?0:start,end=void 0===end?v.length:end,el.setSelectionRange)try{el.setSelectionRange(start,end)}catch(e){}else if(el.createTextRange){var R=el.createTextRange();R.moveStart("character",start),R.moveEnd("character",end-v.length),R.select()}doFocus=bowser.gecko||bowser.opera}doFocus&&this.focus(el)}callback&&callback.call(this)},getCaretPosition:function(el){var pos,win=this.global,document=win.document;if("selectionStart"in el)try{pos=el.selectionStart}catch(e){pos=null}else if(win.getSelection&&this.isEditableNode(el)){var sel=win.getSelection();if(sel.rangeCount){var range=sel.getRangeAt(0);range.commonAncestorContainer.parentNode==el&&(pos=range.endOffset)}}else if(document.selection){this.focus(el);var oSel=document.selection.createRange();oSel.moveStart("character",-el.value.length),pos=oSel.text.length}return pos},setCaretPosition:function(el,caretPos){if(el.createTextRange)try{var range=el.createTextRange();range.move("character",caretPos),range.select()}catch(e){}else if(el.setSelectionRange){this.focus(el);try{el.setSelectionRange(caretPos,caretPos)}catch(e){}}else this.focus(el)},moveCaretPosition:function(el,distance){var pos=Math.min(Math.max(0,this.getCaretPosition(el)+distance),el.value.length);this.setCaretPosition(el,pos)},elementSupportsSelection:function(el){var tagName=el.tagName.toLowerCase();return"textarea"===tagName||"input"===tagName&&/^text|password|tel|url|search$/i.test(el.getAttribute("type"))}}}),Role("Siesta.Test.Element",{does:[Siesta.Util.Role.CanCalculatePageScroll,Siesta.Util.Role.Dom],requires:["typeOf","chain","normalizeElement"],has:{allowMonkeyToClickOnAnchors:!1,allowedCharacters:function(){return{special:"ENTER/ESCAPE/PAGE-UP/PAGE-DOWN/END/HOME/UP/RIGHT/DOWN/LEFT/INSERT/DELETE",punctuation:".,/()[]{}\\\"'`~!?@#$%^&_=+-",normal:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"}}},methods:{findCenter:function(target,local){return this.getTargetCoordinate(target,local)},isInDom:function(el){var doc=el.ownerDocument;if(!doc)return!1;for(;el&&el!=doc.body;)el=el.parentNode;return Boolean(el)},normalizeOffset:function(offset,$el){var parts;"Function"==this.typeOf(offset)&&(offset=offset.call(this)),offset=offset&&offset.slice()||["50%","50%"];var rect=this.getBoundingClientRect($el[0]),width=Math.floor(rect.width);width--;var height=Math.floor(rect.height);return height--,"string"==typeof offset[0]&&(parts=offset[0].split("%"),offset[0]=parseInt(offset[0].match(/\d+/)[0],10)*width/100,parts[1]&&(offset[0]+=parseInt(parts[1]))),offset[0]=Math.round(offset[0]),"string"==typeof offset[1]&&(parts=offset[1].split("%"),offset[1]=parseInt(offset[1].match(/\d+/)[0],10)*height/100,parts[1]&&(offset[1]+=parseInt(parts[1]))),offset[1]=Math.round(offset[1]),offset},getTargetCoordinate:function(target,local,offset){var el=this.normalizeElement(target),$el=this.$(el),elOffset=$el.offset(),elDoc=el.ownerDocument,elWin=elDoc.defaultView||elDoc.parentWindow,xy=[this.pageXtoViewportX(elOffset.left,elWin),this.pageYtoViewportY(elOffset.top,elWin)];if(offset=this.normalizeOffset(offset,$el),xy[0]+=offset[0],xy[1]+=offset[1],!1===local&&elWin!==this.global){var offsetsToTop=this.$(elWin.frameElement).offset();xy[0]+=this.pageXtoViewportX(offsetsToTop.left),xy[1]+=this.pageYtoViewportY(offsetsToTop.top)}return xy},isElementVisible:function(el){if((el=this.normalizeElement(el))&&"option"===el.nodeName.toLowerCase()&&(el=this.$(el).closest("select")[0]),el){try{if(window.SVGElement&&el instanceof this.global.SVGElement)return"none"!==el.style.display&&"hidden"!==el.style.visibility}catch(e){}return this.$(el).is(":visible")&&"hidden"!==this.$(el).css("visibility")}return!1},assertTextPresent:function(text,description){this.like(this.global.document.body.innerText,text,description)},contentLike:function(el,text,description){el=this.normalizeElement(el),this.like(el.innerHTML,text,description)},contentNotLike:function(el,text,description){el=this.normalizeElement(el),this.unlike(el.innerHTML,text,description)},waitForContentLike:function(el,text,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Element");return el=this.normalizeElement(el),this.waitFor({method:function(){return el.innerHTML.match(text)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForContentLike",description:" "+R.get("elementContent")+' "'+text+'" '+R.get("toAppear")})},waitForContentNotLike:function(el,text,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Element");return el=this.normalizeElement(el),this.waitFor({method:function(){return!el.innerHTML.match(text)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForContentNotLike",description:" "+R.get("elementContent")+' "'+text+'" '+R.get("toDisappear")})},getRandomTypeString:function(length){for(var allowedCharacters=this.allowedCharacters,special=allowedCharacters.special.split("/"),punctuation=allowedCharacters.punctuation,normal=allowedCharacters.normal,total=special.length+punctuation.length+normal.length,str="",i=0;i<length;i++){var index=this.randomBetween(0,total-1);index<normal.length?str+=normal.substr(index,1):(index-=normal.length)<punctuation.length?str+=punctuation.substr(index,1):str+="["+special[index-=punctuation.length]+"]"}return str},monkeyTest:function(el,nbrInteractions,description,callback,scope,stepCallback){var skipTargets;1===arguments.length?(nbrInteractions=el.nbrInteractions,description=el.description,callback=el.callback,scope=el.scope,stepCallback=el.stepCallback,skipTargets=el.skipTargets,el=el.target):"function"==typeof nbrInteractions?(callback=nbrInteractions,scope=description,description=""):"function"==typeof description&&(callback=description,description=""),(skipTargets=skipTargets||[]).push("a"),nbrInteractions="number"==typeof nbrInteractions?nbrInteractions:30,el=this.normalizeElement(el,!1,!0),this.suppressPassedWaitForAssertion=!0;var global=this.global,isBody=el==global.document.body,me=this,offset=me.$(el).offset(),right=offset.left+me.$(isBody?global:el).width(),bottom=offset.top+me.$(isBody?global:el).height(),actionLog=[],R=Siesta.Resource("Siesta.Test.Element"),queue=new Siesta.Util.Queue({deferer:me.originalSetTimeout,deferClearer:me.originalClearTimeout,interval:me.actionDelay,observeTest:this,processor:function(data){if(me.nbrExceptions||me.failed)assertionChecker(),queue.abort();else{var async=me.beginAsync(null,function(test){return test.fail(description||R.get("monkeyNoExceptions"),R.get("monkeyActionLog")+":"+JSON.stringify(actionLog)),!0}),next=data.next;data.next=function(){stepCallback&&stepCallback(data),me.endAsync(async),next()},data.action(data)}}}),dummy=[];dummy.length=nbrInteractions;function ignoreAction(data,i){var target=me.normalizeElement(data.dragFrom||data.xy),dragToTarget=data.dragTo&&me.normalizeElement(data.dragTo);for(i=0;i<skipTargets.length;i++)for(var toSkip=me.$(skipTargets[i],el),j=0;j<toSkip.length;j++){var skip=toSkip[j];if(target&&(target==skip||me.contains(skip,target))||dragToTarget&&(dragToTarget==skip||me.contains(skip,dragToTarget)))return data.next(),1}}Joose.A.each(dummy,function(value,i){queue.addAsyncStep({action:function(data){me.waitForSelector("body",data.next)}});var xy=[me.randomBetween(offset.left,right),me.randomBetween(offset.top,bottom)];switch(me.randomBetween(0,4)){case 0:queue.addAsyncStep({action:function(data){ignoreAction(data)||(actionLog.push({click:xy}),me.click(data.xy,data.next))},xy:xy});break;case 1:queue.addAsyncStep({action:function(data){ignoreAction(data)||(actionLog.push({doubleclick:xy}),me.doubleClick(data.xy,data.next))},xy:xy});break;case 2:queue.addAsyncStep({action:function(data){ignoreAction(data)||("native"!=me.simulator.type&&"oncontextmenu"in window?(actionLog.push({rightclick:xy}),me.rightClick(data.xy,data.next)):(actionLog.push({click:xy}),me.click(data.xy,data.next)))},xy:xy});break;case 3:var dragTo=[me.randomBetween(offset.left,right),me.randomBetween(offset.top,bottom)];queue.addAsyncStep({action:function(data){ignoreAction(data)||(actionLog.push({action:"drag",target:xy,to:dragTo}),me.dragTo(data.dragFrom,data.dragTo,data.next))},dragFrom:xy,dragTo:dragTo});break;case 4:var text=me.getRandomTypeString(15);queue.addAsyncStep({action:function(data){ignoreAction(data)||(actionLog.push({click:xy}),me.click(data.xy,function(){me.waitForSelector("body",function(){actionLog.push({type:text.replace("'","\\'")}),me.type(null,text,data.next)})}))},xy:xy})}});var checkerActivated=!1,assertionChecker=function(){checkerActivated=!0,me.nbrExceptions||me.failed?me.fail(description||R.get("monkeyNoExceptions"),R.get("monkeyActionLog")+":"+JSON.stringify(actionLog)):me.pass(description||R.get("monkeyNoExceptions"))};this.on("beforetestfinalizeearly",assertionChecker),queue.run(function(){checkerActivated||(me.un("beforetestfinalizeearly",assertionChecker),assertionChecker()),me.suppressPassedWaitForAssertion=!1,me.processCallbackFromTest(callback,[actionLog],scope||me)})},hasCls:function(el,cls,description){var R=Siesta.Resource("Siesta.Test.Element");el=this.normalizeElement(el),this.$(el).hasClass(cls)?this.pass(description,{descTpl:R.get("elementHasClass")+" {cls}",cls:cls}):this.fail(description,{assertionName:"hasCls",got:el.className,gotDesc:R.get("elementClasses"),need:cls,needDesc:R.get("needClass")})},hasNotCls:function(el,cls,description){var R=Siesta.Resource("Siesta.Test.Element");el=this.normalizeElement(el),this.$(el).hasClass(cls)?this.fail(description,{assertionName:"hasNotCls",got:el.className,gotDesc:R.get("elementClasses"),annotation:R.get("elementHasClass")+" ["+cls+"]"}):this.pass(description,{descTpl:R.get("elementHasNoClass")+" {cls}",cls:cls})},hasStyle:function(el,property,value,description){var R=Siesta.Resource("Siesta.Test.Element");el=this.normalizeElement(el),this.$(el).css(property)===value?this.pass(description,{descTpl:R.get("hasStyleDescTpl"),value:value,property:property}):this.fail(description,{assertionName:"hasStyle",got:this.$(el).css(property),gotDesc:R.get("elementStyles"),need:value,needDesc:R.get("needStyle")})},hasNotStyle:function(el,property,value,description){var R=Siesta.Resource("Siesta.Test.Element");el=this.normalizeElement(el),this.$(el).css(property)!==value?this.pass(description,{descTpl:R.get("hasNotStyleDescTpl"),value:value,property:property}):this.fail(description,{assertionName:"hasNotStyle",got:el.style.toString(),gotDesc:R.get("elementStyles"),annotation:R.get("hasTheStyle")+" ["+property+"]"})},waitForSelectorAt:function(xy,selector,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Element");if(!selector)throw R.get("noCssSelector");var me=this;return this.waitFor({method:function(){var el=me.elementFromPoint(xy[0],xy[1],!0);if(el&&me.$(el).is(selector))return el},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForSelectorAt",description:" "+R.get("selector")+' "'+selector+'" '+R.get("toAppearAt")+": ["+xy.toString()+"]"})},waitForSelectorAtCursor:function(selector,callback,scope,timeout){return this.waitForSelectorAt(this.simulator.currentPosition,selector,callback,scope,timeout)},waitForSelector:function(selector,root,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Element"),me=this;if(!selector)throw R.get("noCssSelector");return"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=null),root=root&&this.normalizeElement(root),this.waitFor({method:function(){var result=me.$(selector,root);if(0<result.length)return result},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForSelector",description:" "+R.get("selector")+' "'+selector+'" '+R.get("toAppear")})},waitForSelectors:function(selectors,root,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Element");if(selectors.length<1)throw R.get("waitForSelectorsBadInput");"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=null),root=root&&this.normalizeElement(root);var me=this;return this.waitFor({method:function(){var allPresent=!0;return Joose.A.each(selectors,function(selector){if(0===me.$(selector,root).length)return allPresent=!1}),allPresent},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForSelectors",description:" "+R.get("selectors")+' "'+selectors+'" '+R.get("toAppear")})},waitForSelectorNotFound:function(selector,root,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Element"),me=this;if(!selector)throw"A CSS selector must be supplied";return"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=null),root=root&&this.normalizeElement(root),this.waitFor({method:function(){return 0===me.$(selector,root).length},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForSelectorNotFound",description:" "+R.get("selector")+' "'+selector+'" '+R.get("toDisappear")})},waitForElementVisible:function(el,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Element");return this.waitFor({method:function(){var normalized=this.normalizeElement(el,!0);if(normalized&&this.isElementVisible(normalized))return normalized},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForElementVisible",description:" "+R.get("element")+' "'+el.toString()+'" '+R.get("toAppear")})},waitForElementNotVisible:function(el,callback,scope,timeout){el=this.normalizeElement(el);var R=Siesta.Resource("Siesta.Test.Element"),me=this;return this.waitFor({method:function(){return!me.isElementVisible(el)&&el},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForElementNotVisible",description:" "+R.get("element")+' "'+el.toString()+'" '+R.get("toDisappear")})},waitForElementTop:function(el,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Element");return this.waitFor({method:function(){var normalized=this.normalizeElement(el,!0);if(normalized&&this.elementIsTop(normalized,!0))return normalized},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForElementTop",description:" "+R.get("element")+' "'+el.toString()+'" '+R.get("toBeTopEl")})},waitForElementNotTop:function(el,callback,scope,timeout){el=this.normalizeElement(el);var R=Siesta.Resource("Siesta.Test.Element"),me=this;return this.waitFor({method:function(){if(!me.elementIsTop(el,!0)){var center=me.findCenter(el);return me.elementFromPoint(center[0],center[1],!0)}},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForElementNotTop",description:" "+R.get("element")+' "'+el.toString()+'" '+R.get("toNotBeTopEl")})},elementIsVisible:function(el,description){el=this.normalizeElement(el,!0,!1,!1,{ignoreNonVisible:!1}),this.ok(el&&this.isElementVisible(el),description)},elementIsNotVisible:function(el,description){el=this.normalizeElement(el,!1,!1,!1,{ignoreNonVisible:!1}),this.notOk(this.isElementVisible(el),description)},elementIsTop:function(el,allowChildren,offset){(el=this.normalizeElement(el))&&"option"===el.nodeName.toLowerCase()&&(el=this.$(el).closest("select")[0]);var elDoc=el.ownerDocument,localPoint=this.getTargetCoordinate(el,!0,offset),foundEl=elDoc.elementFromPoint(localPoint[0],localPoint[1]);return foundEl&&(foundEl===el||allowChildren&&0<this.$(foundEl).closest(el).length)},isOffsetInsideElementBox:function(el,offset){if(!offset)return!0;var $el=this.$(this.normalizeElement(el)),w=$el.outerWidth(),h=$el.outerHeight();return 0<=(offset=this.normalizeOffset(offset,$el))[0]&&offset[0]<w&&0<=offset[1]&&offset[1]<h},elementIsAt:function(el,xy,allowChildren,description){el=this.normalizeElement(el);var foundEl=this.elementFromPoint(xy[0],xy[1],!0),R=Siesta.Resource("Siesta.Test.Element");foundEl?allowChildren?foundEl===el||0<this.$(foundEl).closest(el).length?this.pass(description,{descTpl:R.get("elementIsAtDescTpl"),x:xy[0],y:xy[1]}):this.fail(description,{assertionName:"elementIsAt",got:foundEl,gotDesc:R.get("topElement"),need:el,needDesc:R.get("allowChildrenDesc"),annotation:R.get("allowChildrenAnnotation")}):foundEl===el?this.pass(description,{descTpl:R.get("elementIsAtPassTpl"),x:xy[0],y:xy[1]}):this.fail(description,{assertionName:"elementIsAt",got:foundEl,gotDesc:R.get("topElement"),need:el,needDesc:"Should be",annotation:R.get("noChildrenFailAnnotation")}):this.fail(description,{assertionName:"elementIsAt",got:{x:xy[0],y:xy[1]},gotDesc:R.get("Position"),annotation:R.get("noElementAtPosition")})},elementIsTopElement:function(el,allowChildren,description,strict){if(el=this.normalizeElement(el),strict){var o=this.$(el).offset(),R=Siesta.Resource("Siesta.Test.Element"),region_top=o.top,region_right=o.left+this.$(el).outerWidth(),region_bottom=o.top+this.$(el).outerHeight(),region_left=o.left;this.elementIsAt(el,[region_left+1,region_top+1],allowChildren,description+" "+R.get("topLeft")),this.elementIsAt(el,[region_left+1,region_bottom-1],allowChildren,description+" "+R.get("bottomLeft")),this.elementIsAt(el,[region_right-1,region_top+1],allowChildren,description+" "+R.get("topRight")),this.elementIsAt(el,[region_right-1,region_bottom-1],allowChildren,description+" "+R.get("bottomRight"))}else this.elementIsAt(el,this.findCenter(el),allowChildren,description)},elementIsNotTopElement:function(el,allowChildren,description){el=this.normalizeElement(el);var center=this.findCenter(el),foundEl=this.elementFromPoint(center[0],center[1],!0);if(foundEl)allowChildren?this.ok(foundEl!==el&&0===this.$(foundEl).closest(el).length,description):this.isnt(foundEl,el,description);else{var R=Siesta.Resource("Siesta.Test.Element");this.pass(description,{descTpl:R.get("elementIsNotTopElementPassTpl")})}},selectorIsAt:function(selector,xy,description){var R=Siesta.Resource("Siesta.Test.Element");if(!selector)throw R.get("noCssSelector");var foundEl=this.$(this.elementFromPoint(xy[0],xy[1],!0));0<foundEl.has(selector).length||0<foundEl.closest(selector).length?this.pass(description,{descTpl:R.get("selectorIsAtPassTpl"),selector:selector,xy:xy}):this.fail(description,{got:foundEl[0].outerHTML?foundEl[0].outerHTML:foundEl[0].innerHTML,need:R.get("elementMatching")+" "+selector,assertionName:"selectorIsAt",annotation:R.get("selectorIsAtFailAnnotation")+" ["+xy+"]"})},selectorExists:function(selector,description){var R=Siesta.Resource("Siesta.Test.Element");if(!selector)throw R.get("noCssSelector");this.$(selector).length<=0?this.fail(description,R.get("selectorExistsFailTpl")+" : "+selector):this.pass(description,{descTpl:R.get("selectorExistsPassTpl"),selector:selector})},selectorNotExists:function(selector,description){var R=Siesta.Resource("Siesta.Test.Element"),els=this.$(selector);0<els.length?this.fail(description,{descTpl:R.get("selectorNotExistsFailTpl")+": "+selector,annotation:$.map(els,function(el,i){return i+1+". "+el.cloneNode().outerHTML}).join("\r\n")}):this.pass(description,{descTpl:R.get("selectorNotExistsPassTpl"),selector:selector})},waitForScrollChange:function(el,side,callback,scope,timeout){el=this.normalizeElement(el);var scrollProp="scroll"+Joose.S.uppercaseFirst(side),original=el[scrollProp],R=Siesta.Resource("Siesta.Test.Element");return this.waitFor({method:function(){if(el[scrollProp]!==original)return el[scrollProp]},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForScrollChange",description:" "+scrollProp+" "+R.get("toChangeForElement")+" "+el.toString()})},waitForScrollLeftChange:function(el,callback,scope,timeout){return this.waitForScrollChange(this.normalizeElement(el),"left",callback,scope,timeout)},waitForScrollTopChange:function(el,callback,scope,timeout){return this.waitForScrollChange(this.normalizeElement(el),"top",callback,scope,timeout)},scrollTo:function(el,scrollLeft,scrollTop,callback,delay,allowEmpty){if(el=this.normalizeElement(el,allowEmpty)){var me=this,originalSetTimeout=this.originalSetTimeout,doc=el.ownerDocument,waiter=this.waitForEvent(el==this.getElForPageScroll()?doc:el,"scroll",function(){if(0<delay){var async=me.beginAsync(delay+100);originalSetTimeout(function(){me.endAsync(async),me.processCallbackFromTest(callback)},delay)}else me.processCallbackFromTest(callback)}),prevScrollTop=el.scrollTop,prevScrollLeft=el.scrollLeft;return el.scrollLeft=scrollLeft,el.scrollTop=scrollTop,el.scrollTop==prevScrollTop&&el.scrollLeft==prevScrollLeft&&waiter.force(),{scrollLeft:el.scrollLeft,scrollTop:el.scrollTop}}this.processCallbackFromTest(callback)},scrollVerticallyTo:function(el,newTop,delay,callback){el=this.normalizeElement(el),"Number"!=this.typeOf(delay)&&(callback=delay,delay=null);var me=this,originalSetTimeout=this.originalSetTimeout,doc=el.ownerDocument,waiter=this.waitForEvent(el==this.getElForPageScroll()?doc:el,"scroll",function(){if(0<delay){var async=me.beginAsync(delay+100);originalSetTimeout(function(){me.endAsync(async),me.processCallbackFromTest(callback)},delay)}else me.processCallbackFromTest(callback)}),prevScrollTop=el.scrollTop;return el.scrollTop=newTop,el.scrollTop==prevScrollTop&&waiter.force(),el.scrollTop},scrollHorizontallyTo:function(el,newLeft,delay,callback){el=this.normalizeElement(el),"Number"!=this.typeOf(delay)&&(callback=delay,delay=null);var me=this,originalSetTimeout=this.originalSetTimeout,doc=el.ownerDocument,waiter=this.waitForEvent(el==this.getElForPageScroll()?doc:el,"scroll",function(){if(0<delay){var async=me.beginAsync(delay+100);originalSetTimeout(function(){me.endAsync(async),me.processCallbackFromTest(callback)},delay)}else me.processCallbackFromTest(callback)}),prevScrollLeft=el.scrollLeft;return el.scrollLeft=newLeft,el.scrollLeft==prevScrollLeft&&waiter.force(),el.scrollLeft},clickAll:function(){var callback,args=Array.prototype.concat.apply([],arguments);"Function"==this.typeOf(args[args.length-1])&&(callback=args.pop()),args=Array.prototype.concat.apply([],args);var steps=[];Joose.A.each(args,function(arg){steps.push({action:"click",target:arg})});var me=this;callback&&steps.push(function(){me.processCallbackFromTest(callback)}),this.chain.apply(this,steps)},chainClick:function(){return this.clickAll.apply(this,arguments)},clickSelector:function(selector,root,callback,scope){1<arguments.length&&"Function"==this.typeOf(root)&&(scope=callback,callback=root,root=null),root=root&&this.normalizeElement(root);var result=Joose.A.map(this.sizzle(selector,root),function(el){return el});this.clickAll(result,function(){callback&&callback.call(scope||this,result)})},selectorCountIs:function(selector,root,count,description){var R=Siesta.Resource("Siesta.Test.Element");if(!selector)throw R.get("noCssSelector");root="Number"==this.typeOf(root)?(description=count,count=root,null):this.normalizeElement(root);var inDOMCount=this.$(selector,root).length;inDOMCount!=count?this.fail(description,{assertionName:"selectorCountIs",descTpl:R.get("selectorCountIsFailTpl"),selector:selector,got:inDOMCount,need:count}):this.pass(description,{descTpl:R.get("selectorCountIsPassTpl"),count:count,selector:selector})},isInView:function(el,description){if(this.elementIsInView(el)){var R=Siesta.Resource("Siesta.Test.Element");this.pass(description,{descTpl:R.get("isInViewPassTpl")})}else this.fail(description,{assertionName:"isInView"})},elementIsInView:function(el){el=this.normalizeElement(el);var inView=!1,offset=this.$(el).offset();if(offset){var docViewTop=$(this.global).scrollTop(),docViewBottom=docViewTop+$(this.global).height(),elemTop=offset.top;inView=docViewTop<=elemTop+$(el).height()&&elemTop<=docViewBottom}return inView},waitUntilInView:function(el,callback,scope,timeout){var me=this,R=Siesta.Resource("Siesta.Test.Element");this.waitFor({method:function(){var normalized=this.normalizeElement(el,!0);if(normalized&&me.elementIsInView(normalized))return normalized},callback:callback,scope:scope,timeout:timeout,assertionName:"waitUntilInView",description:el.toString+" "+R.get("toAppearInTheViewport")})},findScrolledParent:function(el){for(var body=el.ownerDocument.body,parent=this.$(el);(parent=parent.parent()).length&&parent[0]!=body;)if(0<parent[0].scrollTop||0<parent[0].scrollLeft)return parent[0]},focus:function(el,tryPreventScrollChange){var scrolledParent,prevIndex=el.getAttribute("tabIndex");if(this.activeElement()!==el)try{var oldScrollLeft,oldScrollTop,pageScrollX,pageScrollY;if(null==prevIndex&&el.setAttribute("tabIndex",-1),tryPreventScrollChange)(scrolledParent=this.findScrolledParent(el))&&(oldScrollLeft=scrolledParent.scrollLeft,oldScrollTop=scrolledParent.scrollTop),pageScrollX=this.getPageScrollX(),pageScrollY=this.getPageScrollY();this.maintainScrollPositionDuring(function(){el.focus({preventScroll:tryPreventScrollChange}),tryPreventScrollChange&&(scrolledParent&&(oldScrollLeft!==scrolledParent.scrollLeft&&(scrolledParent.scrollLeft=oldScrollLeft),oldScrollTop!==scrolledParent.scrollTop&&(scrolledParent.scrollTop=oldScrollTop)),pageScrollX==this.getPageScrollX()&&pageScrollY==this.getPageScrollY()||this.global.scrollTo(pageScrollX,pageScrollY))})}catch(e){}finally{null==prevIndex?el.removeAttribute("tabIndex"):el.setAttribute("tabIndex",prevIndex)}},elementIsEmpty:function(el,description){if((el=this.normalizeElement(el))&&this.isElementEmpty(el)){var R=Siesta.Resource("Siesta.Test.Element");this.pass(description,{descTpl:R.get("elementIsEmptyPassTpl")})}else this.fail(description,{got:el.innerHTML,need:"",assertionName:"elementIsEmpty"})},elementIsNotEmpty:function(el,description){if((el=this.normalizeElement(el))&&!this.isElementEmpty(el)){var R=Siesta.Resource("Siesta.Test.Element");this.pass(description,{descTpl:R.get("elementIsNotEmptyPassTpl")})}else this.fail(description,{assertionName:"elementIsNotEmpty"})},waitForElementEmpty:function(el,callback,scope,timeout){var me=this,R=Siesta.Resource("Siesta.Test.Element");return el=this.normalizeElement(el),this.waitFor({method:function(){return me.isElementEmpty(el)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForElementEmpty",description:" "+R.get("elementToBeEmpty")})},waitForElementNotEmpty:function(el,callback,scope,timeout){var me=this,R=Siesta.Resource("Siesta.Test.Element");return el=this.normalizeElement(el),this.waitFor({method:function(){return!me.isElementEmpty(el)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForElementNotEmpty",description:" "+R.get("elementToNotBeEmpty")})},isElementEmpty:function(el){return!el.innerHTML.replace(/^\s+|\s+$/g,"")},hasAttributeValue:function(el,attribute,value,description){var foundValue=(el=this.normalizeElement(el)).getAttribute(attribute);this.is(foundValue,value,description)},hasValue:function(el,value,description){var foundValue=(el=this.normalizeElement(el)).value;this.is(foundValue,value,description)},hasSameWidth:function(el,referenceEl,description){el=this.normalizeElement(el),referenceEl=this.normalizeElement(referenceEl),this.is(el.offsetWidth,referenceEl.offsetWidth,description)},hasSameHeight:function(el,referenceEl,description){el=this.normalizeElement(el),referenceEl=this.normalizeElement(referenceEl),this.is(el.offsetHeight,referenceEl.offsetHeight,description)},isElementFocusable:function(el){var disabled="true"===el.getAttribute("disabled"),nodeName=el.nodeName.toLowerCase();return!disabled&&(this.isTextInput(el)||el.isContentEditable||"input"===el.nodeName.toLowerCase()&&"file"===el.type||nodeName in{a:1,area:1,button:1,object:1,select:1}||null!=el.getAttribute("tabIndex")&&(!bowser.msie||"on"!=String(el.getAttribute("unselectable")).toLowerCase()))}}}),Role("Siesta.Test.Observable",{does:[Siesta.Util.Role.CanGetType],requires:["addListenerToObservable","removeListenerFromObservable","getSourceLine","pass","fail","processCallbackFromTest"],has:{},methods:{waitForEvent:function(observable,event,callback,scope,timeout){var eventFired=!1,R=Siesta.Resource("Siesta.Test.Browser");return this.addListenerToObservable(observable,event,function(){eventFired=!0}),this.waitFor({method:function(){return eventFired},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForEvent",description:" "+R.get("waitForEvent")+' "'+event+'" '+R.get("event")})},firesOk:function(options,events,n,timeOut,func,desc,callback){var observable,during,me=this,sourceLine=me.getSourceLine(),R=Siesta.Resource("Siesta.Test.Browser"),nbrArgs=arguments.length;if(1==nbrArgs)observable=options.observable,events=options.events,during=options.during,desc=options.desc||options.description,callback=options.callback,timeOut="Number"==this.typeOf(during)?during:null,func=/Function/.test(this.typeOf(during))?during:null;else if(5<=nbrArgs){if(observable=options,"String"==this.typeOf(events))(obj={})[events]=n,events=obj}else if(nbrArgs<=3&&"Object"==this.typeOf(events))observable=options,desc=n;else{if(!(nbrArgs<=4&&"String"==this.typeOf(events)))throw new Error(R.get("unrecognizedSignature"));var obj;observable=options,(obj={})[events]=n,events=obj,desc=timeOut,timeOut=null}var counters={},countFuncs={};Joose.O.each(events,function(expected,eventName){counters[eventName]=0;var countFunc=countFuncs[eventName]=function(){counters[eventName]++};me.addListenerToObservable(observable,eventName,countFunc)});function stopRecording(){Joose.O.each(events,function(expected,eventName){me.removeListenerFromObservable(observable,eventName,countFuncs[eventName]);var actualNumber=counters[eventName];me.verifyExpectedNumber(actualNumber,expected)?me.pass(desc,{descTpl:R.get("observableFired")+" "+actualNumber+" `"+eventName+"` "+R.get("events")}):me.fail(desc,{assertionName:"firesOk",sourceLine:sourceLine,descTpl:R.get("observableFiredOk")+" `"+eventName+"` "+R.get("events"),got:actualNumber,gotDesc:R.get("actualNbrEvents"),need:expected,needDesc:R.get("expectedNbrEvents")})})}if(timeOut){var async=this.beginAsync(timeOut+100);(0,this.originalSetTimeout)(function(){me.endAsync(async),stopRecording(),me.processCallbackFromTest(callback)},timeOut)}else if(func){function cont(){stopRecording(),me.processCallbackFromTest(callback)}var typeOf=this.typeOf(func);if("Function"===typeOf)func(),cont();else if("AsyncFunction"===typeOf)return func().then(cont,cont)}else this.on("beforetestfinalizeearly",stopRecording)},willFireNTimes:function(observable,event,n,desc,isGreaterEqual){this.firesOk(observable,event,isGreaterEqual?">="+n:n,desc)},getObjectWithExpectedEvents:function(event,expected){var events={};return"Array"==this.typeOf(event)?Joose.A.each(event,function(eventName){events[eventName]=expected}):events[event]=expected,events},wontFire:function(observable,event,desc){this.firesOk({observable:observable,events:this.getObjectWithExpectedEvents(event,0),desc:desc})},firesOnce:function(observable,event,desc){this.firesOk({observable:observable,events:this.getObjectWithExpectedEvents(event,1),desc:desc})},isntFired:function(){this.wontFire.apply(this,arguments)},firesAtLeastNTimes:function(observable,event,n,desc){this.firesOk(observable,event,">="+n,desc)},isFiredWithSignature:function(observable,event,checkerFn,description){function verifyFiredFn(){me.removeListenerFromObservable(observable,event,listener),eventFired||me.fail("The ["+event+"] "+R.get("isFiredWithSignatureNotFired"))}var eventFired,me=this,sourceLine=me.getSourceLine(),R=Siesta.Resource("Siesta.Test.ExtJS.Observable");me.on("beforetestfinalizeearly",verifyFiredFn);var listener=function(){me.un("beforetestfinalizeearly",verifyFiredFn);var result=checkerFn.apply(me,arguments);!eventFired&&result&&me.pass(description||R.get("observableFired")+" "+event+" "+R.get("correctSignature"),{sourceLine:sourceLine}),result||(me.fail(description||R.get("observableFired")+" "+event+" "+R.get("incorrectSignature"),{sourceLine:sourceLine}),me.removeListenerFromObservable(observable,event,listener)),eventFired=!0};me.addListenerToObservable(observable,event,listener)}}}),Role("Siesta.Test.ExtJSCore",{does:Siesta.Util.Role.CanInstallCQRootPseudo,has:{waitForExtReady:!0,waitForAppReady:!1,waitForExtComponentQueryReady:!0,loaderPath:null,requires:null,isExtOnReadyDone:!1,onReadyWaitingStarted:!1,isAppReadyDone:!1,loaderWaitingStarted:!1,requiringWaitingStarted:!1,isRequiringDone:!1,modelsDefinedInPreload:Joose.I.Object},override:{onTestStart:function(){var sharedSandboxState=this.sharedSandboxState;!this.reusingSandbox&&sharedSandboxState&&(sharedSandboxState.modelsDefinedInPreload||(sharedSandboxState.modelsDefinedInPreload={}),this.forEachModelInAllSchemas(function(entity,entityName,className,schema){sharedSandboxState.modelsDefinedInPreload[className]=!0}))},cleanupContextBeforeStartDom:function(){var Ext=this.getExt();if(!Ext)return this.SUPER();var me=this;if(Ext.ComponentQuery){var keep={},msgBox=Ext.MessageBox;msgBox&&(keep[msgBox.id]=!0);var comps=Ext.ComponentQuery.query("{ownerCt == null}");comps.sort(function(a,b){return(a=a instanceof Ext.Container?0:1)-(b=b instanceof Ext.Container?0:1)}),Joose.A.each(comps,function(comp){keep[comp.id]||comp.isDestroyed||comp.destroy()})}if(Ext.ClassManager&&Ext.undefine){var index={};Joose.O.each(Ext.ClassManager.classes,function(cls,name){var global=name.split(".")[0];me.isGlobalExpected(global,index)||Ext.undefine(name)})}if(Ext.data&&Ext.data.StoreManager){var toRemove=[];Ext.data.StoreManager.each(function(store){"ext-empty-store"!==store.storeId&&toRemove.push(store)}),Ext.data.StoreManager.unregister.apply(Ext.data.StoreManager,toRemove)}var sharedSandboxState=this.sharedSandboxState,modelsDefinedInPreload=sharedSandboxState&&sharedSandboxState.modelsDefinedInPreload;modelsDefinedInPreload&&me.forEachModelInAllSchemas(function(entity,entityName,className,schema){modelsDefinedInPreload[className]||(Ext.undefine(className),delete schema.entityClasses[className],delete schema.entities[entityName])}),Ext.resumeLayouts&&Ext.resumeLayouts()},processSubTestConfig:function(config){var res=this.SUPER(config);return res.waitForAppReady=!1,res.waitForExtReady=!1,res},isReady:function(){var result=this.SUPERARG(arguments);if(!result.ready)return result;var me=this,Ext=this.getExt(),R=Siesta.Resource("Siesta.Test.ExtJSCore"),loaderPath=this.loaderPath,StartTest=this.global.StartTest;loaderPath&&Ext&&Ext.Loader&&!StartTest.loaderPathHookInstalled&&this.project.generateLoaderPathHook()(StartTest,Ext,loaderPath);var requires=this.requires;if(requires&&!this.requiringWaitingStarted&&Ext&&Ext.require&&(this.requiringWaitingStarted=!0,Ext.require(requires,function(){me.isRequiringDone=!0})),this.waitForExtReady&&!this.onReadyWaitingStarted&&Ext&&Ext.onReady&&(this.onReadyWaitingStarted=!0,Ext.onReady(function(){me.isExtOnReadyDone=!0})),this.waitForExtComponentQueryReady&&Ext&&(Ext.getVersion||Ext.blink||Ext.manifest||Ext.microloaded)&&!Ext.ComponentQuery)return{ready:!1,reason:R.get("waitedForComponentQuery")};if(requires&&!this.isRequiringDone)return{ready:!1,reason:R.get("waitedForRequires")};if(this.waitForExtReady&&this.onReadyWaitingStarted&&!this.isExtOnReadyDone)return{ready:!1,reason:R.get("waitedForExt")};if(this.waitForAppReady&&!this.isAppReadyDone&&Ext){var name=Ext.manifest.name,isAppReadyDone=!1;try{isAppReadyDone=me.global[name].getApplication().launched}catch(e){}if(!isAppReadyDone)return{ready:!1,reason:R.get("waitedForApp")};this.isAppReadyDone=isAppReadyDone}return Ext&&Ext.ComponentQuery&&this.installRootPseudoCQ(Ext),{ready:!0}}},methods:{initialize:function(){this.expectGlobals("Ext","id"),this.SUPER()},getSimulatorClass:function(){return Siesta.Test.SimulatorExtJS},forEachModelInAllSchemas:function(func){var Ext=this.getExt();Ext&&Ext.data&&Ext.data.schema&&Ext.data.schema.Schema&&Ext.undefine&&Joose.O.each(Ext.data.schema.Schema.instances,function(schema,name){schema.eachEntity(function(entityName){var entity=schema.getEntity(entityName);func(entity,entityName,entity.$className,schema)})})},doStart:function(){var Ext=this.getExt();if(!Ext)return this.waitForAppReady=!1,this.waitForExtReady=!1,this.requires=null,void this.SUPERARG(arguments);Ext.isReady=!0,Ext.manifest&&Ext.manifest.name||(this.waitForAppReady=!1),this.SUPERARG(arguments)},getExt:function(){return this.global.Ext},Ext:function(){return this.global.Ext},isExtJSComponentQueryTarget:function(obj){var Ext=this.getExt();return Boolean(obj&&Ext&&(Ext.Component&&obj instanceof Ext.Component||obj.isWidget))},componentQuery:function(selector,root,options){options=options||{};var Ext=this.Ext();if(!selector||!Ext||!Ext.ComponentQuery)return[];selector=this.trimString(selector.replace(/^(\s*>>)?/,""));var result=Ext.ComponentQuery.query(selector,root);if(options.ignoreNonVisible){var me=this,onlyVisible=[];Joose.A.each(result,function(cmp){me.componentIsHidden(cmp)||onlyVisible.push(cmp)}),result=onlyVisible}return result},normalizeComponent:function(component,allowEmpty,options){options=options||{};this.Ext();var matchingMultiple=!1;if("String"===this.typeOf(component)){var result=this.componentQuery(component,null,{ignoreNonVisible:options.ignoreNonVisible}),R=Siesta.Resource("Siesta.Test.ExtJSCore");if(!allowEmpty&&result.length<1&&this.warn(R.get("noComponentMatch").replace("{component}",component)),1<result.length){matchingMultiple=!0;var text=R.get("multipleComponentMatch").replace("{component}",component);this.project.failOnMultipleComponentMatches?this.fail(text):this.warn(text)}component=result[0]}return options.detailed?{comp:component,matchingMultiple:matchingMultiple}:component},compToEl:function(comp,locateInputEl){if(!comp)return null;var Ext=this.Ext();if(locateInputEl=!1!==locateInputEl,Ext.Editor&&comp instanceof Ext.Editor&&comp.field&&(comp=comp.field),Ext&&Ext.form&&Ext.form.Field&&locateInputEl){if((Ext.form.Checkbox&&comp instanceof Ext.form.Checkbox||Ext.form.Radio&&comp instanceof Ext.form.Radio)&&comp.el){var displayEl=comp.displayEl;if(displayEl&&comp.boxLabel)return displayEl;var inputComponent=Ext.ComponentQuery.query("checkboxinput",comp)[0];return inputComponent?this.compToEl(inputComponent):comp.el.down(".x-form-field")||comp.el.down(".x-field-input")||comp.el.down(".x-input-el")||comp.inputEl||comp.el}if(comp instanceof Ext.form.Field&&comp.inputEl){var field=comp.el.down(".x-form-field");return field&&field.dom?field:comp.inputEl}if(Ext.form.HtmlEditor&&comp instanceof Ext.form.HtmlEditor)return comp.iframe||comp.inputEl}if(Ext&&Ext.field&&Ext.field.Slider&&comp instanceof Ext.field.Slider)return this.compToEl(Ext.ComponentQuery.query("slider",comp)[0]);if(Ext&&Ext.field&&Ext.field.Field&&comp instanceof Ext.field.Field&&locateInputEl&&comp.getComponent){if((comp=comp.getComponent()).getUseMask&&!0===comp.getUseMask()&&comp.mask)return comp.mask;if(locateInputEl&&comp.input)return comp.input;if(comp.bodyElement)return comp.bodyElement}return comp.getEl&&!comp.element?comp.getEl():locateInputEl&&comp.input||comp.el||comp.element},normalizeElement:function(el,allowMissing,shallow,detailed,options){if(!el)return null;if(el.nodeName)return el;var query,scopeAdjusted,matchingMultiple=!1,origEl=(this.getExt(),el),stopAtComponentLevel=options&&options.stopAtComponentLevel,ignoreNonVisible=!options||!options.hasOwnProperty("ignoreNonVisible")||options.ignoreNonVisible;if("string"==typeof el){var mainParts=el.split("->");if(2===mainParts.length&&(scopeAdjusted=this.adjustScope(el),el=this.trimString(mainParts[1]),!scopeAdjusted||(el.match(/^\s*>>/)||el.match(/=>/))&&!this.Ext()))return this.resetScope(),null;if(el.match(/=>/))el=(query=this.compositeQuery(el,null,allowMissing,ignoreNonVisible))[0],matchingMultiple=1<query.length;else{if(!el.match(/^\s*>>/)){var retVal=this.SUPER(el,allowMissing,shallow,detailed);return scopeAdjusted&&this.resetScope(),retVal}var compRes=this.normalizeComponent(el,allowMissing,{ignoreNonVisible:ignoreNonVisible,detailed:!0});el=compRes.comp,matchingMultiple=compRes.matchingMultiple}if(!allowMissing&&!el){var warning=Siesta.Resource("Siesta.Test.ExtJSCore").get("noComponentFound")+": "+origEl;throw this.warn(warning),scopeAdjusted&&this.resetScope(),warning}}var rawResult=!1;this.isExtJSComponentQueryTarget(el)&&(stopAtComponentLevel?rawResult=!0:el=this.compToEl(el)),el&&el.dom&&(stopAtComponentLevel?rawResult=!0:el=el.dom);var res=rawResult?el:this.SUPER(el,allowMissing,shallow);return scopeAdjusted&&this.resetScope(),detailed?{el:res,matchingMultiple:matchingMultiple}:res},normalizeActionTarget:function(el,allowMissing,ignoreNonVisible){return this.normalizeElement(el,allowMissing,!1,!1,{ignoreNonVisible:!1!==ignoreNonVisible,stopAtComponentLevel:!0})},knownBugIn:function(frameworkVersion,fn,reason){var Ext=this.getExt(),version=Ext.versions.extjs||Ext.versions.touch,R=Siesta.Resource("Siesta.Test.ExtJSCore");this.project.failKnownBugIn||version.isGreaterThan(frameworkVersion)?fn.call(this.global,this):this.todo(R.get("knownBugIn")+" "+frameworkVersion+": "+(reason||""),fn)},requireOk:function(){var callback,me=this,Ext=(this.global,this.getExt()),args=Array.prototype.concat.apply([],arguments),R=Siesta.Resource("Siesta.Test.ExtJSCore");"Function"==this.typeOf(args[args.length-1])&&(callback=args.pop());function continuation(){me.endAsync(async),Joose.A.each(args,function(className){var clsManager=Ext.ClassManager,cls=clsManager.get(className);clsManager.overrideMap&&clsManager.overrideMap[className]||cls&&("Function"==me.typeOf(cls)||"Function"==me.typeOf(cls.self))?me.pass(R.get("Class")+": "+className+" "+R.get("wasLoaded")):me.fail(R.get("Class")+": "+className+" "+R.get("wasNotLoaded"))}),me.processCallbackFromTest(callback)}var timeout=this.defaultTimeout,async=this.beginAsync(timeout+100),hasTimedOut=!1,originalSetTimeout=this.originalSetTimeout,originalClearTimeout=this.originalClearTimeout,timeoutId=originalSetTimeout(function(){hasTimedOut=!0,continuation()},timeout);Ext.Loader.setConfig({enabled:!0}),Ext.require(args,function(){originalClearTimeout(timeoutId),hasTimedOut||continuation()})},clickComponentQuery:function(selector,root,callback){2==arguments.length&&"Function"==this.typeOf(root)&&(callback=root,root=this.Ext().ComponentQuery),1==arguments.length&&(root=this.Ext().ComponentQuery);var result=root.query(selector);this.chainClick(result,function(){callback&&callback.call(this,result)})},clickCQ:function(){this.clickComponentQuery.apply(this,arguments)},compositeQuery:function(selector,root,allowEmpty,onlyVisibleComponents){allowEmpty=!1!==allowEmpty;var i,Ext=this.Ext(),R=Siesta.Resource("Siesta.Test.ExtJSCore"),mainParts=selector.split("=>");if(!(root=root||Ext&&Ext.ComponentQuery))return[];if(mainParts.length<2)throw R.get("invalidCompositeQuery")+": "+selector;var components,compQuery=mainParts[0],domQuery=mainParts[1];if(compQuery.match(/\.\w+\(/)){for(var match,re=/(.+?)\.(\w+)\(\)/g;root&&null!=(match=re.exec(compQuery));)(root=root.query(match[1])[0])&&match[2]&&(root=root[match[2]]());if(!root&&!allowEmpty)throw R.get("invalidCompositeQuery")+": "+selector;components=[root]}else components=root.query(compQuery);if(!components.length){if(allowEmpty)return[];throw R.get("ComponentQuery")+" "+compQuery+" "+R.get("matchedNoCmp")}for(i=0;i<components.length;i++){var cmp=components[i];if(cmp.rendered&&(!onlyVisibleComponents||cmp.isWidget||(cmp.isVisible?cmp.isVisible():!cmp.isHidden()))){var result=this.compToEl(cmp,!1);if(0<(result=this.sizzle(domQuery,result.dom)).length)return result}}if(allowEmpty)return[];throw R.get("CompositeQuery")+" "+selector+" matched no DOM elements"},cq:function(selector){return this.Ext().ComponentQuery.query(selector.replace(/^(\s*>>)?/,""))},cq1:function(selector){return this.Ext().ComponentQuery.query(selector.replace(/^(\s*>>)?/,""))[0]},waitForTarget:function(target,callback,scope,timeout,offset){var SUPER=this.SUPER;this.waitForAnimations(function(){SUPER.call(this,target,callback,scope,timeout,offset)},this,timeout)},messageBoxIsVisible:function(desc){return this.notOk(this.Ext().Msg.isHidden(),desc||Siesta.Resource("Siesta.Test.ExtJSCore","messageBoxVisible"))},messageBoxIsHidden:function(desc){return this.ok(this.Ext().Msg.isHidden(),desc||Siesta.Resource("Siesta.Test.ExtJSCore","messageBoxHidden"))},cqExists:function(query,description){this.ok(this.cq1(query),description)},cqNotExists:function(query,description){this.notOk(this.cq1(query),description)},componentQueryExists:function(){this.cqExists.apply(this,arguments)},setValue:function(component,value,callback,scope){((component=this.normalizeComponent(component)).setChecked||component.setRawValue||component.setValue).call(component,value),callback&&this.processCallbackFromTest(callback,null,scope)},waitForAnimations:function(callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.ExtJS"),me=this;return this.waitFor({method:function(){return!me.areAnimationsRunning()},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForAnimations",description:" "+R.get("animationsToFinalize")})},query:function(selector){var result,me=this;return result=selector.match(/=>/)?this.compositeQuery(selector,null,!0,!1):selector.match(/^\s*>>/)?(result=this.componentQuery(selector,null,{ignoreNonVisible:!1}),Joose.A.map(result,function(cmp){return me.compToEl(cmp).dom})):this.sizzle(selector)}}}),Role("Siesta.Test.ExtJS.Ajax",{has:{responses:Joose.I.Array,urlMatchers:Joose.I.Array},methods:{isAjaxLoading:function(obj,description){var Ext=this.Ext();this.ok(Ext.Ajax.isLoading(obj),description||Siesta.Resource("Siesta.Test.ExtJS.Ajax","ajaxIsLoading"))},ajaxRequestAndThen:function(url,callback,scope){var options=url;"string"==typeof url&&(options={url:url,callback:callback,scope:scope}),this.Ext().Ajax.request(options)},waitForAjaxRequest:function(obj,callback,scope,timeout){var msg,Ext=this.Ext();return"function"==typeof obj?(msg=" "+Siesta.Resource("Siesta.Test.ExtJS.Ajax","allAjaxRequestsToComplete"),timeout=scope,scope=callback,callback=obj,obj=void 0):msg=" "+Siesta.Resource("Siesta.Test.ExtJS.Ajax","ajaxRequest")+' "'+obj.options.url+'" '+Siesta.Resource("Siesta.Test.ExtJS.Ajax","toComplete"),this.waitFor({method:function(){return obj?!Ext.Ajax.isLoading(obj)&&obj:!Ext.Ajax.isLoading()},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForAjaxRequest",description:msg})}}}),Role("Siesta.Test.ExtJS.Store",{methods:{waitForStoresToLoad:function(){var callback,storesNum,Ext=this.getExt(),args=Array.prototype.concat.apply([],arguments),me=this,R=Siesta.Resource("Siesta.Test.ExtJS.Store"),baseStoreCls=Ext.data.AbstractStore||Ext.data.Store;Joose.A.each(args,function(arg,index){if("Function"==me.typeOf(arg))return callback=arg,storesNum=index,!1});var loaded=0,result=me.waitFor({method:function(){return loaded==storesNum},callback:callback,name:"waitForStoresToLoad",description:storesNum+" "+R.get("storesToLoad")});return Joose.A.each(args,function(store){var proxy=store.proxy||store.getProxy&&store.getProxy();if(!(store instanceof baseStoreCls))return!1;if(proxy){store.on("load",function(){loaded++,proxy.un("exception",exceptionFailure)},null,{single:!0});var exceptionFailure=function(proxy,response,operation){var url=proxy.api&&proxy.api.read||proxy.url;me.fail(R.get("failedToLoadStore"),R.get("URL")+": "+url)};proxy.on("exception",exceptionFailure)}else storesNum--}),result},loadStoresAndThen:function(){this.getExt();this.waitForStoresToLoad.apply(this,arguments);var args=Array.prototype.concat.apply([],arguments);"Function"==this.typeOf(args[args.length-1])&&args.pop(),Joose.A.each(args,function(store){(store.proxy||store.getProxy&&store.getProxy())&&store.load&&store.load()})},isStoreEmpty:function(store,description){this.is(store.getCount(),0,description)}}}),Role("Siesta.Test.ExtJS.Observable",{methods:{addListenerToObservable:function(observable,event,listener,isSingle){if(this.Ext()){if((observable=this.normalizeActionTarget(observable,!1,!1)).nodeName&&observable.tagName){var targetWin=observable.ownerDocument.parentWindow||observable.ownerDocument.defaultView;targetWin.Ext&&(observable=targetWin.Ext.get(observable))}observable.on&&observable.un?observable.on(event,listener,null,{single:isSingle}):this.SUPERARG(arguments)}else this.SUPERARG(arguments)},removeListenerFromObservable:function(observable,event,listener){if(this.Ext()){if(!(observable=this.normalizeActionTarget(observable,!0,!1)))return;if(observable&&observable.nodeName&&observable.tagName){var targetWin=observable.ownerDocument.parentWindow||observable.ownerDocument.defaultView;targetWin.Ext&&(observable=targetWin.Ext.get(observable))}observable.on&&observable.un?observable.un(event,listener):this.SUPERARG(arguments)}else this.SUPERARG(arguments)},hasListener:function(observable,eventName,description){var R=Siesta.Resource("Siesta.Test.ExtJS.Observable");(observable=this.normalizeActionTarget(observable,!0,!1))&&observable.hasListener?observable.hasListener(eventName)?this.pass(description,{descTpl:R.get("hasListenerPass"),eventName:eventName}):this.fail(description,{assertionName:"hasListener",annotation:R.get("hasListenerFail")+": "+eventName}):this.fail(description,{assertionName:"hasListener",annotation:R.get("hasListenerInvalid")})}}}),Role("Siesta.Test.ExtJS.Component",{requires:["waitFor"],methods:{componentIsHidden:function(comp){var el=this.compToEl(comp);return!el||(comp.isHidden&&comp.isHidden()||comp.isVisible&&!comp.isVisible()||!this.isElementVisible(el))},waitForComponentVisible:function(component,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.ExtJS.Component"),me=this;if("String"!=this.typeOf(component)&&!this.isExtJSComponentQueryTarget(component))throw R.get("badInputText")+": "+component;return this.waitFor({method:function(){var comp=me.normalizeComponent(component,!0);if(!comp)return!1;var el=me.compToEl(comp);return el&&me.elementIsTop(el,!0)&&comp},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForComponentVisible",description:" "+R.get("component")+' "'+("String"==me.typeOf(component)?component:component.id)+'" '+R.get("toBeVisible")})},waitForComponentNotVisible:function(component,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.ExtJS.Component"),me=this;if("String"!=this.typeOf(component)&&!this.isExtJSComponentQueryTarget(component))throw R.get("badInputText")+": "+component;return this.waitFor({method:function(){var comp=me.normalizeComponent(component,!0);return!!comp&&(me.componentIsHidden(comp)&&comp)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForComponentNotVisible",description:" "+R.get("component")+' "'+("String"==me.typeOf(component)?component:component.id)+'" '+R.get("toNotBeVisible")})},waitForComponentQuery:function(selector,root,callback,scope,timeout){return"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=this.getExt()&&this.getExt().ComponentQuery),this.waitFor({method:function(){var result=root&&root.query(selector)||this.getExt()&&this.getExt().ComponentQuery.query(selector);return!!(result&&0<result.length)&&result},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForComponentQuery",description:" "+Siesta.Resource("Siesta.Test.ExtJS.Component","componentQuery")+' "'+selector+'"'})},waitForCompositeQuery:function(query,root,callback,scope,timeout){"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=this.getExt().ComponentQuery);var me=this;return me.waitFor({method:function(){var result=me.compositeQuery(query,root,!0);return 0<result.length&&result},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForCompositeQuery",description:" "+Siesta.Resource("Siesta.Test.ExtJS.Component","compositeQuery")+' "'+query+'"'})},waitForCompositeQueryNotFound:function(query,root,callback,scope,timeout){"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=this.getExt().ComponentQuery);var me=this;return me.waitFor({method:function(){return!(0<me.compositeQuery(query,root,!0).length)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForCompositeQueryNotFound",description:" "+Siesta.Resource("Siesta.Test.ExtJS.Component","compositeQuery")+' "'+query+'" '+Siesta.Resource("Siesta.Test.ExtJS.Component","toReturnEmptyArray")})},waitForCQ:function(){return this.waitForComponentQuery.apply(this,arguments)},waitForCQNotFound:function(){return this.waitForComponentQueryNotFound.apply(this,arguments)},waitForComponentQueryNotFound:function(query,root,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.ExtJS.Component");return"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=this.getExt().ComponentQuery),this.waitFor({method:function(){var result=root.query(query);return 0===result.length&&result},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForComponentQueryNotFound",description:R.get("componentQuery")+": "+query+" "+R.get("toReturnEmpty")})},waitForCQVisible:function(){return this.waitForComponentQueryVisible.apply(this,arguments)},waitForCQNotVisible:function(){return this.waitForComponentQueryNotVisible.apply(this,arguments)},waitForComponentQueryVisible:function(query,root,callback,scope,timeout){var firstNonVisibleId,resultsLen,me=this,R=Siesta.Resource("Siesta.Test.ExtJS.Component"),Ext=me.getExt();return"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=Ext.ComponentQuery),this.waitFor({method:function(){firstNonVisibleId=null;var result=root.query(query),allVisible=!0;return 0<(resultsLen=result.length)&&(Joose.A.each(result,function(c){if(!c.rendered||!me.isElementVisible(c))return allVisible=!1,firstNonVisibleId=c.id,!1}),allVisible&&result)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForComponentQueryVisible",description:" "+R.get("componentQuery")+": "+query+" to return a non-empty set of visible components",annotation:function(){return 0===resultsLen?"No matching components":0<resultsLen&&null==firstNonVisibleId?"":0<resultsLen&&null!=firstNonVisibleId?"The matching component [id="+firstNonVisibleId+"] is not visible":void 0}})},waitForComponentQueryNotVisible:function(query,root,callback,scope,timeout){var firstVisibleId,resultsLen,me=this,R=Siesta.Resource("Siesta.Test.ExtJS.Component"),Ext=me.getExt();return"Function"==this.typeOf(root)&&(timeout=scope,scope=callback,callback=root,root=Ext.ComponentQuery),this.waitFor({method:function(){firstVisibleId=null;var result=root.query(query),allHidden=!0;return!(0<(resultsLen=result.length))||(Joose.A.each(result,function(comp){if(!me.componentIsHidden(comp))return firstVisibleId=comp.id,allHidden=!1}),allHidden&&result)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForComponentQueryVisible",description:" "+R.get("componentQuery")+": "+query+" "+R.get("toReturnHiddenCmp"),annotation:function(){return 0===resultsLen||null==firstVisibleId?"":null!=firstVisibleId?"The matching component [id="+firstVisibleId+"] is visible":void 0}})},waitForXType:function(xtype,root,callback,scope,timeout){return this.waitForComponentQuery(xtype,root,callback,scope,timeout)},waitForComponent:function(component,rendered,callback,scope,timeout){var xtype,Ext=this.getExt();return xtype=Ext.isString(component)?Ext.ClassManager.get(component).xtype:component.xtype,rendered&&(xtype+="[rendered]"),this.waitForXType(xtype,callback,scope,timeout)},hasSize:function(component,width,height,description){component=this.normalizeComponent(component),this.isDeeply(component.getSize(),{width:width,height:height},description)},hasPosition:function(component,x,y,description){component=this.normalizeComponent(component),this.isDeeply(component.getPosition(),[x,y],description)},destroysOk:function(components,description){var Ext=this.Ext(),R=Siesta.Resource("Siesta.Test.ExtJS.Component");if("Array"!=this.typeOf(components)&&(components="String"==this.typeOf(components)?this.Ext().ComponentQuery.query(components):[components]),components.length){var currentComp,e=this.getExceptionCatcher()(function(){Joose.A.each(components,function(component){(currentComp=component).destroy()})});if(void 0===e){var me=this;!1!==Joose.A.each(components,function(component){if(!component.isDestroyed&&component.destroy!=Ext.emptyFn)return me.fail(description,{assertionName:"destroysOk",annotation:R.get("Component")+" ["+component.id+"] "+R.get("destroyFailed")}),!1})&&this.pass(description,{descTpl:R.get("destroyPassed")})}else this.fail(description,{assertionName:"destroysOk",got:e,gotDesc:R.get("exception"),annotation:R.get("exceptionAnnotation")+" "+currentComp.id})}else this.fail(description,{assertionName:"destroysOk",annotation:R.get("invalidDestroysOkInput")})}}}),Role("Siesta.Test.ExtJS.Grid",{requires:["waitFor","pass","fail","typeOf"],methods:{waitForRowsVisible:function(view,callback,scope,timeout){"function"==typeof view&&(timeout=scope,scope=callback,callback=view,view=this.Ext()&&this.cq1("tableview")||"tableview");var cmp=this.Ext()&&this.normalizeComponent(view,!0),me=this;if(cmp||"string"!=typeof view){var checkerFn;if(cmp.normalGrid){var selector=cmp.normalGrid.getView().itemSelector;checkerFn=function(){if(cmp.rendered&&cmp.normalGrid.rendered&&cmp.lockedGrid.rendered){var lockedResult=this.$(selector,cmp.lockedGrid.getView().getEl().dom),normalResult=this.$(selector,cmp.normalGrid.getView().getEl().dom);return 0<lockedResult.length&&0<normalResult.length?{lockedRows:lockedResult,normalRows:normalResult}:void 0}}}else{selector=(view=cmp.getView&&cmp.getView()||cmp).itemSelector||view.rowSelector;checkerFn=function(){if(cmp.rendered){var result=this.$(selector,view.el.dom);return 0<result.length?result:void 0}}}return this.waitFor({method:checkerFn,callback:function(){var as=me.beginAsync();me.global.setTimeout(function(){me.endAsync(as),callback.call(scope||me)},100)},timeout:timeout,assertionName:"waitForRowsVisible",description:" "+Siesta.Resource("Siesta.Test.ExtJS.Grid").get("waitForRowsVisible")+' "'+cmp.id+'"'})}return this.waitForCQ(view,function(result){this.waitForRowsVisible(result[0],callback,scope,timeout)},this)},getFirstRow:function(grid){return grid=this.normalizeComponent(grid),this.getRow(grid,0)},getFirstCell:function(panel){return panel=this.normalizeComponent(panel),this.getCell(panel,0,0)},getRow:function(grid,index){var domNode,Ext=this.Ext();if(grid=this.normalizeComponent(grid),Ext.grid.Grid&&grid instanceof Ext.grid.Grid){var rowCmp=grid.getViewItems()[index];domNode=rowCmp&&rowCmp.element}else if((grid=grid.lockedGrid||grid).getView().bufferedRenderer){var record=grid.getStore().getRange(index,index+1)[0];record&&(domNode=grid.getView().getNode(record))}else domNode=grid&&this.$(grid.getView().itemSelector,grid.getView().getEl().dom)[index];return domNode&&Ext.get(domNode)},getCell:function(grid,row,col){var rowEl=(grid=this.normalizeComponent(grid))&&this.getRow(grid,row),cellNode=rowEl&&this.$(grid.view.cellSelector,rowEl.dom)[col];return cellNode&&this.Ext().get(cellNode)},getLastCellInRow:function(grid,row){return grid=this.normalizeComponent(grid),this.getCell(grid,row,grid.headerCt.getColumnCount()-1)},matchGridCellContent:function(grid,rowIndex,colIndex,string,description){(grid=this.normalizeComponent(grid)).getView();var Ext=this.Ext(),cell=this.getCell(grid,rowIndex,colIndex).child("."+Ext.baseCSSPrefix+"grid-cell-inner"),isRegExp="RegExp"==this.typeOf(string),content=cell.dom.innerHTML;(isRegExp?string.test(content):-1!=content.indexOf(string))?this.pass(description,{descTpl:isRegExp?"Cell content {content} matches regexp {string}":"Cell content {content} has a string {string}",content:content,string:string}):this.fail(description,{assertionName:"matchGridCellContent",got:cell.dom.innerHTML,gotDesc:"Cell content",need:string,needDesc:"String matching",annotation:"Row index: "+rowIndex+", column index: "+colIndex})},clickToEditCell:function(grid,rowIndex,colIndex,callback,selector){var Ext=this.getExt(),editingPlugin=(grid=this.normalizeComponent(grid))&&grid.editingPlugin;if(!(editingPlugin&&editingPlugin instanceof Ext.grid.plugin.CellEditing))return this.fail("No grid, or grid has no editing plugin, or its not a Ext.grid.plugin.CellEditing plugin"),void(callback&&callback(null));var me=this;this[2==editingPlugin.clicksToEdit?"doubleClick":"click"](this.getCell(grid,rowIndex,colIndex),function(){editingPlugin.getActiveEditor()||editingPlugin.startEditByPosition({row:rowIndex,column:colIndex}),me.waitForSelectorAtCursor(selector||".x-editor,input",callback)})},getTrimmedCellContent:function(grid,row,column){var cell=this.getCell(grid,row,column);return $.trim(this.$(cell.dom).text())},assertCellIsEmpty:function(grid,row,column,message){this.is(this.getTrimmedCellContent(grid,row,column),"",message)},waitForCellEmpty:function(grid,row,column,scope,timeout,callback){"function"==typeof scope?callback=scope:"function"==typeof timeout&&(callback=timeout),this.waitFor({method:function(){return 0===this.getTrimmedCellContent(grid,row,column).length},callback:function(){callback.call(scope||this)},timeout:timeout,assertionName:"waitForCellEmpty",description:" "+Siesta.Resource("Siesta.Test.ExtJS.Grid").get("waitForCellEmpty")})}}}),Role("Siesta.Test.ExtJS.DataView",{requires:["waitFor","getExt"],methods:{waitForViewRendered:function(view,callback,scope,timeout){var hasItems=(view=this.normalizeComponent(view))&&view.store&&0<view.store.getCount(),R=Siesta.Resource("Siesta.Test.ExtJS.DataView");return this.waitFor({method:function(){return hasItems?!!view.getNode(0):view.rendered},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForViewRendered",description:" "+R.get("view")+" "+view.id+" "+R.get("toRender")})},getFirstItem:function(view){var Ext=this.getExt();return view=this.normalizeComponent(view),Ext.get(view.getNode(0))}}}),Role("Siesta.Test.ExtJS.Element",{methods:{hasRegion:function(el,region,description){var elRegion=el.getRegion(),R=Siesta.Resource("Siesta.Test.ExtJS.Element");this.is(elRegion.top,region.top,description+" "+R.get("top")+")"),this.is(elRegion.right,region.right,description+" "+R.get("right")+")"),this.is(elRegion.bottom,region.bottom,description+" "+R.get("bottom")+")"),this.is(elRegion.left,region.left,description+" "+R.get("left")+")")}}}),Role("Siesta.Test.ExtJS.FormField",{methods:{fieldHasValue:function(field,value,description){field=this.normalizeComponent(field),this.is(field.getValue(),value,description)},isFieldEmpty:function(field,description){var val=(field=this.normalizeComponent(field)).getValue();this.ok(null===val||""===val,description)}}}),Class("Siesta.Test.Browser",{isa:Siesta.Test,does:[Siesta.Util.Role.CanParseBrowser,Siesta.Util.Role.CanCalculatePageScroll,Siesta.Util.Role.Dom,Siesta.Test.Browser.Role.CanGetElementFromPoint,Siesta.Test.Browser.Role.CanWorkWithKeyboard,Siesta.Test.Browser.Role.CanRebindJQueryContext,Siesta.Test.UserAgent.Mouse,Siesta.Test.UserAgent.Keyboard,Siesta.Test.UserAgent.Touch,Siesta.Test.Element,Siesta.Test.TextSelection,Siesta.Test.Observable],has:{bowser:null,browser:null,forceDOMVisible:!1,isDOMForced:!1,browserInfo:{lazy:function(){return this.parseBrowser(window.navigator.userAgent)}},nextConfirmValue:null,nextPromptReturnValue:null,realAlert:null,realConfirm:null,realPrompt:null,realPrint:null,realOpen:null,previousConfirm:null,previousPrompt:null,blurListener:null,restartOnBlur:!1,blurWindow:null,mouseVisualizer:null,popups:Joose.I.Array,simulator:null,simulatorConfig:null,isHandlingThrowAsync:!1,initialCursorPosition:null},override:{cleanup:function(){this.mouseVisualizer&&(this.mouseVisualizer.destroy(),this.mouseVisualizer=null),this.SUPERARG(arguments),this.bowser=this.browser=null,this._global=null,this.realAlert=this.realConfirm=this.realPrompt=this.realPrint=this.realOpen=null,this.previousPrompt=this.previousConfirm=null,this.blurListener=null,this.blurWindow&&this.blurWindow.close(),this.blurWindow=null,Joose.A.each(this.popups,function(handle){handle.popup.closed||handle.popup.close()}),this.popups.length=0,this.popups=null,this.simulator.cleanup()},attachSimulator:function(){var me=this,simulator=this.simulator,isRoot=!this.parent;if(isRoot&&simulator.onTestLaunch(this),"synthetic"!=simulator.type)return Promise.resolve().then(function(){if(isRoot){var x=me.initialCursorPosition?me.initialCursorPosition[0]:0,y=me.initialCursorPosition?me.initialCursorPosition[1]:0;return simulator.simulateMouseMove(x,y,null,{moveKind:"instant"})}}).then(function(){if(!me.project.browserWindowHasFocus()){var currentPosition=simulator.currentPosition.slice();return simulator.simulateMouseMove(-1,-1,null,{moveKind:"instant"}).then(function(){return simulator.simulateMouseClick({globalXY:[]})}).then(function(){return simulator.simulateMouseMove(currentPosition[0],currentPosition[1],null,{moveKind:"instant"})})}});isRoot&&me.initialCursorPosition&&(simulator.currentPosition[0]=me.initialCursorPosition[0],simulator.currentPosition[1]=me.initialCursorPosition[1])},launch:function(errorMessage){var me=this,SUPER=this.SUPER,cont=this.attachSimulator();cont?cont.then(function(){SUPER.call(me,errorMessage)},function(reason){SUPER.call(me,reason)}):this.SUPER(errorMessage)}},methods:{initialize:function(){this.simulator||(this.simulator=new(this.getSimulatorClass())(this.simulatorConfig||{})),this.currentPosition=this.simulator.currentPosition,this.SUPERARG(arguments)},onBeforeTestFinalize:function(){this.global.alert.__EXPECTED_ALERT__&&this.fail(Siesta.Resource("Siesta.Test.Browser","alertMethodNotCalled")),this.SUPERARG(arguments)},getSimulatorClass:function(){return Siesta.Test.Simulator},earlySetup:function(callback,errback){var simulator=this.simulator;"synthetic"==simulator.type?callback():simulator.doFullSimulationReset().then(callback,errback)},launch:function(errorMessage){var me=this,win=this.global;me.parent||(me.realAlert=win.alert,me.realConfirm=win.confirm,me.realPrompt=win.prompt,me.realPrint=win.print,me.realOpen=win.open,this.maintainScrollPositionDuring(function(){me.project.browserWindowHasFocus()||bowser.safari||me.onWindowBlur(),win.focus&&win.focus()}),bowser.msie||!me.project.showCursor||win.opener||(me.mouseVisualizer=new Siesta.Project.Browser.UI.MouseVisualizer({currentContainer:me.global.frameElement.parentElement}))),me.previousConfirm=win.confirm,me.previousPrompt=win.prompt;win.alert=win.print=function(){},win.confirm=function(){var retVal="boolean"!=typeof me.nextConfirmValue||me.nextConfirmValue;return me.nextConfirmValue=null,retVal},win.prompt=function(){var retVal=me.nextPromptReturnValue||"";return me.nextPromptReturnValue=null,retVal},win.open=function(url){var popup=me.realOpen.apply(win,arguments);return popup?me.popups.push({url:url,popup:popup}):me.fail(Siesta.Resource("Siesta.Test.Browser","popupsDisabled",{url:url})),popup},this.SUPERARG(arguments)},onTestFinalize:function(){var win=this.global;win&&(this.parent?(win.confirm=this.realConfirm,win.prompt=this.realPrompt,win.alert=win.print=function(){}):(win.confirm=this.previousConfirm,win.prompt=this.previousPrompt,win.print=this.realPrint,win.alert=this.realAlert,win.open=this.realOpen)),this.SUPERARG(arguments)},onWindowBlur:function(arg1,arg2){this.restartOnBlur?this.fireEvent("focuslost"):this.warn(Siesta.Resource("Siesta.Test.Browser").get("focusLostWarning",{url:this.url}))},sizzle:function(selector,root){return Siesta.Sizzle(selector,root||this.global.document)},isEventPrevented:function(event){return event.preventDefault&&"Boolean"==this.typeOf(event.preventDefault.$prevented)?event.preventDefault.$prevented:"Boolean"==this.typeOf(event.defaultPrevented)?event.defaultPrevented:!1===event.returnValue},cleanupContextBeforeStart:function(){this.cleanupContextBeforeStartDom(),this.SUPER()},cleanupContextBeforeStartDom:function(){this.global.document.body.innerHTML=""},getElementPageRect:function(el,$el){var offset=($el=$el||this.$(el)).offset();return new Siesta.Util.Rect({left:offset.left,top:offset.top,width:$el.outerWidth(),height:$el.outerHeight()})},hasForcedIframe:function(){return Boolean((this.isDOMForced||this.forceDOMVisible)&&this.scopeProvider instanceof Scope.Provider.IFrame&&this.scopeProvider.iframe)},getDivBox:function(doc,left,top,width,height){var div=doc.createElement("div");return div.style.cssText="position: absolute !important; left: "+left+"px !important; top: "+top+"px !important;border-width: 0 !important; padding: 0 !important; margin: 0 !important;width: "+width+"px !important; height: "+height+"px !important;",div},elementIsScrolledOut:function(el,offset){for(var doc=el.ownerDocument,win=doc.defaultView||doc.parentWindow,body=doc.body,parents=[],parent=el;parent&&parent!=body;parent=parent.parentNode)parents.push(parent);for(var currentRect=new Siesta.Util.Rect({left:this.getPageScrollX(win),top:this.getPageScrollY(win),width:this.$(win).width(),height:this.$(win).height()}),i=parents.length-1;0<=i;i--){parent=parents[i];var overflowX=this.$(parent).css("overflow-x"),overflowY=this.$(parent).css("overflow-y");if("visible"!=overflowX||"visible"!=overflowY){var parentRect=this.getElementPageRect(parent);if("visible"!=overflowX&&(currentRect=currentRect.cropLeftRight(parentRect)).isEmpty())return!0;if("visible"!=overflowY&&(currentRect=currentRect.cropTopBottom(parentRect)).isEmpty())return!0}}var $el=this.$(el),elPageRect=this.getElementPageRect($el[0],$el);return offset=this.normalizeOffset(offset,$el),!currentRect.contains(elPageRect.left+offset[0],elPageRect.top+offset[1])},scrollTargetIntoView:function(target,offset){var win=this.global,doc=win.document;if("Array"==this.typeOf(target)){var leftVisible=this.getPageScrollX(),rightVisible=leftVisible+this.$(win).width(),topVisible=this.getPageScrollY(),bottomVisible=topVisible+this.$(win).height();if(leftVisible<=target[0]&&target[0]<=rightVisible&&topVisible<=target[1]&&target[1]<=bottomVisible)return!1;var div=this.getDivBox(doc,target[0],target[1],1,1);return doc.body.appendChild(div),this.maintainScrollPositionDuring(function(){div.scrollIntoView()}),doc.body.removeChild(div),!0}target=this.normalizeElement(target,!0,null,!1),offset=this.normalizeOffset(offset,this.$(target));var isInside=this.isOffsetInsideElementBox(target,offset);if(target&&this.isElementVisible(target)&&isInside&&this.elementIsScrolledOut(target,offset)){if(this.maintainScrollPositionDuring(function(){target.scrollIntoView()}),this.elementIsScrolledOut(target,offset)){var scrollableParent=this.$(target).closest(":scrollable")[0];if(scrollableParent){var parentBox=this.getBoundingClientRect(scrollableParent),targetBox=this.getBoundingClientRect(target);scrollableParent.scrollLeft=Math.max(0,scrollableParent.scrollLeft+targetBox.left-parentBox.left+offset[0]-1),scrollableParent.scrollTop=Math.max(0,scrollableParent.scrollTop+targetBox.top-parentBox.top+offset[1]-1)}}return!0}},processSubTestConfig:function(config){var res=this.SUPER(config),me=this;return Joose.A.each(["currentPosition","mouseVisualizer","simulator","simulatorConfig","bowser","browser","moveCursorBetweenPoints","realAlert","realConfirm","realPrompt","realPrint","realOpen","popups"],function(name){res[name]=me[name]}),res},normalizeElement:function(el,allowMissing,shallow,detailed){if(el&&el.nodeName)return el;var x,y,matchingMultiple=!1;if("String"===this.typeOf(el)){var origEl=el,wasAdjusted=this.adjustScope(el),query=this.$(0<=el.indexOf("->")?el.split("->")[1]:el);if(wasAdjusted&&this.resetScope(),el=query[0],matchingMultiple=1<query.length,!allowMissing&&!el){var warning=Siesta.Resource("Siesta.Test.Browser","noDomElementFound")+": "+origEl;throw this.warn(warning),new Error(warning)}}"Array"==this.typeOf(el)&&(y=el.length<2?(x=this.simulator.currentPosition[0],this.simulator.currentPosition[1]):(x=this.pageXtoViewportX(Math.round(el[0])),this.pageYtoViewportY(Math.round(el[1]))),el=this.elementFromPoint(x,y));return detailed?{el:el,matchingMultiple:matchingMultiple}:el},normalizeActionTarget:function(el,allowMissing){return this.normalizeElement(el,allowMissing)},randomBetween:function(min,max){return Math.floor(min+Math.random()*(max-min+1))},getElementAtCursor:function(){var xy=this.simulator.currentPosition;return this.elementFromPoint(xy[0],xy[1])},addListenerToObservable:function(observable,event,listener,isSingle){this.$(observable).bind(event,listener)},removeListenerFromObservable:function(observable,event,listener){this.$(observable).unbind(event,listener)},getNormalizedTopElementInfo:function(actionTarget,skipWarning,actionName,offset){var localXY,globalXY,el;"Array"==this.typeOf(actionTarget)&&0==actionTarget.length&&(actionTarget=null);var targetIsPoint=!actionTarget||"Array"==this.typeOf(actionTarget);if(targetIsPoint){var x,y;y=actionTarget?(x=this.pageXtoViewportX(Math.round(actionTarget[0])),this.pageYtoViewportY(Math.round(actionTarget[1]))):(x=this.simulator.currentPosition[0],this.simulator.currentPosition[1]),globalXY=[x,y];var info=this.elementFromPoint(x,y,!1,null,!0);el=info.el,localXY=info.localXY}else el=this.normalizeElement(actionTarget,skipWarning);if(el||!skipWarning){if(!targetIsPoint){var R=Siesta.Resource("Siesta.Test.Browser"),message="getNormalizedTopElementInfo: "+(actionName?R.get("targetElementOfAction")+" ["+actionName+"]":R.get("targetElementOfSomeAction"))+" "+R.get("isNotVisible")+": "+(el.id?"#"+el.id:el);if(!this.isElementVisible(el))return void this.fail(message);skipWarning||!this.isOffsetInsideElementBox(el,offset)||this.elementIsTop(el,!0,offset)||this.warn(message)}var isOption=el&&"option"===el.nodeName.toLowerCase();if(isOption)localXY=this.simulator.currentPosition.slice(),globalXY=this.simulator.currentPosition.slice();else if(!targetIsPoint){var doc=el.ownerDocument;R=Siesta.Resource("Siesta.Test.Browser");if(localXY=this.getTargetCoordinate(el,!0,offset),globalXY=this.getTargetCoordinate(el,!1,offset),!(el=doc.elementFromPoint(localXY[0],localXY[1])||doc.elementFromPoint(localXY[0],localXY[1])||doc.body))return void this.fail("getNormalizedTopElementInfo: "+R.get("noElementFound")+" ["+localXY+"]")}return{el:el,localXY:localXY,globalXY:globalXY,offset:isOption?[0,0]:this.getOffsetRelativeToEl(el,localXY)}}},getOffsetRelativeToEl:function(el,point){var box=this.getElementPageRect(el);return[point[0]-box.left,point[1]-box.top]},waitForTextPresent:function(text,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Browser");return this.waitFor({method:function(){var body=this.global.document.body,selector=":contains("+text+")";return 0<this.$(selector,body).length||this.$(body).is(selector)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForTextPresent",description:" "+R.get("text")+' "'+text+'" '+R.get("toBePresent")})},waitForTextNotPresent:function(text,callback,scope,timeout){var R=Siesta.Resource("Siesta.Test.Browser");return this.waitFor({method:function(){var body=this.global.document.body,selector=":contains("+text+")";return 0===this.$(selector,body).length&&!this.$(body).is(selector)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForTextNotPresent",description:" "+R.get("text")+' "'+text+'" '+R.get("toNotBePresent")})},waitForTarget:function(target,callback,scope,timeout,offset){var me=this,R=Siesta.Resource("Siesta.Test.Browser");return this.waitFor({method:function(){var el=me.normalizeElement(target,!0,!0,!1,{offset:offset});return!(!(el&&offset&&me.isElementVisible(el))||me.isOffsetInsideElementBox(el,offset))||el&&me.elementIsTop(el,!0,offset)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForTarget",description:" "+R.get("target")+' "'+target+'" '+R.get("toAppear")})},setWindowSize:function(width,height,callback){this.scopeProvider.setViewportSize(width,height),callback&&callback.call(this)},getJUnitClass:function(){var browserInfo=this.getBrowserInfo();return(browserInfo=browserInfo.name+browserInfo.version)+":"+this.SUPER()},adjustScope:function(target){if("String"==this.typeOf(target)){var mainParts=target.split("->");if(2===mainParts.length){var frameEl=this.$(this.trimString(mainParts[0]))[0];return frameEl&&frameEl.contentWindow?(this._global=this.global,this.setGlobal(frameEl.contentWindow),!0):!1}}return!1},resetScope:function(){this.setGlobal(this._global||this.global),this._global=null},screenshot:function(options,callback){this.diag("Command: `screenshot` skipped - not running in Standard Package"),this.processCallbackFromTest(callback,["skipped"],this)},screenshotElement:function(target,fileName,callback){this.diag("Command: `screenshot` skipped - not running in Standard Package"),this.processCallbackFromTest(callback,["skipped"],this)},setUrl:function(url,callback,scope){if(!url)throw new Error("Must provide a valid URL");if(this.global.location.href!==url){var baseUrl=this.scopeProvider.sourceURL||this.project.baseUrl,absURl=this.project.absolutizeURL(url,baseUrl);this.waitForPageLoad(callback,scope),this.global.location.href=absURl}else callback.call(scope||this)},setHash:function(hash,callback,scope){this.global.location.hash=hash,callback&&callback(scope||this)},expectAlertMessage:function(message,callback){var me=this,global=this.global,prevAlert=global.alert;global.alert=function(msg){("RegExp"==me.typeOf(message)?message.test(msg):message==msg)?me.pass("Expected alert message has been shown"):me.fail("Wrong alert message has been shown",{assertionName:"expectAlertMessage",got:msg,gotDesc:"Message shown",need:message,needDesc:"Expected message"}),global.alert=prevAlert},global.alert.__EXPECTED_ALERT__=!0,this.processCallbackFromTest(callback,null,this)},setNextConfirmReturnValue:function(value,callback){this.nextConfirmValue=value,this.processCallbackFromTest(callback,null,this)},setNextPromptReturnValue:function(value,callback){this.nextPromptReturnValue=value,this.processCallbackFromTest(callback,null,this)},waitForAnimations:function(callback){callback.call(this)},popupHasStartedLoading:function(popup,initialUrl){return"about:blank"==String(initialUrl).toLowerCase()||"about:blank"!=popup.location.href},switchTo:function(win,callback){var me=this;return this.waitFor({method:function(){for(var i=0;i<me.popups.length;i++)if(!me.popupHasStartedLoading(me.popups[i].popup,me.popups[i].url))return!1;return!0},suppressAssertion:!0,callback:function(){var found;if(win||(Joose.A.each(this.popups,function(handle){if(!handle.popup.closed)return found=handle.popup,!1}),win=found),"String"==this.typeOf(win)&&(win={title:win}),"Object"==this.typeOf(win)){found=null;var regexp=win.title||win.url;"String"==this.typeOf(regexp)&&(regexp=new RegExp("^"+this.escapeRegExp(regexp)+"$")),Joose.A.each(this.popups,function(handle){var popup=handle.popup;if(!popup.closed&&(win.url&&regexp.test(popup.location.href)||win.title&&regexp.test(popup.document&&popup.document.title||"")))return found=popup,!1}),win=found}if(!win||win.self!=win)return this.fail("Can't resolve target win: "+win),void this.processCallbackFromTest(callback,null,this);this.setGlobal(win),this.waitFor({suppressAssertion:!0,method:function(){return win.document&&"complete"==win.document.readyState},callback:callback})}}),this.global},setGlobal:function(newGlobal){this.global=newGlobal,this.simulator.global=newGlobal},switchToMain:function(callback){this.switchTo(this.scopeProvider.scope,callback)},waitForPageLoad:function(callback,scope){var me=this,global=this.global,unloaded=!1,description=Siesta.Resource("Siesta.Test.More").get("pageToLoad"),onUnloadHandler=function(){global.removeEventListener("unload",onUnloadHandler),unloaded=!0};global.addEventListener("unload",onUnloadHandler),this.chain({description:description,waitFor:function(){return unloaded||"complete"!=me.global.document.readyState}},function(next){global.removeEventListener("unload",onUnloadHandler),onUnloadHandler=global=null,next()},{description:description,waitFor:function(){return"complete"==me.global.document.readyState}},{waitFor:50},function(){me.processCallbackFromTest(callback,[me.global],scope||me)})},setTimeout:function(func,delay){(0,this.global.setTimeout)(func,delay)},clearTimeout:function(id){(0,this.global.clearTimeout)(id)},simulateDeactivateWindow:function(callback){this.blurWindow=this.global.open("about:blank"),callback&&callback.call(this)},simulateActivateWindow:function(callback){this.blurWindow&&this.blurWindow.close(),this.global.focus(),this.blurWindow=null,callback&&callback.call(this)},query:function(selector){return this.sizzle(selector)},throwsOkAsync:function(expected,desc,timeout){function done(){if(!doneCalled)return doneCalled=!0,me.endAsync(async),exceptionThrown||me.fail(desc,{assertionName:"throwsOkAsync",annotation:R.get("didntThrow")}),me.isHandlingThrowAsync=!1,me.global.onerror=prevOnError,!0}var R=Siesta.Resource("Siesta.Test.More"),me=this,exceptionThrown=!1,doneCalled=!1,prevOnError=this.global.onerror;this.on("beforetestfinalize",function(){doneCalled||done()},null,{single:!0});var async=this.beginAsync(timeout,done);return this.isHandlingThrowAsync=!0,this.global.onerror=function(msg,url,lineNumber,col,error){exceptionThrown=!0;var errorText=String(error||msg);return"RegExp"==me.typeOf(expected)?errorText.match(expected)?me.pass(desc,{descTpl:R.get("exMatchesRe"),expected:expected}):me.fail(desc,{assertionName:"throwsOkAsync",got:errorText,gotDesc:R.get("exceptionStringifiesTo"),need:expected,needDesc:R.get("needStringMatching")}):-1!=errorText.indexOf(expected)?me.pass(desc,{descTpl:R.get("exContainsSubstring"),expected:expected}):me.fail(desc,{assertionName:"throwsOkAsync",got:errorText,gotDesc:R.get("exceptionStringifiesTo"),need:expected,needDesc:R.get("needStringContaining")}),!0},done},livesOkAsync:function(desc,timeout){function done(){if(!doneCalled)return doneCalled=!0,me.endAsync(async),exceptionThrown||me.pass(desc,{descTpl:R.get("fnDoesntThrow")}),me.isHandlingThrowAsync=!1,me.global.onerror=prevOnError,!0}var R=Siesta.Resource("Siesta.Test.More"),me=this,exceptionThrown=!1,doneCalled=!1,prevOnError=this.global.onerror;this.on("beforetestfinalize",function(){doneCalled||done()},null,{single:!0});var async=this.beginAsync(timeout,done);return this.isHandlingThrowAsync=!0,this.global.onerror=function(msg,url,lineNumber,col,error){exceptionThrown=!0;var errorText=String(error||msg);return me.fail(desc,{assertionName:"livesOk",annotation:R.get("fnThrew")+": "+errorText}),!0},done},onException:function(){if(this.isHandlingThrowAsync)return!0}}}),Class("Siesta.Test.ExtJS",{isa:Siesta.Test.Browser,does:[Siesta.Test.ExtJSCore,Siesta.Test.ExtJS.Component,Siesta.Test.ExtJS.Element,Siesta.Test.ExtJS.FormField,Siesta.Test.ExtJS.Observable,Siesta.Test.ExtJS.Store,Siesta.Test.ExtJS.Grid,Siesta.Test.ExtJS.DataView,Siesta.Test.ExtJS.Ajax],has:{globalExtOverrides:null,extPathRegex1:/(.*ext(?:js)?(?:-\d\.\d+\.\d+)?.*?)\/(?:build\/)?ext(?:-all)?(?:-debug|-dev)?\.js/,extPathRegex2:/(.*ext(?:js)?-\d\.\d+(?:\.\d+)?.*?)\/ext-all(?:-debug|-dev)?\.js/,extPathRegex3:/(.*ext(?:js)?\/gpl\/\d\.\d+(?:\.\d+)?.*?)\/ext-all(?:-debug|-dev)?\.js/},methods:{getExtBundlePath:function(){for(var path,testDescriptor=this.project.getScriptDescriptor(this.url),me=this;testDescriptor&&!path;)testDescriptor.preload&&Joose.A.each(testDescriptor.preload,function(url){if(url.match&&(url.match(me.extPathRegex1)||url.match(me.extPathRegex2)||me.extPathRegex3.exec(url)))return path=url,!1}),testDescriptor=testDescriptor.parent;return path},getExtBundleFolder:function(){for(var folder,testDescriptor=this.project.getScriptDescriptor(this.url),me=this;testDescriptor&&!folder;)testDescriptor.preload&&Joose.A.each(testDescriptor.preload,function(url){var match=me.extPathRegex1.exec(url)||me.extPathRegex2.exec(url)||me.extPathRegex3.exec(url);return match&&(folder=match[1]),!1}),testDescriptor=testDescriptor.parent;return folder},getNumberOfGlobalExtOverrides:function(callback){var globalExtOverrides=this.globalExtOverrides;if(null!=globalExtOverrides)callback&&callback.call(this,globalExtOverrides.length,globalExtOverrides);else{var me=this,Ext=this.getExt(),extjsBundleURL=me.getExtBundlePath();if(!extjsBundleURL)return me.fail(Siesta.Resource("Siesta.Test.ExtJS","bundleUrlNotFound")),void(callback&&callback.call(me,null,null));this.expectGlobal("0");var frame=Ext.core.DomHelper.append(Ext.getBody(),{tag:"iframe",style:"width:1024px;height:768px;position:absolute;left:-10000px;top:-10000px",src:"about:blank"},!1),freshWin=frame.contentWindow;freshWin.document.open(),freshWin.document.write('<!DOCTYPE html><html><head><script type="text/javascript" src="'+extjsBundleURL+'"><\/script></head><body></body></html>'),freshWin.document.close();function resolveObject(hostObj,nameSpace){for(var parts=nameSpace.split("."),p=hostObj,i=0;i<parts.length;i++)p=p[parts[i]];return p}function ignore(name){for(var i=0;i<ignoreRegexp.length;i++)if(ignoreRegexp[i].test(name))return!0;return!1}function getObjectDifferences(cleanObj,dirtyObj,ns){var diff=[];for(var p in dirtyObj)try{if(dirtyObj.hasOwnProperty(p)){var dirtyValue=dirtyObj[p],cleanValue=cleanObj[p];(!cleanObj.hasOwnProperty(p)&&void 0===cleanValue||String(cleanValue)!=String(dirtyValue)&&("function"==typeof dirtyValue||Ext.isPrimitive(dirtyValue)))&&(ignore(ns+"."+p)||diff.push(ns+"."+p))}}catch(e){}return diff}var ignoreRegexp=[/Ext\.data\.Store\.ImplicitModel|collectorThreadId|Ext\.dom\.GarbageCollector\.lastTime/,/Ext.globalEvents.cur/i,/Ext\.dd\.(DragDropManager|DragDropMgr|DDM)\.(currentPoint|offsetX|offsetY)/];me.waitFor(function(){return freshWin.Ext&&freshWin.Ext.isReady},function(){var dirtyWin=me.global,overrides=[];Ext.iterate(Ext.ClassManager.classes,function(item){if(item.match(/^Ext\./)){var freshItem=resolveObject(freshWin,item),dirtyItem=resolveObject(dirtyWin,item);if(freshItem&&void 0!==dirtyItem){var staticDiff=getObjectDifferences(freshItem,dirtyItem,item);if(overrides.push.apply(overrides,staticDiff),dirtyItem.prototype){var prototypeDiff=getObjectDifferences(freshItem.prototype,dirtyItem.prototype,item+".prototype");overrides.push.apply(overrides,prototypeDiff)}}}}),me.globalExtOverrides=overrides,Ext.destroy(frame),callback&&callback.call(me,overrides.length,overrides)})}},assertNoGlobalExtOverrides:function(description,cb){this.getNumberOfGlobalExtOverrides(function(length,overrides){var R=Siesta.Resource("Siesta.Test.ExtJS");null==length?this.fail(R.get("assertNoGlobalExtOverridesInvalid")):(length?this.fail(description,{assertionName:"assertNoGlobalExtOverrides",descTpl:R.get("assertNoGlobalExtOverridesPassTpl"),got:length,gotDesc:R.get("assertNoGlobalExtOverridesGotDesc"),annotation:R.get("foundOverridesFor")+": `"+overrides.join("`, `")+"`"}):this.pass(description,{descTpl:R.get("assertNoGlobalExtOverridesPassTpl")}),cb&&cb.call(this))})},assertMaxNumberOfGlobalExtOverrides:function(maxNumber,description,cb){var R=Siesta.Resource("Siesta.Test.ExtJS");this.getNumberOfGlobalExtOverrides(function(length,overrides){null==length?this.fail(R.get("extOverridesInvalid")):(maxNumber<length?this.fail(description,{assertionName:"assertNoGlobalExtOverrides",descTpl:R.get("foundLessOrEqualThan")+" "+maxNumber+" "+R.get("globalOverrides"),got:length,gotDesc:R.get("nbrOverridesFound"),annotation:R.get("foundOverridesFor")+": `"+overrides.join("`, `")+"`"}):this.pass(description,{descTpl:R.get("foundLessOrEqualThan")+" "+maxNumber+" "+R.get("globalOverrides"),annotation:R.get("nbrOverridesFound")+": "+length}),cb&&cb.call(this))})},getTotalLayoutCounter:function(){var count=0;return this.Ext().each(this.cq("container"),function(c){count+=c.layoutCounter}),count},assertNoLayoutTriggered:function(fn,scope,description){var countBefore=this.getTotalLayoutCounter();fn.call(scope||this),this.is(this.getTotalLayoutCounter(),countBefore,description)},areAnimationsRunning:function(){var Ext=this.Ext();return Ext&&Ext.fx&&Ext.fx.Manager&&Ext.fx.Manager.items&&0<Ext.fx.Manager.items.getCount()}}}),Class("Siesta.Test.SenchaTouch",{isa:Siesta.Test.Browser,does:[Siesta.Test.ExtJSCore,Siesta.Test.ExtJS.Component,Siesta.Test.ExtJS.Element,Siesta.Test.ExtJS.Observable,Siesta.Test.ExtJS.Store,Siesta.Test.ExtJS.Ajax,Siesta.Test.ExtJS.FormField],has:{performSetup:!0,isSTSetupDone:!1,moveCursorBetweenPoints:!1},override:{isReady:function(){var result=this.SUPERARG(arguments),R=Siesta.Resource("Siesta.Test.SenchaTouch");return result.ready?this.parent||!this.performSetup||this.isSTSetupDone?{ready:!0}:{ready:!1,reason:R.get("STSetupFailed")}:result},doStart:function(){var me=this,Ext=this.getExt();Ext&&this.performSetup&&!this.parent&&Ext.setup({onReady:function(){me.isSTSetupDone=!0}}),this.SUPERARG(arguments)}},methods:{initialize:function(){this.parent||(this.simulator=null),this.SUPERARG(arguments)},getTouchBundlePath:function(){for(var path,testDescriptor=this.project.getScriptDescriptor(this.url);testDescriptor&&!path;)testDescriptor.preload&&Joose.A.each(testDescriptor.preload,function(url){if(url.match&&url.match(/(.*sencha-touch-\d\.\d+\.\d+.*?)\/sencha-touch(.*)\.js/))return path=url,!1}),testDescriptor=testDescriptor.parent;return path},getTouchBundleFolder:function(){for(var folder,testDescriptor=this.project.getScriptDescriptor(this.url);testDescriptor&&!folder;)testDescriptor.preload&&Joose.A.each(testDescriptor.preload,function(url){var match=/(.*sencha-touch-\d\.\d+\.\d+.*?)\/sencha-touch(.*)\.js/.exec(url);match&&(folder=match[1])}),testDescriptor=testDescriptor.parent;return folder},getExtBundleFolder:function(){var folder;return this.project.mainPreset.eachResource(function(resource){var desc=resource.asDescriptor(),match=/(.*sencha-touch-\d\.\d+\.\d+.*?)\/sencha-touch-all(?:-debug)?\.js/.exec(desc.url);match&&(folder=match[1])}),folder},moveFingerTo:function(target,callback,scope,offset){this.moveCursorTo.apply(this,arguments)},moveFingerBy:function(delta,callback,scope){if(!delta)throw Siesta.Resource("Siesta.Test.SenchaTouch").get("moveFingerByInvalidInput");this.moveCursorBy.apply(this,arguments)},scrollUntil:function(target,direction,checkerFn,callback,scope){var me=this,startDate=new Date,dir=direction,R=Siesta.Resource("Siesta.Test.SenchaTouch");switch(dir){case"u":case"up":direction="down";break;case"d":case"down":direction="up";break;case"l":case"left":direction="right";break;case"r":case"right":direction="left";break;default:throw R.get("invalidSwipeDir")+": "+direction}var inner=function(){checkerFn.call(scope||me,target)?me.processCallbackFromTest(callback,null,scope||me):me.swipe(target,direction,function(){if(new Date-startDate<this.waitForTimeout){var as=me.beginAsync();setTimeout(function(){me.endAsync(as),inner()},1e3)}else me.fail(R.get("scrollUntilFailed"))})};inner()},scrollUntilElementVisible:function(scrollable,direction,actionTarget,callback,scope){var me=this;if(actionTarget&&scrollable)this.scrollUntil(scrollable,direction,function(){var element=me.normalizeElement(actionTarget,!0);return me.elementIsInView(element)},callback,scope);else{var R=Siesta.Resource("Siesta.Test.SenchaTouch");this.fail(R.get("scrollUntilElementVisibleInvalid"))}},waitForScrollerPosition:function(scroller,pos,callback,scope,timeout){return this.waitFor({method:function(){return!("x"in pos&&pos.x!==scroller.position.x||"y"in pos&&pos.y!==scroller.position.y)},callback:callback,scope:scope,timeout:timeout,assertionName:"waitForScrollerPosition",description:" "+Siesta.Resource("Siesta.Test.SenchaTouch","scrollerReachPos")+" "+Siesta.Util.Serializer.stringify(pos)})},areAnimationsRunning:function(){var Ext=this.Ext();return Ext&&Ext.Anim&&!Joose.O.isEmpty(Ext.Anim.running)}}}),Class("Siesta.Test.jQuery",{isa:Siesta.Test.Browser,methods:{initialize:function(){this.expectGlobals("$","jQuery"),this.SUPER()},get$:function(){return this.global.$},normalizeElement:function(el){return el.jquery?el.get(0):this.SUPERARG(arguments)}}}),Class("Siesta.Content.Manager.Browser",{isa:Siesta.Content.Manager,has:{baseHost:function(){return window.location.host},baseProtocol:function(){return window.location.protocol}},methods:{load:function(url,onsuccess,onerror){var match=/^((?:https?|file):)?\/\/([^/]*)/i.exec(url);if(match&&(match[1]&&match[1]!=this.baseProtocol||match[2]!=this.baseHost))onerror("cross-domain access");else{var req=new JooseX.SimpleRequest;try{req.getText(url,!0,function(success,text){success?onsuccess(text):onerror(this+" not found")})}catch(e){onerror(e)}}}}}),Class("Siesta.Content.Manager.Browser.ExtJSCore",{isa:Siesta.Content.Manager.Browser}),Class("Siesta.Project.Browser",{isa:Siesta.Project,has:{id:null,testClass:Siesta.Test.Browser,viewportClass:"Siesta.Project.Browser.UI.Viewport",viewport:null,autoRun:!1,viewDOM:!1,scaleToFit:!0,scaleToFitMode:"full",domContainerRegion:"east",showCursor:!0,showTestDurationColumn:!1,speedRun:!0,turboMode:!1,mouseMovePrecision:1,failOnResourceLoadError:!1,failOnPromiseRejection:!0,contentManagerClass:Siesta.Content.Manager.Browser,scopeProvider:"Scope.Provider.IFrame",disableCaching:!1,baseUrl:window.location.href.replace(/(\?|#).*$/,"").replace(/\/[^/]*$/,"/"),baseHost:window.location.host,baseProtocol:window.location.protocol,forceDOMVisible:bowser.msie||bowser.msedge,observerMode:!1,runInPopup:!1,pageUrl:null,useStrictMode:!0,innerHtmlHead:null,innerHtmlBody:null,runCore:"parallel",forcedRunCore:null,simulateEventsWith:{is:"rw",init:"dispatchEvent"},testOfForcedIFrame:null,autoScrollElementsIntoView:!0,enableUnreachableClickWarning:!0,maintainViewportSize:!0,viewportWidth:1024,viewportHeight:768,recorderClass:function(){return Siesta.Recorder&&Siesta.Recorder.Recorder},recorderConfig:null,needUI:!0,stateful:!0,uiMask:null,uiMaskActive:!1,hostPageUrlStopsInheriting:function(){return this.buildHostPageUrlStopsInheriting()},rerunHotKey:"E",observerModeHotKey:"O",restartOnBlur:!1,focusChecker:{lazy:function(){var el=document.createElement("input");return el.setAttribute("style","position : absolute; left : -1000px; top : -1000px"),el.type="text",document.body.appendChild(el),el}},supportEcmaModules:function(){return"noModule"in document.createElement("script")}},after:{onBeforeScopePreload:function(scopeProvider,url){this.viewport&&this.viewport.onBeforeScopePreload(scopeProvider,url)},onTestSuiteStart:function(descriptors,contentManager,launchState){this.viewport&&this.viewport.onTestSuiteStart(descriptors,contentManager)},onTestSuiteEnd:function(descriptors,contentManager){this.viewport&&this.viewport.onTestSuiteEnd(descriptors,contentManager),delete this.testOfForcedIFrame,this.uiMaskActive&&this.hideUiMask()},onTestStart:function(test){this.viewport&&this.viewport.onTestStart(test),test.hasForcedIframe()?(this.testOfForcedIFrame&&this.hideForcedIFrame(this.testOfForcedIFrame),this.showForcedIFrame(test),this.testOfForcedIFrame=test):this.uiMaskActive&&this.hideUiMask()},onTestUpdate:function(test,result,parentResult){this.viewport&&this.viewport.onTestUpdate(test,result,parentResult),result instanceof Siesta.Result.Diagnostic&&result.isWarning&&this.needUI&&"undefined"!=typeof console&&console.warn&&console.warn(result+"")},onTestEnd:function(test){test.hasForcedIframe()&&this.hideForcedIFrame(test),test==this.testOfForcedIFrame&&(this.testOfForcedIFrame=null),this.viewport&&this.viewport.onTestEnd(test);var wrapper=test.scopeProvider&&test.scopeProvider.wrapper;wrapper&&(wrapper.scrollLeft=wrapper.scrollTop=0),document.body.scrollLeft=document.body.scrollTop=0},onTestFail:function(test,exception,stack){this.viewport&&this.viewport.onTestFail(test,exception,stack)}},methods:{setObserverMode:function(value){this.forcedRunCore=value?"sequential":null,this.observerMode=value},buildHostPageUrlStopsInheriting:function(){return{preload:[],innerHtmlHead:null,innerHtmlBody:null}},buildConfigSynonyms:function(){return Joose.O.extend(this.SUPER(),{pageUrl:"hostPageUrl",enablePageRedirect:"separateContext"})},createViewport:function(config){return Ext.create(this.viewportClass,config)},configure:function(){this.SUPERARG(arguments),this.id=this.title||window.location.href},start:function(){bowser.opera&&(this.autoCheckGlobals=!1),bowser.msie&&(this.hasOwnProperty("runCore")||(this.runCore="sequential")),this.SUPERARG(arguments)},populateCleanScopeGlobals:function(scopeProvider,callback){if(this.disableGlobalsCheck||bowser.msie&&bowser.version<9)return this.disableGlobalsCheck=!0,void callback();this.SUPER("Scope.Provider.IFrame",callback)},onUnload:function(){Joose.O.each(this.scopesByURL,function(scopeProvider,url){scopeProvider.cleanup()})},launch:function(){Siesta.Project.Browser.FeatureSupport(),this.SUPERARG(arguments)},setup:function(callback){var me=this,SUPER=this.SUPER;window.onunload=function(){me.onUnload()},window.parent||window.focus(),this.title&&(document.title=this.title),$(function(){var needUI=!(!me.hasOwnProperty("needUI")&&me.isAutomated)&&me.needUI;"undefined"!=typeof Ext&&needUI?(me.autoLaunchTests=!1,Ext.onReady(function(){SUPER.call(me,function(){var filter=me.getQueryParam("filter");me.viewport=me.createViewport({filter:filter?decodeURIComponent(filter):null,autoLaunch:me.getQueryParam("autolaunch"),title:me.title,project:me}),callback&&callback()})})):SUPER.call(me,callback)})},getDescriptorConfig:function(descriptor,configName,doNotLookAtRoot){if(!(configName in this.hostPageUrlStopsInheriting))return this.SUPERARG(arguments);var defaultValue=this.hostPageUrlStopsInheriting[configName],pageUrlConfigFound=!1,isInheriting=!1;do{if(pageUrlConfigFound=pageUrlConfigFound||this.descriptorHasOwnValueFor(descriptor,"pageUrl"),this.descriptorHasOwnValueFor(descriptor,configName)){var value=this.getConfigValueFromDescriptor(descriptor,configName);if("inherit"!=value)return value;isInheriting=!0}if(pageUrlConfigFound&&!isInheriting)return defaultValue;descriptor=descriptor.parent}while(descriptor&&descriptor!=this);return doNotLookAtRoot?void 0:this.getConfigValueFromDescriptor(this,configName)},normalizeScopeProvider:function(desc){this.SUPERARG(arguments),this.getDescriptorConfig(desc,"runInPopup")&&(desc.scopeProvider="Scope.Provider.Window")},getScopeProviderConfigFor:function(desc,launchId){var me=this,config=this.SUPERARG(arguments);config.cleanupDelay=0,config.name=desc.title||desc.url.replace(/(.*\/)?(.*)/,"$2"),config.cls="tr-iframe",config.performWrap=!0;var wrapper=document.createElement("div");return wrapper.className="tr-iframe-wrapper",wrapper.innerHTML="<div class='tr-close fa fa-close'>&nbsp;</div><div class='tr-iframe-wrapper-scroll-canvas'><div class='tr-iframe-wrapper-inner'></div></div>",wrapper.childNodes[0].onclick=function(){var test=me.getTestByURL(desc.url);test?(me.hideForcedIFrame(test),me.viewport&&me.viewport.onManualCloseOfForcedIframe(test)):(this.parentElement.style.left="-10000px",this.parentElement.style.top="-10000px")},config.wrapper=wrapper,config.iframeParentEl=wrapper.childNodes[1].childNodes[0],config.sourceURL=config.sourceURL||this.getDescriptorConfig(desc,"pageUrl"),config.minViewportSize=config.minViewportSize||{width:this.getDescriptorConfig(desc,"viewportWidth"),height:this.getDescriptorConfig(desc,"viewportHeight")},config.innerHtmlHead=this.getDescriptorConfig(desc,"innerHtmlHead"),config.innerHtmlBody=this.getDescriptorConfig(desc,"innerHtmlBody"),config.failOnResourceLoadError=this.getDescriptorConfig(desc,"failOnResourceLoadError"),config.failOnPromiseRejection=this.getDescriptorConfig(desc,"failOnPromiseRejection"),config.hasOwnProperty("useStrictMode")||(config.useStrictMode=this.getDescriptorConfig(desc,"useStrictMode")),config},getNewTestConfiguration:function(desc,scopeProvider,contentManager,launchState){var me=this,config=this.SUPERARG(arguments);return config.simulatorConfig=this.getSimulatorConfigForNewTest(desc),Joose.A.each(["forceDOMVisible","autoScrollElementsIntoView","restartOnBlur"],function(name){config[name]=me.getDescriptorConfig(desc,name)}),this.observerMode&&(config.forceDOMVisible=!0),config.browser=config.bowser=bowser,config},getSimulatorConfigForNewTest:function(desc){var me=this,config={};return this.hasOwnProperty("simulateEventsWith")&&(config.simulateEventsWith=this.simulateEventsWith),Joose.A.each(["actionDelay","afterActionDelay","dragDelay","pathBatchSize","mouseDragPrecision","mouseMovePrecision","enableUnreachableClickWarning"],function(name){null!=me.getDescriptorConfig(desc,name)&&(config[name]=me.getDescriptorConfig(desc,name))}),this.getDescriptorConfig(desc,"turboMode")?(config.speedRun=!1,Joose.O.extend(config,Siesta.Test.Simulator.speedPresets.turboMode)):this.getDescriptorConfig(desc,"speedRun")&&Joose.O.extend(config,Siesta.Test.Simulator.speedPresets.speedRun),config},testMustRunSequential:function(descriptor){return this.getDescriptorConfig(descriptor,"forceDOMVisible")},runCoreGeneral:function(descriptors,contentManager,launchState,callback){var me=this,sorted=this.sortDescriptors(descriptors,this.forcedRunCore,!1);me.runCoreSharedContext(sorted.sharedContextGroups,contentManager,launchState,function(){me.runCoreParallel(sorted.canRunParallel,contentManager,launchState,function(){me.runCoreSequential(sorted.mustRunSequential,contentManager,launchState,callback)})})},runCoreSharedContext:function(sharedContextGroups,contentManager,launchState,callback){var me=this,processDescriptor=function(group,isFirst,scopeProvider,firstDesc,testHolder){var descriptors=group.items;if(descriptors.length&&!launchState.needToStop){var desc=descriptors.shift(),noCleanup=0<descriptors.length;isFirst?me.processURL(desc,desc.index,contentManager,launchState,function(testHolder){processDescriptor(group,!1,me.scopesByURL[desc.url],desc,testHolder),testHolder=null},noCleanup,group):me.processUrlShared(desc,desc.index,contentManager,launchState,function(){processDescriptor(group,!1,scopeProvider,firstDesc,testHolder)},noCleanup,group,scopeProvider,firstDesc,testHolder)}else processGroup(sharedContextGroups)},processGroup=function(sharedContextGroups){if(sharedContextGroups.length&&!launchState.needToStop){var group=sharedContextGroups.shift();processDescriptor(group,!0)}else callback()};processGroup(sharedContextGroups)},processUrlShared:function(desc,index,contentManager,launchState,callback,noCleanup,sharedSandboxState,scopeProvider,firstDesc,testHolder){var me=this;desc.url;if(desc.isMissing)callback();else{var preloadErrors=[];this.getDescriptorConfig(desc,"transparentEx");delete scopeProvider.scope.describe.called,desc.testCode||this.cachePreload&&contentManager.hasContentOf(desc.url)?scopeProvider.runCode(desc.testCode||contentManager.getContentOf(desc.url),cont):scopeProvider.runScript(this.resolveURL(desc.url,scopeProvider,desc),cont)}function cont(){if(scopeProvider.scope){var testClass=me.getDescriptorConfig(desc,"testClass");"String"==me.typeOf(testClass)&&(testClass=Joose.S.strToClass(testClass));var testConfig=me.getNewTestConfiguration(desc,scopeProvider,contentManager,launchState,sharedSandboxState);(testHolder.test=new testClass(testConfig)).earlySetup(function(){cont2()},function(errorMessage){preloadErrors.push({isException:!1,message:errorMessage}),cont2()})}else callback();function cont2(){me.launchTest({testHolder:testHolder,desc:desc,scopeProvider:scopeProvider,contentManager:contentManager,launchState:launchState,preloadErrors:preloadErrors,startTestAnchor:scopeProvider.scope.StartTest,noCleanup:noCleanup,cleanupUrl:firstDesc.url,reusingSandbox:!0},callback)}}},normalizeURL:function(url){return/^jsan:/.test(url)&&(url="/jsan/"+url.replace(/^jsan:/,"").replace(/\./g,"/")+".js"),/\.js$/.test(url)||/\//.test(url)||/\.css(\?.*)?$/i.test(url)||(url="../lib/"+url.replace(/\./g,"/")+".js"),url},normalizeDescriptor:function(desc,parent,index,level){return!(desc=this.SUPERARG(arguments)).group&&desc.jasmine&&(desc.pageUrl=desc.url,desc.testCode=this.getJasmineTestCode(),desc.preload=[],desc.sandbox=!0),desc},resolveURL:function(url,scopeProvider,desc){return scopeProvider&&scopeProvider.sourceURL&&(url=this.absolutizeURL(url)),this.disableCaching&&(/\?./.test(url)?url+="&disableCaching="+(new Date).getTime():/\?$/.test(url)||(url+="?disableCaching="+(new Date).getTime())),url},absolutizeURL:function(url,baseUrl){if(/^((https?|file):)?\/\//.test(url))return url;if(/^\//.test(url))return this.baseProtocol+"//"+this.baseHost+url;baseUrl=(baseUrl=baseUrl||this.baseUrl).replace(/\?.*$/,"").replace(/\/[^/]*$/,"/");var absBaseUrl=this.absolutizeURL(baseUrl,this.baseUrl);return(absBaseUrl=absBaseUrl.replace(/\/?$/,"/"))+url},getUiMask:function(){if(this.uiMask)return this.uiMask;var uiMask=this.uiMask=document.createElement("div");return uiMask.className="tr-ui-mask",uiMask.style.display="none",document.body.appendChild(uiMask),uiMask},showUiMask:function(){this.getUiMask().style.display="block",this.uiMaskActive=!0},hideUiMask:function(){this.getUiMask().style.display="none",this.uiMaskActive=!1},showForcedIFrame:function(test){$.rebindWindowContext(window),test.isDOMForced=!0;var wrapper=test.scopeProvider.wrapper;$(wrapper).addClass("tr-iframe-forced"),$(wrapper).removeClass("tr-iframe-hidden"),$(wrapper).center(),wrapper.style.top=this.roundNumericStyleValue(wrapper.style.top),wrapper.style.left=this.roundNumericStyleValue(wrapper.style.left),test.fireEvent("testframeshow");var rect=wrapper.getBoundingClientRect();document.elementFromPoint(rect.left,rect.top)},roundNumericStyleValue:function(styleStr){var match=/(.*?)([^\d\.-]*)$/.exec(styleStr),rounded=Math.round(Number(match[1]));return String(rounded)+match[2]},hideForcedIFrame:function(test){$.rebindWindowContext(window),test.isDOMForced=!1,test.forceDOMVisible=!1;var wrapper=test.scopeProvider.wrapper;$(wrapper).removeClass("tr-iframe-forced"),$(wrapper).addClass("tr-iframe-hidden"),test.fireEvent("testframehide")},showForcedIFrameScreenshot:function(test){this.showUiMask(),$.rebindWindowContext(window);var wrapper=test.scopeProvider.wrapper;$(wrapper).addClass("tr-iframe-forced-screenshot"),$(wrapper).removeClass("tr-iframe-forced"),$(wrapper).removeClass("tr-iframe-hidden")},hideForcedIFrameScreenshot:function(test){this.hideUiMask(),$.rebindWindowContext(window);var wrapper=test.scopeProvider.wrapper;$(wrapper).removeClass("tr-iframe-forced-screenshot"),test.isDOMForced&&($(wrapper).addClass("tr-iframe-forced"),$(wrapper).center())},stopCurrentLaunch:function(sourceTest){if(!0===this.SUPER(sourceTest))return this.viewport&&this.viewport.onTestSuiteStop(sourceTest),!0},getQueryParam:function(paramName){return this.my.getQueryParam(paramName,!0)},getJasmineTestCode:function(){return";("+function(){StartTest(function(t){t.expectGlobals("getJasmineRequireObj","jasmineRequire","jasmine","xdescribe","describe","xdescribe","fdescribe","it","xit","fit","spyOn","fail","jsApiReporter","beforeEach","afterEach","beforeAll","afterAll","expect","pending"),window.jasmine?jasmine.SiestaReporter?jasmine.SiestaReporter.importResults(t):t.fail(t.resource("Siesta.Project.Browser","noJasmineSiestaReporter")):t.fail(t.resource("Siesta.Project.Browser","noJasmine"))})}.toString()+")();"},isStandardPackage:function(){return this.my.isStandardPackage(!0)},browserWindowHasFocus:function(){window.focus();var el=this.getFocusChecker();return el.focus({preventScroll:!0}),$.rebindWindowContext(window),$(el).is(":focus")},getSelectedTest:function(){var selected=this.viewport.slots.filesTree.getSelectionModel().getSelection()[0];if(selected)return this.getTestByURL(selected.get("url"))}},my:{methods:{isStandardPackage:function(calledFromInstance){return calledFromInstance||this.staticDeprecationWarning("isStandardPackage"),Boolean(Siesta.Project.Browser.Automation)},getQueryParam:function(paramName,calledFromInstance){calledFromInstance||this.staticDeprecationWarning("getQueryParam");var match=new RegExp("(?:\\?|&)"+paramName+"=(.*?)(?:\\?|&|$)","i").exec(window.location.search);return match?match[1]:null}}}}),Class("Siesta.Harness.Browser",{isa:Siesta.Project.Browser}),Singleton("Siesta.Project.Browser.FeatureSupport",{does:[Siesta.Util.Role.CanCalculatePageScroll],has:{isConfigured:!1,supports:Joose.I.Object,simulator:{lazy:"this.buildWebSimulator"},tests:{init:[{id:"TouchEvents",fn:function(){return this.isEventSupported("touchend",window)}},{id:"PointerEvents",fn:function(){return Boolean(window.PointerEvent)}},{id:"MSPointerEvents",fn:function(){return Boolean(window.MSPointerEvent)}},{id:"PointerEventsGeneric",fn:function(){return Boolean(window.PointerEvent||window.MSPointerEvent)}},{id:"mouseEnterLeave",fn:function(){var el=document.createElement("div");return"onmouseenter"in el&&"onmouseleave"in el}},{id:"enterOnAnchorTriggersClick",fn:function(){var sim=this.getSimulator(),E=Siesta.Test.UserAgent.KeyCodes().keys.ENTER,result=!1,anchor=$('<a href="foo" style="display:none">test me</a>');return $("body").append(anchor),anchor.focus({preventScroll:!0}),anchor.click(function(e){return!(result=!0)}),sim.simulateEvent(anchor,"keypress",{keyCode:E,charCode:0}),anchor.remove(),result}},{id:"canSimulateKeyCharacters",fn:function(){var sim=this.getSimulator(),input=$('<input class="siesta-hidden" type="text" />'),A=Siesta.Test.UserAgent.KeyCodes().keys.A;$("body").append(input),input.focus({preventScroll:!0}),sim.simulateEvent(input,"keypress",{keyCode:A,charCode:A}),sim.simulateEvent(input,"textInput",{text:"A"});var result="A"===input.val();return input.remove(),result}},{id:"canSimulateBackspace",fn:function(){var sim=this.getSimulator(),input=$('<input class="siesta-hidden" type="text" />'),BS=Siesta.Test.UserAgent.KeyCodes().keys.BACKSPACE,A=Siesta.Test.UserAgent.KeyCodes().keys.A;$("body").append(input),input.focus({preventScroll:!0}),sim.simulateEvent(input,"keypress",{keyCode:A,charCode:A}),sim.simulateEvent(input,"keypress",{keyCode:A,charCode:A}),sim.simulateEvent(input,"keypress",{keyCode:BS,charCode:BS});var result="A"===input.val();return input.remove(),result}},{id:"enterSubmitsForm",fn:function(){var sim=this.getSimulator(),E=Siesta.Test.UserAgent.KeyCodes().keys.ENTER,result=!1,form=$('<form method="post"><input type="text"/></form>'),input=$(form).find("input");return $("body").append(form),form[0].onsubmit=function(e){return!(result=!0)},input.focus({preventScroll:!0}),sim.simulateEvent(input,"keypress",{keyCode:E,charCode:0}),form.remove(),result}},{id:"imageWithIdCreatesGlobalEnumerable",fn:function(){var img=$('<img id="test_img_id"/>');$("body").append(img);var hasImgId=!1;for(var i in window)"test_img_id"==i&&(hasImgId=!0);return img.remove(),hasImgId}},{id:"inputFiresChangeAfterLosingFocus",fn:function(){var sim=this.getSimulator(),input=document.createElement("input"),result=!1,A=Siesta.Test.UserAgent.KeyCodes().keys.A;return input.className="siesta-hidden",document.body.appendChild(input),input.addEventListener("change",function(ev){result=ev.isTrusted}),input.focus({preventScroll:!0}),sim.simulateEvent(input,"keydown",{keyCode:A,charCode:A}),sim.simulateEvent(input,"keypress",{keyCode:A,charCode:A}),sim.simulateEvent(input,"keyup",{keyCode:A,charCode:A}),sim.simulateEvent(input,"textInput",{text:"A"}),input.blur(),document.body.removeChild(input),result}}]}},methods:{buildWebSimulator:function(){return new Siesta.Test.Simulator({global:window,test:{normalizeElement:function(a){return a[0]||a}}})},configure:function(){this.isConfigured||(this.isConfigured=!0,this.maintainScrollPositionDuring(function(){for(var i=0;i<this.tests.length;i++){var test=this.tests[i],testId=test.id,detectorFn=test.fn;try{this.supports[testId]=detectorFn.call(this)}catch(e){this.supports[testId]=!1}}}))},isEventSupported:function(eventName,element){var isSupported;return!!eventName&&(element&&"string"!=typeof element||(element=document.createElement(element||"div")),(isSupported=(eventName="on"+eventName)in element)||(element.setAttribute||(element=document.createElement("div")),element.setAttribute(eventName,""),isSupported="function"==typeof element[eventName],void 0!==element[eventName]&&(element[eventName]=void 0),element.removeAttribute(eventName)),isSupported)}}}),Role("Siesta.Project.Browser.ExtJSCore",{has:{loaderPath:null,requires:null,waitForExtComponentQueryReady:!0,failKnownBugIn:!1,recorderClass:function(){return Siesta.Recorder.ExtJS}},override:{getNewTestConfiguration:function(desc,scopeProvider,contentManager,launchState){var config=this.SUPERARG(arguments);return config.loaderPath=this.getDescriptorConfig(desc,"loaderPath"),config.requires=this.getDescriptorConfig(desc,"requires"),config.waitForExtComponentQueryReady=this.getDescriptorConfig(desc,"waitForExtComponentQueryReady"),config},buildSandboxHashStructure:function(){var structure=this.SUPERARG(arguments);return structure.push("loaderPath","requires"),structure},buildHostPageUrlStopsInheriting:function(){var res=this.SUPER();return res.loaderPath=!0,res}},methods:{createViewport:function(config){return Ext.create("Siesta.Project.Browser.UI.Viewport",config)},generateLoaderPathHook:function(){return function(StartTest,Ext,loaderPath){loaderPath&&!StartTest.loaderPathHookInstalled&&Ext&&Ext.Loader&&Ext.Loader.setPath&&(StartTest.loaderPathHookInstalled=!0,Ext.Loader.setPath(loaderPath))}},getLoaderPathHook:function(){var hook=function(installationHook){var parentWindow=window.opener||window.parent,project=parentWindow.Siesta.my.activeHarness;eval("("+installationHook+")")(StartTest,Ext,project.getDescriptorConfig(project.getScriptDescriptor(StartTest.id),"loaderPath"))};return";("+hook.toString()+")("+JSON.stringify(this.generateLoaderPathHook().toString())+")"}}}),Class("Siesta.Project.Browser.ExtJS",{isa:Siesta.Project.Browser,does:[Siesta.Project.Browser.ExtJSCore],has:{testClass:Siesta.Test.ExtJS,waitForExtReady:!0,waitForAppReady:!1,extVersion:null,failOnMultipleComponentMatches:!1,extVersionRegExp:/ext(?:js)?-(\d\.\d+\.\d+.*?)\//,contentManagerClass:Siesta.Content.Manager.Browser.ExtJSCore,innerHtmlHead:'<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">'},methods:{setup:function(callback){Function.prototype.$extIsFunction=!0,this.SUPER(function(){callback()})},getNewTestConfiguration:function(desc,scopeProvider,contentManager,launchState){var config=this.SUPERARG(arguments);return config.waitForExtReady=this.getDescriptorConfig(desc,"waitForExtReady"),config.waitForAppReady=this.getDescriptorConfig(desc,"waitForAppReady"),config},findExtVersion:function(){var found,me=this;return this.mainPreset.eachResource(function(resource){var match=me.extVersionRegExp.exec(resource.url);if(match)return found=match[1],!1}),found}}}),Class("Siesta.Harness.Browser.ExtJS",{isa:Siesta.Project.Browser.ExtJS}),Class("Siesta.Project.Browser.SenchaTouch",{isa:Siesta.Project.Browser,does:[Siesta.Project.Browser.ExtJSCore],has:{testClass:Siesta.Test.SenchaTouch,transparentEx:!0,keepNLastResults:0,performSetup:!0,forcedRunCore:"sequential",isRunningOnMobile:!0,contentManagerClass:Siesta.Content.Manager.Browser.ExtJSCore},methods:{setup:function(){this.isRunningOnMobile="undefined"!=typeof Ext&&Ext.getVersion&&Ext.getVersion("touch"),this.isRunningOnMobile||(this.keepNLastResults=2),this.SUPERARG(arguments)},getNewTestConfiguration:function(desc,scopeProvider,contentManager,launchState){var config=this.SUPERARG(arguments),pageUrl=this.getDescriptorConfig(desc,"pageUrl");return!desc.hasOwnProperty("performSetup")&&pageUrl?config.performSetup=!1:config.performSetup=this.getDescriptorConfig(desc,"performSetup"),config}}}),Class("Siesta.Harness.Browser.SenchaTouch",{isa:Siesta.Project.Browser.SenchaTouch}),Class("Siesta.Project.Browser.UI.MouseVisualizer",{has:{cursorEl:null,currentContainer:{required:!0},clickEvents:function(){return{click:null,touchend:null,contextmenu:null}},mouseDownEvents:function(){return{touchstart:null,mousedown:null}},mouseUpEvents:function(){return{touchend:null,mouseup:null}}},methods:{initialize:function(config){this.onEventSimulated=this.onEventSimulated.bind(this)},getCursorEl:function(){if(this.cursorEl)return this.cursorEl;var currentContainer=this.currentContainer;if(!currentContainer)throw"Need container for cursor";var el=document.createElement("div");return el.className="ghost-cursor fa fa-mouse-pointer",this.cursorEl=currentContainer.appendChild(el)},destroy:function(){var cursorEl=this.cursorEl;cursorEl&&(cursorEl.parentElement.removeChild(cursorEl),this.cursorEl=null),this.currentContainer=null},onEventSimulated:function(event,point){"number"==typeof event.clientX&&this.updatePointer(event.type,point)},updatePointer:function(eventType,point){var x=point[0],y=point[1];this.updateGhostCursor(x,y),eventType in this.clickEvents?this.showClickIndicator(eventType,x,y):eventType in this.mouseDownEvents&&this.getCursorEl().classList.add("ghost-cursor-press"),(eventType in this.mouseUpEvents||eventType in this.clickEvents)&&this.getCursorEl().classList.remove("ghost-cursor-press")},showClickIndicator:function(type,x,y){var clickEl=document.createElement("div");clickEl.className="ghost-cursor-click-indicator ",clickEl.style.setProperty("left",x+"px"),clickEl.style.setProperty("top",y+"px"),clickEl.addEventListener("animationend",this.afterAnimation),clickEl.addEventListener("webkitAnimationEnd",this.afterAnimation),this.currentContainer.appendChild(clickEl)},afterAnimation:function(){this.parentElement&&this.parentElement.removeChild(this)},updateGhostCursor:function(x,y){var cursorEl=this.getCursorEl(),translateStyle=bowser.opera?"translate("+x+"px,"+y+"px)":"translate3d("+x+"px, "+y+"px, 0)";cursorEl.style.setProperty("-webkit-transform",translateStyle),cursorEl.style.setProperty("transform",translateStyle)}}}),"undefined"!=typeof module&&(module.exports=Siesta),Class("Siesta.Util.Throttler",{has:{lastActivationTime:null,func:{required:!0},scope:{required:!0},buffer:null,throttle:null,bufferTimeoutId:null,args:null},methods:{tick:function(){var now=+new Date;this.args=arguments,null!=this.throttle&&(this.lastActivationTime||(this.lastActivationTime=now),now-this.lastActivationTime>this.throttle&&this.activate());if(null!=this.buffer){var me=this;this.bufferTimeoutId&&clearTimeout(this.bufferTimeoutId),this.bufferTimeoutId=setTimeout(function(){me.activate()},this.buffer)}},activate:function(){this.lastActivationTime=+new Date,this.bufferTimeoutId&&clearTimeout(this.bufferTimeoutId),this.bufferTimeoutId=null;var args=this.args;this.args=null,this.func.apply(this.scope,args)},cancel:function(){this.bufferTimeoutId&&clearTimeout(this.bufferTimeoutId),this.bufferTimeoutId=null,this.args=null},flush:function(){null!=this.bufferTimeoutId&&this.activate()}}}),Role("Siesta.Util.Role.CanCalculatePageScroll",{methods:{getElForPageScroll:function(win){var doc=(win=win||this.global).document;return doc.scrollingElement||(bowser.webkit||bowser.blink||bowser.msedge?doc.body:doc.documentElement)},getPageScrollX:function(win){(win=win||this.global).document;if(null!=window.pageXOffset)return win.pageXOffset;var scrollEl=this.getElForPageScroll();return scrollEl?scrollEl.scrollLeft:0},getPageScrollY:function(win){(win=win||this.global).document;if(null!=window.pageYOffset)return win.pageYOffset;var scrollEl=this.getElForPageScroll();return scrollEl?scrollEl.scrollTop:0},viewportXtoPageX:function(x,win){var docEl=(win=win||this.global).document.documentElement;return x+this.getPageScrollX(win)-docEl.clientLeft},viewportYtoPageY:function(y,win){var docEl=(win=win||this.global).document.documentElement;return y+this.getPageScrollY(win)-docEl.clientTop},pageXtoViewportX:function(x,win){var docEl=(win=win||this.global).document.documentElement;return x-this.getPageScrollX(win)+docEl.clientLeft},pageYtoViewportY:function(y,win){var docEl=(win=win||this.global).document.documentElement;return y-this.getPageScrollY(win)+docEl.clientTop},maintainScrollPositionDuring:function(func,scope){var parent=window.parent,isEmbedded=Boolean(parent),scrollLeftBefore=isEmbedded&&this.getPageScrollX(parent),scrollTopBefore=isEmbedded&&this.getPageScrollY(parent);if(func.call(scope||this),isEmbedded){var scrollEl=this.getElForPageScroll(parent);scrollLeftBefore!==this.getPageScrollX(parent)&&(scrollEl.scrollLeft=scrollLeftBefore),scrollTopBefore!==this.getPageScrollY(parent)&&(scrollEl.scrollTop=scrollTopBefore)}}}}),Role("Siesta.Util.Role.Dom",{does:[Siesta.Util.Role.CanCalculatePageScroll],has:{doesNotIncludeMarginInBodyOffset:!1},methods:{isCrossOriginWindow:function(win){try{var doc=win.document}catch(e){return!0}return!doc},closest:function(elem,selector,maxLevels){maxLevels=maxLevels||Number.MAX_VALUE;for(var docEl=elem.ownerDocument.documentElement,i=0;i<maxLevels&&elem&&elem!==docEl;elem=elem.parentNode){if(Siesta.Sizzle.matchesSelector(elem,selector))return elem;i++}return!1},contains:function(parentEl,childEl){if(!parentEl)return!1;if(parentEl.contains)return parentEl.contains(childEl);if(parentEl.compareDocumentPosition)return parentEl===childEl||Boolean(16&parentEl.compareDocumentPosition(childEl));throw new Error("Can't determine `contains` status")},matches:function(node,selector){return Siesta.Sizzle.matchesSelector(node,selector)},offset:function(elem){if(!elem)return null;var doc=elem.ownerDocument;if(!doc)return null;if(elem===doc.body)return this.bodyOffset(elem);var box=this.getBoundingClientRect(elem),win=doc.defaultView||doc.parentWindow;return box?{left:this.viewportXtoPageX(Math.floor(box.left),win),top:this.viewportYtoPageY(Math.floor(box.top),win)}:{left:0,top:0}},bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(this.initializeOffset(),this.doesNotIncludeMarginInBodyOffset){var style=getComputedStyle(body);top+=parseFloat(style.marginTop)||0,left+=parseFloat(style.marginLeft)||0}return{top:top,left:left}},initializeOffset:function(){var body=document.body,container=document.createElement("div"),bodyMarginTop=parseFloat(getComputedStyle(body).marginTop)||0,styles={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(var o in styles)container.style[o]=styles[o];container.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",body.insertBefore(container,body.firstChild);var innerDiv=container.firstChild,checkDiv=innerDiv.firstChild;innerDiv.nextSibling.firstChild.firstChild;checkDiv.style.position="fixed",checkDiv.style.top="20px",checkDiv.style.position=checkDiv.style.top="",innerDiv.style.overflow="hidden",innerDiv.style.position="relative",this.doesNotIncludeMarginInBodyOffset=body.offsetTop!==bodyMarginTop,body.removeChild(container),this.initializeOffset=function(){}},getElementWidth:function(el){return this.getBoundingClientRect(el).width},getElementHeight:function(el){return this.getBoundingClientRect(el).height},getWindowSize:function(win){var doc=win.document;return{width:win.innerWidth||doc.documentElement.clientWidth||doc.body.clientWidth,height:win.innerHeight||doc.documentElement.clientHeight||doc.body.clientHeight}},isPointWithinElement:function(x,y,el){var rect=this.getBoundingClientRect(el);return x>=rect.left&&x<=rect.right&&y>=rect.top&&y<=rect.bottom},isElementReachableAt:function(el,pageX,pageY,allowChild){allowChild=!1!==allowChild;var doc=el.ownerDocument,win=doc.defaultView||doc.parentWindow,foundEl=doc.elementFromPoint(this.pageXtoViewportX(pageX,win),this.pageYtoViewportY(pageY,win));return foundEl&&(foundEl===el||allowChild&&this.contains(el,foundEl))},isElementReachableAtCenter:function(el,allowChild){allowChild=!1!==allowChild;var offsets=this.offset(el);return this.isElementReachableAt(el,offsets.left+this.getElementWidth(el)/2,offsets.top+this.getElementHeight(el)/2,allowChild)},getBoundingClientRect:function(el){var svgEl=el.ownerSVGElement;if(svgEl&&(bowser.msie||bowser.msedge||bowser.gecko)){var elBox=el.getBBox(),svgRect=svgEl.getBoundingClientRect(),left=svgRect.left+elBox.x,top=svgRect.top+elBox.y;elBox.width;return{x:left,y:top,left:left,top:top,bottom:top+elBox.height,height:elBox.height,width:elBox.width}}return el.getBoundingClientRect()},nodeIsUnloaded:function(el){try{el&&el.tagName;var doc=el.ownerDocument,win=doc&&(doc.defaultView||doc.parentWindow);return!Boolean(win)}catch(e){return!(el=null)}},nodeIsOrphan:function(el){var doc=el.ownerDocument;return!(doc&&doc.body&&el.parentNode&&(el===doc.body||$.contains(doc.body,el)))},getNodeParents:function(node){node.ownerDocument;for(var nodes=[];node&&node.parentNode;node=node.parentNode)nodes.unshift(node);return nodes},getCommonAncestor:function(node1,node2){var parents1=this.getNodeParents(node1),parents2=this.getNodeParents(node2);if(parents1[0]!=parents2[0])return null;for(var i=0;i<parents1.length;i++)if(parents1[i]!==parents2[i])return parents1[i-1]}}}),Role("Siesta.Util.Role.CanParseOs",{methods:{parseOS:function(platform){return/Win/i.test(platform)?"Windows":/Mac/.test(platform)||/darwin/i.test(platform)?"MacOS":/Linux/i.test(platform)?"Linux":"unknown"}}}),Role("Siesta.Util.Role.CanGetType",{methods:{typeOf:function(object){return Object.prototype.toString.call(object).slice(8,-1)}}}),Role("Siesta.Util.Role.CanMergeArrayAttributeFromClassHierarchy",{methods:{mergeArrayAttributeFromClassHierarchy:function(name,cfg){for(var arrays=[],meta=this.meta;meta.hasAttribute(name);meta=meta.superClass.meta)arrays.push(meta.getAttribute(name).init());cfg.hasOwnProperty(name)&&this[name]&&arrays.unshift(this[name]);var result=[];return arrays.forEach(function(array){result.push.apply(result,array)}),result}}}),Role("Siesta.Recorder.Role.CanSwallowException",{does:[JooseX.Observable],has:{swallowExceptions:!1},methods:{safeBind:function(func,scope){var me=this;return scope=scope||me,me.swallowExceptions?function(){try{return func.apply(scope,arguments)}catch(e){me.fireEvent("exception",e)}}:func.bind(scope)}}}),Class("Siesta.Recorder.Target",{has:{targets:Joose.I.Array,activeTarget:null},methods:{initialize:function(){this.targets||(this.targets=[]);var firstTarget=this.targets[0];firstTarget&&!this.activeTarget&&(this.activeTarget=firstTarget.type)},clear:function(){this.targets=[]},getTargets:function(){var target=this.getTarget();return target&&target.targets||null},getTargetAsQueryString:function(){var target=this.getTarget();return"xy"==target.type?target.target:("cq"==target.type?">>":"")+target.target},getTarget:function(){return this.getTargetByType(this.activeTarget)},clearOffset:function(){this.setOffset(null)},setOffset:function(value){var target=this.getTarget();target&&(value?target.offset=value:delete target.offset)},getOffset:function(){var target=this.getTarget();if(target)return target.offset},getTargetByType:function(type){var targetByType;return Joose.A.each(this.targets,function(target){if(target.type==type)return targetByType=target,!1}),targetByType},setUserTarget:function(value,offset){var userTarget=this.getTargetByType("user");if(userTarget)userTarget.target=value,offset?userTarget.offset=offset:delete userTarget.offset;else{var target={type:"user",target:value};offset&&(target.offset=offset),this.targets.unshift(target)}this.activeTarget="user"},isTooGeneric:function(){var targets=this.targets;if(!targets||0===targets.length)return!0;if(1===targets.length&&"xy"==targets[0].type)return!0;if(2===targets.length){var xy=this.getTargetByType("xy"),css=this.getTargetByType("css");if(xy&&css&&"body"==css.target)return!0}return!1}}}),function(){var ID=1;Class("Siesta.Recorder.Event",{has:{id:function(){return ID++},type:null,timestamp:function(){return Date.now()},options:null,x:null,y:null,target:null,charCode:null,keyCode:null,button:null,deltaX:null,deltaY:null,deltaZ:null,rawEvent:null},methods:{},my:{has:{HOST:null},methods:{fromDomEvent:function(e){var options={};["altKey","ctrlKey","metaKey","shiftKey"].forEach(function(id){e[id]&&(options[id]=!0)});var target=e.target,config={type:e.type,target:target,options:options,rawEvent:e};if("wheel"===e.type&&(config.deltaX=e.deltaX,config.deltaY=e.deltaY,config.deltaZ=e.deltaZ),e.type.match(/^key/))config.charCode=e.charCode||e.keyCode,config.keyCode=e.keyCode;else if("number"==typeof e.clientX){var ownerDoc=target&&target.ownerDocument,docEl=ownerDoc&&ownerDoc.documentElement,bodyEl=ownerDoc&&ownerDoc.body,pageX=bodyEl?e.clientX+(bodyEl.scrollLeft||docEl.scrollLeft):e.pageX,pageY=bodyEl?e.clientY+(bodyEl.scrollTop||docEl.scrollTop):e.pageY;config.x=pageX,config.y=pageY,config.button=e.button}return new this.HOST(config)}}}})}(),function(){var ID=1;Class("Siesta.Recorder.Action",{has:{id:function(){return ID++},action:null,value:null,target:null,toTarget:null,by:null,waitForPageLoad:!1,options:null,sourceEvent:null,sourceEventTargetReachableAtCenter:!1,timestamp:function(){return(new Date).getTime()}},methods:{initialize:function(){var target=this.target;!target||target instanceof Siesta.Recorder.Target||(this.target=new Siesta.Recorder.Target({targets:target}));var toTarget=this.toTarget;!toTarget||toTarget instanceof Siesta.Recorder.Target||(this.toTarget=new Siesta.Recorder.Target({targets:toTarget}))},setAction:function(newAction){this.action=newAction,this.hasTarget()||(this.target&&this.target.clear(),this.toTarget&&this.toTarget.clear())},hasTarget:function(){var action=this.action||"";return this.isMouseAction()||"selectText"==action},getTarget:function(asInstance){var target=this.target;return asInstance?target:target&&target.getTarget()},getTimestamp:function(){return this.sourceEvent&&this.sourceEvent.timestamp||this.timestamp},isMouseAction:function(){return(this.action||"").toLowerCase()in{click:1,contextmenu:1,dblclick:1,drag:1,mousedown:1,mouseup:1,movecursorto:1,wheel:1}},resetValues:function(){this.target=null,this.value=null,this.toTarget=null,this.by=null,this.options=null,this.sourceEvent=null,this.waitForPageLoad=!1},parseOffset:function(offsetString){var values=offsetString.split(",");if(!(values.length<2)&&(values[0].match("%")||(values[0]=parseInt(values[0],10),!isNaN(values[0])))&&(values[1].match("%")||(values[1]=parseInt(values[1],10),!isNaN(values[1]))))return values},clearTargetOffset:function(keepOld){this.setTargetOffset(null,keepOld)},restoreTargetOffset:function(){var target=this.target;target&&target.__SAVED_OFFSET__&&(target.setOffset(target.__SAVED_OFFSET__),delete target.__SAVED_OFFSET__)},setTargetOffset:function(value,keepOld){var target=this.target;if(target){if(keepOld){var targetDesc=target.getTarget();target.__SAVED_OFFSET__=targetDesc.offset}target.setOffset(value)}},getTargetOffset:function(){var target=this.target;if(target)return target.getOffset()},objectToSource:function(obj){function convertFn(key,value){return(value=value||obj[key])instanceof Array?key+" : "+JSON.stringify(value):value&&"object"==typeof value?key+" : "+me.objectToSource(value):key+" : "+("string"==typeof value?'"'+value+'"':value)}var prependComma,me=this,result="";"type"==obj.action?(result=convertFn("type",obj.text),prependComma=!0,delete obj.action,delete obj.text):obj.target&&(result=convertFn(obj.action,obj.target),prependComma=!0,delete obj.target,delete obj.action);var keys=Object.keys(obj);return 0<keys.length&&(result=result+(prependComma?", ":"")+keys.map(function(key){return convertFn(key)}).join(", ")),"{ "+result+" }"},asCode:function(){var step=this.asStep();return step?"function"==typeof step?step:this.objectToSource(step):null},asStep:function(test){var actionName=this.action;if(!actionName)return null;var step={action:this.action},target=this.getTarget(),value=this.value,hasTarget=this.hasTarget();if(hasTarget||"type"==actionName||"scrollTo"==actionName){if(target)if("cq"==target.type){var splitPos=target.target.indexOf("->");step.target=0<splitPos?target.target.split("->").splice(1,0,">>").join():">>"+target.target}else step.target=target.target;else step.target="";target&&target.offset&&(step.offset=target.offset.slice())}if(this.options&&!Joose.O.isEmpty(this.options)&&(step.options=this.options),actionName.match(/^waitFor/))switch(actionName){case"waitForFn":if(test)var t=test;return{waitFor:eval("(function() {\n        "+value.replace(/\n/g,"\n        ")+"\n    })")};case"waitForMs":var val=parseInt(value,10);return{waitForMs:val};default:var obj={};return obj[actionName]=value||[],obj}else switch(actionName){case"click":case"dblclick":case"contextmenu":case"mousedown":case"mouseup":case"moveCursorTo":case"wheel":break;case"scrollTo":return{scrollTo:[step.target,value[0],value[1]]};case"moveCursorAlongPath":case"moveMouseAlongPath":var step={};return step[actionName]=[value],step;case"screenshot":step={screenshot:value};break;case"moveCursorBy":var by=this.value.split(",");by[0]=parseInt(by[0],10),by[1]=parseInt(by[1],10),step={action:"moveCursor",by:by};break;case"type":step.text=value;break;case"drag":var toTarget=this.toTarget;if(toTarget&&!toTarget.isTooGeneric()){step.to=toTarget.target,toTarget.offset&&(step.toOffset=toTarget.offset);break}step.by=this.by;break;case"fn":if(test)var t=test;return eval("(function(next) {\n        "+value.replace(/\n/g,"\n        ")+"\n        next();\n    })");default:var step={};return step[actionName]=value,step}return this.waitForPageLoad?{waitForPageLoad:[],trigger:step}:step}}})}(),Role("Ariadne.QueryFinder.TreeWalker",{methods:{getParent:function(el){throw new Error("Abstract method called: `getParent`")},contains:function(parentEl,childEl){throw new Error("Abstract method called: `contains`")}}}),Class("Ariadne.QueryFinder.Identifier",{does:Siesta.Util.Role.CanMergeArrayAttributeFromClassHierarchy,has:{finder:{required:!0},priority:100},methods:{identify:function(target,root,maze){return[]}}}),Class("Ariadne.QueryFinder.Combinator",{has:{elements:{required:!0},currentCombLen:null,combination:null},methods:{forAllCombinations:function(func){for(var elemLength=this.elements.length,combination=this.combination,combLen=combination?combination.length:1;combLen<=elemLength;combLen++)if(combination=this.forAllCombinationsOfLength(combLen,func,combination),this.combination=combination)return!1},forAllCombinationsOfLength:function(combLen,func,combination){var elements=this.elements,elemLength=elements.length;if(!(elemLength<combLen)){if(!combination){combination=new Array(combLen);for(var i=0;i<combLen;i++)combination[i]={current:i,max:elemLength-combLen+i}}if(combination.length!=combLen)throw new Error("Wrong combination state");var shouldStop;do{for(var collected=[],k=0;k<combLen;k++)collected.push(elements[combination[k].current]);if(!1===func(collected))return combination;shouldStop=!0;for(i=combLen-1;0<=i;i--){var combAt=combination[i];if(combAt.current<combAt.max){combAt.current++,shouldStop=!1;for(var j=i+1;j<combLen;j++)combination[j].current=combination[j-1].current+1;break}}}while(!shouldStop)}}}}),Role("Ariadne.QueryFinder.PathFinder",{has:{weightOptions:Joose.I.Array,weightOptionsByWeight:Joose.I.Object},methods:{extendPathVariants:function(pathVariants,variants,onlyWithIndex){0==pathVariants.length&&(pathVariants=[{segmentsById:{},hash:"",weight:0,ids:[]}]);for(var pathLen=pathVariants.length,varLen=variants.length,extendedPaths=[],pathsHashes={},i=0;i<pathLen;i++)for(var pathVariant=pathVariants[i],v=0;v<varLen;v++){var variant=variants[v];if(null==onlyWithIndex||variant.indicies[onlyWithIndex]){for(var segments=variant.variant,newPathVariant=pathVariant,hasNewSegment=!1,s=0;s<segments.length;s++){var segment=segments[s];newPathVariant.segmentsById[segment.id]||(hasNewSegment||(hasNewSegment=!0,newPathVariant=this.clonePathVariant(pathVariant)),newPathVariant.segmentsById[segment.id]=segment,newPathVariant.weight+=segment.weight,newPathVariant.ids.push(segment.id))}hasNewSegment&&(newPathVariant.ids.sort(function(a,b){return a-b}),newPathVariant.hash=newPathVariant.ids.join("")),pathsHashes[newPathVariant.hash]||(pathsHashes[newPathVariant.hash]=!0,extendedPaths.push(newPathVariant))}}return extendedPaths},clonePathVariant:function(pathVariant){var clone=Object.assign?Object.assign({},pathVariant):Joose.O.copy(pathVariant);return clone.segmentsById=Object.assign?Object.assign({},clone.segmentsById):Joose.O.copy(clone.segmentsById),clone.ids=clone.ids.slice(),clone},collectAllSimplePathsOfWeight:function(weight,paths,isDirectChild){for(var pathsLen=(paths=paths?paths.slice():[""]).length,i=0;i<pathsLen;i++)paths[i]+=(isDirectChild?"_+":"_")+this.index;var weightOption=this.weightOptionsByWeight[weight];if(!weightOption)throw new Error("Incorrect path weight");var minFromEdgesById=weightOption.minFromEdgesById;if(Joose.O.isEmpty(minFromEdgesById))return paths;var allPaths=[];for(var id in minFromEdgesById){var edge=minFromEdgesById[id];allPaths.push.apply(allPaths,edge.fromNode.collectAllSimplePathsOfWeight(weight-edge.weight,paths,edge.isDirectChild))}return allPaths},collectFullSimplePathCollection:function(){for(var simplePaths=[],i=0;i<this.weightOptions.length;i++){var weightOption=this.weightOptions[i];simplePaths.push({weight:weightOption.weight,simplePaths:this.collectAllSimplePathsOfWeight(weightOption.weight)})}return simplePaths}}}),Class("Ariadne.QueryFinder.Edge",{does:Siesta.Util.Role.HasUniqueGeneratedId,has:{finder:{required:!0},maze:{required:!0},fromNode:{required:!0},toNode:{required:!0},segmentVariants:Joose.I.Array,segmentVariantsHashes:Joose.I.Object,isDirectChild:!1,weight:1/0},methods:{register:function(){var fromNode=this.fromNode,toNode=this.toNode;if(fromNode.edgesToByIndex[toNode.index])throw new Error("Edge already exists");if(toNode.edgesFromByIndex[fromNode.index])throw new Error("Edge already exists");fromNode.edgesToByIndex[toNode.index]=this,toNode.edgesFromByIndex[fromNode.index]=this},consumeVariant:function(segments,segmentsCombInfo){1==arguments.length&&(segmentsCombInfo=this.finder.combineSegments(segments));var weight=segmentsCombInfo.weight,hash=segmentsCombInfo.hash;if(this.weight>weight&&(this.weight=weight,this.segmentVariants=[],this.segmentVariantsHashes={}),this.weight==weight&&!this.segmentVariantsHashes[hash]){var indicies={};return indicies[segments[0].index]=!0,this.segmentVariantsHashes[hash]=!0,this.segmentVariants.push({variant:segments,hash:hash,indicies:indicies}),!0}},relax:function(){var fromNode=this.fromNode,toNode=this.toNode;if(fromNode.isReachedWithDirectChildEdge()){for(var index=fromNode.index,segmentVariants=this.segmentVariants,hasVariantWithOwnSegments=!1,i=0;i<segmentVariants.length;i++)if(segmentVariants[i].indicies[index]){hasVariantWithOwnSegments=!0;break}if(!hasVariantWithOwnSegments)return!1}var possibleWeight=this.weight+fromNode.weightOptions[0].weight,existingWeightOption=toNode.weightOptionsByWeight[possibleWeight];if(existingWeightOption&&!existingWeightOption.minFromEdgesById[this.id])return existingWeightOption.minFromEdgesById[this.id]=this,!0;if(!existingWeightOption){var minFromEdgesById={};minFromEdgesById[this.id]=this;var weightOption={weight:possibleWeight,minFromEdgesById:minFromEdgesById};toNode.weightOptionsByWeight[possibleWeight]=weightOption;var weightOptions=toNode.weightOptions;for(i=0;i<weightOptions.length;i++)if(possibleWeight<weightOptions[i].weight)return weightOptions.splice(i,0,weightOption),!0;return weightOptions.push(weightOption),!0}}}}),Class("Ariadne.QueryFinder.Node",{does:[Siesta.Util.Role.HasUniqueGeneratedId,Ariadne.QueryFinder.PathFinder],has:{finder:{required:!0},maze:{required:!0},el:{required:!0},index:null,segments:null,combinator:null,upNode:null,downNode:null,queryCache:Joose.I.Object,edgesToByIndex:Joose.I.Object,edgesFromByIndex:Joose.I.Object,directChildUpEdge:null},methods:{contains:function(node){return this.finder.contains(this.el,node.el)},setSegments:function(value){var me=this;value.sort(function(s1,s2){return s1.weight-s2.weight}),value.forEach(function(segment){me.adoptSegment(segment)}),this.segments=value,this.combinator=new Ariadne.QueryFinder.Combinator({elements:value})},adoptSegment:function(segment){segment.index=this.index,segment.id=this.maze.segmentsIdGen++},isReachedWithDirectChildEdge:function(){var minFromEdgesById=this.weightOptions[0].minFromEdgesById;for(var id in minFromEdgesById){if(minFromEdgesById[id].isDirectChild)return!0}return!1},addEdgeTo:function(toNode,segments,segmentsCombInfo){2==arguments.length&&(segmentsCombInfo=this.finder.combineSegments(segments));var edge=this.edgesToByIndex[toNode.index];if(edge||(edge=new Ariadne.QueryFinder.Edge({finder:this.finder,maze:this.maze,fromNode:this,toNode:toNode})).register(),edge.weight>=segmentsCombInfo.weight)return edge.consumeVariant(segments,segmentsCombInfo)},addAllEdgesTo:function(toNode,segments,segmentsCombInfo){if(toNode==this||this.contains(toNode))throw new Error("Invalid nodes for edge");2==arguments.length&&(segmentsCombInfo=this.finder.combineSegments(segments));for(var from=this;from&&from!=toNode;from=from.upNode)for(var to=from.upNode;to&&to!=toNode.upNode;to=to.upNode)from.addEdgeTo(to,segments,segmentsCombInfo)},buildEdges3:function(maxSegments){var me=this,el=this.el,finder=this.finder,maze=this.maze,root=maze.getRoot(),foundUniqueId=!1;return this.combinator.forAllCombinationsOfLength(maxSegments,function(segments){var segmentsCombInfo=finder.combineSegments(segments);if(segmentsCombInfo)for(var query=segmentsCombInfo.query,rootNode=root;rootNode&&rootNode!=me;){var existingEdge=me.edgesToByIndex[rootNode.index];if(existingEdge&&segmentsCombInfo.weight>existingEdge.weight)rootNode=rootNode.downNode;else{var queryRes=maze.doQuery(query,rootNode);if(1==queryRes.length&&queryRes[0]==el){if(me.addAllEdgesTo(rootNode,segments,segmentsCombInfo),rootNode==root&&segmentsCombInfo.hasId)return!(foundUniqueId=!0);break}if(0<queryRes.length){for(var commonContainer=rootNode.downNode,lowestCommonContainer=null;commonContainer&&commonContainer!=me;){for(var containsAll=!0,i=0;i<queryRes.length;i++)if(commonContainer.el==queryRes[i]||!finder.contains(commonContainer.el,queryRes[i])){containsAll=!1;break}if(!containsAll)break;commonContainer=(lowestCommonContainer=commonContainer).downNode}lowestCommonContainer&&(lowestCommonContainer.addAllEdgesTo(rootNode,segments,segmentsCombInfo),rootNode=lowestCommonContainer)}rootNode=rootNode.downNode}}}),!foundUniqueId}}}),Class("Ariadne.QueryFinder.Maze",{does:[Siesta.Util.Role.CanGetType],has:{finder:{required:!0},nodes:Joose.I.Array,segmentsIdGen:1,encounteredMandatoryId:!1},methods:{getRoot:function(){return this.nodes[this.nodes.length-1]},doQuery:function(query,rootNode){var queryCache=rootNode.queryCache;return queryCache[query]?queryCache[query]:queryCache[query]=this.finder.doQuery(query,rootNode.el)},buildVertices:function(target,root){for(var prevNode,nodes=this.nodes=[],currentEl=target,finder=this.finder,identifiers=finder.identifiers,directChildIdentifier=finder.directChildIdentifier;currentEl;){var node=new Ariadne.QueryFinder.Node({finder:finder,maze:this,el:currentEl,index:nodes.length});if(prevNode&&((prevNode.upNode=node).downNode=prevNode,directChildIdentifier)){var segment=directChildIdentifier.identify(prevNode.el,root,this);if(segment){segment=this.normalizeIdentifierResult(segment)[0];var directChildUpEdge=new Ariadne.QueryFinder.Edge({finder:finder,maze:this,isDirectChild:!0,fromNode:prevNode,toNode:node});prevNode.directChildUpEdge=directChildUpEdge,prevNode.adoptSegment(segment),directChildUpEdge.consumeVariant([segment],finder.combineSegments([segment],!0))}}if(prevNode=node,nodes.push(node),currentEl==root)break;for(var segments=[],j=0;j<identifiers.length;j++){var compSegments=identifiers[j].identify(currentEl,root,this);compSegments&&segments.push.apply(segments,this.normalizeIdentifierResult(compSegments))}node.setSegments(segments),currentEl=finder.getParent(currentEl)}nodes[0].weightOptions=[{weight:0,minFromEdgesById:{}}],nodes[0].weightOptionsByWeight[0]=nodes[0].weightOptions[0]},normalizeIdentifierResult:function(segments){var me=this;return"Array"!=this.typeOf(segments)&&(segments=[segments]),segments.map(function(segment){return"String"==me.typeOf(segment)?{query:segment,weight:1e3}:(segment.hasOwnProperty("weight")||(segment.weight=1e3),segment)})},computePath:function(prevUpdatedNodes){var nodes=this.nodes,iteration=(this.getRoot(),0);prevUpdatedNodes||((prevUpdatedNodes={})[nodes[0].id]=nodes[0]);do{iteration++;var updatedNodes={},somethingUpdated=!1;for(var id in prevUpdatedNodes){var fromNode=prevUpdatedNodes[id];if(0!==fromNode.weightOptions.length){for(var toIndex in fromNode.edgesToByIndex){var edge=fromNode.edgesToByIndex[toIndex],toNode=edge.toNode;edge.relax()&&(updatedNodes[toNode.id]=toNode,somethingUpdated=!0)}var directChildUpEdge=fromNode.directChildUpEdge;if(directChildUpEdge&&directChildUpEdge.relax())updatedNodes[(toNode=directChildUpEdge.toNode).id]=toNode,somethingUpdated=!0}}prevUpdatedNodes=updatedNodes}while(somethingUpdated&&iteration<nodes.length)},buildEdges:function(){for(var recognizers=this.finder.recognizers,j=0;j<recognizers.length;j++)recognizers[j].recognize(this);for(var nodes=this.nodes,i=0;i<nodes.length-1&&!1!==nodes[i].buildEdges3(1);i++)nodes[i].buildEdges3(2),nodes[i].buildEdges3(3)},expandSimplePaths:function(paths){for(var nodes=this.nodes,pathsHashes={},pathVariants=[],i=0;i<paths.length;i++){for(var path=paths[i].split("_"),variants=[],j=path.length-1;1<j;j--){var isDirectChildEdge="+"==path[j][0],onlyWithOwnIndex=j<path.length-1&&"+"==path[j+1][0],fromNode=nodes[Number(path[j])],edge=isDirectChildEdge?fromNode.directChildUpEdge:fromNode.edgesToByIndex[Number(path[j-1])];variants=fromNode.extendPathVariants(variants,edge.segmentVariants,onlyWithOwnIndex?fromNode.index:null)}for(var k=0;k<variants.length;k++){var pathVariant=variants[k];pathsHashes[pathVariant.hash]||(pathVariants.push(pathVariant),pathsHashes[pathVariant.hash]=!0)}}return pathVariants.sort(function(a,b){return a.weight-b.weight}),pathVariants},findAllPaths:function(options){this.computePath();for(var simplePathsCollection=this.getRoot().collectFullSimplePathCollection(),i=0;i<simplePathsCollection.length;i++){var simplePaths=simplePathsCollection[i].simplePaths,queryInfos=this.verifySimplePathGroup(simplePaths,options);if(queryInfos.length)return options&&options.detailed?queryInfos:queryInfos.map(function(queryInfo){return queryInfo.query})}return[]},verifySimplePathGroup:function(simplePaths,options){for(var root=this.getRoot(),finder=this.finder,pathVariants=this.expandSimplePaths(simplePaths),queryInfos=[],targetEl=this.nodes[0].el,rootEl=root.el,i=0;i<pathVariants.length;i++){var variant=pathVariants[i],segments=[];for(var id in variant.segmentsById)segments.push(variant.segmentsById[id]);var queryInfo=finder.combineSegments(segments);if(queryInfo&&finder.verifyQuery(queryInfo.query,targetEl,rootEl)&&(queryInfos.push(queryInfo),options&&options.singleOnly))return queryInfos}return queryInfos},countEdges:function(log){var counter=0;return this.nodes.forEach(function(node){for(var index in node.edgesToByIndex){var edge=node.edgesToByIndex[index];counter+=edge.segmentVariants.length,log&&edge.segmentVariants.forEach(function(variant){console.log("Edge from: "+edge.fromNode.index+"["+edge.fromNode.el.tagName+"] to "+edge.toNode.index+"["+edge.toNode.el.tagName+"] query: "+edge.finder.combineSegments(variant.variant).query)})}}),counter}}}),Class("Ariadne.QueryFinder",{does:[Ariadne.QueryFinder.TreeWalker],has:{recognizers:Joose.I.Array,identifiers:Joose.I.Array,directChildIdentifier:null,enableMandatoryId:!0},methods:{initialize:function(){this.initRecognizers(),this.initIdentifiers(),this.recognizers.sort(function(r1,r2){return r2.priority-r1.priority}),this.identifiers.sort(function(r1,r2){return r2.priority-r1.priority})},addRecognizer:function(instance){return this.recognizers.push(instance),instance},addIdentifier:function(instance){return this.identifiers.push(instance),instance},initRecognizers:function(){},initIdentifiers:function(){},findQuery:function(target,root){return this.findQueries(target,root,{singleOnly:!0})[0]},findQueries:function(target,root,options){if(!target)throw new Error("No target");if(!root)throw new Error("No root");if(target==root)throw new Error("Can't find query - target and root are the same");if(this.contains(target,root))throw new Error("Can't find query - root is contained within target, need to swap the arguments?");var maze=new Ariadne.QueryFinder.Maze({finder:this});return maze.buildVertices(target,root),maze.buildEdges(),maze.findAllPaths(options)},forAllCombinations:function(segments,func){return new Ariadne.QueryFinder.Combinator({elements:segments}).forAllCombinations(func)},bisect:function(leftIndex,rightIndex,func){for(;leftIndex<=rightIndex;){var middleIndex=Math.round((leftIndex+rightIndex)/2),res=func(middleIndex);if(!1===res)return!1;if(leftIndex==rightIndex)return;if(null==res)throw new Error("Unknown bisect direction");res<0&&(rightIndex=middleIndex-1),0<res&&(leftIndex=middleIndex+1)}},combineSegments:function(segments,allowDanglingDirectChild){for(var queryComponents=[],totalWeight=0,ids=[],processed={},hasId=!1,i=0;i<segments.length;i++){var segment=segments[i],segmentId=segment.id;if(!processed[segmentId]){processed[segmentId]=!0,ids.push(segmentId);var index=segment.index;if(queryComponent=(queryComponent=queryComponents[index])||(queryComponents[index]={segments:[],hasLeading:!1,child:!1}),totalWeight+=segment.weight,segment.leading){if(queryComponent.hasLeading)return null;queryComponent.hasLeading=!0,queryComponent.segments.unshift(segment.query)}else queryComponent.segments.push(segment.query);segment.child&&(queryComponent.child=!0),segment.isId&&(hasId=!0)}}var query="";for(i=queryComponents.length-1;0<=i;i--){var queryComponent;if(queryComponent=queryComponents[i]){if(!allowDanglingDirectChild&&queryComponent.child&&(i==queryComponents.length-1||!queryComponents[i+1]))throw new Error("Invalid direct child component");var component=queryComponent.segments.join("");query?query+=(queryComponent.child?" > ":" ")+component:query=component}}return ids.sort(function(a,b){return a-b}),{query:query,weight:totalWeight,hasId:hasId,hash:ids.join("")}},doQuery:function(query,root){throw new Error("Abstract method called: `doQuery`")},verifyQuery:function(query,target,root){var queryRes=this.doQuery(query,root);return 1==queryRes.length&&queryRes[0]==target}}}),Role("Ariadne.DomQueryFinder.Role.DomHelper",{does:[Siesta.Util.Role.CanGetType],methods:{ignoreCssClass:function(cls,dom){return!1},getCssClasses:function(dom){var classes="String"==this.typeOf(dom.className)?dom.className.trim():"",significantClasses=[],index={};classes=classes&&classes.split(/\s+/)||[];for(var i=0;i<classes.length;i++){var cssClass=classes[i];index[cssClass]||(this.ignoreCssClass(cssClass,dom)||significantClasses.push(cssClass),index[cssClass]=!0)}return significantClasses},escapeDomSelector:function(selector,asId){return asId?Siesta.Sizzle.escape(selector):Siesta.Sizzle.escape("L"+selector).substring(1).replace(/\\ /g," ")},unEscapeDomSelector:function(selector){return Siesta.Sizzle.unescape(selector)}}}),Role("Ariadne.DomQueryFinder.TreeWalker",{methods:{getParent:function(el){return el.parentNode},contains:function(parentEl,childEl){if(parentEl.contains)return parentEl.contains(childEl);if(parentEl.compareDocumentPosition)return parentEl===childEl||Boolean(16&parentEl.compareDocumentPosition(childEl));throw new Error("Can't determine `contains` status")}}}),Class("Ariadne.DomQueryFinder.Identifier.AttributeValue",{isa:Ariadne.QueryFinder.Identifier,does:Ariadne.DomQueryFinder.Role.DomHelper,has:{attributes:function(){return["name","title"]}},methods:{initialize:function(cfg){this.attributes=this.mergeArrayAttributeFromClassHierarchy("attributes",cfg)},ignoreAttribute:function(target,attributeName){return!1},identify:function(target,root,maze){for(var attributes=this.attributes,segments=[],i=0;i<attributes.length;i++){var attribute=attributes[i];target.hasAttribute(attribute)&&!this.ignoreAttribute(target,attribute)&&segments.push("["+attribute+"='"+this.escapeDomSelector(target.getAttribute(attribute))+"']")}return segments}}}),Class("Ariadne.DomQueryFinder.Identifier.TagName",{isa:Ariadne.QueryFinder.Identifier,does:Ariadne.DomQueryFinder.Role.DomHelper,methods:{identify:function(target,root,maze){var doc=target.ownerDocument,isUnique=!(maze.nodes.length&&target!=maze.nodes[0].el||target!=doc.body&&target!=doc.documentElement);return{query:this.escapeDomSelector(target.tagName.toLowerCase()),leading:!0,weight:isUnique?900:1e3}}}}),Class("Ariadne.DomQueryFinder.Identifier.Contains",{isa:Ariadne.QueryFinder.Identifier,does:Ariadne.DomQueryFinder.Role.DomHelper,has:{maxCharsForContainsSelector:30},methods:{identify:function(target,root,maze){this.attributes;var children=target.children||target.childNodes;if(0==children.length||1==children.length&&!children[0].innerHTML){var text=target.textContent.trim();if(1<text.length)return text.length<=this.maxCharsForContainsSelector?{query:":textEquals("+this.escapeDomSelector(text)+")"}:{query:":contains("+this.escapeDomSelector(text.substr(0,this.maxCharsForContainsSelector))+")"}}return null}}}),Class("Ariadne.DomQueryFinder.Identifier.CssClass",{isa:Ariadne.QueryFinder.Identifier,does:Ariadne.DomQueryFinder.Role.DomHelper,has:{ignoreCssClasses:function(){return["^null$","^undefined$"]},ignoreCssClassesRegExp:null},methods:{initialize:function(cfg){var ignoreCssClasses=this.mergeArrayAttributeFromClassHierarchy("ignoreCssClasses",cfg);this.ignoreCssClassesRegExp=ignoreCssClasses.length?new RegExp(ignoreCssClasses.join("|")):/\0/},identify:function(target,root,maze){for(var classes=this.processCssClasses(this.getCssClasses(target),target),segments=[],i=0;i<classes.length;i++)segments.push({query:"."+this.escapeDomSelector(classes[i],!0),weight:this.getWeightForCssClass(classes[i],target)});return segments},getWeightForCssClass:function(cls,target){return 1e3},ignoreCssClass:function(cls,dom){return this.ignoreCssClassesRegExp.test(cls)},processCssClasses:function(classes,target){return classes}}}),Class("Ariadne.DomQueryFinder.Identifier.Id",{isa:Ariadne.QueryFinder.Identifier,does:Ariadne.DomQueryFinder.Role.DomHelper,has:{uniqueDomNodeProperty:null,shouldIgnoreDomElementId:null},methods:{identify:function(target,root,maze){var idProperty=this.uniqueDomNodeProperty||"id",id=target.getAttribute(idProperty),shouldIgnoreDomElementId=this.shouldIgnoreDomElementId;if(!id||this.ignoreDomId(id,target)||shouldIgnoreDomElementId&&shouldIgnoreDomElementId(id,target))return null;var weight=maze.encounteredMandatoryId||!this.finder.enableMandatoryId?1e3:-1e5;return maze.encounteredMandatoryId=!0,{query:"id"==idProperty?"#"+this.escapeDomSelector(id,!0):"["+idProperty+"='"+this.escapeDomSelector(id)+"']",weight:weight,isId:!0}},ignoreDomId:function(){return!1}}}),Class("Ariadne.DomQueryFinder.Identifier.NthOfType",{isa:Ariadne.QueryFinder.Identifier,methods:{identify:function(target,root,maze){var parentElement=target.parentElement;if(!parentElement)return null;for(var siblings=parentElement.children||parentElement.childNodes,counter=0,tagName=target.tagName.toLowerCase(),i=0;i<siblings.length&&(siblings[i].tagName.toLowerCase()!=tagName||(counter++,siblings[i]!=target));i++);return{query:":nth-of-type("+counter+")",weight:1e6}}}}),Class("Ariadne.DomQueryFinder.Identifier.DirectChild",{isa:Ariadne.DomQueryFinder.Identifier.NthOfType,methods:{identify:function(target,root,maze){if(!target.parentElement||target.parentElement==root)return null;var segment=this.SUPERARG(arguments);return segment.query=target.tagName.toLowerCase()+segment.query,segment.leading=!0,segment.child=!0,segment.weight*=10,segment}}}),Class("Ariadne.DomQueryFinder",{isa:Ariadne.QueryFinder,does:Ariadne.DomQueryFinder.TreeWalker,has:{uniqueDomNodeProperty:null,shouldIgnoreDomElementId:null,ignoreCssClasses:null},methods:{initRecognizers:function(){},initIdentifiers:function(){this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.Id({uniqueDomNodeProperty:this.uniqueDomNodeProperty,shouldIgnoreDomElementId:this.shouldIgnoreDomElementId,finder:this,priority:1e4})),this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.CssClass({ignoreCssClasses:this.ignoreCssClasses,finder:this,priority:1e3})),this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.Contains({finder:this,priority:1e3})),this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.AttributeValue({finder:this,priority:1e3})),this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.TagName({finder:this,priority:100})),this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.NthOfType({finder:this,priority:10})),this.directChildIdentifier=new Ariadne.DomQueryFinder.Identifier.DirectChild({finder:this})},doQuery:function(query,root){return/:contains\(/.test(query)||/:textEquals\(/.test(query)||/:nth-of-type\(\d/.test(query)?Siesta.Sizzle(query,root):(root||document).querySelectorAll(query)},findQueries:function(target,root,options){if(!target)throw new Error("No target");return root=root||target.ownerDocument,this.SUPER(target,root,options)}}}),Class("Siesta.Recorder.TargetExtractor",{does:[Siesta.Util.Role.Dom,Siesta.Recorder.Role.CanSwallowException],has:{ariadneDomFinder:null,shouldIgnoreDomElementId:null,ignoreCssClasses:null,uniqueDomNodeProperty:"id",recorder:null},methods:{initialize:function(){this.ariadneDomFinder=new Ariadne.DomQueryFinder({uniqueDomNodeProperty:this.uniqueDomNodeProperty,shouldIgnoreDomElementId:this.shouldIgnoreDomElementId,ignoreCssClasses:this.ignoreCssClasses}),this.swallowExceptions&&(this.findDomQueryFor=this.safeBind(this.findDomQueryFor))},getBubbleTarget:function(){return this.recorder},findOffset:function(pageX,pageY,relativeTo){var offset=this.offset(relativeTo);return offset.left=offset.left,offset.top=offset.top,[pageX-offset.left,pageY-offset.top]},findDomQueryFor:function(target,root){return this.ariadneDomFinder.findQuery(target,root)},getTargets:function(event,saveOffset,targetOverride,onlyXY){var cssQuery,result=[],target=targetOverride||event.target,hasCoordinates=null!=event.x&&null!=event.y;if(onlyXY&&!hasCoordinates)return result;if(!(onlyXY||target==target.ownerDocument.body&&hasCoordinates)&&(cssQuery=this.findDomQueryFor(target))){var data={type:"css",target:cssQuery};!hasCoordinates||!saveOffset&&this.isElementReachableAtCenter(target,!1)||(data.offset=this.findOffset(event.x,event.y,target)),result.push(data)}return hasCoordinates&&result.push({type:"xy",target:[event.x,event.y]}),result}}}),Role("Siesta.Recorder.Role.CanRecordMouseMove",{does:[Siesta.Util.Role.CanCalculatePageScroll,Siesta.Recorder.Role.CanSwallowException],has:{recordMouseMove:!0,cursorPosition:Joose.I.Array,lastMoveTimestamp:null,lastMouseMoveEvent:null},override:{initialize:function(){this.SUPERARG(arguments),this.onBodyMouseMove=this.safeBind(this.onBodyMouseMove),this.onBodyMouseOver=this.safeBind(this.onBodyMouseOver),this.onBodyMouseOut=this.safeBind(this.onBodyMouseOut)},onStart:function(){this.SUPERARG(arguments);var body=this.window.document.body;this.recordMouseMove&&(body.addEventListener("mouseover",this.onBodyMouseOver,!0),body.addEventListener("mouseout",this.onBodyMouseOut,!0),body.addEventListener("mousemove",this.onBodyMouseMove,!0))},onStop:function(){this.SUPERARG(arguments);var body=this.window.document.body;this.recordMouseMove&&(body.removeEventListener("mouseover",this.onBodyMouseOver,!0),body.removeEventListener("mouseout",this.onBodyMouseOut,!0),body.removeEventListener("mousemove",this.onBodyMouseMove,!0),this.lastMouseMoveEvent=null)}},methods:{saveMouseMoveData:function(event){var me=this;me.lastMoveTimestamp=+new Date,me.cursorPosition[0]=me.viewportXtoPageX(event.clientX,me.window),me.cursorPosition[1]=me.viewportYtoPageY(event.clientY,me.window),me.lastMouseMoveEvent=event},onBodyMouseMove:function(e){this.ignoreSynthetic&&e.synthetic||e.target.ownerDocument!==this.window.document||(this.saveMouseMoveData(e),this.processBodyMouseMove(e))},processBodyMouseMove:function(e){},onBodyMouseOver:function(e){this.ignoreSynthetic&&e.synthetic||e.target.ownerDocument!==this.window.document||(this.saveMouseMoveData(e),this.processBodyMouseOver(e))},processBodyMouseOver:function(e){},onBodyMouseOut:function(e){this.ignoreSynthetic&&e.synthetic||e.target.ownerDocument!==this.window.document||(this.saveMouseMoveData(e),this.processBodyMouseOut(e))},processBodyMouseOut:function(e){},targetToPathPoint:function(target){var pathPoint=[target.getTargetAsQueryString()];return target.getTarget().offset&&pathPoint.push.apply(pathPoint,target.getTarget().offset),pathPoint.xy=target.getTargetByType("xy").target,pathPoint},addPathPoint:function(pathPoints,newPathPoint){if(3!==newPathPoint.length){var lastPathPoint=pathPoints[pathPoints.length-1];if(1===newPathPoint.length&&"Array"==this.typeOf(newPathPoint[0])){var relativePoint=[newPathPoint[0][0]-lastPathPoint.xy[0],newPathPoint[0][1]-lastPathPoint.xy[1]];if(0===relativePoint[0]&&0===relativePoint[1])return;relativePoint.xy=newPathPoint[0],pathPoints.push(relativePoint)}else pathPoints.push(newPathPoint)}else pathPoints.push(newPathPoint)},addMoveCursorAction:function(event,targetOverride,useXY){event instanceof Siesta.Recorder.Event||(event=Siesta.Recorder.Event.fromDomEvent(event));var lastAction=this.getLastAction(),isMouseMove=lastAction&&("moveCursorTo"==lastAction.action||"moveCursorAlongPath"==lastAction.action);if(lastAction&&isMouseMove&&this.recordMouseMovePath){var target=new Siesta.Recorder.Target({targets:this.getPossibleTargets(event,!0,targetOverride,useXY)});"moveCursorTo"==lastAction.action&&(lastAction.action="moveCursorAlongPath",lastAction.value=[this.targetToPathPoint(lastAction.target)],lastAction.target=null),this.addPathPoint(lastAction.value,this.targetToPathPoint(target)),this.fireEvent("actionupdate",lastAction)}else{if(lastAction&&lastAction.hasTarget()&&lastAction.target){var xy=lastAction.target.getTargetByType("xy");if(xy&&(xy=xy.target,event.x==xy[0]&&event.y==xy[1]))return}var targetOptions=this.getPossibleTargets(event,!0,targetOverride,useXY);this.addAction({action:"moveCursorTo",target:targetOptions,sourceEvent:event,options:event.options})}}}}),Role("Siesta.Recorder.Role.CanRecordMouseMoveOnIdle",{has:{idleTimeout:3e3,recordMouseMoveOnIdle:!0,idleMouseMoveThrottler:null},override:{initialize:function(){this.recordMouseMoveOnIdle&&(this.recordMouseMove=!0),this.SUPERARG(arguments),this.recordMouseMoveOnIdle&&(this.idleMouseMoveThrottler=new Siesta.Util.Throttler({func:this.onBodyMouseMoveIdle,scope:this,buffer:this.idleTimeout}),this.resetMouseMoveListener=this.resetMouseMoveListener.bind(this))},onDomEvent:function(e){this.SUPERARG(arguments),this.resetMouseMoveListener()},clear:function(){this.recordMouseMoveOnIdle&&this.resetMouseMoveListener(),this.SUPERARG(arguments)},onStart:function(){this.SUPERARG(arguments);var body=this.window.document.body;this.recordMouseMoveOnIdle&&body.addEventListener("mouseleave",this.resetMouseMoveListener)},onStop:function(){this.SUPERARG(arguments);var body=this.window.document.body;this.recordMouseMoveOnIdle&&(body.removeEventListener("mouseleave",this.resetMouseMoveListener),this.resetMouseMoveListener())},processBodyMouseMove:function(e){this.SUPERARG(arguments),this.recordMouseMoveOnIdle&&this.idleMouseMoveThrottler.tick(e)}},methods:{resetMouseMoveListener:function(){this.idleMouseMoveThrottler&&this.idleMouseMoveThrottler.cancel()},onBodyMouseMoveIdle:function(e){this.addMoveCursorAction(e)}}}),Role("Siesta.Recorder.Role.CanRecordPointOfInterest",{does:Siesta.Util.Role.CanMergeArrayAttributeFromClassHierarchy,has:{moveCursorToSelectors:Joose.I.Array,pointOfInterestSelector:null,recordPointsOfInterest:!0,lastPointOfInterestEl:null},override:{initialize:function(cfg){this.moveCursorToSelectors=this.mergeArrayAttributeFromClassHierarchy("moveCursorToSelectors",cfg),this.pointOfInterestSelector=this.recordPointsOfInterest?this.moveCursorToSelectors.join(","):null,this.pointOfInterestSelector&&(this.recordMouseMove=!0),this.SUPERARG(arguments)},onStart:function(){this.SUPERARG(arguments),this.pointOfInterestSelector&&(this.lastPointOfInterestEl=null)},onStop:function(){this.SUPERARG(arguments),this.pointOfInterestSelector&&(this.lastPointOfInterestEl=null)},processBodyMouseOver:function(e){this.SUPERARG(arguments);var pointOfInterestSelector=this.pointOfInterestSelector;if(pointOfInterestSelector){var pointOfInterestEl=e.target;(this.matches(pointOfInterestEl,pointOfInterestSelector)||(pointOfInterestEl=this.closest(e.target,pointOfInterestSelector,10)))&&pointOfInterestEl!==this.lastPointOfInterestEl&&(this.lastPointOfInterestEl=pointOfInterestEl,this.addMoveCursorAction(e))}},processBodyMouseOut:function(e){this.SUPERARG(arguments),this.pointOfInterestSelector&&this.lastPointOfInterestEl&&(this.contains(this.lastPointOfInterestEl,e.target)||(this.lastPointOfInterestEl=null))}}}),Role("Siesta.Recorder.Role.CanRecordWindowResize",{requires:["getWindowSize"],does:[Siesta.Recorder.Role.CanSwallowException],has:{recordWindowResize:!0,recordInitialWindowSize:!1},override:{initialize:function(){this.SUPERARG(arguments),this.onWindowResize=this.safeBind(this.onWindowResize)},onStart:function(){this.SUPERARG(arguments);var win=this.window;if(this.recordWindowResize&&win.addEventListener("resize",this.onWindowResize),this.recordInitialWindowSize){this.recordInitialWindowSize=!1;var size=this.getWindowSize(this.window);this.addAction({action:"setWindowSize",value:[size.width,size.height]})}},onStop:function(){this.SUPERARG(arguments);var win=this.window;this.recordWindowResize&&win.removeEventListener("resize",this.onWindowResize)}},methods:{onWindowResize:function(nativeEvent){var size=this.getWindowSize(this.window),lastAction=this.getLastAction();lastAction&&"setWindowSize"==lastAction.action?(lastAction.value=[size.width,size.height],this.fireEvent("actionupdate",lastAction)):this.addAction({action:"setWindowSize",value:[size.width,size.height],sourceEvent:Siesta.Recorder.Event.fromDomEvent(nativeEvent)})}}}),Role("Siesta.Recorder.Role.CanRecordMouseMovePath",{has:{recordMouseMovePath:!1,lastMouseOutTarget:null},after:{onStart:function(){this.lastMouseOutTarget=null},onStop:function(){this.lastMouseOutTarget=null}},override:{initialize:function(){this.recordMouseMovePath&&(this.recordPointsOfInterest=!1,this.recordMouseMoveOnIdle=!1),this.SUPERARG(arguments),!0===this.recordMouseMovePath&&(this.recordMouseMovePath="coordinate")},processBodyMouseOver:function(e){this.SUPERARG(arguments),this.recordMouseMovePath&&e.target!=this.lastMouseOutTarget&&this.addMoveCursorAction(e,null,"coordinate"==this.recordMouseMovePath||"down"==this.mouseState),this.lastMouseOutTarget=null},processBodyMouseOut:function(e){this.SUPERARG(arguments),this.lastMouseOutTarget=e.relatedTarget,this.recordMouseMovePath&&this.addMoveCursorAction(e,e.relatedTarget,"coordinate"==this.recordMouseMovePath||"down"==this.mouseState)}}}),Role("Siesta.Recorder.Role.CanRecordMouseDownUp",{has:{mouseState:"up",eventNameMap:{lazy:"this.buildEventNameMap"},needToCaptureInitialMouseState:!0},override:{initialize:function(){this.SUPERARG(arguments),this.onDocMouseDown=this.safeBind(this.onDocMouseDown),this.onDocMouseUp=this.safeBind(this.onDocMouseUp),this.onInitialMouseMove=this.safeBind(this.onInitialMouseMove)},onStart:function(){this.SUPERARG(arguments);var eventNameMap=this.getEventNameMap(),doc=this.window.document;doc.addEventListener(eventNameMap.mousedown,this.onDocMouseDown,!0),doc.addEventListener(eventNameMap.mouseup,this.onDocMouseUp,!0),doc.body.addEventListener("mousemove",this.onInitialMouseMove,!0),this.needToCaptureInitialMouseState=!0},onStop:function(){this.SUPERARG(arguments);var eventNameMap=this.getEventNameMap(),doc=this.window.document;doc.removeEventListener(eventNameMap.mousedown,this.onDocMouseDown,!0),doc.removeEventListener(eventNameMap.mouseup,this.onDocMouseUp,!0),this.needToCaptureInitialMouseState&&this.onInitialStateCaptured()}},methods:{onInitialMouseMove:function(e){null!=e.buttons&&1&e.buttons&&(this.mouseState="down"),this.onInitialStateCaptured()},onInitialStateCaptured:function(){this.window.document.body.removeEventListener("mousemove",this.onInitialMouseMove,!0),this.needToCaptureInitialMouseState=!1},onDocMouseDown:function(e){this.ignoreSynthetic&&e.synthetic||e.target.ownerDocument!==this.window.document||(this.needToCaptureInitialMouseState&&this.onInitialStateCaptured(),this.processDocMouseDown(e))},processDocMouseDown:function(e){this.mouseState="down"},onDocMouseUp:function(e){this.ignoreSynthetic&&e.synthetic||e.target.ownerDocument!==this.window.document||(this.needToCaptureInitialMouseState&&this.onInitialStateCaptured(),this.processDocMouseUp(e))},processDocMouseUp:function(e){this.mouseState="up"},isPointerDownEvent:function(event){return/(ms)?(pointer|mouse)down/i.test(event.type)},isPointerUpEvent:function(event){return/(ms)?(pointer|mouse)up/i.test(event.type)},buildEventNameMap:function(){var events={};return window.PointerEvent?(events.mousedown="pointerdown",events.mouseup="pointerup"):window.MSPointerEvent?(events.mousedown="MSPointerDown",events.mouseup="MSPointerUp"):(events.mousedown="mousedown",events.mouseup="mouseup"),events}}}),Role("Siesta.Recorder.Role.CanRecordScroll",{has:{recordScroll:!1},override:{initialize:function(){this.SUPERARG(arguments),this.onScrollEvent=this.onScrollEvent.bind(this)},onStart:function(){this.SUPERARG(arguments);var doc=this.window.document;this.recordScroll&&doc.addEventListener("scroll",this.onScrollEvent,!0)},onStop:function(){this.SUPERARG(arguments);var doc=this.window.document;this.recordScroll&&doc.removeEventListener("scroll",this.onScrollEvent,!0)},onScrollEvent:function(scrollEvent){var target=scrollEvent.target,win=this.window,doc=win.document,lastAction=this.getLastAction();if(lastAction&&"scrollTo"==lastAction.action&&target==lastAction.sourceEvent.target)target===doc&&(target=this.getElForPageScroll(win)),lastAction.value=[target.scrollLeft,target.scrollTop],this.fireEvent("actionupdate",lastAction);else{var isPageScroll;target===doc&&(isPageScroll=!0,target=this.getElForPageScroll(win));var cursorPosition=this.cursorPosition;if(2===cursorPosition.length&&!isPageScroll){var viewportX=this.pageXtoViewportX(cursorPosition[0],win),viewportY=this.pageYtoViewportY(cursorPosition[1],win);if(!this.isPointWithinElement(viewportX,viewportY,target))return}this.addAction({action:"scrollTo",target:this.getPossibleTargets(scrollEvent,!1,target),value:[target.scrollLeft,target.scrollTop],sourceEvent:Siesta.Recorder.Event.fromDomEvent(scrollEvent)})}}}}),Role("Siesta.Recorder.Role.CanRecordWheel",{has:{recordWheel:!0,wheelEventBuffer:200,skipIfNoModifierKeysPressed:!1},override:{initialize:function(){this.SUPERARG(arguments),this.onWheelEvent=this.onWheelEvent.bind(this)},onStart:function(){this.SUPERARG(arguments);var doc=this.window.document;this.recordWheel&&doc.addEventListener("wheel",this.onWheelEvent,!0)},onStop:function(){this.SUPERARG(arguments);var doc=this.window.document;this.recordWheel&&doc.removeEventListener("wheel",this.onWheelEvent,!0)},sign:Math.sign||function(x){return(0<x)-(x<0)||+x},isSameWheelAxisAndDirection:function(event1,event2){return this.sign(event1.deltaX)===this.sign(event2.deltaX)&&this.sign(event1.deltaY)===this.sign(event2.deltaY)&&this.sign(event1.deltaZ)===this.sign(event2.deltaZ)},onWheelEvent:function(wheelEvent){var lastAction=this.getLastAction();if(!this.skipIfNoModifierKeysPressed||wheelEvent.ctrlKey||wheelEvent.altKey||wheelEvent.metaKey||wheelEvent.shiftKey){if(lastAction&&"wheel"===lastAction.action&&wheelEvent.target===lastAction.sourceEvent.target){var lastEvent=lastAction.sourceEvent;if(this.isSameWheelAxisAndDirection(wheelEvent,lastEvent.rawEvent)&&Date.now()-lastAction.timestamp<this.wheelEventBuffer)return lastAction.options.deltaX+=wheelEvent.deltaX,lastAction.options.deltaY+=wheelEvent.deltaY,lastAction.options.deltaZ+=wheelEvent.deltaZ,void this.fireEvent("actionupdate",lastAction)}this.onDomEvent(wheelEvent)}}}}),Class("Siesta.Recorder.Recorder",{does:[JooseX.Observable,Siesta.Util.Role.Dom,Siesta.Util.Role.CanParseOs,Siesta.Util.Role.CanGetType,Siesta.Recorder.Role.CanSwallowException,Siesta.Recorder.Role.CanRecordMouseDownUp,Siesta.Recorder.Role.CanRecordMouseMove,Siesta.Recorder.Role.CanRecordMouseMoveOnIdle,Siesta.Recorder.Role.CanRecordPointOfInterest,Siesta.Recorder.Role.CanRecordWindowResize,Siesta.Recorder.Role.CanRecordScroll,Siesta.Recorder.Role.CanRecordWheel,Siesta.Recorder.Role.CanRecordMouseMovePath],has:{active:null,extractor:null,extractorClass:Siesta.Recorder.TargetExtractor,extractorConfig:null,uniqueComponentProperty:null,uniqueDomNodeProperty:"id",shouldIgnoreDomElementId:null,ignoreCssClasses:Joose.I.Array,recordOffsets:!1,ignoreSynthetic:!0,window:null,clickMergeThreshold:200,debugMode:!1,eventsToRecord:{lazy:"this.buildEventsToRecord"},events:Joose.I.Array,processingEvent:null,actions:Joose.I.Array,actionsByEventId:Joose.I.Object,dragPixelThreshold:3,actionClass:Siesta.Recorder.Action,warnAboutIframeMissingId:!0},methods:{buildEventsToRecord:function(){var events=["keydown","keypress","keyup","click","dblclick","contextmenu"];return window.PointerEvent?events.push("pointerdown","pointerup"):window.MSPointerEvent?events.push("MSPointerDown","MSPointerUp"):events.push("mousedown","mouseup"),events},initialize:function(){this.onUnload=this.onUnload.bind(this),this.onFrameLoad=this.onFrameLoad.bind(this),this.onDomEvent=this.safeBind(this.onDomEvent);var extractorConfig=this.extractorConfig||{};extractorConfig.recorder=this,extractorConfig.uniqueComponentProperty=extractorConfig.uniqueComponentProperty||this.uniqueComponentProperty,extractorConfig.uniqueDomNodeProperty=extractorConfig.uniqueDomNodeProperty||this.uniqueDomNodeProperty,extractorConfig.swallowExceptions=this.swallowExceptions,extractorConfig.shouldIgnoreDomElementId=this.shouldIgnoreDomElementId,extractorConfig.ignoreCssClasses=this.ignoreCssClasses,this.extractor=new this.extractorClass(extractorConfig)},isSamePoint:function(event1,event2){return Math.abs(Math.round(event1.x)-Math.round(event2.x))<=this.dragPixelThreshold&&Math.abs(Math.round(event1.y)-Math.round(event2.y))<=this.dragPixelThreshold},isSameTarget:function(event1,event2){return event1.target==event2.target||this.contains(event1.target,event2.target)||this.contains(event2.target,event1.target)},clear:function(){var me=this;me.events=[],me.actions=[],me.actionsByEventId={},me.fireEvent("clear",me)},onUnload:function(){var actions=this.actions,last=actions.length&&actions[actions.length-1];last&&last.target&&(last.waitForPageLoad=!0),this.stop(!0)},onFrameLoad:function(event){try{var win=event.target.contentWindow;win.location.href}catch(e){win=null}win&&(this.attach(win),this.start())},attach:function(window){this.window!==window&&this.stop(),this.events=[],this.window=window},start:function(){this.active||(this.ignoreSynthetic||this.hasOwnProperty("clickMergeThreshold")||(this.clickMergeThreshold=1/0),this.stop(),this.active=Date.now(),this.onStart(),this.fireEvent("start",this))},stop:function(keepOnLoadListenerOnIframe){this.active&&(this.active=null,this.onStop(keepOnLoadListenerOnIframe),this.fireEvent("stop",this))},getRecordedEvents:function(){return this.events},getRecordedActions:function(){return this.actions},getRecordedActionsAsSteps:function(){return Joose.A.map(this.actions,function(action){return action.asStep()})},onDomEvent:function(e){var target=e.target;if(this.processingEvent=e,this.debugMode&&this.window.console&&"function"==typeof this.window.console.log&&console.log("[EVENT] : ",e.type,target,e.keyIdentifier||e.key),target&&(!this.ignoreSynthetic||!e.synthetic&&e.isTrusted)){var event=Siesta.Recorder.Event.fromDomEvent(e);this.convertToAction(event),this.events.push(event),10<this.events.length&&this.events.shift(),this.fireEvent("domevent",event)}},eventToAction:function(event,onlyXY){var actionName,type=event.type,options=event.options;if("wheel"===type){var rawEvent=event.rawEvent;actionName="wheel",options=Joose.O.extend({deltaX:rawEvent.deltaX||0,deltaY:rawEvent.deltaY||0,deltaZ:rawEvent.deltaZ||0,deltaMode:rawEvent.deltaMode||0},options)}else actionName=type.match(/^key/)?"type":this.isPointerDownEvent(event)?"mousedown":this.isPointerUpEvent(event)?"mouseup":type;var config={action:actionName,target:this.getPossibleTargets(event,"wheel"!==type,null,onlyXY),options:options,sourceEvent:event,sourceEventTargetReachableAtCenter:this.isElementReachableAtCenter(event.target,!1)},win=event.target.ownerDocument.defaultView;if(win!==this.window&&!onlyXY){if(!win.frameElement.id&&this.warnAboutIframeMissingId)throw new Error('To record events in a nested iframe, please set an "id" property on your frames');config.target=config.target.filter(function(actionTarget){return"string"==typeof actionTarget.target&&(actionTarget.target="#"+win.frameElement.id+" -> "+actionTarget.target,!0)})}return new this.actionClass(config)},recordAsAction:function(event,omitTarget){var action=this.eventToAction(event,omitTarget);if(action)return this.addAction(action),action},addAction:function(action){action instanceof this.actionClass||(action=new this.actionClass(action)),this.beforeAddAction(action),this.actions.push(action),action.sourceEvent&&(this.actionsByEventId[action.sourceEvent.id]=action),this.debugMode&&this.window.console&&"function"==typeof this.window.console.log&&console.log("[ACTION] : "+action.action,action.getTarget()&&action.asStep().target||"",action),this.fireEvent("actionadd",action)},removeAction:function(actionToRemove){for(var actions=this.actions,i=0;i<actions.length;i++){var action=actions[i];if(action==actionToRemove){actions.splice(i,1),action.sourceEvent&&delete this.actionsByEventId[action.sourceEvent.id],this.fireEvent("actionremove",actionToRemove);break}}},removeActionByEventId:function(eventId){this.removeAction(this.getActionByEventId(eventId))},removeActionByEvent:function(event){this.removeAction(this.getActionByEventId(event.id))},getActionByEvent:function(event){return this.actionsByEventId[event.id]},getActionByEventId:function(eventId){return this.actionsByEventId[eventId]},getLastAction:function(){return this.actions[this.actions.length-1]},getLastEvent:function(){return this.events[this.events.length-1]},canCombineTypeActions:function(prevOptions,curOptions){return prevOptions.ctrlKey==curOptions.ctrlKey&&prevOptions.metaKey==curOptions.metaKey&&prevOptions.shiftKey==curOptions.shiftKey&&prevOptions.altKey==curOptions.altKey},finalizeDragAction:function(mouseUpEvent,mouseDownEvent){var action=this.eventToAction(mouseUpEvent,!0);action.target=new Siesta.Recorder.Target({targets:[{target:[mouseUpEvent.x,mouseUpEvent.y],type:"xy"}]}),this.addAction(action)},convertToAction:function(event){var type=event.type,events=this.getRecordedEvents(),length=events.length,tail=this.getLastEvent(),tailPrev=2<=length?events[length-2]:null;if(!this.shouldIgnoreEvent(event,tail,tailPrev))if("wheel"!==type)if("keypress"!==type&&"keyup"!==type&&"keydown"!==type)if(length){if("dblclick"===type)return 1<this.getRecordedActions().length&&this.removeAction(this.getLastAction()),this.getLastAction().action="dblclick",void this.fireEvent("actionupdate",this.getLastAction());if(this.isPointerDownEvent(tail)&&this.isPointerUpEvent(event)&&event.button==tail.button&&!this.isSamePoint(event,tail))this.finalizeDragAction(event,tail);else if(tail&&this.isPointerUpEvent(event)&&this.isPointerDownEvent(tail)&&event.button==tail.button&&this.isSamePoint(event,tail)&&!bowser.gecko)this.recordAsAction(event,!0);else{var isFF57BrokenOnWindows=bowser.gecko&&bowser.windows;if(tailPrev&&"click"===type){if(this.isPointerUpEvent(tail)&&event.button==tail.button&&event.button==tailPrev.button&&this.isSamePoint(event,tail)&&this.isPointerDownEvent(tailPrev)&&this.isSameTarget(event,tail)&&this.isSameTarget(event,tailPrev)&&this.isSamePoint(event,tailPrev)){var mouseDownAction=this.getActionByEvent(tailPrev);return void(Date.now()-mouseDownAction.getTimestamp()>this.clickMergeThreshold||(this.removeActionByEvent(tail),event.target==tail.target&&tail.target==tailPrev.target&&!this.recordOffsets&&mouseDownAction.sourceEventTargetReachableAtCenter&&mouseDownAction.clearTargetOffset(isFF57BrokenOnWindows),mouseDownAction.action="click",this.fireEvent("actionupdate",mouseDownAction)))}}else{if("contextmenu"===type){var lastAction=this.getLastAction();if(isFF57BrokenOnWindows&&"click"==tail.type&&"click"==lastAction.action)return lastAction.action="contextmenu",lastAction.restoreTargetOffset(),void this.fireEvent("actionupdate",lastAction);(this.isPointerUpEvent(tail)||this.isPointerDownEvent(tail))&&event.button==tail.button&&this.isSamePoint(event,tail)&&this.removeActionByEvent(tail),this.isPointerUpEvent(tail)&&this.isPointerDownEvent(tailPrev)&&this.isSameTarget(event,tail)&&this.isSameTarget(event,tailPrev)&&this.isSamePoint(event,tailPrev)&&this.removeActionByEvent(tailPrev)}this.recordAsAction(event)}}}else this.recordAsAction(event);else this.convertKeyEventToAction(event);else this.recordAsAction(event)},shouldIgnoreEvent:function(event,tail,tailPrev){var isKeyEvent=event.type.match(/^key/),keyCode=event.keyCode,keys=Siesta.Test.UserAgent.KeyCodes().keys;return!(!isKeyEvent||keyCode!==keys.SHIFT&&keyCode!==keys.CTRL&&keyCode!==keys.ALT&&keyCode!==keys.CMD)||(!(!this.isPointerUpEvent(event)||!tail||"contextmenu"!==tail.type)||(!!("keypress"==event.type&&tail&&"keydown"==tail.type&&tailPrev&&"keydown"==tailPrev.type&&event.rawEvent.key==tail.rawEvent.key&&"Control"==tailPrev.rawEvent.key&&event.rawEvent.timeStamp-tail.rawEvent.timeStamp<3)||(!("click"!=event.type||!tail||"click"!=tail.type||"label"!==tail.target.nodeName.toLowerCase())||void 0)))},convertKeyEventToAction:function(event){var type=event.type,tail=this.getLastEvent(),KC=Siesta.Test.UserAgent.KeyCodes(),isSpecial="keydown"==type&&(KC.isSpecial(event.keyCode)||KC.isNav(event.keyCode)),isModifier=KC.isModifier(event.keyCode),options=event.options,prevType=tail&&tail.type,prevSpecial="keypress"==type&&"keydown"==prevType&&(KC.isSpecial(tail.keyCode)||KC.isNav(tail.keyCode)),isMac=(this.parseOS(navigator.platform),"MacOS"===this.parseOS(navigator.platform));if("keypress"==type&&!isSpecial&&!prevSpecial||"keydown"==type&&(isSpecial||isModifier||!isMac&&options.ctrlKey||isMac&&options.metaKey)){var lastAction=this.getLastAction(),text=event.rawEvent.key?event.rawEvent.key:isSpecial?KC.fromCharCode(event.charCode,!0):String.fromCharCode(event.charCode);return text=isSpecial?"["+text.toUpperCase()+"]":text,void(lastAction&&"type"===lastAction.action&&this.canCombineTypeActions(lastAction.options,event.options)?KC.isModifier(event.keyCode)||(lastAction.value+=text,this.fireEvent("actionupdate",lastAction)):this.addAction({action:"type",target:this.getPossibleTargets(event),value:text,sourceEvent:event,options:event.options}))}},onStart:function(){var me=this,window=me.window,frameWindows=(window.document.body,this.getNestedFrames().map(function(frame){return frame.contentWindow}));[window].concat(frameWindows).forEach(function(win){me.registerWindowListeners(win)}),window.frameElement&&window.frameElement.addEventListener("load",this.onFrameLoad),window.addEventListener("unload",this.onUnload),window.focus()},onStop:function(keepOnLoadListenerOnIframe){var me=this,window=me.window,frameWindows=(window.document.body,this.getNestedFrames().map(function(frame){return frame.contentWindow}));[window].concat(frameWindows).forEach(function(win){me.deregisterWindowListeners(win)}),keepOnLoadListenerOnIframe||window.frameElement&&window.frameElement.removeEventListener("load",me.onFrameLoad),window.removeEventListener("unload",this.onUnload)},registerWindowListeners:function(win){if(!this.isCrossOriginWindow(win)){var me=this;me.getEventsToRecord().forEach(function(name){win.document.addEventListener(name,me.onDomEvent,!0)})}},deregisterWindowListeners:function(win){if(!this.isCrossOriginWindow(win)){var me=this;me.getEventsToRecord().forEach(function(name){win.document.removeEventListener(name,me.onDomEvent,!0)})}},getNestedFrames:function(){var me=this;return Array.prototype.slice.apply(this.window.document.getElementsByTagName("iframe")).filter(function(frame){return!me.isCrossOriginWindow(frame.contentWindow)})},beforeAddAction:function(action){},getPossibleTargets:function(event,recordOffsets,targetOverride,onlyXY){return"HTMLDocument"==this.typeOf(event.target)&&(event.target=event.target.body),this.extractor.getTargets(event,recordOffsets,targetOverride,onlyXY)}}}),Role("Ariadne.ExtJSDomQueryFinder.Role.ExtJSHelper",{methods:{getComponentOfDomElement:function(el){var doc=el.ownerDocument,body=doc.body,Ext=(doc.defaultView||doc.parentWindow).Ext;if(!Ext||!Ext.getCmp)return null;for(;el&&el!=body;){var elId=el.getAttribute("id");if(elId&&Ext.getCmp(elId))return Ext.getCmp(elId);el=el.parentElement}return null},getExtByDomElement:function(el){var doc=el.ownerDocument;return(doc.defaultView||doc.parentWindow).Ext},getExtCssClassPrefixRegexp:function(el){var Ext=this.getExtByDomElement(el);if(!Ext)return null;var baseCSSPrefix=Ext.baseCSSPrefix||"x";return new RegExp("^"+baseCSSPrefix)},valueIsAutoGeneratedByComponent:function(comp,value){if(!comp.up)return!1;value=String(value);var componentsToCheck=comp.autoGenId?[comp]:[],parentWithAutoId=comp.up("[autoGenId=true]");parentWithAutoId&&componentsToCheck.push(parentWithAutoId);var childrenWithAutoId=parentWithAutoId&&parentWithAutoId.query&&parentWithAutoId.query("[autoGenId=true]");return childrenWithAutoId&&componentsToCheck.push.apply(componentsToCheck,childrenWithAutoId),componentsToCheck.some(function(comp){return 0<=value.indexOf(comp.id)})},componentHasAutoGeneratedId:function(component,Ext){var id=component.id;return!!/^ext-gen\d+|^ext-comp\d+/.test(id)||(!(!Ext||!this.idIsGeneratedByExtDotIdCall(id,Ext))||(component.isWidget?id.replace(/\d+$/,"")==component.identifiablePrefix:component.autoGenId||this.valueIsAutoGeneratedByComponent(component,id)))},idIsGeneratedByExtDotIdCall:function(id,Ext,el){if(!(Ext=Ext||this.getExtByDomElement(el)))return!1;var match=/^(.+?)\d+$/.exec(id);return Boolean(match&&match[1]==Ext.idPrefix)},domElementHasAutoGeneratedId:function(el){var id=el.getAttribute("id")||"";if(/^ext-/.test(id)||this.idIsGeneratedByExtDotIdCall(id,null,el))return!0;var comp=this.getComponentOfDomElement(el);return!(!comp||!(id!==comp.id&&-1<id.indexOf(comp.id)||this.componentHasAutoGeneratedId(comp)))}}}),Class("Ariadne.ExtJSDomQueryFinder.Identifier.CssClass",{isa:Ariadne.DomQueryFinder.Identifier.CssClass,does:Ariadne.ExtJSDomQueryFinder.Role.ExtJSHelper,has:{ignoreCssClasses:function(){return["-focus$","-focused$","-over$","-hover$","-selected$","-active$","-default$","x-form-dirty","x-grid-dirty-cell","x-unselectable","-toolbar-item$","-item-disabled","x-form-empty-field","x-grid-item-alt"]},lessRelevantCssClasses:function(){return["x-form-field","x-form-required-field","-layout","-inner$","-default$","-box-","^x-tree-elbow"]}},methods:{initialize:function(){this.SUPERARG(arguments);var lessRelevantCssClasses=this.lessRelevantCssClasses;lessRelevantCssClasses.forEach(function(cls,index){lessRelevantCssClasses[index]=new RegExp(cls)})},getWeightForCssClass:function(cls,target){var prefix=this.getExtCssClassPrefixRegexp(target);return this.lessRelevantCssClasses.some(function(lessRelevantClsRegExp){return lessRelevantClsRegExp.test(cls)})?1e3:!prefix||prefix.test(cls)?995:950},ignoreCssClass:function(cls,dom){var cmp=this.getComponentOfDomElement(dom);return!(!cmp||!this.valueIsAutoGeneratedByComponent(cmp,cls))||this.SUPER(cls,dom)},processCssClasses:function(classes,target){var prefix=this.getExtCssClassPrefixRegexp(target);return prefix&&classes.sort(function(cls1,cls2){var test1=prefix.test(cls1),test2=prefix.test(cls2);return test1&&!test2?1:!test1&&test2?-1:0}),classes}}}),Class("Ariadne.ExtJSDomQueryFinder.Identifier.Id",{isa:Ariadne.DomQueryFinder.Identifier.Id,does:Ariadne.ExtJSDomQueryFinder.Role.ExtJSHelper,methods:{ignoreDomId:function(id,target){return this.domElementHasAutoGeneratedId(target)}}}),Class("Ariadne.ExtJSDomQueryFinder.Identifier.AttributeValue",{isa:Ariadne.DomQueryFinder.Identifier.AttributeValue,does:Ariadne.ExtJSDomQueryFinder.Role.ExtJSHelper,has:{attributes:function(){return["data-ref","aria-label"]}},methods:{ignoreAttribute:function(target,attributeName){var value=target.getAttribute(attributeName),cmp=this.getComponentOfDomElement(target);return!(!cmp||!this.valueIsAutoGeneratedByComponent(cmp,value))||this.SUPERARG(arguments)}}}),Class("Ariadne.ExtJSDomQueryFinder",{isa:Ariadne.DomQueryFinder,has:{},methods:{initIdentifiers:function(){this.addIdentifier(new Ariadne.ExtJSDomQueryFinder.Identifier.Id({shouldIgnoreDomElementId:this.shouldIgnoreDomElementId,uniqueDomNodeProperty:this.uniqueDomNodeProperty,finder:this,priority:1e6})),this.addIdentifier(new Ariadne.ExtJSDomQueryFinder.Identifier.CssClass({finder:this,priority:1e5})),this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.Contains({finder:this,priority:1e4})),this.addIdentifier(new Ariadne.ExtJSDomQueryFinder.Identifier.AttributeValue({finder:this,priority:1e3})),this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.TagName({finder:this,priority:100})),this.addIdentifier(new Ariadne.DomQueryFinder.Identifier.NthOfType({finder:this,priority:10})),this.directChildIdentifier=new Ariadne.DomQueryFinder.Identifier.DirectChild({finder:this})},findQueries:function(target,root,options){return target&&target.dom&&target.dom.tagName&&(target=target.dom),this.SUPER(target,root,options)}}}),Role("Ariadne.ExtJSComponentQueryFinder.Role.ExtJSComponentHelper",{does:Ariadne.DomQueryFinder.Role.DomHelper,has:{},methods:{getComponentXType:function(cmp){var xtype=this.getComponentOwnXType(cmp);return xtype||((xtype=cmp.getXTypes&&cmp.getXTypes())?(xtype=xtype.split("/"))[xtype.length-1]:null)},getComponentOwnXType:function(cmp){return cmp.getXType&&cmp.getXType()||cmp.xtype||cmp.xtypes[0]},escapeCQSelector:function(selector){return this.escapeDomSelector(selector)},getExt4ProofXtype:function(cmp,Ext){var xtype=this.getComponentXType(cmp),escaped=this.escapeCQSelector(xtype),extVersion=Ext.getVersion("ext");return extVersion&&4==extVersion.major&&xtype!=escaped?{query:"[xtype="+escaped+"]",leading:!1}:{query:escaped,leading:!0}}}}),Role("Ariadne.ExtJSComponentQueryFinder.TreeWalker",{methods:{getParent:function(cmp){return cmp.getRefOwner&&cmp.getRefOwner()||cmp.ownerCt||this.Ext.ComponentQuery},contains:function(parentCmp,childCmp){var CQ=this.Ext.ComponentQuery;if(parentCmp==CQ)return!0;if(childCmp==CQ)return!1;for(;childCmp&&childCmp!=CQ;){if(childCmp==parentCmp)return!0;childCmp=this.getParent(childCmp)}return!1}}}),Class("Ariadne.ExtJSComponentQueryFinder.Identifier.XType",{isa:Ariadne.QueryFinder.Identifier,does:[Ariadne.ExtJSComponentQueryFinder.Role.ExtJSComponentHelper],methods:{identify:function(cmp,root,maze){var xtype=this.getComponentXType(cmp),escaped=this.escapeCQSelector(xtype);return[this.getExt4ProofXtype(cmp,this.finder.Ext),{query:escaped+"(true)",leading:!0,weight:1010}]}}}),Class("Ariadne.ExtJSComponentQueryFinder.Identifier.NthChild",{isa:Ariadne.QueryFinder.Identifier,does:[Ariadne.ExtJSComponentQueryFinder.Role.ExtJSComponentHelper],methods:{identify:function(cmp,root,maze){var container=this.finder.getParent(cmp);if(!container||container==root)return null;if(!container.items)return null;var index=container.items.indexOf(cmp);if(-1==index){var refItems=container.getRefItems&&container.getRefItems();if(!refItems)return null;for(var len=refItems.length,i=0;i<len;i++)if(refItems[i]===cmp){index=i;break}if(len<=i)return null}return{query:":ariadne-nth-child("+(index+1)+")",weight:1e6}}}}),Class("Ariadne.ExtJSComponentQueryFinder.Identifier.DirectChild",{isa:Ariadne.ExtJSComponentQueryFinder.Identifier.NthChild,methods:{identify:function(cmp,root,maze){var container=this.finder.getParent(cmp);if(container&&container!=root||!root.query){var segment=this.SUPERARG(arguments);return segment&&(segment.child=!0),segment}var safeXtype=this.getExt4ProofXtype(cmp,this.finder.Ext),query=safeXtype.query+(safeXtype.leading?"(true)":""),index=root.query(query+":root").indexOf(cmp);if(0<=index)return{query:query+":root("+(index+1)+")",leading:safeXtype.leading,weight:1e7}}}}),Class("Ariadne.ExtJSComponentQueryFinder.Identifier.PropertyValue",{isa:Ariadne.QueryFinder.Identifier,does:[Ariadne.ExtJSComponentQueryFinder.Role.ExtJSComponentHelper,Ariadne.ExtJSDomQueryFinder.Role.ExtJSHelper],has:{properties:function(){return["name","text","dataIndex","iconCls","type","title","inputType","boxLabel","fieldLabel"]}},methods:{initialize:function(cfg){this.properties=this.mergeArrayAttributeFromClassHierarchy("properties",cfg)},ignoreProperty:function(target,property){return this.valueIsAutoGeneratedByComponent(target,target[property])},identify:function(target,root,maze){for(var Ext=this.finder.Ext,properties=this.properties,segments=[],safeXtype=this.getExt4ProofXtype(target,Ext),i=0;i<properties.length;i++){var property=properties[i],value=target[property];value&&"string"==typeof value&&!(this.ignoreProperty(target,property)||"inputType"==property&&Ext.slider&&Ext.slider.Multi&&target instanceof Ext.slider.Multi||"inputType"==property&&Ext.form&&Ext.form.field&&Ext.form.field.ComboBox&&target instanceof Ext.form.field.ComboBox||"&#160;"==value)&&segments.push({query:safeXtype.query+"["+property+"="+this.escapeCQSelector(value)+"]",leading:safeXtype.leading})}return segments}}}),Class("Ariadne.ExtJSComponentQueryFinder.Identifier.Id",{isa:Ariadne.QueryFinder.Identifier,does:[Ariadne.ExtJSComponentQueryFinder.Role.ExtJSComponentHelper,Ariadne.ExtJSDomQueryFinder.Role.ExtJSHelper],methods:{identify:function(target,root,maze){var id=target.id;if(!id||this.ignoreComponentId(id,target,maze.finder.Ext))return null;var weight=maze.encounteredMandatoryId||!this.finder.enableMandatoryId?1e3:-1e5;return maze.encounteredMandatoryId=!0,{query:"#"+this.escapeCQSelector(id),weight:weight,isId:!0}},ignoreComponentId:function(id,comp,Ext){return this.componentHasAutoGeneratedId(comp,Ext)}}}),Class("Ariadne.ExtJSComponentQueryFinder.Identifier.ItemId",{isa:Ariadne.QueryFinder.Identifier,methods:{identify:function(target,root,maze){var itemId=target.itemId;if(itemId)return{query:"#"+itemId,weight:-1e3}}}}),Class("Ariadne.ExtJSComponentQueryFinder",{isa:Ariadne.QueryFinder,does:[Siesta.Util.Role.CanInstallCQRootPseudo,Ariadne.ExtJSComponentQueryFinder.TreeWalker,Ariadne.ExtJSDomQueryFinder.Role.ExtJSHelper],has:{Ext:null,uniqueComponentProperty:null},methods:{setExtByDomElement:function(dom){this.Ext=this.getExtByDomElement(dom)},setExt:function(Ext){this.Ext=Ext},initRecognizers:function(){},initIdentifiers:function(){this.addIdentifier(new Ariadne.ExtJSComponentQueryFinder.Identifier.Id({finder:this,priority:1e4})),this.addIdentifier(new Ariadne.ExtJSComponentQueryFinder.Identifier.ItemId({finder:this,priority:1e4})),this.addIdentifier(new Ariadne.ExtJSComponentQueryFinder.Identifier.PropertyValue({properties:this.uniqueComponentProperty,finder:this,priority:1e3})),this.addIdentifier(new Ariadne.ExtJSComponentQueryFinder.Identifier.XType({finder:this,priority:100})),this.addIdentifier(new Ariadne.ExtJSComponentQueryFinder.Identifier.NthChild({finder:this,priority:10})),this.directChildIdentifier=new Ariadne.ExtJSComponentQueryFinder.Identifier.DirectChild({finder:this})},doQuery:function(query,root){var CQ=this.Ext.ComponentQuery;return root==CQ&&(root=null),CQ.query(query,root)},findQueries:function(target,root,options){if(!target)throw new Error("No target");var Ext=this.Ext;if(!Ext||!Ext.ComponentQuery)return[];var CQ=Ext.ComponentQuery;this.installRootPseudoCQ(Ext),root=root||CQ;var parent=this.getParent(target);if(parent!=root&&!parent.items){var parentQueries=this.SUPER(parent,root,options),childQueries=this.SUPER(target,parent,options);if(parentQueries.length&&childQueries.length){var result=[];return parentQueries.forEach(function(parentQuery){childQueries.forEach(function(childQuery){result.push(parentQuery+" "+childQuery)})}),result}}return this.SUPER(target,root,options)}}}),Class("Siesta.Recorder.TargetExtractor.ExtJS",{isa:Siesta.Recorder.TargetExtractor,does:[Ariadne.ExtJSDomQueryFinder.Role.ExtJSHelper],has:{Ext:null,skipDomQuery:!1,uniqueComponentProperty:null},methods:{initialize:function(){this.SUPER(),this.ariadneDomFinder=new Ariadne.ExtJSDomQueryFinder({uniqueDomNodeProperty:this.uniqueDomNodeProperty,shouldIgnoreDomElementId:this.shouldIgnoreDomElementId});var properties=this.uniqueComponentProperty;properties=properties&&(properties instanceof Array?properties:[properties]),this.ariadneCQFinder=new Ariadne.ExtJSComponentQueryFinder({uniqueComponentProperty:properties}),this.swallowExceptions&&(this.findComponentQueryFor=this.safeBind(this.findComponentQueryFor),this.findCompositeQueryFor=this.safeBind(this.findCompositeQueryFor))},setExt:function(node){var doc=node.ownerDocument;this.Ext=(doc.defaultView||doc.parentWindow).Ext,this.ariadneCQFinder.setExt(this.Ext)},getTargets:function(event,saveOffset,targetOverride,onlyXY){if(onlyXY)return this.SUPER(event,saveOffset,targetOverride,onlyXY);var component,target=targetOverride||event.target;this.setExt(target);var hasCQ=this.Ext&&this.Ext.ComponentQuery&&this.Ext.versions&&!this.Ext.versions.touch;hasCQ&&(component=this.getComponentOfDomElement(target));var compEl=component&&(component.el||component.element);if(compEl=compEl&&compEl.dom,!hasCQ||compEl&&!compEl.contains(target))return this.SUPER(event,saveOffset,targetOverride);var result=[],hasCoordinates=null!=event.x&&null!=event.y;if(component){var componentQuery=this.findComponentQueryFor(component);if(componentQuery&&(result.unshift({type:"cq",target:componentQuery,offset:!hasCoordinates||!saveOffset&&this.isElementReachableAtCenter(compEl,!1)?null:this.findOffset(event.x,event.y,compEl)}),compEl!=target)){var compositeQuery=this.findCompositeQueryFor(target,componentQuery,component);compositeQuery&&result.unshift({type:"csq",target:compositeQuery,offset:!hasCoordinates||!saveOffset&&this.isElementReachableAtCenter(target,!1)?null:this.findOffset(event.x,event.y,target)})}}return result.concat(this.SUPER(event,saveOffset,targetOverride,this.skipDomQuery&&result.length))},findCompositeQueryFor:function(node,componentQuery,component){if(!componentQuery){if(!(component=this.getComponentOfDomElement(node)))return null;if(!(componentQuery=this.findComponentQueryFor(component)))return null}var root=(component.el||component.element).dom;if(node==root||!root.contains(node))return null;var compositeDomQuery=this.findDomQueryFor(node,root);return compositeDomQuery?componentQuery+" => "+compositeDomQuery:null},findComponentQueryFor:function(comp,root){return this.ariadneCQFinder.findQuery(comp,root)}}}),Class("Siesta.Recorder.ExtJS",{isa:Siesta.Recorder.Recorder,has:{extractorClass:Siesta.Recorder.TargetExtractor.ExtJS,moveCursorToSelectors:function(){return[".x-menu-item:not(.x-menu-item-separator)",".x-column-header"]}},methods:{addMoveCursorAction:function(event){event.target&&this.closest(event.target,"[class*=-dd-drag-proxy]",10)?this.addAction({action:"moveCursorTo",target:[{type:"xy",target:[event.x,event.y]}],sourceEvent:event,options:event.options}):this.SUPERARG(arguments)}}});