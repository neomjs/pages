{"classData":[{"comment":"/**\n * @summary DevIndex Cleanup Service (Data Hygiene & Lifecycle Management).\n *\n * This singleton service acts as the **\"Garbage Collector\" and \"State Enforcer\"** for the DevIndex data pipeline.\n * It is automatically invoked by the `Manager` before any `spider` or `update` operation to ensure the system\n * starts with a clean, consistent state.\n *\n * **Core Responsibilities:**\n * 1.  **Threshold Pruning:** Removes users from both the Rich Data Store (`users.json`) and the Tracker Index (`tracker.json`)\n *     if they fall below the `minTotalContributions` threshold. This prevents the index from bloating with low-value data.\n * 2.  **Blocklist Enforcement:** Hard-deletes any user present in `blocklist.json` from all data files.\n * 3.  **Allowlist Protection:** \"Resurrects\" any user found in `allowlist.json` who is missing from the tracker, ensuring\n *     VIPs are always scheduled for updates. Also protects them from being pruned, regardless of their contribution count.\n * 4.  **Canonical Sorting:** Re-writes all JSON files with deterministic sorting (by contributions or login) to minimize\n *     git diff noise and ensure O(1) human readability.\n * 5.  **Penalty Box Retention:** Enforces a 30-day Time-To-Live (TTL) on failed users. If a user remains in the \"Penalty Box\"\n *     (`failed.json`) for >30 days, they are permanently expunged.\n *\n * **Key Concepts:**\n * - **Active Pruning:** The proactive removal of \"dead weight\" users to optimize the `Updater` loop.\n * - **Resurrection:** The mechanism to bring a user back into the tracking loop via the allowlist.\n *\n * @class DevIndex.services.Cleanup\n * @extends Neo.core.Base\n * @singleton\n */","meta":{"filename":"Cleanup.mjs","lineno":5,"columnno":0,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/apps/devindex/services","code":{}},"summary":"DevIndex Cleanup Service (Data Hygiene & Lifecycle Management).\n\nThis singleton service acts as the **\"Garbage Collector\" and \"State Enforcer\"** for the DevIndex data pipeline.\nIt is automatically invoked by the `Manager` before any `spider` or `update` operation to ensure the system\nstarts with a clean, consistent state.\n\n**Core Responsibilities:**\n1.  **Threshold Pruning:** Removes users from both the Rich Data Store (`users.json`) and the Tracker Index (`tracker.json`)\n    if they fall below the `minTotalContributions` threshold. This prevents the index from bloating with low-value data.\n2.  **Blocklist Enforcement:** Hard-deletes any user present in `blocklist.json` from all data files.\n3.  **Allowlist Protection:** \"Resurrects\" any user found in `allowlist.json` who is missing from the tracker, ensuring\n    VIPs are always scheduled for updates. Also protects them from being pruned, regardless of their contribution count.\n4.  **Canonical Sorting:** Re-writes all JSON files with deterministic sorting (by contributions or login) to minimize\n    git diff noise and ensure O(1) human readability.\n5.  **Penalty Box Retention:** Enforces a 30-day Time-To-Live (TTL) on failed users. If a user remains in the \"Penalty Box\"\n    (`failed.json`) for >30 days, they are permanently expunged.\n\n**Key Concepts:**\n- **Active Pruning:** The proactive removal of \"dead weight\" users to optimize the `Updater` loop.\n- **Resurrection:** The mechanism to bring a user back into the tracking loop via the allowlist.","kind":"class","name":"Cleanup","augments":["Neo.core.Base"],"tags":[{"originalTitle":"singleton","title":"singleton","text":""}],"memberof":"DevIndex.services","longname":"DevIndex.services.Cleanup","scope":"static","$longname":"DevIndex.services.Cleanup","$kind":"class","id":8008,"neoClassName":"DevIndex.services.Cleanup"},{"comment":"/**\n         * @member {String} className='DevIndex.services.Cleanup'\n         * @protected\n         */","meta":{"filename":"Cleanup.mjs","lineno":37,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/apps/devindex/services","code":{}},"kind":"member","name":"className","type":{"names":["String"]},"defaultvalue":"'DevIndex.services.Cleanup'","access":"protected","longname":"className","scope":"global","$longname":"className","$kind":"property","id":8009,"neoClassName":"DevIndex.services.Cleanup"},{"comment":"/**\n         * @member {Boolean} singleton=true\n         * @protected\n         */","meta":{"filename":"Cleanup.mjs","lineno":42,"columnno":8,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/apps/devindex/services","code":{}},"kind":"member","name":"singleton","type":{"names":["Boolean"]},"defaultvalue":true,"access":"protected","longname":"singleton","scope":"global","$longname":"singleton","$kind":"property","id":8010,"neoClassName":"DevIndex.services.Cleanup"},{"comment":"/**\n     * Executes the comprehensive cleanup and data hygiene workflow.\n     *\n     * **Steps:**\n     * 1.  **Load State:** Reads all JSON data files into memory.\n     * 1.5. **Retention Check:** Scans `failed.json` for expired entries (>30 days). Expired users are removed from the penalty box protection, effectively allowing them to be pruned if they remain invalid.\n     * 2.  **Resurrection:** Checks `allowlist.json` against `tracker.json`. If a VIP is missing, they are added back to the queue.\n     * 3.  **User Pruning:** Filters `users.json`. Removes any user who is in the blocklist OR (below threshold AND not allowlisted).\n     * 4.  **Tracker Pruning:** Filters `tracker.json`. Removes users who have been scanned (`lastUpdate` exists) but failed the threshold check (are not in the filtered `users` list). Explicitly protects allowlisted users.\n     * 5.  **Canonical Sorting:** Sorts all datasets (Users by contributions, others alphabetically) to minimize git diffs.\n     * 6.  **Persistence:** Writes clean, sorted data back to disk.\n     *\n     * @returns {Promise<void>}\n     */","meta":{"range":[3231,8904],"filename":"Cleanup.mjs","lineno":59,"columnno":4,"path":"/Users/Shared/github/neomjs/pages/node_modules/neo.mjs/apps/devindex/services","code":{"id":"astnode100002782","name":"Cleanup#run","type":"MethodDefinition","paramnames":[]},"vars":{"":null}},"description":"<p>Executes the comprehensive cleanup and data hygiene workflow.</p>\n<p><strong>Steps:</strong></p>\n<ol>\n<li><strong>Load State:</strong> Reads all JSON data files into memory.\n1.5. <strong>Retention Check:</strong> Scans <code>failed.json</code> for expired entries (&gt;30 days). Expired users are removed from the penalty box protection, effectively allowing them to be pruned if they remain invalid.</li>\n<li><strong>Resurrection:</strong> Checks <code>allowlist.json</code> against <code>tracker.json</code>. If a VIP is missing, they are added back to the queue.</li>\n<li><strong>User Pruning:</strong> Filters <code>users.json</code>. Removes any user who is in the blocklist OR (below threshold AND not allowlisted).</li>\n<li><strong>Tracker Pruning:</strong> Filters <code>tracker.json</code>. Removes users who have been scanned (<code>lastUpdate</code> exists) but failed the threshold check (are not in the filtered <code>users</code> list). Explicitly protects allowlisted users.</li>\n<li><strong>Canonical Sorting:</strong> Sorts all datasets (Users by contributions, others alphabetically) to minimize git diffs.</li>\n<li><strong>Persistence:</strong> Writes clean, sorted data back to disk.</li>\n</ol>\n","returns":[{"type":{"names":["Promise.<void>"]}}],"name":"run","longname":"Cleanup#run","kind":"function","memberof":"Cleanup","scope":"instance","params":[],"async":true,"$longname":"Cleanup#run","$kind":"method","id":8011,"neoClassName":"DevIndex.services.Cleanup"}]}